[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Plugin",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Exception",5],["T_NS_SEPARATOR","\\",5],["T_STRING","PluginNotFoundException",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DatabaseExceptionWrapper",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Database",8],["T_NS_SEPARATOR","\\",8],["T_STRING","IntegrityConstraintViolationException",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Entity",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ContentEntityType",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Entity",10],["T_NS_SEPARATOR","\\",10],["T_STRING","EntityStorageException",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Entity",11],["T_NS_SEPARATOR","\\",11],["T_STRING","EntityTypeEvents",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Drupal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Core",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Entity",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Exception",12],["T_NS_SEPARATOR","\\",12],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Drupal",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Core",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Field",13],["T_NS_SEPARATOR","\\",13],["T_STRING","BaseFieldDefinition",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Drupal",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Core",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Field",14],["T_NS_SEPARATOR","\\",14],["T_STRING","FieldStorageDefinitionEvents",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Drupal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Core",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Language",15],["T_NS_SEPARATOR","\\",15],["T_STRING","LanguageInterface",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Drupal",16],["T_NS_SEPARATOR","\\",16],["T_STRING","entity_test",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Entity",16],["T_NS_SEPARATOR","\\",16],["T_STRING","EntityTestUpdate",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Drupal",17],["T_NS_SEPARATOR","\\",17],["T_STRING","system",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Tests",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Entity",17],["T_NS_SEPARATOR","\\",17],["T_STRING","EntityDefinitionTestTrait",17],";",["T_WHITESPACE","\n\n",17],["T_DOC_COMMENT","\/**\n * Tests EntityDefinitionUpdateManager functionality.\n *\n * @group Entity\n *\/",19],["T_WHITESPACE","\n",23],["T_CLASS","class",24],["T_WHITESPACE"," ",24],["T_STRING","EntityDefinitionUpdateTest",24],["T_WHITESPACE"," ",24],["T_EXTENDS","extends",24],["T_WHITESPACE"," ",24],["T_STRING","EntityKernelTestBase",24],["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n\n  ",24],["T_USE","use",26],["T_WHITESPACE"," ",26],["T_STRING","EntityDefinitionTestTrait",26],";",["T_WHITESPACE","\n\n  ",26],["T_DOC_COMMENT","\/**\n   * The entity definition update manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDefinitionUpdateManagerInterface\n   *\/",28],["T_WHITESPACE","\n  ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$entityDefinitionUpdateManager",33],";",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",35],["T_WHITESPACE","\n  ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$database",40],";",["T_WHITESPACE","\n\n  ",40],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",42],["T_WHITESPACE","\n  ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","setUp",45],"(",")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n    ",45],["T_STRING","parent",46],["T_DOUBLE_COLON","::",46],["T_STRING","setUp",46],"(",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","entityDefinitionUpdateManager",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","container",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","get",47],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.definition_update_manager'",47],")",";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","database",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","container",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","get",48],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",48],")",";",["T_WHITESPACE","\n\n    ",48],["T_COMMENT","\/\/ Install every entity type's schema that wasn't installed in the parent\n",50],["T_WHITESPACE","    ",51],["T_COMMENT","\/\/ method.\n",51],["T_WHITESPACE","    ",52],["T_FOREACH","foreach",52],["T_WHITESPACE"," ",52],"(",["T_STRING","array_diff_key",52],"(",["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","entityManager",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getDefinitions",52],"(",")",",",["T_WHITESPACE"," ",52],["T_STRING","array_flip",52],"(",["T_ARRAY","array",52],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",52],",",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",52],")",")",")",["T_WHITESPACE"," ",52],["T_AS","as",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$entity_type_id",52],["T_WHITESPACE"," ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$entity_type",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n      ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","installEntitySchema",53],"(",["T_VARIABLE","$entity_type_id",53],")",";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n  ",54],"}",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * Tests that new entity type definitions are correctly handled.\n   *\/",57],["T_WHITESPACE","\n  ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","testNewEntityType",60],"(",")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$entity_type_id",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'entity_test_new'",61],";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$schema",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","database",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","schema",62],"(",")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Check that the \"entity_test_new\" is not defined.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$entity_types",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","entityManager",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getDefinitions",65],"(",")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertFalse",66],"(",["T_ISSET","isset",66],"(",["T_VARIABLE","$entity_types",66],"[",["T_VARIABLE","$entity_type_id",66],"]",")",",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'The \"entity_test_new\" entity type does not exist.'",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertFalse",67],"(",["T_VARIABLE","$schema",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","tableExists",67],"(",["T_VARIABLE","$entity_type_id",67],")",",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'Schema for the \"entity_test_new\" entity type does not exist.'",67],")",";",["T_WHITESPACE","\n\n    ",67],["T_COMMENT","\/\/ Check that the \"entity_test_new\" is now defined and the related schema\n",69],["T_WHITESPACE","    ",70],["T_COMMENT","\/\/ has been created.\n",70],["T_WHITESPACE","    ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","enableNewEntityType",71],"(",")",";",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$entity_types",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","entityManager",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getDefinitions",72],"(",")",";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertTrue",73],"(",["T_ISSET","isset",73],"(",["T_VARIABLE","$entity_types",73],"[",["T_VARIABLE","$entity_type_id",73],"]",")",",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'The \"entity_test_new\" entity type exists.'",73],")",";",["T_WHITESPACE","\n    ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","assertTrue",74],"(",["T_VARIABLE","$schema",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","tableExists",74],"(",["T_VARIABLE","$entity_type_id",74],")",",",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'Schema for the \"entity_test_new\" entity type has been created.'",74],")",";",["T_WHITESPACE","\n  ",74],"}",["T_WHITESPACE","\n\n  ",75],["T_DOC_COMMENT","\/**\n   * Tests when no definition update is needed.\n   *\/",77],["T_WHITESPACE","\n  ",79],["T_PUBLIC","public",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","testNoUpdates",80],"(",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n    ",80],["T_COMMENT","\/\/ Ensure that the definition update manager reports no updates.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertFalse",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","entityDefinitionUpdateManager",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","needsUpdates",82],"(",")",",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that no updates are needed.'",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertIdentical",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","entityDefinitionUpdateManager",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getChangeSummary",83],"(",")",",",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",")",",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports an empty change summary.'",83],")",";",["T_WHITESPACE","\n\n    ",83],["T_COMMENT","\/\/ Ensure that applyUpdates() runs without error (it's not expected to do\n",85],["T_WHITESPACE","    ",86],["T_COMMENT","\/\/ anything when there aren't updates).\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","entityDefinitionUpdateManager",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","applyUpdates",87],"(",")",";",["T_WHITESPACE","\n  ",87],"}",["T_WHITESPACE","\n\n  ",88],["T_DOC_COMMENT","\/**\n   * Tests updating entity schema when there are no existing entities.\n   *\/",90],["T_WHITESPACE","\n  ",92],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","testEntityTypeUpdateWithoutData",93],"(",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n    ",93],["T_COMMENT","\/\/ The 'entity_test_update' entity type starts out non-revisionable, so\n",94],["T_WHITESPACE","    ",95],["T_COMMENT","\/\/ ensure the revision table hasn't been created during setUp().\n",95],["T_WHITESPACE","    ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","assertFalse",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","database",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","schema",96],"(",")",["T_OBJECT_OPERATOR","->",96],["T_STRING","tableExists",96],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_revision'",96],")",",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'Revision table not created for entity_test_update.'",96],")",";",["T_WHITESPACE","\n\n    ",96],["T_COMMENT","\/\/ Update it to be revisionable and ensure the definition update manager\n",98],["T_WHITESPACE","    ",99],["T_COMMENT","\/\/ reports that an update is needed.\n",99],["T_WHITESPACE","    ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","updateEntityTypeToRevisionable",100],"(",")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","assertTrue",101],"(",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","entityDefinitionUpdateManager",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","needsUpdates",101],"(",")",",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",101],")",";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$expected",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_ARRAY","array",102],"(",["T_WHITESPACE","\n      ",102],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_WHITESPACE","\n        ",103],["T_STRING","t",104],"(",["T_CONSTANT_ENCAPSED_STRING","'The %entity_type entity type needs to be updated.'",104],",",["T_WHITESPACE"," ",104],"[",["T_CONSTANT_ENCAPSED_STRING","'%entity_type'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","entityManager",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getDefinition",104],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",104],")",["T_OBJECT_OPERATOR","->",104],["T_STRING","getLabel",104],"(",")","]",")",",",["T_WHITESPACE","\n      ",104],")",",",["T_WHITESPACE","\n    ",105],")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertEqual",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","entityDefinitionUpdateManager",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getChangeSummary",107],"(",")",",",["T_WHITESPACE"," ",107],["T_VARIABLE","$expected",107],")",";",["T_WHITESPACE"," ",107],["T_COMMENT","\/\/, 'EntityDefinitionUpdateManager reports the expected change summary.');\n",107],["T_WHITESPACE","\n    ",108],["T_COMMENT","\/\/ Run the update and ensure the revision table is created.\n",109],["T_WHITESPACE","    ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","entityDefinitionUpdateManager",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","applyUpdates",110],"(",")",";",["T_WHITESPACE","\n    ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","assertTrue",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","database",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","schema",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","tableExists",111],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_revision'",111],")",",",["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'Revision table created for entity_test_update.'",111],")",";",["T_WHITESPACE","\n  ",111],"}",["T_WHITESPACE","\n\n  ",112],["T_DOC_COMMENT","\/**\n   * Tests updating entity schema when there are existing entities.\n   *\/",114],["T_WHITESPACE","\n  ",116],["T_PUBLIC","public",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","testEntityTypeUpdateWithData",117],"(",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n    ",117],["T_COMMENT","\/\/ Save an entity.\n",118],["T_WHITESPACE","    ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","entityManager",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getStorage",119],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",119],")",["T_OBJECT_OPERATOR","->",119],["T_STRING","create",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","save",119],"(",")",";",["T_WHITESPACE","\n\n    ",119],["T_COMMENT","\/\/ Update the entity type to be revisionable and try to apply the update.\n",121],["T_WHITESPACE","    ",122],["T_COMMENT","\/\/ It's expected to throw an exception.\n",122],["T_WHITESPACE","    ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","updateEntityTypeToRevisionable",123],"(",")",";",["T_WHITESPACE","\n    ",123],["T_TRY","try",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n      ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","entityDefinitionUpdateManager",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","applyUpdates",125],"(",")",";",["T_WHITESPACE","\n      ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","fail",126],"(",["T_CONSTANT_ENCAPSED_STRING","'EntityStorageException thrown when trying to apply an update that requires data migration.'",126],")",";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n    ",127],["T_CATCH","catch",128],["T_WHITESPACE"," ",128],"(",["T_STRING","EntityStorageException",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$e",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n      ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","pass",129],"(",["T_CONSTANT_ENCAPSED_STRING","'EntityStorageException thrown when trying to apply an update that requires data migration.'",129],")",";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n  ",130],"}",["T_WHITESPACE","\n\n  ",131],["T_DOC_COMMENT","\/**\n   * Tests creating, updating, and deleting a base field if no entities exist.\n   *\/",133],["T_WHITESPACE","\n  ",135],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","testBaseFieldCreateUpdateDeleteWithoutData",136],"(",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n    ",136],["T_COMMENT","\/\/ Add a base field, ensure the update manager reports it, and the update\n",137],["T_WHITESPACE","    ",138],["T_COMMENT","\/\/ creates its schema.\n",138],["T_WHITESPACE","    ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","addBaseField",139],"(",")",";",["T_WHITESPACE","\n    ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","assertTrue",140],"(",["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","entityDefinitionUpdateManager",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","needsUpdates",140],"(",")",",",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",140],")",";",["T_WHITESPACE","\n    ",140],["T_VARIABLE","$expected",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_ARRAY","array",141],"(",["T_WHITESPACE","\n      ",141],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_ARRAY","array",142],"(",["T_WHITESPACE","\n        ",142],["T_STRING","t",143],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be installed.'",143],",",["T_WHITESPACE"," ",143],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_STRING","t",143],"(",["T_CONSTANT_ENCAPSED_STRING","'A new base field'",143],")","]",")",",",["T_WHITESPACE","\n      ",143],")",",",["T_WHITESPACE","\n    ",144],")",";",["T_WHITESPACE","\n    ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","assertEqual",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","entityDefinitionUpdateManager",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getChangeSummary",146],"(",")",",",["T_WHITESPACE"," ",146],["T_VARIABLE","$expected",146],",",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",146],")",";",["T_WHITESPACE","\n    ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","entityDefinitionUpdateManager",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","applyUpdates",147],"(",")",";",["T_WHITESPACE","\n    ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","assertTrue",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","database",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","schema",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","fieldExists",148],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",148],",",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",148],")",",",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'Column created in shared table for new_base_field.'",148],")",";",["T_WHITESPACE","\n\n    ",148],["T_COMMENT","\/\/ Add an index on the base field, ensure the update manager reports it,\n",150],["T_WHITESPACE","    ",151],["T_COMMENT","\/\/ and the update creates it.\n",151],["T_WHITESPACE","    ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","addBaseFieldIndex",152],"(",")",";",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","assertTrue",153],"(",["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","entityDefinitionUpdateManager",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","needsUpdates",153],"(",")",",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",153],")",";",["T_WHITESPACE","\n    ",153],["T_VARIABLE","$expected",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_ARRAY","array",154],"(",["T_WHITESPACE","\n      ",154],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",["T_WHITESPACE","\n        ",155],["T_STRING","t",156],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be updated.'",156],",",["T_WHITESPACE"," ",156],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_STRING","t",156],"(",["T_CONSTANT_ENCAPSED_STRING","'A new base field'",156],")","]",")",",",["T_WHITESPACE","\n      ",156],")",",",["T_WHITESPACE","\n    ",157],")",";",["T_WHITESPACE","\n    ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","assertEqual",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","entityDefinitionUpdateManager",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getChangeSummary",159],"(",")",",",["T_WHITESPACE"," ",159],["T_VARIABLE","$expected",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",159],")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","entityDefinitionUpdateManager",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","applyUpdates",160],"(",")",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertTrue",161],"(",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","database",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","schema",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","indexExists",161],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_field__new_base_field'",161],")",",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Index created.'",161],")",";",["T_WHITESPACE","\n\n    ",161],["T_COMMENT","\/\/ Remove the above index, ensure the update manager reports it, and the\n",163],["T_WHITESPACE","    ",164],["T_COMMENT","\/\/ update deletes it.\n",164],["T_WHITESPACE","    ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","removeBaseFieldIndex",165],"(",")",";",["T_WHITESPACE","\n    ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","assertTrue",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","entityDefinitionUpdateManager",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","needsUpdates",166],"(",")",",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",166],")",";",["T_WHITESPACE","\n    ",166],["T_VARIABLE","$expected",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",["T_WHITESPACE","\n      ",167],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",168],["T_WHITESPACE"," ",168],["T_DOUBLE_ARROW","=>",168],["T_WHITESPACE"," ",168],["T_ARRAY","array",168],"(",["T_WHITESPACE","\n        ",168],["T_STRING","t",169],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be updated.'",169],",",["T_WHITESPACE"," ",169],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_STRING","t",169],"(",["T_CONSTANT_ENCAPSED_STRING","'A new base field'",169],")","]",")",",",["T_WHITESPACE","\n      ",169],")",",",["T_WHITESPACE","\n    ",170],")",";",["T_WHITESPACE","\n    ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","assertEqual",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","entityDefinitionUpdateManager",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getChangeSummary",172],"(",")",",",["T_WHITESPACE"," ",172],["T_VARIABLE","$expected",172],",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",172],")",";",["T_WHITESPACE","\n    ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","entityDefinitionUpdateManager",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","applyUpdates",173],"(",")",";",["T_WHITESPACE","\n    ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","assertFalse",174],"(",["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","database",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","schema",174],"(",")",["T_OBJECT_OPERATOR","->",174],["T_STRING","indexExists",174],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",174],",",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_field__new_base_field'",174],")",",",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'Index deleted.'",174],")",";",["T_WHITESPACE","\n\n    ",174],["T_COMMENT","\/\/ Update the type of the base field from 'string' to 'text', ensure the\n",176],["T_WHITESPACE","    ",177],["T_COMMENT","\/\/ update manager reports it, and the update adjusts the schema\n",177],["T_WHITESPACE","    ",178],["T_COMMENT","\/\/ accordingly.\n",178],["T_WHITESPACE","    ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","modifyBaseField",179],"(",")",";",["T_WHITESPACE","\n    ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","assertTrue",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","entityDefinitionUpdateManager",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","needsUpdates",180],"(",")",",",["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",180],")",";",["T_WHITESPACE","\n    ",180],["T_VARIABLE","$expected",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_ARRAY","array",181],"(",["T_WHITESPACE","\n      ",181],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_ARRAY","array",182],"(",["T_WHITESPACE","\n        ",182],["T_STRING","t",183],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be updated.'",183],",",["T_WHITESPACE"," ",183],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",183],["T_WHITESPACE"," ",183],["T_DOUBLE_ARROW","=>",183],["T_WHITESPACE"," ",183],["T_STRING","t",183],"(",["T_CONSTANT_ENCAPSED_STRING","'A new base field'",183],")","]",")",",",["T_WHITESPACE","\n      ",183],")",",",["T_WHITESPACE","\n    ",184],")",";",["T_WHITESPACE","\n    ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","assertEqual",186],"(",["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","entityDefinitionUpdateManager",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getChangeSummary",186],"(",")",",",["T_WHITESPACE"," ",186],["T_VARIABLE","$expected",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",186],")",";",["T_WHITESPACE","\n    ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","entityDefinitionUpdateManager",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","applyUpdates",187],"(",")",";",["T_WHITESPACE","\n    ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","assertFalse",188],"(",["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","database",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","schema",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","fieldExists",188],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",188],")",",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'Original column deleted in shared table for new_base_field.'",188],")",";",["T_WHITESPACE","\n    ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","assertTrue",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","database",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","schema",189],"(",")",["T_OBJECT_OPERATOR","->",189],["T_STRING","fieldExists",189],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__value'",189],")",",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'Value column created in shared table for new_base_field.'",189],")",";",["T_WHITESPACE","\n    ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","assertTrue",190],"(",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","database",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","schema",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_STRING","fieldExists",190],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",190],",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__format'",190],")",",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","'Format column created in shared table for new_base_field.'",190],")",";",["T_WHITESPACE","\n\n    ",190],["T_COMMENT","\/\/ Remove the base field, ensure the update manager reports it, and the\n",192],["T_WHITESPACE","    ",193],["T_COMMENT","\/\/ update deletes the schema.\n",193],["T_WHITESPACE","    ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","removeBaseField",194],"(",")",";",["T_WHITESPACE","\n    ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","assertTrue",195],"(",["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","entityDefinitionUpdateManager",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","needsUpdates",195],"(",")",",",["T_WHITESPACE"," ",195],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",195],")",";",["T_WHITESPACE","\n    ",195],["T_VARIABLE","$expected",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_ARRAY","array",196],"(",["T_WHITESPACE","\n      ",196],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_ARRAY","array",197],"(",["T_WHITESPACE","\n        ",197],["T_STRING","t",198],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be uninstalled.'",198],",",["T_WHITESPACE"," ",198],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",198],["T_WHITESPACE"," ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_STRING","t",198],"(",["T_CONSTANT_ENCAPSED_STRING","'A new base field'",198],")","]",")",",",["T_WHITESPACE","\n      ",198],")",",",["T_WHITESPACE","\n    ",199],")",";",["T_WHITESPACE","\n    ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","assertEqual",201],"(",["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","entityDefinitionUpdateManager",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getChangeSummary",201],"(",")",",",["T_WHITESPACE"," ",201],["T_VARIABLE","$expected",201],",",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",201],")",";",["T_WHITESPACE","\n    ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","entityDefinitionUpdateManager",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","applyUpdates",202],"(",")",";",["T_WHITESPACE","\n    ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","assertFalse",203],"(",["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","database",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","schema",203],"(",")",["T_OBJECT_OPERATOR","->",203],["T_STRING","fieldExists",203],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",203],",",["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","'new_base_field_value'",203],")",",",["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","'Value column deleted from shared table for new_base_field.'",203],")",";",["T_WHITESPACE","\n    ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","assertFalse",204],"(",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","database",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","schema",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","fieldExists",204],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'new_base_field_format'",204],")",",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'Format column deleted from shared table for new_base_field.'",204],")",";",["T_WHITESPACE","\n  ",204],"}",["T_WHITESPACE","\n\n  ",205],["T_DOC_COMMENT","\/**\n   * Tests creating, updating, and deleting a bundle field if no entities exist.\n   *\/",207],["T_WHITESPACE","\n  ",209],["T_PUBLIC","public",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","testBundleFieldCreateUpdateDeleteWithoutData",210],"(",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n    ",210],["T_COMMENT","\/\/ Add a bundle field, ensure the update manager reports it, and the update\n",211],["T_WHITESPACE","    ",212],["T_COMMENT","\/\/ creates its schema.\n",212],["T_WHITESPACE","    ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","addBundleField",213],"(",")",";",["T_WHITESPACE","\n    ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","assertTrue",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","entityDefinitionUpdateManager",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","needsUpdates",214],"(",")",",",["T_WHITESPACE"," ",214],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",214],")",";",["T_WHITESPACE","\n    ",214],["T_VARIABLE","$expected",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_ARRAY","array",215],"(",["T_WHITESPACE","\n      ",215],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_ARRAY","array",216],"(",["T_WHITESPACE","\n        ",216],["T_STRING","t",217],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be installed.'",217],",",["T_WHITESPACE"," ",217],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_STRING","t",217],"(",["T_CONSTANT_ENCAPSED_STRING","'A new bundle field'",217],")","]",")",",",["T_WHITESPACE","\n      ",217],")",",",["T_WHITESPACE","\n    ",218],")",";",["T_WHITESPACE","\n    ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","assertEqual",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","entityDefinitionUpdateManager",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getChangeSummary",220],"(",")",",",["T_WHITESPACE"," ",220],["T_VARIABLE","$expected",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",220],")",";",["T_WHITESPACE","\n    ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","entityDefinitionUpdateManager",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","applyUpdates",221],"(",")",";",["T_WHITESPACE","\n    ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","assertTrue",222],"(",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","database",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","schema",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","tableExists",222],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",222],")",",",["T_WHITESPACE"," ",222],["T_CONSTANT_ENCAPSED_STRING","'Dedicated table created for new_bundle_field.'",222],")",";",["T_WHITESPACE","\n\n    ",222],["T_COMMENT","\/\/ Update the type of the base field from 'string' to 'text', ensure the\n",224],["T_WHITESPACE","    ",225],["T_COMMENT","\/\/ update manager reports it, and the update adjusts the schema\n",225],["T_WHITESPACE","    ",226],["T_COMMENT","\/\/ accordingly.\n",226],["T_WHITESPACE","    ",227],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","modifyBundleField",227],"(",")",";",["T_WHITESPACE","\n    ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","assertTrue",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","entityDefinitionUpdateManager",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","needsUpdates",228],"(",")",",",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",228],")",";",["T_WHITESPACE","\n    ",228],["T_VARIABLE","$expected",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_ARRAY","array",229],"(",["T_WHITESPACE","\n      ",229],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],"[",["T_WHITESPACE","\n        ",230],["T_STRING","t",231],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be updated.'",231],",",["T_WHITESPACE"," ",231],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_STRING","t",231],"(",["T_CONSTANT_ENCAPSED_STRING","'A new bundle field'",231],")","]",")",",",["T_WHITESPACE","\n      ",231],"]",",",["T_WHITESPACE","\n    ",232],")",";",["T_WHITESPACE","\n    ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","assertEqual",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","entityDefinitionUpdateManager",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getChangeSummary",234],"(",")",",",["T_WHITESPACE"," ",234],["T_VARIABLE","$expected",234],",",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",234],")",";",["T_WHITESPACE","\n    ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","entityDefinitionUpdateManager",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","applyUpdates",235],"(",")",";",["T_WHITESPACE","\n    ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","assertTrue",236],"(",["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","database",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","schema",236],"(",")",["T_OBJECT_OPERATOR","->",236],["T_STRING","fieldExists",236],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",236],",",["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'new_bundle_field_format'",236],")",",",["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'Format column created in dedicated table for new_base_field.'",236],")",";",["T_WHITESPACE","\n\n    ",236],["T_COMMENT","\/\/ Remove the bundle field, ensure the update manager reports it, and the\n",238],["T_WHITESPACE","    ",239],["T_COMMENT","\/\/ update deletes the schema.\n",239],["T_WHITESPACE","    ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","removeBundleField",240],"(",")",";",["T_WHITESPACE","\n    ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","assertTrue",241],"(",["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","entityDefinitionUpdateManager",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","needsUpdates",241],"(",")",",",["T_WHITESPACE"," ",241],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",241],")",";",["T_WHITESPACE","\n    ",241],["T_VARIABLE","$expected",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_WHITESPACE","\n      ",242],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_ARRAY","array",243],"(",["T_WHITESPACE","\n        ",243],["T_STRING","t",244],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be uninstalled.'",244],",",["T_WHITESPACE"," ",244],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",244],["T_WHITESPACE"," ",244],["T_DOUBLE_ARROW","=>",244],["T_WHITESPACE"," ",244],["T_STRING","t",244],"(",["T_CONSTANT_ENCAPSED_STRING","'A new bundle field'",244],")","]",")",",",["T_WHITESPACE","\n      ",244],")",",",["T_WHITESPACE","\n    ",245],")",";",["T_WHITESPACE","\n    ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","assertEqual",247],"(",["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","entityDefinitionUpdateManager",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getChangeSummary",247],"(",")",",",["T_WHITESPACE"," ",247],["T_VARIABLE","$expected",247],",",["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",247],")",";",["T_WHITESPACE","\n    ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","entityDefinitionUpdateManager",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","applyUpdates",248],"(",")",";",["T_WHITESPACE","\n    ",248],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","assertFalse",249],"(",["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","database",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","schema",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","tableExists",249],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",249],")",",",["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","'Dedicated table deleted for new_bundle_field.'",249],")",";",["T_WHITESPACE","\n  ",249],"}",["T_WHITESPACE","\n\n  ",250],["T_DOC_COMMENT","\/**\n   * Tests creating and deleting a base field if entities exist.\n   *\n   * This tests deletion when there are existing entities, but not existing data\n   * for the field being deleted.\n   *\n   * @see testBaseFieldDeleteWithExistingData()\n   *\/",252],["T_WHITESPACE","\n  ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","testBaseFieldCreateDeleteWithExistingEntities",260],"(",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n    ",260],["T_COMMENT","\/\/ Save an entity.\n",261],["T_WHITESPACE","    ",262],["T_VARIABLE","$name",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","randomString",262],"(",")",";",["T_WHITESPACE","\n    ",262],["T_VARIABLE","$storage",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","entityManager",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getStorage",263],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",263],")",";",["T_WHITESPACE","\n    ",263],["T_VARIABLE","$entity",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$storage",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","create",264],"(",["T_ARRAY","array",264],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",264],["T_WHITESPACE"," ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$name",264],")",")",";",["T_WHITESPACE","\n    ",264],["T_VARIABLE","$entity",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","save",265],"(",")",";",["T_WHITESPACE","\n\n    ",265],["T_COMMENT","\/\/ Add a base field and run the update. Ensure the base field's column is\n",267],["T_WHITESPACE","    ",268],["T_COMMENT","\/\/ created and the prior saved entity data is still there.\n",268],["T_WHITESPACE","    ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","addBaseField",269],"(",")",";",["T_WHITESPACE","\n    ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","entityDefinitionUpdateManager",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","applyUpdates",270],"(",")",";",["T_WHITESPACE","\n    ",270],["T_VARIABLE","$schema_handler",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","database",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","schema",271],"(",")",";",["T_WHITESPACE","\n    ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","assertTrue",272],"(",["T_VARIABLE","$schema_handler",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","fieldExists",272],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",272],",",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",272],")",",",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","'Column created in shared table for new_base_field.'",272],")",";",["T_WHITESPACE","\n    ",272],["T_VARIABLE","$entity",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","entityManager",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getStorage",273],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",273],")",["T_OBJECT_OPERATOR","->",273],["T_STRING","load",273],"(",["T_VARIABLE","$entity",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","id",273],"(",")",")",";",["T_WHITESPACE","\n    ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","assertIdentical",274],"(",["T_VARIABLE","$entity",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","name",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","value",274],",",["T_WHITESPACE"," ",274],["T_VARIABLE","$name",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'Entity data preserved during field creation.'",274],")",";",["T_WHITESPACE","\n\n    ",274],["T_COMMENT","\/\/ Remove the base field and run the update. Ensure the base field's column\n",276],["T_WHITESPACE","    ",277],["T_COMMENT","\/\/ is deleted and the prior saved entity data is still there.\n",277],["T_WHITESPACE","    ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","removeBaseField",278],"(",")",";",["T_WHITESPACE","\n    ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","entityDefinitionUpdateManager",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","applyUpdates",279],"(",")",";",["T_WHITESPACE","\n    ",279],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","assertFalse",280],"(",["T_VARIABLE","$schema_handler",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","fieldExists",280],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",280],",",["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",280],")",",",["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'Column deleted from shared table for new_base_field.'",280],")",";",["T_WHITESPACE","\n    ",280],["T_VARIABLE","$entity",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","entityManager",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getStorage",281],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",281],")",["T_OBJECT_OPERATOR","->",281],["T_STRING","load",281],"(",["T_VARIABLE","$entity",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","id",281],"(",")",")",";",["T_WHITESPACE","\n    ",281],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","assertIdentical",282],"(",["T_VARIABLE","$entity",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","name",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","value",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$name",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'Entity data preserved during field deletion.'",282],")",";",["T_WHITESPACE","\n\n    ",282],["T_COMMENT","\/\/ Add a base field with a required property and run the update. Ensure\n",284],["T_WHITESPACE","    ",285],["T_COMMENT","\/\/ 'not null' is not applied and thus no exception is thrown.\n",285],["T_WHITESPACE","    ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","addBaseField",286],"(",["T_CONSTANT_ENCAPSED_STRING","'shape_required'",286],")",";",["T_WHITESPACE","\n    ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","entityDefinitionUpdateManager",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","applyUpdates",287],"(",")",";",["T_WHITESPACE","\n    ",287],["T_VARIABLE","$assert",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$schema_handler",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","fieldExists",288],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",288],",",["T_WHITESPACE"," ",288],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__shape'",288],")",["T_WHITESPACE"," ",288],["T_BOOLEAN_AND","&&",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$schema_handler",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","fieldExists",288],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",288],",",["T_WHITESPACE"," ",288],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__color'",288],")",";",["T_WHITESPACE","\n    ",288],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","assertTrue",289],"(",["T_VARIABLE","$assert",289],",",["T_WHITESPACE"," ",289],["T_CONSTANT_ENCAPSED_STRING","'Columns created in shared table for new_base_field.'",289],")",";",["T_WHITESPACE","\n\n    ",289],["T_COMMENT","\/\/ Recreate the field after emptying the base table and check that its\n",291],["T_WHITESPACE","    ",292],["T_COMMENT","\/\/ columns are not 'not null'.\n",292],["T_WHITESPACE","    ",293],["T_COMMENT","\/\/ @todo Revisit this test when allowing for required storage field\n",293],["T_WHITESPACE","    ",294],["T_COMMENT","\/\/   definitions. See https:\/\/www.drupal.org\/node\/2390495.\n",294],["T_WHITESPACE","    ",295],["T_VARIABLE","$entity",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","delete",295],"(",")",";",["T_WHITESPACE","\n    ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","removeBaseField",296],"(",")",";",["T_WHITESPACE","\n    ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","entityDefinitionUpdateManager",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","applyUpdates",297],"(",")",";",["T_WHITESPACE","\n    ",297],["T_VARIABLE","$assert",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],"!",["T_VARIABLE","$schema_handler",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","fieldExists",298],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",298],",",["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__shape'",298],")",["T_WHITESPACE"," ",298],["T_BOOLEAN_AND","&&",298],["T_WHITESPACE"," ",298],"!",["T_VARIABLE","$schema_handler",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","fieldExists",298],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",298],",",["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__color'",298],")",";",["T_WHITESPACE","\n    ",298],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","assert",299],"(",["T_VARIABLE","$assert",299],",",["T_WHITESPACE"," ",299],["T_CONSTANT_ENCAPSED_STRING","'Columns removed from the shared table for new_base_field.'",299],")",";",["T_WHITESPACE","\n    ",299],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","addBaseField",300],"(",["T_CONSTANT_ENCAPSED_STRING","'shape_required'",300],")",";",["T_WHITESPACE","\n    ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","entityDefinitionUpdateManager",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","applyUpdates",301],"(",")",";",["T_WHITESPACE","\n    ",301],["T_VARIABLE","$assert",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$schema_handler",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","fieldExists",302],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",302],",",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__shape'",302],")",["T_WHITESPACE"," ",302],["T_BOOLEAN_AND","&&",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$schema_handler",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","fieldExists",302],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",302],",",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__color'",302],")",";",["T_WHITESPACE","\n    ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","assertTrue",303],"(",["T_VARIABLE","$assert",303],",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'Columns created again in shared table for new_base_field.'",303],")",";",["T_WHITESPACE","\n    ",303],["T_VARIABLE","$entity",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$storage",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","create",304],"(",["T_ARRAY","array",304],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",304],["T_WHITESPACE"," ",304],["T_DOUBLE_ARROW","=>",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$name",304],")",")",";",["T_WHITESPACE","\n    ",304],["T_VARIABLE","$entity",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","save",305],"(",")",";",["T_WHITESPACE","\n    ",305],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","pass",306],"(",["T_CONSTANT_ENCAPSED_STRING","'The new_base_field columns are still nullable'",306],")",";",["T_WHITESPACE","\n  ",306],"}",["T_WHITESPACE","\n\n  ",307],["T_DOC_COMMENT","\/**\n   * Tests creating and deleting a bundle field if entities exist.\n   *\n   * This tests deletion when there are existing entities, but not existing data\n   * for the field being deleted.\n   *\n   * @see testBundleFieldDeleteWithExistingData()\n   *\/",309],["T_WHITESPACE","\n  ",316],["T_PUBLIC","public",317],["T_WHITESPACE"," ",317],["T_FUNCTION","function",317],["T_WHITESPACE"," ",317],["T_STRING","testBundleFieldCreateDeleteWithExistingEntities",317],"(",")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n    ",317],["T_COMMENT","\/\/ Save an entity.\n",318],["T_WHITESPACE","    ",319],["T_VARIABLE","$name",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","randomString",319],"(",")",";",["T_WHITESPACE","\n    ",319],["T_VARIABLE","$storage",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","entityManager",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getStorage",320],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",320],")",";",["T_WHITESPACE","\n    ",320],["T_VARIABLE","$entity",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_VARIABLE","$storage",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","create",321],"(",["T_ARRAY","array",321],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",321],["T_WHITESPACE"," ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$name",321],")",")",";",["T_WHITESPACE","\n    ",321],["T_VARIABLE","$entity",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","save",322],"(",")",";",["T_WHITESPACE","\n\n    ",322],["T_COMMENT","\/\/ Add a bundle field and run the update. Ensure the bundle field's table\n",324],["T_WHITESPACE","    ",325],["T_COMMENT","\/\/ is created and the prior saved entity data is still there.\n",325],["T_WHITESPACE","    ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","addBundleField",326],"(",")",";",["T_WHITESPACE","\n    ",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","entityDefinitionUpdateManager",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","applyUpdates",327],"(",")",";",["T_WHITESPACE","\n    ",327],["T_VARIABLE","$schema_handler",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","database",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","schema",328],"(",")",";",["T_WHITESPACE","\n    ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","assertTrue",329],"(",["T_VARIABLE","$schema_handler",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","tableExists",329],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",329],")",",",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","'Dedicated table created for new_bundle_field.'",329],")",";",["T_WHITESPACE","\n    ",329],["T_VARIABLE","$entity",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","entityManager",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getStorage",330],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",330],")",["T_OBJECT_OPERATOR","->",330],["T_STRING","load",330],"(",["T_VARIABLE","$entity",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","id",330],"(",")",")",";",["T_WHITESPACE","\n    ",330],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","assertIdentical",331],"(",["T_VARIABLE","$entity",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","name",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","value",331],",",["T_WHITESPACE"," ",331],["T_VARIABLE","$name",331],",",["T_WHITESPACE"," ",331],["T_CONSTANT_ENCAPSED_STRING","'Entity data preserved during field creation.'",331],")",";",["T_WHITESPACE","\n\n    ",331],["T_COMMENT","\/\/ Remove the base field and run the update. Ensure the bundle field's\n",333],["T_WHITESPACE","    ",334],["T_COMMENT","\/\/ table is deleted and the prior saved entity data is still there.\n",334],["T_WHITESPACE","    ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","removeBundleField",335],"(",")",";",["T_WHITESPACE","\n    ",335],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","entityDefinitionUpdateManager",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","applyUpdates",336],"(",")",";",["T_WHITESPACE","\n    ",336],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","assertFalse",337],"(",["T_VARIABLE","$schema_handler",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","tableExists",337],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",337],")",",",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'Dedicated table deleted for new_bundle_field.'",337],")",";",["T_WHITESPACE","\n    ",337],["T_VARIABLE","$entity",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","entityManager",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getStorage",338],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",338],")",["T_OBJECT_OPERATOR","->",338],["T_STRING","load",338],"(",["T_VARIABLE","$entity",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","id",338],"(",")",")",";",["T_WHITESPACE","\n    ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","assertIdentical",339],"(",["T_VARIABLE","$entity",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","name",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","value",339],",",["T_WHITESPACE"," ",339],["T_VARIABLE","$name",339],",",["T_WHITESPACE"," ",339],["T_CONSTANT_ENCAPSED_STRING","'Entity data preserved during field deletion.'",339],")",";",["T_WHITESPACE","\n\n    ",339],["T_COMMENT","\/\/ Test that required columns are created as 'not null'.\n",341],["T_WHITESPACE","    ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","addBundleField",342],"(",["T_CONSTANT_ENCAPSED_STRING","'shape_required'",342],")",";",["T_WHITESPACE","\n    ",342],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","entityDefinitionUpdateManager",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","applyUpdates",343],"(",")",";",["T_WHITESPACE","\n    ",343],["T_VARIABLE","$message",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","'The new_bundle_field_shape column is not nullable.'",344],";",["T_WHITESPACE","\n    ",344],["T_VARIABLE","$values",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_ARRAY","array",345],"(",["T_WHITESPACE","\n      ",345],["T_CONSTANT_ENCAPSED_STRING","'bundle'",346],["T_WHITESPACE"," ",346],["T_DOUBLE_ARROW","=>",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$entity",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","bundle",346],"(",")",",",["T_WHITESPACE","\n      ",346],["T_CONSTANT_ENCAPSED_STRING","'deleted'",347],["T_WHITESPACE"," ",347],["T_DOUBLE_ARROW","=>",347],["T_WHITESPACE"," ",347],["T_LNUMBER","0",347],",",["T_WHITESPACE","\n      ",347],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$entity",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","id",348],"(",")",",",["T_WHITESPACE","\n      ",348],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$entity",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","id",349],"(",")",",",["T_WHITESPACE","\n      ",349],["T_CONSTANT_ENCAPSED_STRING","'langcode'",350],["T_WHITESPACE"," ",350],["T_DOUBLE_ARROW","=>",350],["T_WHITESPACE"," ",350],["T_STRING","LanguageInterface",350],["T_DOUBLE_COLON","::",350],["T_STRING","LANGCODE_NOT_SPECIFIED",350],",",["T_WHITESPACE","\n      ",350],["T_CONSTANT_ENCAPSED_STRING","'delta'",351],["T_WHITESPACE"," ",351],["T_DOUBLE_ARROW","=>",351],["T_WHITESPACE"," ",351],["T_LNUMBER","0",351],",",["T_WHITESPACE","\n      ",351],["T_CONSTANT_ENCAPSED_STRING","'new_bundle_field_color'",352],["T_WHITESPACE"," ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","randomString",352],"(",")",",",["T_WHITESPACE","\n    ",352],")",";",["T_WHITESPACE","\n    ",353],["T_TRY","try",354],["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n      ",354],["T_COMMENT","\/\/ Try to insert a record without providing a value for the 'not null'\n",355],["T_WHITESPACE","      ",356],["T_COMMENT","\/\/ column. This should fail.\n",356],["T_WHITESPACE","      ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","database",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","insert",357],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",357],")",["T_WHITESPACE","\n        ",357],["T_OBJECT_OPERATOR","->",358],["T_STRING","fields",358],"(",["T_VARIABLE","$values",358],")",["T_WHITESPACE","\n        ",358],["T_OBJECT_OPERATOR","->",359],["T_STRING","execute",359],"(",")",";",["T_WHITESPACE","\n      ",359],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","fail",360],"(",["T_VARIABLE","$message",360],")",";",["T_WHITESPACE","\n    ",360],"}",["T_WHITESPACE","\n    ",361],["T_CATCH","catch",362],["T_WHITESPACE"," ",362],"(",["T_NS_SEPARATOR","\\",362],["T_STRING","RuntimeException",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$e",362],")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n      ",362],["T_IF","if",363],["T_WHITESPACE"," ",363],"(",["T_VARIABLE","$e",363],["T_WHITESPACE"," ",363],["T_INSTANCEOF","instanceof",363],["T_WHITESPACE"," ",363],["T_STRING","DatabaseExceptionWrapper",363],["T_WHITESPACE"," ",363],["T_BOOLEAN_OR","||",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$e",363],["T_WHITESPACE"," ",363],["T_INSTANCEOF","instanceof",363],["T_WHITESPACE"," ",363],["T_STRING","IntegrityConstraintViolationException",363],")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n        ",363],["T_COMMENT","\/\/ Now provide a value for the 'not null' column. This is expected to\n",364],["T_WHITESPACE","        ",365],["T_COMMENT","\/\/ succeed.\n",365],["T_WHITESPACE","        ",366],["T_VARIABLE","$values",366],"[",["T_CONSTANT_ENCAPSED_STRING","'new_bundle_field_shape'",366],"]",["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","randomString",366],"(",")",";",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","database",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","insert",367],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_bundle_field'",367],")",["T_WHITESPACE","\n          ",367],["T_OBJECT_OPERATOR","->",368],["T_STRING","fields",368],"(",["T_VARIABLE","$values",368],")",["T_WHITESPACE","\n          ",368],["T_OBJECT_OPERATOR","->",369],["T_STRING","execute",369],"(",")",";",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","pass",370],"(",["T_VARIABLE","$message",370],")",";",["T_WHITESPACE","\n      ",370],"}",["T_WHITESPACE","\n      ",371],["T_ELSE","else",372],["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n        ",372],["T_COMMENT","\/\/ Keep throwing it.\n",373],["T_WHITESPACE","        ",374],["T_THROW","throw",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$e",374],";",["T_WHITESPACE","\n      ",374],"}",["T_WHITESPACE","\n    ",375],"}",["T_WHITESPACE","\n  ",376],"}",["T_WHITESPACE","\n\n  ",377],["T_DOC_COMMENT","\/**\n   * Tests deleting a base field when it has existing data.\n   *\/",379],["T_WHITESPACE","\n  ",381],["T_PUBLIC","public",382],["T_WHITESPACE"," ",382],["T_FUNCTION","function",382],["T_WHITESPACE"," ",382],["T_STRING","testBaseFieldDeleteWithExistingData",382],"(",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n    ",382],["T_COMMENT","\/\/ Add the base field and run the update.\n",383],["T_WHITESPACE","    ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","addBaseField",384],"(",")",";",["T_WHITESPACE","\n    ",384],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","entityDefinitionUpdateManager",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","applyUpdates",385],"(",")",";",["T_WHITESPACE","\n\n    ",385],["T_COMMENT","\/\/ Save an entity with the base field populated.\n",387],["T_WHITESPACE","    ",388],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","entityManager",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getStorage",388],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",388],")",["T_OBJECT_OPERATOR","->",388],["T_STRING","create",388],"(",["T_ARRAY","array",388],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",388],["T_WHITESPACE"," ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_CONSTANT_ENCAPSED_STRING","'foo'",388],")",")",["T_OBJECT_OPERATOR","->",388],["T_STRING","save",388],"(",")",";",["T_WHITESPACE","\n\n    ",388],["T_COMMENT","\/\/ Remove the base field and apply updates. It's expected to throw an\n",390],["T_WHITESPACE","    ",391],["T_COMMENT","\/\/ exception.\n",391],["T_WHITESPACE","    ",392],["T_COMMENT","\/\/ @todo Revisit that expectation once purging is implemented for\n",392],["T_WHITESPACE","    ",393],["T_COMMENT","\/\/   all fields: https:\/\/www.drupal.org\/node\/2282119.\n",393],["T_WHITESPACE","    ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","removeBaseField",394],"(",")",";",["T_WHITESPACE","\n    ",394],["T_TRY","try",395],["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n      ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","entityDefinitionUpdateManager",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","applyUpdates",396],"(",")",";",["T_WHITESPACE","\n      ",396],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","fail",397],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to apply an update that deletes a non-purgeable field with data.'",397],")",";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n    ",398],["T_CATCH","catch",399],["T_WHITESPACE"," ",399],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$e",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n      ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","pass",400],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to apply an update that deletes a non-purgeable field with data.'",400],")",";",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n  ",401],"}",["T_WHITESPACE","\n\n  ",402],["T_DOC_COMMENT","\/**\n   * Tests deleting a bundle field when it has existing data.\n   *\/",404],["T_WHITESPACE","\n  ",406],["T_PUBLIC","public",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","testBundleFieldDeleteWithExistingData",407],"(",")",["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n    ",407],["T_COMMENT","\/\/ Add the bundle field and run the update.\n",408],["T_WHITESPACE","    ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","addBundleField",409],"(",")",";",["T_WHITESPACE","\n    ",409],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","entityDefinitionUpdateManager",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","applyUpdates",410],"(",")",";",["T_WHITESPACE","\n\n    ",410],["T_COMMENT","\/\/ Save an entity with the bundle field populated.\n",412],["T_WHITESPACE","    ",413],["T_STRING","entity_test_create_bundle",413],"(",["T_CONSTANT_ENCAPSED_STRING","'custom'",413],")",";",["T_WHITESPACE","\n    ",413],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","entityManager",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getStorage",414],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",414],")",["T_OBJECT_OPERATOR","->",414],["T_STRING","create",414],"(",["T_ARRAY","array",414],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",414],["T_WHITESPACE"," ",414],["T_DOUBLE_ARROW","=>",414],["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'test_bundle'",414],",",["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'new_bundle_field'",414],["T_WHITESPACE"," ",414],["T_DOUBLE_ARROW","=>",414],["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'foo'",414],")",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","save",414],"(",")",";",["T_WHITESPACE","\n\n    ",414],["T_COMMENT","\/\/ Remove the bundle field and apply updates. It's expected to throw an\n",416],["T_WHITESPACE","    ",417],["T_COMMENT","\/\/ exception.\n",417],["T_WHITESPACE","    ",418],["T_COMMENT","\/\/ @todo Revisit that expectation once purging is implemented for\n",418],["T_WHITESPACE","    ",419],["T_COMMENT","\/\/   all fields: https:\/\/www.drupal.org\/node\/2282119.\n",419],["T_WHITESPACE","    ",420],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","removeBundleField",420],"(",")",";",["T_WHITESPACE","\n    ",420],["T_TRY","try",421],["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n      ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","entityDefinitionUpdateManager",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","applyUpdates",422],"(",")",";",["T_WHITESPACE","\n      ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","fail",423],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to apply an update that deletes a non-purgeable field with data.'",423],")",";",["T_WHITESPACE","\n    ",423],"}",["T_WHITESPACE","\n    ",424],["T_CATCH","catch",425],["T_WHITESPACE"," ",425],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$e",425],")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n      ",425],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","pass",426],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to apply an update that deletes a non-purgeable field with data.'",426],")",";",["T_WHITESPACE","\n    ",426],"}",["T_WHITESPACE","\n  ",427],"}",["T_WHITESPACE","\n\n  ",428],["T_DOC_COMMENT","\/**\n   * Tests updating a base field when it has existing data.\n   *\/",430],["T_WHITESPACE","\n  ",432],["T_PUBLIC","public",433],["T_WHITESPACE"," ",433],["T_FUNCTION","function",433],["T_WHITESPACE"," ",433],["T_STRING","testBaseFieldUpdateWithExistingData",433],"(",")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n    ",433],["T_COMMENT","\/\/ Add the base field and run the update.\n",434],["T_WHITESPACE","    ",435],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","addBaseField",435],"(",")",";",["T_WHITESPACE","\n    ",435],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","entityDefinitionUpdateManager",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","applyUpdates",436],"(",")",";",["T_WHITESPACE","\n\n    ",436],["T_COMMENT","\/\/ Save an entity with the base field populated.\n",438],["T_WHITESPACE","    ",439],["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","entityManager",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getStorage",439],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",439],")",["T_OBJECT_OPERATOR","->",439],["T_STRING","create",439],"(",["T_ARRAY","array",439],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",439],["T_WHITESPACE"," ",439],["T_DOUBLE_ARROW","=>",439],["T_WHITESPACE"," ",439],["T_CONSTANT_ENCAPSED_STRING","'foo'",439],")",")",["T_OBJECT_OPERATOR","->",439],["T_STRING","save",439],"(",")",";",["T_WHITESPACE","\n\n    ",439],["T_COMMENT","\/\/ Change the field's field type and apply updates. It's expected to\n",441],["T_WHITESPACE","    ",442],["T_COMMENT","\/\/ throw an exception.\n",442],["T_WHITESPACE","    ",443],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","modifyBaseField",443],"(",")",";",["T_WHITESPACE","\n    ",443],["T_TRY","try",444],["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n      ",444],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","entityDefinitionUpdateManager",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","applyUpdates",445],"(",")",";",["T_WHITESPACE","\n      ",445],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","fail",446],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to update a field schema that has data.'",446],")",";",["T_WHITESPACE","\n    ",446],"}",["T_WHITESPACE","\n    ",447],["T_CATCH","catch",448],["T_WHITESPACE"," ",448],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$e",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n      ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","pass",449],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to update a field schema that has data.'",449],")",";",["T_WHITESPACE","\n    ",449],"}",["T_WHITESPACE","\n  ",450],"}",["T_WHITESPACE","\n\n  ",451],["T_DOC_COMMENT","\/**\n   * Tests updating a bundle field when it has existing data.\n   *\/",453],["T_WHITESPACE","\n  ",455],["T_PUBLIC","public",456],["T_WHITESPACE"," ",456],["T_FUNCTION","function",456],["T_WHITESPACE"," ",456],["T_STRING","testBundleFieldUpdateWithExistingData",456],"(",")",["T_WHITESPACE"," ",456],"{",["T_WHITESPACE","\n    ",456],["T_COMMENT","\/\/ Add the bundle field and run the update.\n",457],["T_WHITESPACE","    ",458],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","addBundleField",458],"(",")",";",["T_WHITESPACE","\n    ",458],["T_VARIABLE","$this",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","entityDefinitionUpdateManager",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","applyUpdates",459],"(",")",";",["T_WHITESPACE","\n\n    ",459],["T_COMMENT","\/\/ Save an entity with the bundle field populated.\n",461],["T_WHITESPACE","    ",462],["T_STRING","entity_test_create_bundle",462],"(",["T_CONSTANT_ENCAPSED_STRING","'custom'",462],")",";",["T_WHITESPACE","\n    ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","entityManager",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getStorage",463],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",463],")",["T_OBJECT_OPERATOR","->",463],["T_STRING","create",463],"(",["T_ARRAY","array",463],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",463],["T_WHITESPACE"," ",463],["T_DOUBLE_ARROW","=>",463],["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","'test_bundle'",463],",",["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","'new_bundle_field'",463],["T_WHITESPACE"," ",463],["T_DOUBLE_ARROW","=>",463],["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","'foo'",463],")",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","save",463],"(",")",";",["T_WHITESPACE","\n\n    ",463],["T_COMMENT","\/\/ Change the field's field type and apply updates. It's expected to\n",465],["T_WHITESPACE","    ",466],["T_COMMENT","\/\/ throw an exception.\n",466],["T_WHITESPACE","    ",467],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","modifyBundleField",467],"(",")",";",["T_WHITESPACE","\n    ",467],["T_TRY","try",468],["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n      ",468],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","entityDefinitionUpdateManager",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","applyUpdates",469],"(",")",";",["T_WHITESPACE","\n      ",469],["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","fail",470],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to update a field schema that has data.'",470],")",";",["T_WHITESPACE","\n    ",470],"}",["T_WHITESPACE","\n    ",471],["T_CATCH","catch",472],["T_WHITESPACE"," ",472],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",472],["T_WHITESPACE"," ",472],["T_VARIABLE","$e",472],")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n      ",472],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","pass",473],"(",["T_CONSTANT_ENCAPSED_STRING","'FieldStorageDefinitionUpdateForbiddenException thrown when trying to update a field schema that has data.'",473],")",";",["T_WHITESPACE","\n    ",473],"}",["T_WHITESPACE","\n  ",474],"}",["T_WHITESPACE","\n\n  ",475],["T_DOC_COMMENT","\/**\n   * Tests creating and deleting a multi-field index when there are no existing entities.\n   *\/",477],["T_WHITESPACE","\n  ",479],["T_PUBLIC","public",480],["T_WHITESPACE"," ",480],["T_FUNCTION","function",480],["T_WHITESPACE"," ",480],["T_STRING","testEntityIndexCreateDeleteWithoutData",480],"(",")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n    ",480],["T_COMMENT","\/\/ Add an entity index and ensure the update manager reports that as an\n",481],["T_WHITESPACE","    ",482],["T_COMMENT","\/\/ update to the entity type.\n",482],["T_WHITESPACE","    ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","addEntityIndex",483],"(",")",";",["T_WHITESPACE","\n    ",483],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","assertTrue",484],"(",["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","entityDefinitionUpdateManager",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","needsUpdates",484],"(",")",",",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",484],")",";",["T_WHITESPACE","\n    ",484],["T_VARIABLE","$expected",485],["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_ARRAY","array",485],"(",["T_WHITESPACE","\n      ",485],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",486],["T_WHITESPACE"," ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],["T_ARRAY","array",486],"(",["T_WHITESPACE","\n        ",486],["T_STRING","t",487],"(",["T_CONSTANT_ENCAPSED_STRING","'The %entity_type entity type needs to be updated.'",487],",",["T_WHITESPACE"," ",487],"[",["T_CONSTANT_ENCAPSED_STRING","'%entity_type'",487],["T_WHITESPACE"," ",487],["T_DOUBLE_ARROW","=>",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","entityManager",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getDefinition",487],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",487],")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getLabel",487],"(",")","]",")",",",["T_WHITESPACE","\n      ",487],")",",",["T_WHITESPACE","\n    ",488],")",";",["T_WHITESPACE","\n    ",489],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","assertEqual",490],"(",["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","entityDefinitionUpdateManager",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getChangeSummary",490],"(",")",",",["T_WHITESPACE"," ",490],["T_VARIABLE","$expected",490],",",["T_WHITESPACE"," ",490],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",490],")",";",["T_WHITESPACE","\n\n    ",490],["T_COMMENT","\/\/ Run the update and ensure the new index is created.\n",492],["T_WHITESPACE","    ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","entityDefinitionUpdateManager",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","applyUpdates",493],"(",")",";",["T_WHITESPACE","\n    ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","assertTrue",494],"(",["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","database",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","schema",494],"(",")",["T_OBJECT_OPERATOR","->",494],["T_STRING","indexExists",494],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",494],",",["T_WHITESPACE"," ",494],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",494],")",",",["T_WHITESPACE"," ",494],["T_CONSTANT_ENCAPSED_STRING","'Index created.'",494],")",";",["T_WHITESPACE","\n\n    ",494],["T_COMMENT","\/\/ Remove the index and ensure the update manager reports that as an\n",496],["T_WHITESPACE","    ",497],["T_COMMENT","\/\/ update to the entity type.\n",497],["T_WHITESPACE","    ",498],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","removeEntityIndex",498],"(",")",";",["T_WHITESPACE","\n    ",498],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","assertTrue",499],"(",["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","entityDefinitionUpdateManager",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","needsUpdates",499],"(",")",",",["T_WHITESPACE"," ",499],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports that updates are needed.'",499],")",";",["T_WHITESPACE","\n    ",499],["T_VARIABLE","$expected",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_ARRAY","array",500],"(",["T_WHITESPACE","\n      ",500],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",501],["T_WHITESPACE"," ",501],["T_DOUBLE_ARROW","=>",501],["T_WHITESPACE"," ",501],["T_ARRAY","array",501],"(",["T_WHITESPACE","\n        ",501],["T_STRING","t",502],"(",["T_CONSTANT_ENCAPSED_STRING","'The %entity_type entity type needs to be updated.'",502],",",["T_WHITESPACE"," ",502],"[",["T_CONSTANT_ENCAPSED_STRING","'%entity_type'",502],["T_WHITESPACE"," ",502],["T_DOUBLE_ARROW","=>",502],["T_WHITESPACE"," ",502],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","entityManager",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getDefinition",502],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",502],")",["T_OBJECT_OPERATOR","->",502],["T_STRING","getLabel",502],"(",")","]",")",",",["T_WHITESPACE","\n      ",502],")",",",["T_WHITESPACE","\n    ",503],")",";",["T_WHITESPACE","\n    ",504],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","assertEqual",505],"(",["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","entityDefinitionUpdateManager",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getChangeSummary",505],"(",")",",",["T_WHITESPACE"," ",505],["T_VARIABLE","$expected",505],",",["T_WHITESPACE"," ",505],["T_CONSTANT_ENCAPSED_STRING","'EntityDefinitionUpdateManager reports the expected change summary.'",505],")",";",["T_WHITESPACE","\n\n    ",505],["T_COMMENT","\/\/ Run the update and ensure the index is deleted.\n",507],["T_WHITESPACE","    ",508],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","entityDefinitionUpdateManager",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","applyUpdates",508],"(",")",";",["T_WHITESPACE","\n    ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","assertFalse",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","database",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","schema",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","indexExists",509],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",509],",",["T_WHITESPACE"," ",509],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",509],")",",",["T_WHITESPACE"," ",509],["T_CONSTANT_ENCAPSED_STRING","'Index deleted.'",509],")",";",["T_WHITESPACE","\n\n    ",509],["T_COMMENT","\/\/ Test that composite indexes are handled correctly when dropping and\n",511],["T_WHITESPACE","    ",512],["T_COMMENT","\/\/ re-creating one of their columns.\n",512],["T_WHITESPACE","    ",513],["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","addEntityIndex",513],"(",")",";",["T_WHITESPACE","\n    ",513],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","entityDefinitionUpdateManager",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","applyUpdates",514],"(",")",";",["T_WHITESPACE","\n    ",514],["T_VARIABLE","$storage_definition",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","entityDefinitionUpdateManager",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getFieldStorageDefinition",515],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",515],",",["T_WHITESPACE"," ",515],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",515],")",";",["T_WHITESPACE","\n    ",515],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","entityDefinitionUpdateManager",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","updateFieldStorageDefinition",516],"(",["T_VARIABLE","$storage_definition",516],")",";",["T_WHITESPACE","\n    ",516],["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","assertTrue",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","database",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","schema",517],"(",")",["T_OBJECT_OPERATOR","->",517],["T_STRING","indexExists",517],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",517],",",["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",517],")",",",["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'Index created.'",517],")",";",["T_WHITESPACE","\n    ",517],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","entityDefinitionUpdateManager",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","uninstallFieldStorageDefinition",518],"(",["T_VARIABLE","$storage_definition",518],")",";",["T_WHITESPACE","\n    ",518],["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","assertFalse",519],"(",["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","database",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","schema",519],"(",")",["T_OBJECT_OPERATOR","->",519],["T_STRING","indexExists",519],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",519],",",["T_WHITESPACE"," ",519],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",519],")",",",["T_WHITESPACE"," ",519],["T_CONSTANT_ENCAPSED_STRING","'Index deleted.'",519],")",";",["T_WHITESPACE","\n    ",519],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","entityDefinitionUpdateManager",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","installFieldStorageDefinition",520],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",520],",",["T_WHITESPACE"," ",520],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",520],",",["T_WHITESPACE"," ",520],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",520],",",["T_WHITESPACE"," ",520],["T_VARIABLE","$storage_definition",520],")",";",["T_WHITESPACE","\n    ",520],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","assertTrue",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","database",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","schema",521],"(",")",["T_OBJECT_OPERATOR","->",521],["T_STRING","indexExists",521],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",521],",",["T_WHITESPACE"," ",521],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",521],")",",",["T_WHITESPACE"," ",521],["T_CONSTANT_ENCAPSED_STRING","'Index created again.'",521],")",";",["T_WHITESPACE","\n  ",521],"}",["T_WHITESPACE","\n\n  ",522],["T_DOC_COMMENT","\/**\n   * Tests creating a multi-field index when there are existing entities.\n   *\/",524],["T_WHITESPACE","\n  ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","testEntityIndexCreateWithData",527],"(",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n    ",527],["T_COMMENT","\/\/ Save an entity.\n",528],["T_WHITESPACE","    ",529],["T_VARIABLE","$name",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","randomString",529],"(",")",";",["T_WHITESPACE","\n    ",529],["T_VARIABLE","$entity",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","entityManager",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getStorage",530],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",530],")",["T_OBJECT_OPERATOR","->",530],["T_STRING","create",530],"(",["T_ARRAY","array",530],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",530],["T_WHITESPACE"," ",530],["T_DOUBLE_ARROW","=>",530],["T_WHITESPACE"," ",530],["T_VARIABLE","$name",530],")",")",";",["T_WHITESPACE","\n    ",530],["T_VARIABLE","$entity",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","save",531],"(",")",";",["T_WHITESPACE","\n\n    ",531],["T_COMMENT","\/\/ Add an entity index, run the update. Ensure that the index is created\n",533],["T_WHITESPACE","    ",534],["T_COMMENT","\/\/ despite having data.\n",534],["T_WHITESPACE","    ",535],["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","addEntityIndex",535],"(",")",";",["T_WHITESPACE","\n    ",535],["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","entityDefinitionUpdateManager",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","applyUpdates",536],"(",")",";",["T_WHITESPACE","\n    ",536],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","assertTrue",537],"(",["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","database",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","schema",537],"(",")",["T_OBJECT_OPERATOR","->",537],["T_STRING","indexExists",537],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",537],",",["T_WHITESPACE"," ",537],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__new_index'",537],")",",",["T_WHITESPACE"," ",537],["T_CONSTANT_ENCAPSED_STRING","'Index added.'",537],")",";",["T_WHITESPACE","\n  ",537],"}",["T_WHITESPACE","\n\n  ",538],["T_DOC_COMMENT","\/**\n   * Tests entity type and field storage definition events.\n   *\/",540],["T_WHITESPACE","\n  ",542],["T_PUBLIC","public",543],["T_WHITESPACE"," ",543],["T_FUNCTION","function",543],["T_WHITESPACE"," ",543],["T_STRING","testDefinitionEvents",543],"(",")",["T_WHITESPACE"," ",543],"{",["T_WHITESPACE","\n    ",543],["T_DOC_COMMENT","\/** @var \\Drupal\\entity_test\\EntityTestDefinitionSubscriber $event_subscriber *\/",544],["T_WHITESPACE","\n    ",544],["T_VARIABLE","$event_subscriber",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","container",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","get",545],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test.definition.subscriber'",545],")",";",["T_WHITESPACE","\n    ",545],["T_VARIABLE","$event_subscriber",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","enableEventTracking",546],"(",")",";",["T_WHITESPACE","\n\n    ",546],["T_COMMENT","\/\/ Test field storage definition events.\n",548],["T_WHITESPACE","    ",549],["T_VARIABLE","$storage_definition",549],["T_WHITESPACE"," ",549],"=",["T_WHITESPACE"," ",549],["T_STRING","current",549],"(",["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","entityManager",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getFieldStorageDefinitions",549],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",549],")",")",";",["T_WHITESPACE","\n    ",549],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","assertFalse",550],"(",["T_VARIABLE","$event_subscriber",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","hasEventFired",550],"(",["T_STRING","FieldStorageDefinitionEvents",550],["T_DOUBLE_COLON","::",550],["T_STRING","DELETE",550],")",",",["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'Entity type delete was not dispatched yet.'",550],")",";",["T_WHITESPACE","\n    ",550],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","entityManager",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","onFieldStorageDefinitionDelete",551],"(",["T_VARIABLE","$storage_definition",551],")",";",["T_WHITESPACE","\n    ",551],["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","assertTrue",552],"(",["T_VARIABLE","$event_subscriber",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","hasEventFired",552],"(",["T_STRING","FieldStorageDefinitionEvents",552],["T_DOUBLE_COLON","::",552],["T_STRING","DELETE",552],")",",",["T_WHITESPACE"," ",552],["T_CONSTANT_ENCAPSED_STRING","'Entity type delete event successfully dispatched.'",552],")",";",["T_WHITESPACE","\n    ",552],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","assertFalse",553],"(",["T_VARIABLE","$event_subscriber",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","hasEventFired",553],"(",["T_STRING","FieldStorageDefinitionEvents",553],["T_DOUBLE_COLON","::",553],["T_STRING","CREATE",553],")",",",["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'Entity type create was not dispatched yet.'",553],")",";",["T_WHITESPACE","\n    ",553],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","entityManager",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","onFieldStorageDefinitionCreate",554],"(",["T_VARIABLE","$storage_definition",554],")",";",["T_WHITESPACE","\n    ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","assertTrue",555],"(",["T_VARIABLE","$event_subscriber",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","hasEventFired",555],"(",["T_STRING","FieldStorageDefinitionEvents",555],["T_DOUBLE_COLON","::",555],["T_STRING","CREATE",555],")",",",["T_WHITESPACE"," ",555],["T_CONSTANT_ENCAPSED_STRING","'Entity type create event successfully dispatched.'",555],")",";",["T_WHITESPACE","\n    ",555],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","assertFalse",556],"(",["T_VARIABLE","$event_subscriber",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","hasEventFired",556],"(",["T_STRING","FieldStorageDefinitionEvents",556],["T_DOUBLE_COLON","::",556],["T_STRING","UPDATE",556],")",",",["T_WHITESPACE"," ",556],["T_CONSTANT_ENCAPSED_STRING","'Entity type update was not dispatched yet.'",556],")",";",["T_WHITESPACE","\n    ",556],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","entityManager",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","onFieldStorageDefinitionUpdate",557],"(",["T_VARIABLE","$storage_definition",557],",",["T_WHITESPACE"," ",557],["T_VARIABLE","$storage_definition",557],")",";",["T_WHITESPACE","\n    ",557],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","assertTrue",558],"(",["T_VARIABLE","$event_subscriber",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","hasEventFired",558],"(",["T_STRING","FieldStorageDefinitionEvents",558],["T_DOUBLE_COLON","::",558],["T_STRING","UPDATE",558],")",",",["T_WHITESPACE"," ",558],["T_CONSTANT_ENCAPSED_STRING","'Entity type update event successfully dispatched.'",558],")",";",["T_WHITESPACE","\n\n    ",558],["T_COMMENT","\/\/ Test entity type events.\n",560],["T_WHITESPACE","    ",561],["T_VARIABLE","$entity_type",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_VARIABLE","$this",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","entityManager",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","getDefinition",561],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",561],")",";",["T_WHITESPACE","\n    ",561],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","assertFalse",562],"(",["T_VARIABLE","$event_subscriber",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","hasEventFired",562],"(",["T_STRING","EntityTypeEvents",562],["T_DOUBLE_COLON","::",562],["T_STRING","CREATE",562],")",",",["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'Entity type create was not dispatched yet.'",562],")",";",["T_WHITESPACE","\n    ",562],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","entityManager",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","onEntityTypeCreate",563],"(",["T_VARIABLE","$entity_type",563],")",";",["T_WHITESPACE","\n    ",563],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","assertTrue",564],"(",["T_VARIABLE","$event_subscriber",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","hasEventFired",564],"(",["T_STRING","EntityTypeEvents",564],["T_DOUBLE_COLON","::",564],["T_STRING","CREATE",564],")",",",["T_WHITESPACE"," ",564],["T_CONSTANT_ENCAPSED_STRING","'Entity type create event successfully dispatched.'",564],")",";",["T_WHITESPACE","\n    ",564],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","assertFalse",565],"(",["T_VARIABLE","$event_subscriber",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","hasEventFired",565],"(",["T_STRING","EntityTypeEvents",565],["T_DOUBLE_COLON","::",565],["T_STRING","UPDATE",565],")",",",["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'Entity type update was not dispatched yet.'",565],")",";",["T_WHITESPACE","\n    ",565],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","entityManager",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","onEntityTypeUpdate",566],"(",["T_VARIABLE","$entity_type",566],",",["T_WHITESPACE"," ",566],["T_VARIABLE","$entity_type",566],")",";",["T_WHITESPACE","\n    ",566],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","assertTrue",567],"(",["T_VARIABLE","$event_subscriber",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","hasEventFired",567],"(",["T_STRING","EntityTypeEvents",567],["T_DOUBLE_COLON","::",567],["T_STRING","UPDATE",567],")",",",["T_WHITESPACE"," ",567],["T_CONSTANT_ENCAPSED_STRING","'Entity type update event successfully dispatched.'",567],")",";",["T_WHITESPACE","\n    ",567],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","assertFalse",568],"(",["T_VARIABLE","$event_subscriber",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","hasEventFired",568],"(",["T_STRING","EntityTypeEvents",568],["T_DOUBLE_COLON","::",568],["T_STRING","DELETE",568],")",",",["T_WHITESPACE"," ",568],["T_CONSTANT_ENCAPSED_STRING","'Entity type delete was not dispatched yet.'",568],")",";",["T_WHITESPACE","\n    ",568],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","entityManager",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","onEntityTypeDelete",569],"(",["T_VARIABLE","$entity_type",569],")",";",["T_WHITESPACE","\n    ",569],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","assertTrue",570],"(",["T_VARIABLE","$event_subscriber",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","hasEventFired",570],"(",["T_STRING","EntityTypeEvents",570],["T_DOUBLE_COLON","::",570],["T_STRING","DELETE",570],")",",",["T_WHITESPACE"," ",570],["T_CONSTANT_ENCAPSED_STRING","'Entity type delete event successfully dispatched.'",570],")",";",["T_WHITESPACE","\n  ",570],"}",["T_WHITESPACE","\n\n  ",571],["T_DOC_COMMENT","\/**\n   * Tests updating entity schema and creating a base field.\n   *\n   * This tests updating entity schema and creating a base field at the same\n   * time when there are no existing entities.\n   *\/",573],["T_WHITESPACE","\n  ",578],["T_PUBLIC","public",579],["T_WHITESPACE"," ",579],["T_FUNCTION","function",579],["T_WHITESPACE"," ",579],["T_STRING","testEntityTypeSchemaUpdateAndBaseFieldCreateWithoutData",579],"(",")",["T_WHITESPACE"," ",579],"{",["T_WHITESPACE","\n    ",579],["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","updateEntityTypeToRevisionable",580],"(",")",";",["T_WHITESPACE","\n    ",580],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","addBaseField",581],"(",")",";",["T_WHITESPACE","\n    ",581],["T_VARIABLE","$message",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_CONSTANT_ENCAPSED_STRING","'Successfully updated entity schema and created base field at the same time.'",582],";",["T_WHITESPACE","\n    ",582],["T_COMMENT","\/\/ Entity type updates create base fields as well, thus make sure doing both\n",583],["T_WHITESPACE","    ",584],["T_COMMENT","\/\/ at the same time does not lead to errors due to the base field being\n",584],["T_WHITESPACE","    ",585],["T_COMMENT","\/\/ created twice.\n",585],["T_WHITESPACE","    ",586],["T_TRY","try",586],["T_WHITESPACE"," ",586],"{",["T_WHITESPACE","\n      ",586],["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","entityDefinitionUpdateManager",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","applyUpdates",587],"(",")",";",["T_WHITESPACE","\n      ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","pass",588],"(",["T_VARIABLE","$message",588],")",";",["T_WHITESPACE","\n    ",588],"}",["T_WHITESPACE","\n    ",589],["T_CATCH","catch",590],["T_WHITESPACE"," ",590],"(",["T_NS_SEPARATOR","\\",590],["T_STRING","Exception",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$e",590],")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n      ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","fail",591],"(",["T_VARIABLE","$message",591],")",";",["T_WHITESPACE","\n      ",591],["T_THROW","throw",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$e",592],";",["T_WHITESPACE","\n    ",592],"}",["T_WHITESPACE","\n  ",593],"}",["T_WHITESPACE","\n\n  ",594],["T_DOC_COMMENT","\/**\n   * Tests updating entity schema and creating a revisionable base field.\n   *\n   * This tests updating entity schema and creating a revisionable base field\n   * at the same time when there are no existing entities.\n   *\/",596],["T_WHITESPACE","\n  ",601],["T_PUBLIC","public",602],["T_WHITESPACE"," ",602],["T_FUNCTION","function",602],["T_WHITESPACE"," ",602],["T_STRING","testEntityTypeSchemaUpdateAndRevisionableBaseFieldCreateWithoutData",602],"(",")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n    ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","updateEntityTypeToRevisionable",603],"(",")",";",["T_WHITESPACE","\n    ",603],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","addRevisionableBaseField",604],"(",")",";",["T_WHITESPACE","\n    ",604],["T_VARIABLE","$message",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","'Successfully updated entity schema and created revisionable base field at the same time.'",605],";",["T_WHITESPACE","\n    ",605],["T_COMMENT","\/\/ Entity type updates create base fields as well, thus make sure doing both\n",606],["T_WHITESPACE","    ",607],["T_COMMENT","\/\/ at the same time does not lead to errors due to the base field being\n",607],["T_WHITESPACE","    ",608],["T_COMMENT","\/\/ created twice.\n",608],["T_WHITESPACE","    ",609],["T_TRY","try",609],["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n      ",609],["T_VARIABLE","$this",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","entityDefinitionUpdateManager",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","applyUpdates",610],"(",")",";",["T_WHITESPACE","\n      ",610],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","pass",611],"(",["T_VARIABLE","$message",611],")",";",["T_WHITESPACE","\n    ",611],"}",["T_WHITESPACE","\n    ",612],["T_CATCH","catch",613],["T_WHITESPACE"," ",613],"(",["T_NS_SEPARATOR","\\",613],["T_STRING","Exception",613],["T_WHITESPACE"," ",613],["T_VARIABLE","$e",613],")",["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n      ",613],["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","fail",614],"(",["T_VARIABLE","$message",614],")",";",["T_WHITESPACE","\n      ",614],["T_THROW","throw",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$e",615],";",["T_WHITESPACE","\n    ",615],"}",["T_WHITESPACE","\n  ",616],"}",["T_WHITESPACE","\n\n  ",617],["T_DOC_COMMENT","\/**\n   * Tests applying single updates.\n   *\/",619],["T_WHITESPACE","\n  ",621],["T_PUBLIC","public",622],["T_WHITESPACE"," ",622],["T_FUNCTION","function",622],["T_WHITESPACE"," ",622],["T_STRING","testSingleActionCalls",622],"(",")",["T_WHITESPACE"," ",622],"{",["T_WHITESPACE","\n    ",622],["T_VARIABLE","$db_schema",623],["T_WHITESPACE"," ",623],"=",["T_WHITESPACE"," ",623],["T_VARIABLE","$this",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","database",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","schema",623],"(",")",";",["T_WHITESPACE","\n\n    ",623],["T_COMMENT","\/\/ Ensure that a non-existing entity type cannot be installed.\n",625],["T_WHITESPACE","    ",626],["T_VARIABLE","$message",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_CONSTANT_ENCAPSED_STRING","'A non-existing entity type cannot be installed'",626],";",["T_WHITESPACE","\n    ",626],["T_TRY","try",627],["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n      ",627],["T_VARIABLE","$this",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","entityDefinitionUpdateManager",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","installEntityType",628],"(",["T_NEW","new",628],["T_WHITESPACE"," ",628],["T_STRING","ContentEntityType",628],"(","[",["T_CONSTANT_ENCAPSED_STRING","'id'",628],["T_WHITESPACE"," ",628],["T_DOUBLE_ARROW","=>",628],["T_WHITESPACE"," ",628],["T_CONSTANT_ENCAPSED_STRING","'foo'",628],"]",")",")",";",["T_WHITESPACE","\n      ",628],["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","fail",629],"(",["T_VARIABLE","$message",629],")",";",["T_WHITESPACE","\n    ",629],"}",["T_WHITESPACE","\n    ",630],["T_CATCH","catch",631],["T_WHITESPACE"," ",631],"(",["T_STRING","PluginNotFoundException",631],["T_WHITESPACE"," ",631],["T_VARIABLE","$e",631],")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n      ",631],["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","pass",632],"(",["T_VARIABLE","$message",632],")",";",["T_WHITESPACE","\n    ",632],"}",["T_WHITESPACE","\n\n    ",633],["T_COMMENT","\/\/ Ensure that a field cannot be installed on non-existing entity type.\n",635],["T_WHITESPACE","    ",636],["T_VARIABLE","$message",636],["T_WHITESPACE"," ",636],"=",["T_WHITESPACE"," ",636],["T_CONSTANT_ENCAPSED_STRING","'A field cannot be installed on a non-existing entity type'",636],";",["T_WHITESPACE","\n    ",636],["T_TRY","try",637],["T_WHITESPACE"," ",637],"{",["T_WHITESPACE","\n      ",637],["T_VARIABLE","$storage_definition",638],["T_WHITESPACE"," ",638],"=",["T_WHITESPACE"," ",638],["T_STRING","BaseFieldDefinition",638],["T_DOUBLE_COLON","::",638],["T_STRING","create",638],"(",["T_CONSTANT_ENCAPSED_STRING","'string'",638],")",["T_WHITESPACE","\n        ",638],["T_OBJECT_OPERATOR","->",639],["T_STRING","setLabel",639],"(",["T_STRING","t",639],"(",["T_CONSTANT_ENCAPSED_STRING","'A new revisionable base field'",639],")",")",["T_WHITESPACE","\n        ",639],["T_OBJECT_OPERATOR","->",640],["T_STRING","setRevisionable",640],"(",["T_STRING","TRUE",640],")",";",["T_WHITESPACE","\n      ",640],["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","entityDefinitionUpdateManager",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","installFieldStorageDefinition",641],"(",["T_CONSTANT_ENCAPSED_STRING","'bar'",641],",",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'foo'",641],",",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$storage_definition",641],")",";",["T_WHITESPACE","\n      ",641],["T_VARIABLE","$this",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","fail",642],"(",["T_VARIABLE","$message",642],")",";",["T_WHITESPACE","\n    ",642],"}",["T_WHITESPACE","\n    ",643],["T_CATCH","catch",644],["T_WHITESPACE"," ",644],"(",["T_STRING","PluginNotFoundException",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$e",644],")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n      ",644],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","pass",645],"(",["T_VARIABLE","$message",645],")",";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n\n    ",646],["T_COMMENT","\/\/ Ensure that a non-existing field cannot be installed.\n",648],["T_WHITESPACE","    ",649],["T_VARIABLE","$storage_definition",649],["T_WHITESPACE"," ",649],"=",["T_WHITESPACE"," ",649],["T_STRING","BaseFieldDefinition",649],["T_DOUBLE_COLON","::",649],["T_STRING","create",649],"(",["T_CONSTANT_ENCAPSED_STRING","'string'",649],")",["T_WHITESPACE","\n      ",649],["T_OBJECT_OPERATOR","->",650],["T_STRING","setLabel",650],"(",["T_STRING","t",650],"(",["T_CONSTANT_ENCAPSED_STRING","'A new revisionable base field'",650],")",")",["T_WHITESPACE","\n      ",650],["T_OBJECT_OPERATOR","->",651],["T_STRING","setRevisionable",651],"(",["T_STRING","TRUE",651],")",";",["T_WHITESPACE","\n    ",651],["T_VARIABLE","$this",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","entityDefinitionUpdateManager",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","installFieldStorageDefinition",652],"(",["T_CONSTANT_ENCAPSED_STRING","'bar'",652],",",["T_WHITESPACE"," ",652],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",652],",",["T_WHITESPACE"," ",652],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",652],",",["T_WHITESPACE"," ",652],["T_VARIABLE","$storage_definition",652],")",";",["T_WHITESPACE","\n    ",652],["T_VARIABLE","$this",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","assertFalse",653],"(",["T_VARIABLE","$db_schema",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","fieldExists",653],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",653],",",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","'bar'",653],")",",",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","\"A non-existing field cannot be installed.\"",653],")",";",["T_WHITESPACE","\n\n    ",653],["T_COMMENT","\/\/ Ensure that installing an existing entity type is a no-op.\n",655],["T_WHITESPACE","    ",656],["T_VARIABLE","$entity_type",656],["T_WHITESPACE"," ",656],"=",["T_WHITESPACE"," ",656],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","entityDefinitionUpdateManager",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getEntityType",656],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",656],")",";",["T_WHITESPACE","\n    ",656],["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","entityDefinitionUpdateManager",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","installEntityType",657],"(",["T_VARIABLE","$entity_type",657],")",";",["T_WHITESPACE","\n    ",657],["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","assertTrue",658],"(",["T_VARIABLE","$db_schema",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","tableExists",658],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",658],")",",",["T_WHITESPACE"," ",658],["T_CONSTANT_ENCAPSED_STRING","'Installing an existing entity type is a no-op'",658],")",";",["T_WHITESPACE","\n\n    ",658],["T_COMMENT","\/\/ Create a new base field.\n",660],["T_WHITESPACE","    ",661],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","addRevisionableBaseField",661],"(",")",";",["T_WHITESPACE","\n    ",661],["T_VARIABLE","$storage_definition",662],["T_WHITESPACE"," ",662],"=",["T_WHITESPACE"," ",662],["T_STRING","BaseFieldDefinition",662],["T_DOUBLE_COLON","::",662],["T_STRING","create",662],"(",["T_CONSTANT_ENCAPSED_STRING","'string'",662],")",["T_WHITESPACE","\n      ",662],["T_OBJECT_OPERATOR","->",663],["T_STRING","setLabel",663],"(",["T_STRING","t",663],"(",["T_CONSTANT_ENCAPSED_STRING","'A new revisionable base field'",663],")",")",["T_WHITESPACE","\n      ",663],["T_OBJECT_OPERATOR","->",664],["T_STRING","setRevisionable",664],"(",["T_STRING","TRUE",664],")",";",["T_WHITESPACE","\n    ",664],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","assertFalse",665],"(",["T_VARIABLE","$db_schema",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","fieldExists",665],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",665],",",["T_WHITESPACE"," ",665],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",665],")",",",["T_WHITESPACE"," ",665],["T_CONSTANT_ENCAPSED_STRING","\"New field 'new_base_field' does not exist before applying the update.\"",665],")",";",["T_WHITESPACE","\n    ",665],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","entityDefinitionUpdateManager",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","installFieldStorageDefinition",666],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",666],",",["T_WHITESPACE"," ",666],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",666],",",["T_WHITESPACE"," ",666],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",666],",",["T_WHITESPACE"," ",666],["T_VARIABLE","$storage_definition",666],")",";",["T_WHITESPACE","\n    ",666],["T_VARIABLE","$this",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","assertTrue",667],"(",["T_VARIABLE","$db_schema",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","fieldExists",667],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",667],",",["T_WHITESPACE"," ",667],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",667],")",",",["T_WHITESPACE"," ",667],["T_CONSTANT_ENCAPSED_STRING","\"New field 'new_base_field' has been created on the 'entity_test_update' table.\"",667],")",";",["T_WHITESPACE","\n\n    ",667],["T_COMMENT","\/\/ Ensure that installing an existing field is a no-op.\n",669],["T_WHITESPACE","    ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","entityDefinitionUpdateManager",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","installFieldStorageDefinition",670],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",670],",",["T_WHITESPACE"," ",670],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",670],",",["T_WHITESPACE"," ",670],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",670],",",["T_WHITESPACE"," ",670],["T_VARIABLE","$storage_definition",670],")",";",["T_WHITESPACE","\n    ",670],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","assertTrue",671],"(",["T_VARIABLE","$db_schema",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","fieldExists",671],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",671],",",["T_WHITESPACE"," ",671],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",671],")",",",["T_WHITESPACE"," ",671],["T_CONSTANT_ENCAPSED_STRING","'Installing an existing field is a no-op'",671],")",";",["T_WHITESPACE","\n\n    ",671],["T_COMMENT","\/\/ Update an existing field schema.\n",673],["T_WHITESPACE","    ",674],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","modifyBaseField",674],"(",")",";",["T_WHITESPACE","\n    ",674],["T_VARIABLE","$storage_definition",675],["T_WHITESPACE"," ",675],"=",["T_WHITESPACE"," ",675],["T_STRING","BaseFieldDefinition",675],["T_DOUBLE_COLON","::",675],["T_STRING","create",675],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",675],")",["T_WHITESPACE","\n      ",675],["T_OBJECT_OPERATOR","->",676],["T_STRING","setName",676],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",676],")",["T_WHITESPACE","\n      ",676],["T_OBJECT_OPERATOR","->",677],["T_STRING","setTargetEntityTypeId",677],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",677],")",["T_WHITESPACE","\n      ",677],["T_OBJECT_OPERATOR","->",678],["T_STRING","setLabel",678],"(",["T_STRING","t",678],"(",["T_CONSTANT_ENCAPSED_STRING","'A new revisionable base field'",678],")",")",["T_WHITESPACE","\n      ",678],["T_OBJECT_OPERATOR","->",679],["T_STRING","setRevisionable",679],"(",["T_STRING","TRUE",679],")",";",["T_WHITESPACE","\n    ",679],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","entityDefinitionUpdateManager",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","updateFieldStorageDefinition",680],"(",["T_VARIABLE","$storage_definition",680],")",";",["T_WHITESPACE","\n    ",680],["T_VARIABLE","$this",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","assertFalse",681],"(",["T_VARIABLE","$db_schema",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","fieldExists",681],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",681],",",["T_WHITESPACE"," ",681],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",681],")",",",["T_WHITESPACE"," ",681],["T_CONSTANT_ENCAPSED_STRING","\"Previous schema for 'new_base_field' no longer exists.\"",681],")",";",["T_WHITESPACE","\n    ",681],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","assertTrue",682],"(",["T_WHITESPACE","\n      ",682],["T_VARIABLE","$db_schema",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","fieldExists",683],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",683],",",["T_WHITESPACE"," ",683],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__value'",683],")",["T_WHITESPACE"," ",683],["T_BOOLEAN_AND","&&",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$db_schema",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","fieldExists",683],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",683],",",["T_WHITESPACE"," ",683],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__format'",683],")",",",["T_WHITESPACE","\n      ",683],["T_CONSTANT_ENCAPSED_STRING","\"New schema for 'new_base_field' has been created.\"",684],["T_WHITESPACE","\n    ",684],")",";",["T_WHITESPACE","\n\n    ",685],["T_COMMENT","\/\/ Drop an existing field schema.\n",687],["T_WHITESPACE","    ",688],["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","entityDefinitionUpdateManager",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","uninstallFieldStorageDefinition",688],"(",["T_VARIABLE","$storage_definition",688],")",";",["T_WHITESPACE","\n    ",688],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","assertFalse",689],"(",["T_WHITESPACE","\n      ",689],["T_VARIABLE","$db_schema",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","fieldExists",690],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",690],",",["T_WHITESPACE"," ",690],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__value'",690],")",["T_WHITESPACE"," ",690],["T_BOOLEAN_OR","||",690],["T_WHITESPACE"," ",690],["T_VARIABLE","$db_schema",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","fieldExists",690],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",690],",",["T_WHITESPACE"," ",690],["T_CONSTANT_ENCAPSED_STRING","'new_base_field__format'",690],")",",",["T_WHITESPACE","\n      ",690],["T_CONSTANT_ENCAPSED_STRING","\"The schema for 'new_base_field' has been dropped.\"",691],["T_WHITESPACE","\n    ",691],")",";",["T_WHITESPACE","\n\n    ",692],["T_COMMENT","\/\/ Make the entity type revisionable.\n",694],["T_WHITESPACE","    ",695],["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","updateEntityTypeToRevisionable",695],"(",")",";",["T_WHITESPACE","\n    ",695],["T_VARIABLE","$this",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","assertFalse",696],"(",["T_VARIABLE","$db_schema",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","tableExists",696],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_revision'",696],")",",",["T_WHITESPACE"," ",696],["T_CONSTANT_ENCAPSED_STRING","\"The 'entity_test_update_revision' does not exist before applying the update.\"",696],")",";",["T_WHITESPACE","\n    ",696],["T_VARIABLE","$entity_type",697],["T_WHITESPACE"," ",697],"=",["T_WHITESPACE"," ",697],["T_VARIABLE","$this",697],["T_OBJECT_OPERATOR","->",697],["T_STRING","entityDefinitionUpdateManager",697],["T_OBJECT_OPERATOR","->",697],["T_STRING","getEntityType",697],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",697],")",";",["T_WHITESPACE","\n    ",697],["T_VARIABLE","$keys",698],["T_WHITESPACE"," ",698],"=",["T_WHITESPACE"," ",698],["T_VARIABLE","$entity_type",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getKeys",698],"(",")",";",["T_WHITESPACE","\n    ",698],["T_VARIABLE","$keys",699],"[",["T_CONSTANT_ENCAPSED_STRING","'revision'",699],"]",["T_WHITESPACE"," ",699],"=",["T_WHITESPACE"," ",699],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",699],";",["T_WHITESPACE","\n    ",699],["T_VARIABLE","$entity_type",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","set",700],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_keys'",700],",",["T_WHITESPACE"," ",700],["T_VARIABLE","$keys",700],")",";",["T_WHITESPACE","\n    ",700],["T_VARIABLE","$this",701],["T_OBJECT_OPERATOR","->",701],["T_STRING","entityDefinitionUpdateManager",701],["T_OBJECT_OPERATOR","->",701],["T_STRING","updateEntityType",701],"(",["T_VARIABLE","$entity_type",701],")",";",["T_WHITESPACE","\n    ",701],["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","assertTrue",702],"(",["T_VARIABLE","$db_schema",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","tableExists",702],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_revision'",702],")",",",["T_WHITESPACE"," ",702],["T_CONSTANT_ENCAPSED_STRING","\"The 'entity_test_update_revision' table has been created.\"",702],")",";",["T_WHITESPACE","\n  ",702],"}",["T_WHITESPACE","\n\n  ",703],["T_DOC_COMMENT","\/**\n   * Ensures that a new field and index on a shared table are created.\n   *\n   * @see Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema::createSharedTableSchema\n   *\/",705],["T_WHITESPACE","\n  ",709],["T_PUBLIC","public",710],["T_WHITESPACE"," ",710],["T_FUNCTION","function",710],["T_WHITESPACE"," ",710],["T_STRING","testCreateFieldAndIndexOnSharedTable",710],"(",")",["T_WHITESPACE"," ",710],"{",["T_WHITESPACE","\n    ",710],["T_VARIABLE","$this",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","addBaseField",711],"(",")",";",["T_WHITESPACE","\n    ",711],["T_VARIABLE","$this",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","addBaseFieldIndex",712],"(",")",";",["T_WHITESPACE","\n    ",712],["T_VARIABLE","$this",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","entityDefinitionUpdateManager",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","applyUpdates",713],"(",")",";",["T_WHITESPACE","\n    ",713],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","assertTrue",714],"(",["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","database",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","schema",714],"(",")",["T_OBJECT_OPERATOR","->",714],["T_STRING","fieldExists",714],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",714],",",["T_WHITESPACE"," ",714],["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",714],")",",",["T_WHITESPACE"," ",714],["T_CONSTANT_ENCAPSED_STRING","\"New field 'new_base_field' has been created on the 'entity_test_update' table.\"",714],")",";",["T_WHITESPACE","\n    ",714],["T_VARIABLE","$this",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","assertTrue",715],"(",["T_VARIABLE","$this",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","database",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","schema",715],"(",")",["T_OBJECT_OPERATOR","->",715],["T_STRING","indexExists",715],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",715],",",["T_WHITESPACE"," ",715],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update_field__new_base_field'",715],")",",",["T_WHITESPACE"," ",715],["T_CONSTANT_ENCAPSED_STRING","\"New index 'entity_test_update_field__new_base_field' has been created on the 'entity_test_update' table.\"",715],")",";",["T_WHITESPACE","\n    ",715],["T_COMMENT","\/\/ Check index size in for MySQL.\n",716],["T_WHITESPACE","    ",717],["T_IF","if",717],["T_WHITESPACE"," ",717],"(",["T_STRING","Database",717],["T_DOUBLE_COLON","::",717],["T_STRING","getConnection",717],"(",")",["T_OBJECT_OPERATOR","->",717],["T_STRING","driver",717],"(",")",["T_WHITESPACE"," ",717],["T_IS_EQUAL","==",717],["T_WHITESPACE"," ",717],["T_CONSTANT_ENCAPSED_STRING","'mysql'",717],")",["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n      ",717],["T_VARIABLE","$result",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_STRING","Database",718],["T_DOUBLE_COLON","::",718],["T_STRING","getConnection",718],"(",")",["T_OBJECT_OPERATOR","->",718],["T_STRING","query",718],"(",["T_CONSTANT_ENCAPSED_STRING","'SHOW INDEX FROM {entity_test_update} WHERE key_name = \\'entity_test_update_field__new_base_field\\' and column_name = \\'new_base_field\\''",718],")",["T_OBJECT_OPERATOR","->",718],["T_STRING","fetchObject",718],"(",")",";",["T_WHITESPACE","\n      ",718],["T_VARIABLE","$this",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","assertEqual",719],"(",["T_LNUMBER","191",719],",",["T_WHITESPACE"," ",719],["T_VARIABLE","$result",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","Sub_part",719],",",["T_WHITESPACE"," ",719],["T_CONSTANT_ENCAPSED_STRING","'The index length has been restricted to 191 characters for UTF8MB4 compatibility.'",719],")",";",["T_WHITESPACE","\n    ",719],"}",["T_WHITESPACE","\n  ",720],"}",["T_WHITESPACE","\n\n  ",721],["T_DOC_COMMENT","\/**\n   * Ensures that a new entity level index is created when data exists.\n   *\n   * @see Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema::onEntityTypeUpdate\n   *\/",723],["T_WHITESPACE","\n  ",727],["T_PUBLIC","public",728],["T_WHITESPACE"," ",728],["T_FUNCTION","function",728],["T_WHITESPACE"," ",728],["T_STRING","testCreateIndexUsingEntityStorageSchemaWithData",728],"(",")",["T_WHITESPACE"," ",728],"{",["T_WHITESPACE","\n    ",728],["T_COMMENT","\/\/ Save an entity.\n",729],["T_WHITESPACE","    ",730],["T_VARIABLE","$name",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_VARIABLE","$this",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","randomString",730],"(",")",";",["T_WHITESPACE","\n    ",730],["T_VARIABLE","$storage",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","entityManager",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getStorage",731],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",731],")",";",["T_WHITESPACE","\n    ",731],["T_VARIABLE","$entity",732],["T_WHITESPACE"," ",732],"=",["T_WHITESPACE"," ",732],["T_VARIABLE","$storage",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","create",732],"(",["T_ARRAY","array",732],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",732],["T_WHITESPACE"," ",732],["T_DOUBLE_ARROW","=>",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$name",732],")",")",";",["T_WHITESPACE","\n    ",732],["T_VARIABLE","$entity",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","save",733],"(",")",";",["T_WHITESPACE","\n\n    ",733],["T_COMMENT","\/\/ Create an index.\n",735],["T_WHITESPACE","    ",736],["T_VARIABLE","$indexes",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_ARRAY","array",736],"(",["T_WHITESPACE","\n      ",736],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__type_index'",737],["T_WHITESPACE"," ",737],["T_DOUBLE_ARROW","=>",737],["T_WHITESPACE"," ",737],["T_ARRAY","array",737],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",737],")",",",["T_WHITESPACE","\n    ",737],")",";",["T_WHITESPACE","\n    ",738],["T_VARIABLE","$this",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","state",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","set",739],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update.additional_entity_indexes'",739],",",["T_WHITESPACE"," ",739],["T_VARIABLE","$indexes",739],")",";",["T_WHITESPACE","\n    ",739],["T_VARIABLE","$this",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","entityDefinitionUpdateManager",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","applyUpdates",740],"(",")",";",["T_WHITESPACE","\n    ",740],["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","assertTrue",741],"(",["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","database",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","schema",741],"(",")",["T_OBJECT_OPERATOR","->",741],["T_STRING","indexExists",741],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",741],",",["T_WHITESPACE"," ",741],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update__type_index'",741],")",",",["T_WHITESPACE"," ",741],["T_CONSTANT_ENCAPSED_STRING","\"New index 'entity_test_update__type_index' has been created on the 'entity_test_update' table.\"",741],")",";",["T_WHITESPACE","\n    ",741],["T_COMMENT","\/\/ Check index size in for MySQL.\n",742],["T_WHITESPACE","    ",743],["T_IF","if",743],["T_WHITESPACE"," ",743],"(",["T_STRING","Database",743],["T_DOUBLE_COLON","::",743],["T_STRING","getConnection",743],"(",")",["T_OBJECT_OPERATOR","->",743],["T_STRING","driver",743],"(",")",["T_WHITESPACE"," ",743],["T_IS_EQUAL","==",743],["T_WHITESPACE"," ",743],["T_CONSTANT_ENCAPSED_STRING","'mysql'",743],")",["T_WHITESPACE"," ",743],"{",["T_WHITESPACE","\n      ",743],["T_VARIABLE","$result",744],["T_WHITESPACE"," ",744],"=",["T_WHITESPACE"," ",744],["T_STRING","Database",744],["T_DOUBLE_COLON","::",744],["T_STRING","getConnection",744],"(",")",["T_OBJECT_OPERATOR","->",744],["T_STRING","query",744],"(",["T_CONSTANT_ENCAPSED_STRING","'SHOW INDEX FROM {entity_test_update} WHERE key_name = \\'entity_test_update__type_index\\' and column_name = \\'type\\''",744],")",["T_OBJECT_OPERATOR","->",744],["T_STRING","fetchObject",744],"(",")",";",["T_WHITESPACE","\n      ",744],["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","assertEqual",745],"(",["T_LNUMBER","191",745],",",["T_WHITESPACE"," ",745],["T_VARIABLE","$result",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","Sub_part",745],",",["T_WHITESPACE"," ",745],["T_CONSTANT_ENCAPSED_STRING","'The index length has been restricted to 191 characters for UTF8MB4 compatibility.'",745],")",";",["T_WHITESPACE","\n    ",745],"}",["T_WHITESPACE","\n  ",746],"}",["T_WHITESPACE","\n\n  ",747],["T_DOC_COMMENT","\/**\n   * Tests updating a base field when it has existing data.\n   *\/",749],["T_WHITESPACE","\n  ",751],["T_PUBLIC","public",752],["T_WHITESPACE"," ",752],["T_FUNCTION","function",752],["T_WHITESPACE"," ",752],["T_STRING","testBaseFieldEntityKeyUpdateWithExistingData",752],"(",")",["T_WHITESPACE"," ",752],"{",["T_WHITESPACE","\n    ",752],["T_COMMENT","\/\/ Add the base field and run the update.\n",753],["T_WHITESPACE","    ",754],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","addBaseField",754],"(",")",";",["T_WHITESPACE","\n    ",754],["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","entityDefinitionUpdateManager",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","applyUpdates",755],"(",")",";",["T_WHITESPACE","\n\n    ",755],["T_COMMENT","\/\/ Save an entity with the base field populated.\n",757],["T_WHITESPACE","    ",758],["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","entityManager",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","getStorage",758],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",758],")",["T_OBJECT_OPERATOR","->",758],["T_STRING","create",758],"(","[",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",758],["T_WHITESPACE"," ",758],["T_DOUBLE_ARROW","=>",758],["T_WHITESPACE"," ",758],["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","randomString",758],"(",")","]",")",["T_OBJECT_OPERATOR","->",758],["T_STRING","save",758],"(",")",";",["T_WHITESPACE","\n\n    ",758],["T_COMMENT","\/\/ Save an entity with the base field not populated.\n",760],["T_WHITESPACE","    ",761],["T_DOC_COMMENT","\/** @var \\Drupal\\entity_test\\Entity\\EntityTestUpdate $entity *\/",761],["T_WHITESPACE","\n    ",761],["T_VARIABLE","$entity",762],["T_WHITESPACE"," ",762],"=",["T_WHITESPACE"," ",762],["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","entityManager",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","getStorage",762],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",762],")",["T_OBJECT_OPERATOR","->",762],["T_STRING","create",762],"(",")",";",["T_WHITESPACE","\n    ",762],["T_VARIABLE","$entity",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","save",763],"(",")",";",["T_WHITESPACE","\n\n    ",763],["T_COMMENT","\/\/ Promote the base field to an entity key. This will trigger the addition\n",765],["T_WHITESPACE","    ",766],["T_COMMENT","\/\/ of a NOT NULL constraint.\n",766],["T_WHITESPACE","    ",767],["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","makeBaseFieldEntityKey",767],"(",")",";",["T_WHITESPACE","\n\n    ",767],["T_COMMENT","\/\/ Try to apply the update and verify they fail since we have a NULL value.\n",769],["T_WHITESPACE","    ",770],["T_VARIABLE","$message",770],["T_WHITESPACE"," ",770],"=",["T_WHITESPACE"," ",770],["T_CONSTANT_ENCAPSED_STRING","'An error occurs when trying to enabling NOT NULL constraints with NULL data.'",770],";",["T_WHITESPACE","\n    ",770],["T_TRY","try",771],["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n      ",771],["T_VARIABLE","$this",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","entityDefinitionUpdateManager",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","applyUpdates",772],"(",")",";",["T_WHITESPACE","\n      ",772],["T_VARIABLE","$this",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","fail",773],"(",["T_VARIABLE","$message",773],")",";",["T_WHITESPACE","\n    ",773],"}",["T_WHITESPACE","\n    ",774],["T_CATCH","catch",775],["T_WHITESPACE"," ",775],"(",["T_STRING","EntityStorageException",775],["T_WHITESPACE"," ",775],["T_VARIABLE","$e",775],")",["T_WHITESPACE"," ",775],"{",["T_WHITESPACE","\n      ",775],["T_VARIABLE","$this",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","pass",776],"(",["T_VARIABLE","$message",776],")",";",["T_WHITESPACE","\n    ",776],"}",["T_WHITESPACE","\n\n    ",777],["T_COMMENT","\/\/ Check that the update is correctly applied when no NULL data is left.\n",779],["T_WHITESPACE","    ",780],["T_VARIABLE","$entity",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","set",780],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",780],",",["T_WHITESPACE"," ",780],["T_VARIABLE","$this",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","randomString",780],"(",")",")",";",["T_WHITESPACE","\n    ",780],["T_VARIABLE","$entity",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","save",781],"(",")",";",["T_WHITESPACE","\n    ",781],["T_VARIABLE","$this",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","entityDefinitionUpdateManager",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","applyUpdates",782],"(",")",";",["T_WHITESPACE","\n    ",782],["T_VARIABLE","$this",783],["T_OBJECT_OPERATOR","->",783],["T_STRING","pass",783],"(",["T_CONSTANT_ENCAPSED_STRING","'The update is correctly performed when no NULL data exists.'",783],")",";",["T_WHITESPACE","\n\n    ",783],["T_COMMENT","\/\/ Check that the update actually applied a NOT NULL constraint.\n",785],["T_WHITESPACE","    ",786],["T_VARIABLE","$entity",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","set",786],"(",["T_CONSTANT_ENCAPSED_STRING","'new_base_field'",786],",",["T_WHITESPACE"," ",786],["T_STRING","NULL",786],")",";",["T_WHITESPACE","\n    ",786],["T_VARIABLE","$message",787],["T_WHITESPACE"," ",787],"=",["T_WHITESPACE"," ",787],["T_CONSTANT_ENCAPSED_STRING","'The NOT NULL constraint was correctly applied.'",787],";",["T_WHITESPACE","\n    ",787],["T_TRY","try",788],["T_WHITESPACE"," ",788],"{",["T_WHITESPACE","\n      ",788],["T_VARIABLE","$entity",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","save",789],"(",")",";",["T_WHITESPACE","\n      ",789],["T_VARIABLE","$this",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","fail",790],"(",["T_VARIABLE","$message",790],")",";",["T_WHITESPACE","\n    ",790],"}",["T_WHITESPACE","\n    ",791],["T_CATCH","catch",792],["T_WHITESPACE"," ",792],"(",["T_STRING","EntityStorageException",792],["T_WHITESPACE"," ",792],["T_VARIABLE","$e",792],")",["T_WHITESPACE"," ",792],"{",["T_WHITESPACE","\n      ",792],["T_VARIABLE","$this",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","pass",793],"(",["T_VARIABLE","$message",793],")",";",["T_WHITESPACE","\n    ",793],"}",["T_WHITESPACE","\n  ",794],"}",["T_WHITESPACE","\n\n  ",795],["T_DOC_COMMENT","\/**\n   * Check that field schema is correctly handled with long-named fields.\n   *\/",797],["T_WHITESPACE","\n  ",799],["T_FUNCTION","function",800],["T_WHITESPACE"," ",800],["T_STRING","testLongNameFieldIndexes",800],"(",")",["T_WHITESPACE"," ",800],"{",["T_WHITESPACE","\n    ",800],["T_VARIABLE","$this",801],["T_OBJECT_OPERATOR","->",801],["T_STRING","addLongNameBaseField",801],"(",")",";",["T_WHITESPACE","\n    ",801],["T_VARIABLE","$entity_type_id",802],["T_WHITESPACE"," ",802],"=",["T_WHITESPACE"," ",802],["T_CONSTANT_ENCAPSED_STRING","'entity_test_update'",802],";",["T_WHITESPACE","\n    ",802],["T_VARIABLE","$entity_type",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_VARIABLE","$this",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","entityManager",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getDefinition",803],"(",["T_VARIABLE","$entity_type_id",803],")",";",["T_WHITESPACE","\n    ",803],["T_VARIABLE","$definitions",804],["T_WHITESPACE"," ",804],"=",["T_WHITESPACE"," ",804],["T_STRING","EntityTestUpdate",804],["T_DOUBLE_COLON","::",804],["T_STRING","baseFieldDefinitions",804],"(",["T_VARIABLE","$entity_type",804],")",";",["T_WHITESPACE","\n    ",804],["T_VARIABLE","$name",805],["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'new_long_named_entity_reference_base_field'",805],";",["T_WHITESPACE","\n    ",805],["T_VARIABLE","$this",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","entityDefinitionUpdateManager",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","installFieldStorageDefinition",806],"(",["T_VARIABLE","$name",806],",",["T_WHITESPACE"," ",806],["T_VARIABLE","$entity_type_id",806],",",["T_WHITESPACE"," ",806],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",806],",",["T_WHITESPACE"," ",806],["T_VARIABLE","$definitions",806],"[",["T_VARIABLE","$name",806],"]",")",";",["T_WHITESPACE","\n    ",806],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","assertFalse",807],"(",["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","entityDefinitionUpdateManager",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","needsUpdates",807],"(",")",",",["T_WHITESPACE"," ",807],["T_CONSTANT_ENCAPSED_STRING","'Entity and field schema data are correctly detected.'",807],")",";",["T_WHITESPACE","\n  ",807],"}",["T_WHITESPACE","\n\n",808],"}",["T_WHITESPACE","\n",810]]