[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Database",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Environment",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DatabaseException",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests handling of large queries.\n *\n * @group Database\n *\/",9],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","LargeQueryTest",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_STRING","DatabaseTestBase",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\n  ",14],["T_DOC_COMMENT","\/**\n   * Tests truncation of messages when max_allowed_packet exception occurs.\n   *\/",16],["T_WHITESPACE","\n  ",18],["T_FUNCTION","function",19],["T_WHITESPACE"," ",19],["T_STRING","testMaxAllowedPacketQueryTruncating",19],"(",")",["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n    ",19],["T_COMMENT","\/\/ This test only makes sense if we are running on a MySQL database.\n",20],["T_WHITESPACE","    ",21],["T_COMMENT","\/\/ Test if we are.\n",21],["T_WHITESPACE","    ",22],["T_VARIABLE","$database",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_STRING","Database",22],["T_DOUBLE_COLON","::",22],["T_STRING","getConnectionInfo",22],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",22],")",";",["T_WHITESPACE","\n    ",22],["T_IF","if",23],["T_WHITESPACE"," ",23],"(",["T_VARIABLE","$database",23],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",23],"]","[",["T_CONSTANT_ENCAPSED_STRING","'driver'",23],"]",["T_WHITESPACE"," ",23],["T_IS_EQUAL","==",23],["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'mysql'",23],")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n      ",23],["T_COMMENT","\/\/ The max_allowed_packet value is configured per database instance.\n",24],["T_WHITESPACE","      ",25],["T_COMMENT","\/\/ Retrieve the max_allowed_packet value from the current instance and\n",25],["T_WHITESPACE","      ",26],["T_COMMENT","\/\/ check if PHP is configured with sufficient allowed memory to be able\n",26],["T_WHITESPACE","      ",27],["T_COMMENT","\/\/ to generate a query larger than max_allowed_packet.\n",27],["T_WHITESPACE","      ",28],["T_VARIABLE","$max_allowed_packet",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_STRING","db_query",28],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT @@global.max_allowed_packet'",28],")",["T_OBJECT_OPERATOR","->",28],["T_STRING","fetchField",28],"(",")",";",["T_WHITESPACE","\n      ",28],["T_IF","if",29],["T_WHITESPACE"," ",29],"(",["T_STRING","Environment",29],["T_DOUBLE_COLON","::",29],["T_STRING","checkMemoryLimit",29],"(",["T_VARIABLE","$max_allowed_packet",29],["T_WHITESPACE"," ",29],"+",["T_WHITESPACE"," ",29],"(",["T_LNUMBER","16",29],["T_WHITESPACE"," ",29],"*",["T_WHITESPACE"," ",29],["T_LNUMBER","1024",29],["T_WHITESPACE"," ",29],"*",["T_WHITESPACE"," ",29],["T_LNUMBER","1024",29],")",")",")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n        ",29],["T_VARIABLE","$long_name",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_STRING","str_repeat",30],"(",["T_CONSTANT_ENCAPSED_STRING","'a'",30],",",["T_WHITESPACE"," ",30],["T_VARIABLE","$max_allowed_packet",30],["T_WHITESPACE"," ",30],"+",["T_WHITESPACE"," ",30],["T_LNUMBER","1",30],")",";",["T_WHITESPACE","\n        ",30],["T_TRY","try",31],["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n          ",31],["T_STRING","db_query",32],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT name FROM {test} WHERE name = :name'",32],",",["T_WHITESPACE"," ",32],["T_ARRAY","array",32],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",32],["T_WHITESPACE"," ",32],["T_DOUBLE_ARROW","=>",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$long_name",32],")",")",";",["T_WHITESPACE","\n          ",32],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","fail",33],"(",["T_CONSTANT_ENCAPSED_STRING","\"An exception should be thrown for queries larger than 'max_allowed_packet'\"",33],")",";",["T_WHITESPACE","\n        ",33],"}",["T_WHITESPACE","\n        ",34],["T_CATCH","catch",35],["T_WHITESPACE"," ",35],"(",["T_STRING","DatabaseException",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$e",35],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n          ",35],["T_COMMENT","\/\/ Close and re-open the connection. Otherwise we will run into error\n",36],["T_WHITESPACE","          ",37],["T_COMMENT","\/\/ 2006 \"MySQL server had gone away\" afterwards.\n",37],["T_WHITESPACE","          ",38],["T_STRING","Database",38],["T_DOUBLE_COLON","::",38],["T_STRING","closeConnection",38],"(",")",";",["T_WHITESPACE","\n          ",38],["T_STRING","Database",39],["T_DOUBLE_COLON","::",39],["T_STRING","getConnection",39],"(",")",";",["T_WHITESPACE","\n          ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","assertEqual",40],"(",["T_VARIABLE","$e",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getPrevious",40],"(",")",["T_OBJECT_OPERATOR","->",40],["T_STRING","errorInfo",40],"[",["T_LNUMBER","1",40],"]",",",["T_WHITESPACE"," ",40],["T_LNUMBER","1153",40],",",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","\"Got a packet bigger than 'max_allowed_packet' bytes exception thrown.\"",40],")",";",["T_WHITESPACE","\n          ",40],["T_COMMENT","\/\/ Use strlen() to count the bytes exactly, not the unicode chars.\n",41],["T_WHITESPACE","          ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","assertTrue",42],"(",["T_STRING","strlen",42],"(",["T_VARIABLE","$e",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","getMessage",42],"(",")",")",["T_WHITESPACE"," ",42],["T_IS_SMALLER_OR_EQUAL","<=",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$max_allowed_packet",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","\"'max_allowed_packet' exception message truncated.\"",42],")",";",["T_WHITESPACE","\n        ",42],"}",["T_WHITESPACE","\n      ",43],"}",["T_WHITESPACE","\n      ",44],["T_ELSE","else",45],["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","verbose",46],"(",["T_CONSTANT_ENCAPSED_STRING","'The configured max_allowed_packet exceeds the php memory limit. Therefore the test is skipped.'",46],")",";",["T_WHITESPACE","\n      ",46],"}",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n    ",48],["T_ELSE","else",49],["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n      ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","verbose",50],"(",["T_CONSTANT_ENCAPSED_STRING","'The test requires MySQL. Therefore the test is skipped.'",50],")",";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n  ",51],"}",["T_WHITESPACE","\n\n",52],"}",["T_WHITESPACE","\n",54]]