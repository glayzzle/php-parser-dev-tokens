[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","File",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","PhpStorage",5],["T_NS_SEPARATOR","\\",5],["T_STRING","FileStorage",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests operations dealing with directories.\n *\n * @group File\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","DirectoryTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","FileTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * Test local directory handling functions.\n   *\/",14],["T_WHITESPACE","\n  ",16],["T_FUNCTION","function",17],["T_WHITESPACE"," ",17],["T_STRING","testFileCheckLocalDirectoryHandling",17],"(",")",["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n    ",17],["T_VARIABLE","$site_path",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_VARIABLE","$this",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","container",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","get",18],"(",["T_CONSTANT_ENCAPSED_STRING","'site.path'",18],")",";",["T_WHITESPACE","\n    ",18],["T_VARIABLE","$directory",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_VARIABLE","$site_path",19],["T_WHITESPACE"," ",19],".",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'\/files'",19],";",["T_WHITESPACE","\n\n    ",19],["T_COMMENT","\/\/ Check a new recursively created local directory for correct file system\n",21],["T_WHITESPACE","    ",22],["T_COMMENT","\/\/ permissions.\n",22],["T_WHITESPACE","    ",23],["T_VARIABLE","$parent",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_VARIABLE","$this",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","randomMachineName",23],"(",")",";",["T_WHITESPACE","\n    ",23],["T_VARIABLE","$child",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","randomMachineName",24],"(",")",";",["T_WHITESPACE","\n\n    ",24],["T_COMMENT","\/\/ Files directory already exists.\n",26],["T_WHITESPACE","    ",27],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","assertTrue",27],"(",["T_STRING","is_dir",27],"(",["T_VARIABLE","$directory",27],")",",",["T_WHITESPACE"," ",27],["T_STRING","t",27],"(",["T_CONSTANT_ENCAPSED_STRING","'Files directory already exists.'",27],")",",",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'File'",27],")",";",["T_WHITESPACE","\n    ",27],["T_COMMENT","\/\/ Make files directory writable only.\n",28],["T_WHITESPACE","    ",29],["T_VARIABLE","$old_mode",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_STRING","fileperms",29],"(",["T_VARIABLE","$directory",29],")",";",["T_WHITESPACE","\n\n    ",29],["T_COMMENT","\/\/ Create the directories.\n",31],["T_WHITESPACE","    ",32],["T_VARIABLE","$parent_path",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_VARIABLE","$directory",32],["T_WHITESPACE"," ",32],".",["T_WHITESPACE"," ",32],["T_STRING","DIRECTORY_SEPARATOR",32],["T_WHITESPACE"," ",32],".",["T_WHITESPACE"," ",32],["T_VARIABLE","$parent",32],";",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$child_path",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$parent_path",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_STRING","DIRECTORY_SEPARATOR",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_VARIABLE","$child",33],";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","assertTrue",34],"(",["T_STRING","drupal_mkdir",34],"(",["T_VARIABLE","$child_path",34],",",["T_WHITESPACE"," ",34],["T_LNUMBER","0775",34],",",["T_WHITESPACE"," ",34],["T_STRING","TRUE",34],")",",",["T_WHITESPACE"," ",34],["T_STRING","t",34],"(",["T_CONSTANT_ENCAPSED_STRING","'No error reported when creating new local directories.'",34],")",",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'File'",34],")",";",["T_WHITESPACE","\n\n    ",34],["T_COMMENT","\/\/ Ensure new directories also exist.\n",36],["T_WHITESPACE","    ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertTrue",37],"(",["T_STRING","is_dir",37],"(",["T_VARIABLE","$parent_path",37],")",",",["T_WHITESPACE"," ",37],["T_STRING","t",37],"(",["T_CONSTANT_ENCAPSED_STRING","'New parent directory actually exists.'",37],")",",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'File'",37],")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertTrue",38],"(",["T_STRING","is_dir",38],"(",["T_VARIABLE","$child_path",38],")",",",["T_WHITESPACE"," ",38],["T_STRING","t",38],"(",["T_CONSTANT_ENCAPSED_STRING","'New child directory actually exists.'",38],")",",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'File'",38],")",";",["T_WHITESPACE","\n\n    ",38],["T_COMMENT","\/\/ Check that new directory permissions were set properly.\n",40],["T_WHITESPACE","    ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","assertDirectoryPermissions",41],"(",["T_VARIABLE","$parent_path",41],",",["T_WHITESPACE"," ",41],["T_LNUMBER","0775",41],")",";",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","assertDirectoryPermissions",42],"(",["T_VARIABLE","$child_path",42],",",["T_WHITESPACE"," ",42],["T_LNUMBER","0775",42],")",";",["T_WHITESPACE","\n\n    ",42],["T_COMMENT","\/\/ Check that existing directory permissions were not modified.\n",44],["T_WHITESPACE","    ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","assertDirectoryPermissions",45],"(",["T_VARIABLE","$directory",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$old_mode",45],")",";",["T_WHITESPACE","\n\n    ",45],["T_COMMENT","\/\/ Check creating a directory using an absolute path.\n",47],["T_WHITESPACE","    ",48],["T_VARIABLE","$absolute_path",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","drupal_realpath",48],"(",["T_VARIABLE","$directory",48],")",["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_STRING","DIRECTORY_SEPARATOR",48],["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","randomMachineName",48],"(",")",["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_STRING","DIRECTORY_SEPARATOR",48],["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","randomMachineName",48],"(",")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","assertTrue",49],"(",["T_STRING","drupal_mkdir",49],"(",["T_VARIABLE","$absolute_path",49],",",["T_WHITESPACE"," ",49],["T_LNUMBER","0775",49],",",["T_WHITESPACE"," ",49],["T_STRING","TRUE",49],")",",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'No error reported when creating new absolute directories.'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'File'",49],")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","assertDirectoryPermissions",50],"(",["T_VARIABLE","$absolute_path",50],",",["T_WHITESPACE"," ",50],["T_LNUMBER","0775",50],")",";",["T_WHITESPACE","\n  ",50],"}",["T_WHITESPACE","\n\n  ",51],["T_DOC_COMMENT","\/**\n   * Test directory handling functions.\n   *\/",53],["T_WHITESPACE","\n  ",55],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","testFileCheckDirectoryHandling",56],"(",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n    ",56],["T_COMMENT","\/\/ A directory to operate on.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$directory",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","file_default_scheme",58],"(",")",["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","':\/\/'",58],["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","randomMachineName",58],"(",")",["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'\/'",58],["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","randomMachineName",58],"(",")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","assertFalse",59],"(",["T_STRING","is_dir",59],"(",["T_VARIABLE","$directory",59],")",",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'Directory does not exist prior to testing.'",59],")",";",["T_WHITESPACE","\n\n    ",59],["T_COMMENT","\/\/ Non-existent directory.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertFalse",62],"(",["T_STRING","file_prepare_directory",62],"(",["T_VARIABLE","$directory",62],",",["T_WHITESPACE"," ",62],["T_LNUMBER","0",62],")",",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'Error reported for non-existing directory.'",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'File'",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Make a directory.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertTrue",65],"(",["T_STRING","file_prepare_directory",65],"(",["T_VARIABLE","$directory",65],",",["T_WHITESPACE"," ",65],["T_STRING","FILE_CREATE_DIRECTORY",65],")",",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'No error reported when creating a new directory.'",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'File'",65],")",";",["T_WHITESPACE","\n\n    ",65],["T_COMMENT","\/\/ Make sure directory actually exists.\n",67],["T_WHITESPACE","    ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertTrue",68],"(",["T_STRING","is_dir",68],"(",["T_VARIABLE","$directory",68],")",",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Directory actually exists.'",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'File'",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_STRING","substr",70],"(",["T_STRING","PHP_OS",70],",",["T_WHITESPACE"," ",70],["T_LNUMBER","0",70],",",["T_WHITESPACE"," ",70],["T_LNUMBER","3",70],")",["T_WHITESPACE"," ",70],["T_IS_NOT_EQUAL","!=",70],["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'WIN'",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n      ",70],["T_COMMENT","\/\/ PHP on Windows doesn't support any kind of useful read-only mode for\n",71],["T_WHITESPACE","      ",72],["T_COMMENT","\/\/ directories. When executing a chmod() on a directory, PHP only sets the\n",72],["T_WHITESPACE","      ",73],["T_COMMENT","\/\/ read-only flag, which doesn't prevent files to actually be written\n",73],["T_WHITESPACE","      ",74],["T_COMMENT","\/\/ in the directory on any recent version of Windows.\n",74],["T_WHITESPACE","\n      ",75],["T_COMMENT","\/\/ Make directory read only.\n",76],["T_WHITESPACE","      ",77],"@",["T_STRING","drupal_chmod",77],"(",["T_VARIABLE","$directory",77],",",["T_WHITESPACE"," ",77],["T_LNUMBER","0444",77],")",";",["T_WHITESPACE","\n      ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertFalse",78],"(",["T_STRING","file_prepare_directory",78],"(",["T_VARIABLE","$directory",78],",",["T_WHITESPACE"," ",78],["T_LNUMBER","0",78],")",",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Error reported for a non-writeable directory.'",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'File'",78],")",";",["T_WHITESPACE","\n\n      ",78],["T_COMMENT","\/\/ Test directory permission modification.\n",80],["T_WHITESPACE","      ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","setSetting",81],"(",["T_CONSTANT_ENCAPSED_STRING","'file_chmod_directory'",81],",",["T_WHITESPACE"," ",81],["T_LNUMBER","0777",81],")",";",["T_WHITESPACE","\n      ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertTrue",82],"(",["T_STRING","file_prepare_directory",82],"(",["T_VARIABLE","$directory",82],",",["T_WHITESPACE"," ",82],["T_STRING","FILE_MODIFY_PERMISSIONS",82],")",",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'No error reported when making directory writeable.'",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'File'",82],")",";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_COMMENT","\/\/ Test that the directory has the correct permissions.\n",85],["T_WHITESPACE","    ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertDirectoryPermissions",86],"(",["T_VARIABLE","$directory",86],",",["T_WHITESPACE"," ",86],["T_LNUMBER","0777",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'file_chmod_directory setting is respected.'",86],")",";",["T_WHITESPACE","\n\n    ",86],["T_COMMENT","\/\/ Remove .htaccess file to then test that it gets re-created.\n",88],["T_WHITESPACE","    ",89],"@",["T_STRING","drupal_unlink",89],"(",["T_STRING","file_default_scheme",89],"(",")",["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","':\/\/.htaccess'",89],")",";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","assertFalse",90],"(",["T_STRING","is_file",90],"(",["T_STRING","file_default_scheme",90],"(",")",["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","':\/\/.htaccess'",90],")",",",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'Successfully removed the .htaccess file in the files directory.'",90],",",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'File'",90],")",";",["T_WHITESPACE","\n    ",90],["T_STRING","file_ensure_htaccess",91],"(",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertTrue",92],"(",["T_STRING","is_file",92],"(",["T_STRING","file_default_scheme",92],"(",")",["T_WHITESPACE"," ",92],".",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","':\/\/.htaccess'",92],")",",",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'Successfully re-created the .htaccess file in the files directory.'",92],",",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'File'",92],")",";",["T_WHITESPACE","\n    ",92],["T_COMMENT","\/\/ Verify contents of .htaccess file.\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$file",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","file_get_contents",94],"(",["T_STRING","file_default_scheme",94],"(",")",["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","':\/\/.htaccess'",94],")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","assertEqual",95],"(",["T_VARIABLE","$file",95],",",["T_WHITESPACE"," ",95],["T_STRING","FileStorage",95],["T_DOUBLE_COLON","::",95],["T_STRING","htaccessLines",95],"(",["T_STRING","FALSE",95],")",",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'The .htaccess file contains the proper content.'",95],",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'File'",95],")",";",["T_WHITESPACE","\n  ",95],"}",["T_WHITESPACE","\n\n  ",96],["T_DOC_COMMENT","\/**\n   * This will take a directory and path, and find a valid filepath that is not\n   * taken by another file.\n   *\/",98],["T_WHITESPACE","\n  ",101],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","testFileCreateNewFilepath",102],"(",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n    ",102],["T_COMMENT","\/\/ First we test against an imaginary file that does not exist in a\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ directory.\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$basename",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'xyz.txt'",105],";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$directory",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","'core\/misc'",106],";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$original",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$directory",107],["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'\/'",107],["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$basename",107],";",["T_WHITESPACE","\n    ",107],["T_VARIABLE","$path",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","file_create_filename",108],"(",["T_VARIABLE","$basename",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$directory",108],")",";",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","assertEqual",109],"(",["T_VARIABLE","$path",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$original",109],",",["T_WHITESPACE"," ",109],["T_STRING","format_string",109],"(",["T_CONSTANT_ENCAPSED_STRING","'New filepath %new equals %original.'",109],",",["T_WHITESPACE"," ",109],["T_ARRAY","array",109],"(",["T_CONSTANT_ENCAPSED_STRING","'%new'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$path",109],",",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'%original'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$original",109],")",")",",",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'File'",109],")",";",["T_WHITESPACE","\n\n    ",109],["T_COMMENT","\/\/ Then we test against a file that already exists within that directory.\n",111],["T_WHITESPACE","    ",112],["T_VARIABLE","$basename",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'druplicon.png'",112],";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$original",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$directory",113],["T_WHITESPACE"," ",113],".",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'\/'",113],["T_WHITESPACE"," ",113],".",["T_WHITESPACE"," ",113],["T_VARIABLE","$basename",113],";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$expected",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$directory",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'\/druplicon_0.png'",114],";",["T_WHITESPACE","\n    ",114],["T_VARIABLE","$path",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","file_create_filename",115],"(",["T_VARIABLE","$basename",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$directory",115],")",";",["T_WHITESPACE","\n    ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","assertEqual",116],"(",["T_VARIABLE","$path",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$expected",116],",",["T_WHITESPACE"," ",116],["T_STRING","format_string",116],"(",["T_CONSTANT_ENCAPSED_STRING","'Creating a new filepath from %original equals %new (expected %expected).'",116],",",["T_WHITESPACE"," ",116],["T_ARRAY","array",116],"(",["T_CONSTANT_ENCAPSED_STRING","'%new'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$path",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'%original'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$original",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'%expected'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$expected",116],")",")",",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'File'",116],")",";",["T_WHITESPACE","\n\n    ",116],["T_COMMENT","\/\/ @TODO: Finally we copy a file into a directory several times, to ensure a properly iterating filename suffix.\n",118],["T_WHITESPACE","  ",119],"}",["T_WHITESPACE","\n\n  ",119],["T_DOC_COMMENT","\/**\n   * This will test the filepath for a destination based on passed flags and\n   * whether or not the file exists.\n   *\n   * If a file exists, file_destination($destination, $replace) will either\n   * return:\n   * - the existing filepath, if $replace is FILE_EXISTS_REPLACE\n   * - a new filepath if FILE_EXISTS_RENAME\n   * - an error (returning FALSE) if FILE_EXISTS_ERROR.\n   * If the file doesn't currently exist, then it will simply return the\n   * filepath.\n   *\/",121],["T_WHITESPACE","\n  ",132],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","testFileDestination",133],"(",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n    ",133],["T_COMMENT","\/\/ First test for non-existent file.\n",134],["T_WHITESPACE","    ",135],["T_VARIABLE","$destination",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'core\/misc\/xyz.txt'",135],";",["T_WHITESPACE","\n    ",135],["T_VARIABLE","$path",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","file_destination",136],"(",["T_VARIABLE","$destination",136],",",["T_WHITESPACE"," ",136],["T_STRING","FILE_EXISTS_REPLACE",136],")",";",["T_WHITESPACE","\n    ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","assertEqual",137],"(",["T_VARIABLE","$path",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$destination",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'Non-existing filepath destination is correct with FILE_EXISTS_REPLACE.'",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'File'",137],")",";",["T_WHITESPACE","\n    ",137],["T_VARIABLE","$path",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_STRING","file_destination",138],"(",["T_VARIABLE","$destination",138],",",["T_WHITESPACE"," ",138],["T_STRING","FILE_EXISTS_RENAME",138],")",";",["T_WHITESPACE","\n    ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","assertEqual",139],"(",["T_VARIABLE","$path",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$destination",139],",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'Non-existing filepath destination is correct with FILE_EXISTS_RENAME.'",139],",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'File'",139],")",";",["T_WHITESPACE","\n    ",139],["T_VARIABLE","$path",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","file_destination",140],"(",["T_VARIABLE","$destination",140],",",["T_WHITESPACE"," ",140],["T_STRING","FILE_EXISTS_ERROR",140],")",";",["T_WHITESPACE","\n    ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","assertEqual",141],"(",["T_VARIABLE","$path",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$destination",141],",",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'Non-existing filepath destination is correct with FILE_EXISTS_ERROR.'",141],",",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'File'",141],")",";",["T_WHITESPACE","\n\n    ",141],["T_VARIABLE","$destination",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'core\/misc\/druplicon.png'",143],";",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$path",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","file_destination",144],"(",["T_VARIABLE","$destination",144],",",["T_WHITESPACE"," ",144],["T_STRING","FILE_EXISTS_REPLACE",144],")",";",["T_WHITESPACE","\n    ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","assertEqual",145],"(",["T_VARIABLE","$path",145],",",["T_WHITESPACE"," ",145],["T_VARIABLE","$destination",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'Existing filepath destination remains the same with FILE_EXISTS_REPLACE.'",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'File'",145],")",";",["T_WHITESPACE","\n    ",145],["T_VARIABLE","$path",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","file_destination",146],"(",["T_VARIABLE","$destination",146],",",["T_WHITESPACE"," ",146],["T_STRING","FILE_EXISTS_RENAME",146],")",";",["T_WHITESPACE","\n    ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","assertNotEqual",147],"(",["T_VARIABLE","$path",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$destination",147],",",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'A new filepath destination is created when filepath destination already exists with FILE_EXISTS_RENAME.'",147],",",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'File'",147],")",";",["T_WHITESPACE","\n    ",147],["T_VARIABLE","$path",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","file_destination",148],"(",["T_VARIABLE","$destination",148],",",["T_WHITESPACE"," ",148],["T_STRING","FILE_EXISTS_ERROR",148],")",";",["T_WHITESPACE","\n    ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","assertEqual",149],"(",["T_VARIABLE","$path",149],",",["T_WHITESPACE"," ",149],["T_STRING","FALSE",149],",",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'An error is returned when filepath destination already exists with FILE_EXISTS_ERROR.'",149],",",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'File'",149],")",";",["T_WHITESPACE","\n  ",149],"}",["T_WHITESPACE","\n\n  ",150],["T_DOC_COMMENT","\/**\n   * Ensure that the file_directory_temp() function always returns a value.\n   *\/",152],["T_WHITESPACE","\n  ",154],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","testFileDirectoryTemp",155],"(",")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n    ",155],["T_COMMENT","\/\/ Start with an empty variable to ensure we have a clean slate.\n",156],["T_WHITESPACE","    ",157],["T_VARIABLE","$config",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","config",157],"(",["T_CONSTANT_ENCAPSED_STRING","'system.file'",157],")",";",["T_WHITESPACE","\n    ",157],["T_VARIABLE","$config",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","set",158],"(",["T_CONSTANT_ENCAPSED_STRING","'path.temporary'",158],",",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","''",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","save",158],"(",")",";",["T_WHITESPACE","\n    ",158],["T_VARIABLE","$tmp_directory",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","file_directory_temp",159],"(",")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertEqual",160],"(",["T_EMPTY","empty",160],"(",["T_VARIABLE","$tmp_directory",160],")",",",["T_WHITESPACE"," ",160],["T_STRING","FALSE",160],",",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'file_directory_temp() returned a non-empty value.'",160],")",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertEqual",161],"(",["T_VARIABLE","$config",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","get",161],"(",["T_CONSTANT_ENCAPSED_STRING","'path.temporary'",161],")",",",["T_WHITESPACE"," ",161],["T_VARIABLE","$tmp_directory",161],")",";",["T_WHITESPACE","\n  ",161],"}",["T_WHITESPACE","\n\n  ",162],["T_DOC_COMMENT","\/**\n   * Tests directory creation.\n   *\/",164],["T_WHITESPACE","\n  ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","testDirectoryCreation",167],"(",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n    ",167],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\File\\FileSystemInterface $file_system *\/",168],["T_WHITESPACE","\n    ",168],["T_VARIABLE","$file_system",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","container",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","get",169],"(",["T_CONSTANT_ENCAPSED_STRING","'file_system'",169],")",";",["T_WHITESPACE","\n\n    ",169],["T_COMMENT","\/\/ mkdir() recursion should work with or without a trailing slash.\n",171],["T_WHITESPACE","    ",172],["T_VARIABLE","$dir",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","siteDirectory",172],["T_WHITESPACE"," ",172],".",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'\/files'",172],";",["T_WHITESPACE","\n    ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","assertTrue",173],"(",["T_VARIABLE","$file_system",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","mkdir",173],"(",["T_VARIABLE","$dir",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'\/foo\/bar'",173],",",["T_WHITESPACE"," ",173],["T_LNUMBER","0775",173],",",["T_WHITESPACE"," ",173],["T_STRING","TRUE",173],")",")",";",["T_WHITESPACE","\n    ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","assertTrue",174],"(",["T_VARIABLE","$file_system",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","mkdir",174],"(",["T_VARIABLE","$dir",174],["T_WHITESPACE"," ",174],".",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'\/foo\/baz\/'",174],",",["T_WHITESPACE"," ",174],["T_LNUMBER","0775",174],",",["T_WHITESPACE"," ",174],["T_STRING","TRUE",174],")",")",";",["T_WHITESPACE","\n  ",174],"}",["T_WHITESPACE","\n\n",175],"}",["T_WHITESPACE","\n",177]]