[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","SafeMarkup",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests adding a custom bundle field.\n *\n * @group system\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","EntitySchemaTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","EntityKernelTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * The database connection used.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",14],["T_WHITESPACE","\n  ",18],["T_PROTECTED","protected",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$database",19],";",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",21],["T_WHITESPACE","\n  ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_FUNCTION","function",24],["T_WHITESPACE"," ",24],["T_STRING","setUp",24],"(",")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n    ",24],["T_STRING","parent",25],["T_DOUBLE_COLON","::",25],["T_STRING","setUp",25],"(",")",";",["T_WHITESPACE","\n    ",25],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","installSchema",26],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",26],",",["T_WHITESPACE"," ",26],["T_ARRAY","array",26],"(",["T_CONSTANT_ENCAPSED_STRING","'users_data'",26],")",")",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","database",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","container",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","get",27],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",27],")",";",["T_WHITESPACE","\n  ",27],"}",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * Tests the custom bundle field creation and deletion.\n   *\/",30],["T_WHITESPACE","\n  ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","testCustomFieldCreateDelete",33],"(",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n    ",33],["T_COMMENT","\/\/ Install the module which adds the field.\n",34],["T_WHITESPACE","    ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","installModule",35],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_schema_test'",35],")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","entityManager",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","clearCachedDefinitions",36],"(",")",";",["T_WHITESPACE","\n    ",36],["T_VARIABLE","$storage_definitions",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","entityManager",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","getFieldStorageDefinitions",37],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",37],")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertNotNull",38],"(",["T_VARIABLE","$storage_definitions",38],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_base_field'",38],"]",",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'Base field definition found.'",38],")",";",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","assertNotNull",39],"(",["T_VARIABLE","$storage_definitions",39],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",39],"]",",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'Bundle field definition found.'",39],")",";",["T_WHITESPACE","\n\n    ",39],["T_COMMENT","\/\/ Make sure the field schema can be created.\n",41],["T_WHITESPACE","    ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","entityManager",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","onFieldStorageDefinitionCreate",42],"(",["T_VARIABLE","$storage_definitions",42],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_base_field'",42],"]",")",";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","entityManager",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","onFieldStorageDefinitionCreate",43],"(",["T_VARIABLE","$storage_definitions",43],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",43],"]",")",";",["T_WHITESPACE","\n    ",43],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Entity\\Sql\\DefaultTableMapping $table_mapping *\/",44],["T_WHITESPACE","\n    ",44],["T_VARIABLE","$table_mapping",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","entityManager",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getStorage",45],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",45],")",["T_OBJECT_OPERATOR","->",45],["T_STRING","getTableMapping",45],"(",")",";",["T_WHITESPACE","\n    ",45],["T_VARIABLE","$base_table",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","current",46],"(",["T_VARIABLE","$table_mapping",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getTableNames",46],"(",")",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$base_column",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","current",47],"(",["T_VARIABLE","$table_mapping",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getColumnNames",47],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_base_field'",47],")",")",";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","assertTrue",48],"(",["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","database",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","schema",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","fieldExists",48],"(",["T_VARIABLE","$base_table",48],",",["T_WHITESPACE"," ",48],["T_VARIABLE","$base_column",48],")",",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'Table column created'",48],")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$table",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$table_mapping",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getDedicatedDataTableName",49],"(",["T_VARIABLE","$storage_definitions",49],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",49],"]",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","assertTrue",50],"(",["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","database",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","schema",50],"(",")",["T_OBJECT_OPERATOR","->",50],["T_STRING","tableExists",50],"(",["T_VARIABLE","$table",50],")",",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'Table created'",50],")",";",["T_WHITESPACE","\n\n    ",50],["T_COMMENT","\/\/ Make sure the field schema can be deleted.\n",52],["T_WHITESPACE","    ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","entityManager",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","onFieldStorageDefinitionDelete",53],"(",["T_VARIABLE","$storage_definitions",53],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_base_field'",53],"]",")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","entityManager",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","onFieldStorageDefinitionDelete",54],"(",["T_VARIABLE","$storage_definitions",54],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",54],"]",")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertFalse",55],"(",["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","database",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","schema",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","fieldExists",55],"(",["T_VARIABLE","$base_table",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$base_column",55],")",",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'Table column dropped'",55],")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","assertFalse",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","database",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","schema",56],"(",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","tableExists",56],"(",["T_VARIABLE","$table",56],")",",",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'Table dropped'",56],")",";",["T_WHITESPACE","\n  ",56],"}",["T_WHITESPACE","\n\n  ",57],["T_DOC_COMMENT","\/**\n   * Updates the entity type definition.\n   *\n   * @param bool $alter\n   *   Whether the original definition should be altered or not.\n   *\/",59],["T_WHITESPACE","\n  ",64],["T_PROTECTED","protected",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","updateEntityType",65],"(",["T_VARIABLE","$alter",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$entity_test_id",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",66],";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$original",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","entityManager",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getDefinition",67],"(",["T_VARIABLE","$entity_test_id",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","entityManager",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","clearCachedDefinitions",68],"(",")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","state",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","set",69],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_schema_update'",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$alter",69],")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$entity_type",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","entityManager",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getDefinition",70],"(",["T_VARIABLE","$entity_test_id",70],")",";",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","entityManager",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","onEntityTypeUpdate",71],"(",["T_VARIABLE","$entity_type",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$original",71],")",";",["T_WHITESPACE","\n  ",71],"}",["T_WHITESPACE","\n\n  ",72],["T_DOC_COMMENT","\/**\n   * Tests that entity schema responds to changes in the entity type definition.\n   *\/",74],["T_WHITESPACE","\n  ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","testEntitySchemaUpdate",77],"(",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","installModule",78],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_schema_test'",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$storage_definitions",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","entityManager",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getFieldStorageDefinitions",79],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",79],")",";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","entityManager",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","onFieldStorageDefinitionCreate",80],"(",["T_VARIABLE","$storage_definitions",80],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_base_field'",80],"]",")",";",["T_WHITESPACE","\n    ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","entityManager",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","onFieldStorageDefinitionCreate",81],"(",["T_VARIABLE","$storage_definitions",81],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",81],"]",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$schema_handler",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","database",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","schema",82],"(",")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$tables",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'entity_test_revision'",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'entity_test_field_data'",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'entity_test_field_revision'",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$dedicated_tables",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test__custom_bundle_field'",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'entity_test_revision__custom_bundle_field'",84],")",";",["T_WHITESPACE","\n\n    ",84],["T_COMMENT","\/\/ Initially only the base table and the dedicated field data table should\n",86],["T_WHITESPACE","    ",87],["T_COMMENT","\/\/ exist.\n",87],["T_WHITESPACE","    ",88],["T_FOREACH","foreach",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$tables",88],["T_WHITESPACE"," ",88],["T_AS","as",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$index",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$table",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n      ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","assertEqual",89],"(",["T_VARIABLE","$schema_handler",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","tableExists",89],"(",["T_VARIABLE","$table",89],")",",",["T_WHITESPACE"," ",89],"!",["T_VARIABLE","$index",89],",",["T_WHITESPACE"," ",89],["T_STRING","SafeMarkup",89],["T_DOUBLE_COLON","::",89],["T_STRING","format",89],"(",["T_CONSTANT_ENCAPSED_STRING","'Entity schema correct for the @table table.'",89],",",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$table",89],")",")",")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertTrue",91],"(",["T_VARIABLE","$schema_handler",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","tableExists",91],"(",["T_VARIABLE","$dedicated_tables",91],"[",["T_LNUMBER","0",91],"]",")",",",["T_WHITESPACE"," ",91],["T_STRING","SafeMarkup",91],["T_DOUBLE_COLON","::",91],["T_STRING","format",91],"(",["T_CONSTANT_ENCAPSED_STRING","'Field schema correct for the @table table.'",91],",",["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$table",91],")",")",")",";",["T_WHITESPACE","\n\n    ",91],["T_COMMENT","\/\/ Update the entity type definition and check that the entity schema now\n",93],["T_WHITESPACE","    ",94],["T_COMMENT","\/\/ supports translations and revisions.\n",94],["T_WHITESPACE","    ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","updateEntityType",95],"(",["T_STRING","TRUE",95],")",";",["T_WHITESPACE","\n    ",95],["T_FOREACH","foreach",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$tables",96],["T_WHITESPACE"," ",96],["T_AS","as",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$table",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n      ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","assertTrue",97],"(",["T_VARIABLE","$schema_handler",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","tableExists",97],"(",["T_VARIABLE","$table",97],")",",",["T_WHITESPACE"," ",97],["T_STRING","SafeMarkup",97],["T_DOUBLE_COLON","::",97],["T_STRING","format",97],"(",["T_CONSTANT_ENCAPSED_STRING","'Entity schema correct for the @table table.'",97],",",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$table",97],")",")",")",";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n    ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$dedicated_tables",99],["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$table",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","assertTrue",100],"(",["T_VARIABLE","$schema_handler",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","tableExists",100],"(",["T_VARIABLE","$table",100],")",",",["T_WHITESPACE"," ",100],["T_STRING","SafeMarkup",100],["T_DOUBLE_COLON","::",100],["T_STRING","format",100],"(",["T_CONSTANT_ENCAPSED_STRING","'Field schema correct for the @table table.'",100],",",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$table",100],")",")",")",";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_COMMENT","\/\/ Revert changes and check that the entity schema now does not support\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ neither translations nor revisions.\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","updateEntityType",105],"(",["T_STRING","FALSE",105],")",";",["T_WHITESPACE","\n    ",105],["T_FOREACH","foreach",106],["T_WHITESPACE"," ",106],"(",["T_VARIABLE","$tables",106],["T_WHITESPACE"," ",106],["T_AS","as",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$index",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$table",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n      ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertEqual",107],"(",["T_VARIABLE","$schema_handler",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","tableExists",107],"(",["T_VARIABLE","$table",107],")",",",["T_WHITESPACE"," ",107],"!",["T_VARIABLE","$index",107],",",["T_WHITESPACE"," ",107],["T_STRING","SafeMarkup",107],["T_DOUBLE_COLON","::",107],["T_STRING","format",107],"(",["T_CONSTANT_ENCAPSED_STRING","'Entity schema correct for the @table table.'",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$table",107],")",")",")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","assertTrue",109],"(",["T_VARIABLE","$schema_handler",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","tableExists",109],"(",["T_VARIABLE","$dedicated_tables",109],"[",["T_LNUMBER","0",109],"]",")",",",["T_WHITESPACE"," ",109],["T_STRING","SafeMarkup",109],["T_DOUBLE_COLON","::",109],["T_STRING","format",109],"(",["T_CONSTANT_ENCAPSED_STRING","'Field schema correct for the @table table.'",109],",",["T_WHITESPACE"," ",109],["T_ARRAY","array",109],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$table",109],")",")",")",";",["T_WHITESPACE","\n  ",109],"}",["T_WHITESPACE","\n\n  ",110],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",112],["T_WHITESPACE","\n  ",114],["T_PROTECTED","protected",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","refreshServices",115],"(",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n    ",115],["T_STRING","parent",116],["T_DOUBLE_COLON","::",116],["T_STRING","refreshServices",116],"(",")",";",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","database",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","container",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","get",117],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",117],")",";",["T_WHITESPACE","\n  ",117],"}",["T_WHITESPACE","\n\n  ",118],["T_DOC_COMMENT","\/**\n   * Tests that modifying the UUID field for a translatable entity works.\n   *\/",120],["T_WHITESPACE","\n  ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","testModifyingTranslatableColumnSchema",123],"(",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n    ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","installModule",124],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_schema_test'",124],")",";",["T_WHITESPACE","\n    ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","updateEntityType",125],"(",["T_STRING","TRUE",125],")",";",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$fields",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_log'",126],",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'uuid'",126],"]",";",["T_WHITESPACE","\n    ",126],["T_FOREACH","foreach",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$fields",127],["T_WHITESPACE"," ",127],["T_AS","as",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$field_name",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n      ",127],["T_VARIABLE","$original_definition",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","entityManager",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getBaseFieldDefinitions",128],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",128],")","[",["T_VARIABLE","$field_name",128],"]",";",["T_WHITESPACE","\n      ",128],["T_VARIABLE","$new_definition",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_CLONE","clone",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$original_definition",129],";",["T_WHITESPACE","\n      ",129],["T_VARIABLE","$new_definition",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setLabel",130],"(",["T_VARIABLE","$original_definition",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getLabel",130],"(",")",["T_WHITESPACE"," ",130],".",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","', the other one'",130],")",";",["T_WHITESPACE","\n      ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","assertTrue",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","entityManager",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getStorage",131],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",131],")",["T_WHITESPACE","\n        ",131],["T_OBJECT_OPERATOR","->",132],["T_STRING","requiresFieldDataMigration",132],"(",["T_VARIABLE","$new_definition",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$original_definition",132],")",")",";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n  ",133],"}",["T_WHITESPACE","\n\n  ",134],["T_DOC_COMMENT","\/**\n   * Tests fields from an uninstalled module are removed from the schema.\n   *\/",136],["T_WHITESPACE","\n  ",138],["T_PUBLIC","public",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","testCleanUpStorageDefinition",139],"(",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n    ",139],["T_COMMENT","\/\/ Find all the entity types provided by the entity_test module and install\n",140],["T_WHITESPACE","    ",141],["T_COMMENT","\/\/ the schema for them.\n",141],["T_WHITESPACE","    ",142],["T_VARIABLE","$entity_type_ids",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],"[","]",";",["T_WHITESPACE","\n    ",142],["T_VARIABLE","$entities",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_NS_SEPARATOR","\\",143],["T_STRING","Drupal",143],["T_DOUBLE_COLON","::",143],["T_STRING","entityManager",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getDefinitions",143],"(",")",";",["T_WHITESPACE","\n    ",143],["T_FOREACH","foreach",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$entities",144],["T_WHITESPACE"," ",144],["T_AS","as",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$entity_type_id",144],["T_WHITESPACE"," ",144],["T_DOUBLE_ARROW","=>",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$definition",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n      ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$definition",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getProvider",145],"(",")",["T_WHITESPACE"," ",145],["T_IS_EQUAL","==",145],["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","installEntitySchema",146],"(",["T_VARIABLE","$entity_type_id",146],")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$entity_type_ids",147],"[","]",["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$entity_type_id",147],";",["T_WHITESPACE","\n      ",147],"}",";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_COMMENT","\/\/ Get a list of all the entities in the schema.\n",151],["T_WHITESPACE","    ",152],["T_VARIABLE","$key_value_store",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Drupal",152],["T_DOUBLE_COLON","::",152],["T_STRING","keyValue",152],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.storage_schema.sql'",152],")",";",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$schema",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$key_value_store",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getAll",153],"(",")",";",["T_WHITESPACE","\n\n    ",153],["T_COMMENT","\/\/ Count the storage definitions provided by the entity_test module, so that\n",155],["T_WHITESPACE","    ",156],["T_COMMENT","\/\/ after uninstall we can be sure there were some to be deleted.\n",156],["T_WHITESPACE","    ",157],["T_VARIABLE","$entity_type_id_count",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_LNUMBER","0",157],";",["T_WHITESPACE","\n\n    ",157],["T_FOREACH","foreach",159],["T_WHITESPACE"," ",159],"(",["T_STRING","array_keys",159],"(",["T_VARIABLE","$schema",159],")",["T_WHITESPACE"," ",159],["T_AS","as",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$storage_definition_name",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n      ",159],["T_LIST","list",160],"(",["T_VARIABLE","$entity_type_id",160],",",["T_WHITESPACE"," ",160],",",")",["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","explode",160],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$storage_definition_name",160],")",";",["T_WHITESPACE","\n      ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_STRING","in_array",161],"(",["T_VARIABLE","$entity_type_id",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$entity_type_ids",161],")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$entity_type_id_count",162],["T_INC","++",162],";",["T_WHITESPACE","\n      ",162],"}",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_COMMENT","\/\/ Ensure that there are storage definitions from the entity_test module.\n",166],["T_WHITESPACE","    ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","assertNotEqual",167],"(",["T_VARIABLE","$entity_type_id_count",167],",",["T_WHITESPACE"," ",167],["T_LNUMBER","0",167],",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'There are storage definitions provided by the entity_test module in the schema.'",167],")",";",["T_WHITESPACE","\n\n    ",167],["T_COMMENT","\/\/ Uninstall the entity_test module.\n",169],["T_WHITESPACE","    ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","container",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","get",170],"(",["T_CONSTANT_ENCAPSED_STRING","'module_installer'",170],")",["T_OBJECT_OPERATOR","->",170],["T_STRING","uninstall",170],"(",["T_ARRAY","array",170],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",170],")",")",";",["T_WHITESPACE","\n\n    ",170],["T_COMMENT","\/\/ Get a list of all the entities in the schema.\n",172],["T_WHITESPACE","    ",173],["T_VARIABLE","$key_value_store",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_NS_SEPARATOR","\\",173],["T_STRING","Drupal",173],["T_DOUBLE_COLON","::",173],["T_STRING","keyValue",173],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.storage_schema.sql'",173],")",";",["T_WHITESPACE","\n    ",173],["T_VARIABLE","$schema",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$key_value_store",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getAll",174],"(",")",";",["T_WHITESPACE","\n\n    ",174],["T_COMMENT","\/\/ Count the storage definitions that come from entity types provided by\n",176],["T_WHITESPACE","    ",177],["T_COMMENT","\/\/ the entity_test module.\n",177],["T_WHITESPACE","    ",178],["T_VARIABLE","$entity_type_id_count",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_LNUMBER","0",178],";",["T_WHITESPACE","\n\n    ",178],["T_FOREACH","foreach",180],["T_WHITESPACE"," ",180],"(",["T_STRING","array_keys",180],"(",["T_VARIABLE","$schema",180],")",["T_WHITESPACE"," ",180],["T_AS","as",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$storage_definition_name",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n      ",180],["T_LIST","list",181],"(",["T_VARIABLE","$entity_type_id",181],",",["T_WHITESPACE"," ",181],",",")",["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","explode",181],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$storage_definition_name",181],")",";",["T_WHITESPACE","\n      ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_STRING","in_array",182],"(",["T_VARIABLE","$entity_type_id",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$entity_type_ids",182],")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$entity_type_id_count",183],["T_INC","++",183],";",["T_WHITESPACE","\n      ",183],"}",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_COMMENT","\/\/ Ensure that all storage definitions have been removed from the schema.\n",187],["T_WHITESPACE","    ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","assertEqual",188],"(",["T_VARIABLE","$entity_type_id_count",188],",",["T_WHITESPACE"," ",188],["T_LNUMBER","0",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'After uninstalling entity_test module the schema should not contains fields from entities provided by the module.'",188],")",";",["T_WHITESPACE","\n  ",188],"}",["T_WHITESPACE","\n\n",189],"}",["T_WHITESPACE","\n",191]]