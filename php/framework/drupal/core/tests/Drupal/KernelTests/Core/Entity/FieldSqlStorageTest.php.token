[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Unicode",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Exception",7],["T_NS_SEPARATOR","\\",7],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","field",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Entity",8],["T_NS_SEPARATOR","\\",8],["T_STRING","FieldConfig",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","field",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Entity",9],["T_NS_SEPARATOR","\\",9],["T_STRING","FieldStorageConfig",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Tests Field SQL Storage .\n *\n * Field_sql_storage.module implements the default back-end storage plugin\n * for the Field Storage API.\n *\n * @group Entity\n *\/",11],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","FieldSqlStorageTest",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_STRING","EntityKernelTestBase",19],["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",21],["T_WHITESPACE","\n  ",25],["T_PUBLIC","public",26],["T_WHITESPACE"," ",26],["T_STATIC","static",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$modules",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_ARRAY","array",26],"(",["T_CONSTANT_ENCAPSED_STRING","'field'",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'field_test'",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'text'",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",26],")",";",["T_WHITESPACE","\n\n  ",26],["T_DOC_COMMENT","\/**\n   * The name of the created field.\n   *\n   * @var string\n   *\/",28],["T_WHITESPACE","\n  ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$fieldName",33],";",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * @var int\n   *\/",35],["T_WHITESPACE","\n  ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$fieldCardinality",38],";",["T_WHITESPACE","\n\n  ",38],["T_DOC_COMMENT","\/**\n   * A field storage to use in this class.\n   *\n   * @var \\Drupal\\field\\Entity\\FieldStorageConfig\n   *\/",40],["T_WHITESPACE","\n  ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$fieldStorage",45],";",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * A field to use in this test class.\n   *\n   * @var \\Drupal\\field\\Entity\\FieldConfig\n   *\/",47],["T_WHITESPACE","\n  ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$field",52],";",["T_WHITESPACE","\n\n  ",52],["T_DOC_COMMENT","\/**\n   * Name of the data table of the field.\n   *\n   * @var string\n   *\/",54],["T_WHITESPACE","\n  ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$table",59],";",["T_WHITESPACE","\n\n  ",59],["T_DOC_COMMENT","\/**\n   * Name of the revision table of the field.\n   *\n   * @var string\n   *\/",61],["T_WHITESPACE","\n  ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$revisionTable",66],";",["T_WHITESPACE","\n\n  ",66],["T_DOC_COMMENT","\/**\n   * The table mapping for the tested entity type.\n   *\n   * @var \\Drupal\\Core\\Entity\\Sql\\DefaultTableMapping $table_mapping\n   *\/",68],["T_WHITESPACE","\n  ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$tableMapping",73],";",["T_WHITESPACE","\n\n  ",73],["T_PROTECTED","protected",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","setUp",75],"(",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n    ",75],["T_STRING","parent",76],["T_DOUBLE_COLON","::",76],["T_STRING","setUp",76],"(",")",";",["T_WHITESPACE","\n\n    ",76],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","installEntitySchema",78],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$entity_type",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",79],";",["T_WHITESPACE","\n\n    ",79],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","fieldName",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","strtolower",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","randomMachineName",81],"(",")",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","fieldCardinality",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_LNUMBER","4",82],";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","fieldStorage",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","FieldStorageConfig",83],["T_DOUBLE_COLON","::",83],["T_STRING","create",83],"(",["T_ARRAY","array",83],"(",["T_WHITESPACE","\n      ",83],["T_CONSTANT_ENCAPSED_STRING","'field_name'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","fieldName",84],",",["T_WHITESPACE","\n      ",84],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",85],["T_WHITESPACE"," ",85],["T_DOUBLE_ARROW","=>",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$entity_type",85],",",["T_WHITESPACE","\n      ",85],["T_CONSTANT_ENCAPSED_STRING","'type'",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'test_field'",86],",",["T_WHITESPACE","\n      ",86],["T_CONSTANT_ENCAPSED_STRING","'cardinality'",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","fieldCardinality",87],",",["T_WHITESPACE","\n    ",87],")",")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","fieldStorage",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","save",89],"(",")",";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","field",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","FieldConfig",90],["T_DOUBLE_COLON","::",90],["T_STRING","create",90],"(","[",["T_WHITESPACE","\n      ",90],["T_CONSTANT_ENCAPSED_STRING","'field_storage'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","fieldStorage",91],",",["T_WHITESPACE","\n      ",91],["T_CONSTANT_ENCAPSED_STRING","'bundle'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$entity_type",92],["T_WHITESPACE","\n    ",92],"]",")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","field",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","save",94],"(",")",";",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Entity\\Sql\\DefaultTableMapping $table_mapping *\/",96],["T_WHITESPACE","\n    ",96],["T_VARIABLE","$table_mapping",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Drupal",97],["T_DOUBLE_COLON","::",97],["T_STRING","entityManager",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","getStorage",97],"(",["T_VARIABLE","$entity_type",97],")",["T_OBJECT_OPERATOR","->",97],["T_STRING","getTableMapping",97],"(",")",";",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","tableMapping",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$table_mapping",98],";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","table",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$table_mapping",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getDedicatedDataTableName",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","fieldStorage",99],")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","revisionTable",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$table_mapping",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getDedicatedRevisionTableName",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","fieldStorage",100],")",";",["T_WHITESPACE","\n  ",100],"}",["T_WHITESPACE","\n\n  ",101],["T_DOC_COMMENT","\/**\n   * Tests field loading works correctly by inserting directly in the tables.\n   *\/",103],["T_WHITESPACE","\n  ",105],["T_FUNCTION","function",106],["T_WHITESPACE"," ",106],["T_STRING","testFieldLoad",106],"(",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$entity_type",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$bundle",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",107],";",["T_WHITESPACE","\n    ",107],["T_VARIABLE","$storage",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","container",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","get",108],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",108],")",["T_OBJECT_OPERATOR","->",108],["T_STRING","getStorage",108],"(",["T_VARIABLE","$entity_type",108],")",";",["T_WHITESPACE","\n\n    ",108],["T_VARIABLE","$columns",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_ARRAY","array",110],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'deleted'",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'delta'",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'langcode'",110],",",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","tableMapping",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getFieldColumnName",110],"(",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","fieldStorage",110],",",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'value'",110],")",")",";",["T_WHITESPACE","\n\n    ",110],["T_COMMENT","\/\/ Create an entity with four revisions.\n",112],["T_WHITESPACE","    ",113],["T_VARIABLE","$revision_ids",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_ARRAY","array",113],"(",")",";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$entity",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","container",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","get",114],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",114],")",["T_WHITESPACE","\n      ",114],["T_OBJECT_OPERATOR","->",115],["T_STRING","getStorage",115],"(",["T_VARIABLE","$entity_type",115],")",["T_WHITESPACE","\n      ",115],["T_OBJECT_OPERATOR","->",116],["T_STRING","create",116],"(",")",";",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$entity",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","save",117],"(",")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$revision_ids",118],"[","]",["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$entity",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getRevisionId",118],"(",")",";",["T_WHITESPACE","\n    ",118],["T_FOR","for",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$i",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_LNUMBER","0",119],";",["T_WHITESPACE"," ",119],["T_VARIABLE","$i",119],["T_WHITESPACE"," ",119],"<",["T_WHITESPACE"," ",119],["T_LNUMBER","4",119],";",["T_WHITESPACE"," ",119],["T_VARIABLE","$i",119],["T_INC","++",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n      ",119],["T_VARIABLE","$entity",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","setNewRevision",120],"(",")",";",["T_WHITESPACE","\n      ",120],["T_VARIABLE","$entity",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","save",121],"(",")",";",["T_WHITESPACE","\n      ",121],["T_VARIABLE","$revision_ids",122],"[","]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$entity",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getRevisionId",122],"(",")",";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_COMMENT","\/\/ Generate values and insert them directly in the storage tables.\n",125],["T_WHITESPACE","    ",126],["T_VARIABLE","$values",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",")",";",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$query",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","db_insert",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","revisionTable",127],")",["T_OBJECT_OPERATOR","->",127],["T_STRING","fields",127],"(",["T_VARIABLE","$columns",127],")",";",["T_WHITESPACE","\n    ",127],["T_FOREACH","foreach",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$revision_ids",128],["T_WHITESPACE"," ",128],["T_AS","as",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$revision_id",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n      ",128],["T_COMMENT","\/\/ Put one value too many.\n",129],["T_WHITESPACE","      ",130],["T_FOR","for",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$delta",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_LNUMBER","0",130],";",["T_WHITESPACE"," ",130],["T_VARIABLE","$delta",130],["T_WHITESPACE"," ",130],["T_IS_SMALLER_OR_EQUAL","<=",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","fieldCardinality",130],";",["T_WHITESPACE"," ",130],["T_VARIABLE","$delta",130],["T_INC","++",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$value",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","mt_rand",131],"(",["T_LNUMBER","1",131],",",["T_WHITESPACE"," ",131],["T_LNUMBER","127",131],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$values",132],"[",["T_VARIABLE","$revision_id",132],"]","[","]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$value",132],";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$query",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","values",133],"(",["T_ARRAY","array",133],"(",["T_VARIABLE","$bundle",133],",",["T_WHITESPACE"," ",133],["T_LNUMBER","0",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$entity",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","id",133],"(",")",",",["T_WHITESPACE"," ",133],["T_VARIABLE","$revision_id",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$delta",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$entity",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","language",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","getId",133],"(",")",",",["T_WHITESPACE"," ",133],["T_VARIABLE","$value",133],")",")",";",["T_WHITESPACE","\n      ",133],"}",["T_WHITESPACE","\n      ",134],["T_VARIABLE","$query",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","execute",135],"(",")",";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n    ",136],["T_VARIABLE","$query",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","db_insert",137],"(",["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","table",137],")",["T_OBJECT_OPERATOR","->",137],["T_STRING","fields",137],"(",["T_VARIABLE","$columns",137],")",";",["T_WHITESPACE","\n    ",137],["T_FOREACH","foreach",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$values",138],"[",["T_VARIABLE","$revision_id",138],"]",["T_WHITESPACE"," ",138],["T_AS","as",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$delta",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$value",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n      ",138],["T_VARIABLE","$query",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","values",139],"(",["T_ARRAY","array",139],"(",["T_VARIABLE","$bundle",139],",",["T_WHITESPACE"," ",139],["T_LNUMBER","0",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$entity",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","id",139],"(",")",",",["T_WHITESPACE"," ",139],["T_VARIABLE","$revision_id",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$delta",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$entity",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","language",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","getId",139],"(",")",",",["T_WHITESPACE"," ",139],["T_VARIABLE","$value",139],")",")",";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n    ",140],["T_VARIABLE","$query",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","execute",141],"(",")",";",["T_WHITESPACE","\n\n    ",141],["T_COMMENT","\/\/ Load every revision and check the values.\n",143],["T_WHITESPACE","    ",144],["T_FOREACH","foreach",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$revision_ids",144],["T_WHITESPACE"," ",144],["T_AS","as",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$revision_id",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n      ",144],["T_VARIABLE","$entity",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$storage",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","loadRevision",145],"(",["T_VARIABLE","$revision_id",145],")",";",["T_WHITESPACE","\n      ",145],["T_FOREACH","foreach",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$values",146],"[",["T_VARIABLE","$revision_id",146],"]",["T_WHITESPACE"," ",146],["T_AS","as",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$delta",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$value",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n        ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$delta",147],["T_WHITESPACE"," ",147],"<",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","fieldCardinality",147],")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n          ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","assertEqual",148],"(",["T_VARIABLE","$entity",148],["T_OBJECT_OPERATOR","->",148],"{",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","fieldName",148],"}","[",["T_VARIABLE","$delta",148],"]",["T_OBJECT_OPERATOR","->",148],["T_STRING","value",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$value",148],")",";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n        ",149],["T_ELSE","else",150],["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n          ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","assertFalse",151],"(",["T_STRING","array_key_exists",151],"(",["T_VARIABLE","$delta",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$entity",151],["T_OBJECT_OPERATOR","->",151],"{",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","fieldName",151],"}",")",")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n      ",152],"}",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_COMMENT","\/\/ Load the \"current revision\" and check the values.\n",156],["T_WHITESPACE","    ",157],["T_VARIABLE","$entity",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$storage",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","load",157],"(",["T_VARIABLE","$entity",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","id",157],"(",")",")",";",["T_WHITESPACE","\n    ",157],["T_FOREACH","foreach",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$values",158],"[",["T_VARIABLE","$revision_id",158],"]",["T_WHITESPACE"," ",158],["T_AS","as",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$delta",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$value",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n      ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$delta",159],["T_WHITESPACE"," ",159],"<",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","fieldCardinality",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertEqual",160],"(",["T_VARIABLE","$entity",160],["T_OBJECT_OPERATOR","->",160],"{",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","fieldName",160],"}","[",["T_VARIABLE","$delta",160],"]",["T_OBJECT_OPERATOR","->",160],["T_STRING","value",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$value",160],")",";",["T_WHITESPACE","\n      ",160],"}",["T_WHITESPACE","\n      ",161],["T_ELSE","else",162],["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","assertFalse",163],"(",["T_STRING","array_key_exists",163],"(",["T_VARIABLE","$delta",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$entity",163],["T_OBJECT_OPERATOR","->",163],"{",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","fieldName",163],"}",")",")",";",["T_WHITESPACE","\n      ",163],"}",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n\n    ",165],["T_COMMENT","\/\/ Add a translation in an unavailable language code and verify it is not\n",167],["T_WHITESPACE","    ",168],["T_COMMENT","\/\/ loaded.\n",168],["T_WHITESPACE","    ",169],["T_VARIABLE","$unavailable_langcode",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'xx'",169],";",["T_WHITESPACE","\n    ",169],["T_VARIABLE","$values",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_VARIABLE","$bundle",170],",",["T_WHITESPACE"," ",170],["T_LNUMBER","0",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$entity",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","id",170],"(",")",",",["T_WHITESPACE"," ",170],["T_VARIABLE","$entity",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getRevisionId",170],"(",")",",",["T_WHITESPACE"," ",170],["T_LNUMBER","0",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$unavailable_langcode",170],",",["T_WHITESPACE"," ",170],["T_STRING","mt_rand",170],"(",["T_LNUMBER","1",170],",",["T_WHITESPACE"," ",170],["T_LNUMBER","127",170],")",")",";",["T_WHITESPACE","\n    ",170],["T_STRING","db_insert",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","table",171],")",["T_OBJECT_OPERATOR","->",171],["T_STRING","fields",171],"(",["T_VARIABLE","$columns",171],")",["T_OBJECT_OPERATOR","->",171],["T_STRING","values",171],"(",["T_VARIABLE","$values",171],")",["T_OBJECT_OPERATOR","->",171],["T_STRING","execute",171],"(",")",";",["T_WHITESPACE","\n    ",171],["T_STRING","db_insert",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","revisionTable",172],")",["T_OBJECT_OPERATOR","->",172],["T_STRING","fields",172],"(",["T_VARIABLE","$columns",172],")",["T_OBJECT_OPERATOR","->",172],["T_STRING","values",172],"(",["T_VARIABLE","$values",172],")",["T_OBJECT_OPERATOR","->",172],["T_STRING","execute",172],"(",")",";",["T_WHITESPACE","\n    ",172],["T_VARIABLE","$entity",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$storage",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","load",173],"(",["T_VARIABLE","$entity",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","id",173],"(",")",")",";",["T_WHITESPACE","\n    ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","assertFalse",174],"(",["T_STRING","array_key_exists",174],"(",["T_VARIABLE","$unavailable_langcode",174],",",["T_WHITESPACE"," ",174],["T_VARIABLE","$entity",174],["T_OBJECT_OPERATOR","->",174],"{",["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","fieldName",174],"}",")",")",";",["T_WHITESPACE","\n  ",174],"}",["T_WHITESPACE","\n\n  ",175],["T_DOC_COMMENT","\/**\n   * Tests field saving works correctly by reading directly from the tables.\n   *\/",177],["T_WHITESPACE","\n  ",179],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","testFieldWrite",180],"(",")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n    ",180],["T_VARIABLE","$entity_type",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$bundle",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",181],";",["T_WHITESPACE","\n    ",181],["T_VARIABLE","$entity",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","container",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","get",182],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",182],")",["T_WHITESPACE","\n      ",182],["T_OBJECT_OPERATOR","->",183],["T_STRING","getStorage",183],"(",["T_VARIABLE","$entity_type",183],")",["T_WHITESPACE","\n      ",183],["T_OBJECT_OPERATOR","->",184],["T_STRING","create",184],"(",")",";",["T_WHITESPACE","\n\n    ",184],["T_VARIABLE","$revision_values",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",")",";",["T_WHITESPACE","\n\n    ",186],["T_COMMENT","\/\/ Check insert. Add one value too many.\n",188],["T_WHITESPACE","    ",189],["T_VARIABLE","$values",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_ARRAY","array",189],"(",")",";",["T_WHITESPACE","\n    ",189],["T_FOR","for",190],["T_WHITESPACE"," ",190],"(",["T_VARIABLE","$delta",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_LNUMBER","0",190],";",["T_WHITESPACE"," ",190],["T_VARIABLE","$delta",190],["T_WHITESPACE"," ",190],["T_IS_SMALLER_OR_EQUAL","<=",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","fieldCardinality",190],";",["T_WHITESPACE"," ",190],["T_VARIABLE","$delta",190],["T_INC","++",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n      ",190],["T_VARIABLE","$values",191],"[",["T_VARIABLE","$delta",191],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",191],"]",["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","mt_rand",191],"(",["T_LNUMBER","1",191],",",["T_WHITESPACE"," ",191],["T_LNUMBER","127",191],")",";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n    ",192],["T_VARIABLE","$entity",193],["T_OBJECT_OPERATOR","->",193],"{",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","fieldName",193],"}",["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$values",193],";",["T_WHITESPACE","\n    ",193],["T_VARIABLE","$entity",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","save",194],"(",")",";",["T_WHITESPACE","\n\n    ",194],["T_COMMENT","\/\/ Read the tables and check the correct values have been stored.\n",196],["T_WHITESPACE","    ",197],["T_VARIABLE","$rows",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","db_select",197],"(",["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","table",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'t'",197],")",["T_OBJECT_OPERATOR","->",197],["T_STRING","fields",197],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",197],")",["T_OBJECT_OPERATOR","->",197],["T_STRING","execute",197],"(",")",["T_OBJECT_OPERATOR","->",197],["T_STRING","fetchAllAssoc",197],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",197],",",["T_WHITESPACE"," ",197],["T_NS_SEPARATOR","\\",197],["T_STRING","PDO",197],["T_DOUBLE_COLON","::",197],["T_STRING","FETCH_ASSOC",197],")",";",["T_WHITESPACE","\n    ",197],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","assertEqual",198],"(",["T_STRING","count",198],"(",["T_VARIABLE","$rows",198],")",",",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","fieldCardinality",198],")",";",["T_WHITESPACE","\n    ",198],["T_FOREACH","foreach",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$rows",199],["T_WHITESPACE"," ",199],["T_AS","as",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$delta",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$row",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n      ",199],["T_VARIABLE","$expected",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_ARRAY","array",200],"(",["T_WHITESPACE","\n        ",200],["T_CONSTANT_ENCAPSED_STRING","'bundle'",201],["T_WHITESPACE"," ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$bundle",201],",",["T_WHITESPACE","\n        ",201],["T_CONSTANT_ENCAPSED_STRING","'deleted'",202],["T_WHITESPACE"," ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_LNUMBER","0",202],",",["T_WHITESPACE","\n        ",202],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",203],["T_WHITESPACE"," ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$entity",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","id",203],"(",")",",",["T_WHITESPACE","\n        ",203],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$entity",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getRevisionId",204],"(",")",",",["T_WHITESPACE","\n        ",204],["T_CONSTANT_ENCAPSED_STRING","'langcode'",205],["T_WHITESPACE"," ",205],["T_DOUBLE_ARROW","=>",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$entity",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","language",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getId",205],"(",")",",",["T_WHITESPACE","\n        ",205],["T_CONSTANT_ENCAPSED_STRING","'delta'",206],["T_WHITESPACE"," ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$delta",206],",",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","fieldName",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'_value'",207],["T_WHITESPACE"," ",207],["T_DOUBLE_ARROW","=>",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$values",207],"[",["T_VARIABLE","$delta",207],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",207],"]",",",["T_WHITESPACE","\n      ",207],")",";",["T_WHITESPACE","\n      ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","assertEqual",209],"(",["T_VARIABLE","$row",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$expected",209],",",["T_WHITESPACE"," ",209],"\"",["T_ENCAPSED_AND_WHITESPACE","Row ",209],["T_VARIABLE","$delta",209],["T_ENCAPSED_AND_WHITESPACE"," was stored as expected.",209],"\"",")",";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_COMMENT","\/\/ Test update. Add less values and check that the previous values did not\n",212],["T_WHITESPACE","    ",213],["T_COMMENT","\/\/ persist.\n",213],["T_WHITESPACE","    ",214],["T_VARIABLE","$values",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",")",";",["T_WHITESPACE","\n    ",214],["T_FOR","for",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$delta",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_LNUMBER","0",215],";",["T_WHITESPACE"," ",215],["T_VARIABLE","$delta",215],["T_WHITESPACE"," ",215],["T_IS_SMALLER_OR_EQUAL","<=",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","fieldCardinality",215],["T_WHITESPACE"," ",215],"-",["T_WHITESPACE"," ",215],["T_LNUMBER","2",215],";",["T_WHITESPACE"," ",215],["T_VARIABLE","$delta",215],["T_INC","++",215],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n      ",215],["T_VARIABLE","$values",216],"[",["T_VARIABLE","$delta",216],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",216],"]",["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_STRING","mt_rand",216],"(",["T_LNUMBER","1",216],",",["T_WHITESPACE"," ",216],["T_LNUMBER","127",216],")",";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n    ",217],["T_VARIABLE","$entity",218],["T_OBJECT_OPERATOR","->",218],"{",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","fieldName",218],"}",["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$values",218],";",["T_WHITESPACE","\n    ",218],["T_VARIABLE","$entity",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","save",219],"(",")",";",["T_WHITESPACE","\n    ",219],["T_VARIABLE","$rows",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","db_select",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","table",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'t'",220],")",["T_OBJECT_OPERATOR","->",220],["T_STRING","fields",220],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",220],")",["T_OBJECT_OPERATOR","->",220],["T_STRING","execute",220],"(",")",["T_OBJECT_OPERATOR","->",220],["T_STRING","fetchAllAssoc",220],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",220],",",["T_WHITESPACE"," ",220],["T_NS_SEPARATOR","\\",220],["T_STRING","PDO",220],["T_DOUBLE_COLON","::",220],["T_STRING","FETCH_ASSOC",220],")",";",["T_WHITESPACE","\n    ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","assertEqual",221],"(",["T_STRING","count",221],"(",["T_VARIABLE","$rows",221],")",",",["T_WHITESPACE"," ",221],["T_STRING","count",221],"(",["T_VARIABLE","$values",221],")",")",";",["T_WHITESPACE","\n    ",221],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$rows",222],["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$delta",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$row",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n      ",222],["T_VARIABLE","$expected",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_ARRAY","array",223],"(",["T_WHITESPACE","\n        ",223],["T_CONSTANT_ENCAPSED_STRING","'bundle'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$bundle",224],",",["T_WHITESPACE","\n        ",224],["T_CONSTANT_ENCAPSED_STRING","'deleted'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_LNUMBER","0",225],",",["T_WHITESPACE","\n        ",225],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",226],["T_WHITESPACE"," ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$entity",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","id",226],"(",")",",",["T_WHITESPACE","\n        ",226],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$entity",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getRevisionId",227],"(",")",",",["T_WHITESPACE","\n        ",227],["T_CONSTANT_ENCAPSED_STRING","'langcode'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$entity",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","language",228],"(",")",["T_OBJECT_OPERATOR","->",228],["T_STRING","getId",228],"(",")",",",["T_WHITESPACE","\n        ",228],["T_CONSTANT_ENCAPSED_STRING","'delta'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$delta",229],",",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","fieldName",230],["T_WHITESPACE"," ",230],".",["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'_value'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$values",230],"[",["T_VARIABLE","$delta",230],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",230],"]",",",["T_WHITESPACE","\n      ",230],")",";",["T_WHITESPACE","\n      ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","assertEqual",232],"(",["T_VARIABLE","$row",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$expected",232],",",["T_WHITESPACE"," ",232],"\"",["T_ENCAPSED_AND_WHITESPACE","Row ",232],["T_VARIABLE","$delta",232],["T_ENCAPSED_AND_WHITESPACE"," was stored as expected.",232],"\"",")",";",["T_WHITESPACE","\n    ",232],"}",["T_WHITESPACE","\n\n    ",233],["T_COMMENT","\/\/ Create a new revision.\n",235],["T_WHITESPACE","    ",236],["T_VARIABLE","$revision_values",236],"[",["T_VARIABLE","$entity",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getRevisionId",236],"(",")","]",["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$values",236],";",["T_WHITESPACE","\n    ",236],["T_VARIABLE","$values",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_ARRAY","array",237],"(",")",";",["T_WHITESPACE","\n    ",237],["T_FOR","for",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$delta",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_LNUMBER","0",238],";",["T_WHITESPACE"," ",238],["T_VARIABLE","$delta",238],["T_WHITESPACE"," ",238],"<",["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","fieldCardinality",238],";",["T_WHITESPACE"," ",238],["T_VARIABLE","$delta",238],["T_INC","++",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n      ",238],["T_VARIABLE","$values",239],"[",["T_VARIABLE","$delta",239],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",239],"]",["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","mt_rand",239],"(",["T_LNUMBER","1",239],",",["T_WHITESPACE"," ",239],["T_LNUMBER","127",239],")",";",["T_WHITESPACE","\n    ",239],"}",["T_WHITESPACE","\n    ",240],["T_VARIABLE","$entity",241],["T_OBJECT_OPERATOR","->",241],"{",["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","fieldName",241],"}",["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$values",241],";",["T_WHITESPACE","\n    ",241],["T_VARIABLE","$entity",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setNewRevision",242],"(",")",";",["T_WHITESPACE","\n    ",242],["T_VARIABLE","$entity",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","save",243],"(",")",";",["T_WHITESPACE","\n    ",243],["T_VARIABLE","$revision_values",244],"[",["T_VARIABLE","$entity",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getRevisionId",244],"(",")","]",["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$values",244],";",["T_WHITESPACE","\n\n    ",244],["T_COMMENT","\/\/ Check that data for both revisions are in the revision table.\n",246],["T_WHITESPACE","    ",247],["T_FOREACH","foreach",247],["T_WHITESPACE"," ",247],"(",["T_VARIABLE","$revision_values",247],["T_WHITESPACE"," ",247],["T_AS","as",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$revision_id",247],["T_WHITESPACE"," ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$values",247],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n      ",247],["T_VARIABLE","$rows",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","db_select",248],"(",["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","revisionTable",248],",",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'t'",248],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","fields",248],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",248],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","condition",248],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$revision_id",248],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","execute",248],"(",")",["T_OBJECT_OPERATOR","->",248],["T_STRING","fetchAllAssoc",248],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",248],",",["T_WHITESPACE"," ",248],["T_NS_SEPARATOR","\\",248],["T_STRING","PDO",248],["T_DOUBLE_COLON","::",248],["T_STRING","FETCH_ASSOC",248],")",";",["T_WHITESPACE","\n      ",248],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","assertEqual",249],"(",["T_STRING","count",249],"(",["T_VARIABLE","$rows",249],")",",",["T_WHITESPACE"," ",249],["T_STRING","min",249],"(",["T_STRING","count",249],"(",["T_VARIABLE","$values",249],")",",",["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","fieldCardinality",249],")",")",";",["T_WHITESPACE","\n      ",249],["T_FOREACH","foreach",250],["T_WHITESPACE"," ",250],"(",["T_VARIABLE","$rows",250],["T_WHITESPACE"," ",250],["T_AS","as",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$delta",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$row",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$expected",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_ARRAY","array",251],"(",["T_WHITESPACE","\n          ",251],["T_CONSTANT_ENCAPSED_STRING","'bundle'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$bundle",252],",",["T_WHITESPACE","\n          ",252],["T_CONSTANT_ENCAPSED_STRING","'deleted'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_LNUMBER","0",253],",",["T_WHITESPACE","\n          ",253],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",254],["T_WHITESPACE"," ",254],["T_DOUBLE_ARROW","=>",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$entity",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","id",254],"(",")",",",["T_WHITESPACE","\n          ",254],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",255],["T_WHITESPACE"," ",255],["T_DOUBLE_ARROW","=>",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$revision_id",255],",",["T_WHITESPACE","\n          ",255],["T_CONSTANT_ENCAPSED_STRING","'langcode'",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$entity",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","language",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getId",256],"(",")",",",["T_WHITESPACE","\n          ",256],["T_CONSTANT_ENCAPSED_STRING","'delta'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$delta",257],",",["T_WHITESPACE","\n          ",257],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","fieldName",258],["T_WHITESPACE"," ",258],".",["T_WHITESPACE"," ",258],["T_CONSTANT_ENCAPSED_STRING","'_value'",258],["T_WHITESPACE"," ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$values",258],"[",["T_VARIABLE","$delta",258],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",258],"]",",",["T_WHITESPACE","\n        ",258],")",";",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","assertEqual",260],"(",["T_VARIABLE","$row",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$expected",260],",",["T_WHITESPACE"," ",260],"\"",["T_ENCAPSED_AND_WHITESPACE","Row ",260],["T_VARIABLE","$delta",260],["T_ENCAPSED_AND_WHITESPACE"," was stored as expected.",260],"\"",")",";",["T_WHITESPACE","\n      ",260],"}",["T_WHITESPACE","\n    ",261],"}",["T_WHITESPACE","\n\n    ",262],["T_COMMENT","\/\/ Test emptying the field.\n",264],["T_WHITESPACE","    ",265],["T_VARIABLE","$entity",265],["T_OBJECT_OPERATOR","->",265],"{",["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","fieldName",265],"}",["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","NULL",265],";",["T_WHITESPACE","\n    ",265],["T_VARIABLE","$entity",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","save",266],"(",")",";",["T_WHITESPACE","\n    ",266],["T_VARIABLE","$rows",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","db_select",267],"(",["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","table",267],",",["T_WHITESPACE"," ",267],["T_CONSTANT_ENCAPSED_STRING","'t'",267],")",["T_OBJECT_OPERATOR","->",267],["T_STRING","fields",267],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",267],")",["T_OBJECT_OPERATOR","->",267],["T_STRING","execute",267],"(",")",["T_OBJECT_OPERATOR","->",267],["T_STRING","fetchAllAssoc",267],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",267],",",["T_WHITESPACE"," ",267],["T_NS_SEPARATOR","\\",267],["T_STRING","PDO",267],["T_DOUBLE_COLON","::",267],["T_STRING","FETCH_ASSOC",267],")",";",["T_WHITESPACE","\n    ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","assertEqual",268],"(",["T_STRING","count",268],"(",["T_VARIABLE","$rows",268],")",",",["T_WHITESPACE"," ",268],["T_LNUMBER","0",268],")",";",["T_WHITESPACE","\n  ",268],"}",["T_WHITESPACE","\n\n  ",269],["T_DOC_COMMENT","\/**\n   * Tests that long entity type and field names do not break.\n   *\/",271],["T_WHITESPACE","\n  ",273],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","testLongNames",274],"(",")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n    ",274],["T_COMMENT","\/\/ Use one of the longest entity_type names in core.\n",275],["T_WHITESPACE","    ",276],["T_VARIABLE","$entity_type",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$bundle",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'entity_test_label_callback'",276],";",["T_WHITESPACE","\n    ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","installEntitySchema",277],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_label_callback'",277],")",";",["T_WHITESPACE","\n    ",277],["T_VARIABLE","$storage",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","container",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","get",278],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",278],")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getStorage",278],"(",["T_VARIABLE","$entity_type",278],")",";",["T_WHITESPACE","\n\n    ",278],["T_COMMENT","\/\/ Create two fields and generate random values.\n",280],["T_WHITESPACE","    ",281],["T_VARIABLE","$name_base",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","Unicode",281],["T_DOUBLE_COLON","::",281],["T_STRING","strtolower",281],"(",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","randomMachineName",281],"(",["T_STRING","FieldStorageConfig",281],["T_DOUBLE_COLON","::",281],["T_STRING","NAME_MAX_LENGTH",281],["T_WHITESPACE"," ",281],"-",["T_WHITESPACE"," ",281],["T_LNUMBER","1",281],")",")",";",["T_WHITESPACE","\n    ",281],["T_VARIABLE","$field_names",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_ARRAY","array",282],"(",")",";",["T_WHITESPACE","\n    ",282],["T_VARIABLE","$values",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_ARRAY","array",283],"(",")",";",["T_WHITESPACE","\n    ",283],["T_FOR","for",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$i",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_LNUMBER","0",284],";",["T_WHITESPACE"," ",284],["T_VARIABLE","$i",284],["T_WHITESPACE"," ",284],"<",["T_WHITESPACE"," ",284],["T_LNUMBER","2",284],";",["T_WHITESPACE"," ",284],["T_VARIABLE","$i",284],["T_INC","++",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n      ",284],["T_VARIABLE","$field_names",285],"[",["T_VARIABLE","$i",285],"]",["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$name_base",285],["T_WHITESPACE"," ",285],".",["T_WHITESPACE"," ",285],["T_VARIABLE","$i",285],";",["T_WHITESPACE","\n      ",285],["T_STRING","FieldStorageConfig",286],["T_DOUBLE_COLON","::",286],["T_STRING","create",286],"(",["T_ARRAY","array",286],"(",["T_WHITESPACE","\n        ",286],["T_CONSTANT_ENCAPSED_STRING","'field_name'",287],["T_WHITESPACE"," ",287],["T_DOUBLE_ARROW","=>",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$field_names",287],"[",["T_VARIABLE","$i",287],"]",",",["T_WHITESPACE","\n        ",287],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",288],["T_WHITESPACE"," ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$entity_type",288],",",["T_WHITESPACE","\n        ",288],["T_CONSTANT_ENCAPSED_STRING","'type'",289],["T_WHITESPACE"," ",289],["T_DOUBLE_ARROW","=>",289],["T_WHITESPACE"," ",289],["T_CONSTANT_ENCAPSED_STRING","'test_field'",289],",",["T_WHITESPACE","\n      ",289],")",")",["T_OBJECT_OPERATOR","->",290],["T_STRING","save",290],"(",")",";",["T_WHITESPACE","\n      ",290],["T_STRING","FieldConfig",291],["T_DOUBLE_COLON","::",291],["T_STRING","create",291],"(","[",["T_WHITESPACE","\n        ",291],["T_CONSTANT_ENCAPSED_STRING","'field_name'",292],["T_WHITESPACE"," ",292],["T_DOUBLE_ARROW","=>",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$field_names",292],"[",["T_VARIABLE","$i",292],"]",",",["T_WHITESPACE","\n        ",292],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$entity_type",293],",",["T_WHITESPACE","\n        ",293],["T_CONSTANT_ENCAPSED_STRING","'bundle'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$bundle",294],",",["T_WHITESPACE","\n      ",294],"]",")",["T_OBJECT_OPERATOR","->",295],["T_STRING","save",295],"(",")",";",["T_WHITESPACE","\n      ",295],["T_VARIABLE","$values",296],"[",["T_VARIABLE","$field_names",296],"[",["T_VARIABLE","$i",296],"]","]",["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_STRING","mt_rand",296],"(",["T_LNUMBER","1",296],",",["T_WHITESPACE"," ",296],["T_LNUMBER","127",296],")",";",["T_WHITESPACE","\n    ",296],"}",["T_WHITESPACE","\n\n    ",297],["T_COMMENT","\/\/ Save an entity with values.\n",299],["T_WHITESPACE","    ",300],["T_VARIABLE","$entity",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","container",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","get",300],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",300],")",["T_WHITESPACE","\n      ",300],["T_OBJECT_OPERATOR","->",301],["T_STRING","getStorage",301],"(",["T_VARIABLE","$entity_type",301],")",["T_WHITESPACE","\n      ",301],["T_OBJECT_OPERATOR","->",302],["T_STRING","create",302],"(",["T_VARIABLE","$values",302],")",";",["T_WHITESPACE","\n    ",302],["T_VARIABLE","$entity",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","save",303],"(",")",";",["T_WHITESPACE","\n\n    ",303],["T_COMMENT","\/\/ Load the entity back and check the values.\n",305],["T_WHITESPACE","    ",306],["T_VARIABLE","$entity",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$storage",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","load",306],"(",["T_VARIABLE","$entity",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","id",306],"(",")",")",";",["T_WHITESPACE","\n    ",306],["T_FOREACH","foreach",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$field_names",307],["T_WHITESPACE"," ",307],["T_AS","as",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$field_name",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n      ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","assertEqual",308],"(",["T_VARIABLE","$entity",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","get",308],"(",["T_VARIABLE","$field_name",308],")",["T_OBJECT_OPERATOR","->",308],["T_STRING","value",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$values",308],"[",["T_VARIABLE","$field_name",308],"]",")",";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n  ",309],"}",["T_WHITESPACE","\n\n  ",310],["T_DOC_COMMENT","\/**\n   * Test trying to update a field with data.\n   *\/",312],["T_WHITESPACE","\n  ",314],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","testUpdateFieldSchemaWithData",315],"(",")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n    ",315],["T_VARIABLE","$entity_type",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",316],";",["T_WHITESPACE","\n    ",316],["T_COMMENT","\/\/ Create a decimal 5.2 field and add some data.\n",317],["T_WHITESPACE","    ",318],["T_VARIABLE","$field_storage",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","FieldStorageConfig",318],["T_DOUBLE_COLON","::",318],["T_STRING","create",318],"(",["T_ARRAY","array",318],"(",["T_WHITESPACE","\n      ",318],["T_CONSTANT_ENCAPSED_STRING","'field_name'",319],["T_WHITESPACE"," ",319],["T_DOUBLE_ARROW","=>",319],["T_WHITESPACE"," ",319],["T_CONSTANT_ENCAPSED_STRING","'decimal52'",319],",",["T_WHITESPACE","\n      ",319],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$entity_type",320],",",["T_WHITESPACE","\n      ",320],["T_CONSTANT_ENCAPSED_STRING","'type'",321],["T_WHITESPACE"," ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","'decimal'",321],",",["T_WHITESPACE","\n      ",321],["T_CONSTANT_ENCAPSED_STRING","'settings'",322],["T_WHITESPACE"," ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_ARRAY","array",322],"(",["T_CONSTANT_ENCAPSED_STRING","'precision'",322],["T_WHITESPACE"," ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_LNUMBER","5",322],",",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'scale'",322],["T_WHITESPACE"," ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_LNUMBER","2",322],")",",",["T_WHITESPACE","\n    ",322],")",")",";",["T_WHITESPACE","\n    ",323],["T_VARIABLE","$field_storage",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","save",324],"(",")",";",["T_WHITESPACE","\n    ",324],["T_VARIABLE","$field",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_STRING","FieldConfig",325],["T_DOUBLE_COLON","::",325],["T_STRING","create",325],"(","[",["T_WHITESPACE","\n      ",325],["T_CONSTANT_ENCAPSED_STRING","'field_storage'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$field_storage",326],",",["T_WHITESPACE","\n      ",326],["T_CONSTANT_ENCAPSED_STRING","'bundle'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$entity_type",327],",",["T_WHITESPACE","\n    ",327],"]",")",";",["T_WHITESPACE","\n    ",328],["T_VARIABLE","$field",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","save",329],"(",")",";",["T_WHITESPACE","\n    ",329],["T_VARIABLE","$entity",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","container",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","get",330],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",330],")",["T_WHITESPACE","\n      ",330],["T_OBJECT_OPERATOR","->",331],["T_STRING","getStorage",331],"(",["T_VARIABLE","$entity_type",331],")",["T_WHITESPACE","\n      ",331],["T_OBJECT_OPERATOR","->",332],["T_STRING","create",332],"(",["T_ARRAY","array",332],"(",["T_WHITESPACE","\n        ",332],["T_CONSTANT_ENCAPSED_STRING","'id'",333],["T_WHITESPACE"," ",333],["T_DOUBLE_ARROW","=>",333],["T_WHITESPACE"," ",333],["T_LNUMBER","0",333],",",["T_WHITESPACE","\n        ",333],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",334],["T_WHITESPACE"," ",334],["T_DOUBLE_ARROW","=>",334],["T_WHITESPACE"," ",334],["T_LNUMBER","0",334],",",["T_WHITESPACE","\n      ",334],")",")",";",["T_WHITESPACE","\n    ",335],["T_VARIABLE","$entity",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","decimal52",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","value",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_CONSTANT_ENCAPSED_STRING","'1.235'",336],";",["T_WHITESPACE","\n    ",336],["T_VARIABLE","$entity",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","save",337],"(",")",";",["T_WHITESPACE","\n\n    ",337],["T_COMMENT","\/\/ Attempt to update the field in a way that would work without data.\n",339],["T_WHITESPACE","    ",340],["T_VARIABLE","$field_storage",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","setSetting",340],"(",["T_CONSTANT_ENCAPSED_STRING","'scale'",340],",",["T_WHITESPACE"," ",340],["T_LNUMBER","3",340],")",";",["T_WHITESPACE","\n    ",340],["T_TRY","try",341],["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n      ",341],["T_VARIABLE","$field_storage",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","save",342],"(",")",";",["T_WHITESPACE","\n      ",342],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","fail",343],"(",["T_STRING","t",343],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot update field schema with data.'",343],")",")",";",["T_WHITESPACE","\n    ",343],"}",["T_WHITESPACE","\n    ",344],["T_CATCH","catch",345],["T_WHITESPACE"," ",345],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",345],["T_WHITESPACE"," ",345],["T_VARIABLE","$e",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n      ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","pass",346],"(",["T_STRING","t",346],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot update field schema with data.'",346],")",")",";",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n  ",347],"}",["T_WHITESPACE","\n\n  ",348],["T_DOC_COMMENT","\/**\n   * Test that failure to create fields is handled gracefully.\n   *\/",350],["T_WHITESPACE","\n  ",352],["T_FUNCTION","function",353],["T_WHITESPACE"," ",353],["T_STRING","testFieldUpdateFailure",353],"(",")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n    ",353],["T_COMMENT","\/\/ Create a text field.\n",354],["T_WHITESPACE","    ",355],["T_VARIABLE","$field_storage",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_STRING","FieldStorageConfig",355],["T_DOUBLE_COLON","::",355],["T_STRING","create",355],"(",["T_ARRAY","array",355],"(",["T_WHITESPACE","\n      ",355],["T_CONSTANT_ENCAPSED_STRING","'field_name'",356],["T_WHITESPACE"," ",356],["T_DOUBLE_ARROW","=>",356],["T_WHITESPACE"," ",356],["T_CONSTANT_ENCAPSED_STRING","'test_text'",356],",",["T_WHITESPACE","\n      ",356],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",357],["T_WHITESPACE"," ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",357],",",["T_WHITESPACE","\n      ",357],["T_CONSTANT_ENCAPSED_STRING","'type'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_CONSTANT_ENCAPSED_STRING","'text'",358],",",["T_WHITESPACE","\n      ",358],["T_CONSTANT_ENCAPSED_STRING","'settings'",359],["T_WHITESPACE"," ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_ARRAY","array",359],"(",["T_CONSTANT_ENCAPSED_STRING","'max_length'",359],["T_WHITESPACE"," ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_LNUMBER","255",359],")",",",["T_WHITESPACE","\n    ",359],")",")",";",["T_WHITESPACE","\n    ",360],["T_VARIABLE","$field_storage",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","save",361],"(",")",";",["T_WHITESPACE","\n\n    ",361],["T_COMMENT","\/\/ Attempt to update the field in a way that would break the storage. The\n",363],["T_WHITESPACE","    ",364],["T_COMMENT","\/\/ parenthesis suffix is needed because SQLite has *very* relaxed rules for\n",364],["T_WHITESPACE","    ",365],["T_COMMENT","\/\/ data types, so we actually need to provide an invalid SQL syntax in order\n",365],["T_WHITESPACE","    ",366],["T_COMMENT","\/\/ to break it.\n",366],["T_WHITESPACE","    ",367],["T_COMMENT","\/\/ @see https:\/\/www.sqlite.org\/datatype3.html\n",367],["T_WHITESPACE","    ",368],["T_VARIABLE","$prior_field_storage",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$field_storage",368],";",["T_WHITESPACE","\n    ",368],["T_VARIABLE","$field_storage",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","setSetting",369],"(",["T_CONSTANT_ENCAPSED_STRING","'max_length'",369],",",["T_WHITESPACE"," ",369],["T_CONSTANT_ENCAPSED_STRING","'-1)'",369],")",";",["T_WHITESPACE","\n    ",369],["T_TRY","try",370],["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n      ",370],["T_VARIABLE","$field_storage",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","save",371],"(",")",";",["T_WHITESPACE","\n      ",371],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","fail",372],"(",["T_STRING","t",372],"(",["T_CONSTANT_ENCAPSED_STRING","'Update succeeded.'",372],")",")",";",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n    ",373],["T_CATCH","catch",374],["T_WHITESPACE"," ",374],"(",["T_NS_SEPARATOR","\\",374],["T_STRING","Exception",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$e",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n      ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","pass",375],"(",["T_STRING","t",375],"(",["T_CONSTANT_ENCAPSED_STRING","'Update properly failed.'",375],")",")",";",["T_WHITESPACE","\n    ",375],"}",["T_WHITESPACE","\n\n    ",376],["T_COMMENT","\/\/ Ensure that the field tables are still there.\n",378],["T_WHITESPACE","    ",379],["T_VARIABLE","$tables",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_ARRAY","array",379],"(",["T_WHITESPACE","\n      ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","tableMapping",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getDedicatedDataTableName",380],"(",["T_VARIABLE","$prior_field_storage",380],")",",",["T_WHITESPACE","\n      ",380],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","tableMapping",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getDedicatedRevisionTableName",381],"(",["T_VARIABLE","$prior_field_storage",381],")",",",["T_WHITESPACE","\n    ",381],")",";",["T_WHITESPACE","\n    ",382],["T_FOREACH","foreach",383],["T_WHITESPACE"," ",383],"(",["T_VARIABLE","$tables",383],["T_WHITESPACE"," ",383],["T_AS","as",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$table_name",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n      ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","assertTrue",384],"(",["T_STRING","db_table_exists",384],"(",["T_VARIABLE","$table_name",384],")",",",["T_WHITESPACE"," ",384],["T_STRING","t",384],"(",["T_CONSTANT_ENCAPSED_STRING","'Table %table exists.'",384],",",["T_WHITESPACE"," ",384],["T_ARRAY","array",384],"(",["T_CONSTANT_ENCAPSED_STRING","'%table'",384],["T_WHITESPACE"," ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$table_name",384],")",")",")",";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n  ",385],"}",["T_WHITESPACE","\n\n  ",386],["T_DOC_COMMENT","\/**\n   * Test adding and removing indexes while data is present.\n   *\/",388],["T_WHITESPACE","\n  ",390],["T_FUNCTION","function",391],["T_WHITESPACE"," ",391],["T_STRING","testFieldUpdateIndexesWithData",391],"(",")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n    ",391],["T_COMMENT","\/\/ Create a decimal field.\n",392],["T_WHITESPACE","    ",393],["T_VARIABLE","$field_name",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'testfield'",393],";",["T_WHITESPACE","\n    ",393],["T_VARIABLE","$entity_type",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_CONSTANT_ENCAPSED_STRING","'entity_test_rev'",394],";",["T_WHITESPACE","\n    ",394],["T_VARIABLE","$field_storage",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_STRING","FieldStorageConfig",395],["T_DOUBLE_COLON","::",395],["T_STRING","create",395],"(",["T_ARRAY","array",395],"(",["T_WHITESPACE","\n      ",395],["T_CONSTANT_ENCAPSED_STRING","'field_name'",396],["T_WHITESPACE"," ",396],["T_DOUBLE_ARROW","=>",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$field_name",396],",",["T_WHITESPACE","\n      ",396],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",397],["T_WHITESPACE"," ",397],["T_DOUBLE_ARROW","=>",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$entity_type",397],",",["T_WHITESPACE","\n      ",397],["T_CONSTANT_ENCAPSED_STRING","'type'",398],["T_WHITESPACE"," ",398],["T_DOUBLE_ARROW","=>",398],["T_WHITESPACE"," ",398],["T_CONSTANT_ENCAPSED_STRING","'text'",398],",",["T_WHITESPACE","\n    ",398],")",")",";",["T_WHITESPACE","\n    ",399],["T_VARIABLE","$field_storage",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","save",400],"(",")",";",["T_WHITESPACE","\n    ",400],["T_VARIABLE","$field",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_STRING","FieldConfig",401],["T_DOUBLE_COLON","::",401],["T_STRING","create",401],"(","[",["T_WHITESPACE","\n      ",401],["T_CONSTANT_ENCAPSED_STRING","'field_storage'",402],["T_WHITESPACE"," ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$field_storage",402],",",["T_WHITESPACE","\n      ",402],["T_CONSTANT_ENCAPSED_STRING","'bundle'",403],["T_WHITESPACE"," ",403],["T_DOUBLE_ARROW","=>",403],["T_WHITESPACE"," ",403],["T_VARIABLE","$entity_type",403],",",["T_WHITESPACE","\n    ",403],"]",")",";",["T_WHITESPACE","\n    ",404],["T_VARIABLE","$field",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","save",405],"(",")",";",["T_WHITESPACE","\n    ",405],["T_VARIABLE","$tables",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_ARRAY","array",406],"(",["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","tableMapping",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getDedicatedDataTableName",406],"(",["T_VARIABLE","$field_storage",406],")",",",["T_WHITESPACE"," ",406],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","tableMapping",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getDedicatedRevisionTableName",406],"(",["T_VARIABLE","$field_storage",406],")",")",";",["T_WHITESPACE","\n\n    ",406],["T_COMMENT","\/\/ Verify the indexes we will create do not exist yet.\n",408],["T_WHITESPACE","    ",409],["T_FOREACH","foreach",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$tables",409],["T_WHITESPACE"," ",409],["T_AS","as",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$table",409],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n      ",409],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","assertFalse",410],"(",["T_STRING","Database",410],["T_DOUBLE_COLON","::",410],["T_STRING","getConnection",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","schema",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","indexExists",410],"(",["T_VARIABLE","$table",410],",",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","'value'",410],")",",",["T_WHITESPACE"," ",410],["T_STRING","t",410],"(",["T_CONSTANT_ENCAPSED_STRING","\"No index named value exists in @table\"",410],",",["T_WHITESPACE"," ",410],["T_ARRAY","array",410],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",410],["T_WHITESPACE"," ",410],["T_DOUBLE_ARROW","=>",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$table",410],")",")",")",";",["T_WHITESPACE","\n      ",410],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","assertFalse",411],"(",["T_STRING","Database",411],["T_DOUBLE_COLON","::",411],["T_STRING","getConnection",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","schema",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","indexExists",411],"(",["T_VARIABLE","$table",411],",",["T_WHITESPACE"," ",411],["T_CONSTANT_ENCAPSED_STRING","'value_format'",411],")",",",["T_WHITESPACE"," ",411],["T_STRING","t",411],"(",["T_CONSTANT_ENCAPSED_STRING","\"No index named value_format exists in @table\"",411],",",["T_WHITESPACE"," ",411],["T_ARRAY","array",411],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",411],["T_WHITESPACE"," ",411],["T_DOUBLE_ARROW","=>",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$table",411],")",")",")",";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_COMMENT","\/\/ Add data so the table cannot be dropped.\n",414],["T_WHITESPACE","    ",415],["T_VARIABLE","$entity",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","container",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","get",415],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",415],")",["T_WHITESPACE","\n      ",415],["T_OBJECT_OPERATOR","->",416],["T_STRING","getStorage",416],"(",["T_VARIABLE","$entity_type",416],")",["T_WHITESPACE","\n      ",416],["T_OBJECT_OPERATOR","->",417],["T_STRING","create",417],"(",["T_ARRAY","array",417],"(",["T_WHITESPACE","\n        ",417],["T_CONSTANT_ENCAPSED_STRING","'id'",418],["T_WHITESPACE"," ",418],["T_DOUBLE_ARROW","=>",418],["T_WHITESPACE"," ",418],["T_LNUMBER","1",418],",",["T_WHITESPACE","\n        ",418],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",419],["T_WHITESPACE"," ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_LNUMBER","1",419],",",["T_WHITESPACE","\n      ",419],")",")",";",["T_WHITESPACE","\n    ",420],["T_VARIABLE","$entity",421],["T_OBJECT_OPERATOR","->",421],["T_VARIABLE","$field_name",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","value",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_CONSTANT_ENCAPSED_STRING","'field data'",421],";",["T_WHITESPACE","\n    ",421],["T_VARIABLE","$entity",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","enforceIsNew",422],"(",")",";",["T_WHITESPACE","\n    ",422],["T_VARIABLE","$entity",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","save",423],"(",")",";",["T_WHITESPACE","\n\n    ",423],["T_COMMENT","\/\/ Add an index.\n",425],["T_WHITESPACE","    ",426],["T_VARIABLE","$field_storage",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","setIndexes",426],"(","[",["T_CONSTANT_ENCAPSED_STRING","'value'",426],["T_WHITESPACE"," ",426],["T_DOUBLE_ARROW","=>",426],["T_WHITESPACE"," ",426],"[","[",["T_CONSTANT_ENCAPSED_STRING","'value'",426],",",["T_WHITESPACE"," ",426],["T_LNUMBER","255",426],"]","]","]",")",";",["T_WHITESPACE","\n    ",426],["T_VARIABLE","$field_storage",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","save",427],"(",")",";",["T_WHITESPACE","\n    ",427],["T_FOREACH","foreach",428],["T_WHITESPACE"," ",428],"(",["T_VARIABLE","$tables",428],["T_WHITESPACE"," ",428],["T_AS","as",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$table",428],")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n      ",428],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","assertTrue",429],"(",["T_STRING","Database",429],["T_DOUBLE_COLON","::",429],["T_STRING","getConnection",429],"(",")",["T_OBJECT_OPERATOR","->",429],["T_STRING","schema",429],"(",")",["T_OBJECT_OPERATOR","->",429],["T_STRING","indexExists",429],"(",["T_VARIABLE","$table",429],",",["T_WHITESPACE"," ",429],"\"",["T_CURLY_OPEN","{",429],["T_VARIABLE","$field_name",429],"}",["T_ENCAPSED_AND_WHITESPACE","_value",429],"\"",")",",",["T_WHITESPACE"," ",429],["T_STRING","t",429],"(",["T_CONSTANT_ENCAPSED_STRING","\"Index on value created in @table\"",429],",",["T_WHITESPACE"," ",429],["T_ARRAY","array",429],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",429],["T_WHITESPACE"," ",429],["T_DOUBLE_ARROW","=>",429],["T_WHITESPACE"," ",429],["T_VARIABLE","$table",429],")",")",")",";",["T_WHITESPACE","\n    ",429],"}",["T_WHITESPACE","\n\n    ",430],["T_COMMENT","\/\/ Add a different index, removing the existing custom one.\n",432],["T_WHITESPACE","    ",433],["T_VARIABLE","$field_storage",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","setIndexes",433],"(","[",["T_CONSTANT_ENCAPSED_STRING","'value_format'",433],["T_WHITESPACE"," ",433],["T_DOUBLE_ARROW","=>",433],["T_WHITESPACE"," ",433],"[","[",["T_CONSTANT_ENCAPSED_STRING","'value'",433],",",["T_WHITESPACE"," ",433],["T_LNUMBER","127",433],"]",",",["T_WHITESPACE"," ",433],"[",["T_CONSTANT_ENCAPSED_STRING","'format'",433],",",["T_WHITESPACE"," ",433],["T_LNUMBER","127",433],"]","]","]",")",";",["T_WHITESPACE","\n    ",433],["T_VARIABLE","$field_storage",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","save",434],"(",")",";",["T_WHITESPACE","\n    ",434],["T_FOREACH","foreach",435],["T_WHITESPACE"," ",435],"(",["T_VARIABLE","$tables",435],["T_WHITESPACE"," ",435],["T_AS","as",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$table",435],")",["T_WHITESPACE"," ",435],"{",["T_WHITESPACE","\n      ",435],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","assertTrue",436],"(",["T_STRING","Database",436],["T_DOUBLE_COLON","::",436],["T_STRING","getConnection",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","schema",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","indexExists",436],"(",["T_VARIABLE","$table",436],",",["T_WHITESPACE"," ",436],"\"",["T_CURLY_OPEN","{",436],["T_VARIABLE","$field_name",436],"}",["T_ENCAPSED_AND_WHITESPACE","_value_format",436],"\"",")",",",["T_WHITESPACE"," ",436],["T_STRING","t",436],"(",["T_CONSTANT_ENCAPSED_STRING","\"Index on value_format created in @table\"",436],",",["T_WHITESPACE"," ",436],["T_ARRAY","array",436],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",436],["T_WHITESPACE"," ",436],["T_DOUBLE_ARROW","=>",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$table",436],")",")",")",";",["T_WHITESPACE","\n      ",436],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","assertFalse",437],"(",["T_STRING","Database",437],["T_DOUBLE_COLON","::",437],["T_STRING","getConnection",437],"(",")",["T_OBJECT_OPERATOR","->",437],["T_STRING","schema",437],"(",")",["T_OBJECT_OPERATOR","->",437],["T_STRING","indexExists",437],"(",["T_VARIABLE","$table",437],",",["T_WHITESPACE"," ",437],"\"",["T_CURLY_OPEN","{",437],["T_VARIABLE","$field_name",437],"}",["T_ENCAPSED_AND_WHITESPACE","_value",437],"\"",")",",",["T_WHITESPACE"," ",437],["T_STRING","t",437],"(",["T_CONSTANT_ENCAPSED_STRING","\"Index on value removed in @table\"",437],",",["T_WHITESPACE"," ",437],["T_ARRAY","array",437],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",437],["T_WHITESPACE"," ",437],["T_DOUBLE_ARROW","=>",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$table",437],")",")",")",";",["T_WHITESPACE","\n    ",437],"}",["T_WHITESPACE","\n\n    ",438],["T_COMMENT","\/\/ Verify that the tables were not dropped in the process.\n",440],["T_WHITESPACE","    ",441],["T_VARIABLE","$entity",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","container",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","get",441],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getStorage",441],"(",["T_VARIABLE","$entity_type",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","load",441],"(",["T_LNUMBER","1",441],")",";",["T_WHITESPACE","\n    ",441],["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","assertEqual",442],"(",["T_VARIABLE","$entity",442],["T_OBJECT_OPERATOR","->",442],["T_VARIABLE","$field_name",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","value",442],",",["T_WHITESPACE"," ",442],["T_CONSTANT_ENCAPSED_STRING","'field data'",442],",",["T_WHITESPACE"," ",442],["T_STRING","t",442],"(",["T_CONSTANT_ENCAPSED_STRING","\"Index changes performed without dropping the tables\"",442],")",")",";",["T_WHITESPACE","\n  ",442],"}",["T_WHITESPACE","\n\n  ",443],["T_DOC_COMMENT","\/**\n   * Test foreign key support.\n   *\/",445],["T_WHITESPACE","\n  ",447],["T_FUNCTION","function",448],["T_WHITESPACE"," ",448],["T_STRING","testFieldSqlStorageForeignKeys",448],"(",")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n    ",448],["T_COMMENT","\/\/ Create a 'shape' field, with a configurable foreign key (see\n",449],["T_WHITESPACE","    ",450],["T_COMMENT","\/\/ field_test_field_schema()).\n",450],["T_WHITESPACE","    ",451],["T_VARIABLE","$field_name",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],["T_CONSTANT_ENCAPSED_STRING","'testfield'",451],";",["T_WHITESPACE","\n    ",451],["T_VARIABLE","$foreign_key_name",452],["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'shape'",452],";",["T_WHITESPACE","\n    ",452],["T_VARIABLE","$field_storage",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_STRING","FieldStorageConfig",453],["T_DOUBLE_COLON","::",453],["T_STRING","create",453],"(",["T_ARRAY","array",453],"(",["T_WHITESPACE","\n      ",453],["T_CONSTANT_ENCAPSED_STRING","'field_name'",454],["T_WHITESPACE"," ",454],["T_DOUBLE_ARROW","=>",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$field_name",454],",",["T_WHITESPACE","\n      ",454],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",455],["T_WHITESPACE"," ",455],["T_DOUBLE_ARROW","=>",455],["T_WHITESPACE"," ",455],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",455],",",["T_WHITESPACE","\n      ",455],["T_CONSTANT_ENCAPSED_STRING","'type'",456],["T_WHITESPACE"," ",456],["T_DOUBLE_ARROW","=>",456],["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'shape'",456],",",["T_WHITESPACE","\n      ",456],["T_CONSTANT_ENCAPSED_STRING","'settings'",457],["T_WHITESPACE"," ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_ARRAY","array",457],"(",["T_CONSTANT_ENCAPSED_STRING","'foreign_key_name'",457],["T_WHITESPACE"," ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$foreign_key_name",457],")",",",["T_WHITESPACE","\n    ",457],")",")",";",["T_WHITESPACE","\n    ",458],["T_VARIABLE","$field_storage",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","save",459],"(",")",";",["T_WHITESPACE","\n    ",459],["T_COMMENT","\/\/ Get the field schema.\n",460],["T_WHITESPACE","    ",461],["T_VARIABLE","$schema",461],["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],["T_VARIABLE","$field_storage",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getSchema",461],"(",")",";",["T_WHITESPACE","\n\n    ",461],["T_COMMENT","\/\/ Retrieve the field definition and check that the foreign key is in place.\n",463],["T_WHITESPACE","    ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","assertEqual",464],"(",["T_VARIABLE","$schema",464],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",464],"]","[",["T_VARIABLE","$foreign_key_name",464],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",464],"]",",",["T_WHITESPACE"," ",464],["T_VARIABLE","$foreign_key_name",464],",",["T_WHITESPACE"," ",464],["T_CONSTANT_ENCAPSED_STRING","'Foreign key table name preserved through CRUD'",464],")",";",["T_WHITESPACE","\n    ",464],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","assertEqual",465],"(",["T_VARIABLE","$schema",465],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",465],"]","[",["T_VARIABLE","$foreign_key_name",465],"]","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",465],"]","[",["T_VARIABLE","$foreign_key_name",465],"]",",",["T_WHITESPACE"," ",465],["T_CONSTANT_ENCAPSED_STRING","'id'",465],",",["T_WHITESPACE"," ",465],["T_CONSTANT_ENCAPSED_STRING","'Foreign key column name preserved through CRUD'",465],")",";",["T_WHITESPACE","\n\n    ",465],["T_COMMENT","\/\/ Update the field settings, it should update the foreign key definition too.\n",467],["T_WHITESPACE","    ",468],["T_VARIABLE","$foreign_key_name",468],["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","'color'",468],";",["T_WHITESPACE","\n    ",468],["T_VARIABLE","$field_storage",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","setSetting",469],"(",["T_CONSTANT_ENCAPSED_STRING","'foreign_key_name'",469],",",["T_WHITESPACE"," ",469],["T_VARIABLE","$foreign_key_name",469],")",";",["T_WHITESPACE","\n    ",469],["T_VARIABLE","$field_storage",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","save",470],"(",")",";",["T_WHITESPACE","\n    ",470],["T_COMMENT","\/\/ Reload the field schema after the update.\n",471],["T_WHITESPACE","    ",472],["T_VARIABLE","$schema",472],["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$field_storage",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getSchema",472],"(",")",";",["T_WHITESPACE","\n\n    ",472],["T_COMMENT","\/\/ Check that the foreign key is in place.\n",474],["T_WHITESPACE","    ",475],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","assertEqual",475],"(",["T_VARIABLE","$schema",475],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",475],"]","[",["T_VARIABLE","$foreign_key_name",475],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",475],"]",",",["T_WHITESPACE"," ",475],["T_VARIABLE","$foreign_key_name",475],",",["T_WHITESPACE"," ",475],["T_CONSTANT_ENCAPSED_STRING","'Foreign key table name modified after update'",475],")",";",["T_WHITESPACE","\n    ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","assertEqual",476],"(",["T_VARIABLE","$schema",476],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",476],"]","[",["T_VARIABLE","$foreign_key_name",476],"]","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",476],"]","[",["T_VARIABLE","$foreign_key_name",476],"]",",",["T_WHITESPACE"," ",476],["T_CONSTANT_ENCAPSED_STRING","'id'",476],",",["T_WHITESPACE"," ",476],["T_CONSTANT_ENCAPSED_STRING","'Foreign key column name modified after update'",476],")",";",["T_WHITESPACE","\n  ",476],"}",["T_WHITESPACE","\n\n  ",477],["T_DOC_COMMENT","\/**\n   * Tests table name generation.\n   *\/",479],["T_WHITESPACE","\n  ",481],["T_PUBLIC","public",482],["T_WHITESPACE"," ",482],["T_FUNCTION","function",482],["T_WHITESPACE"," ",482],["T_STRING","testTableNames",482],"(",")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n    ",482],["T_COMMENT","\/\/ Note: we need to test entity types with long names. We therefore use\n",483],["T_WHITESPACE","    ",484],["T_COMMENT","\/\/ fields on imaginary entity types (works as long as we don't actually save\n",484],["T_WHITESPACE","    ",485],["T_COMMENT","\/\/ them), and just check the generated table names.\n",485],["T_WHITESPACE","\n    ",486],["T_COMMENT","\/\/ Short entity type and field name.\n",487],["T_WHITESPACE","    ",488],["T_VARIABLE","$entity_type",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type'",488],";",["T_WHITESPACE","\n    ",488],["T_VARIABLE","$field_name",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_CONSTANT_ENCAPSED_STRING","'short_field_name'",489],";",["T_WHITESPACE","\n    ",489],["T_VARIABLE","$field_storage",490],["T_WHITESPACE"," ",490],"=",["T_WHITESPACE"," ",490],["T_STRING","FieldStorageConfig",490],["T_DOUBLE_COLON","::",490],["T_STRING","create",490],"(",["T_ARRAY","array",490],"(",["T_WHITESPACE","\n      ",490],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",491],["T_WHITESPACE"," ",491],["T_DOUBLE_ARROW","=>",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$entity_type",491],",",["T_WHITESPACE","\n      ",491],["T_CONSTANT_ENCAPSED_STRING","'field_name'",492],["T_WHITESPACE"," ",492],["T_DOUBLE_ARROW","=>",492],["T_WHITESPACE"," ",492],["T_VARIABLE","$field_name",492],",",["T_WHITESPACE","\n      ",492],["T_CONSTANT_ENCAPSED_STRING","'type'",493],["T_WHITESPACE"," ",493],["T_DOUBLE_ARROW","=>",493],["T_WHITESPACE"," ",493],["T_CONSTANT_ENCAPSED_STRING","'test_field'",493],",",["T_WHITESPACE","\n    ",493],")",")",";",["T_WHITESPACE","\n    ",494],["T_VARIABLE","$expected",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type__short_field_name'",495],";",["T_WHITESPACE","\n    ",495],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","assertEqual",496],"(",["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","tableMapping",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getDedicatedDataTableName",496],"(",["T_VARIABLE","$field_storage",496],")",",",["T_WHITESPACE"," ",496],["T_VARIABLE","$expected",496],")",";",["T_WHITESPACE","\n    ",496],["T_VARIABLE","$expected",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type_revision__short_field_name'",497],";",["T_WHITESPACE","\n    ",497],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","assertEqual",498],"(",["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","tableMapping",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getDedicatedRevisionTableName",498],"(",["T_VARIABLE","$field_storage",498],")",",",["T_WHITESPACE"," ",498],["T_VARIABLE","$expected",498],")",";",["T_WHITESPACE","\n\n    ",498],["T_COMMENT","\/\/ Short entity type, long field name\n",500],["T_WHITESPACE","    ",501],["T_VARIABLE","$entity_type",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type'",501],";",["T_WHITESPACE","\n    ",501],["T_VARIABLE","$field_name",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_CONSTANT_ENCAPSED_STRING","'long_field_name_abcdefghijklmnopqrstuvwxyz'",502],";",["T_WHITESPACE","\n    ",502],["T_VARIABLE","$field_storage",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_STRING","FieldStorageConfig",503],["T_DOUBLE_COLON","::",503],["T_STRING","create",503],"(",["T_ARRAY","array",503],"(",["T_WHITESPACE","\n      ",503],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",504],["T_WHITESPACE"," ",504],["T_DOUBLE_ARROW","=>",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$entity_type",504],",",["T_WHITESPACE","\n      ",504],["T_CONSTANT_ENCAPSED_STRING","'field_name'",505],["T_WHITESPACE"," ",505],["T_DOUBLE_ARROW","=>",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$field_name",505],",",["T_WHITESPACE","\n      ",505],["T_CONSTANT_ENCAPSED_STRING","'type'",506],["T_WHITESPACE"," ",506],["T_DOUBLE_ARROW","=>",506],["T_WHITESPACE"," ",506],["T_CONSTANT_ENCAPSED_STRING","'test_field'",506],",",["T_WHITESPACE","\n    ",506],")",")",";",["T_WHITESPACE","\n    ",507],["T_VARIABLE","$expected",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type__'",508],["T_WHITESPACE"," ",508],".",["T_WHITESPACE"," ",508],["T_STRING","substr",508],"(",["T_STRING","hash",508],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",508],",",["T_WHITESPACE"," ",508],["T_VARIABLE","$field_storage",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","uuid",508],"(",")",")",",",["T_WHITESPACE"," ",508],["T_LNUMBER","0",508],",",["T_WHITESPACE"," ",508],["T_LNUMBER","10",508],")",";",["T_WHITESPACE","\n    ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","assertEqual",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","tableMapping",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getDedicatedDataTableName",509],"(",["T_VARIABLE","$field_storage",509],")",",",["T_WHITESPACE"," ",509],["T_VARIABLE","$expected",509],")",";",["T_WHITESPACE","\n    ",509],["T_VARIABLE","$expected",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],["T_CONSTANT_ENCAPSED_STRING","'short_entity_type_r__'",510],["T_WHITESPACE"," ",510],".",["T_WHITESPACE"," ",510],["T_STRING","substr",510],"(",["T_STRING","hash",510],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",510],",",["T_WHITESPACE"," ",510],["T_VARIABLE","$field_storage",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","uuid",510],"(",")",")",",",["T_WHITESPACE"," ",510],["T_LNUMBER","0",510],",",["T_WHITESPACE"," ",510],["T_LNUMBER","10",510],")",";",["T_WHITESPACE","\n    ",510],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","assertEqual",511],"(",["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","tableMapping",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getDedicatedRevisionTableName",511],"(",["T_VARIABLE","$field_storage",511],")",",",["T_WHITESPACE"," ",511],["T_VARIABLE","$expected",511],")",";",["T_WHITESPACE","\n\n    ",511],["T_COMMENT","\/\/ Long entity type, short field name\n",513],["T_WHITESPACE","    ",514],["T_VARIABLE","$entity_type",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopqrstuvwxyz'",514],";",["T_WHITESPACE","\n    ",514],["T_VARIABLE","$field_name",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_CONSTANT_ENCAPSED_STRING","'short_field_name'",515],";",["T_WHITESPACE","\n    ",515],["T_VARIABLE","$field_storage",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_STRING","FieldStorageConfig",516],["T_DOUBLE_COLON","::",516],["T_STRING","create",516],"(",["T_ARRAY","array",516],"(",["T_WHITESPACE","\n      ",516],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",517],["T_WHITESPACE"," ",517],["T_DOUBLE_ARROW","=>",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$entity_type",517],",",["T_WHITESPACE","\n      ",517],["T_CONSTANT_ENCAPSED_STRING","'field_name'",518],["T_WHITESPACE"," ",518],["T_DOUBLE_ARROW","=>",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$field_name",518],",",["T_WHITESPACE","\n      ",518],["T_CONSTANT_ENCAPSED_STRING","'type'",519],["T_WHITESPACE"," ",519],["T_DOUBLE_ARROW","=>",519],["T_WHITESPACE"," ",519],["T_CONSTANT_ENCAPSED_STRING","'test_field'",519],",",["T_WHITESPACE","\n    ",519],")",")",";",["T_WHITESPACE","\n    ",520],["T_VARIABLE","$expected",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopq__'",521],["T_WHITESPACE"," ",521],".",["T_WHITESPACE"," ",521],["T_STRING","substr",521],"(",["T_STRING","hash",521],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$field_storage",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","uuid",521],"(",")",")",",",["T_WHITESPACE"," ",521],["T_LNUMBER","0",521],",",["T_WHITESPACE"," ",521],["T_LNUMBER","10",521],")",";",["T_WHITESPACE","\n    ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","assertEqual",522],"(",["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","tableMapping",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getDedicatedDataTableName",522],"(",["T_VARIABLE","$field_storage",522],")",",",["T_WHITESPACE"," ",522],["T_VARIABLE","$expected",522],")",";",["T_WHITESPACE","\n    ",522],["T_VARIABLE","$expected",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopq_r__'",523],["T_WHITESPACE"," ",523],".",["T_WHITESPACE"," ",523],["T_STRING","substr",523],"(",["T_STRING","hash",523],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",523],",",["T_WHITESPACE"," ",523],["T_VARIABLE","$field_storage",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","uuid",523],"(",")",")",",",["T_WHITESPACE"," ",523],["T_LNUMBER","0",523],",",["T_WHITESPACE"," ",523],["T_LNUMBER","10",523],")",";",["T_WHITESPACE","\n    ",523],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","assertEqual",524],"(",["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","tableMapping",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getDedicatedRevisionTableName",524],"(",["T_VARIABLE","$field_storage",524],")",",",["T_WHITESPACE"," ",524],["T_VARIABLE","$expected",524],")",";",["T_WHITESPACE","\n\n    ",524],["T_COMMENT","\/\/ Long entity type and field name.\n",526],["T_WHITESPACE","    ",527],["T_VARIABLE","$entity_type",527],["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopqrstuvwxyz'",527],";",["T_WHITESPACE","\n    ",527],["T_VARIABLE","$field_name",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_CONSTANT_ENCAPSED_STRING","'long_field_name_abcdefghijklmnopqrstuvwxyz'",528],";",["T_WHITESPACE","\n    ",528],["T_VARIABLE","$field_storage",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_STRING","FieldStorageConfig",529],["T_DOUBLE_COLON","::",529],["T_STRING","create",529],"(",["T_ARRAY","array",529],"(",["T_WHITESPACE","\n      ",529],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",530],["T_WHITESPACE"," ",530],["T_DOUBLE_ARROW","=>",530],["T_WHITESPACE"," ",530],["T_VARIABLE","$entity_type",530],",",["T_WHITESPACE","\n      ",530],["T_CONSTANT_ENCAPSED_STRING","'field_name'",531],["T_WHITESPACE"," ",531],["T_DOUBLE_ARROW","=>",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$field_name",531],",",["T_WHITESPACE","\n      ",531],["T_CONSTANT_ENCAPSED_STRING","'type'",532],["T_WHITESPACE"," ",532],["T_DOUBLE_ARROW","=>",532],["T_WHITESPACE"," ",532],["T_CONSTANT_ENCAPSED_STRING","'test_field'",532],",",["T_WHITESPACE","\n    ",532],")",")",";",["T_WHITESPACE","\n    ",533],["T_VARIABLE","$expected",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopq__'",534],["T_WHITESPACE"," ",534],".",["T_WHITESPACE"," ",534],["T_STRING","substr",534],"(",["T_STRING","hash",534],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$field_storage",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","uuid",534],"(",")",")",",",["T_WHITESPACE"," ",534],["T_LNUMBER","0",534],",",["T_WHITESPACE"," ",534],["T_LNUMBER","10",534],")",";",["T_WHITESPACE","\n    ",534],["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","assertEqual",535],"(",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","tableMapping",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getDedicatedDataTableName",535],"(",["T_VARIABLE","$field_storage",535],")",",",["T_WHITESPACE"," ",535],["T_VARIABLE","$expected",535],")",";",["T_WHITESPACE","\n    ",535],["T_VARIABLE","$expected",536],["T_WHITESPACE"," ",536],"=",["T_WHITESPACE"," ",536],["T_CONSTANT_ENCAPSED_STRING","'long_entity_type_abcdefghijklmnopq_r__'",536],["T_WHITESPACE"," ",536],".",["T_WHITESPACE"," ",536],["T_STRING","substr",536],"(",["T_STRING","hash",536],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",536],",",["T_WHITESPACE"," ",536],["T_VARIABLE","$field_storage",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","uuid",536],"(",")",")",",",["T_WHITESPACE"," ",536],["T_LNUMBER","0",536],",",["T_WHITESPACE"," ",536],["T_LNUMBER","10",536],")",";",["T_WHITESPACE","\n    ",536],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","assertEqual",537],"(",["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","tableMapping",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getDedicatedRevisionTableName",537],"(",["T_VARIABLE","$field_storage",537],")",",",["T_WHITESPACE"," ",537],["T_VARIABLE","$expected",537],")",";",["T_WHITESPACE","\n    ",537],["T_COMMENT","\/\/ Try creating a second field and check there are no clashes.\n",538],["T_WHITESPACE","    ",539],["T_VARIABLE","$field_storage2",539],["T_WHITESPACE"," ",539],"=",["T_WHITESPACE"," ",539],["T_STRING","FieldStorageConfig",539],["T_DOUBLE_COLON","::",539],["T_STRING","create",539],"(",["T_ARRAY","array",539],"(",["T_WHITESPACE","\n      ",539],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",540],["T_WHITESPACE"," ",540],["T_DOUBLE_ARROW","=>",540],["T_WHITESPACE"," ",540],["T_VARIABLE","$entity_type",540],",",["T_WHITESPACE","\n      ",540],["T_CONSTANT_ENCAPSED_STRING","'field_name'",541],["T_WHITESPACE"," ",541],["T_DOUBLE_ARROW","=>",541],["T_WHITESPACE"," ",541],["T_VARIABLE","$field_name",541],["T_WHITESPACE"," ",541],".",["T_WHITESPACE"," ",541],["T_CONSTANT_ENCAPSED_STRING","'2'",541],",",["T_WHITESPACE","\n      ",541],["T_CONSTANT_ENCAPSED_STRING","'type'",542],["T_WHITESPACE"," ",542],["T_DOUBLE_ARROW","=>",542],["T_WHITESPACE"," ",542],["T_CONSTANT_ENCAPSED_STRING","'test_field'",542],",",["T_WHITESPACE","\n    ",542],")",")",";",["T_WHITESPACE","\n    ",543],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","assertNotEqual",544],"(",["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","tableMapping",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getDedicatedDataTableName",544],"(",["T_VARIABLE","$field_storage",544],")",",",["T_WHITESPACE"," ",544],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","tableMapping",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getDedicatedDataTableName",544],"(",["T_VARIABLE","$field_storage2",544],")",")",";",["T_WHITESPACE","\n    ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","assertNotEqual",545],"(",["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","tableMapping",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getDedicatedRevisionTableName",545],"(",["T_VARIABLE","$field_storage",545],")",",",["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","tableMapping",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getDedicatedRevisionTableName",545],"(",["T_VARIABLE","$field_storage2",545],")",")",";",["T_WHITESPACE","\n\n    ",545],["T_COMMENT","\/\/ Deleted field.\n",547],["T_WHITESPACE","    ",548],["T_VARIABLE","$field_storage",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_STRING","FieldStorageConfig",548],["T_DOUBLE_COLON","::",548],["T_STRING","create",548],"(",["T_ARRAY","array",548],"(",["T_WHITESPACE","\n      ",548],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",549],["T_WHITESPACE"," ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_CONSTANT_ENCAPSED_STRING","'some_entity_type'",549],",",["T_WHITESPACE","\n      ",549],["T_CONSTANT_ENCAPSED_STRING","'field_name'",550],["T_WHITESPACE"," ",550],["T_DOUBLE_ARROW","=>",550],["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'some_field_name'",550],",",["T_WHITESPACE","\n      ",550],["T_CONSTANT_ENCAPSED_STRING","'type'",551],["T_WHITESPACE"," ",551],["T_DOUBLE_ARROW","=>",551],["T_WHITESPACE"," ",551],["T_CONSTANT_ENCAPSED_STRING","'test_field'",551],",",["T_WHITESPACE","\n      ",551],["T_CONSTANT_ENCAPSED_STRING","'deleted'",552],["T_WHITESPACE"," ",552],["T_DOUBLE_ARROW","=>",552],["T_WHITESPACE"," ",552],["T_STRING","TRUE",552],",",["T_WHITESPACE","\n    ",552],")",")",";",["T_WHITESPACE","\n    ",553],["T_VARIABLE","$expected",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_CONSTANT_ENCAPSED_STRING","'field_deleted_data_'",554],["T_WHITESPACE"," ",554],".",["T_WHITESPACE"," ",554],["T_STRING","substr",554],"(",["T_STRING","hash",554],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",554],",",["T_WHITESPACE"," ",554],["T_VARIABLE","$field_storage",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","uuid",554],"(",")",")",",",["T_WHITESPACE"," ",554],["T_LNUMBER","0",554],",",["T_WHITESPACE"," ",554],["T_LNUMBER","10",554],")",";",["T_WHITESPACE","\n    ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","assertEqual",555],"(",["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","tableMapping",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getDedicatedDataTableName",555],"(",["T_VARIABLE","$field_storage",555],",",["T_WHITESPACE"," ",555],["T_STRING","TRUE",555],")",",",["T_WHITESPACE"," ",555],["T_VARIABLE","$expected",555],")",";",["T_WHITESPACE","\n    ",555],["T_VARIABLE","$expected",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_CONSTANT_ENCAPSED_STRING","'field_deleted_revision_'",556],["T_WHITESPACE"," ",556],".",["T_WHITESPACE"," ",556],["T_STRING","substr",556],"(",["T_STRING","hash",556],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",556],",",["T_WHITESPACE"," ",556],["T_VARIABLE","$field_storage",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","uuid",556],"(",")",")",",",["T_WHITESPACE"," ",556],["T_LNUMBER","0",556],",",["T_WHITESPACE"," ",556],["T_LNUMBER","10",556],")",";",["T_WHITESPACE","\n    ",556],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","assertEqual",557],"(",["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","tableMapping",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getDedicatedRevisionTableName",557],"(",["T_VARIABLE","$field_storage",557],",",["T_WHITESPACE"," ",557],["T_STRING","TRUE",557],")",",",["T_WHITESPACE"," ",557],["T_VARIABLE","$expected",557],")",";",["T_WHITESPACE","\n  ",557],"}",["T_WHITESPACE","\n\n",558],"}",["T_WHITESPACE","\n",560]]