[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Database",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests delete and truncate queries.\n *\n * The DELETE tests are not as extensive, as all of the interesting code for\n * DELETE queries is in the conditional which is identical to the UPDATE and\n * SELECT conditional handling.\n *\n * The TRUNCATE tests are not extensive either, because the behavior of\n * TRUNCATE queries is not consistent across database engines. We only test\n * that a TRUNCATE query actually deletes all rows from the target table.\n *\n * @group Database\n *\/",5],["T_WHITESPACE","\n",17],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","DeleteTruncateTest",18],["T_WHITESPACE"," ",18],["T_EXTENDS","extends",18],["T_WHITESPACE"," ",18],["T_STRING","DatabaseTestBase",18],["T_WHITESPACE"," ",18],"{",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * Confirms that we can use a subselect in a delete successfully.\n   *\/",20],["T_WHITESPACE","\n  ",22],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","testSubselectDelete",23],"(",")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n    ",23],["T_VARIABLE","$num_records_before",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_STRING","db_query",24],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test_task}'",24],")",["T_OBJECT_OPERATOR","->",24],["T_STRING","fetchField",24],"(",")",";",["T_WHITESPACE","\n    ",24],["T_VARIABLE","$pid_to_delete",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_STRING","db_query",25],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM {test_task} WHERE task = 'sleep'\"",25],")",["T_OBJECT_OPERATOR","->",25],["T_STRING","fetchField",25],"(",")",";",["T_WHITESPACE","\n\n    ",25],["T_VARIABLE","$subquery",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_STRING","db_select",27],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",27],",",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'t'",27],")",["T_WHITESPACE","\n      ",27],["T_OBJECT_OPERATOR","->",28],["T_STRING","fields",28],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",28],",",["T_WHITESPACE"," ",28],["T_ARRAY","array",28],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",28],")",")",["T_WHITESPACE","\n      ",28],["T_OBJECT_OPERATOR","->",29],["T_STRING","condition",29],"(",["T_CONSTANT_ENCAPSED_STRING","'t.id'",29],",",["T_WHITESPACE"," ",29],["T_ARRAY","array",29],"(",["T_VARIABLE","$pid_to_delete",29],")",",",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'IN'",29],")",";",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$delete",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_STRING","db_delete",30],"(",["T_CONSTANT_ENCAPSED_STRING","'test_task'",30],")",["T_WHITESPACE","\n      ",30],["T_OBJECT_OPERATOR","->",31],["T_STRING","condition",31],"(",["T_CONSTANT_ENCAPSED_STRING","'task'",31],",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'sleep'",31],")",["T_WHITESPACE","\n      ",31],["T_OBJECT_OPERATOR","->",32],["T_STRING","condition",32],"(",["T_CONSTANT_ENCAPSED_STRING","'pid'",32],",",["T_WHITESPACE"," ",32],["T_VARIABLE","$subquery",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'IN'",32],")",";",["T_WHITESPACE","\n\n    ",32],["T_VARIABLE","$num_deleted",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_VARIABLE","$delete",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","execute",34],"(",")",";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","assertEqual",35],"(",["T_VARIABLE","$num_deleted",35],",",["T_WHITESPACE"," ",35],["T_LNUMBER","1",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'Deleted 1 record.'",35],")",";",["T_WHITESPACE","\n\n    ",35],["T_VARIABLE","$num_records_after",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","db_query",37],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test_task}'",37],")",["T_OBJECT_OPERATOR","->",37],["T_STRING","fetchField",37],"(",")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertEqual",38],"(",["T_VARIABLE","$num_records_before",38],",",["T_WHITESPACE"," ",38],["T_VARIABLE","$num_records_after",38],["T_WHITESPACE"," ",38],"+",["T_WHITESPACE"," ",38],["T_VARIABLE","$num_deleted",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'Deletion adds up.'",38],")",";",["T_WHITESPACE","\n  ",38],"}",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * Confirms that we can delete a single record successfully.\n   *\/",41],["T_WHITESPACE","\n  ",43],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","testSimpleDelete",44],"(",")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n    ",44],["T_VARIABLE","$num_records_before",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","db_query",45],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test}'",45],")",["T_OBJECT_OPERATOR","->",45],["T_STRING","fetchField",45],"(",")",";",["T_WHITESPACE","\n\n    ",45],["T_VARIABLE","$num_deleted",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","db_delete",47],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",47],")",["T_WHITESPACE","\n      ",47],["T_OBJECT_OPERATOR","->",48],["T_STRING","condition",48],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",48],",",["T_WHITESPACE"," ",48],["T_LNUMBER","1",48],")",["T_WHITESPACE","\n      ",48],["T_OBJECT_OPERATOR","->",49],["T_STRING","execute",49],"(",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","assertIdentical",50],"(",["T_VARIABLE","$num_deleted",50],",",["T_WHITESPACE"," ",50],["T_LNUMBER","1",50],",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'Deleted 1 record.'",50],")",";",["T_WHITESPACE","\n\n    ",50],["T_VARIABLE","$num_records_after",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","db_query",52],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test}'",52],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","fetchField",52],"(",")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","assertEqual",53],"(",["T_VARIABLE","$num_records_before",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$num_records_after",53],["T_WHITESPACE"," ",53],"+",["T_WHITESPACE"," ",53],["T_VARIABLE","$num_deleted",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'Deletion adds up.'",53],")",";",["T_WHITESPACE","\n  ",53],"}",["T_WHITESPACE","\n\n  ",54],["T_DOC_COMMENT","\/**\n   * Confirms that we can truncate a whole table successfully.\n   *\/",56],["T_WHITESPACE","\n  ",58],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","testTruncate",59],"(",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$num_records_before",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","db_query",60],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT COUNT(*) FROM {test}\"",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","fetchField",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","assertTrue",61],"(",["T_VARIABLE","$num_records_before",61],["T_WHITESPACE"," ",61],">",["T_WHITESPACE"," ",61],["T_LNUMBER","0",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'The table is not empty.'",61],")",";",["T_WHITESPACE","\n\n    ",61],["T_STRING","db_truncate",63],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",63],")",["T_OBJECT_OPERATOR","->",63],["T_STRING","execute",63],"(",")",";",["T_WHITESPACE","\n\n    ",63],["T_VARIABLE","$num_records_after",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","db_query",65],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT COUNT(*) FROM {test}\"",65],")",["T_OBJECT_OPERATOR","->",65],["T_STRING","fetchField",65],"(",")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertEqual",66],"(",["T_LNUMBER","0",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$num_records_after",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Truncate really deletes everything.'",66],")",";",["T_WHITESPACE","\n  ",66],"}",["T_WHITESPACE","\n\n  ",67],["T_DOC_COMMENT","\/**\n   * Confirms that we can delete a single special column name record successfully.\n   *\/",69],["T_WHITESPACE","\n  ",71],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","testSpecialColumnDelete",72],"(",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$num_records_before",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","db_query",73],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test_special_columns}'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","fetchField",73],"(",")",";",["T_WHITESPACE","\n\n    ",73],["T_VARIABLE","$num_deleted",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","db_delete",75],"(",["T_CONSTANT_ENCAPSED_STRING","'test_special_columns'",75],")",["T_WHITESPACE","\n      ",75],["T_OBJECT_OPERATOR","->",76],["T_STRING","condition",76],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",76],",",["T_WHITESPACE"," ",76],["T_LNUMBER","1",76],")",["T_WHITESPACE","\n      ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","execute",77],"(",")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertIdentical",78],"(",["T_VARIABLE","$num_deleted",78],",",["T_WHITESPACE"," ",78],["T_LNUMBER","1",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Deleted 1 special column record.'",78],")",";",["T_WHITESPACE","\n\n    ",78],["T_VARIABLE","$num_records_after",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","db_query",80],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {test_special_columns}'",80],")",["T_OBJECT_OPERATOR","->",80],["T_STRING","fetchField",80],"(",")",";",["T_WHITESPACE","\n    ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","assertEqual",81],"(",["T_VARIABLE","$num_records_before",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$num_records_after",81],["T_WHITESPACE"," ",81],"+",["T_WHITESPACE"," ",81],["T_VARIABLE","$num_deleted",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'Deletion adds up.'",81],")",";",["T_WHITESPACE","\n  ",81],"}",["T_WHITESPACE","\n\n",82],"}",["T_WHITESPACE","\n",84]]