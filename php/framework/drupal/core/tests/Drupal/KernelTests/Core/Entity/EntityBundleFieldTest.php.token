[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests adding a custom bundle field.\n *\n * @group Entity\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","EntityBundleFieldTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","EntityKernelTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",12],["T_WHITESPACE","\n  ",16],["T_PUBLIC","public",17],["T_WHITESPACE"," ",17],["T_STATIC","static",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$modules",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_ARRAY","array",17],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_schema_test'",17],")",";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   *\/",19],["T_WHITESPACE","\n  ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$moduleHandler",24],";",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * The database connection used.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",26],["T_WHITESPACE","\n  ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$database",31],";",["T_WHITESPACE","\n\n  ",31],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",33],["T_WHITESPACE","\n  ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","setUp",36],"(",")",["T_WHITESPACE"," ",36],"{",["T_WHITESPACE","\n    ",36],["T_STRING","parent",37],["T_DOUBLE_COLON","::",37],["T_STRING","setUp",37],"(",")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","installSchema",38],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",38],",",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",["T_CONSTANT_ENCAPSED_STRING","'users_data'",38],")",")",";",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","moduleHandler",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","container",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","get",39],"(",["T_CONSTANT_ENCAPSED_STRING","'module_handler'",39],")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","database",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","container",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","get",40],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",40],")",";",["T_WHITESPACE","\n  ",40],"}",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * Tests making use of a custom bundle field.\n   *\/",43],["T_WHITESPACE","\n  ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","testCustomBundleFieldUsage",46],"(",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_STRING","entity_test_create_bundle",47],"(",["T_CONSTANT_ENCAPSED_STRING","'custom'",47],")",";",["T_WHITESPACE","\n\n    ",47],["T_COMMENT","\/\/ Check that an entity with bundle entity_test does not have the custom\n",49],["T_WHITESPACE","    ",50],["T_COMMENT","\/\/ field.\n",50],["T_WHITESPACE","    ",51],["T_VARIABLE","$storage",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","entityManager",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getStorage",51],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",51],")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$entity",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$storage",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","create",52],"(","[",["T_WHITESPACE","\n      ",52],["T_CONSTANT_ENCAPSED_STRING","'type'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'entity_test'",53],",",["T_WHITESPACE","\n    ",53],"]",")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertFalse",55],"(",["T_VARIABLE","$entity",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","hasField",55],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",55],")",")",";",["T_WHITESPACE","\n\n    ",55],["T_COMMENT","\/\/ Check that the custom bundle has the defined custom field and check\n",57],["T_WHITESPACE","    ",58],["T_COMMENT","\/\/ saving and deleting of custom field data.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$entity",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$storage",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","create",59],"(","[",["T_WHITESPACE","\n      ",59],["T_CONSTANT_ENCAPSED_STRING","'type'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'custom'",60],",",["T_WHITESPACE","\n    ",60],"]",")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertTrue",62],"(",["T_VARIABLE","$entity",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","hasField",62],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",62],")",")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Ensure that the field exists in the field map.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$field_map",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Drupal",65],["T_DOUBLE_COLON","::",65],["T_STRING","entityManager",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","getFieldMap",65],"(",")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertEqual",66],"(",["T_VARIABLE","$field_map",66],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",66],"]","[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",66],"]",",",["T_WHITESPACE"," ",66],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'string'",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'bundles'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],"[",["T_CONSTANT_ENCAPSED_STRING","'custom'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'custom'",66],"]","]",")",";",["T_WHITESPACE","\n\n    ",66],["T_VARIABLE","$entity",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","custom_bundle_field",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","value",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'swanky'",68],";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$entity",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","save",69],"(",")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$storage",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","resetCache",70],"(",")",";",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$entity",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$storage",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","load",71],"(",["T_VARIABLE","$entity",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","id",71],"(",")",")",";",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertEqual",72],"(",["T_VARIABLE","$entity",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","custom_bundle_field",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","value",72],",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'swanky'",72],",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'Entity was saved correctly'",72],")",";",["T_WHITESPACE","\n\n    ",72],["T_VARIABLE","$entity",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","custom_bundle_field",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","value",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'cozy'",74],";",["T_WHITESPACE","\n    ",74],["T_VARIABLE","$entity",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","save",75],"(",")",";",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$storage",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","resetCache",76],"(",")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$entity",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$storage",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","load",77],"(",["T_VARIABLE","$entity",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","id",77],"(",")",")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertEqual",78],"(",["T_VARIABLE","$entity",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","custom_bundle_field",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","value",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'cozy'",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Entity was updated correctly.'",78],")",";",["T_WHITESPACE","\n\n    ",78],["T_VARIABLE","$entity",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","delete",80],"(",")",";",["T_WHITESPACE","\n    ",80],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Entity\\Sql\\DefaultTableMapping $table_mapping *\/",81],["T_WHITESPACE","\n    ",81],["T_VARIABLE","$table_mapping",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$storage",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getTableMapping",82],"(",")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$table",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$table_mapping",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getDedicatedDataTableName",83],"(",["T_VARIABLE","$entity",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getFieldDefinition",83],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",83],")",")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$result",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","database",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","select",84],"(",["T_VARIABLE","$table",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'f'",84],")",["T_WHITESPACE","\n      ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","fields",85],"(",["T_CONSTANT_ENCAPSED_STRING","'f'",85],")",["T_WHITESPACE","\n      ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","condition",86],"(",["T_CONSTANT_ENCAPSED_STRING","'f.entity_id'",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$entity",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","id",86],"(",")",")",["T_WHITESPACE","\n      ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","execute",87],"(",")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","assertFalse",88],"(",["T_VARIABLE","$result",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","fetchAssoc",88],"(",")",",",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'Field data has been deleted'",88],")",";",["T_WHITESPACE","\n\n    ",88],["T_COMMENT","\/\/ Create another entity to test that values are marked as deleted when a\n",90],["T_WHITESPACE","    ",91],["T_COMMENT","\/\/ bundle is deleted.\n",91],["T_WHITESPACE","    ",92],["T_VARIABLE","$entity",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$storage",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","create",92],"(","[",["T_CONSTANT_ENCAPSED_STRING","'type'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'custom'",92],",",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'new'",92],"]",")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$entity",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","save",93],"(",")",";",["T_WHITESPACE","\n    ",93],["T_STRING","entity_test_delete_bundle",94],"(",["T_CONSTANT_ENCAPSED_STRING","'custom'",94],")",";",["T_WHITESPACE","\n\n    ",94],["T_VARIABLE","$table",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$table_mapping",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getDedicatedDataTableName",96],"(",["T_VARIABLE","$entity",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getFieldDefinition",96],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",96],")",")",";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$result",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","database",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","select",97],"(",["T_VARIABLE","$table",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'f'",97],")",["T_WHITESPACE","\n      ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","condition",98],"(",["T_CONSTANT_ENCAPSED_STRING","'f.entity_id'",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$entity",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","id",98],"(",")",")",["T_WHITESPACE","\n      ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","condition",99],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",99],",",["T_WHITESPACE"," ",99],["T_LNUMBER","1",99],")",["T_WHITESPACE","\n      ",99],["T_OBJECT_OPERATOR","->",100],["T_STRING","countQuery",100],"(",")",["T_WHITESPACE","\n      ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","execute",101],"(",")",";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","assertEqual",102],"(",["T_LNUMBER","1",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$result",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","fetchField",102],"(",")",",",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","'Field data has been deleted'",102],")",";",["T_WHITESPACE","\n\n    ",102],["T_COMMENT","\/\/ Ensure that the field no longer exists in the field map.\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$field_map",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Drupal",105],["T_DOUBLE_COLON","::",105],["T_STRING","entityManager",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getFieldMap",105],"(",")",";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","assertFalse",106],"(",["T_ISSET","isset",106],"(",["T_VARIABLE","$field_map",106],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",106],"]","[",["T_CONSTANT_ENCAPSED_STRING","'custom_bundle_field'",106],"]",")",")",";",["T_WHITESPACE","\n\n    ",106],["T_COMMENT","\/\/ @todo Test field purge and table deletion once supported. See\n",108],["T_WHITESPACE","    ",109],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2282119.\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ $this->assertFalse($this->database->schema()->tableExists($table), 'Custom field table was deleted');\n",110],["T_WHITESPACE","  ",111],"}",["T_WHITESPACE","\n\n",111],"}",["T_WHITESPACE","\n",113]]