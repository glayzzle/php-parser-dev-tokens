[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests entity level validation constraints.\n *\n * @group Entity\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","EntityTypeConstraintsTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","EntityKernelTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",12],["T_WHITESPACE","\n  ",14],["T_PROTECTED","protected",15],["T_WHITESPACE"," ",15],["T_FUNCTION","function",15],["T_WHITESPACE"," ",15],["T_STRING","setUp",15],"(",")",["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n    ",15],["T_STRING","parent",16],["T_DOUBLE_COLON","::",16],["T_STRING","setUp",16],"(",")",";",["T_WHITESPACE","\n    ",16],["T_VARIABLE","$this",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","installEntitySchema",17],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",17],")",";",["T_WHITESPACE","\n  ",17],"}",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * Tests defining entity constraints via entity type annotations and hooks.\n   *\/",20],["T_WHITESPACE","\n  ",22],["T_PUBLIC","public",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","testConstraintDefinition",23],"(",")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n    ",23],["T_COMMENT","\/\/ Test reading the annotation. There should be two constraints, the defined\n",24],["T_WHITESPACE","    ",25],["T_COMMENT","\/\/ constraint and the automatically added EntityChanged constraint.\n",25],["T_WHITESPACE","    ",26],["T_VARIABLE","$entity_type",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","entityManager",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","getDefinition",26],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",26],")",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$default_constraints",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],"[",["T_CONSTANT_ENCAPSED_STRING","'NotNull'",27],["T_WHITESPACE"," ",27],["T_DOUBLE_ARROW","=>",27],["T_WHITESPACE"," ",27],"[","]",",",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'EntityChanged'",27],["T_WHITESPACE"," ",27],["T_DOUBLE_ARROW","=>",27],["T_WHITESPACE"," ",27],["T_STRING","NULL",27],"]",";",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","assertEqual",28],"(",["T_VARIABLE","$default_constraints",28],",",["T_WHITESPACE"," ",28],["T_VARIABLE","$entity_type",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","getConstraints",28],"(",")",")",";",["T_WHITESPACE","\n\n    ",28],["T_COMMENT","\/\/ Enable our test module and test extending constraints.\n",30],["T_WHITESPACE","    ",31],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","enableModules",31],"(","[",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",31],"]",")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","container",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","get",32],"(",["T_CONSTANT_ENCAPSED_STRING","'module_handler'",32],")",["T_OBJECT_OPERATOR","->",32],["T_STRING","resetImplementations",32],"(",")",";",["T_WHITESPACE","\n\n    ",32],["T_VARIABLE","$extra_constraints",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],"[",["T_CONSTANT_ENCAPSED_STRING","'Test'",34],["T_WHITESPACE"," ",34],["T_DOUBLE_ARROW","=>",34],["T_WHITESPACE"," ",34],"[","]","]",";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","state",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","set",35],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints.build'",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$extra_constraints",35],")",";",["T_WHITESPACE","\n    ",35],["T_COMMENT","\/\/ Re-fetch the entity manager from the new container built after the new\n",36],["T_WHITESPACE","    ",37],["T_COMMENT","\/\/ modules were enabled.\n",37],["T_WHITESPACE","    ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","entityManager",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","container",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","get",38],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",38],")",";",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","entityManager",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","clearCachedDefinitions",39],"(",")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$entity_type",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","entityManager",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getDefinition",40],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",40],")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","assertEqual",41],"(",["T_VARIABLE","$default_constraints",41],["T_WHITESPACE"," ",41],"+",["T_WHITESPACE"," ",41],["T_VARIABLE","$extra_constraints",41],",",["T_WHITESPACE"," ",41],["T_VARIABLE","$entity_type",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getConstraints",41],"(",")",")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Test altering constraints.\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$altered_constraints",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],"[",["T_CONSTANT_ENCAPSED_STRING","'Test'",44],["T_WHITESPACE"," ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],"[",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'some_setting'",44],["T_WHITESPACE"," ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_STRING","TRUE",44],"]","]",";",["T_WHITESPACE","\n    ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","state",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","set",45],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints.alter'",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$altered_constraints",45],")",";",["T_WHITESPACE","\n    ",45],["T_COMMENT","\/\/ Clear the cache in state instance in the Drupal container, so it can pick\n",46],["T_WHITESPACE","    ",47],["T_COMMENT","\/\/ up the modified value.\n",47],["T_WHITESPACE","    ",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Drupal",48],["T_DOUBLE_COLON","::",48],["T_STRING","state",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","resetCache",48],"(",")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","entityManager",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","clearCachedDefinitions",49],"(",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$entity_type",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","entityManager",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getDefinition",50],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","assertEqual",51],"(",["T_VARIABLE","$altered_constraints",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$entity_type",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getConstraints",51],"(",")",")",";",["T_WHITESPACE","\n  ",51],"}",["T_WHITESPACE","\n\n  ",52],["T_DOC_COMMENT","\/**\n   * Tests entity constraints are validated.\n   *\/",54],["T_WHITESPACE","\n  ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","testConstraintValidation",57],"(",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$entity",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","entityManager",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getStorage",58],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test_constraints'",58],")",["T_OBJECT_OPERATOR","->",58],["T_STRING","create",58],"(",")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$entity",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","user_id",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","target_id",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_LNUMBER","0",59],";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$violations",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$entity",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","validate",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","assertEqual",61],"(",["T_VARIABLE","$violations",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","count",61],"(",")",",",["T_WHITESPACE"," ",61],["T_LNUMBER","0",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'Validation passed.'",61],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$entity",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","save",62],"(",")",";",["T_WHITESPACE","\n    ",62],["T_VARIABLE","$entity",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","changed",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","value",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","REQUEST_TIME",63],["T_WHITESPACE"," ",63],"-",["T_WHITESPACE"," ",63],["T_LNUMBER","86400",63],";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$violations",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$entity",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","validate",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertEqual",65],"(",["T_VARIABLE","$violations",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","count",65],"(",")",",",["T_WHITESPACE"," ",65],["T_LNUMBER","1",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'Validation failed.'",65],")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertEqual",66],"(",["T_VARIABLE","$violations",66],"[",["T_LNUMBER","0",66],"]",["T_OBJECT_OPERATOR","->",66],["T_STRING","getMessage",66],"(",")",",",["T_WHITESPACE"," ",66],["T_STRING","t",66],"(",["T_CONSTANT_ENCAPSED_STRING","'The content has either been modified by another user, or you have already submitted modifications. As a result, your changes cannot be saved.'",66],")",")",";",["T_WHITESPACE","\n  ",66],"}",["T_WHITESPACE","\n\n",67],"}",["T_WHITESPACE","\n",69]]