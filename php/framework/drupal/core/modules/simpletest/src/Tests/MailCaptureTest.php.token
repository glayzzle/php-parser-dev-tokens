[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","simpletest",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests the SimpleTest email capturing logic, the assertMail assertion and the\n * drupalGetMails function.\n *\n * @group simpletest\n *\/",7],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","MailCaptureTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","WebTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n  ",13],["T_DOC_COMMENT","\/**\n   * Test to see if the wrapper function is executed correctly.\n   *\/",14],["T_WHITESPACE","\n  ",16],["T_FUNCTION","function",17],["T_WHITESPACE"," ",17],["T_STRING","testMailSend",17],"(",")",["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n    ",17],["T_COMMENT","\/\/ Create an email.\n",18],["T_WHITESPACE","    ",19],["T_VARIABLE","$subject",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_VARIABLE","$this",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","randomString",19],"(",["T_LNUMBER","64",19],")",";",["T_WHITESPACE","\n    ",19],["T_VARIABLE","$body",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_VARIABLE","$this",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","randomString",20],"(",["T_LNUMBER","128",20],")",";",["T_WHITESPACE","\n    ",20],["T_VARIABLE","$message",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_ARRAY","array",21],"(",["T_WHITESPACE","\n      ",21],["T_CONSTANT_ENCAPSED_STRING","'id'",22],["T_WHITESPACE"," ",22],["T_DOUBLE_ARROW","=>",22],["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",22],",",["T_WHITESPACE","\n      ",22],["T_CONSTANT_ENCAPSED_STRING","'headers'",23],["T_WHITESPACE"," ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],["T_ARRAY","array",23],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-type'",23],["T_WHITESPACE"," ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'text\/html'",23],")",",",["T_WHITESPACE","\n      ",23],["T_CONSTANT_ENCAPSED_STRING","'subject'",24],["T_WHITESPACE"," ",24],["T_DOUBLE_ARROW","=>",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$subject",24],",",["T_WHITESPACE","\n      ",24],["T_CONSTANT_ENCAPSED_STRING","'to'",25],["T_WHITESPACE"," ",25],["T_DOUBLE_ARROW","=>",25],["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'foobar@example.com'",25],",",["T_WHITESPACE","\n      ",25],["T_CONSTANT_ENCAPSED_STRING","'body'",26],["T_WHITESPACE"," ",26],["T_DOUBLE_ARROW","=>",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$body",26],",",["T_WHITESPACE","\n    ",26],")",";",["T_WHITESPACE","\n\n    ",27],["T_COMMENT","\/\/ Before we send the email, drupalGetMails should return an empty array.\n",29],["T_WHITESPACE","    ",30],["T_VARIABLE","$captured_emails",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","drupalGetMails",30],"(",")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","assertEqual",31],"(",["T_STRING","count",31],"(",["T_VARIABLE","$captured_emails",31],")",",",["T_WHITESPACE"," ",31],["T_LNUMBER","0",31],",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'The captured emails queue is empty.'",31],",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'Email'",31],")",";",["T_WHITESPACE","\n\n    ",31],["T_COMMENT","\/\/ Send the email.\n",33],["T_WHITESPACE","    ",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Drupal",34],["T_DOUBLE_COLON","::",34],["T_STRING","service",34],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.mail'",34],")",["T_OBJECT_OPERATOR","->",34],["T_STRING","getInstance",34],"(",["T_ARRAY","array",34],"(",["T_CONSTANT_ENCAPSED_STRING","'module'",34],["T_WHITESPACE"," ",34],["T_DOUBLE_ARROW","=>",34],["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'simpletest'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'key'",34],["T_WHITESPACE"," ",34],["T_DOUBLE_ARROW","=>",34],["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",34],")",")",["T_OBJECT_OPERATOR","->",34],["T_STRING","mail",34],"(",["T_VARIABLE","$message",34],")",";",["T_WHITESPACE","\n\n    ",34],["T_COMMENT","\/\/ Ensure that there is one email in the captured emails array.\n",36],["T_WHITESPACE","    ",37],["T_VARIABLE","$captured_emails",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","drupalGetMails",37],"(",")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertEqual",38],"(",["T_STRING","count",38],"(",["T_VARIABLE","$captured_emails",38],")",",",["T_WHITESPACE"," ",38],["T_LNUMBER","1",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'One email was captured.'",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'Email'",38],")",";",["T_WHITESPACE","\n\n    ",38],["T_COMMENT","\/\/ Assert that the email was sent by iterating over the message properties\n",40],["T_WHITESPACE","    ",41],["T_COMMENT","\/\/ and ensuring that they are captured intact.\n",41],["T_WHITESPACE","    ",42],["T_FOREACH","foreach",42],["T_WHITESPACE"," ",42],"(",["T_VARIABLE","$message",42],["T_WHITESPACE"," ",42],["T_AS","as",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$field",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$value",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n      ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","assertMail",43],"(",["T_VARIABLE","$field",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$value",43],",",["T_WHITESPACE"," ",43],["T_STRING","format_string",43],"(",["T_CONSTANT_ENCAPSED_STRING","'The email was sent and the value for property @field is intact.'",43],",",["T_WHITESPACE"," ",43],["T_ARRAY","array",43],"(",["T_CONSTANT_ENCAPSED_STRING","'@field'",43],["T_WHITESPACE"," ",43],["T_DOUBLE_ARROW","=>",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$field",43],")",")",",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'Email'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_COMMENT","\/\/ Send additional emails so more than one email is captured.\n",46],["T_WHITESPACE","    ",47],["T_FOR","for",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$index",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_LNUMBER","0",47],";",["T_WHITESPACE"," ",47],["T_VARIABLE","$index",47],["T_WHITESPACE"," ",47],"<",["T_WHITESPACE"," ",47],["T_LNUMBER","5",47],";",["T_WHITESPACE"," ",47],["T_VARIABLE","$index",47],["T_INC","++",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$message",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_ARRAY","array",48],"(",["T_WHITESPACE","\n        ",48],["T_CONSTANT_ENCAPSED_STRING","'id'",49],["T_WHITESPACE"," ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test_'",49],["T_WHITESPACE"," ",49],".",["T_WHITESPACE"," ",49],["T_VARIABLE","$index",49],",",["T_WHITESPACE","\n        ",49],["T_CONSTANT_ENCAPSED_STRING","'headers'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_ARRAY","array",50],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-type'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'text\/html'",50],")",",",["T_WHITESPACE","\n        ",50],["T_CONSTANT_ENCAPSED_STRING","'subject'",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","randomString",51],"(",["T_LNUMBER","64",51],")",",",["T_WHITESPACE","\n        ",51],["T_CONSTANT_ENCAPSED_STRING","'to'",52],["T_WHITESPACE"," ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","randomMachineName",52],"(",["T_LNUMBER","32",52],")",["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'@example.com'",52],",",["T_WHITESPACE","\n        ",52],["T_CONSTANT_ENCAPSED_STRING","'body'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","randomString",53],"(",["T_LNUMBER","512",53],")",",",["T_WHITESPACE","\n      ",53],")",";",["T_WHITESPACE","\n      ",54],["T_NS_SEPARATOR","\\",55],["T_STRING","Drupal",55],["T_DOUBLE_COLON","::",55],["T_STRING","service",55],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.mail'",55],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","getInstance",55],"(",["T_ARRAY","array",55],"(",["T_CONSTANT_ENCAPSED_STRING","'module'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'key'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$index",55],")",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","mail",55],"(",["T_VARIABLE","$message",55],")",";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_COMMENT","\/\/ There should now be 6 emails captured.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$captured_emails",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","drupalGetMails",59],"(",")",";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","assertEqual",60],"(",["T_STRING","count",60],"(",["T_VARIABLE","$captured_emails",60],")",",",["T_WHITESPACE"," ",60],["T_LNUMBER","6",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'All emails were captured.'",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'Email'",60],")",";",["T_WHITESPACE","\n\n    ",60],["T_COMMENT","\/\/ Test different ways of getting filtered emails via drupalGetMails().\n",62],["T_WHITESPACE","    ",63],["T_VARIABLE","$captured_emails",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","drupalGetMails",63],"(",["T_ARRAY","array",63],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",63],")",")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","assertEqual",64],"(",["T_STRING","count",64],"(",["T_VARIABLE","$captured_emails",64],")",",",["T_WHITESPACE"," ",64],["T_LNUMBER","1",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'Only one email is returned when filtering by id.'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'Email'",64],")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$captured_emails",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","drupalGetMails",65],"(",["T_ARRAY","array",65],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'subject'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$subject",65],")",")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertEqual",66],"(",["T_STRING","count",66],"(",["T_VARIABLE","$captured_emails",66],")",",",["T_WHITESPACE"," ",66],["T_LNUMBER","1",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Only one email is returned when filtering by id and subject.'",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Email'",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$captured_emails",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","drupalGetMails",67],"(",["T_ARRAY","array",67],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'subject'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$subject",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'from'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'this_was_not_used@example.com'",67],")",")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertEqual",68],"(",["T_STRING","count",68],"(",["T_VARIABLE","$captured_emails",68],")",",",["T_WHITESPACE"," ",68],["T_LNUMBER","0",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'No emails are returned when querying with an unused from address.'",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Email'",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_COMMENT","\/\/ Send the last email again, so we can confirm that the\n",70],["T_WHITESPACE","    ",71],["T_COMMENT","\/\/ drupalGetMails-filter correctly returns all emails with a given\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ property\/value.\n",72],["T_WHITESPACE","    ",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Drupal",73],["T_DOUBLE_COLON","::",73],["T_STRING","service",73],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.mail'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getInstance",73],"(",["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'module'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test'",73],",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'key'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$index",73],")",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","mail",73],"(",["T_VARIABLE","$message",73],")",";",["T_WHITESPACE","\n    ",73],["T_VARIABLE","$captured_emails",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","drupalGetMails",74],"(",["T_ARRAY","array",74],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'drupal_mail_test_4'",74],")",")",";",["T_WHITESPACE","\n    ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","assertEqual",75],"(",["T_STRING","count",75],"(",["T_VARIABLE","$captured_emails",75],")",",",["T_WHITESPACE"," ",75],["T_LNUMBER","2",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'All emails with the same id are returned when filtering by id.'",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'Email'",75],")",";",["T_WHITESPACE","\n  ",75],"}",["T_WHITESPACE","\n\n",76],"}",["T_WHITESPACE","\n",78]]