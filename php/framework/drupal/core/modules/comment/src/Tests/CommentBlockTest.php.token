[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","comment",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","SafeMarkup",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","user",6],["T_NS_SEPARATOR","\\",6],["T_STRING","RoleInterface",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Tests comment block functionality.\n *\n * @group comment\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","CommentBlockTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","CommentTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * Modules to install.\n   *\n   * @var array\n   *\/",15],["T_WHITESPACE","\n  ",19],["T_PUBLIC","public",20],["T_WHITESPACE"," ",20],["T_STATIC","static",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$modules",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_ARRAY","array",20],"(",["T_CONSTANT_ENCAPSED_STRING","'block'",20],",",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'views'",20],")",";",["T_WHITESPACE","\n\n  ",20],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_FUNCTION","function",22],["T_WHITESPACE"," ",22],["T_STRING","setUp",22],"(",")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n    ",22],["T_STRING","parent",23],["T_DOUBLE_COLON","::",23],["T_STRING","setUp",23],"(",")",";",["T_WHITESPACE","\n    ",23],["T_COMMENT","\/\/ Update admin user to have the 'administer blocks' permission.\n",24],["T_WHITESPACE","    ",25],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","adminUser",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","drupalCreateUser",25],"(",["T_ARRAY","array",25],"(",["T_WHITESPACE","\n      ",25],["T_CONSTANT_ENCAPSED_STRING","'administer content types'",26],",",["T_WHITESPACE","\n      ",26],["T_CONSTANT_ENCAPSED_STRING","'administer comments'",27],",",["T_WHITESPACE","\n      ",27],["T_CONSTANT_ENCAPSED_STRING","'skip comment approval'",28],",",["T_WHITESPACE","\n      ",28],["T_CONSTANT_ENCAPSED_STRING","'post comments'",29],",",["T_WHITESPACE","\n      ",29],["T_CONSTANT_ENCAPSED_STRING","'access comments'",30],",",["T_WHITESPACE","\n      ",30],["T_CONSTANT_ENCAPSED_STRING","'access content'",31],",",["T_WHITESPACE","\n      ",31],["T_CONSTANT_ENCAPSED_STRING","'administer blocks'",32],",",["T_WHITESPACE","\n     ",32],")",")",";",["T_WHITESPACE","\n  ",33],"}",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * Tests the recent comments block.\n   *\/",36],["T_WHITESPACE","\n  ",38],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","testRecentCommentBlock",39],"(",")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","drupalLogin",40],"(",["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","adminUser",40],")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$block",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","drupalPlaceBlock",41],"(",["T_CONSTANT_ENCAPSED_STRING","'views_block:comments_recent-block_1'",41],")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Add some test comments, with and without subjects. Because the 10 newest\n",43],["T_WHITESPACE","    ",44],["T_COMMENT","\/\/ comments should be shown by the block, we create 11 to test that behavior\n",44],["T_WHITESPACE","    ",45],["T_COMMENT","\/\/ below.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$timestamp",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","REQUEST_TIME",46],";",["T_WHITESPACE","\n    ",46],["T_FOR","for",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$i",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_LNUMBER","0",47],";",["T_WHITESPACE"," ",47],["T_VARIABLE","$i",47],["T_WHITESPACE"," ",47],"<",["T_WHITESPACE"," ",47],["T_LNUMBER","11",47],";",["T_WHITESPACE"," ",47],["T_INC","++",47],["T_VARIABLE","$i",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$subject",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],"(",["T_VARIABLE","$i",48],["T_WHITESPACE"," ",48],"%",["T_WHITESPACE"," ",48],["T_LNUMBER","2",48],")",["T_WHITESPACE"," ",48],"?",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","randomMachineName",48],"(",")",["T_WHITESPACE"," ",48],":",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","''",48],";",["T_WHITESPACE","\n      ",48],["T_VARIABLE","$comments",49],"[",["T_VARIABLE","$i",49],"]",["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","postComment",49],"(",["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","node",49],",",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","randomMachineName",49],"(",")",",",["T_WHITESPACE"," ",49],["T_VARIABLE","$subject",49],")",";",["T_WHITESPACE","\n      ",49],["T_VARIABLE","$comments",50],"[",["T_VARIABLE","$i",50],"]",["T_OBJECT_OPERATOR","->",50],["T_STRING","created",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","value",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$timestamp",50],["T_DEC","--",50],";",["T_WHITESPACE","\n      ",50],["T_VARIABLE","$comments",51],"[",["T_VARIABLE","$i",51],"]",["T_OBJECT_OPERATOR","->",51],["T_STRING","save",51],"(",")",";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_COMMENT","\/\/ Test that a user without the 'access comments' permission cannot see the\n",54],["T_WHITESPACE","    ",55],["T_COMMENT","\/\/ block.\n",55],["T_WHITESPACE","    ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","drupalLogout",56],"(",")",";",["T_WHITESPACE","\n    ",56],["T_STRING","user_role_revoke_permissions",57],"(",["T_STRING","RoleInterface",57],["T_DOUBLE_COLON","::",57],["T_STRING","ANONYMOUS_ID",57],",",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",["T_CONSTANT_ENCAPSED_STRING","'access comments'",57],")",")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","drupalGet",58],"(",["T_CONSTANT_ENCAPSED_STRING","''",58],")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","assertNoText",59],"(",["T_STRING","t",59],"(",["T_CONSTANT_ENCAPSED_STRING","'Recent comments'",59],")",")",";",["T_WHITESPACE","\n    ",59],["T_STRING","user_role_grant_permissions",60],"(",["T_STRING","RoleInterface",60],["T_DOUBLE_COLON","::",60],["T_STRING","ANONYMOUS_ID",60],",",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",["T_CONSTANT_ENCAPSED_STRING","'access comments'",60],")",")",";",["T_WHITESPACE","\n\n    ",60],["T_COMMENT","\/\/ Test that a user with the 'access comments' permission can see the\n",62],["T_WHITESPACE","    ",63],["T_COMMENT","\/\/ block.\n",63],["T_WHITESPACE","    ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","drupalLogin",64],"(",["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","webUser",64],")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","drupalGet",65],"(",["T_CONSTANT_ENCAPSED_STRING","''",65],")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertText",66],"(",["T_STRING","t",66],"(",["T_CONSTANT_ENCAPSED_STRING","'Recent comments'",66],")",")",";",["T_WHITESPACE","\n\n    ",66],["T_COMMENT","\/\/ Test the only the 10 latest comments are shown and in the proper order.\n",68],["T_WHITESPACE","    ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertNoText",69],"(",["T_VARIABLE","$comments",69],"[",["T_LNUMBER","10",69],"]",["T_OBJECT_OPERATOR","->",69],["T_STRING","getSubject",69],"(",")",",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'Comment 11 not found in block.'",69],")",";",["T_WHITESPACE","\n    ",69],["T_FOR","for",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$i",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_LNUMBER","0",70],";",["T_WHITESPACE"," ",70],["T_VARIABLE","$i",70],["T_WHITESPACE"," ",70],"<",["T_WHITESPACE"," ",70],["T_LNUMBER","10",70],";",["T_WHITESPACE"," ",70],["T_VARIABLE","$i",70],["T_INC","++",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n      ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertText",71],"(",["T_VARIABLE","$comments",71],"[",["T_VARIABLE","$i",71],"]",["T_OBJECT_OPERATOR","->",71],["T_STRING","getSubject",71],"(",")",",",["T_WHITESPACE"," ",71],["T_STRING","SafeMarkup",71],["T_DOUBLE_COLON","::",71],["T_STRING","format",71],"(",["T_CONSTANT_ENCAPSED_STRING","'Comment @number found in block.'",71],",",["T_WHITESPACE"," ",71],["T_ARRAY","array",71],"(",["T_CONSTANT_ENCAPSED_STRING","'@number'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_LNUMBER","10",71],["T_WHITESPACE"," ",71],"-",["T_WHITESPACE"," ",71],["T_VARIABLE","$i",71],")",")",")",";",["T_WHITESPACE","\n      ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$i",72],["T_WHITESPACE"," ",72],">",["T_WHITESPACE"," ",72],["T_LNUMBER","1",72],")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$previous_position",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$position",73],";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$position",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","strpos",74],"(",["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getRawContent",74],"(",")",",",["T_WHITESPACE"," ",74],["T_VARIABLE","$comments",74],"[",["T_VARIABLE","$i",74],"]",["T_OBJECT_OPERATOR","->",74],["T_STRING","getSubject",74],"(",")",")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","assertTrue",75],"(",["T_VARIABLE","$position",75],["T_WHITESPACE"," ",75],">",["T_WHITESPACE"," ",75],["T_VARIABLE","$previous_position",75],",",["T_WHITESPACE"," ",75],["T_STRING","SafeMarkup",75],["T_DOUBLE_COLON","::",75],["T_STRING","format",75],"(",["T_CONSTANT_ENCAPSED_STRING","'Comment @a appears after comment @b'",75],",",["T_WHITESPACE"," ",75],["T_ARRAY","array",75],"(",["T_CONSTANT_ENCAPSED_STRING","'@a'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_LNUMBER","10",75],["T_WHITESPACE"," ",75],"-",["T_WHITESPACE"," ",75],["T_VARIABLE","$i",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'@b'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_LNUMBER","11",75],["T_WHITESPACE"," ",75],"-",["T_WHITESPACE"," ",75],["T_VARIABLE","$i",75],")",")",")",";",["T_WHITESPACE","\n      ",75],"}",["T_WHITESPACE","\n      ",76],["T_VARIABLE","$position",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","strpos",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getRawContent",77],"(",")",",",["T_WHITESPACE"," ",77],["T_VARIABLE","$comments",77],"[",["T_VARIABLE","$i",77],"]",["T_OBJECT_OPERATOR","->",77],["T_STRING","getSubject",77],"(",")",")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_COMMENT","\/\/ Test that links to comments work when comments are across pages.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","setCommentsPerPage",81],"(",["T_LNUMBER","1",81],")",";",["T_WHITESPACE","\n\n    ",81],["T_FOR","for",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$i",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_LNUMBER","0",83],";",["T_WHITESPACE"," ",83],["T_VARIABLE","$i",83],["T_WHITESPACE"," ",83],"<",["T_WHITESPACE"," ",83],["T_LNUMBER","10",83],";",["T_WHITESPACE"," ",83],["T_VARIABLE","$i",83],["T_INC","++",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n      ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","clickLink",84],"(",["T_VARIABLE","$comments",84],"[",["T_VARIABLE","$i",84],"]",["T_OBJECT_OPERATOR","->",84],["T_STRING","getSubject",84],"(",")",")",";",["T_WHITESPACE","\n      ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","assertText",85],"(",["T_VARIABLE","$comments",85],"[",["T_VARIABLE","$i",85],"]",["T_OBJECT_OPERATOR","->",85],["T_STRING","getSubject",85],"(",")",",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'Comment link goes to correct page.'",85],")",";",["T_WHITESPACE","\n      ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertRaw",86],"(",["T_CONSTANT_ENCAPSED_STRING","'<link rel=\"canonical\"'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'Canonical URL was found in the HTML head'",86],")",";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n  ",87],"}",["T_WHITESPACE","\n\n",88],"}",["T_WHITESPACE","\n",90]]