[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","comment",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","comment",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Plugin",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Field",5],["T_NS_SEPARATOR","\\",5],["T_STRING","FieldType",5],["T_NS_SEPARATOR","\\",5],["T_STRING","CommentItemInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Config",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ConfigFactoryInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","EntityInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Entity",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EntityManagerInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Entity",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Query",9],["T_NS_SEPARATOR","\\",9],["T_STRING","QueryFactory",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Extension",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ModuleHandlerInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Routing",11],["T_NS_SEPARATOR","\\",11],["T_STRING","UrlGeneratorInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Drupal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Core",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Routing",12],["T_NS_SEPARATOR","\\",12],["T_STRING","UrlGeneratorTrait",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Drupal",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Core",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Session",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AccountInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Drupal",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Core",14],["T_NS_SEPARATOR","\\",14],["T_STRING","StringTranslation",14],["T_NS_SEPARATOR","\\",14],["T_STRING","StringTranslationTrait",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Drupal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Core",15],["T_NS_SEPARATOR","\\",15],["T_STRING","StringTranslation",15],["T_NS_SEPARATOR","\\",15],["T_STRING","TranslationInterface",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Drupal",16],["T_NS_SEPARATOR","\\",16],["T_STRING","field",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Entity",16],["T_NS_SEPARATOR","\\",16],["T_STRING","FieldStorageConfig",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Drupal",17],["T_NS_SEPARATOR","\\",17],["T_STRING","field",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Entity",17],["T_NS_SEPARATOR","\\",17],["T_STRING","FieldConfig",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Drupal",18],["T_NS_SEPARATOR","\\",18],["T_STRING","user",18],["T_NS_SEPARATOR","\\",18],["T_STRING","RoleInterface",18],";",["T_WHITESPACE","\n\n",18],["T_DOC_COMMENT","\/**\n * Comment manager contains common functions to manage comment fields.\n *\/",20],["T_WHITESPACE","\n",22],["T_CLASS","class",23],["T_WHITESPACE"," ",23],["T_STRING","CommentManager",23],["T_WHITESPACE"," ",23],["T_IMPLEMENTS","implements",23],["T_WHITESPACE"," ",23],["T_STRING","CommentManagerInterface",23],["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n  ",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","StringTranslationTrait",24],";",["T_WHITESPACE","\n  ",24],["T_USE","use",25],["T_WHITESPACE"," ",25],["T_STRING","UrlGeneratorTrait",25],";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * The entity manager service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$entityManager",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * The entity query factory.\n   *\n   * @var \\Drupal\\Core\\Entity\\Query\\QueryFactory\n   *\/",34],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$queryFactory",39],";",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * Whether the \\Drupal\\user\\RoleInterface::AUTHENTICATED_ID can post comments.\n   *\n   * @var bool\n   *\/",41],["T_WHITESPACE","\n  ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$authenticatedCanPostComments",46],";",["T_WHITESPACE","\n\n  ",46],["T_DOC_COMMENT","\/**\n   * The user settings config object.\n   *\n   * @var \\Drupal\\Core\\Config\\Config\n   *\/",48],["T_WHITESPACE","\n  ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$userConfig",53],";",["T_WHITESPACE","\n\n  ",53],["T_DOC_COMMENT","\/**\n   * The module handler service.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   *\/",55],["T_WHITESPACE","\n  ",59],["T_PROTECTED","protected",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$moduleHandler",60],";",["T_WHITESPACE","\n\n  ",60],["T_DOC_COMMENT","\/**\n   * The current user.\n   *\n   * @var \\Drupal\\Core\\Session\\AccountInterface\n   *\/",62],["T_WHITESPACE","\n  ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$currentUser",67],";",["T_WHITESPACE","\n\n  ",67],["T_DOC_COMMENT","\/**\n   * Construct the CommentManager object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityManagerInterface $entity_manager\n   *   The entity manager service.\n   * @param \\Drupal\\Core\\Entity\\Query\\QueryFactory $query_factory\n   *   The entity query factory.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Drupal\\Core\\StringTranslation\\TranslationInterface $string_translation\n   *   The string translation service.\n   * @param \\Drupal\\Core\\Routing\\UrlGeneratorInterface $url_generator\n   *   The url generator service.\n   *  @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler service.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $current_user\n   *   The current user.\n   *\/",69],["T_WHITESPACE","\n  ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","__construct",87],"(",["T_STRING","EntityManagerInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$entity_manager",87],",",["T_WHITESPACE"," ",87],["T_STRING","QueryFactory",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$query_factory",87],",",["T_WHITESPACE"," ",87],["T_STRING","ConfigFactoryInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$config_factory",87],",",["T_WHITESPACE"," ",87],["T_STRING","TranslationInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$string_translation",87],",",["T_WHITESPACE"," ",87],["T_STRING","UrlGeneratorInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$url_generator",87],",",["T_WHITESPACE"," ",87],["T_STRING","ModuleHandlerInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$module_handler",87],",",["T_WHITESPACE"," ",87],["T_STRING","AccountInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$current_user",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","entityManager",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$entity_manager",88],";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","queryFactory",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$query_factory",89],";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","userConfig",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$config_factory",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","get",90],"(",["T_CONSTANT_ENCAPSED_STRING","'user.settings'",90],")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","stringTranslation",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$string_translation",91],";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","urlGenerator",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$url_generator",92],";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","moduleHandler",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$module_handler",93],";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","currentUser",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$current_user",94],";",["T_WHITESPACE","\n  ",94],"}",["T_WHITESPACE","\n\n  ",95],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",97],["T_WHITESPACE","\n  ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","getFields",100],"(",["T_VARIABLE","$entity_type_id",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$entity_type",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","entityManager",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getDefinition",101],"(",["T_VARIABLE","$entity_type_id",101],")",";",["T_WHITESPACE","\n    ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(","!",["T_VARIABLE","$entity_type",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","isSubclassOf",102],"(",["T_CONSTANT_ENCAPSED_STRING","'\\Drupal\\Core\\Entity\\FieldableEntityInterface'",102],")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n      ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",")",";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_VARIABLE","$map",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","entityManager",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getFieldMapByFieldType",106],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",106],")",";",["T_WHITESPACE","\n    ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_ISSET","isset",107],"(",["T_VARIABLE","$map",107],"[",["T_VARIABLE","$entity_type_id",107],"]",")",["T_WHITESPACE"," ",107],"?",["T_WHITESPACE"," ",107],["T_VARIABLE","$map",107],"[",["T_VARIABLE","$entity_type_id",107],"]",["T_WHITESPACE"," ",107],":",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",")",";",["T_WHITESPACE","\n  ",107],"}",["T_WHITESPACE","\n\n  ",108],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",110],["T_WHITESPACE","\n  ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","addBodyField",113],"(",["T_VARIABLE","$comment_type_id",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n    ",113],["T_IF","if",114],["T_WHITESPACE"," ",114],"(","!",["T_STRING","FieldConfig",114],["T_DOUBLE_COLON","::",114],["T_STRING","loadByName",114],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$comment_type_id",114],",",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'comment_body'",114],")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n      ",114],["T_COMMENT","\/\/ Attaches the body field by default.\n",115],["T_WHITESPACE","      ",116],["T_VARIABLE","$field",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","entityManager",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getStorage",116],"(",["T_CONSTANT_ENCAPSED_STRING","'field_config'",116],")",["T_OBJECT_OPERATOR","->",116],["T_STRING","create",116],"(",["T_ARRAY","array",116],"(",["T_WHITESPACE","\n        ",116],["T_CONSTANT_ENCAPSED_STRING","'label'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'Comment'",117],",",["T_WHITESPACE","\n        ",117],["T_CONSTANT_ENCAPSED_STRING","'bundle'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$comment_type_id",118],",",["T_WHITESPACE","\n        ",118],["T_CONSTANT_ENCAPSED_STRING","'required'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_STRING","TRUE",119],",",["T_WHITESPACE","\n        ",119],["T_CONSTANT_ENCAPSED_STRING","'field_storage'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_STRING","FieldStorageConfig",120],["T_DOUBLE_COLON","::",120],["T_STRING","loadByName",120],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'comment_body'",120],")",",",["T_WHITESPACE","\n      ",120],")",")",";",["T_WHITESPACE","\n      ",121],["T_VARIABLE","$field",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","save",122],"(",")",";",["T_WHITESPACE","\n\n      ",122],["T_COMMENT","\/\/ Assign widget settings for the 'default' form mode.\n",124],["T_WHITESPACE","      ",125],["T_STRING","entity_get_form_display",125],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$comment_type_id",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'default'",125],")",["T_WHITESPACE","\n        ",125],["T_OBJECT_OPERATOR","->",126],["T_STRING","setComponent",126],"(",["T_CONSTANT_ENCAPSED_STRING","'comment_body'",126],",",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",["T_WHITESPACE","\n          ",126],["T_CONSTANT_ENCAPSED_STRING","'type'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'text_textarea'",127],",",["T_WHITESPACE","\n        ",127],")",")",["T_WHITESPACE","\n        ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","save",129],"(",")",";",["T_WHITESPACE","\n\n      ",129],["T_COMMENT","\/\/ Assign display settings for the 'default' view mode.\n",131],["T_WHITESPACE","      ",132],["T_STRING","entity_get_display",132],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$comment_type_id",132],",",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'default'",132],")",["T_WHITESPACE","\n        ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","setComponent",133],"(",["T_CONSTANT_ENCAPSED_STRING","'comment_body'",133],",",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",["T_WHITESPACE","\n          ",133],["T_CONSTANT_ENCAPSED_STRING","'label'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'hidden'",134],",",["T_WHITESPACE","\n          ",134],["T_CONSTANT_ENCAPSED_STRING","'type'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'text_default'",135],",",["T_WHITESPACE","\n          ",135],["T_CONSTANT_ENCAPSED_STRING","'weight'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_LNUMBER","0",136],",",["T_WHITESPACE","\n        ",136],")",")",["T_WHITESPACE","\n        ",137],["T_OBJECT_OPERATOR","->",138],["T_STRING","save",138],"(",")",";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n  ",139],"}",["T_WHITESPACE","\n\n  ",140],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",142],["T_WHITESPACE","\n  ",144],["T_PUBLIC","public",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","forbiddenMessage",145],"(",["T_STRING","EntityInterface",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$entity",145],",",["T_WHITESPACE"," ",145],["T_VARIABLE","$field_name",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n    ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(","!",["T_ISSET","isset",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","authenticatedCanPostComments",146],")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n      ",146],["T_COMMENT","\/\/ We only output a link if we are certain that users will get the\n",147],["T_WHITESPACE","      ",148],["T_COMMENT","\/\/ permission to post comments by logging in.\n",148],["T_WHITESPACE","      ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","authenticatedCanPostComments",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","entityManager",149],["T_WHITESPACE","\n        ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","getStorage",150],"(",["T_CONSTANT_ENCAPSED_STRING","'user_role'",150],")",["T_WHITESPACE","\n        ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","load",151],"(",["T_STRING","RoleInterface",151],["T_DOUBLE_COLON","::",151],["T_STRING","AUTHENTICATED_ID",151],")",["T_WHITESPACE","\n        ",151],["T_OBJECT_OPERATOR","->",152],["T_STRING","hasPermission",152],"(",["T_CONSTANT_ENCAPSED_STRING","'post comments'",152],")",";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_IF","if",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","authenticatedCanPostComments",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n      ",155],["T_COMMENT","\/\/ We cannot use the redirect.destination service here because these links\n",156],["T_WHITESPACE","      ",157],["T_COMMENT","\/\/ sometimes appear on \/node and taxonomy listing pages.\n",157],["T_WHITESPACE","      ",158],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$entity",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","get",158],"(",["T_VARIABLE","$field_name",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getFieldDefinition",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getSetting",158],"(",["T_CONSTANT_ENCAPSED_STRING","'form_location'",158],")",["T_WHITESPACE"," ",158],["T_IS_EQUAL","==",158],["T_WHITESPACE"," ",158],["T_STRING","CommentItemInterface",158],["T_DOUBLE_COLON","::",158],["T_STRING","FORM_SEPARATE_PAGE",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$comment_reply_parameters",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],"[",["T_WHITESPACE","\n          ",159],["T_CONSTANT_ENCAPSED_STRING","'entity_type'",160],["T_WHITESPACE"," ",160],["T_DOUBLE_ARROW","=>",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$entity",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getEntityTypeId",160],"(",")",",",["T_WHITESPACE","\n          ",160],["T_CONSTANT_ENCAPSED_STRING","'entity'",161],["T_WHITESPACE"," ",161],["T_DOUBLE_ARROW","=>",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$entity",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","id",161],"(",")",",",["T_WHITESPACE","\n          ",161],["T_CONSTANT_ENCAPSED_STRING","'field_name'",162],["T_WHITESPACE"," ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$field_name",162],",",["T_WHITESPACE","\n        ",162],"]",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$destination",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'destination'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","url",164],"(",["T_CONSTANT_ENCAPSED_STRING","'comment.reply'",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$comment_reply_parameters",164],",",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'fragment'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","'comment-form'",164],")",")",")",";",["T_WHITESPACE","\n      ",164],"}",["T_WHITESPACE","\n      ",165],["T_ELSE","else",166],["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$destination",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",["T_CONSTANT_ENCAPSED_STRING","'destination'",167],["T_WHITESPACE"," ",167],["T_DOUBLE_ARROW","=>",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$entity",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","url",167],"(",["T_CONSTANT_ENCAPSED_STRING","'canonical'",167],",",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",["T_CONSTANT_ENCAPSED_STRING","'fragment'",167],["T_WHITESPACE"," ",167],["T_DOUBLE_ARROW","=>",167],["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'comment-form'",167],")",")",")",";",["T_WHITESPACE","\n      ",167],"}",["T_WHITESPACE","\n\n      ",168],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","userConfig",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","get",170],"(",["T_CONSTANT_ENCAPSED_STRING","'register'",170],")",["T_WHITESPACE"," ",170],["T_IS_NOT_EQUAL","!=",170],["T_WHITESPACE"," ",170],["T_STRING","USER_REGISTER_ADMINISTRATORS_ONLY",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n        ",170],["T_COMMENT","\/\/ Users can register themselves.\n",171],["T_WHITESPACE","        ",172],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","t",172],"(",["T_CONSTANT_ENCAPSED_STRING","'<a href=\":login\">Log in<\/a> or <a href=\":register\">register<\/a> to post comments'",172],",",["T_WHITESPACE"," ",172],["T_ARRAY","array",172],"(",["T_WHITESPACE","\n          ",172],["T_CONSTANT_ENCAPSED_STRING","':login'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","urlGenerator",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","generateFromRoute",173],"(",["T_CONSTANT_ENCAPSED_STRING","'user.login'",173],",",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",")",",",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",["T_CONSTANT_ENCAPSED_STRING","'query'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$destination",173],")",")",",",["T_WHITESPACE","\n          ",173],["T_CONSTANT_ENCAPSED_STRING","':register'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","urlGenerator",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","generateFromRoute",174],"(",["T_CONSTANT_ENCAPSED_STRING","'user.register'",174],",",["T_WHITESPACE"," ",174],["T_ARRAY","array",174],"(",")",",",["T_WHITESPACE"," ",174],["T_ARRAY","array",174],"(",["T_CONSTANT_ENCAPSED_STRING","'query'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$destination",174],")",")",",",["T_WHITESPACE","\n        ",174],")",")",";",["T_WHITESPACE","\n      ",175],"}",["T_WHITESPACE","\n      ",176],["T_ELSE","else",177],["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n        ",177],["T_COMMENT","\/\/ Only admins can add new users, no public registration.\n",178],["T_WHITESPACE","        ",179],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","t",179],"(",["T_CONSTANT_ENCAPSED_STRING","'<a href=\":login\">Log in<\/a> to post comments'",179],",",["T_WHITESPACE"," ",179],["T_ARRAY","array",179],"(",["T_WHITESPACE","\n          ",179],["T_CONSTANT_ENCAPSED_STRING","':login'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","urlGenerator",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","generateFromRoute",180],"(",["T_CONSTANT_ENCAPSED_STRING","'user.login'",180],",",["T_WHITESPACE"," ",180],["T_ARRAY","array",180],"(",")",",",["T_WHITESPACE"," ",180],["T_ARRAY","array",180],"(",["T_CONSTANT_ENCAPSED_STRING","'query'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$destination",180],")",")",",",["T_WHITESPACE","\n        ",180],")",")",";",["T_WHITESPACE","\n      ",181],"}",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n    ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","''",184],";",["T_WHITESPACE","\n  ",184],"}",["T_WHITESPACE","\n\n  ",185],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",187],["T_WHITESPACE","\n  ",189],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","getCountNewComments",190],"(",["T_STRING","EntityInterface",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$entity",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$field_name",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","NULL",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$timestamp",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_LNUMBER","0",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n    ",190],["T_COMMENT","\/\/ @todo Replace module handler with optional history service injection\n",191],["T_WHITESPACE","    ",192],["T_COMMENT","\/\/   after https:\/\/www.drupal.org\/node\/2081585.\n",192],["T_WHITESPACE","    ",193],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","currentUser",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","isAuthenticated",193],"(",")",["T_WHITESPACE"," ",193],["T_BOOLEAN_AND","&&",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","moduleHandler",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","moduleExists",193],"(",["T_CONSTANT_ENCAPSED_STRING","'history'",193],")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n      ",193],["T_COMMENT","\/\/ Retrieve the timestamp at which the current user last viewed this entity.\n",194],["T_WHITESPACE","      ",195],["T_IF","if",195],["T_WHITESPACE"," ",195],"(","!",["T_VARIABLE","$timestamp",195],")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n        ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$entity",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getEntityTypeId",196],"(",")",["T_WHITESPACE"," ",196],["T_IS_EQUAL","==",196],["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","'node'",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n          ",196],["T_VARIABLE","$timestamp",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","history_read",197],"(",["T_VARIABLE","$entity",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","id",197],"(",")",")",";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE","\n        ",198],["T_ELSE","else",199],["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n          ",199],["T_VARIABLE","$function",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$entity",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getEntityTypeId",200],"(",")",["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'_last_viewed'",200],";",["T_WHITESPACE","\n          ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_STRING","function_exists",201],"(",["T_VARIABLE","$function",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$timestamp",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$function",202],"(",["T_VARIABLE","$entity",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","id",202],"(",")",")",";",["T_WHITESPACE","\n          ",202],"}",["T_WHITESPACE","\n          ",203],["T_ELSE","else",204],["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_COMMENT","\/\/ Default to 30 days ago.\n",205],["T_WHITESPACE","            ",206],["T_COMMENT","\/\/ @todo Remove once https:\/\/www.drupal.org\/node\/1029708 lands.\n",206],["T_WHITESPACE","            ",207],["T_VARIABLE","$timestamp",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_STRING","COMMENT_NEW_LIMIT",207],";",["T_WHITESPACE","\n          ",207],"}",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n      ",209],"}",["T_WHITESPACE","\n      ",210],["T_VARIABLE","$timestamp",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$timestamp",211],["T_WHITESPACE"," ",211],">",["T_WHITESPACE"," ",211],["T_STRING","HISTORY_READ_LIMIT",211],["T_WHITESPACE"," ",211],"?",["T_WHITESPACE"," ",211],["T_VARIABLE","$timestamp",211],["T_WHITESPACE"," ",211],":",["T_WHITESPACE"," ",211],["T_STRING","HISTORY_READ_LIMIT",211],")",";",["T_WHITESPACE","\n\n      ",211],["T_COMMENT","\/\/ Use the timestamp to retrieve the number of new comments.\n",213],["T_WHITESPACE","      ",214],["T_VARIABLE","$query",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","queryFactory",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","get",214],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",214],")",["T_WHITESPACE","\n        ",214],["T_OBJECT_OPERATOR","->",215],["T_STRING","condition",215],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$entity",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getEntityTypeId",215],"(",")",")",["T_WHITESPACE","\n        ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","condition",216],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$entity",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","id",216],"(",")",")",["T_WHITESPACE","\n        ",216],["T_OBJECT_OPERATOR","->",217],["T_STRING","condition",217],"(",["T_CONSTANT_ENCAPSED_STRING","'created'",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$timestamp",217],",",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","'>'",217],")",["T_WHITESPACE","\n        ",217],["T_OBJECT_OPERATOR","->",218],["T_STRING","condition",218],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",218],",",["T_WHITESPACE"," ",218],["T_STRING","CommentInterface",218],["T_DOUBLE_COLON","::",218],["T_STRING","PUBLISHED",218],")",";",["T_WHITESPACE","\n      ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$field_name",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n        ",219],["T_COMMENT","\/\/ Limit to a particular field.\n",220],["T_WHITESPACE","        ",221],["T_VARIABLE","$query",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","condition",221],"(",["T_CONSTANT_ENCAPSED_STRING","'field_name'",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$field_name",221],")",";",["T_WHITESPACE","\n      ",221],"}",["T_WHITESPACE","\n\n      ",222],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$query",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","count",224],"(",")",["T_OBJECT_OPERATOR","->",224],["T_STRING","execute",224],"(",")",";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n    ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_STRING","FALSE",226],";",["T_WHITESPACE","\n  ",226],"}",["T_WHITESPACE","\n\n",227],"}",["T_WHITESPACE","\n",229]]