[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","comment",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Plugin",3],["T_NS_SEPARATOR","\\",3],["T_STRING","EntityReferenceSelection",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Query",5],["T_NS_SEPARATOR","\\",5],["T_STRING","SelectInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Plugin",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EntityReferenceSelection",6],["T_NS_SEPARATOR","\\",6],["T_STRING","DefaultSelection",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","comment",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CommentInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Provides specific access control for the comment entity type.\n *\n * @EntityReferenceSelection(\n *   id = \"default:comment\",\n *   label = @Translation(\"Comment selection\"),\n *   entity_types = {\"comment\"},\n *   group = \"default\",\n *   weight = 1\n * )\n *\/",9],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","CommentSelection",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","DefaultSelection",20],["T_WHITESPACE"," ",20],"{",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",22],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_FUNCTION","function",25],["T_WHITESPACE"," ",25],["T_STRING","buildEntityQuery",25],"(",["T_VARIABLE","$match",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_STRING","NULL",25],",",["T_WHITESPACE"," ",25],["T_VARIABLE","$match_operator",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'CONTAINS'",25],")",["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n    ",25],["T_VARIABLE","$query",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_STRING","parent",26],["T_DOUBLE_COLON","::",26],["T_STRING","buildEntityQuery",26],"(",["T_VARIABLE","$match",26],",",["T_WHITESPACE"," ",26],["T_VARIABLE","$match_operator",26],")",";",["T_WHITESPACE","\n\n    ",26],["T_COMMENT","\/\/ Adding the 'comment_access' tag is sadly insufficient for comments:\n",28],["T_WHITESPACE","    ",29],["T_COMMENT","\/\/ core requires us to also know about the concept of 'published' and\n",29],["T_WHITESPACE","    ",30],["T_COMMENT","\/\/ 'unpublished'.\n",30],["T_WHITESPACE","    ",31],["T_IF","if",31],["T_WHITESPACE"," ",31],"(","!",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","currentUser",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","hasPermission",31],"(",["T_CONSTANT_ENCAPSED_STRING","'administer comments'",31],")",")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n      ",31],["T_VARIABLE","$query",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","condition",32],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",32],",",["T_WHITESPACE"," ",32],["T_STRING","CommentInterface",32],["T_DOUBLE_COLON","::",32],["T_STRING","PUBLISHED",32],")",";",["T_WHITESPACE","\n    ",32],"}",["T_WHITESPACE","\n    ",33],["T_RETURN","return",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$query",34],";",["T_WHITESPACE","\n  ",34],"}",["T_WHITESPACE","\n\n  ",35],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",37],["T_WHITESPACE","\n  ",39],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","createNewEntity",40],"(",["T_VARIABLE","$entity_type_id",40],",",["T_WHITESPACE"," ",40],["T_VARIABLE","$bundle",40],",",["T_WHITESPACE"," ",40],["T_VARIABLE","$label",40],",",["T_WHITESPACE"," ",40],["T_VARIABLE","$uid",40],")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$comment",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","parent",41],["T_DOUBLE_COLON","::",41],["T_STRING","createNewEntity",41],"(",["T_VARIABLE","$entity_type_id",41],",",["T_WHITESPACE"," ",41],["T_VARIABLE","$bundle",41],",",["T_WHITESPACE"," ",41],["T_VARIABLE","$label",41],",",["T_WHITESPACE"," ",41],["T_VARIABLE","$uid",41],")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ In order to create a referenceable comment, it needs to published.\n",43],["T_WHITESPACE","    ",44],["T_DOC_COMMENT","\/** @var \\Drupal\\comment\\CommentInterface $comment *\/",44],["T_WHITESPACE","\n    ",44],["T_VARIABLE","$comment",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","setPublished",45],"(",["T_STRING","TRUE",45],")",";",["T_WHITESPACE","\n\n    ",45],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$comment",47],";",["T_WHITESPACE","\n  ",47],"}",["T_WHITESPACE","\n\n  ",48],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",50],["T_WHITESPACE","\n  ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","validateReferenceableNewEntities",53],"(",["T_ARRAY","array",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$entities",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$entities",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","parent",54],["T_DOUBLE_COLON","::",54],["T_STRING","validateReferenceableNewEntities",54],"(",["T_VARIABLE","$entities",54],")",";",["T_WHITESPACE","\n    ",54],["T_COMMENT","\/\/ Mirror the conditions checked in buildEntityQuery().\n",55],["T_WHITESPACE","    ",56],["T_IF","if",56],["T_WHITESPACE"," ",56],"(","!",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","currentUser",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","hasPermission",56],"(",["T_CONSTANT_ENCAPSED_STRING","'administer comments'",56],")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n      ",56],["T_VARIABLE","$entities",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","array_filter",57],"(",["T_VARIABLE","$entities",57],",",["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],"(",["T_VARIABLE","$comment",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n        ",57],["T_DOC_COMMENT","\/** @var \\Drupal\\comment\\CommentInterface $comment *\/",58],["T_WHITESPACE","\n        ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$comment",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","isPublished",59],"(",")",";",["T_WHITESPACE","\n      ",59],"}",")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n    ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$entities",62],";",["T_WHITESPACE","\n  ",62],"}",["T_WHITESPACE","\n\n  ",63],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",65],["T_WHITESPACE","\n  ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","entityQueryAlter",68],"(",["T_STRING","SelectInterface",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$query",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$tables",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$query",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getTables",69],"(",")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$data_table",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'comment_field_data'",70],";",["T_WHITESPACE","\n    ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_ISSET","isset",71],"(",["T_VARIABLE","$tables",71],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_field_data'",71],"]","[",["T_CONSTANT_ENCAPSED_STRING","'alias'",71],"]",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n      ",71],["T_COMMENT","\/\/ If no conditions join against the comment data table, it should be\n",72],["T_WHITESPACE","      ",73],["T_COMMENT","\/\/ joined manually to allow node access processing.\n",73],["T_WHITESPACE","      ",74],["T_VARIABLE","$query",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","innerJoin",74],"(",["T_VARIABLE","$data_table",74],",",["T_WHITESPACE"," ",74],["T_STRING","NULL",74],",",["T_WHITESPACE"," ",74],"\"",["T_ENCAPSED_AND_WHITESPACE","base_table.cid = ",74],["T_VARIABLE","$data_table",74],["T_ENCAPSED_AND_WHITESPACE",".cid AND ",74],["T_VARIABLE","$data_table",74],["T_ENCAPSED_AND_WHITESPACE",".default_langcode = 1",74],"\"",")",";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_COMMENT","\/\/ The Comment module doesn't implement any proper comment access,\n",77],["T_WHITESPACE","    ",78],["T_COMMENT","\/\/ and as a consequence doesn't make sure that comments cannot be viewed\n",78],["T_WHITESPACE","    ",79],["T_COMMENT","\/\/ when the user doesn't have access to the node.\n",79],["T_WHITESPACE","    ",80],["T_VARIABLE","$node_alias",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$query",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","innerJoin",80],"(",["T_CONSTANT_ENCAPSED_STRING","'node_field_data'",80],",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'n'",80],",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'%alias.nid = '",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_VARIABLE","$data_table",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'.entity_id AND '",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_VARIABLE","$data_table",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","\".entity_type = 'node'\"",80],")",";",["T_WHITESPACE","\n    ",80],["T_COMMENT","\/\/ Pass the query to the node access control.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","reAlterQuery",82],"(",["T_VARIABLE","$query",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'node_access'",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$node_alias",82],")",";",["T_WHITESPACE","\n\n    ",82],["T_COMMENT","\/\/ Passing the query to node_query_node_access_alter() is sadly\n",84],["T_WHITESPACE","    ",85],["T_COMMENT","\/\/ insufficient for nodes.\n",85],["T_WHITESPACE","    ",86],["T_COMMENT","\/\/ @see SelectionEntityTypeNode::entityQueryAlter()\n",86],["T_WHITESPACE","    ",87],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","currentUser",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","hasPermission",87],"(",["T_CONSTANT_ENCAPSED_STRING","'bypass node access'",87],")",["T_WHITESPACE"," ",87],["T_BOOLEAN_AND","&&",87],["T_WHITESPACE"," ",87],"!",["T_STRING","count",87],"(",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","moduleHandler",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getImplementations",87],"(",["T_CONSTANT_ENCAPSED_STRING","'node_grants'",87],")",")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n      ",87],["T_VARIABLE","$query",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","condition",88],"(",["T_VARIABLE","$node_alias",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'.status'",88],",",["T_WHITESPACE"," ",88],["T_LNUMBER","1",88],")",";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n  ",89],"}",["T_WHITESPACE","\n\n",90],"}",["T_WHITESPACE","\n",92]]