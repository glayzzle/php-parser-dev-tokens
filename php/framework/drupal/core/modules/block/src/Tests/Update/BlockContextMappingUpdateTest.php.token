[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","block",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Update",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","block",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Block",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","node",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Node",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","system",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Tests",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Update",7],["T_NS_SEPARATOR","\\",7],["T_STRING","UpdatePathTestBase",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests the upgrade path for block context mapping renames.\n *\n * @see https:\/\/www.drupal.org\/node\/2354889\n *\n * @group Update\n *\/",9],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","BlockContextMappingUpdateTest",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","UpdatePathTestBase",16],["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n\n  ",16],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",18],["T_WHITESPACE","\n  ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_STATIC","static",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$modules",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],"[",["T_CONSTANT_ENCAPSED_STRING","'block_test'",21],",",["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'language'",21],"]",";",["T_WHITESPACE","\n\n  ",21],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",23],["T_WHITESPACE","\n  ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_FUNCTION","function",26],["T_WHITESPACE"," ",26],["T_STRING","setDatabaseDumpFiles",26],"(",")",["T_WHITESPACE"," ",26],"{",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","databaseDumpFiles",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],"[",["T_WHITESPACE","\n      ",27],["T_DIR","__DIR__",28],["T_WHITESPACE"," ",28],".",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/..\/system\/tests\/fixtures\/update\/drupal-8.bare.standard.php.gz'",28],",",["T_WHITESPACE","\n      ",28],["T_DIR","__DIR__",29],["T_WHITESPACE"," ",29],".",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/..\/system\/tests\/fixtures\/update\/drupal-8.block-context-manager-2354889.php'",29],",",["T_WHITESPACE","\n      ",29],["T_DIR","__DIR__",30],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/..\/system\/tests\/fixtures\/update\/drupal-8.language-enabled.php'",30],",",["T_WHITESPACE","\n      ",30],["T_DIR","__DIR__",31],["T_WHITESPACE"," ",31],".",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/..\/system\/tests\/fixtures\/update\/drupal-8.block-test-enabled.php'",31],",",["T_WHITESPACE","\n    ",31],"]",";",["T_WHITESPACE","\n  ",32],"}",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * Tests that block context mapping is updated properly.\n   *\/",35],["T_WHITESPACE","\n  ",37],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","testUpdateHookN",38],"(",")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","runUpdates",39],"(",")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","assertRaw",40],"(",["T_CONSTANT_ENCAPSED_STRING","'Encountered an unknown context mapping key coming probably from a contributed or custom module: One or more mappings could not be updated. Please manually review your visibility settings for the following blocks, which are disabled now:<ul><li>User login (Visibility: Baloney spam)<\/li><\/ul>'",40],")",";",["T_WHITESPACE","\n\n    ",40],["T_COMMENT","\/\/ Disable maintenance mode.\n",42],["T_WHITESPACE","    ",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Drupal",43],["T_DOUBLE_COLON","::",43],["T_STRING","state",43],"(",")",["T_OBJECT_OPERATOR","->",43],["T_STRING","set",43],"(",["T_CONSTANT_ENCAPSED_STRING","'system.maintenance_mode'",43],",",["T_WHITESPACE"," ",43],["T_STRING","FALSE",43],")",";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/\/ We finished updating so we can log in the user now.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","drupalLogin",46],"(",["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","rootUser",46],")",";",["T_WHITESPACE","\n\n    ",46],["T_COMMENT","\/\/ The block that we are testing has the following visibility rules:\n",48],["T_WHITESPACE","    ",49],["T_COMMENT","\/\/ - only visible on node pages\n",49],["T_WHITESPACE","    ",50],["T_COMMENT","\/\/ - only visible to authenticated users.\n",50],["T_WHITESPACE","    ",51],["T_VARIABLE","$block_title",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'Test for 2354889'",51],";",["T_WHITESPACE","\n\n    ",51],["T_COMMENT","\/\/ Create two nodes, a page and an article.\n",53],["T_WHITESPACE","    ",54],["T_VARIABLE","$page",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","Node",54],["T_DOUBLE_COLON","::",54],["T_STRING","create",54],"(","[",["T_WHITESPACE","\n      ",54],["T_CONSTANT_ENCAPSED_STRING","'type'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'page'",55],",",["T_WHITESPACE","\n      ",55],["T_CONSTANT_ENCAPSED_STRING","'title'",56],["T_WHITESPACE"," ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'Page node'",56],",",["T_WHITESPACE","\n    ",56],"]",")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$page",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","save",58],"(",")",";",["T_WHITESPACE","\n\n    ",58],["T_VARIABLE","$article",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","Node",60],["T_DOUBLE_COLON","::",60],["T_STRING","create",60],"(","[",["T_WHITESPACE","\n      ",60],["T_CONSTANT_ENCAPSED_STRING","'type'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'article'",61],",",["T_WHITESPACE","\n      ",61],["T_CONSTANT_ENCAPSED_STRING","'title'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'Article node'",62],",",["T_WHITESPACE","\n    ",62],"]",")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$article",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","save",64],"(",")",";",["T_WHITESPACE","\n\n    ",64],["T_COMMENT","\/\/ Check that the block appears only on Page nodes for authenticated users.\n",66],["T_WHITESPACE","    ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","drupalGet",67],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",67],["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$page",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","id",67],"(",")",")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertRaw",68],"(",["T_VARIABLE","$block_title",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Test block is visible on a Page node as an authenticated user.'",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","drupalGet",70],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",70],["T_WHITESPACE"," ",70],".",["T_WHITESPACE"," ",70],["T_VARIABLE","$article",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","id",70],"(",")",")",";",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertNoRaw",71],"(",["T_VARIABLE","$block_title",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'Test block is not visible on a Article node as an authenticated user.'",71],")",";",["T_WHITESPACE","\n\n    ",71],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","drupalLogout",73],"(",")",";",["T_WHITESPACE","\n\n    ",73],["T_COMMENT","\/\/ Check that the block does not appear on any page for anonymous users.\n",75],["T_WHITESPACE","    ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","drupalGet",76],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_VARIABLE","$page",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","id",76],"(",")",")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","assertNoRaw",77],"(",["T_VARIABLE","$block_title",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'Test block is not visible on a Page node as an anonymous user.'",77],")",";",["T_WHITESPACE","\n\n    ",77],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","drupalGet",79],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_VARIABLE","$article",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","id",79],"(",")",")",";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","assertNoRaw",80],"(",["T_VARIABLE","$block_title",80],",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'Test block is not visible on a Article node as an anonymous user.'",80],")",";",["T_WHITESPACE","\n\n    ",80],["T_COMMENT","\/\/ Ensure that all the context mappings got updated properly.\n",82],["T_WHITESPACE","    ",83],["T_VARIABLE","$block",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","Block",83],["T_DOUBLE_COLON","::",83],["T_STRING","load",83],"(",["T_CONSTANT_ENCAPSED_STRING","'testfor2354889'",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$visibility",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$block",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","get",84],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",84],")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","assertEqual",85],"(",["T_CONSTANT_ENCAPSED_STRING","'@node.node_route_context:node'",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$visibility",85],"[",["T_CONSTANT_ENCAPSED_STRING","'node_type'",85],"]","[",["T_CONSTANT_ENCAPSED_STRING","'context_mapping'",85],"]","[",["T_CONSTANT_ENCAPSED_STRING","'node'",85],"]",")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertEqual",86],"(",["T_CONSTANT_ENCAPSED_STRING","'@user.current_user_context:current_user'",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$visibility",86],"[",["T_CONSTANT_ENCAPSED_STRING","'user_role'",86],"]","[",["T_CONSTANT_ENCAPSED_STRING","'context_mapping'",86],"]","[",["T_CONSTANT_ENCAPSED_STRING","'user'",86],"]",")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","assertEqual",87],"(",["T_CONSTANT_ENCAPSED_STRING","'@language.current_language_context:language_interface'",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$visibility",87],"[",["T_CONSTANT_ENCAPSED_STRING","'language'",87],"]","[",["T_CONSTANT_ENCAPSED_STRING","'context_mapping'",87],"]","[",["T_CONSTANT_ENCAPSED_STRING","'language'",87],"]",")",";",["T_WHITESPACE","\n\n    ",87],["T_COMMENT","\/\/ Check that a block with invalid context is being disabled and that it can\n",89],["T_WHITESPACE","    ",90],["T_COMMENT","\/\/ still be edited afterward.\n",90],["T_WHITESPACE","    ",91],["T_VARIABLE","$disabled_block",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","Block",91],["T_DOUBLE_COLON","::",91],["T_STRING","load",91],"(",["T_CONSTANT_ENCAPSED_STRING","'thirdtestfor2354889'",91],")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertFalse",92],"(",["T_VARIABLE","$disabled_block",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","status",92],"(",")",",",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'Block with invalid context is disabled'",92],")",";",["T_WHITESPACE","\n\n    ",92],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertEqual",94],"(","[",["T_CONSTANT_ENCAPSED_STRING","'thirdtestfor2354889'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],"[",["T_CONSTANT_ENCAPSED_STRING","'missing_context_ids'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],"[",["T_CONSTANT_ENCAPSED_STRING","'baloney_spam'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],"[",["T_CONSTANT_ENCAPSED_STRING","'node_type'",94],"]","]",",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'status'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_STRING","TRUE",94],"]","]",",",["T_WHITESPACE"," ",94],["T_NS_SEPARATOR","\\",94],["T_STRING","Drupal",94],["T_DOUBLE_COLON","::",94],["T_STRING","keyValue",94],"(",["T_CONSTANT_ENCAPSED_STRING","'update_backup'",94],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","get",94],"(",["T_CONSTANT_ENCAPSED_STRING","'block_update_8001'",94],")",")",";",["T_WHITESPACE","\n\n    ",94],["T_VARIABLE","$disabled_block_visibility",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$disabled_block",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","get",96],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",96],")",";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","assertTrue",97],"(","!",["T_ISSET","isset",97],"(",["T_VARIABLE","$disabled_block_visibility",97],"[",["T_CONSTANT_ENCAPSED_STRING","'node_type'",97],"]",")",",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'The problematic visibility condition has been removed.'",97],")",";",["T_WHITESPACE","\n\n    ",97],["T_VARIABLE","$admin_user",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","drupalCreateUser",99],"(","[",["T_CONSTANT_ENCAPSED_STRING","'administer blocks'",99],"]",")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","drupalLogin",100],"(",["T_VARIABLE","$admin_user",100],")",";",["T_WHITESPACE","\n\n    ",100],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","drupalGet",102],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/manage\/thirdtestfor2354889'",102],")",";",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","assertResponse",103],"(",["T_CONSTANT_ENCAPSED_STRING","'200'",103],")",";",["T_WHITESPACE","\n  ",103],"}",["T_WHITESPACE","\n\n",104],"}",["T_WHITESPACE","\n",106]]