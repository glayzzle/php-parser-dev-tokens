[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_DOC_COMMENT","\/**\n * @file\n * Post update functions for Block.\n *\/",3],["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * @addtogroup updates-8.0.0-beta\n * @{\n *\/",8],["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Disable all blocks with missing context IDs in block_update_8001().\n *\/",13],["T_WHITESPACE","\n",15],["T_FUNCTION","function",16],["T_WHITESPACE"," ",16],["T_STRING","block_post_update_disable_blocks_with_missing_contexts",16],"(",")",["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n  ",16],["T_COMMENT","\/\/ Don't execute the function if block_update_8002() got executed already,\n",17],["T_WHITESPACE","  ",18],["T_COMMENT","\/\/ which used to do the same. Note: Its okay to check here, because\n",18],["T_WHITESPACE","  ",19],["T_COMMENT","\/\/ update_do_one() does not update the installed schema version until the\n",19],["T_WHITESPACE","  ",20],["T_COMMENT","\/\/ batch is finished.\n",20],["T_WHITESPACE","  ",21],["T_VARIABLE","$module_schema",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_STRING","drupal_get_installed_schema_version",21],"(",["T_CONSTANT_ENCAPSED_STRING","'block'",21],")",";",["T_WHITESPACE","\n\n  ",21],["T_COMMENT","\/\/ The state entry 'block_update_8002_placeholder' is used in order to\n",23],["T_WHITESPACE","  ",24],["T_COMMENT","\/\/ indicate that the placeholder block_update_8002() function has been\n",24],["T_WHITESPACE","  ",25],["T_COMMENT","\/\/ executed, so this function needs to be executed as well. If the non\n",25],["T_WHITESPACE","  ",26],["T_COMMENT","\/\/ placeholder version of block_update_8002() got executed already, the state\n",26],["T_WHITESPACE","  ",27],["T_COMMENT","\/\/ won't be set and we skip this update.\n",27],["T_WHITESPACE","  ",28],["T_IF","if",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$module_schema",28],["T_WHITESPACE"," ",28],["T_IS_GREATER_OR_EQUAL",">=",28],["T_WHITESPACE"," ",28],["T_LNUMBER","8002",28],["T_WHITESPACE"," ",28],["T_BOOLEAN_AND","&&",28],["T_WHITESPACE"," ",28],"!",["T_NS_SEPARATOR","\\",28],["T_STRING","Drupal",28],["T_DOUBLE_COLON","::",28],["T_STRING","state",28],"(",")",["T_OBJECT_OPERATOR","->",28],["T_STRING","get",28],"(",["T_CONSTANT_ENCAPSED_STRING","'block_update_8002_placeholder'",28],",",["T_WHITESPACE"," ",28],["T_STRING","FALSE",28],")",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n    ",28],["T_RETURN","return",29],";",["T_WHITESPACE","\n  ",29],"}",["T_WHITESPACE","\n\n  ",30],["T_COMMENT","\/\/ Cleanup the state entry as its no longer needed.\n",32],["T_WHITESPACE","  ",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Drupal",33],["T_DOUBLE_COLON","::",33],["T_STRING","state",33],"(",")",["T_OBJECT_OPERATOR","->",33],["T_STRING","delete",33],"(",["T_CONSTANT_ENCAPSED_STRING","'block_update_8002'",33],")",";",["T_WHITESPACE","\n\n  ",33],["T_VARIABLE","$block_update_8001",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Drupal",35],["T_DOUBLE_COLON","::",35],["T_STRING","keyValue",35],"(",["T_CONSTANT_ENCAPSED_STRING","'update_backup'",35],")",["T_OBJECT_OPERATOR","->",35],["T_STRING","get",35],"(",["T_CONSTANT_ENCAPSED_STRING","'block_update_8001'",35],",",["T_WHITESPACE"," ",35],"[","]",")",";",["T_WHITESPACE","\n\n  ",35],["T_VARIABLE","$block_ids",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","array_keys",37],"(",["T_VARIABLE","$block_update_8001",37],")",";",["T_WHITESPACE","\n  ",37],["T_VARIABLE","$block_storage",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Drupal",38],["T_DOUBLE_COLON","::",38],["T_STRING","entityManager",38],"(",")",["T_OBJECT_OPERATOR","->",38],["T_STRING","getStorage",38],"(",["T_CONSTANT_ENCAPSED_STRING","'block'",38],")",";",["T_WHITESPACE","\n  ",38],["T_VARIABLE","$blocks",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$block_storage",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","loadMultiple",39],"(",["T_VARIABLE","$block_ids",39],")",";",["T_WHITESPACE","\n  ",39],["T_DOC_COMMENT","\/** @var $blocks \\Drupal\\block\\BlockInterface[] *\/",40],["T_WHITESPACE","\n  ",40],["T_FOREACH","foreach",41],["T_WHITESPACE"," ",41],"(",["T_VARIABLE","$blocks",41],["T_WHITESPACE"," ",41],["T_AS","as",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$block",41],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n    ",41],["T_COMMENT","\/\/ This block has had conditions removed due to an inability to resolve\n",42],["T_WHITESPACE","    ",43],["T_COMMENT","\/\/ contexts in block_update_8001() so disable it.\n",43],["T_WHITESPACE","\n    ",44],["T_COMMENT","\/\/ Disable currently enabled blocks.\n",45],["T_WHITESPACE","    ",46],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_VARIABLE","$block_update_8001",46],"[",["T_VARIABLE","$block",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","id",46],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'status'",46],"]",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n      ",46],["T_VARIABLE","$block",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","setStatus",47],"(",["T_STRING","FALSE",47],")",";",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$block",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","save",48],"(",")",";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n  ",49],"}",["T_WHITESPACE","\n\n  ",50],["T_COMMENT","\/\/ Provides a list of plugin labels, keyed by plugin ID.\n",52],["T_WHITESPACE","  ",53],["T_VARIABLE","$condition_plugin_id_label_map",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","array_column",53],"(",["T_NS_SEPARATOR","\\",53],["T_STRING","Drupal",53],["T_DOUBLE_COLON","::",53],["T_STRING","service",53],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.condition'",53],")",["T_OBJECT_OPERATOR","->",53],["T_STRING","getDefinitions",53],"(",")",",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'label'",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'id'",53],")",";",["T_WHITESPACE","\n\n  ",53],["T_COMMENT","\/\/ Override with the UI labels we are aware of. Sadly they are not machine\n",55],["T_WHITESPACE","  ",56],["T_COMMENT","\/\/ accessible, see\n",56],["T_WHITESPACE","  ",57],["T_COMMENT","\/\/ \\Drupal\\node\\Plugin\\Condition\\NodeType::buildConfigurationForm().\n",57],["T_WHITESPACE","  ",58],["T_VARIABLE","$condition_plugin_id_label_map",58],"[",["T_CONSTANT_ENCAPSED_STRING","'node_type'",58],"]",["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","t",58],"(",["T_CONSTANT_ENCAPSED_STRING","'Content types'",58],")",";",["T_WHITESPACE","\n  ",58],["T_VARIABLE","$condition_plugin_id_label_map",59],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",59],"]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","t",59],"(",["T_CONSTANT_ENCAPSED_STRING","'Pages'",59],")",";",["T_WHITESPACE","\n  ",59],["T_VARIABLE","$condition_plugin_id_label_map",60],"[",["T_CONSTANT_ENCAPSED_STRING","'user_role'",60],"]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","t",60],"(",["T_CONSTANT_ENCAPSED_STRING","'Roles'",60],")",";",["T_WHITESPACE","\n\n  ",60],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_STRING","count",62],"(",["T_VARIABLE","$block_ids",62],")",["T_WHITESPACE"," ",62],">",["T_WHITESPACE"," ",62],["T_LNUMBER","0",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n    ",62],["T_VARIABLE","$message",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","t",63],"(",["T_CONSTANT_ENCAPSED_STRING","'Encountered an unknown context mapping key coming probably from a contributed or custom module: One or more mappings could not be updated. Please manually review your visibility settings for the following blocks, which are disabled now:'",63],")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$message",64],["T_WHITESPACE"," ",64],["T_CONCAT_EQUAL",".=",64],["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'<ul>'",64],";",["T_WHITESPACE","\n    ",64],["T_FOREACH","foreach",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$blocks",65],["T_WHITESPACE"," ",65],["T_AS","as",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$disabled_block_id",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$disabled_block",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n      ",65],["T_VARIABLE","$message",66],["T_WHITESPACE"," ",66],["T_CONCAT_EQUAL",".=",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'<li>'",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_STRING","t",66],"(",["T_CONSTANT_ENCAPSED_STRING","'@label (Visibility: @plugin_ids)'",66],",",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",["T_WHITESPACE","\n          ",66],["T_CONSTANT_ENCAPSED_STRING","'@label'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$disabled_block",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","get",67],"(",["T_CONSTANT_ENCAPSED_STRING","'settings'",67],")","[",["T_CONSTANT_ENCAPSED_STRING","'label'",67],"]",",",["T_WHITESPACE","\n          ",67],["T_CONSTANT_ENCAPSED_STRING","'@plugin_ids'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_STRING","implode",68],"(",["T_CONSTANT_ENCAPSED_STRING","', '",68],",",["T_WHITESPACE"," ",68],["T_STRING","array_intersect_key",68],"(",["T_VARIABLE","$condition_plugin_id_label_map",68],",",["T_WHITESPACE"," ",68],["T_STRING","array_flip",68],"(",["T_STRING","array_keys",68],"(",["T_VARIABLE","$block_update_8001",68],"[",["T_VARIABLE","$disabled_block_id",68],"]","[",["T_CONSTANT_ENCAPSED_STRING","'missing_context_ids'",68],"]",")",")",")",")",["T_WHITESPACE","\n        ",68],")",")",["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'<\/li>'",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$message",71],["T_WHITESPACE"," ",71],["T_CONCAT_EQUAL",".=",71],["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'<\/ul>'",71],";",["T_WHITESPACE","\n\n    ",71],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$message",73],";",["T_WHITESPACE","\n  ",73],"}",["T_WHITESPACE","\n",74],"}",["T_WHITESPACE","\n\n",75],["T_DOC_COMMENT","\/**\n * @} End of \"addtogroup updates-8.0.0-beta\".\n *\/",77],["T_WHITESPACE","\n\n",79],["T_DOC_COMMENT","\/**\n * @addtogroup updates-8.2.x\n * @{\n *\/",81],["T_WHITESPACE","\n\n",84],["T_DOC_COMMENT","\/**\n * Fix invalid 'negate' values in block visibility conditions.\n *\/",86],["T_WHITESPACE","\n",88],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","block_post_update_fix_negate_in_conditions",89],"(",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n  ",89],["T_VARIABLE","$block_storage",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_NS_SEPARATOR","\\",90],["T_STRING","Drupal",90],["T_DOUBLE_COLON","::",90],["T_STRING","entityTypeManager",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getStorage",90],"(",["T_CONSTANT_ENCAPSED_STRING","'block'",90],")",";",["T_WHITESPACE","\n  ",90],["T_DOC_COMMENT","\/** @var \\Drupal\\block\\BlockInterface[] $blocks *\/",91],["T_WHITESPACE","\n  ",91],["T_VARIABLE","$blocks",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$block_storage",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","loadMultiple",92],"(",")",";",["T_WHITESPACE","\n  ",92],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$blocks",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$block",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$block_needs_saving",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","FALSE",94],";",["T_WHITESPACE","\n    ",94],["T_COMMENT","\/\/ Check each visibility condition for an invalid negate value, and fix it.\n",95],["T_WHITESPACE","    ",96],["T_FOREACH","foreach",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$block",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getVisibilityConditions",96],"(",")",["T_WHITESPACE"," ",96],["T_AS","as",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$condition_id",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$condition",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n      ",96],["T_VARIABLE","$configuration",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$condition",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getConfiguration",97],"(",")",";",["T_WHITESPACE","\n      ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_STRING","array_key_exists",98],"(",["T_CONSTANT_ENCAPSED_STRING","'negate'",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$configuration",98],")",["T_WHITESPACE"," ",98],["T_BOOLEAN_AND","&&",98],["T_WHITESPACE"," ",98],"!",["T_STRING","is_bool",98],"(",["T_VARIABLE","$configuration",98],"[",["T_CONSTANT_ENCAPSED_STRING","'negate'",98],"]",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$configuration",99],"[",["T_CONSTANT_ENCAPSED_STRING","'negate'",99],"]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_BOOL_CAST","(bool)",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$configuration",99],"[",["T_CONSTANT_ENCAPSED_STRING","'negate'",99],"]",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$condition",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setConfiguration",100],"(",["T_VARIABLE","$configuration",100],")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$block_needs_saving",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","TRUE",101],";",["T_WHITESPACE","\n      ",101],"}",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n    ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$block_needs_saving",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n      ",104],["T_VARIABLE","$block",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","save",105],"(",")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n  ",106],"}",["T_WHITESPACE","\n",107],"}",["T_WHITESPACE","\n\n",108],["T_DOC_COMMENT","\/**\n * @} End of \"addtogroup updates-8.2.x\".\n *\/",110],["T_WHITESPACE","\n",112]]