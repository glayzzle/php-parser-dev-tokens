[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","content_translation",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Config",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","ThirdPartySettingsInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ContentEntityInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","EntityManagerInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Provides field translation synchronization capabilities.\n *\/",9],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","FieldTranslationSynchronizer",12],["T_WHITESPACE"," ",12],["T_IMPLEMENTS","implements",12],["T_WHITESPACE"," ",12],["T_STRING","FieldTranslationSynchronizerInterface",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * The entity manager to use to load unchanged entities.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",14],["T_WHITESPACE","\n  ",18],["T_PROTECTED","protected",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$entityManager",19],";",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * Constructs a FieldTranslationSynchronizer object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityManagerInterface $entityManager\n   *   The entity manager.\n   *\/",21],["T_WHITESPACE","\n  ",26],["T_PUBLIC","public",27],["T_WHITESPACE"," ",27],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],["T_STRING","__construct",27],"(",["T_STRING","EntityManagerInterface",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$entityManager",27],")",["T_WHITESPACE"," ",27],"{",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","entityManager",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$entityManager",28],";",["T_WHITESPACE","\n  ",28],"}",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",31],["T_WHITESPACE","\n  ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","synchronizeFields",34],"(",["T_STRING","ContentEntityInterface",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$entity",34],",",["T_WHITESPACE"," ",34],["T_VARIABLE","$sync_langcode",34],",",["T_WHITESPACE"," ",34],["T_VARIABLE","$original_langcode",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","NULL",34],")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$translations",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$entity",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getTranslationLanguages",35],"(",")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$field_type_manager",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Drupal",36],["T_DOUBLE_COLON","::",36],["T_STRING","service",36],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.field.field_type'",36],")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ If we have no information about what to sync to, if we are creating a new\n",38],["T_WHITESPACE","    ",39],["T_COMMENT","\/\/ entity, if we have no translations for the current entity and we are not\n",39],["T_WHITESPACE","    ",40],["T_COMMENT","\/\/ creating one, then there is nothing to synchronize.\n",40],["T_WHITESPACE","    ",41],["T_IF","if",41],["T_WHITESPACE"," ",41],"(",["T_EMPTY","empty",41],"(",["T_VARIABLE","$sync_langcode",41],")",["T_WHITESPACE"," ",41],["T_BOOLEAN_OR","||",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$entity",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","isNew",41],"(",")",["T_WHITESPACE"," ",41],["T_BOOLEAN_OR","||",41],["T_WHITESPACE"," ",41],["T_STRING","count",41],"(",["T_VARIABLE","$translations",41],")",["T_WHITESPACE"," ",41],"<",["T_WHITESPACE"," ",41],["T_LNUMBER","2",41],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n      ",41],["T_RETURN","return",42],";",["T_WHITESPACE","\n    ",42],"}",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/\/ If the entity language is being changed there is nothing to synchronize.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$entity_type",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$entity",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getEntityTypeId",46],"(",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$entity_unchanged",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ISSET","isset",47],"(",["T_VARIABLE","$entity",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","original",47],")",["T_WHITESPACE"," ",47],"?",["T_WHITESPACE"," ",47],["T_VARIABLE","$entity",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","original",47],["T_WHITESPACE"," ",47],":",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","entityManager",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getStorage",47],"(",["T_VARIABLE","$entity_type",47],")",["T_OBJECT_OPERATOR","->",47],["T_STRING","loadUnchanged",47],"(",["T_VARIABLE","$entity",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","id",47],"(",")",")",";",["T_WHITESPACE","\n    ",47],["T_IF","if",48],["T_WHITESPACE"," ",48],"(",["T_VARIABLE","$entity",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getUntranslated",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","language",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","getId",48],"(",")",["T_WHITESPACE"," ",48],["T_IS_NOT_EQUAL","!=",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$entity_unchanged",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getUntranslated",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","language",48],"(",")",["T_OBJECT_OPERATOR","->",48],["T_STRING","getId",48],"(",")",")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n      ",48],["T_RETURN","return",49],";",["T_WHITESPACE","\n    ",49],"}",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Field\\FieldItemListInterface $items *\/",52],["T_WHITESPACE","\n    ",52],["T_FOREACH","foreach",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$entity",53],["T_WHITESPACE"," ",53],["T_AS","as",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$field_name",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$items",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n      ",53],["T_VARIABLE","$field_definition",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$items",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getFieldDefinition",54],"(",")",";",["T_WHITESPACE","\n      ",54],["T_VARIABLE","$field_type_definition",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$field_type_manager",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getDefinition",55],"(",["T_VARIABLE","$field_definition",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getType",55],"(",")",")",";",["T_WHITESPACE","\n      ",55],["T_VARIABLE","$column_groups",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$field_type_definition",56],"[",["T_CONSTANT_ENCAPSED_STRING","'column_groups'",56],"]",";",["T_WHITESPACE","\n\n      ",56],["T_COMMENT","\/\/ Sync if the field is translatable, not empty, and the synchronization\n",58],["T_WHITESPACE","      ",59],["T_COMMENT","\/\/ setting is enabled.\n",59],["T_WHITESPACE","      ",60],["T_IF","if",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$field_definition",60],["T_WHITESPACE"," ",60],["T_INSTANCEOF","instanceof",60],["T_WHITESPACE"," ",60],["T_STRING","ThirdPartySettingsInterface",60],["T_WHITESPACE"," ",60],["T_BOOLEAN_AND","&&",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$field_definition",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","isTranslatable",60],"(",")",["T_WHITESPACE"," ",60],["T_BOOLEAN_AND","&&",60],["T_WHITESPACE"," ",60],"!",["T_VARIABLE","$items",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","isEmpty",60],"(",")",["T_WHITESPACE"," ",60],["T_BOOLEAN_AND","&&",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$translation_sync",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$field_definition",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getThirdPartySetting",60],"(",["T_CONSTANT_ENCAPSED_STRING","'content_translation'",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'translation_sync'",60],")",")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n        ",60],["T_COMMENT","\/\/ Retrieve all the untranslatable column groups and merge them into\n",61],["T_WHITESPACE","        ",62],["T_COMMENT","\/\/ single list.\n",62],["T_WHITESPACE","        ",63],["T_VARIABLE","$groups",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","array_keys",63],"(",["T_STRING","array_diff",63],"(",["T_VARIABLE","$translation_sync",63],",",["T_WHITESPACE"," ",63],["T_STRING","array_filter",63],"(",["T_VARIABLE","$translation_sync",63],")",")",")",";",["T_WHITESPACE","\n\n        ",63],["T_COMMENT","\/\/ If a group was selected has the require_all_groups_for_translation\n",65],["T_WHITESPACE","        ",66],["T_COMMENT","\/\/ flag set, there are no untranslatable columns. This is done because\n",66],["T_WHITESPACE","        ",67],["T_COMMENT","\/\/ the UI adds Javascript that disables the other checkboxes, so their\n",67],["T_WHITESPACE","        ",68],["T_COMMENT","\/\/ values are not saved.\n",68],["T_WHITESPACE","        ",69],["T_FOREACH","foreach",69],["T_WHITESPACE"," ",69],"(",["T_STRING","array_filter",69],"(",["T_VARIABLE","$translation_sync",69],")",["T_WHITESPACE"," ",69],["T_AS","as",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$group",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n          ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_EMPTY","empty",70],"(",["T_VARIABLE","$column_groups",70],"[",["T_VARIABLE","$group",70],"]","[",["T_CONSTANT_ENCAPSED_STRING","'require_all_groups_for_translation'",70],"]",")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$groups",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],"[","]",";",["T_WHITESPACE","\n            ",71],["T_BREAK","break",72],";",["T_WHITESPACE","\n          ",72],"}",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_EMPTY","empty",75],"(",["T_VARIABLE","$groups",75],")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n          ",75],["T_VARIABLE","$columns",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",")",";",["T_WHITESPACE","\n          ",76],["T_FOREACH","foreach",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$groups",77],["T_WHITESPACE"," ",77],["T_AS","as",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$group",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$info",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$column_groups",78],"[",["T_VARIABLE","$group",78],"]",";",["T_WHITESPACE","\n            ",78],["T_COMMENT","\/\/ A missing 'columns' key indicates we have a single-column group.\n",79],["T_WHITESPACE","            ",80],["T_VARIABLE","$columns",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","array_merge",80],"(",["T_VARIABLE","$columns",80],",",["T_WHITESPACE"," ",80],["T_ISSET","isset",80],"(",["T_VARIABLE","$info",80],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",80],"]",")",["T_WHITESPACE"," ",80],"?",["T_WHITESPACE"," ",80],["T_VARIABLE","$info",80],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",80],"]",["T_WHITESPACE"," ",80],":",["T_WHITESPACE"," ",80],["T_ARRAY","array",80],"(",["T_VARIABLE","$group",80],")",")",";",["T_WHITESPACE","\n          ",80],"}",["T_WHITESPACE","\n          ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(","!",["T_EMPTY","empty",82],"(",["T_VARIABLE","$columns",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$values",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",")",";",["T_WHITESPACE","\n            ",83],["T_FOREACH","foreach",84],["T_WHITESPACE"," ",84],"(",["T_VARIABLE","$translations",84],["T_WHITESPACE"," ",84],["T_AS","as",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$langcode",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$language",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n              ",84],["T_VARIABLE","$values",85],"[",["T_VARIABLE","$langcode",85],"]",["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$entity",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getTranslation",85],"(",["T_VARIABLE","$langcode",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","get",85],"(",["T_VARIABLE","$field_name",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","getValue",85],"(",")",";",["T_WHITESPACE","\n            ",85],"}",["T_WHITESPACE","\n\n            ",86],["T_COMMENT","\/\/ If a translation is being created, the original values should be\n",88],["T_WHITESPACE","            ",89],["T_COMMENT","\/\/ used as the unchanged items. In fact there are no unchanged items\n",89],["T_WHITESPACE","            ",90],["T_COMMENT","\/\/ to check against.\n",90],["T_WHITESPACE","            ",91],["T_VARIABLE","$langcode",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$original_langcode",91],["T_WHITESPACE"," ",91],"?",":",["T_WHITESPACE"," ",91],["T_VARIABLE","$sync_langcode",91],";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$unchanged_items",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$entity_unchanged",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTranslation",92],"(",["T_VARIABLE","$langcode",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","get",92],"(",["T_VARIABLE","$field_name",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","getValue",92],"(",")",";",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","synchronizeItems",93],"(",["T_VARIABLE","$values",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$unchanged_items",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$sync_langcode",93],",",["T_WHITESPACE"," ",93],["T_STRING","array_keys",93],"(",["T_VARIABLE","$translations",93],")",",",["T_WHITESPACE"," ",93],["T_VARIABLE","$columns",93],")",";",["T_WHITESPACE","\n\n            ",93],["T_FOREACH","foreach",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$translations",95],["T_WHITESPACE"," ",95],["T_AS","as",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$langcode",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$language",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n              ",95],["T_VARIABLE","$entity",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getTranslation",96],"(",["T_VARIABLE","$langcode",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","get",96],"(",["T_VARIABLE","$field_name",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","setValue",96],"(",["T_VARIABLE","$values",96],"[",["T_VARIABLE","$langcode",96],"]",")",";",["T_WHITESPACE","\n            ",96],"}",["T_WHITESPACE","\n          ",97],"}",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE","\n      ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n  ",101],"}",["T_WHITESPACE","\n\n  ",102],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",104],["T_WHITESPACE","\n  ",106],["T_PUBLIC","public",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","synchronizeItems",107],"(",["T_ARRAY","array",107],["T_WHITESPACE"," ",107],"&",["T_VARIABLE","$values",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$unchanged_items",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$sync_langcode",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$translations",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$columns",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n    ",107],["T_VARIABLE","$source_items",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$values",108],"[",["T_VARIABLE","$sync_langcode",108],"]",";",["T_WHITESPACE","\n\n    ",108],["T_COMMENT","\/\/ Make sure we can detect any change in the source items.\n",110],["T_WHITESPACE","    ",111],["T_VARIABLE","$change_map",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n\n    ",111],["T_COMMENT","\/\/ By picking the maximum size between updated and unchanged items, we make\n",113],["T_WHITESPACE","    ",114],["T_COMMENT","\/\/ sure to process also removed items.\n",114],["T_WHITESPACE","    ",115],["T_VARIABLE","$total",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","max",115],"(",["T_ARRAY","array",115],"(",["T_STRING","count",115],"(",["T_VARIABLE","$source_items",115],")",",",["T_WHITESPACE"," ",115],["T_STRING","count",115],"(",["T_VARIABLE","$unchanged_items",115],")",")",")",";",["T_WHITESPACE","\n\n    ",115],["T_COMMENT","\/\/ As a first step we build a map of the deltas corresponding to the column\n",117],["T_WHITESPACE","    ",118],["T_COMMENT","\/\/ values to be synchronized. Recording both the old values and the new\n",118],["T_WHITESPACE","    ",119],["T_COMMENT","\/\/ values will allow us to detect any change in the order of the new items\n",119],["T_WHITESPACE","    ",120],["T_COMMENT","\/\/ for each column.\n",120],["T_WHITESPACE","    ",121],["T_FOR","for",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$delta",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_LNUMBER","0",121],";",["T_WHITESPACE"," ",121],["T_VARIABLE","$delta",121],["T_WHITESPACE"," ",121],"<",["T_WHITESPACE"," ",121],["T_VARIABLE","$total",121],";",["T_WHITESPACE"," ",121],["T_VARIABLE","$delta",121],["T_INC","++",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n      ",121],["T_FOREACH","foreach",122],["T_WHITESPACE"," ",122],"(",["T_ARRAY","array",122],"(",["T_CONSTANT_ENCAPSED_STRING","'old'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$unchanged_items",122],",",["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'new'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$source_items",122],")",["T_WHITESPACE"," ",122],["T_AS","as",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$key",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$items",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$item_id",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","itemHash",123],"(",["T_VARIABLE","$items",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$delta",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$columns",123],")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n          ",123],["T_VARIABLE","$change_map",124],"[",["T_VARIABLE","$item_id",124],"]","[",["T_VARIABLE","$key",124],"]","[","]",["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$delta",124],";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n      ",125],"}",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_COMMENT","\/\/ Backup field values and the change map.\n",129],["T_WHITESPACE","    ",130],["T_VARIABLE","$original_field_values",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$values",130],";",["T_WHITESPACE","\n    ",130],["T_VARIABLE","$original_change_map",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$change_map",131],";",["T_WHITESPACE","\n\n    ",131],["T_COMMENT","\/\/ Reset field values so that no spurious one is stored. Source values must\n",133],["T_WHITESPACE","    ",134],["T_COMMENT","\/\/ be preserved in any case.\n",134],["T_WHITESPACE","    ",135],["T_VARIABLE","$values",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_ARRAY","array",135],"(",["T_VARIABLE","$sync_langcode",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$source_items",135],")",";",["T_WHITESPACE","\n\n    ",135],["T_COMMENT","\/\/ Update field translations.\n",137],["T_WHITESPACE","    ",138],["T_FOREACH","foreach",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$translations",138],["T_WHITESPACE"," ",138],["T_AS","as",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$langcode",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n\n      ",138],["T_COMMENT","\/\/ We need to synchronize only values different from the source ones.\n",140],["T_WHITESPACE","      ",141],["T_IF","if",141],["T_WHITESPACE"," ",141],"(",["T_VARIABLE","$langcode",141],["T_WHITESPACE"," ",141],["T_IS_NOT_EQUAL","!=",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$sync_langcode",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n        ",141],["T_COMMENT","\/\/ Reinitialize the change map as it is emptied while processing each\n",142],["T_WHITESPACE","        ",143],["T_COMMENT","\/\/ language.\n",143],["T_WHITESPACE","        ",144],["T_VARIABLE","$change_map",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$original_change_map",144],";",["T_WHITESPACE","\n\n        ",144],["T_COMMENT","\/\/ By using the maximum cardinality we ensure to process removed items.\n",146],["T_WHITESPACE","        ",147],["T_FOR","for",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$delta",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_LNUMBER","0",147],";",["T_WHITESPACE"," ",147],["T_VARIABLE","$delta",147],["T_WHITESPACE"," ",147],"<",["T_WHITESPACE"," ",147],["T_VARIABLE","$total",147],";",["T_WHITESPACE"," ",147],["T_VARIABLE","$delta",147],["T_INC","++",147],")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n          ",147],["T_COMMENT","\/\/ By inspecting the map we built before we can tell whether a value\n",148],["T_WHITESPACE","          ",149],["T_COMMENT","\/\/ has been created or removed. A changed value will be interpreted as\n",149],["T_WHITESPACE","          ",150],["T_COMMENT","\/\/ a new value, in fact it did not exist before.\n",150],["T_WHITESPACE","          ",151],["T_VARIABLE","$created",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_STRING","TRUE",151],";",["T_WHITESPACE","\n          ",151],["T_VARIABLE","$removed",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_STRING","TRUE",152],";",["T_WHITESPACE","\n          ",152],["T_VARIABLE","$old_delta",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_STRING","NULL",153],";",["T_WHITESPACE","\n          ",153],["T_VARIABLE","$new_delta",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_STRING","NULL",154],";",["T_WHITESPACE","\n\n          ",154],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$item_id",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","itemHash",156],"(",["T_VARIABLE","$source_items",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$delta",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$columns",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(","!",["T_EMPTY","empty",157],"(",["T_VARIABLE","$change_map",157],"[",["T_VARIABLE","$item_id",157],"]","[",["T_CONSTANT_ENCAPSED_STRING","'old'",157],"]",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n              ",157],["T_VARIABLE","$old_delta",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","array_shift",158],"(",["T_VARIABLE","$change_map",158],"[",["T_VARIABLE","$item_id",158],"]","[",["T_CONSTANT_ENCAPSED_STRING","'old'",158],"]",")",";",["T_WHITESPACE","\n            ",158],"}",["T_WHITESPACE","\n            ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(","!",["T_EMPTY","empty",160],"(",["T_VARIABLE","$change_map",160],"[",["T_VARIABLE","$item_id",160],"]","[",["T_CONSTANT_ENCAPSED_STRING","'new'",160],"]",")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n              ",160],["T_VARIABLE","$new_delta",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","array_shift",161],"(",["T_VARIABLE","$change_map",161],"[",["T_VARIABLE","$item_id",161],"]","[",["T_CONSTANT_ENCAPSED_STRING","'new'",161],"]",")",";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$created",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$created",163],["T_WHITESPACE"," ",163],["T_BOOLEAN_AND","&&",163],["T_WHITESPACE"," ",163],"!",["T_ISSET","isset",163],"(",["T_VARIABLE","$old_delta",163],")",";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$removed",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$removed",164],["T_WHITESPACE"," ",164],["T_BOOLEAN_AND","&&",164],["T_WHITESPACE"," ",164],"!",["T_ISSET","isset",164],"(",["T_VARIABLE","$new_delta",164],")",";",["T_WHITESPACE","\n          ",164],"}",["T_WHITESPACE","\n\n          ",165],["T_COMMENT","\/\/ If an item has been removed we do not store its translations.\n",167],["T_WHITESPACE","          ",168],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$removed",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_CONTINUE","continue",169],";",["T_WHITESPACE","\n          ",169],"}",["T_WHITESPACE","\n          ",170],["T_COMMENT","\/\/ If a synchronized column has changed or has been created from\n",171],["T_WHITESPACE","          ",172],["T_COMMENT","\/\/ scratch we need to replace the values for this language as a\n",172],["T_WHITESPACE","          ",173],["T_COMMENT","\/\/ combination of the values that need to be synced from the source\n",173],["T_WHITESPACE","          ",174],["T_COMMENT","\/\/ items and the other columns from the existing values. This only\n",174],["T_WHITESPACE","          ",175],["T_COMMENT","\/\/ works if the delta exists in the language.\n",175],["T_WHITESPACE","          ",176],["T_ELSEIF","elseif",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$created",176],["T_WHITESPACE"," ",176],["T_BOOLEAN_AND","&&",176],["T_WHITESPACE"," ",176],"!",["T_EMPTY","empty",176],"(",["T_VARIABLE","$original_field_values",176],"[",["T_VARIABLE","$langcode",176],"]","[",["T_VARIABLE","$delta",176],"]",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$item_columns_to_sync",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","array_intersect_key",177],"(",["T_VARIABLE","$source_items",177],"[",["T_VARIABLE","$delta",177],"]",",",["T_WHITESPACE"," ",177],["T_STRING","array_flip",177],"(",["T_VARIABLE","$columns",177],")",")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$item_columns_to_keep",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","array_diff_key",178],"(",["T_VARIABLE","$original_field_values",178],"[",["T_VARIABLE","$langcode",178],"]","[",["T_VARIABLE","$delta",178],"]",",",["T_WHITESPACE"," ",178],["T_STRING","array_flip",178],"(",["T_VARIABLE","$columns",178],")",")",";",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$values",179],"[",["T_VARIABLE","$langcode",179],"]","[",["T_VARIABLE","$delta",179],"]",["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$item_columns_to_sync",179],["T_WHITESPACE"," ",179],"+",["T_WHITESPACE"," ",179],["T_VARIABLE","$item_columns_to_keep",179],";",["T_WHITESPACE","\n          ",179],"}",["T_WHITESPACE","\n          ",180],["T_COMMENT","\/\/ If the delta doesn't exist, copy from the source language.\n",181],["T_WHITESPACE","          ",182],["T_ELSEIF","elseif",182],["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$created",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$values",183],"[",["T_VARIABLE","$langcode",183],"]","[",["T_VARIABLE","$delta",183],"]",["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$source_items",183],"[",["T_VARIABLE","$delta",183],"]",";",["T_WHITESPACE","\n          ",183],"}",["T_WHITESPACE","\n          ",184],["T_COMMENT","\/\/ Otherwise the current item might have been reordered.\n",185],["T_WHITESPACE","          ",186],["T_ELSEIF","elseif",186],["T_WHITESPACE"," ",186],"(",["T_ISSET","isset",186],"(",["T_VARIABLE","$old_delta",186],")",["T_WHITESPACE"," ",186],["T_BOOLEAN_AND","&&",186],["T_WHITESPACE"," ",186],["T_ISSET","isset",186],"(",["T_VARIABLE","$new_delta",186],")",")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_COMMENT","\/\/ If for any reason the old value is not defined for the current\n",187],["T_WHITESPACE","            ",188],["T_COMMENT","\/\/ language we fall back to the new source value, this way we ensure\n",188],["T_WHITESPACE","            ",189],["T_COMMENT","\/\/ the new values are at least propagated to all the translations.\n",189],["T_WHITESPACE","            ",190],["T_COMMENT","\/\/ If the value has only been reordered we just move the old one in\n",190],["T_WHITESPACE","            ",191],["T_COMMENT","\/\/ the new position.\n",191],["T_WHITESPACE","            ",192],["T_VARIABLE","$item",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_ISSET","isset",192],"(",["T_VARIABLE","$original_field_values",192],"[",["T_VARIABLE","$langcode",192],"]","[",["T_VARIABLE","$old_delta",192],"]",")",["T_WHITESPACE"," ",192],"?",["T_WHITESPACE"," ",192],["T_VARIABLE","$original_field_values",192],"[",["T_VARIABLE","$langcode",192],"]","[",["T_VARIABLE","$old_delta",192],"]",["T_WHITESPACE"," ",192],":",["T_WHITESPACE"," ",192],["T_VARIABLE","$source_items",192],"[",["T_VARIABLE","$new_delta",192],"]",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$values",193],"[",["T_VARIABLE","$langcode",193],"]","[",["T_VARIABLE","$new_delta",193],"]",["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$item",193],";",["T_WHITESPACE","\n          ",193],"}",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n      ",195],"}",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n  ",197],"}",["T_WHITESPACE","\n\n  ",198],["T_DOC_COMMENT","\/**\n   * Computes a hash code for the specified item.\n   *\n   * @param array $items\n   *   An array of field items.\n   * @param int $delta\n   *   The delta identifying the item to be processed.\n   * @param array $columns\n   *   An array of column names to be synchronized.\n   *\n   * @returns string\n   *   A hash code that can be used to identify the item.\n   *\/",200],["T_WHITESPACE","\n  ",212],["T_PROTECTED","protected",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","itemHash",213],"(",["T_ARRAY","array",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$items",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$delta",213],",",["T_WHITESPACE"," ",213],["T_ARRAY","array",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$columns",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n    ",213],["T_VARIABLE","$values",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",")",";",["T_WHITESPACE","\n\n    ",214],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_ISSET","isset",216],"(",["T_VARIABLE","$items",216],"[",["T_VARIABLE","$delta",216],"]",")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n      ",216],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$columns",217],["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$column",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(","!",["T_EMPTY","empty",218],"(",["T_VARIABLE","$items",218],"[",["T_VARIABLE","$delta",218],"]","[",["T_VARIABLE","$column",218],"]",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n          ",218],["T_VARIABLE","$value",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$items",219],"[",["T_VARIABLE","$delta",219],"]","[",["T_VARIABLE","$column",219],"]",";",["T_WHITESPACE","\n          ",219],["T_COMMENT","\/\/ String and integer values are by far the most common item values,\n",220],["T_WHITESPACE","          ",221],["T_COMMENT","\/\/ thus we special-case them to improve performance.\n",221],["T_WHITESPACE","          ",222],["T_VARIABLE","$values",222],"[","]",["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_STRING","is_string",222],"(",["T_VARIABLE","$value",222],")",["T_WHITESPACE"," ",222],["T_BOOLEAN_OR","||",222],["T_WHITESPACE"," ",222],["T_STRING","is_int",222],"(",["T_VARIABLE","$value",222],")",["T_WHITESPACE"," ",222],"?",["T_WHITESPACE"," ",222],["T_VARIABLE","$value",222],["T_WHITESPACE"," ",222],":",["T_WHITESPACE"," ",222],["T_STRING","hash",222],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",222],",",["T_WHITESPACE"," ",222],["T_STRING","serialize",222],"(",["T_VARIABLE","$value",222],")",")",";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n        ",223],["T_ELSE","else",224],["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n          ",224],["T_COMMENT","\/\/ Explicitly track also empty values.\n",225],["T_WHITESPACE","          ",226],["T_VARIABLE","$values",226],"[","]",["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","''",226],";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n      ",227],"}",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_RETURN","return",231],["T_WHITESPACE"," ",231],["T_STRING","implode",231],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$values",231],")",";",["T_WHITESPACE","\n  ",231],"}",["T_WHITESPACE","\n\n",232],"}",["T_WHITESPACE","\n",234]]