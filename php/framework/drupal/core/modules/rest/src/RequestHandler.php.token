[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","rest",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","DependencyInjection",5],["T_NS_SEPARATOR","\\",5],["T_STRING","ContainerInjectionInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EntityStorageInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Cache",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CacheableResponseInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Render",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RenderContext",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Routing",9],["T_NS_SEPARATOR","\\",9],["T_STRING","RouteMatchInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Symfony",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Component",10],["T_NS_SEPARATOR","\\",10],["T_STRING","DependencyInjection",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ContainerAwareInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Symfony",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Component",11],["T_NS_SEPARATOR","\\",11],["T_STRING","DependencyInjection",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ContainerAwareTrait",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","DependencyInjection",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ContainerInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Symfony",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Component",13],["T_NS_SEPARATOR","\\",13],["T_STRING","HttpFoundation",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Request",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","HttpFoundation",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Response",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpKernel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Exception",15],["T_NS_SEPARATOR","\\",15],["T_STRING","UnsupportedMediaTypeHttpException",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Symfony",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Component",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Serializer",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Exception",16],["T_NS_SEPARATOR","\\",16],["T_STRING","UnexpectedValueException",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Symfony",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Serializer",17],["T_NS_SEPARATOR","\\",17],["T_STRING","SerializerInterface",17],";",["T_WHITESPACE","\n\n",17],["T_DOC_COMMENT","\/**\n * Acts as intermediate request forwarder for resource plugins.\n *\/",19],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","RequestHandler",22],["T_WHITESPACE"," ",22],["T_IMPLEMENTS","implements",22],["T_WHITESPACE"," ",22],["T_STRING","ContainerAwareInterface",22],",",["T_WHITESPACE"," ",22],["T_STRING","ContainerInjectionInterface",22],["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n\n  ",22],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","ContainerAwareTrait",24],";",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * The resource configuration storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityStorageInterface\n   *\/",26],["T_WHITESPACE","\n  ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$resourceStorage",31],";",["T_WHITESPACE","\n\n  ",31],["T_DOC_COMMENT","\/**\n   * Creates a new RequestHandler instance.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityStorageInterface $entity_storage\n   *   The resource configuration storage.\n   *\/",33],["T_WHITESPACE","\n  ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","__construct",39],"(",["T_STRING","EntityStorageInterface",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$entity_storage",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","resourceStorage",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$entity_storage",40],";",["T_WHITESPACE","\n  ",40],"}",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",43],["T_WHITESPACE","\n  ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_STATIC","static",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","create",46],"(",["T_STRING","ContainerInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$container",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_NEW","new",47],["T_WHITESPACE"," ",47],["T_STATIC","static",47],"(",["T_VARIABLE","$container",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","get",47],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type.manager'",47],")",["T_OBJECT_OPERATOR","->",47],["T_STRING","getStorage",47],"(",["T_CONSTANT_ENCAPSED_STRING","'rest_resource_config'",47],")",")",";",["T_WHITESPACE","\n  ",47],"}",["T_WHITESPACE","\n\n  ",48],["T_DOC_COMMENT","\/**\n   * Handles a web API request.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The route match.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The HTTP request object.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\Response\n   *   The response object.\n   *\/",50],["T_WHITESPACE","\n  ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","handle",61],"(",["T_STRING","RouteMatchInterface",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$route_match",61],",",["T_WHITESPACE"," ",61],["T_STRING","Request",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$request",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$method",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","strtolower",62],"(",["T_VARIABLE","$request",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getMethod",62],"(",")",")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Symfony is built to transparently map HEAD requests to a GET request. In\n",64],["T_WHITESPACE","    ",65],["T_COMMENT","\/\/ the case of the REST module's RequestHandler though, we essentially have\n",65],["T_WHITESPACE","    ",66],["T_COMMENT","\/\/ our own light-weight routing system on top of the Drupal\/symfony routing\n",66],["T_WHITESPACE","    ",67],["T_COMMENT","\/\/ system. So, we have to do the same as what the UrlMatcher does: map HEAD\n",67],["T_WHITESPACE","    ",68],["T_COMMENT","\/\/ requests to the logic for GET. This also guarantees response headers for\n",68],["T_WHITESPACE","    ",69],["T_COMMENT","\/\/ HEAD requests are identical to those for GET requests, because we just\n",69],["T_WHITESPACE","    ",70],["T_COMMENT","\/\/ return a GET response. Response::prepare() will transform it to a HEAD\n",70],["T_WHITESPACE","    ",71],["T_COMMENT","\/\/ response at the very last moment.\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ @see https:\/\/www.w3.org\/Protocols\/rfc2616\/rfc2616-sec9.html#sec9.4\n",72],["T_WHITESPACE","    ",73],["T_COMMENT","\/\/ @see \\Symfony\\Component\\Routing\\Matcher\\UrlMatcher::matchCollection()\n",73],["T_WHITESPACE","    ",74],["T_COMMENT","\/\/ @see \\Symfony\\Component\\HttpFoundation\\Response::prepare()\n",74],["T_WHITESPACE","    ",75],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$method",75],["T_WHITESPACE"," ",75],["T_IS_IDENTICAL","===",75],["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'head'",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n      ",75],["T_VARIABLE","$method",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'get'",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_VARIABLE","$resource_config_id",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$route_match",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getRouteObject",79],"(",")",["T_OBJECT_OPERATOR","->",79],["T_STRING","getDefault",79],"(",["T_CONSTANT_ENCAPSED_STRING","'_rest_resource_config'",79],")",";",["T_WHITESPACE","\n    ",79],["T_DOC_COMMENT","\/** @var \\Drupal\\rest\\RestResourceConfigInterface $resource_config *\/",80],["T_WHITESPACE","\n    ",80],["T_VARIABLE","$resource_config",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","resourceStorage",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","load",81],"(",["T_VARIABLE","$resource_config_id",81],")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$resource",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$resource_config",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getResourcePlugin",82],"(",")",";",["T_WHITESPACE","\n\n    ",82],["T_COMMENT","\/\/ Deserialize incoming data if available.\n",84],["T_WHITESPACE","    ",85],["T_DOC_COMMENT","\/** @var \\Symfony\\Component\\Serializer\\SerializerInterface $serializer *\/",85],["T_WHITESPACE","\n    ",85],["T_VARIABLE","$serializer",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","container",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","get",86],"(",["T_CONSTANT_ENCAPSED_STRING","'serializer'",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$received",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$request",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getContent",87],"(",")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$unserialized",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","NULL",88],";",["T_WHITESPACE","\n    ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(","!",["T_EMPTY","empty",89],"(",["T_VARIABLE","$received",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n      ",89],["T_VARIABLE","$format",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$request",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getContentType",90],"(",")",";",["T_WHITESPACE","\n\n      ",90],["T_COMMENT","\/\/ Only allow serialization formats that are explicitly configured. If no\n",92],["T_WHITESPACE","      ",93],["T_COMMENT","\/\/ formats are configured allow all and hope that the serializer knows the\n",93],["T_WHITESPACE","      ",94],["T_COMMENT","\/\/ format. If the serializer cannot handle it an exception will be thrown\n",94],["T_WHITESPACE","      ",95],["T_COMMENT","\/\/ that bubbles up to the client.\n",95],["T_WHITESPACE","      ",96],["T_VARIABLE","$request_method",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$request",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getMethod",96],"(",")",";",["T_WHITESPACE","\n      ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_STRING","in_array",97],"(",["T_VARIABLE","$format",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$resource_config",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getFormats",97],"(",["T_VARIABLE","$request_method",97],")",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$definition",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$resource",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getPluginDefinition",98],"(",")",";",["T_WHITESPACE","\n        ",98],["T_TRY","try",99],["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n          ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_EMPTY","empty",100],"(",["T_VARIABLE","$definition",100],"[",["T_CONSTANT_ENCAPSED_STRING","'serialization_class'",100],"]",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$unserialized",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$serializer",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","deserialize",101],"(",["T_VARIABLE","$received",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$definition",101],"[",["T_CONSTANT_ENCAPSED_STRING","'serialization_class'",101],"]",",",["T_WHITESPACE"," ",101],["T_VARIABLE","$format",101],",",["T_WHITESPACE"," ",101],["T_ARRAY","array",101],"(",["T_CONSTANT_ENCAPSED_STRING","'request_method'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$method",101],")",")",";",["T_WHITESPACE","\n          ",101],"}",["T_WHITESPACE","\n          ",102],["T_COMMENT","\/\/ If the plugin does not specify a serialization class just decode\n",103],["T_WHITESPACE","          ",104],["T_COMMENT","\/\/ the received data.\n",104],["T_WHITESPACE","          ",105],["T_ELSE","else",105],["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$unserialized",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$serializer",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","decode",106],"(",["T_VARIABLE","$received",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$format",106],",",["T_WHITESPACE"," ",106],["T_ARRAY","array",106],"(",["T_CONSTANT_ENCAPSED_STRING","'request_method'",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$method",106],")",")",";",["T_WHITESPACE","\n          ",106],"}",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_CATCH","catch",109],["T_WHITESPACE"," ",109],"(",["T_STRING","UnexpectedValueException",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$e",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n          ",109],["T_VARIABLE","$error",110],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",110],"]",["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$e",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getMessage",110],"(",")",";",["T_WHITESPACE","\n          ",110],["T_VARIABLE","$content",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$serializer",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","serialize",111],"(",["T_VARIABLE","$error",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$format",111],")",";",["T_WHITESPACE","\n          ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_NEW","new",112],["T_WHITESPACE"," ",112],["T_STRING","Response",112],"(",["T_VARIABLE","$content",112],",",["T_WHITESPACE"," ",112],["T_LNUMBER","400",112],",",["T_WHITESPACE"," ",112],["T_ARRAY","array",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type'",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$request",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getMimeType",112],"(",["T_VARIABLE","$format",112],")",")",")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n      ",113],"}",["T_WHITESPACE","\n      ",114],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n        ",115],["T_THROW","throw",116],["T_WHITESPACE"," ",116],["T_NEW","new",116],["T_WHITESPACE"," ",116],["T_STRING","UnsupportedMediaTypeHttpException",116],"(",")",";",["T_WHITESPACE","\n      ",116],"}",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_COMMENT","\/\/ Determine the request parameters that should be passed to the resource\n",120],["T_WHITESPACE","    ",121],["T_COMMENT","\/\/ plugin.\n",121],["T_WHITESPACE","    ",122],["T_VARIABLE","$route_parameters",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$route_match",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getParameters",122],"(",")",";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$parameters",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",")",";",["T_WHITESPACE","\n    ",123],["T_COMMENT","\/\/ Filter out all internal parameters starting with \"_\".\n",124],["T_WHITESPACE","    ",125],["T_FOREACH","foreach",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$route_parameters",125],["T_WHITESPACE"," ",125],["T_AS","as",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$key",125],["T_WHITESPACE"," ",125],["T_DOUBLE_ARROW","=>",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$parameter",125],")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n      ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$key",126],"{",["T_LNUMBER","0",126],"}",["T_WHITESPACE"," ",126],["T_IS_NOT_IDENTICAL","!==",126],["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'_'",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$parameters",127],"[","]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$parameter",127],";",["T_WHITESPACE","\n      ",127],"}",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_COMMENT","\/\/ Invoke the operation on the resource plugin.\n",131],["T_WHITESPACE","    ",132],["T_VARIABLE","$format",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getResponseFormat",132],"(",["T_VARIABLE","$route_match",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$request",132],")",";",["T_WHITESPACE","\n    ",132],["T_VARIABLE","$response",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","call_user_func_array",133],"(",["T_ARRAY","array",133],"(",["T_VARIABLE","$resource",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$method",133],")",",",["T_WHITESPACE"," ",133],["T_STRING","array_merge",133],"(",["T_VARIABLE","$parameters",133],",",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",["T_VARIABLE","$unserialized",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$request",133],")",")",")",";",["T_WHITESPACE","\n\n    ",133],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$response",135],["T_WHITESPACE"," ",135],["T_INSTANCEOF","instanceof",135],["T_WHITESPACE"," ",135],["T_STRING","ResourceResponseInterface",135],["T_WHITESPACE"," ",135],"?",["T_WHITESPACE","\n      ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","renderResponse",136],"(",["T_VARIABLE","$request",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$response",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$serializer",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$format",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$resource_config",136],")",["T_WHITESPACE"," ",136],":",["T_WHITESPACE","\n      ",136],["T_VARIABLE","$response",137],";",["T_WHITESPACE","\n  ",137],"}",["T_WHITESPACE","\n\n  ",138],["T_DOC_COMMENT","\/**\n   * Determines the format to respond in.\n   *\n   * Respects the requested format if one is specified. However, it is common to\n   * forget to specify a request format in case of a POST or PATCH. Rather than\n   * simply throwing an error, we apply the robustness principle: when POSTing\n   * or PATCHing using a certain format, you probably expect a response in that\n   * same format.\n   *\n   * @param \\Drupal\\Core\\Routing\\RouteMatchInterface $route_match\n   *   The current route match.\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The current request.\n   *\n   * @return string\n   *   The response format.\n   *\/",140],["T_WHITESPACE","\n  ",156],["T_PROTECTED","protected",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","getResponseFormat",157],"(",["T_STRING","RouteMatchInterface",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$route_match",157],",",["T_WHITESPACE"," ",157],["T_STRING","Request",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$request",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n    ",157],["T_VARIABLE","$route",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$route_match",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getRouteObject",158],"(",")",";",["T_WHITESPACE","\n    ",158],["T_VARIABLE","$acceptable_request_formats",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$route",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","hasRequirement",159],"(",["T_CONSTANT_ENCAPSED_STRING","'_format'",159],")",["T_WHITESPACE"," ",159],"?",["T_WHITESPACE"," ",159],["T_STRING","explode",159],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$route",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getRequirement",159],"(",["T_CONSTANT_ENCAPSED_STRING","'_format'",159],")",")",["T_WHITESPACE"," ",159],":",["T_WHITESPACE"," ",159],"[","]",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$acceptable_content_type_formats",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$route",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","hasRequirement",160],"(",["T_CONSTANT_ENCAPSED_STRING","'_content_type_format'",160],")",["T_WHITESPACE"," ",160],"?",["T_WHITESPACE"," ",160],["T_STRING","explode",160],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$route",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getRequirement",160],"(",["T_CONSTANT_ENCAPSED_STRING","'_content_type_format'",160],")",")",["T_WHITESPACE"," ",160],":",["T_WHITESPACE"," ",160],"[","]",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$acceptable_formats",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$request",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","isMethodSafe",161],"(",")",["T_WHITESPACE"," ",161],"?",["T_WHITESPACE"," ",161],["T_VARIABLE","$acceptable_request_formats",161],["T_WHITESPACE"," ",161],":",["T_WHITESPACE"," ",161],["T_VARIABLE","$acceptable_content_type_formats",161],";",["T_WHITESPACE","\n\n    ",161],["T_VARIABLE","$requested_format",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$request",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getRequestFormat",163],"(",")",";",["T_WHITESPACE","\n    ",163],["T_VARIABLE","$content_type_format",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$request",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getContentType",164],"(",")",";",["T_WHITESPACE","\n\n    ",164],["T_COMMENT","\/\/ If an acceptable format is requested, then use that. Otherwise, including\n",166],["T_WHITESPACE","    ",167],["T_COMMENT","\/\/ and particularly when the client forgot to specify a format, then use\n",167],["T_WHITESPACE","    ",168],["T_COMMENT","\/\/ heuristics to select the format that is most likely expected.\n",168],["T_WHITESPACE","    ",169],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_STRING","in_array",169],"(",["T_VARIABLE","$requested_format",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$acceptable_formats",169],")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n      ",169],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$requested_format",170],";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n    ",171],["T_COMMENT","\/\/ If a request body is present, then use the format corresponding to the\n",172],["T_WHITESPACE","    ",173],["T_COMMENT","\/\/ request body's Content-Type for the response, if it's an acceptable\n",173],["T_WHITESPACE","    ",174],["T_COMMENT","\/\/ format for the request.\n",174],["T_WHITESPACE","    ",175],["T_ELSEIF","elseif",175],["T_WHITESPACE"," ",175],"(","!",["T_EMPTY","empty",175],"(",["T_VARIABLE","$request",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getContent",175],"(",")",")",["T_WHITESPACE"," ",175],["T_BOOLEAN_AND","&&",175],["T_WHITESPACE"," ",175],["T_STRING","in_array",175],"(",["T_VARIABLE","$content_type_format",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$acceptable_content_type_formats",175],")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n      ",175],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$content_type_format",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n    ",177],["T_COMMENT","\/\/ Otherwise, use the first acceptable format.\n",178],["T_WHITESPACE","    ",179],["T_ELSEIF","elseif",179],["T_WHITESPACE"," ",179],"(","!",["T_EMPTY","empty",179],"(",["T_VARIABLE","$acceptable_formats",179],")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n      ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$acceptable_formats",180],"[",["T_LNUMBER","0",180],"]",";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n    ",181],["T_COMMENT","\/\/ Sometimes, there are no acceptable formats, e.g. DELETE routes.\n",182],["T_WHITESPACE","    ",183],["T_ELSE","else",183],["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n      ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_STRING","NULL",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n  ",185],"}",["T_WHITESPACE","\n\n  ",186],["T_DOC_COMMENT","\/**\n   * Renders a resource response.\n   *\n   * Serialization can invoke rendering (e.g., generating URLs), but the\n   * serialization API does not provide a mechanism to collect the\n   * bubbleable metadata associated with that (e.g., language and other\n   * contexts), so instead, allow those to \"leak\" and collect them here in\n   * a render context.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param \\Drupal\\rest\\ResourceResponseInterface $response\n   *   The response from the REST resource.\n   * @param \\Symfony\\Component\\Serializer\\SerializerInterface $serializer\n   *   The serializer to use.\n   * @param string|null $format\n   *   The response format, or NULL in case the response does not need a format,\n   *   for example for the response to a DELETE request.\n   * @param \\Drupal\\rest\\RestResourceConfigInterface $resource_config\n   *   The resource config.\n   *\n   * @return \\Drupal\\rest\\ResourceResponse\n   *   The altered response.\n   *\n   * @todo Add test coverage for language negotiation contexts in\n   *   https:\/\/www.drupal.org\/node\/2135829.\n   *\/",188],["T_WHITESPACE","\n  ",214],["T_PROTECTED","protected",215],["T_WHITESPACE"," ",215],["T_FUNCTION","function",215],["T_WHITESPACE"," ",215],["T_STRING","renderResponse",215],"(",["T_STRING","Request",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$request",215],",",["T_WHITESPACE"," ",215],["T_STRING","ResourceResponseInterface",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$response",215],",",["T_WHITESPACE"," ",215],["T_STRING","SerializerInterface",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$serializer",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$format",215],",",["T_WHITESPACE"," ",215],["T_STRING","RestResourceConfigInterface",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$resource_config",215],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n    ",215],["T_VARIABLE","$data",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$response",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getResponseData",216],"(",")",";",["T_WHITESPACE","\n\n    ",216],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$response",218],["T_WHITESPACE"," ",218],["T_INSTANCEOF","instanceof",218],["T_WHITESPACE"," ",218],["T_STRING","CacheableResponseInterface",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n      ",218],["T_COMMENT","\/\/ Add rest config's cache tags.\n",219],["T_WHITESPACE","      ",220],["T_VARIABLE","$response",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","addCacheableDependency",220],"(",["T_VARIABLE","$resource_config",220],")",";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_COMMENT","\/\/ If there is data to send, serialize and set it as the response body.\n",223],["T_WHITESPACE","    ",224],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$data",224],["T_WHITESPACE"," ",224],["T_IS_NOT_IDENTICAL","!==",224],["T_WHITESPACE"," ",224],["T_STRING","NULL",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n      ",224],["T_IF","if",225],["T_WHITESPACE"," ",225],"(",["T_VARIABLE","$response",225],["T_WHITESPACE"," ",225],["T_INSTANCEOF","instanceof",225],["T_WHITESPACE"," ",225],["T_STRING","CacheableResponseInterface",225],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$context",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_NEW","new",226],["T_WHITESPACE"," ",226],["T_STRING","RenderContext",226],"(",")",";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$output",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","container",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","get",227],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",227],")",["T_WHITESPACE","\n          ",227],["T_OBJECT_OPERATOR","->",228],["T_STRING","executeInRenderContext",228],"(",["T_VARIABLE","$context",228],",",["T_WHITESPACE"," ",228],["T_FUNCTION","function",228],["T_WHITESPACE"," ",228],"(",")",["T_WHITESPACE"," ",228],["T_USE","use",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$serializer",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$data",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$format",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_RETURN","return",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$serializer",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","serialize",229],"(",["T_VARIABLE","$data",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$format",229],")",";",["T_WHITESPACE","\n          ",229],"}",")",";",["T_WHITESPACE","\n\n        ",230],["T_IF","if",232],["T_WHITESPACE"," ",232],"(","!",["T_VARIABLE","$context",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","isEmpty",232],"(",")",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n          ",232],["T_VARIABLE","$response",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","addCacheableDependency",233],"(",["T_VARIABLE","$context",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","pop",233],"(",")",")",";",["T_WHITESPACE","\n        ",233],"}",["T_WHITESPACE","\n      ",234],"}",["T_WHITESPACE","\n      ",235],["T_ELSE","else",236],["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$output",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$serializer",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","serialize",237],"(",["T_VARIABLE","$data",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$format",237],")",";",["T_WHITESPACE","\n      ",237],"}",["T_WHITESPACE","\n\n      ",238],["T_VARIABLE","$response",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","setContent",240],"(",["T_VARIABLE","$output",240],")",";",["T_WHITESPACE","\n      ",240],["T_VARIABLE","$response",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","headers",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","set",241],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type'",241],",",["T_WHITESPACE"," ",241],["T_VARIABLE","$request",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getMimeType",241],"(",["T_VARIABLE","$format",241],")",")",";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_RETURN","return",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$response",244],";",["T_WHITESPACE","\n  ",244],"}",["T_WHITESPACE","\n\n",245],"}",["T_WHITESPACE","\n",247]]