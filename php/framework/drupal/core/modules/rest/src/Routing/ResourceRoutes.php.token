[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","rest",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Routing",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","EntityTypeManagerInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Routing",6],["T_NS_SEPARATOR","\\",6],["T_STRING","RouteSubscriberBase",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","rest",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Plugin",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Type",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ResourcePluginManager",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","rest",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RestResourceConfigInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Psr",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Log",9],["T_NS_SEPARATOR","\\",9],["T_STRING","LoggerInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Symfony",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Component",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Routing",10],["T_NS_SEPARATOR","\\",10],["T_STRING","RouteCollection",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Subscriber for REST-style routes.\n *\/",12],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","ResourceRoutes",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","RouteSubscriberBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * The plugin manager for REST plugins.\n   *\n   * @var \\Drupal\\rest\\Plugin\\Type\\ResourcePluginManager\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$manager",22],";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * The REST resource config storage.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",24],["T_WHITESPACE","\n  ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$resourceConfigStorage",29],";",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * A logger instance.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   *\/",31],["T_WHITESPACE","\n  ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$logger",36],";",["T_WHITESPACE","\n\n  ",36],["T_DOC_COMMENT","\/**\n   * Constructs a RouteSubscriber object.\n   *\n   * @param \\Drupal\\rest\\Plugin\\Type\\ResourcePluginManager $manager\n   *   The resource plugin manager.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeManagerInterface $entity_type_manager\n   *   The entity type manager\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   A logger instance.\n   *\/",38],["T_WHITESPACE","\n  ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","__construct",48],"(",["T_STRING","ResourcePluginManager",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$manager",48],",",["T_WHITESPACE"," ",48],["T_STRING","EntityTypeManagerInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$entity_type_manager",48],",",["T_WHITESPACE"," ",48],["T_STRING","LoggerInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$logger",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","manager",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$manager",49],";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","resourceConfigStorage",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$entity_type_manager",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getStorage",50],"(",["T_CONSTANT_ENCAPSED_STRING","'rest_resource_config'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","logger",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$logger",51],";",["T_WHITESPACE","\n  ",51],"}",["T_WHITESPACE","\n\n  ",52],["T_DOC_COMMENT","\/**\n   * Alters existing routes for a specific collection.\n   *\n   * @param \\Symfony\\Component\\Routing\\RouteCollection $collection\n   *   The route collection for adding routes.\n   * @return array\n   *\/",54],["T_WHITESPACE","\n  ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","alterRoutes",61],"(",["T_STRING","RouteCollection",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$collection",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n    ",61],["T_COMMENT","\/\/ Iterate over all enabled REST resource configs.\n",62],["T_WHITESPACE","    ",63],["T_DOC_COMMENT","\/** @var \\Drupal\\rest\\RestResourceConfigInterface[] $resource_configs *\/",63],["T_WHITESPACE","\n    ",63],["T_VARIABLE","$resource_configs",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","resourceConfigStorage",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","loadMultiple",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_COMMENT","\/\/ Iterate over all enabled resource plugins.\n",65],["T_WHITESPACE","    ",66],["T_FOREACH","foreach",66],["T_WHITESPACE"," ",66],"(",["T_VARIABLE","$resource_configs",66],["T_WHITESPACE"," ",66],["T_AS","as",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$resource_config",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n      ",66],["T_VARIABLE","$resource_routes",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getRoutesForResourceConfig",67],"(",["T_VARIABLE","$resource_config",67],")",";",["T_WHITESPACE","\n      ",67],["T_VARIABLE","$collection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","addCollection",68],"(",["T_VARIABLE","$resource_routes",68],")",";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n  ",69],"}",["T_WHITESPACE","\n\n  ",70],["T_DOC_COMMENT","\/**\n   * Provides all routes for a given REST resource config.\n   *\n   * This method determines where a resource is reachable, what path\n   * replacements are used, the required HTTP method for the operation etc.\n   *\n   * @param \\Drupal\\rest\\RestResourceConfigInterface $rest_resource_config\n   *   The rest resource config.\n   *\n   * @return \\Symfony\\Component\\Routing\\RouteCollection\n   *   The route collection.\n   *\/",72],["T_WHITESPACE","\n  ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","getRoutesForResourceConfig",84],"(",["T_STRING","RestResourceConfigInterface",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$rest_resource_config",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$plugin",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$rest_resource_config",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getResourcePlugin",85],"(",")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$collection",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_NEW","new",86],["T_WHITESPACE"," ",86],["T_STRING","RouteCollection",86],"(",")",";",["T_WHITESPACE","\n\n    ",86],["T_FOREACH","foreach",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$plugin",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","routes",88],"(",")",["T_WHITESPACE"," ",88],["T_AS","as",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$name",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$route",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n      ",88],["T_DOC_COMMENT","\/** @var \\Symfony\\Component\\Routing\\Route $route *\/",89],["T_WHITESPACE","\n      ",89],["T_COMMENT","\/\/ @todo: Are multiple methods possible here?\n",90],["T_WHITESPACE","      ",91],["T_VARIABLE","$methods",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$route",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getMethods",91],"(",")",";",["T_WHITESPACE","\n      ",91],["T_COMMENT","\/\/ Only expose routes where the method is enabled in the configuration.\n",92],["T_WHITESPACE","      ",93],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$methods",93],["T_WHITESPACE"," ",93],["T_BOOLEAN_AND","&&",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$method",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$methods",93],"[",["T_LNUMBER","0",93],"]",")",["T_WHITESPACE"," ",93],["T_BOOLEAN_AND","&&",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$supported_formats",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$rest_resource_config",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getFormats",93],"(",["T_VARIABLE","$method",93],")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$route",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setRequirement",94],"(",["T_CONSTANT_ENCAPSED_STRING","'_csrf_request_header_token'",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'TRUE'",94],")",";",["T_WHITESPACE","\n\n        ",94],["T_COMMENT","\/\/ Check that authentication providers are defined.\n",96],["T_WHITESPACE","        ",97],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_EMPTY","empty",97],"(",["T_VARIABLE","$rest_resource_config",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getAuthenticationProviders",97],"(",["T_VARIABLE","$method",97],")",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n          ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","logger",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","error",98],"(",["T_CONSTANT_ENCAPSED_STRING","'At least one authentication provider must be defined for resource @id'",98],",",["T_WHITESPACE"," ",98],["T_ARRAY","array",98],"(",["T_CONSTANT_ENCAPSED_STRING","':id'",98],["T_WHITESPACE"," ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$rest_resource_config",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","id",98],"(",")",")",")",";",["T_WHITESPACE","\n          ",98],["T_CONTINUE","continue",99],";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n\n        ",100],["T_COMMENT","\/\/ Check that formats are defined.\n",102],["T_WHITESPACE","        ",103],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_EMPTY","empty",103],"(",["T_VARIABLE","$rest_resource_config",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getFormats",103],"(",["T_VARIABLE","$method",103],")",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n          ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","logger",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","error",104],"(",["T_CONSTANT_ENCAPSED_STRING","'At least one format must be defined for resource @id'",104],",",["T_WHITESPACE"," ",104],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","':id'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$rest_resource_config",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","id",104],"(",")",")",")",";",["T_WHITESPACE","\n          ",104],["T_CONTINUE","continue",105],";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_COMMENT","\/\/ If the route has a format requirement, then verify that the\n",108],["T_WHITESPACE","        ",109],["T_COMMENT","\/\/ resource has it.\n",109],["T_WHITESPACE","        ",110],["T_VARIABLE","$format_requirement",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$route",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getRequirement",110],"(",["T_CONSTANT_ENCAPSED_STRING","'_format'",110],")",";",["T_WHITESPACE","\n        ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$format_requirement",111],["T_WHITESPACE"," ",111],["T_BOOLEAN_AND","&&",111],["T_WHITESPACE"," ",111],"!",["T_STRING","in_array",111],"(",["T_VARIABLE","$format_requirement",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$rest_resource_config",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getFormats",111],"(",["T_VARIABLE","$method",111],")",")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n          ",111],["T_CONTINUE","continue",112],";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_COMMENT","\/\/ The configuration seems legit at this point, so we set the\n",115],["T_WHITESPACE","        ",116],["T_COMMENT","\/\/ authentication provider and add the route.\n",116],["T_WHITESPACE","        ",117],["T_VARIABLE","$route",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setOption",117],"(",["T_CONSTANT_ENCAPSED_STRING","'_auth'",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$rest_resource_config",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getAuthenticationProviders",117],"(",["T_VARIABLE","$method",117],")",")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$route",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","setDefault",118],"(",["T_CONSTANT_ENCAPSED_STRING","'_rest_resource_config'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$rest_resource_config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","id",118],"(",")",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$collection",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","add",119],"(","\"",["T_ENCAPSED_AND_WHITESPACE","rest.",119],["T_VARIABLE","$name",119],"\"",",",["T_WHITESPACE"," ",119],["T_VARIABLE","$route",119],")",";",["T_WHITESPACE","\n      ",119],"}",["T_WHITESPACE","\n\n    ",120],"}",["T_WHITESPACE","\n    ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$collection",123],";",["T_WHITESPACE","\n  ",123],"}",["T_WHITESPACE","\n\n",124],"}",["T_WHITESPACE","\n",126]]