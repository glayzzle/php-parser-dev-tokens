[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","rest",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Functional",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Url",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","GuzzleHttp",6],["T_NS_SEPARATOR","\\",6],["T_STRING","RequestOptions",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Psr",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Http",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Message",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ResponseInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Trait for ResourceTestBase subclasses testing $auth=cookie.\n *\n * Characteristics:\n * - After performing a valid \"log in\" request, the server responds with a 2xx\n *   status code and a 'Set-Cookie' response header. This cookie is what\n *   continues to identify the user in subsequent requests.\n * - When accessing a URI that requires authentication without being\n *   authenticated, a standard 403 response must be sent.\n * - Because of the reliance on cookies, and the fact that user agents send\n *   cookies with every request, this is vulnerable to CSRF attacks. To mitigate\n *   this, the response for the \"log in\" request contains a CSRF token that must\n *   be sent with every unsafe (POST\/PATCH\/DELETE) HTTP request.\n *\/",9],["T_WHITESPACE","\n",22],["T_TRAIT","trait",23],["T_WHITESPACE"," ",23],["T_STRING","CookieResourceTestTrait",23],["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n\n  ",23],["T_DOC_COMMENT","\/**\n   * The session cookie.\n   *\n   * @see ::initAuthentication\n   *\n   * @var string\n   *\/",25],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$sessionCookie",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * The CSRF token.\n   *\n   * @see ::initAuthentication\n   *\n   * @var string\n   *\/",34],["T_WHITESPACE","\n  ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$csrfToken",41],";",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * The logout token.\n   *\n   * @see ::initAuthentication\n   *\n   * @var string\n   *\/",43],["T_WHITESPACE","\n  ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$logoutToken",50],";",["T_WHITESPACE","\n\n  ",50],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",52],["T_WHITESPACE","\n  ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","initAuthentication",55],"(",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n    ",55],["T_COMMENT","\/\/ @todo Remove hardcoded use of the 'json' format, and use static::$format\n",56],["T_WHITESPACE","    ",57],["T_COMMENT","\/\/ + static::$mimeType instead in https:\/\/www.drupal.org\/node\/2820888.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$user_login_url",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","Url",58],["T_DOUBLE_COLON","::",58],["T_STRING","fromRoute",58],"(",["T_CONSTANT_ENCAPSED_STRING","'user.login.http'",58],")",["T_WHITESPACE","\n      ",58],["T_OBJECT_OPERATOR","->",59],["T_STRING","setRouteParameter",59],"(",["T_CONSTANT_ENCAPSED_STRING","'_format'",59],",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'json'",59],")",";",["T_WHITESPACE","\n\n    ",59],["T_VARIABLE","$request_body",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],"[",["T_WHITESPACE","\n      ",61],["T_CONSTANT_ENCAPSED_STRING","'name'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","account",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","name",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","value",62],",",["T_WHITESPACE","\n      ",62],["T_CONSTANT_ENCAPSED_STRING","'pass'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","account",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","passRaw",63],",",["T_WHITESPACE","\n    ",63],"]",";",["T_WHITESPACE","\n\n    ",64],["T_VARIABLE","$request_options",66],"[",["T_STRING","RequestOptions",66],["T_DOUBLE_COLON","::",66],["T_STRING","BODY",66],"]",["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","serializer",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","encode",66],"(",["T_VARIABLE","$request_body",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'json'",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$request_options",67],"[",["T_STRING","RequestOptions",67],["T_DOUBLE_COLON","::",67],["T_STRING","HEADERS",67],"]","[",["T_CONSTANT_ENCAPSED_STRING","'Accept'",67],"]",["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'application\/json'",67],";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$response",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","request",68],"(",["T_CONSTANT_ENCAPSED_STRING","'POST'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$user_login_url",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$request_options",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_COMMENT","\/\/ Parse and store the session cookie.\n",70],["T_WHITESPACE","    ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","sessionCookie",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","explode",71],"(",["T_CONSTANT_ENCAPSED_STRING","';'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$response",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getHeader",71],"(",["T_CONSTANT_ENCAPSED_STRING","'Set-Cookie'",71],")","[",["T_LNUMBER","0",71],"]",",",["T_WHITESPACE"," ",71],["T_LNUMBER","2",71],")","[",["T_LNUMBER","0",71],"]",";",["T_WHITESPACE","\n\n    ",71],["T_COMMENT","\/\/ Parse and store the CSRF token and logout token.\n",73],["T_WHITESPACE","    ",74],["T_VARIABLE","$data",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","serializer",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","decode",74],"(",["T_STRING_CAST","(string)",74],["T_VARIABLE","$response",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getBody",74],"(",")",",",["T_WHITESPACE"," ",74],["T_STATIC","static",74],["T_DOUBLE_COLON","::",74],["T_VARIABLE","$format",74],")",";",["T_WHITESPACE","\n    ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","csrfToken",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$data",75],"[",["T_CONSTANT_ENCAPSED_STRING","'csrf_token'",75],"]",";",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","logoutToken",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$data",76],"[",["T_CONSTANT_ENCAPSED_STRING","'logout_token'",76],"]",";",["T_WHITESPACE","\n  ",76],"}",["T_WHITESPACE","\n\n  ",77],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",79],["T_WHITESPACE","\n  ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","getAuthenticationRequestOptions",82],"(",["T_VARIABLE","$method",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$request_options",83],"[",["T_STRING","RequestOptions",83],["T_DOUBLE_COLON","::",83],["T_STRING","HEADERS",83],"]","[",["T_CONSTANT_ENCAPSED_STRING","'Cookie'",83],"]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","sessionCookie",83],";",["T_WHITESPACE","\n    ",83],["T_COMMENT","\/\/ @see https:\/\/www.w3.org\/Protocols\/rfc2616\/rfc2616-sec9.html\n",84],["T_WHITESPACE","    ",85],["T_IF","if",85],["T_WHITESPACE"," ",85],"(","!",["T_STRING","in_array",85],"(",["T_VARIABLE","$method",85],",",["T_WHITESPACE"," ",85],"[",["T_CONSTANT_ENCAPSED_STRING","'HEAD'",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'GET'",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'OPTIONS'",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'TRACE'",85],"]",")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n      ",85],["T_VARIABLE","$request_options",86],"[",["T_STRING","RequestOptions",86],["T_DOUBLE_COLON","::",86],["T_STRING","HEADERS",86],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","csrfToken",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n    ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$request_options",88],";",["T_WHITESPACE","\n  ",88],"}",["T_WHITESPACE","\n\n  ",89],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",91],["T_WHITESPACE","\n  ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","assertResponseWhenMissingAuthentication",94],"(",["T_STRING","ResponseInterface",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$response",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","assertResourceErrorResponse",95],"(",["T_LNUMBER","403",95],",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","''",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$response",95],")",";",["T_WHITESPACE","\n  ",95],"}",["T_WHITESPACE","\n\n  ",96],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",98],["T_WHITESPACE","\n  ",100],["T_PROTECTED","protected",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","assertAuthenticationEdgeCases",101],"(",["T_VARIABLE","$method",101],",",["T_WHITESPACE"," ",101],["T_STRING","Url",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$url",101],",",["T_WHITESPACE"," ",101],["T_ARRAY","array",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$request_options",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n    ",101],["T_COMMENT","\/\/ X-CSRF-Token request header is unnecessary for safe and side effect-free\n",102],["T_WHITESPACE","    ",103],["T_COMMENT","\/\/ HTTP methods. No need for additional assertions.\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ @see https:\/\/www.w3.org\/Protocols\/rfc2616\/rfc2616-sec9.html\n",104],["T_WHITESPACE","    ",105],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_STRING","in_array",105],"(",["T_VARIABLE","$method",105],",",["T_WHITESPACE"," ",105],"[",["T_CONSTANT_ENCAPSED_STRING","'HEAD'",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'GET'",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'OPTIONS'",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'TRACE'",105],"]",")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n      ",105],["T_RETURN","return",106],";",["T_WHITESPACE","\n    ",106],"}",["T_WHITESPACE","\n\n\n    ",107],["T_UNSET","unset",110],"(",["T_VARIABLE","$request_options",110],"[",["T_STRING","RequestOptions",110],["T_DOUBLE_COLON","::",110],["T_STRING","HEADERS",110],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",110],"]",")",";",["T_WHITESPACE","\n\n\n    ",110],["T_COMMENT","\/\/ DX: 403 when missing X-CSRF-Token request header.\n",113],["T_WHITESPACE","    ",114],["T_VARIABLE","$response",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","request",114],"(",["T_VARIABLE","$method",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$url",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$request_options",114],")",";",["T_WHITESPACE","\n    ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","assertResourceErrorResponse",115],"(",["T_LNUMBER","403",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token request header is missing'",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$response",115],")",";",["T_WHITESPACE","\n\n\n    ",115],["T_VARIABLE","$request_options",118],"[",["T_STRING","RequestOptions",118],["T_DOUBLE_COLON","::",118],["T_STRING","HEADERS",118],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",118],"]",["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'this-is-not-the-token-you-are-looking-for'",118],";",["T_WHITESPACE","\n\n\n    ",118],["T_COMMENT","\/\/ DX: 403 when invalid X-CSRF-Token request header.\n",121],["T_WHITESPACE","    ",122],["T_VARIABLE","$response",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","request",122],"(",["T_VARIABLE","$method",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$url",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$request_options",122],")",";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","assertResourceErrorResponse",123],"(",["T_LNUMBER","403",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token request header is invalid'",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$response",123],")",";",["T_WHITESPACE","\n\n\n    ",123],["T_VARIABLE","$request_options",126],"[",["T_STRING","RequestOptions",126],["T_DOUBLE_COLON","::",126],["T_STRING","HEADERS",126],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","csrfToken",126],";",["T_WHITESPACE","\n  ",126],"}",["T_WHITESPACE","\n\n",127],"}",["T_WHITESPACE","\n",129]]