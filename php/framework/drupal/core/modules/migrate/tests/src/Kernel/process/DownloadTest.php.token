[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","migrate",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Kernel",3],["T_NS_SEPARATOR","\\",3],["T_STRING","process",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","StreamWrapper",5],["T_NS_SEPARATOR","\\",5],["T_STRING","StreamWrapperInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelTests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","File",6],["T_NS_SEPARATOR","\\",6],["T_STRING","FileTestBase",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","migrate",7],["T_NS_SEPARATOR","\\",7],["T_STRING","MigrateException",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","migrate",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Plugin",8],["T_NS_SEPARATOR","\\",8],["T_STRING","migrate",8],["T_NS_SEPARATOR","\\",8],["T_STRING","process",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Download",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","migrate",9],["T_NS_SEPARATOR","\\",9],["T_STRING","MigrateExecutableInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","migrate",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Row",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","GuzzleHttp",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Client",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","GuzzleHttp",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Psr7",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Response",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * Tests the download process plugin.\n *\n * @group migrate\n *\/",14],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","DownloadTest",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_STRING","FileTestBase",19],["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",21],["T_WHITESPACE","\n  ",23],["T_PUBLIC","public",24],["T_WHITESPACE"," ",24],["T_STATIC","static",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$modules",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],"[",["T_CONSTANT_ENCAPSED_STRING","'system'",24],"]",";",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",26],["T_WHITESPACE","\n  ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","setUp",29],"(",")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n    ",29],["T_STRING","parent",30],["T_DOUBLE_COLON","::",30],["T_STRING","setUp",30],"(",")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","container",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","get",31],"(",["T_CONSTANT_ENCAPSED_STRING","'stream_wrapper_manager'",31],")",["T_OBJECT_OPERATOR","->",31],["T_STRING","registerWrapper",31],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary'",31],",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'Drupal\\Core\\StreamWrapper\\TemporaryStream'",31],",",["T_WHITESPACE"," ",31],["T_STRING","StreamWrapperInterface",31],["T_DOUBLE_COLON","::",31],["T_STRING","LOCAL_NORMAL",31],")",";",["T_WHITESPACE","\n  ",31],"}",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * Tests a download that overwrites an existing local file.\n   *\/",34],["T_WHITESPACE","\n  ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","testOverwritingDownload",37],"(",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_COMMENT","\/\/ Create a pre-existing file at the destination, to test overwrite behavior.\n",38],["T_WHITESPACE","    ",39],["T_VARIABLE","$destination_uri",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","createUri",39],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_file.txt'",39],")",";",["T_WHITESPACE","\n\n    ",39],["T_COMMENT","\/\/ Test destructive download.\n",41],["T_WHITESPACE","    ",42],["T_VARIABLE","$actual_destination",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","doTransform",42],"(",["T_VARIABLE","$destination_uri",42],")",";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","assertSame",43],"(",["T_VARIABLE","$destination_uri",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$actual_destination",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'Import returned a destination that was not renamed'",43],")",";",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","assertFileNotExists",44],"(",["T_CONSTANT_ENCAPSED_STRING","'public:\/\/existing_file_0.txt'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'Import did not rename the file'",44],")",";",["T_WHITESPACE","\n  ",44],"}",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * Tests a download that renames the downloaded file if there's a collision.\n   *\/",47],["T_WHITESPACE","\n  ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","testNonDestructiveDownload",50],"(",")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n    ",50],["T_COMMENT","\/\/ Create a pre-existing file at the destination, to test overwrite behavior.\n",51],["T_WHITESPACE","    ",52],["T_VARIABLE","$destination_uri",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","createUri",52],"(",["T_CONSTANT_ENCAPSED_STRING","'another_existing_file.txt'",52],")",";",["T_WHITESPACE","\n\n    ",52],["T_COMMENT","\/\/ Test non-destructive download.\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$actual_destination",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","doTransform",55],"(",["T_VARIABLE","$destination_uri",55],",",["T_WHITESPACE"," ",55],"[",["T_CONSTANT_ENCAPSED_STRING","'rename'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_STRING","TRUE",55],"]",")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","assertSame",56],"(",["T_CONSTANT_ENCAPSED_STRING","'public:\/\/another_existing_file_0.txt'",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$actual_destination",56],",",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'Import returned a renamed destination'",56],")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","assertFileExists",57],"(",["T_VARIABLE","$actual_destination",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'Downloaded file was created'",57],")",";",["T_WHITESPACE","\n  ",57],"}",["T_WHITESPACE","\n\n  ",58],["T_DOC_COMMENT","\/**\n   * Tests that an exception is thrown if the destination URI is not writable.\n   *\/",60],["T_WHITESPACE","\n  ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","testWriteProtectedDestination",63],"(",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n    ",63],["T_COMMENT","\/\/ Create a pre-existing file at the destination, to test overwrite behavior.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$destination_uri",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","createUri",65],"(",["T_CONSTANT_ENCAPSED_STRING","'not-writable.txt'",65],")",";",["T_WHITESPACE","\n\n    ",65],["T_COMMENT","\/\/ Make the destination non-writable.\n",67],["T_WHITESPACE","    ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","container",68],["T_WHITESPACE","\n      ",68],["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_CONSTANT_ENCAPSED_STRING","'file_system'",69],")",["T_WHITESPACE","\n      ",69],["T_OBJECT_OPERATOR","->",70],["T_STRING","chmod",70],"(",["T_VARIABLE","$destination_uri",70],",",["T_WHITESPACE"," ",70],["T_LNUMBER","0444",70],")",";",["T_WHITESPACE","\n\n    ",70],["T_COMMENT","\/\/ Pass or fail, we'll need to make the file writable again so the test\n",72],["T_WHITESPACE","    ",73],["T_COMMENT","\/\/ can clean up after itself.\n",73],["T_WHITESPACE","    ",74],["T_VARIABLE","$fix_permissions",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],"(",")",["T_WHITESPACE"," ",74],["T_USE","use",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$destination_uri",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n      ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","container",75],["T_WHITESPACE","\n        ",75],["T_OBJECT_OPERATOR","->",76],["T_STRING","get",76],"(",["T_CONSTANT_ENCAPSED_STRING","'file_system'",76],")",["T_WHITESPACE","\n        ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","chmod",77],"(",["T_VARIABLE","$destination_uri",77],",",["T_WHITESPACE"," ",77],["T_LNUMBER","0755",77],")",";",["T_WHITESPACE","\n    ",77],"}",";",["T_WHITESPACE","\n\n    ",78],["T_TRY","try",80],["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n      ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","doTransform",81],"(",["T_VARIABLE","$destination_uri",81],")",";",["T_WHITESPACE","\n      ",81],["T_VARIABLE","$fix_permissions",82],"(",")",";",["T_WHITESPACE","\n      ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","fail",83],"(",["T_CONSTANT_ENCAPSED_STRING","'MigrateException was not thrown for non-writable destination URI.'",83],")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n    ",84],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_STRING","MigrateException",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n      ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertTrue",86],"(",["T_STRING","TRUE",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'MigrateException was thrown for non-writable destination URI.'",86],")",";",["T_WHITESPACE","\n      ",86],["T_VARIABLE","$fix_permissions",87],"(",")",";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n  ",88],"}",["T_WHITESPACE","\n\n  ",89],["T_DOC_COMMENT","\/**\n   * Runs an input value through the download plugin.\n   *\n   * @param string $destination_uri\n   *   The destination URI to download to.\n   * @param array $configuration\n   *   (optional) Configuration for the download plugin.\n   *\n   * @return string\n   *   The local URI of the downloaded file.\n   *\/",91],["T_WHITESPACE","\n  ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","doTransform",102],"(",["T_VARIABLE","$destination_uri",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$configuration",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],"[","]",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n    ",102],["T_COMMENT","\/\/ The HTTP client will return a file with contents 'It worked!'\n",103],["T_WHITESPACE","    ",104],["T_VARIABLE","$body",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","fopen",104],"(",["T_CONSTANT_ENCAPSED_STRING","'data:\/\/text\/plain;base64,SXQgd29ya2VkIQ=='",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'r'",104],")",";",["T_WHITESPACE","\n\n    ",104],["T_COMMENT","\/\/ Prepare a mock HTTP client.\n",106],["T_WHITESPACE","    ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","container",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","set",107],"(",["T_CONSTANT_ENCAPSED_STRING","'http_client'",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getMock",107],"(",["T_STRING","Client",107],["T_DOUBLE_COLON","::",107],["T_CLASS","class",107],")",")",";",["T_WHITESPACE","\n    ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","container",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","get",108],"(",["T_CONSTANT_ENCAPSED_STRING","'http_client'",108],")",["T_WHITESPACE","\n      ",108],["T_OBJECT_OPERATOR","->",109],["T_STRING","method",109],"(",["T_CONSTANT_ENCAPSED_STRING","'get'",109],")",["T_WHITESPACE","\n      ",109],["T_OBJECT_OPERATOR","->",110],["T_STRING","willReturn",110],"(",["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_STRING","Response",110],"(",["T_LNUMBER","200",110],",",["T_WHITESPACE"," ",110],"[","]",",",["T_WHITESPACE"," ",110],["T_VARIABLE","$body",110],")",")",";",["T_WHITESPACE","\n\n    ",110],["T_COMMENT","\/\/ Instantiate the plugin statically so it can pull dependencies out of\n",112],["T_WHITESPACE","    ",113],["T_COMMENT","\/\/ the container.\n",113],["T_WHITESPACE","    ",114],["T_VARIABLE","$plugin",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","Download",114],["T_DOUBLE_COLON","::",114],["T_STRING","create",114],"(",["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","container",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$configuration",114],",",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'download'",114],",",["T_WHITESPACE"," ",114],"[","]",")",";",["T_WHITESPACE","\n\n    ",114],["T_COMMENT","\/\/ Execute the transformation.\n",116],["T_WHITESPACE","    ",117],["T_VARIABLE","$executable",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getMock",117],"(",["T_STRING","MigrateExecutableInterface",117],["T_DOUBLE_COLON","::",117],["T_CLASS","class",117],")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$row",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_NEW","new",118],["T_WHITESPACE"," ",118],["T_STRING","Row",118],"(","[","]",",",["T_WHITESPACE"," ",118],"[","]",")",";",["T_WHITESPACE","\n\n    ",118],["T_COMMENT","\/\/ Return the downloaded file's local URI.\n",120],["T_WHITESPACE","    ",121],["T_VARIABLE","$value",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],"[",["T_WHITESPACE","\n      ",121],["T_CONSTANT_ENCAPSED_STRING","'http:\/\/drupal.org\/favicon.ico'",122],",",["T_WHITESPACE","\n      ",122],["T_VARIABLE","$destination_uri",123],",",["T_WHITESPACE","\n    ",123],"]",";",["T_WHITESPACE","\n    ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$plugin",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","transform",125],"(",["T_VARIABLE","$value",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$executable",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$row",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'foobaz'",125],")",";",["T_WHITESPACE","\n  ",125],"}",["T_WHITESPACE","\n\n",126],"}",["T_WHITESPACE","\n",128]]