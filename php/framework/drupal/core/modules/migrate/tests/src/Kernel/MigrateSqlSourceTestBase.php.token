[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","migrate",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Kernel",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Driver",5],["T_NS_SEPARATOR","\\",5],["T_STRING","sqlite",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Connection",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Base class for tests of Migrate source plugins that use a database.\n *\/",7],["T_WHITESPACE","\n",9],["T_ABSTRACT","abstract",10],["T_WHITESPACE"," ",10],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","MigrateSqlSourceTestBase",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","MigrateSourceTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Builds an in-memory SQLite database from a set of source data.\n   *\n   * @param array $source_data\n   *   The source data, keyed by table name. Each table is an array containing\n   *   the rows in that table.\n   *\n   * @return \\Drupal\\Core\\Database\\Driver\\sqlite\\Connection\n   *   The SQLite database connection.\n   *\/",12],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_FUNCTION","function",22],["T_WHITESPACE"," ",22],["T_STRING","getDatabase",22],"(",["T_ARRAY","array",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$source_data",22],")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n    ",22],["T_COMMENT","\/\/ Create an in-memory SQLite database. Plugins can interact with it like\n",23],["T_WHITESPACE","    ",24],["T_COMMENT","\/\/ any other database, and it will cease to exist when the connection is\n",24],["T_WHITESPACE","    ",25],["T_COMMENT","\/\/ closed.\n",25],["T_WHITESPACE","    ",26],["T_VARIABLE","$connection_options",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],"[",["T_CONSTANT_ENCAPSED_STRING","'database'",26],["T_WHITESPACE"," ",26],["T_DOUBLE_ARROW","=>",26],["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","':memory:'",26],"]",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$pdo",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_STRING","Connection",27],["T_DOUBLE_COLON","::",27],["T_STRING","open",27],"(",["T_VARIABLE","$connection_options",27],")",";",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$connection",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_NEW","new",28],["T_WHITESPACE"," ",28],["T_STRING","Connection",28],"(",["T_VARIABLE","$pdo",28],",",["T_WHITESPACE"," ",28],["T_VARIABLE","$connection_options",28],")",";",["T_WHITESPACE","\n\n    ",28],["T_COMMENT","\/\/ Create the tables and fill them with data.\n",30],["T_WHITESPACE","    ",31],["T_FOREACH","foreach",31],["T_WHITESPACE"," ",31],"(",["T_VARIABLE","$source_data",31],["T_WHITESPACE"," ",31],["T_AS","as",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$table",31],["T_WHITESPACE"," ",31],["T_DOUBLE_ARROW","=>",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$rows",31],")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n      ",31],["T_COMMENT","\/\/ Use the biggest row to build the table schema.\n",32],["T_WHITESPACE","      ",33],["T_VARIABLE","$counts",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_STRING","array_map",33],"(",["T_CONSTANT_ENCAPSED_STRING","'count'",33],",",["T_WHITESPACE"," ",33],["T_VARIABLE","$rows",33],")",";",["T_WHITESPACE","\n      ",33],["T_STRING","asort",34],"(",["T_VARIABLE","$counts",34],")",";",["T_WHITESPACE","\n      ",34],["T_STRING","end",35],"(",["T_VARIABLE","$counts",35],")",";",["T_WHITESPACE","\n      ",35],["T_VARIABLE","$pilot",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$rows",36],"[",["T_STRING","key",36],"(",["T_VARIABLE","$counts",36],")","]",";",["T_WHITESPACE","\n\n      ",36],["T_VARIABLE","$connection",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","schema",38],"(",")",["T_WHITESPACE","\n        ",38],["T_OBJECT_OPERATOR","->",39],["T_STRING","createTable",39],"(",["T_VARIABLE","$table",39],",",["T_WHITESPACE"," ",39],"[",["T_WHITESPACE","\n          ",39],["T_COMMENT","\/\/ SQLite uses loose affinity typing, so it's OK for every field to\n",40],["T_WHITESPACE","          ",41],["T_COMMENT","\/\/ be a text field.\n",41],["T_WHITESPACE","          ",42],["T_CONSTANT_ENCAPSED_STRING","'fields'",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_STRING","array_map",42],"(",["T_FUNCTION","function",42],"(",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE"," ",42],["T_RETURN","return",42],["T_WHITESPACE"," ",42],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'text'",42],"]",";",["T_WHITESPACE"," ",42],"}",",",["T_WHITESPACE"," ",42],["T_VARIABLE","$pilot",42],")",",",["T_WHITESPACE","\n        ",42],"]",")",";",["T_WHITESPACE","\n\n      ",43],["T_VARIABLE","$fields",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","array_keys",45],"(",["T_VARIABLE","$pilot",45],")",";",["T_WHITESPACE","\n      ",45],["T_VARIABLE","$insert",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$connection",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","insert",46],"(",["T_VARIABLE","$table",46],")",["T_OBJECT_OPERATOR","->",46],["T_STRING","fields",46],"(",["T_VARIABLE","$fields",46],")",";",["T_WHITESPACE","\n      ",46],["T_STRING","array_walk",47],"(",["T_VARIABLE","$rows",47],",",["T_WHITESPACE"," ",47],"[",["T_VARIABLE","$insert",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'values'",47],"]",")",";",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$insert",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","execute",48],"(",")",";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n\n    ",49],["T_RETURN","return",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$connection",51],";",["T_WHITESPACE","\n  ",51],"}",["T_WHITESPACE","\n\n  ",52],["T_DOC_COMMENT","\/**\n   * Tests the source plugin against a particular data set.\n   *\n   * @param array $source_data\n   *   The source data that the plugin will read. See getDatabase() for the\n   *   expected format.\n   * @param array $expected_data\n   *   The result rows the plugin is expected to return.\n   * @param int $expected_count\n   *   (optional) How many rows the source plugin is expected to return.\n   * @param array $configuration\n   *   (optional) Configuration for the source plugin.\n   *\n   * @dataProvider providerSource\n   *\n   * @requires extension pdo_sqlite\n   *\/",54],["T_WHITESPACE","\n  ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","testSource",71],"(",["T_ARRAY","array",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$source_data",71],",",["T_WHITESPACE"," ",71],["T_ARRAY","array",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$expected_data",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$expected_count",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","NULL",71],",",["T_WHITESPACE"," ",71],["T_ARRAY","array",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$configuration",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],"[","]",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$plugin",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getPlugin",72],"(",["T_VARIABLE","$configuration",72],")",";",["T_WHITESPACE","\n\n    ",72],["T_COMMENT","\/\/ Since we don't yet inject the database connection, we need to use a\n",74],["T_WHITESPACE","    ",75],["T_COMMENT","\/\/ reflection hack to set it in the plugin instance.\n",75],["T_WHITESPACE","    ",76],["T_VARIABLE","$reflector",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_NEW","new",76],["T_WHITESPACE"," ",76],["T_NS_SEPARATOR","\\",76],["T_STRING","ReflectionObject",76],"(",["T_VARIABLE","$plugin",76],")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$property",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$reflector",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getProperty",77],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",77],")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$property",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","setAccessible",78],"(",["T_STRING","TRUE",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$property",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","setValue",79],"(",["T_VARIABLE","$plugin",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getDatabase",79],"(",["T_VARIABLE","$source_data",79],")",")",";",["T_WHITESPACE","\n\n    ",79],["T_STRING","parent",81],["T_DOUBLE_COLON","::",81],["T_STRING","testSource",81],"(",["T_VARIABLE","$source_data",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$expected_data",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$expected_count",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$configuration",81],")",";",["T_WHITESPACE","\n  ",81],"}",["T_WHITESPACE","\n\n",82],"}",["T_WHITESPACE","\n",84]]