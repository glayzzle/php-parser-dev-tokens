[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","locale",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests for using cron to update project interface translations.\n *\n * @group locale\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","LocaleUpdateCronTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","LocaleUpdateBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_PROTECTED","protected",12],["T_WHITESPACE"," ",12],["T_VARIABLE","$batchOutput",12],["T_WHITESPACE"," ",12],"=",["T_WHITESPACE"," ",12],["T_ARRAY","array",12],"(",")",";",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",14],["T_WHITESPACE","\n  ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_FUNCTION","function",17],["T_WHITESPACE"," ",17],["T_STRING","setUp",17],"(",")",["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n    ",17],["T_STRING","parent",18],["T_DOUBLE_COLON","::",18],["T_STRING","setUp",18],"(",")",";",["T_WHITESPACE","\n    ",18],["T_VARIABLE","$admin_user",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_VARIABLE","$this",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","drupalCreateUser",19],"(",["T_ARRAY","array",19],"(",["T_CONSTANT_ENCAPSED_STRING","'administer modules'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'administer languages'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'access administration pages'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'translate interface'",19],")",")",";",["T_WHITESPACE","\n    ",19],["T_VARIABLE","$this",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","drupalLogin",20],"(",["T_VARIABLE","$admin_user",20],")",";",["T_WHITESPACE","\n    ",20],["T_VARIABLE","$this",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","addLanguage",21],"(",["T_CONSTANT_ENCAPSED_STRING","'de'",21],")",";",["T_WHITESPACE","\n  ",21],"}",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * Tests interface translation update using cron.\n   *\/",24],["T_WHITESPACE","\n  ",26],["T_PUBLIC","public",27],["T_WHITESPACE"," ",27],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],["T_STRING","testUpdateCron",27],"(",")",["T_WHITESPACE"," ",27],"{",["T_WHITESPACE","\n    ",27],["T_COMMENT","\/\/ Set a flag to let the locale_test module replace the project data with a\n",28],["T_WHITESPACE","    ",29],["T_COMMENT","\/\/ set of test projects.\n",29],["T_WHITESPACE","    ",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Drupal",30],["T_DOUBLE_COLON","::",30],["T_STRING","state",30],"(",")",["T_OBJECT_OPERATOR","->",30],["T_STRING","set",30],"(",["T_CONSTANT_ENCAPSED_STRING","'locale.test_projects_alter'",30],",",["T_WHITESPACE"," ",30],["T_STRING","TRUE",30],")",";",["T_WHITESPACE","\n\n    ",30],["T_COMMENT","\/\/ Setup local and remote translations files.\n",32],["T_WHITESPACE","    ",33],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","setTranslationFiles",33],"(",")",";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","config",34],"(",["T_CONSTANT_ENCAPSED_STRING","'locale.settings'",34],")",["T_OBJECT_OPERATOR","->",34],["T_STRING","set",34],"(",["T_CONSTANT_ENCAPSED_STRING","'translation.default_filename'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'%project-%version.%language._po'",34],")",["T_OBJECT_OPERATOR","->",34],["T_STRING","save",34],"(",")",";",["T_WHITESPACE","\n\n    ",34],["T_COMMENT","\/\/ Update translations using batch to ensure a clean test starting point.\n",36],["T_WHITESPACE","    ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","drupalGet",37],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/translations\/check'",37],")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","drupalPostForm",38],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/translations'",38],",",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",")",",",["T_WHITESPACE"," ",38],["T_STRING","t",38],"(",["T_CONSTANT_ENCAPSED_STRING","'Update translations'",38],")",")",";",["T_WHITESPACE","\n\n    ",38],["T_COMMENT","\/\/ Store translation status for comparison.\n",40],["T_WHITESPACE","    ",41],["T_VARIABLE","$initial_history",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","locale_translation_get_file_history",41],"(",")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Prepare for test: Simulate new translations being available.\n",43],["T_WHITESPACE","    ",44],["T_COMMENT","\/\/ Change the last updated timestamp of a translation file.\n",44],["T_WHITESPACE","    ",45],["T_VARIABLE","$contrib_module_two_uri",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/local\/contrib_module_two-8.x-2.0-beta4.de._po'",45],";",["T_WHITESPACE","\n    ",45],["T_STRING","touch",46],"(",["T_STRING","drupal_realpath",46],"(",["T_VARIABLE","$contrib_module_two_uri",46],")",",",["T_WHITESPACE"," ",46],["T_STRING","REQUEST_TIME",46],")",";",["T_WHITESPACE","\n\n    ",46],["T_COMMENT","\/\/ Prepare for test: Simulate that the file has not been checked for a long\n",48],["T_WHITESPACE","    ",49],["T_COMMENT","\/\/ time. Set the last_check timestamp to zero.\n",49],["T_WHITESPACE","    ",50],["T_VARIABLE","$query",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","db_update",50],"(",["T_CONSTANT_ENCAPSED_STRING","'locale_file'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$query",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","fields",51],"(",["T_ARRAY","array",51],"(",["T_CONSTANT_ENCAPSED_STRING","'last_checked'",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_LNUMBER","0",51],")",")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$query",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","condition",52],"(",["T_CONSTANT_ENCAPSED_STRING","'project'",52],",",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'contrib_module_two'",52],")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$query",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","condition",53],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'de'",53],")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$query",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","execute",54],"(",")",";",["T_WHITESPACE","\n\n    ",54],["T_COMMENT","\/\/ Test: Disable cron update and verify that no tasks are added to the\n",56],["T_WHITESPACE","    ",57],["T_COMMENT","\/\/ queue.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$edit",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_ARRAY","array",58],"(",["T_WHITESPACE","\n      ",58],["T_CONSTANT_ENCAPSED_STRING","'update_interval_days'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_LNUMBER","0",59],",",["T_WHITESPACE","\n    ",59],")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","drupalPostForm",61],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/regional\/translate\/settings'",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$edit",61],",",["T_WHITESPACE"," ",61],["T_STRING","t",61],"(",["T_CONSTANT_ENCAPSED_STRING","'Save configuration'",61],")",")",";",["T_WHITESPACE","\n\n    ",61],["T_COMMENT","\/\/ Execute locale cron tasks to add tasks to the queue.\n",63],["T_WHITESPACE","    ",64],["T_STRING","locale_cron",64],"(",")",";",["T_WHITESPACE","\n\n    ",64],["T_COMMENT","\/\/ Check whether no tasks are added to the queue.\n",66],["T_WHITESPACE","    ",67],["T_VARIABLE","$queue",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Drupal",67],["T_DOUBLE_COLON","::",67],["T_STRING","queue",67],"(",["T_CONSTANT_ENCAPSED_STRING","'locale_translation'",67],",",["T_WHITESPACE"," ",67],["T_STRING","TRUE",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertEqual",68],"(",["T_VARIABLE","$queue",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","numberOfItems",68],"(",")",",",["T_WHITESPACE"," ",68],["T_LNUMBER","0",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Queue is empty'",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_COMMENT","\/\/ Test: Enable cron update and check if update tasks are added to the\n",70],["T_WHITESPACE","    ",71],["T_COMMENT","\/\/ queue.\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ Set cron update to Weekly.\n",72],["T_WHITESPACE","    ",73],["T_VARIABLE","$edit",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'update_interval_days'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_LNUMBER","7",74],",",["T_WHITESPACE","\n    ",74],")",";",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","drupalPostForm",76],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/regional\/translate\/settings'",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$edit",76],",",["T_WHITESPACE"," ",76],["T_STRING","t",76],"(",["T_CONSTANT_ENCAPSED_STRING","'Save configuration'",76],")",")",";",["T_WHITESPACE","\n\n    ",76],["T_COMMENT","\/\/ Execute locale cron tasks to add tasks to the queue.\n",78],["T_WHITESPACE","    ",79],["T_STRING","locale_cron",79],"(",")",";",["T_WHITESPACE","\n\n    ",79],["T_COMMENT","\/\/ Check whether tasks are added to the queue.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$queue",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_NS_SEPARATOR","\\",82],["T_STRING","Drupal",82],["T_DOUBLE_COLON","::",82],["T_STRING","queue",82],"(",["T_CONSTANT_ENCAPSED_STRING","'locale_translation'",82],",",["T_WHITESPACE"," ",82],["T_STRING","TRUE",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertEqual",83],"(",["T_VARIABLE","$queue",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","numberOfItems",83],"(",")",",",["T_WHITESPACE"," ",83],["T_LNUMBER","3",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'Queue holds tasks for one project.'",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$item",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$queue",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","claimItem",84],"(",")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$queue",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","releaseItem",85],"(",["T_VARIABLE","$item",85],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertEqual",86],"(",["T_VARIABLE","$item",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","data",86],"[",["T_LNUMBER","1",86],"]","[",["T_LNUMBER","0",86],"]",",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'contrib_module_two'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'Queue holds tasks for contrib module one.'",86],")",";",["T_WHITESPACE","\n\n    ",86],["T_COMMENT","\/\/ Test: Run cron for a second time and check if tasks are not added to\n",88],["T_WHITESPACE","    ",89],["T_COMMENT","\/\/ the queue twice.\n",89],["T_WHITESPACE","    ",90],["T_STRING","locale_cron",90],"(",")",";",["T_WHITESPACE","\n\n    ",90],["T_COMMENT","\/\/ Check whether no more tasks are added to the queue.\n",92],["T_WHITESPACE","    ",93],["T_VARIABLE","$queue",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_NS_SEPARATOR","\\",93],["T_STRING","Drupal",93],["T_DOUBLE_COLON","::",93],["T_STRING","queue",93],"(",["T_CONSTANT_ENCAPSED_STRING","'locale_translation'",93],",",["T_WHITESPACE"," ",93],["T_STRING","TRUE",93],")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertEqual",94],"(",["T_VARIABLE","$queue",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","numberOfItems",94],"(",")",",",["T_WHITESPACE"," ",94],["T_LNUMBER","3",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'Queue holds tasks for one project.'",94],")",";",["T_WHITESPACE","\n\n    ",94],["T_COMMENT","\/\/ Ensure last checked is updated to a greater time than the initial value.\n",96],["T_WHITESPACE","    ",97],["T_STRING","sleep",97],"(",["T_LNUMBER","1",97],")",";",["T_WHITESPACE","\n    ",97],["T_COMMENT","\/\/ Test: Execute cron and check if tasks are executed correctly.\n",98],["T_WHITESPACE","    ",99],["T_COMMENT","\/\/ Run cron to process the tasks in the queue.\n",99],["T_WHITESPACE","    ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","cronRun",100],"(",")",";",["T_WHITESPACE","\n\n    ",100],["T_STRING","drupal_static_reset",102],"(",["T_CONSTANT_ENCAPSED_STRING","'locale_translation_get_file_history'",102],")",";",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$history",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_STRING","locale_translation_get_file_history",103],"(",")",";",["T_WHITESPACE","\n    ",103],["T_VARIABLE","$initial",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$initial_history",104],"[",["T_CONSTANT_ENCAPSED_STRING","'contrib_module_two'",104],"]","[",["T_CONSTANT_ENCAPSED_STRING","'de'",104],"]",";",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$current",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$history",105],"[",["T_CONSTANT_ENCAPSED_STRING","'contrib_module_two'",105],"]","[",["T_CONSTANT_ENCAPSED_STRING","'de'",105],"]",";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","assertTrue",106],"(",["T_VARIABLE","$current",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","timestamp",106],["T_WHITESPACE"," ",106],">",["T_WHITESPACE"," ",106],["T_VARIABLE","$initial",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","timestamp",106],",",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","'Timestamp is updated'",106],")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertTrue",107],"(",["T_VARIABLE","$current",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","last_checked",107],["T_WHITESPACE"," ",107],">",["T_WHITESPACE"," ",107],["T_VARIABLE","$initial",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","last_checked",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'Last checked is updated'",107],")",";",["T_WHITESPACE","\n  ",107],"}",["T_WHITESPACE","\n\n",108],"}",["T_WHITESPACE","\n",110]]