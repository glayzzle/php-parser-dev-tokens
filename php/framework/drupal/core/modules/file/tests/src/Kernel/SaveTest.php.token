[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","file",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Kernel",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","file",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","File",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * File saving tests.\n *\n * @group file\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","SaveTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","FileManagedUnitTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n  ",12],["T_FUNCTION","function",13],["T_WHITESPACE"," ",13],["T_STRING","testFileSave",13],"(",")",["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n    ",13],["T_COMMENT","\/\/ Create a new file entity.\n",14],["T_WHITESPACE","    ",15],["T_VARIABLE","$file",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],["T_STRING","File",15],["T_DOUBLE_COLON","::",15],["T_STRING","create",15],"(",["T_ARRAY","array",15],"(",["T_WHITESPACE","\n      ",15],["T_CONSTANT_ENCAPSED_STRING","'uid'",16],["T_WHITESPACE"," ",16],["T_DOUBLE_ARROW","=>",16],["T_WHITESPACE"," ",16],["T_LNUMBER","1",16],",",["T_WHITESPACE","\n      ",16],["T_CONSTANT_ENCAPSED_STRING","'filename'",17],["T_WHITESPACE"," ",17],["T_DOUBLE_ARROW","=>",17],["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","'druplicon.txt'",17],",",["T_WHITESPACE","\n      ",17],["T_CONSTANT_ENCAPSED_STRING","'uri'",18],["T_WHITESPACE"," ",18],["T_DOUBLE_ARROW","=>",18],["T_WHITESPACE"," ",18],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/druplicon.txt'",18],",",["T_WHITESPACE","\n      ",18],["T_CONSTANT_ENCAPSED_STRING","'filemime'",19],["T_WHITESPACE"," ",19],["T_DOUBLE_ARROW","=>",19],["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'text\/plain'",19],",",["T_WHITESPACE","\n      ",19],["T_CONSTANT_ENCAPSED_STRING","'status'",20],["T_WHITESPACE"," ",20],["T_DOUBLE_ARROW","=>",20],["T_WHITESPACE"," ",20],["T_STRING","FILE_STATUS_PERMANENT",20],",",["T_WHITESPACE","\n    ",20],")",")",";",["T_WHITESPACE","\n    ",21],["T_STRING","file_put_contents",22],"(",["T_VARIABLE","$file",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","getFileUri",22],"(",")",",",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'hello world'",22],")",";",["T_WHITESPACE","\n\n    ",22],["T_COMMENT","\/\/ Save it, inserting a new record.\n",24],["T_WHITESPACE","    ",25],["T_VARIABLE","$file",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","save",25],"(",")",";",["T_WHITESPACE","\n\n    ",25],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",27],["T_WHITESPACE","    ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","assertFileHooksCalled",28],"(",["T_ARRAY","array",28],"(",["T_CONSTANT_ENCAPSED_STRING","'insert'",28],")",")",";",["T_WHITESPACE","\n\n    ",28],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","assertTrue",30],"(",["T_VARIABLE","$file",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","id",30],"(",")",["T_WHITESPACE"," ",30],">",["T_WHITESPACE"," ",30],["T_LNUMBER","0",30],",",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'A new file ID is set when saving a new file to the database.'",30],",",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'File'",30],")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$loaded_file",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_STRING","File",31],["T_DOUBLE_COLON","::",31],["T_STRING","load",31],"(",["T_VARIABLE","$file",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","id",31],"(",")",")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","assertNotNull",32],"(",["T_VARIABLE","$loaded_file",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'Record exists in the database.'",32],")",";",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","assertEqual",33],"(",["T_VARIABLE","$loaded_file",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","isPermanent",33],"(",")",",",["T_WHITESPACE"," ",33],["T_VARIABLE","$file",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","isPermanent",33],"(",")",",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'Status was saved correctly.'",33],")",";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","assertEqual",34],"(",["T_VARIABLE","$file",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","getSize",34],"(",")",",",["T_WHITESPACE"," ",34],["T_STRING","filesize",34],"(",["T_VARIABLE","$file",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","getFileUri",34],"(",")",")",",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'File size was set correctly.'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'File'",34],")",";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","assertTrue",35],"(",["T_VARIABLE","$file",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getChangedTime",35],"(",")",["T_WHITESPACE"," ",35],">",["T_WHITESPACE"," ",35],["T_LNUMBER","1",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'File size was set correctly.'",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'File'",35],")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","assertEqual",36],"(",["T_VARIABLE","$loaded_file",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","langcode",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","value",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'en'",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'Langcode was defaulted correctly.'",36],")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Resave the file, updating the existing record.\n",38],["T_WHITESPACE","    ",39],["T_STRING","file_test_reset",39],"(",")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$file",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","status",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","value",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_LNUMBER","7",40],";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$file",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","save",41],"(",")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","assertFileHooksCalled",44],"(",["T_ARRAY","array",44],"(",["T_CONSTANT_ENCAPSED_STRING","'load'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'update'",44],")",")",";",["T_WHITESPACE","\n\n    ",44],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","assertEqual",46],"(",["T_VARIABLE","$file",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","id",46],"(",")",",",["T_WHITESPACE"," ",46],["T_VARIABLE","$file",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","id",46],"(",")",",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'The file ID of an existing file is not changed when updating the database.'",46],",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'File'",46],")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","assertTrue",47],"(",["T_VARIABLE","$file",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getChangedTime",47],"(",")",["T_WHITESPACE"," ",47],["T_IS_GREATER_OR_EQUAL",">=",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$file",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getChangedTime",47],"(",")",",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","\"Timestamp didn't go backwards.\"",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'File'",47],")",";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$loaded_file",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","File",48],["T_DOUBLE_COLON","::",48],["T_STRING","load",48],"(",["T_VARIABLE","$file",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","id",48],"(",")",")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","assertNotNull",49],"(",["T_VARIABLE","$loaded_file",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'Record still exists in the database.'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'File'",49],")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","assertEqual",50],"(",["T_VARIABLE","$loaded_file",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","isPermanent",50],"(",")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$file",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","isPermanent",50],"(",")",",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'Status was saved correctly.'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","assertEqual",51],"(",["T_VARIABLE","$loaded_file",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","langcode",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","value",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'en'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'Langcode was saved correctly.'",51],")",";",["T_WHITESPACE","\n\n    ",51],["T_COMMENT","\/\/ Try to insert a second file with the same name apart from case insensitivity\n",53],["T_WHITESPACE","    ",54],["T_COMMENT","\/\/ to ensure the 'uri' index allows for filenames with different cases.\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$uppercase_values",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_ARRAY","array",55],"(",["T_WHITESPACE","\n      ",55],["T_CONSTANT_ENCAPSED_STRING","'uid'",56],["T_WHITESPACE"," ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_LNUMBER","1",56],",",["T_WHITESPACE","\n      ",56],["T_CONSTANT_ENCAPSED_STRING","'filename'",57],["T_WHITESPACE"," ",57],["T_DOUBLE_ARROW","=>",57],["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'DRUPLICON.txt'",57],",",["T_WHITESPACE","\n      ",57],["T_CONSTANT_ENCAPSED_STRING","'uri'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/DRUPLICON.txt'",58],",",["T_WHITESPACE","\n      ",58],["T_CONSTANT_ENCAPSED_STRING","'filemime'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'text\/plain'",59],",",["T_WHITESPACE","\n      ",59],["T_CONSTANT_ENCAPSED_STRING","'status'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_STRING","FILE_STATUS_PERMANENT",60],",",["T_WHITESPACE","\n    ",60],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$uppercase_file",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","File",62],["T_DOUBLE_COLON","::",62],["T_STRING","create",62],"(",["T_VARIABLE","$uppercase_values",62],")",";",["T_WHITESPACE","\n    ",62],["T_STRING","file_put_contents",63],"(",["T_VARIABLE","$uppercase_file",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getFileUri",63],"(",")",",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'hello world'",63],")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$violations",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$uppercase_file",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","validate",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertEqual",65],"(",["T_STRING","count",65],"(",["T_VARIABLE","$violations",65],")",",",["T_WHITESPACE"," ",65],["T_LNUMBER","0",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'No violations when adding an URI with an existing filename in upper case.'",65],")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$uppercase_file",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","save",66],"(",")",";",["T_WHITESPACE","\n\n    ",66],["T_COMMENT","\/\/ Ensure the database URI uniqueness constraint is triggered.\n",68],["T_WHITESPACE","    ",69],["T_VARIABLE","$uppercase_file_duplicate",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","File",69],["T_DOUBLE_COLON","::",69],["T_STRING","create",69],"(",["T_VARIABLE","$uppercase_values",69],")",";",["T_WHITESPACE","\n    ",69],["T_STRING","file_put_contents",70],"(",["T_VARIABLE","$uppercase_file_duplicate",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getFileUri",70],"(",")",",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'hello world'",70],")",";",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$violations",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$uppercase_file_duplicate",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","validate",71],"(",")",";",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertEqual",72],"(",["T_STRING","count",72],"(",["T_VARIABLE","$violations",72],")",",",["T_WHITESPACE"," ",72],["T_LNUMBER","1",72],")",";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertEqual",73],"(",["T_VARIABLE","$violations",73],"[",["T_LNUMBER","0",73],"]",["T_OBJECT_OPERATOR","->",73],["T_STRING","getMessage",73],"(",")",",",["T_WHITESPACE"," ",73],["T_STRING","t",73],"(",["T_CONSTANT_ENCAPSED_STRING","'The file %value already exists. Enter a unique file URI.'",73],",",["T_WHITESPACE"," ",73],"[",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'%value'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$uppercase_file_duplicate",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getFileUri",74],"(",")",",",["T_WHITESPACE","\n    ",74],"]",")",")",";",["T_WHITESPACE","\n    ",75],["T_COMMENT","\/\/ Ensure that file URI entity queries are case sensitive.\n",76],["T_WHITESPACE","    ",77],["T_VARIABLE","$fids",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_NS_SEPARATOR","\\",77],["T_STRING","Drupal",77],["T_DOUBLE_COLON","::",77],["T_STRING","entityQuery",77],"(",["T_CONSTANT_ENCAPSED_STRING","'file'",77],")",["T_WHITESPACE","\n      ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","condition",78],"(",["T_CONSTANT_ENCAPSED_STRING","'uri'",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$uppercase_file",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getFileUri",78],"(",")",")",["T_WHITESPACE","\n      ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","execute",79],"(",")",";",["T_WHITESPACE","\n\n    ",79],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","assertEqual",81],"(",["T_LNUMBER","1",81],",",["T_WHITESPACE"," ",81],["T_STRING","count",81],"(",["T_VARIABLE","$fids",81],")",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertEqual",82],"(",["T_ARRAY","array",82],"(",["T_VARIABLE","$uppercase_file",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","id",82],"(",")",["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$uppercase_file",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","id",82],"(",")",")",",",["T_WHITESPACE"," ",82],["T_VARIABLE","$fids",82],")",";",["T_WHITESPACE","\n\n  ",82],"}",["T_WHITESPACE","\n\n",84],"}",["T_WHITESPACE","\n",86]]