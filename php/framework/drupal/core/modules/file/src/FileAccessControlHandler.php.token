[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","file",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Access",5],["T_NS_SEPARATOR","\\",5],["T_STRING","AccessResult",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EntityAccessControlHandler",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","EntityInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Entity",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EntityStorageInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Field",9],["T_NS_SEPARATOR","\\",9],["T_STRING","FieldDefinitionInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Field",10],["T_NS_SEPARATOR","\\",10],["T_STRING","FieldItemListInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Session",11],["T_NS_SEPARATOR","\\",11],["T_STRING","AccountInterface",11],";",["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Provides a File access control handler.\n *\/",13],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","FileAccessControlHandler",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","EntityAccessControlHandler",16],["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n\n  ",16],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",18],["T_WHITESPACE","\n  ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_FUNCTION","function",21],["T_WHITESPACE"," ",21],["T_STRING","checkAccess",21],"(",["T_STRING","EntityInterface",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$entity",21],",",["T_WHITESPACE"," ",21],["T_VARIABLE","$operation",21],",",["T_WHITESPACE"," ",21],["T_STRING","AccountInterface",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$account",21],")",["T_WHITESPACE"," ",21],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/** @var \\Drupal\\file\\FileInterface $entity *\/",22],["T_WHITESPACE","\n    ",22],["T_IF","if",23],["T_WHITESPACE"," ",23],"(",["T_VARIABLE","$operation",23],["T_WHITESPACE"," ",23],["T_IS_EQUAL","==",23],["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'download'",23],["T_WHITESPACE"," ",23],["T_BOOLEAN_OR","||",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$operation",23],["T_WHITESPACE"," ",23],["T_IS_EQUAL","==",23],["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'view'",23],")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n      ",23],["T_IF","if",24],["T_WHITESPACE"," ",24],"(",["T_NS_SEPARATOR","\\",24],["T_STRING","Drupal",24],["T_DOUBLE_COLON","::",24],["T_STRING","service",24],"(",["T_CONSTANT_ENCAPSED_STRING","'file_system'",24],")",["T_OBJECT_OPERATOR","->",24],["T_STRING","uriScheme",24],"(",["T_VARIABLE","$entity",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","getFileUri",24],"(",")",")",["T_WHITESPACE"," ",24],["T_IS_IDENTICAL","===",24],["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'public'",24],")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n        ",24],["T_COMMENT","\/\/ Always allow access to file in public file system.\n",25],["T_WHITESPACE","        ",26],["T_RETURN","return",26],["T_WHITESPACE"," ",26],["T_STRING","AccessResult",26],["T_DOUBLE_COLON","::",26],["T_STRING","allowed",26],"(",")",";",["T_WHITESPACE","\n      ",26],"}",["T_WHITESPACE","\n      ",27],["T_ELSEIF","elseif",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$references",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","getFileReferences",28],"(",["T_VARIABLE","$entity",28],")",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n        ",28],["T_FOREACH","foreach",29],["T_WHITESPACE"," ",29],"(",["T_VARIABLE","$references",29],["T_WHITESPACE"," ",29],["T_AS","as",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$field_name",29],["T_WHITESPACE"," ",29],["T_DOUBLE_ARROW","=>",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$entity_map",29],")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n          ",29],["T_FOREACH","foreach",30],["T_WHITESPACE"," ",30],"(",["T_VARIABLE","$entity_map",30],["T_WHITESPACE"," ",30],["T_AS","as",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$referencing_entity_type",30],["T_WHITESPACE"," ",30],["T_DOUBLE_ARROW","=>",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$referencing_entities",30],")",["T_WHITESPACE"," ",30],"{",["T_WHITESPACE","\n            ",30],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Entity\\EntityInterface $referencing_entity *\/",31],["T_WHITESPACE","\n            ",31],["T_FOREACH","foreach",32],["T_WHITESPACE"," ",32],"(",["T_VARIABLE","$referencing_entities",32],["T_WHITESPACE"," ",32],["T_AS","as",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$referencing_entity",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n              ",32],["T_VARIABLE","$entity_and_field_access",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$referencing_entity",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","access",33],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",33],",",["T_WHITESPACE"," ",33],["T_VARIABLE","$account",33],",",["T_WHITESPACE"," ",33],["T_STRING","TRUE",33],")",["T_OBJECT_OPERATOR","->",33],["T_STRING","andIf",33],"(",["T_VARIABLE","$referencing_entity",33],["T_OBJECT_OPERATOR","->",33],["T_VARIABLE","$field_name",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","access",33],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",33],",",["T_WHITESPACE"," ",33],["T_VARIABLE","$account",33],",",["T_WHITESPACE"," ",33],["T_STRING","TRUE",33],")",")",";",["T_WHITESPACE","\n              ",33],["T_IF","if",34],["T_WHITESPACE"," ",34],"(",["T_VARIABLE","$entity_and_field_access",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","isAllowed",34],"(",")",")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n                ",34],["T_RETURN","return",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$entity_and_field_access",35],";",["T_WHITESPACE","\n              ",35],"}",["T_WHITESPACE","\n            ",36],"}",["T_WHITESPACE","\n          ",37],"}",["T_WHITESPACE","\n        ",38],"}",["T_WHITESPACE","\n      ",39],"}",["T_WHITESPACE","\n      ",40],["T_ELSEIF","elseif",41],["T_WHITESPACE"," ",41],"(",["T_VARIABLE","$entity",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getOwnerId",41],"(",")",["T_WHITESPACE"," ",41],["T_IS_EQUAL","==",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$account",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","id",41],"(",")",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_COMMENT","\/\/ This case handles new nodes, or detached files. The user who uploaded\n",42],["T_WHITESPACE","        ",43],["T_COMMENT","\/\/ the file can always access if it's not yet used.\n",43],["T_WHITESPACE","        ",44],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_STRING","AccessResult",44],["T_DOUBLE_COLON","::",44],["T_STRING","allowed",44],"(",")",";",["T_WHITESPACE","\n      ",44],"}",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_IF","if",48],["T_WHITESPACE"," ",48],"(",["T_VARIABLE","$operation",48],["T_WHITESPACE"," ",48],["T_IS_EQUAL","==",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'delete'",48],["T_WHITESPACE"," ",48],["T_BOOLEAN_OR","||",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$operation",48],["T_WHITESPACE"," ",48],["T_IS_EQUAL","==",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'update'",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n      ",48],["T_VARIABLE","$account",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","prepareUser",49],"(",["T_VARIABLE","$account",49],")",";",["T_WHITESPACE","\n      ",49],["T_VARIABLE","$file_uid",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$entity",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","get",50],"(",["T_CONSTANT_ENCAPSED_STRING","'uid'",50],")",["T_OBJECT_OPERATOR","->",50],["T_STRING","getValue",50],"(",")",";",["T_WHITESPACE","\n      ",50],["T_COMMENT","\/\/ Only the file owner can delete and update the file entity.\n",51],["T_WHITESPACE","      ",52],["T_IF","if",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$account",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","id",52],"(",")",["T_WHITESPACE"," ",52],["T_IS_EQUAL","==",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$file_uid",52],"[",["T_LNUMBER","0",52],"]","[",["T_CONSTANT_ENCAPSED_STRING","'target_id'",52],"]",")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n        ",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_STRING","AccessResult",53],["T_DOUBLE_COLON","::",53],["T_STRING","allowed",53],"(",")",";",["T_WHITESPACE","\n      ",53],"}",["T_WHITESPACE","\n      ",54],["T_RETURN","return",55],["T_WHITESPACE"," ",55],["T_STRING","AccessResult",55],["T_DOUBLE_COLON","::",55],["T_STRING","forbidden",55],"(",")",";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_COMMENT","\/\/ No opinion.\n",58],["T_WHITESPACE","    ",59],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_STRING","AccessResult",59],["T_DOUBLE_COLON","::",59],["T_STRING","neutral",59],"(",")",";",["T_WHITESPACE","\n  ",59],"}",["T_WHITESPACE","\n\n  ",60],["T_DOC_COMMENT","\/**\n   * Wrapper for file_get_file_references().\n   *\n   * @param \\Drupal\\file\\FileInterface $file\n   *   The file object for which to get references.\n   *\n   * @return array\n   *   A multidimensional array. The keys are field_name, entity_type,\n   *   entity_id and the value is an entity referencing this file.\n   *\n   * @see file_get_file_references()\n   *\/",62],["T_WHITESPACE","\n  ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","getFileReferences",74],"(",["T_STRING","FileInterface",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$file",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n    ",74],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_STRING","file_get_file_references",75],"(",["T_VARIABLE","$file",75],",",["T_WHITESPACE"," ",75],["T_STRING","NULL",75],",",["T_WHITESPACE"," ",75],["T_STRING","EntityStorageInterface",75],["T_DOUBLE_COLON","::",75],["T_STRING","FIELD_LOAD_REVISION",75],",",["T_WHITESPACE"," ",75],["T_STRING","NULL",75],")",";",["T_WHITESPACE","\n  ",75],"}",["T_WHITESPACE","\n\n  ",76],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",78],["T_WHITESPACE","\n  ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","checkFieldAccess",81],"(",["T_VARIABLE","$operation",81],",",["T_WHITESPACE"," ",81],["T_STRING","FieldDefinitionInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$field_definition",81],",",["T_WHITESPACE"," ",81],["T_STRING","AccountInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$account",81],",",["T_WHITESPACE"," ",81],["T_STRING","FieldItemListInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$items",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","NULL",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n    ",81],["T_COMMENT","\/\/ No user can edit the status of a file. Prevents saving a new file as\n",82],["T_WHITESPACE","    ",83],["T_COMMENT","\/\/ persistent before even validating it.\n",83],["T_WHITESPACE","    ",84],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_VARIABLE","$field_definition",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getName",84],"(",")",["T_WHITESPACE"," ",84],["T_IS_IDENTICAL","===",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'status'",84],["T_WHITESPACE"," ",84],["T_BOOLEAN_AND","&&",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$operation",84],["T_WHITESPACE"," ",84],["T_IS_IDENTICAL","===",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'edit'",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n      ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_STRING","AccessResult",85],["T_DOUBLE_COLON","::",85],["T_STRING","forbidden",85],"(",")",";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n    ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_STRING","parent",87],["T_DOUBLE_COLON","::",87],["T_STRING","checkFieldAccess",87],"(",["T_VARIABLE","$operation",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$field_definition",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$account",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$items",87],")",";",["T_WHITESPACE","\n  ",87],"}",["T_WHITESPACE","\n\n  ",88],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",90],["T_WHITESPACE","\n  ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","checkCreateAccess",93],"(",["T_STRING","AccountInterface",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$account",93],",",["T_WHITESPACE"," ",93],["T_ARRAY","array",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$context",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$entity_bundle",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","NULL",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n    ",93],["T_COMMENT","\/\/ The file entity has no \"create\" permission because by default Drupal core\n",94],["T_WHITESPACE","    ",95],["T_COMMENT","\/\/ does not allow creating file entities independently. It allows you to\n",95],["T_WHITESPACE","    ",96],["T_COMMENT","\/\/ create file entities that are referenced from another entity\n",96],["T_WHITESPACE","    ",97],["T_COMMENT","\/\/ (e.g. an image for a article). A contributed module is free to alter\n",97],["T_WHITESPACE","    ",98],["T_COMMENT","\/\/ this to allow file entities to be created directly.\n",98],["T_WHITESPACE","    ",99],["T_COMMENT","\/\/ @todo Update comment to mention REST module when\n",99],["T_WHITESPACE","    ",100],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/1927648 is fixed.\n",100],["T_WHITESPACE","    ",101],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_STRING","AccessResult",101],["T_DOUBLE_COLON","::",101],["T_STRING","neutral",101],"(",")",";",["T_WHITESPACE","\n  ",101],"}",["T_WHITESPACE","\n\n",102],"}",["T_WHITESPACE","\n",104]]