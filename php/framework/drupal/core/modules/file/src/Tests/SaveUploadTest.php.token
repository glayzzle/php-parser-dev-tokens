[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","file",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","file",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","File",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests the file_save_upload() function.\n *\n * @group file\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","SaveUploadTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","FileManagedTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n  ",12],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",13],["T_WHITESPACE","\n  ",17],["T_PUBLIC","public",18],["T_WHITESPACE"," ",18],["T_STATIC","static",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$modules",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],"(",["T_CONSTANT_ENCAPSED_STRING","'dblog'",18],")",";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * An image file path for uploading.\n   *\n   * @var \\Drupal\\file\\FileInterface\n   *\/",20],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$image",25],";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * A PHP file path for upload security testing.\n   *\/",27],["T_WHITESPACE","\n  ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$phpfile",30],";",["T_WHITESPACE","\n\n  ",30],["T_DOC_COMMENT","\/**\n   * The largest file id when the test starts.\n   *\/",32],["T_WHITESPACE","\n  ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$maxFidBefore",35],";",["T_WHITESPACE","\n\n  ",35],["T_DOC_COMMENT","\/**\n   * Extension of the image filename.\n   *\n   * @var string\n   *\/",37],["T_WHITESPACE","\n  ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$imageExtension",42],";",["T_WHITESPACE","\n\n  ",42],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","setUp",44],"(",")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n    ",44],["T_STRING","parent",45],["T_DOUBLE_COLON","::",45],["T_STRING","setUp",45],"(",")",";",["T_WHITESPACE","\n    ",45],["T_VARIABLE","$account",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","drupalCreateUser",46],"(",["T_ARRAY","array",46],"(",["T_CONSTANT_ENCAPSED_STRING","'access site reports'",46],")",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","drupalLogin",47],"(",["T_VARIABLE","$account",47],")",";",["T_WHITESPACE","\n\n    ",47],["T_VARIABLE","$image_files",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","drupalGetTestFiles",49],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",49],")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","image",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","File",50],["T_DOUBLE_COLON","::",50],["T_STRING","create",50],"(",["T_ARRAY_CAST","(array)",50],["T_WHITESPACE"," ",50],["T_STRING","current",50],"(",["T_VARIABLE","$image_files",50],")",")",";",["T_WHITESPACE","\n\n    ",50],["T_LIST","list",52],"(",",",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","imageExtension",52],")",["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","explode",52],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",52],",",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","image",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getFilename",52],"(",")",")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","assertTrue",53],"(",["T_STRING","is_file",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","image",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getFileUri",53],"(",")",")",",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","\"The image file we're going to upload exists.\"",53],")",";",["T_WHITESPACE","\n\n    ",53],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","phpfile",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","current",55],"(",["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","drupalGetTestFiles",55],"(",["T_CONSTANT_ENCAPSED_STRING","'php'",55],")",")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","assertTrue",56],"(",["T_STRING","is_file",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","phpfile",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","uri",56],")",",",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'The PHP file we are going to upload exists.'",56],")",";",["T_WHITESPACE","\n\n    ",56],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","maxFidBefore",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","db_query",58],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT MAX(fid) AS fid FROM {file_managed}'",58],")",["T_OBJECT_OPERATOR","->",58],["T_STRING","fetchField",58],"(",")",";",["T_WHITESPACE","\n\n    ",58],["T_COMMENT","\/\/ Upload with replace to guarantee there's something there.\n",60],["T_WHITESPACE","    ",61],["T_VARIABLE","$edit",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",["T_WHITESPACE","\n      ",61],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_STRING","FILE_EXISTS_REPLACE",62],",",["T_WHITESPACE","\n      ",62],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_STRING","drupal_realpath",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","image",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getFileUri",63],"(",")",")",",",["T_WHITESPACE","\n    ",63],")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","drupalPostForm",65],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$edit",65],",",["T_WHITESPACE"," ",65],["T_STRING","t",65],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",65],")",")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertResponse",66],"(",["T_LNUMBER","200",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertRaw",67],"(",["T_STRING","t",67],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",67],")",",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",67],")",";",["T_WHITESPACE","\n\n    ",67],["T_COMMENT","\/\/ Check that the correct hooks were called then clean out the hook\n",69],["T_WHITESPACE","    ",70],["T_COMMENT","\/\/ counters.\n",70],["T_WHITESPACE","    ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertFileHooksCalled",71],"(",["T_ARRAY","array",71],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'insert'",71],")",")",";",["T_WHITESPACE","\n    ",71],["T_STRING","file_test_reset",72],"(",")",";",["T_WHITESPACE","\n  ",72],"}",["T_WHITESPACE","\n\n  ",73],["T_DOC_COMMENT","\/**\n   * Test the file_save_upload() function.\n   *\/",75],["T_WHITESPACE","\n  ",77],["T_FUNCTION","function",78],["T_WHITESPACE"," ",78],["T_STRING","testNormal",78],"(",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$max_fid_after",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","db_query",79],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT MAX(fid) AS fid FROM {file_managed}'",79],")",["T_OBJECT_OPERATOR","->",79],["T_STRING","fetchField",79],"(",")",";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","assertTrue",80],"(",["T_VARIABLE","$max_fid_after",80],["T_WHITESPACE"," ",80],">",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","maxFidBefore",80],",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'A new file was created.'",80],")",";",["T_WHITESPACE","\n    ",80],["T_VARIABLE","$file1",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","File",81],["T_DOUBLE_COLON","::",81],["T_STRING","load",81],"(",["T_VARIABLE","$max_fid_after",81],")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertTrue",82],"(",["T_VARIABLE","$file1",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'Loaded the file.'",82],")",";",["T_WHITESPACE","\n    ",82],["T_COMMENT","\/\/ MIME type of the uploaded image may be either image\/jpeg or image\/png.\n",83],["T_WHITESPACE","    ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","assertEqual",84],"(",["T_STRING","substr",84],"(",["T_VARIABLE","$file1",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getMimeType",84],"(",")",",",["T_WHITESPACE"," ",84],["T_LNUMBER","0",84],",",["T_WHITESPACE"," ",84],["T_LNUMBER","5",84],")",",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'image'",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'A MIME type was set.'",84],")",";",["T_WHITESPACE","\n\n    ",84],["T_COMMENT","\/\/ Reset the hook counters to get rid of the 'load' we just called.\n",86],["T_WHITESPACE","    ",87],["T_STRING","file_test_reset",87],"(",")",";",["T_WHITESPACE","\n\n    ",87],["T_COMMENT","\/\/ Upload a second file.\n",89],["T_WHITESPACE","    ",90],["T_VARIABLE","$image2",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","current",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","drupalGetTestFiles",90],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",90],")",")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$edit",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_STRING","drupal_realpath",91],"(",["T_VARIABLE","$image2",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","uri",91],")",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","drupalPostForm",92],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$edit",92],",",["T_WHITESPACE"," ",92],["T_STRING","t",92],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",92],")",")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertResponse",93],"(",["T_LNUMBER","200",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",93],")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertRaw",94],"(",["T_STRING","t",94],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",94],")",")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$max_fid_after",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","db_query",95],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT MAX(fid) AS fid FROM {file_managed}'",95],")",["T_OBJECT_OPERATOR","->",95],["T_STRING","fetchField",95],"(",")",";",["T_WHITESPACE","\n\n    ",95],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",97],["T_WHITESPACE","    ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","assertFileHooksCalled",98],"(",["T_ARRAY","array",98],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'insert'",98],")",")",";",["T_WHITESPACE","\n\n    ",98],["T_VARIABLE","$file2",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","File",100],["T_DOUBLE_COLON","::",100],["T_STRING","load",100],"(",["T_VARIABLE","$max_fid_after",100],")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","assertTrue",101],"(",["T_VARIABLE","$file2",101],",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'Loaded the file'",101],")",";",["T_WHITESPACE","\n    ",101],["T_COMMENT","\/\/ MIME type of the uploaded image may be either image\/jpeg or image\/png.\n",102],["T_WHITESPACE","    ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","assertEqual",103],"(",["T_STRING","substr",103],"(",["T_VARIABLE","$file2",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getMimeType",103],"(",")",",",["T_WHITESPACE"," ",103],["T_LNUMBER","0",103],",",["T_WHITESPACE"," ",103],["T_LNUMBER","5",103],")",",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'image'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'A MIME type was set.'",103],")",";",["T_WHITESPACE","\n\n    ",103],["T_COMMENT","\/\/ Load both files using File::loadMultiple().\n",105],["T_WHITESPACE","    ",106],["T_VARIABLE","$files",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","File",106],["T_DOUBLE_COLON","::",106],["T_STRING","loadMultiple",106],"(",["T_ARRAY","array",106],"(",["T_VARIABLE","$file1",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","id",106],"(",")",",",["T_WHITESPACE"," ",106],["T_VARIABLE","$file2",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","id",106],"(",")",")",")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertTrue",107],"(",["T_ISSET","isset",107],"(",["T_VARIABLE","$files",107],"[",["T_VARIABLE","$file1",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","id",107],"(",")","]",")",",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'File was loaded successfully'",107],")",";",["T_WHITESPACE","\n    ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","assertTrue",108],"(",["T_ISSET","isset",108],"(",["T_VARIABLE","$files",108],"[",["T_VARIABLE","$file2",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","id",108],"(",")","]",")",",",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'File was loaded successfully'",108],")",";",["T_WHITESPACE","\n\n    ",108],["T_COMMENT","\/\/ Upload a third file to a subdirectory.\n",110],["T_WHITESPACE","    ",111],["T_VARIABLE","$image3",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","current",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","drupalGetTestFiles",111],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",111],")",")",";",["T_WHITESPACE","\n    ",111],["T_VARIABLE","$image3_realpath",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","drupal_realpath",112],"(",["T_VARIABLE","$image3",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","uri",112],")",";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$dir",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","randomMachineName",113],"(",")",";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$edit",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_ARRAY","array",114],"(",["T_WHITESPACE","\n      ",114],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$image3_realpath",115],",",["T_WHITESPACE","\n      ",115],["T_CONSTANT_ENCAPSED_STRING","'file_subdir'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$dir",116],",",["T_WHITESPACE","\n    ",116],")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","drupalPostForm",118],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$edit",118],",",["T_WHITESPACE"," ",118],["T_STRING","t",118],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",118],")",")",";",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","assertResponse",119],"(",["T_LNUMBER","200",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",119],")",";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","assertRaw",120],"(",["T_STRING","t",120],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",120],")",")",";",["T_WHITESPACE","\n    ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","assertTrue",121],"(",["T_STRING","is_file",121],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary:\/\/'",121],["T_WHITESPACE"," ",121],".",["T_WHITESPACE"," ",121],["T_VARIABLE","$dir",121],["T_WHITESPACE"," ",121],".",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'\/'",121],["T_WHITESPACE"," ",121],".",["T_WHITESPACE"," ",121],["T_STRING","trim",121],"(",["T_STRING","drupal_basename",121],"(",["T_VARIABLE","$image3_realpath",121],")",")",")",")",";",["T_WHITESPACE","\n  ",121],"}",["T_WHITESPACE","\n\n  ",122],["T_DOC_COMMENT","\/**\n   * Test extension handling.\n   *\/",124],["T_WHITESPACE","\n  ",126],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","testHandleExtension",127],"(",")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n    ",127],["T_COMMENT","\/\/ The file being tested is a .gif which is in the default safe list\n",128],["T_WHITESPACE","    ",129],["T_COMMENT","\/\/ of extensions to allow when the extension validator isn't used. This is\n",129],["T_WHITESPACE","    ",130],["T_COMMENT","\/\/ implicitly tested at the testNormal() test. Here we tell\n",130],["T_WHITESPACE","    ",131],["T_COMMENT","\/\/ file_save_upload() to only allow \".foo\".\n",131],["T_WHITESPACE","    ",132],["T_VARIABLE","$extensions",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'foo'",132],";",["T_WHITESPACE","\n    ",132],["T_VARIABLE","$edit",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",["T_WHITESPACE","\n      ",133],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_STRING","FILE_EXISTS_REPLACE",134],",",["T_WHITESPACE","\n      ",134],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_STRING","drupal_realpath",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","image",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getFileUri",135],"(",")",")",",",["T_WHITESPACE","\n      ",135],["T_CONSTANT_ENCAPSED_STRING","'extensions'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$extensions",136],",",["T_WHITESPACE","\n    ",136],")",";",["T_WHITESPACE","\n\n    ",137],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","drupalPostForm",139],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$edit",139],",",["T_WHITESPACE"," ",139],["T_STRING","t",139],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",139],")",")",";",["T_WHITESPACE","\n    ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","assertResponse",140],"(",["T_LNUMBER","200",140],",",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",140],")",";",["T_WHITESPACE","\n    ",140],["T_VARIABLE","$message",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","t",141],"(",["T_CONSTANT_ENCAPSED_STRING","'Only files with the following extensions are allowed:'",141],")",["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","' <em class=\"placeholder\">'",141],["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_VARIABLE","$extensions",141],["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'<\/em>'",141],";",["T_WHITESPACE","\n    ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","assertRaw",142],"(",["T_VARIABLE","$message",142],",",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'Cannot upload a disallowed extension'",142],")",";",["T_WHITESPACE","\n    ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","assertRaw",143],"(",["T_STRING","t",143],"(",["T_CONSTANT_ENCAPSED_STRING","'Epic upload FAIL!'",143],")",",",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'Found the failure message.'",143],")",";",["T_WHITESPACE","\n\n    ",143],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",145],["T_WHITESPACE","    ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","assertFileHooksCalled",146],"(",["T_ARRAY","array",146],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",146],")",")",";",["T_WHITESPACE","\n\n    ",146],["T_COMMENT","\/\/ Reset the hook counters.\n",148],["T_WHITESPACE","    ",149],["T_STRING","file_test_reset",149],"(",")",";",["T_WHITESPACE","\n\n    ",149],["T_VARIABLE","$extensions",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'foo '",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","imageExtension",151],";",["T_WHITESPACE","\n    ",151],["T_COMMENT","\/\/ Now tell file_save_upload() to allow the extension of our test image.\n",152],["T_WHITESPACE","    ",153],["T_VARIABLE","$edit",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",["T_WHITESPACE","\n      ",153],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_STRING","FILE_EXISTS_REPLACE",154],",",["T_WHITESPACE","\n      ",154],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_STRING","drupal_realpath",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","image",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getFileUri",155],"(",")",")",",",["T_WHITESPACE","\n      ",155],["T_CONSTANT_ENCAPSED_STRING","'extensions'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$extensions",156],",",["T_WHITESPACE","\n    ",156],")",";",["T_WHITESPACE","\n\n    ",157],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","drupalPostForm",159],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$edit",159],",",["T_WHITESPACE"," ",159],["T_STRING","t",159],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",159],")",")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertResponse",160],"(",["T_LNUMBER","200",160],",",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",160],")",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertNoRaw",161],"(",["T_STRING","t",161],"(",["T_CONSTANT_ENCAPSED_STRING","'Only files with the following extensions are allowed:'",161],")",",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Can upload an allowed extension.'",161],")",";",["T_WHITESPACE","\n    ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","assertRaw",162],"(",["T_STRING","t",162],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",162],")",",",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",162],")",";",["T_WHITESPACE","\n\n    ",162],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",164],["T_WHITESPACE","    ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","assertFileHooksCalled",165],"(",["T_ARRAY","array",165],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'load'",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'update'",165],")",")",";",["T_WHITESPACE","\n\n    ",165],["T_COMMENT","\/\/ Reset the hook counters.\n",167],["T_WHITESPACE","    ",168],["T_STRING","file_test_reset",168],"(",")",";",["T_WHITESPACE","\n\n    ",168],["T_COMMENT","\/\/ Now tell file_save_upload() to allow any extension.\n",170],["T_WHITESPACE","    ",171],["T_VARIABLE","$edit",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_ARRAY","array",171],"(",["T_WHITESPACE","\n      ",171],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_STRING","FILE_EXISTS_REPLACE",172],",",["T_WHITESPACE","\n      ",172],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_STRING","drupal_realpath",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","image",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getFileUri",173],"(",")",")",",",["T_WHITESPACE","\n      ",173],["T_CONSTANT_ENCAPSED_STRING","'allow_all_extensions'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_STRING","TRUE",174],",",["T_WHITESPACE","\n    ",174],")",";",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","drupalPostForm",176],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$edit",176],",",["T_WHITESPACE"," ",176],["T_STRING","t",176],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",176],")",")",";",["T_WHITESPACE","\n    ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","assertResponse",177],"(",["T_LNUMBER","200",177],",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",177],")",";",["T_WHITESPACE","\n    ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","assertNoRaw",178],"(",["T_STRING","t",178],"(",["T_CONSTANT_ENCAPSED_STRING","'Only files with the following extensions are allowed:'",178],")",",",["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'Can upload any extension.'",178],")",";",["T_WHITESPACE","\n    ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","assertRaw",179],"(",["T_STRING","t",179],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",179],")",",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",179],")",";",["T_WHITESPACE","\n\n    ",179],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",181],["T_WHITESPACE","    ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","assertFileHooksCalled",182],"(",["T_ARRAY","array",182],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'load'",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'update'",182],")",")",";",["T_WHITESPACE","\n  ",182],"}",["T_WHITESPACE","\n\n  ",183],["T_DOC_COMMENT","\/**\n   * Test dangerous file handling.\n   *\/",185],["T_WHITESPACE","\n  ",187],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","testHandleDangerousFile",188],"(",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n    ",188],["T_VARIABLE","$config",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","config",189],"(",["T_CONSTANT_ENCAPSED_STRING","'system.file'",189],")",";",["T_WHITESPACE","\n    ",189],["T_COMMENT","\/\/ Allow the .php extension and make sure it gets renamed to .txt for\n",190],["T_WHITESPACE","    ",191],["T_COMMENT","\/\/ safety. Also check to make sure its MIME type was changed.\n",191],["T_WHITESPACE","    ",192],["T_VARIABLE","$edit",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_ARRAY","array",192],"(",["T_WHITESPACE","\n      ",192],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_STRING","FILE_EXISTS_REPLACE",193],",",["T_WHITESPACE","\n      ",193],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_STRING","drupal_realpath",194],"(",["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","phpfile",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","uri",194],")",",",["T_WHITESPACE","\n      ",194],["T_CONSTANT_ENCAPSED_STRING","'is_image_file'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_STRING","FALSE",195],",",["T_WHITESPACE","\n      ",195],["T_CONSTANT_ENCAPSED_STRING","'extensions'",196],["T_WHITESPACE"," ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","'php'",196],",",["T_WHITESPACE","\n    ",196],")",";",["T_WHITESPACE","\n\n    ",197],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","drupalPostForm",199],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$edit",199],",",["T_WHITESPACE"," ",199],["T_STRING","t",199],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",199],")",")",";",["T_WHITESPACE","\n    ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","assertResponse",200],"(",["T_LNUMBER","200",200],",",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",200],")",";",["T_WHITESPACE","\n    ",200],["T_VARIABLE","$message",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","t",201],"(",["T_CONSTANT_ENCAPSED_STRING","'For security reasons, your upload has been renamed to'",201],")",["T_WHITESPACE"," ",201],".",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","' <em class=\"placeholder\">'",201],["T_WHITESPACE"," ",201],".",["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","phpfile",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","filename",201],["T_WHITESPACE"," ",201],".",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","'.txt'",201],["T_WHITESPACE"," ",201],".",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","'<\/em>'",201],";",["T_WHITESPACE","\n    ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","assertRaw",202],"(",["T_VARIABLE","$message",202],",",["T_WHITESPACE"," ",202],["T_CONSTANT_ENCAPSED_STRING","'Dangerous file was renamed.'",202],")",";",["T_WHITESPACE","\n    ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","assertRaw",203],"(",["T_STRING","t",203],"(",["T_CONSTANT_ENCAPSED_STRING","'File MIME type is text\/plain.'",203],")",",",["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","\"Dangerous file's MIME type was changed.\"",203],")",";",["T_WHITESPACE","\n    ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","assertRaw",204],"(",["T_STRING","t",204],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",204],")",",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",204],")",";",["T_WHITESPACE","\n\n    ",204],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",206],["T_WHITESPACE","    ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","assertFileHooksCalled",207],"(",["T_ARRAY","array",207],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'insert'",207],")",")",";",["T_WHITESPACE","\n\n    ",207],["T_COMMENT","\/\/ Ensure dangerous files are not renamed when insecure uploads is TRUE.\n",209],["T_WHITESPACE","    ",210],["T_COMMENT","\/\/ Turn on insecure uploads.\n",210],["T_WHITESPACE","    ",211],["T_VARIABLE","$config",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","set",211],"(",["T_CONSTANT_ENCAPSED_STRING","'allow_insecure_uploads'",211],",",["T_WHITESPACE"," ",211],["T_LNUMBER","1",211],")",["T_OBJECT_OPERATOR","->",211],["T_STRING","save",211],"(",")",";",["T_WHITESPACE","\n    ",211],["T_COMMENT","\/\/ Reset the hook counters.\n",212],["T_WHITESPACE","    ",213],["T_STRING","file_test_reset",213],"(",")",";",["T_WHITESPACE","\n\n    ",213],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","drupalPostForm",215],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$edit",215],",",["T_WHITESPACE"," ",215],["T_STRING","t",215],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",215],")",")",";",["T_WHITESPACE","\n    ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","assertResponse",216],"(",["T_LNUMBER","200",216],",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",216],")",";",["T_WHITESPACE","\n    ",216],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","assertNoRaw",217],"(",["T_STRING","t",217],"(",["T_CONSTANT_ENCAPSED_STRING","'For security reasons, your upload has been renamed'",217],")",",",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","'Found no security message.'",217],")",";",["T_WHITESPACE","\n    ",217],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","assertRaw",218],"(",["T_STRING","t",218],"(",["T_CONSTANT_ENCAPSED_STRING","'File name is @filename'",218],",",["T_WHITESPACE"," ",218],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","'@filename'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","phpfile",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","filename",218],")",")",",",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'Dangerous file was not renamed when insecure uploads is TRUE.'",218],")",";",["T_WHITESPACE","\n    ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","assertRaw",219],"(",["T_STRING","t",219],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",219],")",",",["T_WHITESPACE"," ",219],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",219],")",";",["T_WHITESPACE","\n\n    ",219],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",221],["T_WHITESPACE","    ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","assertFileHooksCalled",222],"(",["T_ARRAY","array",222],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",222],",",["T_WHITESPACE"," ",222],["T_CONSTANT_ENCAPSED_STRING","'insert'",222],")",")",";",["T_WHITESPACE","\n\n    ",222],["T_COMMENT","\/\/ Turn off insecure uploads.\n",224],["T_WHITESPACE","    ",225],["T_VARIABLE","$config",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","set",225],"(",["T_CONSTANT_ENCAPSED_STRING","'allow_insecure_uploads'",225],",",["T_WHITESPACE"," ",225],["T_LNUMBER","0",225],")",["T_OBJECT_OPERATOR","->",225],["T_STRING","save",225],"(",")",";",["T_WHITESPACE","\n  ",225],"}",["T_WHITESPACE","\n\n  ",226],["T_DOC_COMMENT","\/**\n   * Test file munge handling.\n   *\/",228],["T_WHITESPACE","\n  ",230],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","testHandleFileMunge",231],"(",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n    ",231],["T_COMMENT","\/\/ Ensure insecure uploads are disabled for this test.\n",232],["T_WHITESPACE","    ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","config",233],"(",["T_CONSTANT_ENCAPSED_STRING","'system.file'",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","set",233],"(",["T_CONSTANT_ENCAPSED_STRING","'allow_insecure_uploads'",233],",",["T_WHITESPACE"," ",233],["T_LNUMBER","0",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","save",233],"(",")",";",["T_WHITESPACE","\n    ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","image",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","file_move",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","image",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","image",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getFileUri",234],"(",")",["T_WHITESPACE"," ",234],".",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'.foo.'",234],["T_WHITESPACE"," ",234],".",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","imageExtension",234],")",";",["T_WHITESPACE","\n\n    ",234],["T_COMMENT","\/\/ Reset the hook counters to get rid of the 'move' we just called.\n",236],["T_WHITESPACE","    ",237],["T_STRING","file_test_reset",237],"(",")",";",["T_WHITESPACE","\n\n    ",237],["T_VARIABLE","$extensions",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","imageExtension",239],";",["T_WHITESPACE","\n    ",239],["T_VARIABLE","$edit",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_ARRAY","array",240],"(",["T_WHITESPACE","\n      ",240],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_STRING","drupal_realpath",241],"(",["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","image",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getFileUri",241],"(",")",")",",",["T_WHITESPACE","\n      ",241],["T_CONSTANT_ENCAPSED_STRING","'extensions'",242],["T_WHITESPACE"," ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$extensions",242],",",["T_WHITESPACE","\n    ",242],")",";",["T_WHITESPACE","\n\n    ",243],["T_VARIABLE","$munged_filename",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","image",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getFilename",245],"(",")",";",["T_WHITESPACE","\n    ",245],["T_VARIABLE","$munged_filename",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_STRING","substr",246],"(",["T_VARIABLE","$munged_filename",246],",",["T_WHITESPACE"," ",246],["T_LNUMBER","0",246],",",["T_WHITESPACE"," ",246],["T_STRING","strrpos",246],"(",["T_VARIABLE","$munged_filename",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'.'",246],")",")",";",["T_WHITESPACE","\n    ",246],["T_VARIABLE","$munged_filename",247],["T_WHITESPACE"," ",247],["T_CONCAT_EQUAL",".=",247],["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'_.'",247],["T_WHITESPACE"," ",247],".",["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","imageExtension",247],";",["T_WHITESPACE","\n\n    ",247],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","drupalPostForm",249],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$edit",249],",",["T_WHITESPACE"," ",249],["T_STRING","t",249],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",249],")",")",";",["T_WHITESPACE","\n    ",249],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","assertResponse",250],"(",["T_LNUMBER","200",250],",",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",250],")",";",["T_WHITESPACE","\n    ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","assertRaw",251],"(",["T_STRING","t",251],"(",["T_CONSTANT_ENCAPSED_STRING","'For security reasons, your upload has been renamed'",251],")",",",["T_WHITESPACE"," ",251],["T_CONSTANT_ENCAPSED_STRING","'Found security message.'",251],")",";",["T_WHITESPACE","\n    ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","assertRaw",252],"(",["T_STRING","t",252],"(",["T_CONSTANT_ENCAPSED_STRING","'File name is @filename'",252],",",["T_WHITESPACE"," ",252],["T_ARRAY","array",252],"(",["T_CONSTANT_ENCAPSED_STRING","'@filename'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$munged_filename",252],")",")",",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'File was successfully munged.'",252],")",";",["T_WHITESPACE","\n    ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","assertRaw",253],"(",["T_STRING","t",253],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",253],")",",",["T_WHITESPACE"," ",253],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",253],")",";",["T_WHITESPACE","\n\n    ",253],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",255],["T_WHITESPACE","    ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","assertFileHooksCalled",256],"(",["T_ARRAY","array",256],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",256],",",["T_WHITESPACE"," ",256],["T_CONSTANT_ENCAPSED_STRING","'insert'",256],")",")",";",["T_WHITESPACE","\n\n    ",256],["T_COMMENT","\/\/ Ensure we don't munge files if we're allowing any extension.\n",258],["T_WHITESPACE","    ",259],["T_COMMENT","\/\/ Reset the hook counters.\n",259],["T_WHITESPACE","    ",260],["T_STRING","file_test_reset",260],"(",")",";",["T_WHITESPACE","\n\n    ",260],["T_VARIABLE","$edit",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_ARRAY","array",262],"(",["T_WHITESPACE","\n      ",262],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",263],["T_WHITESPACE"," ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],["T_STRING","drupal_realpath",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","image",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getFileUri",263],"(",")",")",",",["T_WHITESPACE","\n      ",263],["T_CONSTANT_ENCAPSED_STRING","'allow_all_extensions'",264],["T_WHITESPACE"," ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_STRING","TRUE",264],",",["T_WHITESPACE","\n    ",264],")",";",["T_WHITESPACE","\n\n    ",265],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","drupalPostForm",267],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$edit",267],",",["T_WHITESPACE"," ",267],["T_STRING","t",267],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",267],")",")",";",["T_WHITESPACE","\n    ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","assertResponse",268],"(",["T_LNUMBER","200",268],",",["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",268],")",";",["T_WHITESPACE","\n    ",268],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","assertNoRaw",269],"(",["T_STRING","t",269],"(",["T_CONSTANT_ENCAPSED_STRING","'For security reasons, your upload has been renamed'",269],")",",",["T_WHITESPACE"," ",269],["T_CONSTANT_ENCAPSED_STRING","'Found no security message.'",269],")",";",["T_WHITESPACE","\n    ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","assertRaw",270],"(",["T_STRING","t",270],"(",["T_CONSTANT_ENCAPSED_STRING","'File name is @filename'",270],",",["T_WHITESPACE"," ",270],["T_ARRAY","array",270],"(",["T_CONSTANT_ENCAPSED_STRING","'@filename'",270],["T_WHITESPACE"," ",270],["T_DOUBLE_ARROW","=>",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","image",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getFilename",270],"(",")",")",")",",",["T_WHITESPACE"," ",270],["T_CONSTANT_ENCAPSED_STRING","'File was not munged when allowing any extension.'",270],")",";",["T_WHITESPACE","\n    ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","assertRaw",271],"(",["T_STRING","t",271],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",271],")",",",["T_WHITESPACE"," ",271],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",271],")",";",["T_WHITESPACE","\n\n    ",271],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",273],["T_WHITESPACE","    ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","assertFileHooksCalled",274],"(",["T_ARRAY","array",274],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'insert'",274],")",")",";",["T_WHITESPACE","\n  ",274],"}",["T_WHITESPACE","\n\n  ",275],["T_DOC_COMMENT","\/**\n   * Test renaming when uploading over a file that already exists.\n   *\/",277],["T_WHITESPACE","\n  ",279],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","testExistingRename",280],"(",")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n    ",280],["T_VARIABLE","$edit",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_ARRAY","array",281],"(",["T_WHITESPACE","\n      ",281],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_STRING","FILE_EXISTS_RENAME",282],",",["T_WHITESPACE","\n      ",282],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_STRING","drupal_realpath",283],"(",["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","image",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getFileUri",283],"(",")",")",["T_WHITESPACE","\n    ",283],")",";",["T_WHITESPACE","\n    ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","drupalPostForm",285],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",285],",",["T_WHITESPACE"," ",285],["T_VARIABLE","$edit",285],",",["T_WHITESPACE"," ",285],["T_STRING","t",285],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",285],")",")",";",["T_WHITESPACE","\n    ",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","assertResponse",286],"(",["T_LNUMBER","200",286],",",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",286],")",";",["T_WHITESPACE","\n    ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","assertRaw",287],"(",["T_STRING","t",287],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",287],")",",",["T_WHITESPACE"," ",287],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",287],")",";",["T_WHITESPACE","\n\n    ",287],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",289],["T_WHITESPACE","    ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","assertFileHooksCalled",290],"(",["T_ARRAY","array",290],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",290],",",["T_WHITESPACE"," ",290],["T_CONSTANT_ENCAPSED_STRING","'insert'",290],")",")",";",["T_WHITESPACE","\n  ",290],"}",["T_WHITESPACE","\n\n  ",291],["T_DOC_COMMENT","\/**\n   * Test replacement when uploading over a file that already exists.\n   *\/",293],["T_WHITESPACE","\n  ",295],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","testExistingReplace",296],"(",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n    ",296],["T_VARIABLE","$edit",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_ARRAY","array",297],"(",["T_WHITESPACE","\n      ",297],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_STRING","FILE_EXISTS_REPLACE",298],",",["T_WHITESPACE","\n      ",298],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",299],["T_WHITESPACE"," ",299],["T_DOUBLE_ARROW","=>",299],["T_WHITESPACE"," ",299],["T_STRING","drupal_realpath",299],"(",["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","image",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getFileUri",299],"(",")",")",["T_WHITESPACE","\n    ",299],")",";",["T_WHITESPACE","\n    ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","drupalPostForm",301],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$edit",301],",",["T_WHITESPACE"," ",301],["T_STRING","t",301],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",301],")",")",";",["T_WHITESPACE","\n    ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","assertResponse",302],"(",["T_LNUMBER","200",302],",",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",302],")",";",["T_WHITESPACE","\n    ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","assertRaw",303],"(",["T_STRING","t",303],"(",["T_CONSTANT_ENCAPSED_STRING","'You WIN!'",303],")",",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'Found the success message.'",303],")",";",["T_WHITESPACE","\n\n    ",303],["T_COMMENT","\/\/ Check that the correct hooks were called.\n",305],["T_WHITESPACE","    ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","assertFileHooksCalled",306],"(",["T_ARRAY","array",306],"(",["T_CONSTANT_ENCAPSED_STRING","'validate'",306],",",["T_WHITESPACE"," ",306],["T_CONSTANT_ENCAPSED_STRING","'load'",306],",",["T_WHITESPACE"," ",306],["T_CONSTANT_ENCAPSED_STRING","'update'",306],")",")",";",["T_WHITESPACE","\n  ",306],"}",["T_WHITESPACE","\n\n  ",307],["T_DOC_COMMENT","\/**\n   * Test for failure when uploading over a file that already exists.\n   *\/",309],["T_WHITESPACE","\n  ",311],["T_FUNCTION","function",312],["T_WHITESPACE"," ",312],["T_STRING","testExistingError",312],"(",")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n    ",312],["T_VARIABLE","$edit",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_ARRAY","array",313],"(",["T_WHITESPACE","\n      ",313],["T_CONSTANT_ENCAPSED_STRING","'file_test_replace'",314],["T_WHITESPACE"," ",314],["T_DOUBLE_ARROW","=>",314],["T_WHITESPACE"," ",314],["T_STRING","FILE_EXISTS_ERROR",314],",",["T_WHITESPACE","\n      ",314],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_STRING","drupal_realpath",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","image",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getFileUri",315],"(",")",")",["T_WHITESPACE","\n    ",315],")",";",["T_WHITESPACE","\n    ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","drupalPostForm",317],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$edit",317],",",["T_WHITESPACE"," ",317],["T_STRING","t",317],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",317],")",")",";",["T_WHITESPACE","\n    ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","assertResponse",318],"(",["T_LNUMBER","200",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",318],")",";",["T_WHITESPACE","\n    ",318],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","assertRaw",319],"(",["T_STRING","t",319],"(",["T_CONSTANT_ENCAPSED_STRING","'Epic upload FAIL!'",319],")",",",["T_WHITESPACE"," ",319],["T_CONSTANT_ENCAPSED_STRING","'Found the failure message.'",319],")",";",["T_WHITESPACE","\n\n    ",319],["T_COMMENT","\/\/ Check that the no hooks were called while failing.\n",321],["T_WHITESPACE","    ",322],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","assertFileHooksCalled",322],"(",["T_ARRAY","array",322],"(",")",")",";",["T_WHITESPACE","\n  ",322],"}",["T_WHITESPACE","\n\n  ",323],["T_DOC_COMMENT","\/**\n   * Test for no failures when not uploading a file.\n   *\/",325],["T_WHITESPACE","\n  ",327],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","testNoUpload",328],"(",")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n    ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","drupalPostForm",329],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",329],",",["T_WHITESPACE"," ",329],["T_ARRAY","array",329],"(",")",",",["T_WHITESPACE"," ",329],["T_STRING","t",329],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",329],")",")",";",["T_WHITESPACE","\n    ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","assertNoRaw",330],"(",["T_STRING","t",330],"(",["T_CONSTANT_ENCAPSED_STRING","'Epic upload FAIL!'",330],")",",",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'Failure message not found.'",330],")",";",["T_WHITESPACE","\n  ",330],"}",["T_WHITESPACE","\n\n  ",331],["T_DOC_COMMENT","\/**\n   * Tests for log entry on failing destination.\n   *\/",333],["T_WHITESPACE","\n  ",335],["T_FUNCTION","function",336],["T_WHITESPACE"," ",336],["T_STRING","testDrupalMovingUploadedFileError",336],"(",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n    ",336],["T_COMMENT","\/\/ Create a directory and make it not writable.\n",337],["T_WHITESPACE","    ",338],["T_VARIABLE","$test_directory",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","'test_drupal_move_uploaded_file_fail'",338],";",["T_WHITESPACE","\n    ",338],["T_STRING","drupal_mkdir",339],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary:\/\/'",339],["T_WHITESPACE"," ",339],".",["T_WHITESPACE"," ",339],["T_VARIABLE","$test_directory",339],",",["T_WHITESPACE"," ",339],["T_LNUMBER","0000",339],")",";",["T_WHITESPACE","\n    ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","assertTrue",340],"(",["T_STRING","is_dir",340],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary:\/\/'",340],["T_WHITESPACE"," ",340],".",["T_WHITESPACE"," ",340],["T_VARIABLE","$test_directory",340],")",")",";",["T_WHITESPACE","\n\n    ",340],["T_VARIABLE","$edit",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_ARRAY","array",342],"(",["T_WHITESPACE","\n      ",342],["T_CONSTANT_ENCAPSED_STRING","'file_subdir'",343],["T_WHITESPACE"," ",343],["T_DOUBLE_ARROW","=>",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$test_directory",343],",",["T_WHITESPACE","\n      ",343],["T_CONSTANT_ENCAPSED_STRING","'files[file_test_upload]'",344],["T_WHITESPACE"," ",344],["T_DOUBLE_ARROW","=>",344],["T_WHITESPACE"," ",344],["T_STRING","drupal_realpath",344],"(",["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","image",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getFileUri",344],"(",")",")",["T_WHITESPACE","\n    ",344],")",";",["T_WHITESPACE","\n\n    ",345],["T_NS_SEPARATOR","\\",347],["T_STRING","Drupal",347],["T_DOUBLE_COLON","::",347],["T_STRING","state",347],"(",")",["T_OBJECT_OPERATOR","->",347],["T_STRING","set",347],"(",["T_CONSTANT_ENCAPSED_STRING","'file_test.disable_error_collection'",347],",",["T_WHITESPACE"," ",347],["T_STRING","TRUE",347],")",";",["T_WHITESPACE","\n    ",347],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","drupalPostForm",348],"(",["T_CONSTANT_ENCAPSED_STRING","'file-test\/upload'",348],",",["T_WHITESPACE"," ",348],["T_VARIABLE","$edit",348],",",["T_WHITESPACE"," ",348],["T_STRING","t",348],"(",["T_CONSTANT_ENCAPSED_STRING","'Submit'",348],")",")",";",["T_WHITESPACE","\n    ",348],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","assertResponse",349],"(",["T_LNUMBER","200",349],",",["T_WHITESPACE"," ",349],["T_CONSTANT_ENCAPSED_STRING","'Received a 200 response for posted test file.'",349],")",";",["T_WHITESPACE","\n    ",349],["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","assertRaw",350],"(",["T_STRING","t",350],"(",["T_CONSTANT_ENCAPSED_STRING","'File upload error. Could not move uploaded file.'",350],")",",",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'Found the failure message.'",350],")",";",["T_WHITESPACE","\n    ",350],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","assertRaw",351],"(",["T_STRING","t",351],"(",["T_CONSTANT_ENCAPSED_STRING","'Epic upload FAIL!'",351],")",",",["T_WHITESPACE"," ",351],["T_CONSTANT_ENCAPSED_STRING","'Found the failure message.'",351],")",";",["T_WHITESPACE","\n\n    ",351],["T_COMMENT","\/\/ Uploading failed. Now check the log.\n",353],["T_WHITESPACE","    ",354],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","drupalGet",354],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/dblog'",354],")",";",["T_WHITESPACE","\n    ",354],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","assertResponse",355],"(",["T_LNUMBER","200",355],")",";",["T_WHITESPACE","\n    ",355],["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","assertRaw",356],"(",["T_STRING","t",356],"(",["T_CONSTANT_ENCAPSED_STRING","'Upload error. Could not move uploaded file @file to destination @destination.'",356],",",["T_WHITESPACE"," ",356],["T_ARRAY","array",356],"(",["T_WHITESPACE","\n      ",356],["T_CONSTANT_ENCAPSED_STRING","'@file'",357],["T_WHITESPACE"," ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","image",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getFilename",357],"(",")",",",["T_WHITESPACE","\n      ",357],["T_CONSTANT_ENCAPSED_STRING","'@destination'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_CONSTANT_ENCAPSED_STRING","'temporary:\/\/'",358],["T_WHITESPACE"," ",358],".",["T_WHITESPACE"," ",358],["T_VARIABLE","$test_directory",358],["T_WHITESPACE"," ",358],".",["T_WHITESPACE"," ",358],["T_CONSTANT_ENCAPSED_STRING","'\/'",358],["T_WHITESPACE"," ",358],".",["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","image",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getFilename",358],"(",")",["T_WHITESPACE","\n    ",358],")",")",",",["T_WHITESPACE"," ",359],["T_CONSTANT_ENCAPSED_STRING","'Found upload error log entry.'",359],")",";",["T_WHITESPACE","\n  ",359],"}",["T_WHITESPACE","\n\n",360],"}",["T_WHITESPACE","\n",362]]