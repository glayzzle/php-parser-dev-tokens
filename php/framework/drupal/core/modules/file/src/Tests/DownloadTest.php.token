[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","file",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests for download\/file transfer functions.\n *\n * @group file\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","DownloadTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","FileManagedTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n  ",10],["T_PROTECTED","protected",11],["T_WHITESPACE"," ",11],["T_FUNCTION","function",11],["T_WHITESPACE"," ",11],["T_STRING","setUp",11],"(",")",["T_WHITESPACE"," ",11],"{",["T_WHITESPACE","\n    ",11],["T_STRING","parent",12],["T_DOUBLE_COLON","::",12],["T_STRING","setUp",12],"(",")",";",["T_WHITESPACE","\n    ",12],["T_COMMENT","\/\/ Clear out any hook calls.\n",13],["T_WHITESPACE","    ",14],["T_STRING","file_test_reset",14],"(",")",";",["T_WHITESPACE","\n  ",14],"}",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * Test the public file transfer system.\n   *\/",17],["T_WHITESPACE","\n  ",19],["T_FUNCTION","function",20],["T_WHITESPACE"," ",20],["T_STRING","testPublicFileTransfer",20],"(",")",["T_WHITESPACE"," ",20],"{",["T_WHITESPACE","\n    ",20],["T_COMMENT","\/\/ Test generating a URL to a created file.\n",21],["T_WHITESPACE","    ",22],["T_VARIABLE","$file",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_VARIABLE","$this",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","createFile",22],"(",")",";",["T_WHITESPACE","\n    ",22],["T_VARIABLE","$url",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_STRING","file_create_url",23],"(",["T_VARIABLE","$file",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","getFileUri",23],"(",")",")",";",["T_WHITESPACE","\n    ",23],["T_COMMENT","\/\/ URLs can't contain characters outside the ASCII set so $filename has to be\n",24],["T_WHITESPACE","    ",25],["T_COMMENT","\/\/ encoded.\n",25],["T_WHITESPACE","    ",26],["T_VARIABLE","$filename",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$GLOBALS",26],"[",["T_CONSTANT_ENCAPSED_STRING","'base_url'",26],"]",["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/'",26],["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Drupal",26],["T_DOUBLE_COLON","::",26],["T_STRING","service",26],"(",["T_CONSTANT_ENCAPSED_STRING","'stream_wrapper_manager'",26],")",["T_OBJECT_OPERATOR","->",26],["T_STRING","getViaScheme",26],"(",["T_CONSTANT_ENCAPSED_STRING","'public'",26],")",["T_OBJECT_OPERATOR","->",26],["T_STRING","getDirectoryPath",26],"(",")",["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/'",26],["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_STRING","rawurlencode",26],"(",["T_VARIABLE","$file",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","getFilename",26],"(",")",")",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","assertEqual",27],"(",["T_VARIABLE","$filename",27],",",["T_WHITESPACE"," ",27],["T_VARIABLE","$url",27],",",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'Correctly generated a URL for a created file.'",27],")",";",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","drupalHead",28],"(",["T_VARIABLE","$url",28],")",";",["T_WHITESPACE","\n    ",28],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","assertResponse",29],"(",["T_LNUMBER","200",29],",",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'Confirmed that the generated URL is correct by downloading the created file.'",29],")",";",["T_WHITESPACE","\n\n    ",29],["T_COMMENT","\/\/ Test generating a URL to a shipped file (i.e. a file that is part of\n",31],["T_WHITESPACE","    ",32],["T_COMMENT","\/\/ Drupal core, a module or a theme, for example a JavaScript file).\n",32],["T_WHITESPACE","    ",33],["T_VARIABLE","$filepath",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'core\/assets\/vendor\/jquery\/jquery.min.js'",33],";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$url",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","file_create_url",34],"(",["T_VARIABLE","$filepath",34],")",";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","assertEqual",35],"(",["T_VARIABLE","$GLOBALS",35],"[",["T_CONSTANT_ENCAPSED_STRING","'base_url'",35],"]",["T_WHITESPACE"," ",35],".",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'\/'",35],["T_WHITESPACE"," ",35],".",["T_WHITESPACE"," ",35],["T_VARIABLE","$filepath",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$url",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'Correctly generated a URL for a shipped file.'",35],")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","drupalHead",36],"(",["T_VARIABLE","$url",36],")",";",["T_WHITESPACE","\n    ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertResponse",37],"(",["T_LNUMBER","200",37],",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'Confirmed that the generated URL is correct by downloading the shipped file.'",37],")",";",["T_WHITESPACE","\n  ",37],"}",["T_WHITESPACE","\n\n  ",38],["T_DOC_COMMENT","\/**\n   * Test the private file transfer system.\n   *\/",40],["T_WHITESPACE","\n  ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","testPrivateFileTransferWithoutPageCache",43],"(",")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","doPrivateFileTransferTest",44],"(",")",";",["T_WHITESPACE","\n  ",44],"}",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * Test the private file transfer system.\n   *\/",47],["T_WHITESPACE","\n  ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","doPrivateFileTransferTest",50],"(",")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n    ",50],["T_COMMENT","\/\/ Set file downloads to private so handler functions get called.\n",51],["T_WHITESPACE","\n    ",52],["T_COMMENT","\/\/ Create a file.\n",53],["T_WHITESPACE","    ",54],["T_VARIABLE","$contents",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","randomMachineName",54],"(",["T_LNUMBER","8",54],")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$file",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","createFile",55],"(",["T_STRING","NULL",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$contents",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'private'",55],")",";",["T_WHITESPACE","\n    ",55],["T_COMMENT","\/\/ Created private files without usage are by default not accessible\n",56],["T_WHITESPACE","    ",57],["T_COMMENT","\/\/ for a user different from the owner, but createFile always uses uid 1\n",57],["T_WHITESPACE","    ",58],["T_COMMENT","\/\/ as the owner of the files. Therefore make it permanent to allow access\n",58],["T_WHITESPACE","    ",59],["T_COMMENT","\/\/ if a module allows it.\n",59],["T_WHITESPACE","    ",60],["T_VARIABLE","$file",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setPermanent",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$file",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","save",61],"(",")",";",["T_WHITESPACE","\n\n    ",61],["T_VARIABLE","$url",63],["T_WHITESPACE","  ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","file_create_url",63],"(",["T_VARIABLE","$file",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getFileUri",63],"(",")",")",";",["T_WHITESPACE","\n\n    ",63],["T_COMMENT","\/\/ Set file_test access header to allow the download.\n",65],["T_WHITESPACE","    ",66],["T_STRING","file_test_set_return",66],"(",["T_CONSTANT_ENCAPSED_STRING","'download'",66],",",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",["T_CONSTANT_ENCAPSED_STRING","'x-foo'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Bar'",66],")",")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","drupalGet",67],"(",["T_VARIABLE","$url",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertEqual",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","drupalGetHeader",68],"(",["T_CONSTANT_ENCAPSED_STRING","'x-foo'",68],")",",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Bar'",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Found header set by file_test module on private download.'",68],")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertFalse",69],"(",["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","drupalGetHeader",69],"(",["T_CONSTANT_ENCAPSED_STRING","'x-drupal-cache'",69],")",",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'Page cache is disabled on private file download.'",69],")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","assertResponse",70],"(",["T_LNUMBER","200",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'Correctly allowed access to a file when file_test provides headers.'",70],")",";",["T_WHITESPACE","\n\n    ",70],["T_COMMENT","\/\/ Test that the file transferred correctly.\n",72],["T_WHITESPACE","    ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertEqual",73],"(",["T_VARIABLE","$contents",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","content",73],",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'Contents of the file are correct.'",73],")",";",["T_WHITESPACE","\n\n    ",73],["T_COMMENT","\/\/ Deny access to all downloads via a -1 header.\n",75],["T_WHITESPACE","    ",76],["T_STRING","file_test_set_return",76],"(",["T_CONSTANT_ENCAPSED_STRING","'download'",76],",",["T_WHITESPACE"," ",76],"-",["T_LNUMBER","1",76],")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","drupalHead",77],"(",["T_VARIABLE","$url",77],")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertResponse",78],"(",["T_LNUMBER","403",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Correctly denied access to a file when file_test sets the header to -1.'",78],")",";",["T_WHITESPACE","\n\n    ",78],["T_COMMENT","\/\/ Try non-existent file.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$url",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","file_create_url",81],"(",["T_CONSTANT_ENCAPSED_STRING","'private:\/\/'",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","randomMachineName",81],"(",")",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","drupalHead",82],"(",["T_VARIABLE","$url",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertResponse",83],"(",["T_LNUMBER","404",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'Correctly returned 404 response for a non-existent file.'",83],")",";",["T_WHITESPACE","\n  ",83],"}",["T_WHITESPACE","\n\n  ",84],["T_DOC_COMMENT","\/**\n   * Test file_create_url().\n   *\/",86],["T_WHITESPACE","\n  ",88],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","testFileCreateUrl",89],"(",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n\n    ",89],["T_COMMENT","\/\/ Tilde (~) is excluded from this test because it is encoded by\n",91],["T_WHITESPACE","    ",92],["T_COMMENT","\/\/ rawurlencode() in PHP 5.2 but not in PHP 5.3, as per RFC 3986.\n",92],["T_WHITESPACE","    ",93],["T_COMMENT","\/\/ @see http:\/\/php.net\/manual\/function.rawurlencode.php#86506\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$basename",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","\" -._!$'\\\"()*@[]?&+%#,;=:\\n\\x00\"",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_COMMENT","\/\/ \"Special\" ASCII characters.\n",94],["T_WHITESPACE","      ",95],["T_CONSTANT_ENCAPSED_STRING","\"%23%25%26%2B%2F%3F\"",95],["T_WHITESPACE"," ",95],".",["T_WHITESPACE"," ",95],["T_COMMENT","\/\/ Characters that look like a percent-escaped string.\n",95],["T_WHITESPACE","      ",96],["T_CONSTANT_ENCAPSED_STRING","\"\u00c3\u00a9\u00c3\u00b8\u00c3\u00af\u00d0\u00b2\u00ce\u00b2\u00e4\u00b8\u00ad\u00e5\u009c\u008b\u00e6\u009b\u00b8\u00db\u009e\"",96],";",["T_WHITESPACE"," ",96],["T_COMMENT","\/\/ Characters from various non-ASCII alphabets.\n",96],["T_WHITESPACE","    ",97],["T_VARIABLE","$basename_encoded",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'%20-._%21%24%27%22%28%29%2A%40%5B%5D%3F%26%2B%25%23%2C%3B%3D%3A__'",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE","\n      ",97],["T_CONSTANT_ENCAPSED_STRING","'%2523%2525%2526%252B%252F%253F'",98],["T_WHITESPACE"," ",98],".",["T_WHITESPACE","\n      ",98],["T_CONSTANT_ENCAPSED_STRING","'%C3%A9%C3%B8%C3%AF%D0%B2%CE%B2%E4%B8%AD%E5%9C%8B%E6%9B%B8%DB%9E'",99],";",["T_WHITESPACE","\n\n    ",99],["T_COMMENT","\/\/ Public files should not be served by Drupal, so their URLs should not be\n",101],["T_WHITESPACE","    ",102],["T_COMMENT","\/\/ routed through Drupal, whereas private files should be served by Drupal,\n",102],["T_WHITESPACE","    ",103],["T_COMMENT","\/\/ so they need to be. The difference is most apparent when $script_path\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ is not empty (i.e., when not using clean URLs).\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$clean_url_settings",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",["T_WHITESPACE","\n      ",105],["T_CONSTANT_ENCAPSED_STRING","'clean'",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","''",106],",",["T_WHITESPACE","\n      ",106],["T_CONSTANT_ENCAPSED_STRING","'unclean'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'index.php\/'",107],",",["T_WHITESPACE","\n    ",107],")",";",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$public_directory_path",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Drupal",109],["T_DOUBLE_COLON","::",109],["T_STRING","service",109],"(",["T_CONSTANT_ENCAPSED_STRING","'stream_wrapper_manager'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","getViaScheme",109],"(",["T_CONSTANT_ENCAPSED_STRING","'public'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","getDirectoryPath",109],"(",")",";",["T_WHITESPACE","\n    ",109],["T_FOREACH","foreach",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$clean_url_settings",110],["T_WHITESPACE"," ",110],["T_AS","as",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$clean_url_setting",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$script_path",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n      ",110],["T_VARIABLE","$clean_urls",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$clean_url_setting",111],["T_WHITESPACE"," ",111],["T_IS_EQUAL","==",111],["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'clean'",111],";",["T_WHITESPACE","\n      ",111],["T_VARIABLE","$request",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","prepareRequestForGenerator",112],"(",["T_VARIABLE","$clean_urls",112],")",";",["T_WHITESPACE","\n      ",112],["T_VARIABLE","$base_path",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$request",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getSchemeAndHttpHost",113],"(",")",["T_WHITESPACE"," ",113],".",["T_WHITESPACE"," ",113],["T_VARIABLE","$request",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getBasePath",113],"(",")",";",["T_WHITESPACE","\n      ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","checkUrl",114],"(",["T_CONSTANT_ENCAPSED_STRING","'public'",114],",",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","''",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$basename",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$base_path",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'\/'",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_VARIABLE","$public_directory_path",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'\/'",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_VARIABLE","$basename_encoded",114],")",";",["T_WHITESPACE","\n      ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","checkUrl",115],"(",["T_CONSTANT_ENCAPSED_STRING","'private'",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","''",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$basename",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$base_path",115],["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'\/'",115],["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_VARIABLE","$script_path",115],["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'system\/files\/'",115],["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_VARIABLE","$basename_encoded",115],")",";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","assertEqual",117],"(",["T_STRING","file_create_url",117],"(",["T_CONSTANT_ENCAPSED_STRING","'data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4\/\/8\/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='",117],")",",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4\/\/8\/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='",117],",",["T_WHITESPACE"," ",117],["T_STRING","t",117],"(",["T_CONSTANT_ENCAPSED_STRING","'Generated URL matches expected URL.'",117],")",")",";",["T_WHITESPACE","\n    ",117],["T_COMMENT","\/\/ Test public files with a different host name from settings.\n",118],["T_WHITESPACE","    ",119],["T_VARIABLE","$test_base_url",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'http:\/\/www.example.com\/cdn'",119],";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","settingsSet",120],"(",["T_CONSTANT_ENCAPSED_STRING","'file_public_base_url'",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$test_base_url",120],")",";",["T_WHITESPACE","\n    ",120],["T_VARIABLE","$filepath",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","file_create_filename",121],"(",["T_CONSTANT_ENCAPSED_STRING","'test.txt'",121],",",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","''",121],")",";",["T_WHITESPACE","\n    ",121],["T_VARIABLE","$directory_uri",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/'",122],["T_WHITESPACE"," ",122],".",["T_WHITESPACE"," ",122],["T_STRING","dirname",122],"(",["T_VARIABLE","$filepath",122],")",";",["T_WHITESPACE","\n    ",122],["T_STRING","file_prepare_directory",123],"(",["T_VARIABLE","$directory_uri",123],",",["T_WHITESPACE"," ",123],["T_STRING","FILE_CREATE_DIRECTORY",123],")",";",["T_WHITESPACE","\n    ",123],["T_VARIABLE","$file",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","createFile",124],"(",["T_VARIABLE","$filepath",124],",",["T_WHITESPACE"," ",124],["T_STRING","NULL",124],",",["T_WHITESPACE"," ",124],["T_CONSTANT_ENCAPSED_STRING","'public'",124],")",";",["T_WHITESPACE","\n    ",124],["T_VARIABLE","$url",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","file_create_url",125],"(",["T_VARIABLE","$file",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getFileUri",125],"(",")",")",";",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$expected_url",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$test_base_url",126],["T_WHITESPACE"," ",126],".",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'\/'",126],["T_WHITESPACE"," ",126],".",["T_WHITESPACE"," ",126],["T_STRING","basename",126],"(",["T_VARIABLE","$filepath",126],")",";",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","assertEqual",127],"(",["T_VARIABLE","$url",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$expected_url",127],")",";",["T_WHITESPACE","\n  ",127],"}",["T_WHITESPACE","\n\n  ",128],["T_DOC_COMMENT","\/**\n   * Download a file from the URL generated by file_create_url().\n   *\n   * Create a file with the specified scheme, directory and filename; check that\n   * the URL generated by file_create_url() for the specified file equals the\n   * specified URL; fetch the URL and then compare the contents to the file.\n   *\n   * @param string $scheme\n   *   A scheme, e.g. \"public\".\n   * @param string $directory\n   *   A directory, possibly \"\".\n   * @param string $filename\n   *   A filename.\n   * @param string $expected_url\n   *   The expected URL.\n   *\/",130],["T_WHITESPACE","\n  ",145],["T_PRIVATE","private",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","checkUrl",146],"(",["T_VARIABLE","$scheme",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$directory",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$filename",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$expected_url",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n    ",146],["T_COMMENT","\/\/ Convert $filename to a valid filename, i.e. strip characters not\n",147],["T_WHITESPACE","    ",148],["T_COMMENT","\/\/ supported by the filesystem, and create the file in the specified\n",148],["T_WHITESPACE","    ",149],["T_COMMENT","\/\/ directory.\n",149],["T_WHITESPACE","    ",150],["T_VARIABLE","$filepath",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","file_create_filename",150],"(",["T_VARIABLE","$filename",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$directory",150],")",";",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$directory_uri",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$scheme",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","':\/\/'",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_STRING","dirname",151],"(",["T_VARIABLE","$filepath",151],")",";",["T_WHITESPACE","\n    ",151],["T_STRING","file_prepare_directory",152],"(",["T_VARIABLE","$directory_uri",152],",",["T_WHITESPACE"," ",152],["T_STRING","FILE_CREATE_DIRECTORY",152],")",";",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$file",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","createFile",153],"(",["T_VARIABLE","$filepath",153],",",["T_WHITESPACE"," ",153],["T_STRING","NULL",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$scheme",153],")",";",["T_WHITESPACE","\n\n    ",153],["T_VARIABLE","$url",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_STRING","file_create_url",155],"(",["T_VARIABLE","$file",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getFileUri",155],"(",")",")",";",["T_WHITESPACE","\n    ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","assertEqual",156],"(",["T_VARIABLE","$url",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$expected_url",156],")",";",["T_WHITESPACE","\n\n    ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$scheme",158],["T_WHITESPACE"," ",158],["T_IS_EQUAL","==",158],["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'private'",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n      ",158],["T_COMMENT","\/\/ Tell the implementation of hook_file_download() in file_test.module\n",159],["T_WHITESPACE","      ",160],["T_COMMENT","\/\/ that this file may be downloaded.\n",160],["T_WHITESPACE","      ",161],["T_STRING","file_test_set_return",161],"(",["T_CONSTANT_ENCAPSED_STRING","'download'",161],",",["T_WHITESPACE"," ",161],["T_ARRAY","array",161],"(",["T_CONSTANT_ENCAPSED_STRING","'x-foo'",161],["T_WHITESPACE"," ",161],["T_DOUBLE_ARROW","=>",161],["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Bar'",161],")",")",";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","drupalGet",164],"(",["T_VARIABLE","$url",164],")",";",["T_WHITESPACE","\n    ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","assertResponse",165],"(",["T_LNUMBER","200",165],")",["T_WHITESPACE"," ",165],["T_IS_EQUAL","==",165],["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'pass'",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n      ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","assertRaw",166],"(",["T_STRING","file_get_contents",166],"(",["T_VARIABLE","$file",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getFileUri",166],"(",")",")",",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'Contents of the file are correct.'",166],")",";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n\n    ",167],["T_VARIABLE","$file",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","delete",169],"(",")",";",["T_WHITESPACE","\n  ",169],"}",["T_WHITESPACE","\n\n",170],"}",["T_WHITESPACE","\n",172]]