[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","filter",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Plugin",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Filter",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Html",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Utility",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Unicode",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Utility",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Xss",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","filter",8],["T_NS_SEPARATOR","\\",8],["T_STRING","FilterProcessResult",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","filter",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Plugin",9],["T_NS_SEPARATOR","\\",9],["T_STRING","FilterBase",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","filter",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Render",10],["T_NS_SEPARATOR","\\",10],["T_STRING","FilteredMarkup",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Provides a filter to caption elements.\n *\n * When used in combination with the filter_align filter, this must run last.\n *\n * @Filter(\n *   id = \"filter_caption\",\n *   title = @Translation(\"Caption images\"),\n *   description = @Translation(\"Uses a <code>data-caption<\/code> attribute on <code>&lt;img&gt;<\/code> tags to caption images.\"),\n *   type = Drupal\\filter\\Plugin\\FilterInterface::TYPE_TRANSFORM_REVERSIBLE\n * )\n *\/",12],["T_WHITESPACE","\n",23],["T_CLASS","class",24],["T_WHITESPACE"," ",24],["T_STRING","FilterCaption",24],["T_WHITESPACE"," ",24],["T_EXTENDS","extends",24],["T_WHITESPACE"," ",24],["T_STRING","FilterBase",24],["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",26],["T_WHITESPACE","\n  ",28],["T_PUBLIC","public",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","process",29],"(",["T_VARIABLE","$text",29],",",["T_WHITESPACE"," ",29],["T_VARIABLE","$langcode",29],")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$result",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_NEW","new",30],["T_WHITESPACE"," ",30],["T_STRING","FilterProcessResult",30],"(",["T_VARIABLE","$text",30],")",";",["T_WHITESPACE","\n\n    ",30],["T_IF","if",32],["T_WHITESPACE"," ",32],"(",["T_STRING","stristr",32],"(",["T_VARIABLE","$text",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'data-caption'",32],")",["T_WHITESPACE"," ",32],["T_IS_NOT_IDENTICAL","!==",32],["T_WHITESPACE"," ",32],["T_STRING","FALSE",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n      ",32],["T_VARIABLE","$dom",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_STRING","Html",33],["T_DOUBLE_COLON","::",33],["T_STRING","load",33],"(",["T_VARIABLE","$text",33],")",";",["T_WHITESPACE","\n      ",33],["T_VARIABLE","$xpath",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_NEW","new",34],["T_WHITESPACE"," ",34],["T_NS_SEPARATOR","\\",34],["T_STRING","DOMXPath",34],"(",["T_VARIABLE","$dom",34],")",";",["T_WHITESPACE","\n      ",34],["T_FOREACH","foreach",35],["T_WHITESPACE"," ",35],"(",["T_VARIABLE","$xpath",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","query",35],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/*[@data-caption]'",35],")",["T_WHITESPACE"," ",35],["T_AS","as",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$node",35],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n        ",35],["T_COMMENT","\/\/ Read the data-caption attribute's value, then delete it.\n",36],["T_WHITESPACE","        ",37],["T_VARIABLE","$caption",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","Html",37],["T_DOUBLE_COLON","::",37],["T_STRING","escape",37],"(",["T_VARIABLE","$node",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","getAttribute",37],"(",["T_CONSTANT_ENCAPSED_STRING","'data-caption'",37],")",")",";",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$node",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","removeAttribute",38],"(",["T_CONSTANT_ENCAPSED_STRING","'data-caption'",38],")",";",["T_WHITESPACE","\n\n        ",38],["T_COMMENT","\/\/ Sanitize caption: decode HTML encoding, limit allowed HTML tags; only\n",40],["T_WHITESPACE","        ",41],["T_COMMENT","\/\/ allow inline tags that are allowed by default, plus <br>.\n",41],["T_WHITESPACE","        ",42],["T_VARIABLE","$caption",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","Html",42],["T_DOUBLE_COLON","::",42],["T_STRING","decodeEntities",42],"(",["T_VARIABLE","$caption",42],")",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$caption",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","FilteredMarkup",43],["T_DOUBLE_COLON","::",43],["T_STRING","create",43],"(",["T_STRING","Xss",43],["T_DOUBLE_COLON","::",43],["T_STRING","filter",43],"(",["T_VARIABLE","$caption",43],",",["T_WHITESPACE"," ",43],["T_ARRAY","array",43],"(",["T_CONSTANT_ENCAPSED_STRING","'a'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'em'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'strong'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'cite'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'code'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'br'",43],")",")",")",";",["T_WHITESPACE","\n\n        ",43],["T_COMMENT","\/\/ The caption must be non-empty.\n",45],["T_WHITESPACE","        ",46],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_STRING","Unicode",46],["T_DOUBLE_COLON","::",46],["T_STRING","strlen",46],"(",["T_VARIABLE","$caption",46],")",["T_WHITESPACE"," ",46],["T_IS_IDENTICAL","===",46],["T_WHITESPACE"," ",46],["T_LNUMBER","0",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n          ",46],["T_CONTINUE","continue",47],";",["T_WHITESPACE","\n        ",47],"}",["T_WHITESPACE","\n\n        ",48],["T_COMMENT","\/\/ Given the updated node and caption: re-render it with a caption, but\n",50],["T_WHITESPACE","        ",51],["T_COMMENT","\/\/ bubble up the value of the class attribute of the captioned element,\n",51],["T_WHITESPACE","        ",52],["T_COMMENT","\/\/ this allows it to collaborate with e.g. the filter_align filter.\n",52],["T_WHITESPACE","        ",53],["T_VARIABLE","$tag",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$node",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","tagName",53],";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$classes",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$node",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getAttribute",54],"(",["T_CONSTANT_ENCAPSED_STRING","'class'",54],")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$node",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","removeAttribute",55],"(",["T_CONSTANT_ENCAPSED_STRING","'class'",55],")",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$node",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$node",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","parentNode",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","tagName",56],["T_WHITESPACE"," ",56],["T_IS_IDENTICAL","===",56],["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'a'",56],")",["T_WHITESPACE"," ",56],"?",["T_WHITESPACE"," ",56],["T_VARIABLE","$node",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","parentNode",56],["T_WHITESPACE"," ",56],":",["T_WHITESPACE"," ",56],["T_VARIABLE","$node",56],";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$filter_caption",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",["T_WHITESPACE","\n          ",57],["T_CONSTANT_ENCAPSED_STRING","'#theme'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'filter_caption'",58],",",["T_WHITESPACE","\n          ",58],["T_COMMENT","\/\/ We pass the unsanitized string because this is a text format\n",59],["T_WHITESPACE","          ",60],["T_COMMENT","\/\/ filter, and after filtering, we always assume the output is safe.\n",60],["T_WHITESPACE","          ",61],["T_COMMENT","\/\/ @see \\Drupal\\filter\\Element\\ProcessedText::preRenderText()\n",61],["T_WHITESPACE","          ",62],["T_CONSTANT_ENCAPSED_STRING","'#node'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_STRING","FilteredMarkup",62],["T_DOUBLE_COLON","::",62],["T_STRING","create",62],"(",["T_VARIABLE","$node",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","C14N",62],"(",")",")",",",["T_WHITESPACE","\n          ",62],["T_CONSTANT_ENCAPSED_STRING","'#tag'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$tag",63],",",["T_WHITESPACE","\n          ",63],["T_CONSTANT_ENCAPSED_STRING","'#caption'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$caption",64],",",["T_WHITESPACE","\n          ",64],["T_CONSTANT_ENCAPSED_STRING","'#classes'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$classes",65],",",["T_WHITESPACE","\n        ",65],")",";",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$altered_html",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","drupal_render",67],"(",["T_VARIABLE","$filter_caption",67],")",";",["T_WHITESPACE","\n\n        ",67],["T_COMMENT","\/\/ Load the altered HTML into a new DOMDocument and retrieve the element.\n",69],["T_WHITESPACE","        ",70],["T_VARIABLE","$updated_nodes",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_STRING","Html",70],["T_DOUBLE_COLON","::",70],["T_STRING","load",70],"(",["T_VARIABLE","$altered_html",70],")",["T_OBJECT_OPERATOR","->",70],["T_STRING","getElementsByTagName",70],"(",["T_CONSTANT_ENCAPSED_STRING","'body'",70],")",["T_WHITESPACE","\n          ",70],["T_OBJECT_OPERATOR","->",71],["T_STRING","item",71],"(",["T_LNUMBER","0",71],")",["T_WHITESPACE","\n          ",71],["T_OBJECT_OPERATOR","->",72],["T_STRING","childNodes",72],";",["T_WHITESPACE","\n\n        ",72],["T_FOREACH","foreach",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$updated_nodes",74],["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$updated_node",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n          ",74],["T_COMMENT","\/\/ Import the updated node from the new DOMDocument into the original\n",75],["T_WHITESPACE","          ",76],["T_COMMENT","\/\/ one, importing also the child nodes of the updated node.\n",76],["T_WHITESPACE","          ",77],["T_VARIABLE","$updated_node",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$dom",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","importNode",77],"(",["T_VARIABLE","$updated_node",77],",",["T_WHITESPACE"," ",77],["T_STRING","TRUE",77],")",";",["T_WHITESPACE","\n          ",77],["T_VARIABLE","$node",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","parentNode",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","insertBefore",78],"(",["T_VARIABLE","$updated_node",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$node",78],")",";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n        ",79],["T_COMMENT","\/\/ Finally, remove the original data-caption node.\n",80],["T_WHITESPACE","        ",81],["T_VARIABLE","$node",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","parentNode",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","removeChild",81],"(",["T_VARIABLE","$node",81],")",";",["T_WHITESPACE","\n      ",81],"}",["T_WHITESPACE","\n\n      ",82],["T_VARIABLE","$result",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","setProcessedText",84],"(",["T_STRING","Html",84],["T_DOUBLE_COLON","::",84],["T_STRING","serialize",84],"(",["T_VARIABLE","$dom",84],")",")",["T_WHITESPACE","\n        ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","addAttachments",85],"(",["T_ARRAY","array",85],"(",["T_WHITESPACE","\n          ",85],["T_CONSTANT_ENCAPSED_STRING","'library'",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_ARRAY","array",86],"(",["T_WHITESPACE","\n            ",86],["T_CONSTANT_ENCAPSED_STRING","'filter\/caption'",87],",",["T_WHITESPACE","\n          ",87],")",",",["T_WHITESPACE","\n        ",88],")",")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$result",92],";",["T_WHITESPACE","\n  ",92],"}",["T_WHITESPACE","\n\n  ",93],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",95],["T_WHITESPACE","\n  ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","tips",98],"(",["T_VARIABLE","$long",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","FALSE",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n    ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$long",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","t",100],"(",["T_CONSTANT_ENCAPSED_STRING","'\n        <p>You can caption images, videos, blockquotes, and so on. Examples:<\/p>\n        <ul>\n            <li><code>&lt;img src=\"\" data-caption=\"This is a caption\" \/&gt;<\/code><\/li>\n            <li><code>&lt;video src=\"\" data-caption=\"The Drupal Dance\" \/&gt;<\/code><\/li>\n            <li><code>&lt;blockquote data-caption=\"Dries Buytaert\"&gt;Drupal is awesome!&lt;\/blockquote&gt;<\/code><\/li>\n            <li><code>&lt;code data-caption=\"Hello world in JavaScript.\"&gt;alert(\"Hello world!\");&lt;\/code&gt;<\/code><\/li>\n        <\/ul>'",100],")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n    ",108],["T_ELSE","else",109],["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n      ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","t",110],"(",["T_CONSTANT_ENCAPSED_STRING","'You can caption images (<code>data-caption=\"Text\"<\/code>), but also videos, blockquotes, and so on.'",110],")",";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n  ",111],"}",["T_WHITESPACE","\n\n",112],"}",["T_WHITESPACE","\n",114]]