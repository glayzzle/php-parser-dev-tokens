[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","node",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests that node access queries are properly altered by the node module.\n *\n * @group node\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","NodeQueryAlterTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","NodeTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",12],["T_WHITESPACE","\n  ",16],["T_PUBLIC","public",17],["T_WHITESPACE"," ",17],["T_STATIC","static",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$modules",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_ARRAY","array",17],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test'",17],")",";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * User with permission to view content.\n   *\/",19],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$accessUser",22],";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * User without permission to view content.\n   *\/",24],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$noAccessUser",27],";",["T_WHITESPACE","\n\n  ",27],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","setUp",29],"(",")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n    ",29],["T_STRING","parent",30],["T_DOUBLE_COLON","::",30],["T_STRING","setUp",30],"(",")",";",["T_WHITESPACE","\n\n    ",30],["T_STRING","node_access_rebuild",32],"(",")",";",["T_WHITESPACE","\n\n    ",32],["T_COMMENT","\/\/ Create some content.\n",34],["T_WHITESPACE","    ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","drupalCreateNode",35],"(",")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","drupalCreateNode",36],"(",")",";",["T_WHITESPACE","\n    ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","drupalCreateNode",37],"(",")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","drupalCreateNode",38],"(",")",";",["T_WHITESPACE","\n\n    ",38],["T_COMMENT","\/\/ Create user with simple node access permission. The 'node test view'\n",40],["T_WHITESPACE","    ",41],["T_COMMENT","\/\/ permission is implemented and granted by the node_access_test module.\n",41],["T_WHITESPACE","    ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","accessUser",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","drupalCreateUser",42],"(",["T_ARRAY","array",42],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'access content'",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'node test view'",42],")",")",";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","noAccessUser",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","drupalCreateUser",43],"(",["T_ARRAY","array",43],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'access content'",43],")",")",";",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","noAccessUser2",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","drupalCreateUser",44],"(",["T_ARRAY","array",44],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'access content'",44],")",")",";",["T_WHITESPACE","\n  ",44],"}",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * Tests 'node_access' query alter, for user with access.\n   *\n   * Verifies that a non-standard table alias can be used, and that a user with\n   * node access can view the nodes.\n   *\/",47],["T_WHITESPACE","\n  ",52],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","testNodeQueryAlterLowLevelWithAccess",53],"(",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n    ",53],["T_COMMENT","\/\/ User with access should be able to view 4 nodes.\n",54],["T_WHITESPACE","    ",55],["T_TRY","try",55],["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n      ",55],["T_VARIABLE","$query",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","db_select",56],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",56],",",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'mytab'",56],")",["T_WHITESPACE","\n        ",56],["T_OBJECT_OPERATOR","->",57],["T_STRING","fields",57],"(",["T_CONSTANT_ENCAPSED_STRING","'mytab'",57],")",";",["T_WHITESPACE","\n      ",57],["T_VARIABLE","$query",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","addTag",58],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",58],")",";",["T_WHITESPACE","\n      ",58],["T_VARIABLE","$query",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","addMetaData",59],"(",["T_CONSTANT_ENCAPSED_STRING","'op'",59],",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'view'",59],")",";",["T_WHITESPACE","\n      ",59],["T_VARIABLE","$query",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","addMetaData",60],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","accessUser",60],")",";",["T_WHITESPACE","\n\n      ",60],["T_VARIABLE","$result",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$query",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","execute",62],"(",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","fetchAll",62],"(",")",";",["T_WHITESPACE","\n      ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","assertEqual",63],"(",["T_STRING","count",63],"(",["T_VARIABLE","$result",63],")",",",["T_WHITESPACE"," ",63],["T_LNUMBER","4",63],",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'User with access can see correct nodes'",63],")",";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n    ",64],["T_CATCH","catch",65],["T_WHITESPACE"," ",65],"(",["T_NS_SEPARATOR","\\",65],["T_STRING","Exception",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$e",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n      ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","fail",66],"(",["T_STRING","t",66],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",66],")",")",";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n  ",67],"}",["T_WHITESPACE","\n\n  ",68],["T_DOC_COMMENT","\/**\n   * Tests 'node_access' query alter with revision-enabled nodes.\n   *\/",70],["T_WHITESPACE","\n  ",72],["T_PUBLIC","public",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","testNodeQueryAlterWithRevisions",73],"(",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n    ",73],["T_COMMENT","\/\/ Execute a query that only deals with the 'node_revision' table.\n",74],["T_WHITESPACE","    ",75],["T_TRY","try",75],["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n      ",75],["T_VARIABLE","$query",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_NS_SEPARATOR","\\",76],["T_STRING","Drupal",76],["T_DOUBLE_COLON","::",76],["T_STRING","entityTypeManager",76],"(",")",["T_OBJECT_OPERATOR","->",76],["T_STRING","getStorage",76],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",76],")",["T_OBJECT_OPERATOR","->",76],["T_STRING","getQuery",76],"(",")",";",["T_WHITESPACE","\n      ",76],["T_VARIABLE","$result",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$query",77],["T_WHITESPACE","\n        ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","allRevisions",78],"(",")",["T_WHITESPACE","\n        ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","execute",79],"(",")",";",["T_WHITESPACE","\n\n      ",79],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","assertEqual",81],"(",["T_STRING","count",81],"(",["T_VARIABLE","$result",81],")",",",["T_WHITESPACE"," ",81],["T_LNUMBER","4",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'User with access can see correct nodes'",81],")",";",["T_WHITESPACE","\n    ",81],"}",["T_WHITESPACE","\n    ",82],["T_CATCH","catch",83],["T_WHITESPACE"," ",83],"(",["T_NS_SEPARATOR","\\",83],["T_STRING","Exception",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n      ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","fail",84],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",84],")",";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n  ",85],"}",["T_WHITESPACE","\n\n  ",86],["T_DOC_COMMENT","\/**\n   * Tests 'node_access' query alter, for user without access.\n   *\n   * Verifies that a non-standard table alias can be used, and that a user\n   * without node access cannot view the nodes.\n   *\/",88],["T_WHITESPACE","\n  ",93],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","testNodeQueryAlterLowLevelNoAccess",94],"(",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n    ",94],["T_COMMENT","\/\/ User without access should be able to view 0 nodes.\n",95],["T_WHITESPACE","    ",96],["T_TRY","try",96],["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n      ",96],["T_VARIABLE","$query",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","db_select",97],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'mytab'",97],")",["T_WHITESPACE","\n        ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","fields",98],"(",["T_CONSTANT_ENCAPSED_STRING","'mytab'",98],")",";",["T_WHITESPACE","\n      ",98],["T_VARIABLE","$query",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","addTag",99],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",99],")",";",["T_WHITESPACE","\n      ",99],["T_VARIABLE","$query",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","addMetaData",100],"(",["T_CONSTANT_ENCAPSED_STRING","'op'",100],",",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'view'",100],")",";",["T_WHITESPACE","\n      ",100],["T_VARIABLE","$query",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","addMetaData",101],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","noAccessUser",101],")",";",["T_WHITESPACE","\n\n      ",101],["T_VARIABLE","$result",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$query",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","execute",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","fetchAll",103],"(",")",";",["T_WHITESPACE","\n      ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","assertEqual",104],"(",["T_STRING","count",104],"(",["T_VARIABLE","$result",104],")",",",["T_WHITESPACE"," ",104],["T_LNUMBER","0",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'User with no access cannot see nodes'",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n    ",105],["T_CATCH","catch",106],["T_WHITESPACE"," ",106],"(",["T_NS_SEPARATOR","\\",106],["T_STRING","Exception",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$e",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n      ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","fail",107],"(",["T_STRING","t",107],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",107],")",")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n  ",108],"}",["T_WHITESPACE","\n\n  ",109],["T_DOC_COMMENT","\/**\n   * Tests 'node_access' query alter, for edit access.\n   *\n   * Verifies that a non-standard table alias can be used, and that a user with\n   * view-only node access cannot edit the nodes.\n   *\/",111],["T_WHITESPACE","\n  ",116],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","testNodeQueryAlterLowLevelEditAccess",117],"(",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n    ",117],["T_COMMENT","\/\/ User with view-only access should not be able to edit nodes.\n",118],["T_WHITESPACE","    ",119],["T_TRY","try",119],["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n      ",119],["T_VARIABLE","$query",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","db_select",120],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'mytab'",120],")",["T_WHITESPACE","\n        ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","fields",121],"(",["T_CONSTANT_ENCAPSED_STRING","'mytab'",121],")",";",["T_WHITESPACE","\n      ",121],["T_VARIABLE","$query",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","addTag",122],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",122],")",";",["T_WHITESPACE","\n      ",122],["T_VARIABLE","$query",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","addMetaData",123],"(",["T_CONSTANT_ENCAPSED_STRING","'op'",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'update'",123],")",";",["T_WHITESPACE","\n      ",123],["T_VARIABLE","$query",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","addMetaData",124],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","accessUser",124],")",";",["T_WHITESPACE","\n\n      ",124],["T_VARIABLE","$result",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$query",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","execute",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","fetchAll",126],"(",")",";",["T_WHITESPACE","\n      ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","assertEqual",127],"(",["T_STRING","count",127],"(",["T_VARIABLE","$result",127],")",",",["T_WHITESPACE"," ",127],["T_LNUMBER","0",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'User with view-only access cannot edit nodes'",127],")",";",["T_WHITESPACE","\n    ",127],"}",["T_WHITESPACE","\n    ",128],["T_CATCH","catch",129],["T_WHITESPACE"," ",129],"(",["T_NS_SEPARATOR","\\",129],["T_STRING","Exception",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$e",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n      ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","fail",130],"(",["T_VARIABLE","$e",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getMessage",130],"(",")",")",";",["T_WHITESPACE","\n      ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","fail",131],"(",["T_STRING_CAST","(string)",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$query",131],")",";",["T_WHITESPACE","\n      ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","fail",132],"(",["T_STRING","t",132],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",132],")",")",";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n  ",133],"}",["T_WHITESPACE","\n\n  ",134],["T_DOC_COMMENT","\/**\n   * Tests 'node_access' query alter override.\n   *\n   * Verifies that node_access_view_all_nodes() is called from\n   * node_query_node_access_alter(). We do this by checking that a user who\n   * normally would not have view privileges is able to view the nodes when we\n   * add a record to {node_access} paired with a corresponding privilege in\n   * hook_node_grants().\n   *\/",136],["T_WHITESPACE","\n  ",144],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","testNodeQueryAlterOverride",145],"(",")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n    ",145],["T_VARIABLE","$record",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_ARRAY","array",146],"(",["T_WHITESPACE","\n      ",146],["T_CONSTANT_ENCAPSED_STRING","'nid'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_LNUMBER","0",147],",",["T_WHITESPACE","\n      ",147],["T_CONSTANT_ENCAPSED_STRING","'gid'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_LNUMBER","0",148],",",["T_WHITESPACE","\n      ",148],["T_CONSTANT_ENCAPSED_STRING","'realm'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'node_access_all'",149],",",["T_WHITESPACE","\n      ",149],["T_CONSTANT_ENCAPSED_STRING","'grant_view'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_LNUMBER","1",150],",",["T_WHITESPACE","\n      ",150],["T_CONSTANT_ENCAPSED_STRING","'grant_update'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_LNUMBER","0",151],",",["T_WHITESPACE","\n      ",151],["T_CONSTANT_ENCAPSED_STRING","'grant_delete'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_LNUMBER","0",152],",",["T_WHITESPACE","\n    ",152],")",";",["T_WHITESPACE","\n    ",153],["T_STRING","db_insert",154],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",154],")",["T_OBJECT_OPERATOR","->",154],["T_STRING","fields",154],"(",["T_VARIABLE","$record",154],")",["T_OBJECT_OPERATOR","->",154],["T_STRING","execute",154],"(",")",";",["T_WHITESPACE","\n\n    ",154],["T_COMMENT","\/\/ Test that the noAccessUser still doesn't have the 'view'\n",156],["T_WHITESPACE","    ",157],["T_COMMENT","\/\/ privilege after adding the node_access record.\n",157],["T_WHITESPACE","    ",158],["T_STRING","drupal_static_reset",158],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",158],")",";",["T_WHITESPACE","\n    ",158],["T_TRY","try",159],["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n      ",159],["T_VARIABLE","$query",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","db_select",160],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",160],",",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'mytab'",160],")",["T_WHITESPACE","\n        ",160],["T_OBJECT_OPERATOR","->",161],["T_STRING","fields",161],"(",["T_CONSTANT_ENCAPSED_STRING","'mytab'",161],")",";",["T_WHITESPACE","\n      ",161],["T_VARIABLE","$query",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","addTag",162],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",162],")",";",["T_WHITESPACE","\n      ",162],["T_VARIABLE","$query",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","addMetaData",163],"(",["T_CONSTANT_ENCAPSED_STRING","'op'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'view'",163],")",";",["T_WHITESPACE","\n      ",163],["T_VARIABLE","$query",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","addMetaData",164],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","noAccessUser",164],")",";",["T_WHITESPACE","\n\n      ",164],["T_VARIABLE","$result",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$query",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","execute",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","fetchAll",166],"(",")",";",["T_WHITESPACE","\n      ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","assertEqual",167],"(",["T_STRING","count",167],"(",["T_VARIABLE","$result",167],")",",",["T_WHITESPACE"," ",167],["T_LNUMBER","0",167],",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'User view privileges are not overridden'",167],")",";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n    ",168],["T_CATCH","catch",169],["T_WHITESPACE"," ",169],"(",["T_NS_SEPARATOR","\\",169],["T_STRING","Exception",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$e",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n      ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","fail",170],"(",["T_STRING","t",170],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",170],")",")",";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n\n    ",171],["T_COMMENT","\/\/ Have node_test_node_grants return a node_access_all privilege,\n",173],["T_WHITESPACE","    ",174],["T_COMMENT","\/\/ to grant the noAccessUser 'view' access.  To verify that\n",174],["T_WHITESPACE","    ",175],["T_COMMENT","\/\/ node_access_view_all_nodes is properly checking the specified\n",175],["T_WHITESPACE","    ",176],["T_COMMENT","\/\/ $account instead of the current user, we will log in as\n",176],["T_WHITESPACE","    ",177],["T_COMMENT","\/\/ noAccessUser2.\n",177],["T_WHITESPACE","    ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","drupalLogin",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","noAccessUser2",178],")",";",["T_WHITESPACE","\n    ",178],["T_NS_SEPARATOR","\\",179],["T_STRING","Drupal",179],["T_DOUBLE_COLON","::",179],["T_STRING","state",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","set",179],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test.no_access_uid'",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","noAccessUser",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","id",179],"(",")",")",";",["T_WHITESPACE","\n    ",179],["T_STRING","drupal_static_reset",180],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",180],")",";",["T_WHITESPACE","\n    ",180],["T_TRY","try",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n      ",181],["T_VARIABLE","$query",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","db_select",182],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'mytab'",182],")",["T_WHITESPACE","\n        ",182],["T_OBJECT_OPERATOR","->",183],["T_STRING","fields",183],"(",["T_CONSTANT_ENCAPSED_STRING","'mytab'",183],")",";",["T_WHITESPACE","\n      ",183],["T_VARIABLE","$query",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","addTag",184],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",184],")",";",["T_WHITESPACE","\n      ",184],["T_VARIABLE","$query",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","addMetaData",185],"(",["T_CONSTANT_ENCAPSED_STRING","'op'",185],",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'view'",185],")",";",["T_WHITESPACE","\n      ",185],["T_VARIABLE","$query",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","addMetaData",186],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","noAccessUser",186],")",";",["T_WHITESPACE","\n\n      ",186],["T_VARIABLE","$result",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$query",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","execute",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","fetchAll",188],"(",")",";",["T_WHITESPACE","\n      ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","assertEqual",189],"(",["T_STRING","count",189],"(",["T_VARIABLE","$result",189],")",",",["T_WHITESPACE"," ",189],["T_LNUMBER","4",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'User view privileges are overridden'",189],")",";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n    ",190],["T_CATCH","catch",191],["T_WHITESPACE"," ",191],"(",["T_NS_SEPARATOR","\\",191],["T_STRING","Exception",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$e",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n      ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","fail",192],"(",["T_STRING","t",192],"(",["T_CONSTANT_ENCAPSED_STRING","'Altered query is malformed'",192],")",")",";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n    ",193],["T_NS_SEPARATOR","\\",194],["T_STRING","Drupal",194],["T_DOUBLE_COLON","::",194],["T_STRING","state",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","delete",194],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test.no_access_uid'",194],")",";",["T_WHITESPACE","\n  ",194],"}",["T_WHITESPACE","\n\n",195],"}",["T_WHITESPACE","\n",197]]