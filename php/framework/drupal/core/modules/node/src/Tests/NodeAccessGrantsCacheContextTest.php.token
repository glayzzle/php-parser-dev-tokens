[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","node",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests the node access grants cache context service.\n *\n * @group node\n * @group Cache\n *\/",5],["T_WHITESPACE","\n",10],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","NodeAccessGrantsCacheContextTest",11],["T_WHITESPACE"," ",11],["T_EXTENDS","extends",11],["T_WHITESPACE"," ",11],["T_STRING","NodeTestBase",11],["T_WHITESPACE"," ",11],"{",["T_WHITESPACE","\n\n  ",11],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",13],["T_WHITESPACE","\n  ",17],["T_PUBLIC","public",18],["T_WHITESPACE"," ",18],["T_STATIC","static",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$modules",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test'",18],")",";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * User with permission to view content.\n   *\/",20],["T_WHITESPACE","\n  ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$accessUser",23],";",["T_WHITESPACE","\n\n  ",23],["T_DOC_COMMENT","\/**\n   * User without permission to view content.\n   *\/",25],["T_WHITESPACE","\n  ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$noAccessUser",28],";",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",30],["T_WHITESPACE","\n  ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","setUp",33],"(",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n    ",33],["T_STRING","parent",34],["T_DOUBLE_COLON","::",34],["T_STRING","setUp",34],"(",")",";",["T_WHITESPACE","\n\n    ",34],["T_STRING","node_access_rebuild",36],"(",")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Create some content.\n",38],["T_WHITESPACE","    ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","drupalCreateNode",39],"(",")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","drupalCreateNode",40],"(",")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","drupalCreateNode",41],"(",")",";",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","drupalCreateNode",42],"(",")",";",["T_WHITESPACE","\n\n    ",42],["T_COMMENT","\/\/ Create user with simple node access permission. The 'node test view'\n",44],["T_WHITESPACE","    ",45],["T_COMMENT","\/\/ permission is implemented and granted by the node_access_test module.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","accessUser",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","drupalCreateUser",46],"(",["T_ARRAY","array",46],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",46],",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'access content'",46],",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'node test view'",46],")",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","noAccessUser",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","drupalCreateUser",47],"(",["T_ARRAY","array",47],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'access content'",47],")",")",";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","noAccessUser2",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","drupalCreateUser",48],"(",["T_ARRAY","array",48],"(",["T_CONSTANT_ENCAPSED_STRING","'access content overview'",48],",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'access content'",48],")",")",";",["T_WHITESPACE","\n\n    ",48],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","userMapping",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],"[",["T_WHITESPACE","\n      ",50],["T_LNUMBER","1",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","rootUser",51],",",["T_WHITESPACE","\n      ",51],["T_LNUMBER","2",52],["T_WHITESPACE"," ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","accessUser",52],",",["T_WHITESPACE","\n      ",52],["T_LNUMBER","3",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","noAccessUser",53],",",["T_WHITESPACE","\n    ",53],"]",";",["T_WHITESPACE","\n  ",54],"}",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * Asserts that for each given user, the expected cache context is returned.\n   *\n   * @param array $expected\n   *   Expected values, keyed by user ID, expected cache contexts as values.\n   *\/",57],["T_WHITESPACE","\n  ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","assertUserCacheContext",63],"(",["T_ARRAY","array",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$expected",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n    ",63],["T_FOREACH","foreach",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$expected",64],["T_WHITESPACE"," ",64],["T_AS","as",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$uid",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$context",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n      ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$uid",65],["T_WHITESPACE"," ",65],">",["T_WHITESPACE"," ",65],["T_LNUMBER","0",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","drupalLogin",66],"(",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","userMapping",66],"[",["T_VARIABLE","$uid",66],"]",")",";",["T_WHITESPACE","\n      ",66],"}",["T_WHITESPACE","\n      ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","pass",68],"(",["T_CONSTANT_ENCAPSED_STRING","'Asserting cache context for user '",68],["T_WHITESPACE"," ",68],".",["T_WHITESPACE"," ",68],["T_VARIABLE","$uid",68],["T_WHITESPACE"," ",68],".",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'.'",68],")",";",["T_WHITESPACE","\n      ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertIdentical",69],"(",["T_VARIABLE","$context",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","container",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_CONSTANT_ENCAPSED_STRING","'cache_context.user.node_grants'",69],")",["T_OBJECT_OPERATOR","->",69],["T_STRING","getContext",69],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",69],")",")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","drupalLogout",71],"(",")",";",["T_WHITESPACE","\n  ",71],"}",["T_WHITESPACE","\n\n  ",72],["T_DOC_COMMENT","\/**\n   * Tests NodeAccessGrantsCacheContext::getContext().\n   *\/",74],["T_WHITESPACE","\n  ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","testCacheContext",77],"(",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertUserCacheContext",78],"(","[",["T_WHITESPACE","\n      ",78],["T_LNUMBER","0",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:0;node_access_all:0'",79],",",["T_WHITESPACE","\n      ",79],["T_LNUMBER","1",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'all'",80],",",["T_WHITESPACE","\n      ",80],["T_LNUMBER","2",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:2;node_access_test:8888,8889'",81],",",["T_WHITESPACE","\n      ",81],["T_LNUMBER","3",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:3'",82],",",["T_WHITESPACE","\n    ",82],"]",")",";",["T_WHITESPACE","\n\n    ",83],["T_COMMENT","\/\/ Grant view to all nodes (because nid = 0) for users in the\n",85],["T_WHITESPACE","    ",86],["T_COMMENT","\/\/ 'node_access_all' realm.\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$record",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_ARRAY","array",87],"(",["T_WHITESPACE","\n      ",87],["T_CONSTANT_ENCAPSED_STRING","'nid'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_LNUMBER","0",88],",",["T_WHITESPACE","\n      ",88],["T_CONSTANT_ENCAPSED_STRING","'gid'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_LNUMBER","0",89],",",["T_WHITESPACE","\n      ",89],["T_CONSTANT_ENCAPSED_STRING","'realm'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'node_access_all'",90],",",["T_WHITESPACE","\n      ",90],["T_CONSTANT_ENCAPSED_STRING","'grant_view'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_LNUMBER","1",91],",",["T_WHITESPACE","\n      ",91],["T_CONSTANT_ENCAPSED_STRING","'grant_update'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_LNUMBER","0",92],",",["T_WHITESPACE","\n      ",92],["T_CONSTANT_ENCAPSED_STRING","'grant_delete'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_LNUMBER","0",93],",",["T_WHITESPACE","\n    ",93],")",";",["T_WHITESPACE","\n    ",94],["T_STRING","db_insert",95],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",95],")",["T_OBJECT_OPERATOR","->",95],["T_STRING","fields",95],"(",["T_VARIABLE","$record",95],")",["T_OBJECT_OPERATOR","->",95],["T_STRING","execute",95],"(",")",";",["T_WHITESPACE","\n\n    ",95],["T_COMMENT","\/\/ Put user accessUser (uid 0) in the realm.\n",97],["T_WHITESPACE","    ",98],["T_NS_SEPARATOR","\\",98],["T_STRING","Drupal",98],["T_DOUBLE_COLON","::",98],["T_STRING","state",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","set",98],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test.no_access_uid'",98],",",["T_WHITESPACE"," ",98],["T_LNUMBER","0",98],")",";",["T_WHITESPACE","\n    ",98],["T_STRING","drupal_static_reset",99],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",99],")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","assertUserCacheContext",100],"(","[",["T_WHITESPACE","\n      ",100],["T_LNUMBER","0",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'view.all'",101],",",["T_WHITESPACE","\n      ",101],["T_LNUMBER","1",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","'all'",102],",",["T_WHITESPACE","\n      ",102],["T_LNUMBER","2",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:2;node_access_test:8888,8889'",103],",",["T_WHITESPACE","\n      ",103],["T_LNUMBER","3",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:3'",104],",",["T_WHITESPACE","\n    ",104],"]",")",";",["T_WHITESPACE","\n\n    ",105],["T_COMMENT","\/\/ Put user accessUser (uid 2) in the realm.\n",107],["T_WHITESPACE","    ",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Drupal",108],["T_DOUBLE_COLON","::",108],["T_STRING","state",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","set",108],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test.no_access_uid'",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","accessUser",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","id",108],"(",")",")",";",["T_WHITESPACE","\n    ",108],["T_STRING","drupal_static_reset",109],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",109],")",";",["T_WHITESPACE","\n    ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","assertUserCacheContext",110],"(","[",["T_WHITESPACE","\n      ",110],["T_LNUMBER","0",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:0'",111],",",["T_WHITESPACE","\n      ",111],["T_LNUMBER","1",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'all'",112],",",["T_WHITESPACE","\n      ",112],["T_LNUMBER","2",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'view.all'",113],",",["T_WHITESPACE","\n      ",113],["T_LNUMBER","3",114],["T_WHITESPACE"," ",114],["T_DOUBLE_ARROW","=>",114],["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:3'",114],",",["T_WHITESPACE","\n    ",114],"]",")",";",["T_WHITESPACE","\n\n    ",115],["T_COMMENT","\/\/ Put user noAccessUser (uid 3) in the realm.\n",117],["T_WHITESPACE","    ",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Drupal",118],["T_DOUBLE_COLON","::",118],["T_STRING","state",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","set",118],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_test.no_access_uid'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","noAccessUser",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","id",118],"(",")",")",";",["T_WHITESPACE","\n    ",118],["T_STRING","drupal_static_reset",119],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",119],")",";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","assertUserCacheContext",120],"(","[",["T_WHITESPACE","\n      ",120],["T_LNUMBER","0",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:0'",121],",",["T_WHITESPACE","\n      ",121],["T_LNUMBER","1",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'all'",122],",",["T_WHITESPACE","\n      ",122],["T_LNUMBER","2",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'view.all:0;node_access_test_author:2;node_access_test:8888,8889'",123],",",["T_WHITESPACE","\n      ",123],["T_LNUMBER","3",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_CONSTANT_ENCAPSED_STRING","'view.all'",124],",",["T_WHITESPACE","\n    ",124],"]",")",";",["T_WHITESPACE","\n\n    ",125],["T_COMMENT","\/\/ Uninstall the node_access_test module\n",127],["T_WHITESPACE","    ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","container",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","get",128],"(",["T_CONSTANT_ENCAPSED_STRING","'module_installer'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","uninstall",128],"(","[",["T_CONSTANT_ENCAPSED_STRING","'node_access_test'",128],"]",")",";",["T_WHITESPACE","\n    ",128],["T_STRING","drupal_static_reset",129],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access_view_all_nodes'",129],")",";",["T_WHITESPACE","\n    ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","assertUserCacheContext",130],"(","[",["T_WHITESPACE","\n      ",130],["T_LNUMBER","0",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'view.all'",131],",",["T_WHITESPACE","\n      ",131],["T_LNUMBER","1",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'all'",132],",",["T_WHITESPACE","\n      ",132],["T_LNUMBER","2",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'view.all'",133],",",["T_WHITESPACE","\n      ",133],["T_LNUMBER","3",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'view.all'",134],",",["T_WHITESPACE","\n    ",134],"]",")",";",["T_WHITESPACE","\n  ",135],"}",["T_WHITESPACE","\n\n",136],"}",["T_WHITESPACE","\n",138]]