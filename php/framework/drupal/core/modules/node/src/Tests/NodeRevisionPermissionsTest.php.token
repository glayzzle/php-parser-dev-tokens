[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","node",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests user permissions for node revisions.\n *\n * @group node\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","NodeRevisionPermissionsTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","NodeTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * The node revisions.\n   *\n   * @var array\n   *\/",12],["T_WHITESPACE","\n  ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$nodeRevisions",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],"[","]",";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * The accounts.\n   *\n   * @var array\n   *\/",19],["T_WHITESPACE","\n  ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$accounts",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_ARRAY","array",24],"(",")",";",["T_WHITESPACE","\n\n  ",24],["T_COMMENT","\/\/ Map revision permission names to node revision access ops.\n",26],["T_WHITESPACE","  ",27],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$map",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_ARRAY","array",27],"(",["T_WHITESPACE","\n    ",27],["T_CONSTANT_ENCAPSED_STRING","'view'",28],["T_WHITESPACE"," ",28],["T_DOUBLE_ARROW","=>",28],["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'view all revisions'",28],",",["T_WHITESPACE","\n    ",28],["T_CONSTANT_ENCAPSED_STRING","'update'",29],["T_WHITESPACE"," ",29],["T_DOUBLE_ARROW","=>",29],["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'revert all revisions'",29],",",["T_WHITESPACE","\n    ",29],["T_CONSTANT_ENCAPSED_STRING","'delete'",30],["T_WHITESPACE"," ",30],["T_DOUBLE_ARROW","=>",30],["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'delete all revisions'",30],",",["T_WHITESPACE","\n  ",30],")",";",["T_WHITESPACE","\n\n  ",31],["T_COMMENT","\/\/ Map revision permission names to node type revision access ops.\n",33],["T_WHITESPACE","  ",34],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$typeMap",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_ARRAY","array",34],"(",["T_WHITESPACE","\n    ",34],["T_CONSTANT_ENCAPSED_STRING","'view'",35],["T_WHITESPACE"," ",35],["T_DOUBLE_ARROW","=>",35],["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'view page revisions'",35],",",["T_WHITESPACE","\n    ",35],["T_CONSTANT_ENCAPSED_STRING","'update'",36],["T_WHITESPACE"," ",36],["T_DOUBLE_ARROW","=>",36],["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'revert page revisions'",36],",",["T_WHITESPACE","\n    ",36],["T_CONSTANT_ENCAPSED_STRING","'delete'",37],["T_WHITESPACE"," ",37],["T_DOUBLE_ARROW","=>",37],["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'delete page revisions'",37],",",["T_WHITESPACE","\n  ",37],")",";",["T_WHITESPACE","\n\n  ",38],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","setUp",40],"(",")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n    ",40],["T_STRING","parent",41],["T_DOUBLE_COLON","::",41],["T_STRING","setUp",41],"(",")",";",["T_WHITESPACE","\n\n    ",41],["T_VARIABLE","$types",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_ARRAY","array",43],"(",["T_CONSTANT_ENCAPSED_STRING","'page'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'article'",43],")",";",["T_WHITESPACE","\n\n    ",43],["T_FOREACH","foreach",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$types",45],["T_WHITESPACE"," ",45],["T_AS","as",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$type",45],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n      ",45],["T_COMMENT","\/\/ Create a node with several revisions.\n",46],["T_WHITESPACE","      ",47],["T_VARIABLE","$nodes",47],"[",["T_VARIABLE","$type",47],"]",["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","drupalCreateNode",47],"(",["T_ARRAY","array",47],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$type",47],")",")",";",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","nodeRevisions",48],"[",["T_VARIABLE","$type",48],"]","[","]",["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$nodes",48],"[",["T_VARIABLE","$type",48],"]",";",["T_WHITESPACE","\n\n      ",48],["T_FOR","for",50],["T_WHITESPACE"," ",50],"(",["T_VARIABLE","$i",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_LNUMBER","0",50],";",["T_WHITESPACE"," ",50],["T_VARIABLE","$i",50],["T_WHITESPACE"," ",50],"<",["T_WHITESPACE"," ",50],["T_LNUMBER","3",50],";",["T_WHITESPACE"," ",50],["T_VARIABLE","$i",50],["T_INC","++",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n        ",50],["T_COMMENT","\/\/ Create a revision for the same nid and settings with a random log.\n",51],["T_WHITESPACE","        ",52],["T_VARIABLE","$revision",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_CLONE","clone",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$nodes",52],"[",["T_VARIABLE","$type",52],"]",";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$revision",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","setNewRevision",53],"(",")",";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$revision",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","revision_log",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","randomMachineName",54],"(",["T_LNUMBER","32",54],")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$revision",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","save",55],"(",")",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","nodeRevisions",56],"[",["T_VARIABLE","$type",56],"]","[","]",["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$revision",56],";",["T_WHITESPACE","\n      ",56],"}",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n  ",58],"}",["T_WHITESPACE","\n\n  ",59],["T_DOC_COMMENT","\/**\n   * Tests general revision access permissions.\n   *\/",61],["T_WHITESPACE","\n  ",63],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","testNodeRevisionAccessAnyType",64],"(",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n    ",64],["T_COMMENT","\/\/ Create three users, one with each revision permission.\n",65],["T_WHITESPACE","    ",66],["T_FOREACH","foreach",66],["T_WHITESPACE"," ",66],"(",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","map",66],["T_WHITESPACE"," ",66],["T_AS","as",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$op",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$permission",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n      ",66],["T_COMMENT","\/\/ Create the user.\n",67],["T_WHITESPACE","      ",68],["T_VARIABLE","$account",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","drupalCreateUser",68],"(",["T_WHITESPACE","\n        ",68],["T_ARRAY","array",69],"(",["T_WHITESPACE","\n          ",69],["T_CONSTANT_ENCAPSED_STRING","'access content'",70],",",["T_WHITESPACE","\n          ",70],["T_CONSTANT_ENCAPSED_STRING","'edit any page content'",71],",",["T_WHITESPACE","\n          ",71],["T_CONSTANT_ENCAPSED_STRING","'delete any page content'",72],",",["T_WHITESPACE","\n          ",72],["T_VARIABLE","$permission",73],",",["T_WHITESPACE","\n        ",73],")",["T_WHITESPACE","\n      ",74],")",";",["T_WHITESPACE","\n      ",75],["T_VARIABLE","$account",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","op",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$op",76],";",["T_WHITESPACE","\n      ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","accounts",77],"[","]",["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$account",77],";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_COMMENT","\/\/ Create an admin account (returns TRUE for all revision permissions).\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$admin_account",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","drupalCreateUser",81],"(",["T_ARRAY","array",81],"(",["T_CONSTANT_ENCAPSED_STRING","'access content'",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'administer nodes'",81],")",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$admin_account",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","is_admin",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","TRUE",82],";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","accounts",83],"[",["T_CONSTANT_ENCAPSED_STRING","'admin'",83],"]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$admin_account",83],";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$accounts",84],"[",["T_CONSTANT_ENCAPSED_STRING","'admin'",84],"]",["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$admin_account",84],";",["T_WHITESPACE","\n\n    ",84],["T_COMMENT","\/\/ Create a normal account (returns FALSE for all revision permissions).\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$normal_account",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","drupalCreateUser",87],"(",")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$normal_account",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","op",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","FALSE",88],";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","accounts",89],"[","]",["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$normal_account",89],";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$accounts",90],"[","]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$normal_account",90],";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$revision",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","nodeRevisions",91],"[",["T_CONSTANT_ENCAPSED_STRING","'page'",91],"]","[",["T_LNUMBER","1",91],"]",";",["T_WHITESPACE","\n\n    ",91],["T_VARIABLE","$parameters",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_ARRAY","array",93],"(",["T_WHITESPACE","\n      ",93],["T_CONSTANT_ENCAPSED_STRING","'op'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_STRING","array_keys",94],"(",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","map",94],")",",",["T_WHITESPACE","\n      ",94],["T_CONSTANT_ENCAPSED_STRING","'account'",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","accounts",95],",",["T_WHITESPACE","\n    ",95],")",";",["T_WHITESPACE","\n\n    ",96],["T_VARIABLE","$permutations",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","generatePermutations",98],"(",["T_VARIABLE","$parameters",98],")",";",["T_WHITESPACE","\n\n    ",98],["T_VARIABLE","$node_revision_access",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_NS_SEPARATOR","\\",100],["T_STRING","Drupal",100],["T_DOUBLE_COLON","::",100],["T_STRING","service",100],"(",["T_CONSTANT_ENCAPSED_STRING","'access_check.node.revision'",100],")",";",["T_WHITESPACE","\n    ",100],["T_FOREACH","foreach",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$permutations",101],["T_WHITESPACE"," ",101],["T_AS","as",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$case",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n      ",101],["T_COMMENT","\/\/ Skip this test if there are no revisions for the node.\n",102],["T_WHITESPACE","      ",103],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!","(",["T_VARIABLE","$revision",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","isDefaultRevision",103],"(",")",["T_WHITESPACE"," ",103],["T_BOOLEAN_AND","&&",103],["T_WHITESPACE"," ",103],"(",["T_STRING","db_query",103],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(vid) FROM {node_field_revision} WHERE nid = :nid'",103],",",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","':nid'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$revision",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","id",103],"(",")",")",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","fetchField",103],"(",")",["T_WHITESPACE"," ",103],["T_IS_EQUAL","==",103],["T_WHITESPACE"," ",103],["T_LNUMBER","1",103],["T_WHITESPACE"," ",103],["T_BOOLEAN_OR","||",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$case",103],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",103],"]",["T_WHITESPACE"," ",103],["T_IS_EQUAL","==",103],["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'update'",103],["T_WHITESPACE"," ",103],["T_BOOLEAN_OR","||",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$case",103],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",103],"]",["T_WHITESPACE"," ",103],["T_IS_EQUAL","==",103],["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'delete'",103],")",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_EMPTY","empty",104],"(",["T_VARIABLE","$case",104],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",104],"]",["T_OBJECT_OPERATOR","->",104],["T_STRING","is_admin",104],")",["T_WHITESPACE"," ",104],["T_BOOLEAN_OR","||",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$case",104],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",104],"]",["T_OBJECT_OPERATOR","->",104],["T_STRING","hasPermission",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","map",104],"[",["T_VARIABLE","$case",104],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",104],"]","]",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n          ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","assertTrue",105],"(",["T_VARIABLE","$node_revision_access",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","checkAccess",105],"(",["T_VARIABLE","$revision",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$case",105],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",105],"]",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$case",105],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",105],"]",")",",",["T_WHITESPACE"," ",105],"\"",["T_CURLY_OPEN","{",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","map",105],"[",["T_VARIABLE","$case",105],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",105],"]","]","}",["T_ENCAPSED_AND_WHITESPACE"," granted.",105],"\"",")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n        ",106],["T_ELSE","else",107],["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n          ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","assertFalse",108],"(",["T_VARIABLE","$node_revision_access",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","checkAccess",108],"(",["T_VARIABLE","$revision",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$case",108],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",108],"]",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$case",108],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",108],"]",")",",",["T_WHITESPACE"," ",108],"\"",["T_CURLY_OPEN","{",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","map",108],"[",["T_VARIABLE","$case",108],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",108],"]","]","}",["T_ENCAPSED_AND_WHITESPACE"," not granted.",108],"\"",")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n      ",109],"}",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_COMMENT","\/\/ Test that access is FALSE for a node administrator with an invalid $node\n",113],["T_WHITESPACE","    ",114],["T_COMMENT","\/\/ or $op parameters.\n",114],["T_WHITESPACE","    ",115],["T_VARIABLE","$admin_account",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$accounts",115],"[",["T_CONSTANT_ENCAPSED_STRING","'admin'",115],"]",";",["T_WHITESPACE","\n    ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","assertFalse",116],"(",["T_VARIABLE","$node_revision_access",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","checkAccess",116],"(",["T_VARIABLE","$revision",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$admin_account",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'invalid-op'",116],")",",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'NodeRevisionAccessCheck() returns FALSE with an invalid op.'",116],")",";",["T_WHITESPACE","\n  ",116],"}",["T_WHITESPACE","\n\n  ",117],["T_DOC_COMMENT","\/**\n   * Tests revision access permissions for a specific content type.\n   *\/",119],["T_WHITESPACE","\n  ",121],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","testNodeRevisionAccessPerType",122],"(",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n    ",122],["T_COMMENT","\/\/ Create three users, one with each revision permission.\n",123],["T_WHITESPACE","    ",124],["T_FOREACH","foreach",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","typeMap",124],["T_WHITESPACE"," ",124],["T_AS","as",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$op",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$permission",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n      ",124],["T_COMMENT","\/\/ Create the user.\n",125],["T_WHITESPACE","      ",126],["T_VARIABLE","$account",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","drupalCreateUser",126],"(",["T_WHITESPACE","\n        ",126],["T_ARRAY","array",127],"(",["T_WHITESPACE","\n          ",127],["T_CONSTANT_ENCAPSED_STRING","'access content'",128],",",["T_WHITESPACE","\n          ",128],["T_CONSTANT_ENCAPSED_STRING","'edit any page content'",129],",",["T_WHITESPACE","\n          ",129],["T_CONSTANT_ENCAPSED_STRING","'delete any page content'",130],",",["T_WHITESPACE","\n          ",130],["T_VARIABLE","$permission",131],",",["T_WHITESPACE","\n        ",131],")",["T_WHITESPACE","\n      ",132],")",";",["T_WHITESPACE","\n      ",133],["T_VARIABLE","$account",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","op",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$op",134],";",["T_WHITESPACE","\n      ",134],["T_VARIABLE","$accounts",135],"[","]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$account",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_VARIABLE","$parameters",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_ARRAY","array",138],"(",["T_WHITESPACE","\n      ",138],["T_CONSTANT_ENCAPSED_STRING","'op'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_STRING","array_keys",139],"(",["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","typeMap",139],")",",",["T_WHITESPACE","\n      ",139],["T_CONSTANT_ENCAPSED_STRING","'account'",140],["T_WHITESPACE"," ",140],["T_DOUBLE_ARROW","=>",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$accounts",140],",",["T_WHITESPACE","\n    ",140],")",";",["T_WHITESPACE","\n\n    ",141],["T_COMMENT","\/\/ Test that the accounts have access to the corresponding page revision\n",143],["T_WHITESPACE","    ",144],["T_COMMENT","\/\/ permissions.\n",144],["T_WHITESPACE","    ",145],["T_VARIABLE","$revision",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","nodeRevisions",145],"[",["T_CONSTANT_ENCAPSED_STRING","'page'",145],"]","[",["T_LNUMBER","1",145],"]",";",["T_WHITESPACE","\n\n    ",145],["T_VARIABLE","$permutations",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","generatePermutations",147],"(",["T_VARIABLE","$parameters",147],")",";",["T_WHITESPACE","\n    ",147],["T_VARIABLE","$node_revision_access",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_NS_SEPARATOR","\\",148],["T_STRING","Drupal",148],["T_DOUBLE_COLON","::",148],["T_STRING","service",148],"(",["T_CONSTANT_ENCAPSED_STRING","'access_check.node.revision'",148],")",";",["T_WHITESPACE","\n    ",148],["T_FOREACH","foreach",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$permutations",149],["T_WHITESPACE"," ",149],["T_AS","as",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$case",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n      ",149],["T_COMMENT","\/\/ Skip this test if there are no revisions for the node.\n",150],["T_WHITESPACE","      ",151],["T_IF","if",151],["T_WHITESPACE"," ",151],"(","!","(",["T_VARIABLE","$revision",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","isDefaultRevision",151],"(",")",["T_WHITESPACE"," ",151],["T_BOOLEAN_AND","&&",151],["T_WHITESPACE"," ",151],"(",["T_STRING","db_query",151],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(vid) FROM {node_field_revision} WHERE nid = :nid'",151],",",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","':nid'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$revision",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","id",151],"(",")",")",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","fetchField",151],"(",")",["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_LNUMBER","1",151],["T_WHITESPACE"," ",151],["T_BOOLEAN_OR","||",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$case",151],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",151],"]",["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'update'",151],["T_WHITESPACE"," ",151],["T_BOOLEAN_OR","||",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$case",151],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",151],"]",["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'delete'",151],")",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","!",["T_EMPTY","empty",152],"(",["T_VARIABLE","$case",152],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",152],"]",["T_OBJECT_OPERATOR","->",152],["T_STRING","is_admin",152],")",["T_WHITESPACE"," ",152],["T_BOOLEAN_OR","||",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$case",152],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",152],"]",["T_OBJECT_OPERATOR","->",152],["T_STRING","hasPermission",152],"(",["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","typeMap",152],"[",["T_VARIABLE","$case",152],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",152],"]","]",",",["T_WHITESPACE"," ",152],["T_VARIABLE","$case",152],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",152],"]",")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n          ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","assertTrue",153],"(",["T_VARIABLE","$node_revision_access",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","checkAccess",153],"(",["T_VARIABLE","$revision",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$case",153],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",153],"]",",",["T_WHITESPACE"," ",153],["T_VARIABLE","$case",153],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",153],"]",")",",",["T_WHITESPACE"," ",153],"\"",["T_CURLY_OPEN","{",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","typeMap",153],"[",["T_VARIABLE","$case",153],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",153],"]","]","}",["T_ENCAPSED_AND_WHITESPACE"," granted.",153],"\"",")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n        ",154],["T_ELSE","else",155],["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n          ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","assertFalse",156],"(",["T_VARIABLE","$node_revision_access",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","checkAccess",156],"(",["T_VARIABLE","$revision",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$case",156],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",156],"]",",",["T_WHITESPACE"," ",156],["T_VARIABLE","$case",156],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",156],"]",")",",",["T_WHITESPACE"," ",156],"\"",["T_CURLY_OPEN","{",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","typeMap",156],"[",["T_VARIABLE","$case",156],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",156],"]","]","}",["T_ENCAPSED_AND_WHITESPACE"," not granted.",156],"\"",")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n      ",157],"}",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_COMMENT","\/\/ Test that the accounts have no access to the article revisions.\n",161],["T_WHITESPACE","    ",162],["T_VARIABLE","$revision",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","nodeRevisions",162],"[",["T_CONSTANT_ENCAPSED_STRING","'article'",162],"]","[",["T_LNUMBER","1",162],"]",";",["T_WHITESPACE","\n\n    ",162],["T_FOREACH","foreach",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$permutations",164],["T_WHITESPACE"," ",164],["T_AS","as",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$case",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n      ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","assertFalse",165],"(",["T_VARIABLE","$node_revision_access",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","checkAccess",165],"(",["T_VARIABLE","$revision",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$case",165],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",165],"]",",",["T_WHITESPACE"," ",165],["T_VARIABLE","$case",165],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",165],"]",")",",",["T_WHITESPACE"," ",165],"\"",["T_CURLY_OPEN","{",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","typeMap",165],"[",["T_VARIABLE","$case",165],"[",["T_CONSTANT_ENCAPSED_STRING","'op'",165],"]","]","}",["T_ENCAPSED_AND_WHITESPACE"," did not grant revision permission for articles.",165],"\"",")",";",["T_WHITESPACE","\n    ",165],"}",["T_WHITESPACE","\n  ",166],"}",["T_WHITESPACE","\n\n",167],"}",["T_WHITESPACE","\n",169]]