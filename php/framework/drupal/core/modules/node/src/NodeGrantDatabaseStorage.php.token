[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","node",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Access",5],["T_NS_SEPARATOR","\\",5],["T_STRING","AccessResult",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Connection",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Query",7],["T_NS_SEPARATOR","\\",7],["T_STRING","SelectInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Database",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Query",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Condition",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Extension",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ModuleHandlerInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Language",10],["T_NS_SEPARATOR","\\",10],["T_STRING","LanguageManagerInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Session",11],["T_NS_SEPARATOR","\\",11],["T_STRING","AccountInterface",11],";",["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Defines a storage handler class that handles the node grants system.\n *\n * This is used to build node query access.\n *\n * @ingroup node_access\n *\/",13],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","NodeGrantDatabaseStorage",20],["T_WHITESPACE"," ",20],["T_IMPLEMENTS","implements",20],["T_WHITESPACE"," ",20],["T_STRING","NodeGrantDatabaseStorageInterface",20],["T_WHITESPACE"," ",20],"{",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$database",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * The module handler.\n   *\n   * @var \\Drupal\\Core\\Extension\\ModuleHandlerInterface\n   *\/",29],["T_WHITESPACE","\n  ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$moduleHandler",34],";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   *\/",36],["T_WHITESPACE","\n  ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$languageManager",41],";",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * Constructs a NodeGrantDatabaseStorage object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $database\n   *   The database connection.\n   * @param \\Drupal\\Core\\Extension\\ModuleHandlerInterface $module_handler\n   *   The module handler.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   *\/",43],["T_WHITESPACE","\n  ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","__construct",53],"(",["T_STRING","Connection",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$database",53],",",["T_WHITESPACE"," ",53],["T_STRING","ModuleHandlerInterface",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$module_handler",53],",",["T_WHITESPACE"," ",53],["T_STRING","LanguageManagerInterface",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$language_manager",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","database",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$database",54],";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","moduleHandler",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$module_handler",55],";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","languageManager",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$language_manager",56],";",["T_WHITESPACE","\n  ",56],"}",["T_WHITESPACE","\n\n  ",57],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",59],["T_WHITESPACE","\n  ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","access",62],"(",["T_STRING","NodeInterface",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$node",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$operation",62],",",["T_WHITESPACE"," ",62],["T_STRING","AccountInterface",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$account",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n    ",62],["T_COMMENT","\/\/ Grants only support these operations.\n",63],["T_WHITESPACE","    ",64],["T_IF","if",64],["T_WHITESPACE"," ",64],"(","!",["T_STRING","in_array",64],"(",["T_VARIABLE","$operation",64],",",["T_WHITESPACE"," ",64],"[",["T_CONSTANT_ENCAPSED_STRING","'view'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'update'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'delete'",64],"]",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n      ",64],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_STRING","AccessResult",65],["T_DOUBLE_COLON","::",65],["T_STRING","neutral",65],"(",")",";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_COMMENT","\/\/ If no module implements the hook or the node does not have an id there is\n",68],["T_WHITESPACE","    ",69],["T_COMMENT","\/\/ no point in querying the database for access grants.\n",69],["T_WHITESPACE","    ",70],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","moduleHandler",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getImplementations",70],"(",["T_CONSTANT_ENCAPSED_STRING","'node_grants'",70],")",["T_WHITESPACE"," ",70],["T_BOOLEAN_OR","||",70],["T_WHITESPACE"," ",70],"!",["T_VARIABLE","$node",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","id",70],"(",")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n      ",70],["T_COMMENT","\/\/ Return the equivalent of the default grant, defined by\n",71],["T_WHITESPACE","      ",72],["T_COMMENT","\/\/ self::writeDefault().\n",72],["T_WHITESPACE","      ",73],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$operation",73],["T_WHITESPACE"," ",73],["T_IS_IDENTICAL","===",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'view'",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n        ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_STRING","AccessResult",74],["T_DOUBLE_COLON","::",74],["T_STRING","allowedIf",74],"(",["T_VARIABLE","$node",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","isPublished",74],"(",")",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","addCacheableDependency",74],"(",["T_VARIABLE","$node",74],")",";",["T_WHITESPACE","\n      ",74],"}",["T_WHITESPACE","\n      ",75],["T_ELSE","else",76],["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n        ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","AccessResult",77],["T_DOUBLE_COLON","::",77],["T_STRING","neutral",77],"(",")",";",["T_WHITESPACE","\n      ",77],"}",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_COMMENT","\/\/ Check the database for potential access grants.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$query",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","database",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","select",82],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$query",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","addExpression",83],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",83],")",";",["T_WHITESPACE","\n    ",83],["T_COMMENT","\/\/ Only interested for granting in the current operation.\n",84],["T_WHITESPACE","    ",85],["T_VARIABLE","$query",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","condition",85],"(",["T_CONSTANT_ENCAPSED_STRING","'grant_'",85],["T_WHITESPACE"," ",85],".",["T_WHITESPACE"," ",85],["T_VARIABLE","$operation",85],",",["T_WHITESPACE"," ",85],["T_LNUMBER","1",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'>='",85],")",";",["T_WHITESPACE","\n    ",85],["T_COMMENT","\/\/ Check for grants for this node and the correct langcode.\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$nids",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$query",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","andConditionGroup",87],"(",")",["T_WHITESPACE","\n      ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","condition",88],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$node",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","id",88],"(",")",")",["T_WHITESPACE","\n      ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","condition",89],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$node",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","language",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","getId",89],"(",")",")",";",["T_WHITESPACE","\n    ",89],["T_COMMENT","\/\/ If the node is published, also take the default grant into account. The\n",90],["T_WHITESPACE","    ",91],["T_COMMENT","\/\/ default is saved with a node ID of 0.\n",91],["T_WHITESPACE","    ",92],["T_VARIABLE","$status",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$node",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","isPublished",92],"(",")",";",["T_WHITESPACE","\n    ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$status",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n      ",93],["T_VARIABLE","$nids",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$query",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","orConditionGroup",94],"(",")",["T_WHITESPACE","\n        ",94],["T_OBJECT_OPERATOR","->",95],["T_STRING","condition",95],"(",["T_VARIABLE","$nids",95],")",["T_WHITESPACE","\n        ",95],["T_OBJECT_OPERATOR","->",96],["T_STRING","condition",96],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",96],",",["T_WHITESPACE"," ",96],["T_LNUMBER","0",96],")",";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$query",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","condition",98],"(",["T_VARIABLE","$nids",98],")",";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$query",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","range",99],"(",["T_LNUMBER","0",99],",",["T_WHITESPACE"," ",99],["T_LNUMBER","1",99],")",";",["T_WHITESPACE","\n\n    ",99],["T_VARIABLE","$grants",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STATIC","static",101],["T_DOUBLE_COLON","::",101],["T_STRING","buildGrantsQueryCondition",101],"(",["T_STRING","node_access_grants",101],"(",["T_VARIABLE","$operation",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$account",101],")",")",";",["T_WHITESPACE","\n\n    ",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_STRING","count",103],"(",["T_VARIABLE","$grants",103],")",["T_WHITESPACE"," ",103],">",["T_WHITESPACE"," ",103],["T_LNUMBER","0",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n      ",103],["T_VARIABLE","$query",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","condition",104],"(",["T_VARIABLE","$grants",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_COMMENT","\/\/ Only the 'view' node grant can currently be cached; the others currently\n",107],["T_WHITESPACE","    ",108],["T_COMMENT","\/\/ don't have any cacheability metadata. Hopefully, we can add that in the\n",108],["T_WHITESPACE","    ",109],["T_COMMENT","\/\/ future, which would allow this access check result to be cacheable in all\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ cases. For now, this must remain marked as uncacheable, even when it is\n",110],["T_WHITESPACE","    ",111],["T_COMMENT","\/\/ theoretically cacheable, because we don't have the necessary metadata to\n",111],["T_WHITESPACE","    ",112],["T_COMMENT","\/\/ know it for a fact.\n",112],["T_WHITESPACE","    ",113],["T_VARIABLE","$set_cacheability",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],"(",["T_STRING","AccessResult",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$access_result",113],")",["T_WHITESPACE"," ",113],["T_USE","use",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$operation",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n      ",113],["T_VARIABLE","$access_result",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","addCacheContexts",114],"(","[",["T_CONSTANT_ENCAPSED_STRING","'user.node_grants:'",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_VARIABLE","$operation",114],"]",")",";",["T_WHITESPACE","\n      ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$operation",115],["T_WHITESPACE"," ",115],["T_IS_NOT_IDENTICAL","!==",115],["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'view'",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$access_result",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setCacheMaxAge",116],"(",["T_LNUMBER","0",116],")",";",["T_WHITESPACE","\n      ",116],"}",["T_WHITESPACE","\n      ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$access_result",118],";",["T_WHITESPACE","\n    ",118],"}",";",["T_WHITESPACE","\n\n    ",119],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$query",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","execute",121],"(",")",["T_OBJECT_OPERATOR","->",121],["T_STRING","fetchField",121],"(",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n      ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$set_cacheability",122],"(",["T_STRING","AccessResult",122],["T_DOUBLE_COLON","::",122],["T_STRING","allowed",122],"(",")",")",";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n    ",123],["T_ELSE","else",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n      ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$set_cacheability",125],"(",["T_STRING","AccessResult",125],["T_DOUBLE_COLON","::",125],["T_STRING","neutral",125],"(",")",")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n  ",126],"}",["T_WHITESPACE","\n\n  ",127],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",129],["T_WHITESPACE","\n  ",131],["T_PUBLIC","public",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","checkAll",132],"(",["T_STRING","AccountInterface",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$account",132],")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n    ",132],["T_VARIABLE","$query",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","database",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","select",133],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",133],")",";",["T_WHITESPACE","\n    ",133],["T_VARIABLE","$query",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","addExpression",134],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",134],")",";",["T_WHITESPACE","\n    ",134],["T_VARIABLE","$query",135],["T_WHITESPACE","\n      ",135],["T_OBJECT_OPERATOR","->",136],["T_STRING","condition",136],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",136],",",["T_WHITESPACE"," ",136],["T_LNUMBER","0",136],")",["T_WHITESPACE","\n      ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","condition",137],"(",["T_CONSTANT_ENCAPSED_STRING","'grant_view'",137],",",["T_WHITESPACE"," ",137],["T_LNUMBER","1",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'>='",137],")",";",["T_WHITESPACE","\n\n    ",137],["T_VARIABLE","$grants",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STATIC","static",139],["T_DOUBLE_COLON","::",139],["T_STRING","buildGrantsQueryCondition",139],"(",["T_STRING","node_access_grants",139],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$account",139],")",")",";",["T_WHITESPACE","\n\n    ",139],["T_IF","if",141],["T_WHITESPACE"," ",141],"(",["T_STRING","count",141],"(",["T_VARIABLE","$grants",141],")",["T_WHITESPACE"," ",141],">",["T_WHITESPACE"," ",141],["T_LNUMBER","0",141],["T_WHITESPACE"," ",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n      ",141],["T_VARIABLE","$query",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","condition",142],"(",["T_VARIABLE","$grants",142],")",";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n    ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$query",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","execute",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","fetchField",144],"(",")",";",["T_WHITESPACE","\n  ",144],"}",["T_WHITESPACE","\n\n  ",145],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",147],["T_WHITESPACE","\n  ",149],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","alterQuery",150],"(",["T_VARIABLE","$query",150],",",["T_WHITESPACE"," ",150],["T_ARRAY","array",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$tables",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$op",150],",",["T_WHITESPACE"," ",150],["T_STRING","AccountInterface",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$account",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$base_table",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n    ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(","!",["T_VARIABLE","$langcode",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$query",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getMetaData",151],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",151],")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n      ",151],["T_VARIABLE","$langcode",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_STRING","FALSE",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_COMMENT","\/\/ Find all instances of the base table being joined -- could appear\n",155],["T_WHITESPACE","    ",156],["T_COMMENT","\/\/ more than once in the query, and could be aliased. Join each one to\n",156],["T_WHITESPACE","    ",157],["T_COMMENT","\/\/ the node_access table.\n",157],["T_WHITESPACE","    ",158],["T_VARIABLE","$grants",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","node_access_grants",158],"(",["T_VARIABLE","$op",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$account",158],")",";",["T_WHITESPACE","\n    ",158],["T_FOREACH","foreach",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$tables",159],["T_WHITESPACE"," ",159],["T_AS","as",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$nalias",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$tableinfo",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n      ",159],["T_VARIABLE","$table",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$tableinfo",160],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",160],"]",";",["T_WHITESPACE","\n      ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(","!","(",["T_VARIABLE","$table",161],["T_WHITESPACE"," ",161],["T_INSTANCEOF","instanceof",161],["T_WHITESPACE"," ",161],["T_STRING","SelectInterface",161],")",["T_WHITESPACE"," ",161],["T_BOOLEAN_AND","&&",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$table",161],["T_WHITESPACE"," ",161],["T_IS_EQUAL","==",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$base_table",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n        ",161],["T_COMMENT","\/\/ Set the subquery.\n",162],["T_WHITESPACE","        ",163],["T_VARIABLE","$subquery",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","database",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","select",163],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'na'",163],")",["T_WHITESPACE","\n          ",163],["T_OBJECT_OPERATOR","->",164],["T_STRING","fields",164],"(",["T_CONSTANT_ENCAPSED_STRING","'na'",164],",",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",164],")",")",";",["T_WHITESPACE","\n\n        ",164],["T_COMMENT","\/\/ If any grant exists for the specified user, then user has access to the\n",166],["T_WHITESPACE","        ",167],["T_COMMENT","\/\/ node for the specified operation.\n",167],["T_WHITESPACE","        ",168],["T_VARIABLE","$grant_conditions",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_STATIC","static",168],["T_DOUBLE_COLON","::",168],["T_STRING","buildGrantsQueryCondition",168],"(",["T_VARIABLE","$grants",168],")",";",["T_WHITESPACE","\n\n        ",168],["T_COMMENT","\/\/ Attach conditions to the subquery for nodes.\n",170],["T_WHITESPACE","        ",171],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_STRING","count",171],"(",["T_VARIABLE","$grant_conditions",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","conditions",171],"(",")",")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n          ",171],["T_VARIABLE","$subquery",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","condition",172],"(",["T_VARIABLE","$grant_conditions",172],")",";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$subquery",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","condition",174],"(",["T_CONSTANT_ENCAPSED_STRING","'na.grant_'",174],["T_WHITESPACE"," ",174],".",["T_WHITESPACE"," ",174],["T_VARIABLE","$op",174],",",["T_WHITESPACE"," ",174],["T_LNUMBER","1",174],",",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'>='",174],")",";",["T_WHITESPACE","\n\n        ",174],["T_COMMENT","\/\/ Add langcode-based filtering if this is a multilingual site.\n",176],["T_WHITESPACE","        ",177],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_NS_SEPARATOR","\\",177],["T_STRING","Drupal",177],["T_DOUBLE_COLON","::",177],["T_STRING","languageManager",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","isMultilingual",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n          ",177],["T_COMMENT","\/\/ If no specific langcode to check for is given, use the grant entry\n",178],["T_WHITESPACE","          ",179],["T_COMMENT","\/\/ which is set as a fallback.\n",179],["T_WHITESPACE","          ",180],["T_COMMENT","\/\/ If a specific langcode is given, use the grant entry for it.\n",180],["T_WHITESPACE","          ",181],["T_IF","if",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$langcode",181],["T_WHITESPACE"," ",181],["T_IS_IDENTICAL","===",181],["T_WHITESPACE"," ",181],["T_STRING","FALSE",181],")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$subquery",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","condition",182],"(",["T_CONSTANT_ENCAPSED_STRING","'na.fallback'",182],",",["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'='",182],")",";",["T_WHITESPACE","\n          ",182],"}",["T_WHITESPACE","\n          ",183],["T_ELSE","else",184],["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$subquery",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","condition",185],"(",["T_CONSTANT_ENCAPSED_STRING","'na.langcode'",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$langcode",185],",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'='",185],")",";",["T_WHITESPACE","\n          ",185],"}",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n\n        ",187],["T_VARIABLE","$field",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'nid'",189],";",["T_WHITESPACE","\n        ",189],["T_COMMENT","\/\/ Now handle entities.\n",190],["T_WHITESPACE","        ",191],["T_VARIABLE","$subquery",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","where",191],"(","\"",["T_VARIABLE","$nalias",191],["T_ENCAPSED_AND_WHITESPACE",".",191],["T_VARIABLE","$field",191],["T_ENCAPSED_AND_WHITESPACE"," = na.nid",191],"\"",")",";",["T_WHITESPACE","\n\n        ",191],["T_VARIABLE","$query",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","exists",193],"(",["T_VARIABLE","$subquery",193],")",";",["T_WHITESPACE","\n      ",193],"}",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n  ",195],"}",["T_WHITESPACE","\n\n  ",196],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",198],["T_WHITESPACE","\n  ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","write",201],"(",["T_STRING","NodeInterface",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$node",201],",",["T_WHITESPACE"," ",201],["T_ARRAY","array",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$grants",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$realm",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","NULL",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$delete",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","TRUE",201],")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n    ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(",["T_VARIABLE","$delete",202],")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n      ",202],["T_VARIABLE","$query",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","database",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","delete",203],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","condition",203],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$node",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","id",203],"(",")",")",";",["T_WHITESPACE","\n      ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$realm",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$query",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","condition",205],"(",["T_CONSTANT_ENCAPSED_STRING","'realm'",205],",",["T_WHITESPACE"," ",205],["T_ARRAY","array",205],"(",["T_VARIABLE","$realm",205],",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'all'",205],")",",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'IN'",205],")",";",["T_WHITESPACE","\n      ",205],"}",["T_WHITESPACE","\n      ",206],["T_VARIABLE","$query",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","execute",207],"(",")",";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n    ",208],["T_COMMENT","\/\/ Only perform work when node_access modules are active.\n",209],["T_WHITESPACE","    ",210],["T_IF","if",210],["T_WHITESPACE"," ",210],"(","!",["T_EMPTY","empty",210],"(",["T_VARIABLE","$grants",210],")",["T_WHITESPACE"," ",210],["T_BOOLEAN_AND","&&",210],["T_WHITESPACE"," ",210],["T_STRING","count",210],"(",["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","moduleHandler",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getImplementations",210],"(",["T_CONSTANT_ENCAPSED_STRING","'node_grants'",210],")",")",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n      ",210],["T_VARIABLE","$query",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","database",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","insert",211],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",211],")",["T_OBJECT_OPERATOR","->",211],["T_STRING","fields",211],"(",["T_ARRAY","array",211],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'langcode'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'fallback'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'realm'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'gid'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'grant_view'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'grant_update'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'grant_delete'",211],")",")",";",["T_WHITESPACE","\n      ",211],["T_COMMENT","\/\/ If we have defined a granted langcode, use it. But if not, add a grant\n",212],["T_WHITESPACE","      ",213],["T_COMMENT","\/\/ for every language this node is translated to.\n",213],["T_WHITESPACE","      ",214],["T_FOREACH","foreach",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$grants",214],["T_WHITESPACE"," ",214],["T_AS","as",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$grant",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n        ",214],["T_IF","if",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$realm",215],["T_WHITESPACE"," ",215],["T_BOOLEAN_AND","&&",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$realm",215],["T_WHITESPACE"," ",215],["T_IS_NOT_EQUAL","!=",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$grant",215],"[",["T_CONSTANT_ENCAPSED_STRING","'realm'",215],"]",")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n          ",215],["T_CONTINUE","continue",216],";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_ISSET","isset",218],"(",["T_VARIABLE","$grant",218],"[",["T_CONSTANT_ENCAPSED_STRING","'langcode'",218],"]",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n          ",218],["T_VARIABLE","$grant_languages",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_ARRAY","array",219],"(",["T_VARIABLE","$grant",219],"[",["T_CONSTANT_ENCAPSED_STRING","'langcode'",219],"]",["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","languageManager",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getLanguage",219],"(",["T_VARIABLE","$grant",219],"[",["T_CONSTANT_ENCAPSED_STRING","'langcode'",219],"]",")",")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n        ",220],["T_ELSE","else",221],["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n          ",221],["T_VARIABLE","$grant_languages",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$node",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getTranslationLanguages",222],"(",["T_STRING","TRUE",222],")",";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n        ",223],["T_FOREACH","foreach",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$grant_languages",224],["T_WHITESPACE"," ",224],["T_AS","as",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$grant_langcode",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$grant_language",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n          ",224],["T_COMMENT","\/\/ Only write grants; denies are implicit.\n",225],["T_WHITESPACE","          ",226],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_VARIABLE","$grant",226],"[",["T_CONSTANT_ENCAPSED_STRING","'grant_view'",226],"]",["T_WHITESPACE"," ",226],["T_BOOLEAN_OR","||",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$grant",226],"[",["T_CONSTANT_ENCAPSED_STRING","'grant_update'",226],"]",["T_WHITESPACE"," ",226],["T_BOOLEAN_OR","||",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$grant",226],"[",["T_CONSTANT_ENCAPSED_STRING","'grant_delete'",226],"]",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$grant",227],"[",["T_CONSTANT_ENCAPSED_STRING","'nid'",227],"]",["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$node",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","id",227],"(",")",";",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$grant",228],"[",["T_CONSTANT_ENCAPSED_STRING","'langcode'",228],"]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$grant_langcode",228],";",["T_WHITESPACE","\n            ",228],["T_COMMENT","\/\/ The record with the original langcode is used as the fallback.\n",229],["T_WHITESPACE","            ",230],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$grant",230],"[",["T_CONSTANT_ENCAPSED_STRING","'langcode'",230],"]",["T_WHITESPACE"," ",230],["T_IS_EQUAL","==",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$node",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","language",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getId",230],"(",")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n              ",230],["T_VARIABLE","$grant",231],"[",["T_CONSTANT_ENCAPSED_STRING","'fallback'",231],"]",["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_LNUMBER","1",231],";",["T_WHITESPACE","\n            ",231],"}",["T_WHITESPACE","\n            ",232],["T_ELSE","else",233],["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n              ",233],["T_VARIABLE","$grant",234],"[",["T_CONSTANT_ENCAPSED_STRING","'fallback'",234],"]",["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_LNUMBER","0",234],";",["T_WHITESPACE","\n            ",234],"}",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$query",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","values",236],"(",["T_VARIABLE","$grant",236],")",";",["T_WHITESPACE","\n          ",236],"}",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n      ",238],"}",["T_WHITESPACE","\n      ",239],["T_VARIABLE","$query",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","execute",240],"(",")",";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n  ",241],"}",["T_WHITESPACE","\n\n  ",242],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",244],["T_WHITESPACE","\n  ",246],["T_PUBLIC","public",247],["T_WHITESPACE"," ",247],["T_FUNCTION","function",247],["T_WHITESPACE"," ",247],["T_STRING","delete",247],"(",")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n    ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","database",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","truncate",248],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",248],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","execute",248],"(",")",";",["T_WHITESPACE","\n  ",248],"}",["T_WHITESPACE","\n\n  ",249],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",251],["T_WHITESPACE","\n  ",253],["T_PUBLIC","public",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","writeDefault",254],"(",")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n    ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","database",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","insert",255],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",255],")",["T_WHITESPACE","\n      ",255],["T_OBJECT_OPERATOR","->",256],["T_STRING","fields",256],"(",["T_ARRAY","array",256],"(",["T_WHITESPACE","\n          ",256],["T_CONSTANT_ENCAPSED_STRING","'nid'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_LNUMBER","0",257],",",["T_WHITESPACE","\n          ",257],["T_CONSTANT_ENCAPSED_STRING","'realm'",258],["T_WHITESPACE"," ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_CONSTANT_ENCAPSED_STRING","'all'",258],",",["T_WHITESPACE","\n          ",258],["T_CONSTANT_ENCAPSED_STRING","'gid'",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_LNUMBER","0",259],",",["T_WHITESPACE","\n          ",259],["T_CONSTANT_ENCAPSED_STRING","'grant_view'",260],["T_WHITESPACE"," ",260],["T_DOUBLE_ARROW","=>",260],["T_WHITESPACE"," ",260],["T_LNUMBER","1",260],",",["T_WHITESPACE","\n          ",260],["T_CONSTANT_ENCAPSED_STRING","'grant_update'",261],["T_WHITESPACE"," ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_LNUMBER","0",261],",",["T_WHITESPACE","\n          ",261],["T_CONSTANT_ENCAPSED_STRING","'grant_delete'",262],["T_WHITESPACE"," ",262],["T_DOUBLE_ARROW","=>",262],["T_WHITESPACE"," ",262],["T_LNUMBER","0",262],",",["T_WHITESPACE","\n        ",262],")",")",["T_WHITESPACE","\n      ",263],["T_OBJECT_OPERATOR","->",264],["T_STRING","execute",264],"(",")",";",["T_WHITESPACE","\n  ",264],"}",["T_WHITESPACE","\n\n  ",265],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",267],["T_WHITESPACE","\n  ",269],["T_PUBLIC","public",270],["T_WHITESPACE"," ",270],["T_FUNCTION","function",270],["T_WHITESPACE"," ",270],["T_STRING","count",270],"(",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n    ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","database",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","query",271],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {node_access}'",271],")",["T_OBJECT_OPERATOR","->",271],["T_STRING","fetchField",271],"(",")",";",["T_WHITESPACE","\n  ",271],"}",["T_WHITESPACE","\n\n  ",272],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",274],["T_WHITESPACE","\n  ",276],["T_PUBLIC","public",277],["T_WHITESPACE"," ",277],["T_FUNCTION","function",277],["T_WHITESPACE"," ",277],["T_STRING","deleteNodeRecords",277],"(",["T_ARRAY","array",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$nids",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n    ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","database",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","delete",278],"(",["T_CONSTANT_ENCAPSED_STRING","'node_access'",278],")",["T_WHITESPACE","\n      ",278],["T_OBJECT_OPERATOR","->",279],["T_STRING","condition",279],"(",["T_CONSTANT_ENCAPSED_STRING","'nid'",279],",",["T_WHITESPACE"," ",279],["T_VARIABLE","$nids",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'IN'",279],")",["T_WHITESPACE","\n      ",279],["T_OBJECT_OPERATOR","->",280],["T_STRING","execute",280],"(",")",";",["T_WHITESPACE","\n  ",280],"}",["T_WHITESPACE","\n\n  ",281],["T_DOC_COMMENT","\/**\n   * Creates a query condition from an array of node access grants.\n   *\n   * @param array $node_access_grants\n   *   An array of grants, as returned by node_access_grants().\n   * @return \\Drupal\\Core\\Database\\Query\\Condition\n   *   A condition object to be passed to $query->condition().\n   *\n   * @see node_access_grants()\n   *\/",283],["T_WHITESPACE","\n  ",292],["T_PROTECTED","protected",293],["T_WHITESPACE"," ",293],["T_STATIC","static",293],["T_WHITESPACE"," ",293],["T_FUNCTION","function",293],["T_WHITESPACE"," ",293],["T_STRING","buildGrantsQueryCondition",293],"(",["T_ARRAY","array",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$node_access_grants",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n    ",293],["T_VARIABLE","$grants",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_NEW","new",294],["T_WHITESPACE"," ",294],["T_STRING","Condition",294],"(",["T_CONSTANT_ENCAPSED_STRING","\"OR\"",294],")",";",["T_WHITESPACE","\n    ",294],["T_FOREACH","foreach",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$node_access_grants",295],["T_WHITESPACE"," ",295],["T_AS","as",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$realm",295],["T_WHITESPACE"," ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$gids",295],")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n      ",295],["T_IF","if",296],["T_WHITESPACE"," ",296],"(","!",["T_EMPTY","empty",296],"(",["T_VARIABLE","$gids",296],")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$and",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_NEW","new",297],["T_WHITESPACE"," ",297],["T_STRING","Condition",297],"(",["T_CONSTANT_ENCAPSED_STRING","'AND'",297],")",";",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$grants",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","condition",298],"(",["T_VARIABLE","$and",298],["T_WHITESPACE","\n          ",298],["T_OBJECT_OPERATOR","->",299],["T_STRING","condition",299],"(",["T_CONSTANT_ENCAPSED_STRING","'gid'",299],",",["T_WHITESPACE"," ",299],["T_VARIABLE","$gids",299],",",["T_WHITESPACE"," ",299],["T_CONSTANT_ENCAPSED_STRING","'IN'",299],")",["T_WHITESPACE","\n          ",299],["T_OBJECT_OPERATOR","->",300],["T_STRING","condition",300],"(",["T_CONSTANT_ENCAPSED_STRING","'realm'",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$realm",300],")",["T_WHITESPACE","\n        ",300],")",";",["T_WHITESPACE","\n      ",301],"}",["T_WHITESPACE","\n    ",302],"}",["T_WHITESPACE","\n\n    ",303],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$grants",305],";",["T_WHITESPACE","\n  ",305],"}",["T_WHITESPACE","\n\n",306],"}",["T_WHITESPACE","\n",308]]