[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","search",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Tests search index is updated properly when nodes are removed or updated.\n *\n * @group search\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","SearchNodeUpdateAndDeletionTest",10],["T_WHITESPACE"," ",10],["T_EXTENDS","extends",10],["T_WHITESPACE"," ",10],["T_STRING","SearchTestBase",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",12],["T_WHITESPACE","\n  ",16],["T_PUBLIC","public",17],["T_WHITESPACE"," ",17],["T_STATIC","static",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$modules",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_ARRAY","array",17],"(",")",";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * A user with permission to access and search content.\n   *\n   * @var \\Drupal\\user\\UserInterface\n   *\/",19],["T_WHITESPACE","\n  ",23],["T_PUBLIC","public",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$testUser",24],";",["T_WHITESPACE","\n\n  ",24],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_FUNCTION","function",26],["T_WHITESPACE"," ",26],["T_STRING","setUp",26],"(",")",["T_WHITESPACE"," ",26],"{",["T_WHITESPACE","\n    ",26],["T_STRING","parent",27],["T_DOUBLE_COLON","::",27],["T_STRING","setUp",27],"(",")",";",["T_WHITESPACE","\n\n    ",27],["T_COMMENT","\/\/ Create a test user and log in.\n",29],["T_WHITESPACE","    ",30],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","testUser",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","drupalCreateUser",30],"(",["T_ARRAY","array",30],"(",["T_CONSTANT_ENCAPSED_STRING","'access content'",30],",",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'search content'",30],")",")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","drupalLogin",31],"(",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","testUser",31],")",";",["T_WHITESPACE","\n  ",31],"}",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * Tests that the search index info is properly updated when a node changes.\n   *\/",34],["T_WHITESPACE","\n  ",36],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","testSearchIndexUpdateOnNodeChange",37],"(",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_COMMENT","\/\/ Create a node.\n",38],["T_WHITESPACE","    ",39],["T_VARIABLE","$node",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","drupalCreateNode",39],"(",["T_ARRAY","array",39],"(",["T_WHITESPACE","\n      ",39],["T_CONSTANT_ENCAPSED_STRING","'title'",40],["T_WHITESPACE"," ",40],["T_DOUBLE_ARROW","=>",40],["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'Someone who says Ni!'",40],",",["T_WHITESPACE","\n      ",40],["T_CONSTANT_ENCAPSED_STRING","'body'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",["T_ARRAY","array",41],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","\"We are the knights who say Ni!\"",41],")",")",",",["T_WHITESPACE","\n      ",41],["T_CONSTANT_ENCAPSED_STRING","'type'",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'page'",42],")",")",";",["T_WHITESPACE","\n\n    ",42],["T_VARIABLE","$node_search_plugin",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","container",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","get",44],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.search'",44],")",["T_OBJECT_OPERATOR","->",44],["T_STRING","createInstance",44],"(",["T_CONSTANT_ENCAPSED_STRING","'node_search'",44],")",";",["T_WHITESPACE","\n    ",44],["T_COMMENT","\/\/ Update the search index.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$node_search_plugin",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","updateIndex",46],"(",")",";",["T_WHITESPACE","\n    ",46],["T_STRING","search_update_totals",47],"(",")",";",["T_WHITESPACE","\n\n    ",47],["T_COMMENT","\/\/ Search the node to verify it appears in search results\n",49],["T_WHITESPACE","    ",50],["T_VARIABLE","$edit",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_ARRAY","array",50],"(",["T_CONSTANT_ENCAPSED_STRING","'keys'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'knights'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","drupalPostForm",51],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$edit",51],",",["T_WHITESPACE"," ",51],["T_STRING","t",51],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",51],")",")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","assertText",52],"(",["T_VARIABLE","$node",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","label",52],"(",")",")",";",["T_WHITESPACE","\n\n    ",52],["T_COMMENT","\/\/ Update the node\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$node",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","body",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","value",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","\"We want a shrubbery!\"",55],";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$node",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","save",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_COMMENT","\/\/ Run indexer again\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$node_search_plugin",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","updateIndex",59],"(",")",";",["T_WHITESPACE","\n    ",59],["T_STRING","search_update_totals",60],"(",")",";",["T_WHITESPACE","\n\n    ",60],["T_COMMENT","\/\/ Search again to verify the new text appears in test results.\n",62],["T_WHITESPACE","    ",63],["T_VARIABLE","$edit",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_ARRAY","array",63],"(",["T_CONSTANT_ENCAPSED_STRING","'keys'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'shrubbery'",63],")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","drupalPostForm",64],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$edit",64],",",["T_WHITESPACE"," ",64],["T_STRING","t",64],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",64],")",")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertText",65],"(",["T_VARIABLE","$node",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","label",65],"(",")",")",";",["T_WHITESPACE","\n  ",65],"}",["T_WHITESPACE","\n\n  ",66],["T_DOC_COMMENT","\/**\n   * Tests that the search index info is updated when a node is deleted.\n   *\/",68],["T_WHITESPACE","\n  ",70],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","testSearchIndexUpdateOnNodeDeletion",71],"(",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n    ",71],["T_COMMENT","\/\/ Create a node.\n",72],["T_WHITESPACE","    ",73],["T_VARIABLE","$node",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","drupalCreateNode",73],"(",["T_ARRAY","array",73],"(",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'title'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'No dragons here'",74],",",["T_WHITESPACE","\n      ",74],["T_CONSTANT_ENCAPSED_STRING","'body'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_ARRAY","array",75],"(",["T_ARRAY","array",75],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'Again: No dragons here'",75],")",")",",",["T_WHITESPACE","\n      ",75],["T_CONSTANT_ENCAPSED_STRING","'type'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'page'",76],")",")",";",["T_WHITESPACE","\n\n    ",76],["T_VARIABLE","$node_search_plugin",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","container",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","get",78],"(",["T_CONSTANT_ENCAPSED_STRING","'plugin.manager.search'",78],")",["T_OBJECT_OPERATOR","->",78],["T_STRING","createInstance",78],"(",["T_CONSTANT_ENCAPSED_STRING","'node_search'",78],")",";",["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ Update the search index.\n",79],["T_WHITESPACE","    ",80],["T_VARIABLE","$node_search_plugin",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","updateIndex",80],"(",")",";",["T_WHITESPACE","\n    ",80],["T_STRING","search_update_totals",81],"(",")",";",["T_WHITESPACE","\n\n    ",81],["T_COMMENT","\/\/ Search the node to verify it appears in search results\n",83],["T_WHITESPACE","    ",84],["T_VARIABLE","$edit",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",["T_CONSTANT_ENCAPSED_STRING","'keys'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'dragons'",84],")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","drupalPostForm",85],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$edit",85],",",["T_WHITESPACE"," ",85],["T_STRING","t",85],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",85],")",")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertText",86],"(",["T_VARIABLE","$node",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","label",86],"(",")",")",";",["T_WHITESPACE","\n\n    ",86],["T_COMMENT","\/\/ Get the node info from the search index tables.\n",88],["T_WHITESPACE","    ",89],["T_VARIABLE","$search_index_dataset",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","db_query",89],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT sid FROM {search_index} WHERE type = 'node_search' AND  word = :word\"",89],",",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","':word'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'dragons'",89],")",")",["T_WHITESPACE","\n      ",89],["T_OBJECT_OPERATOR","->",90],["T_STRING","fetchField",90],"(",")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertNotEqual",91],"(",["T_VARIABLE","$search_index_dataset",91],",",["T_WHITESPACE"," ",91],["T_STRING","FALSE",91],",",["T_WHITESPACE"," ",91],["T_STRING","t",91],"(",["T_CONSTANT_ENCAPSED_STRING","'Node info found on the search_index'",91],")",")",";",["T_WHITESPACE","\n\n    ",91],["T_COMMENT","\/\/ Delete the node.\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$node",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","delete",94],"(",")",";",["T_WHITESPACE","\n\n    ",94],["T_COMMENT","\/\/ Check if the node info is gone from the search table.\n",96],["T_WHITESPACE","    ",97],["T_VARIABLE","$search_index_dataset",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","db_query",97],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT sid FROM {search_index} WHERE type = 'node_search' AND  word = :word\"",97],",",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",["T_CONSTANT_ENCAPSED_STRING","':word'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'dragons'",97],")",")",["T_WHITESPACE","\n      ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","fetchField",98],"(",")",";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","assertFalse",99],"(",["T_VARIABLE","$search_index_dataset",99],",",["T_WHITESPACE"," ",99],["T_STRING","t",99],"(",["T_CONSTANT_ENCAPSED_STRING","'Node info successfully removed from search_index'",99],")",")",";",["T_WHITESPACE","\n\n    ",99],["T_COMMENT","\/\/ Search again to verify the node doesn't appear anymore.\n",101],["T_WHITESPACE","    ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","drupalPostForm",102],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$edit",102],",",["T_WHITESPACE"," ",102],["T_STRING","t",102],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",102],")",")",";",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","assertNoText",103],"(",["T_VARIABLE","$node",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","label",103],"(",")",")",";",["T_WHITESPACE","\n  ",103],"}",["T_WHITESPACE","\n\n",104],"}",["T_WHITESPACE","\n",106]]