[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","search",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","comment",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Plugin",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Field",5],["T_NS_SEPARATOR","\\",5],["T_STRING","FieldType",5],["T_NS_SEPARATOR","\\",5],["T_STRING","CommentItemInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","comment",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","CommentTestTrait",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","field",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","FieldConfig",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","user",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RoleInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","filter",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Entity",9],["T_NS_SEPARATOR","\\",9],["T_STRING","FilterFormat",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Tests integration searching comments.\n *\n * @group search\n *\/",11],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","SearchCommentTest",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","SearchTestBase",16],["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n\n  ",16],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","CommentTestTrait",18],";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",20],["T_WHITESPACE","\n  ",24],["T_PUBLIC","public",25],["T_WHITESPACE"," ",25],["T_STATIC","static",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$modules",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_ARRAY","array",25],"(",["T_CONSTANT_ENCAPSED_STRING","'filter'",25],",",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'node'",25],",",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'comment'",25],")",";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * Test subject for comments.\n   *\n   * @var string\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$commentSubject",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * ID for the administrator role.\n   *\n   * @var string\n   *\/",34],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$adminRole",39],";",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * A user with various administrative permissions.\n   *\n   * @var \\Drupal\\user\\UserInterface\n   *\/",41],["T_WHITESPACE","\n  ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$adminUser",46],";",["T_WHITESPACE","\n\n  ",46],["T_DOC_COMMENT","\/**\n   * Test node for searching.\n   *\n   * @var \\Drupal\\node\\NodeInterface\n   *\/",48],["T_WHITESPACE","\n  ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$node",53],";",["T_WHITESPACE","\n\n  ",53],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","setUp",55],"(",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n    ",55],["T_STRING","parent",56],["T_DOUBLE_COLON","::",56],["T_STRING","setUp",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_VARIABLE","$full_html_format",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","FilterFormat",58],["T_DOUBLE_COLON","::",58],["T_STRING","create",58],"(",["T_ARRAY","array",58],"(",["T_WHITESPACE","\n      ",58],["T_CONSTANT_ENCAPSED_STRING","'format'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'full_html'",59],",",["T_WHITESPACE","\n      ",59],["T_CONSTANT_ENCAPSED_STRING","'name'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'Full HTML'",60],",",["T_WHITESPACE","\n      ",60],["T_CONSTANT_ENCAPSED_STRING","'weight'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_LNUMBER","1",61],",",["T_WHITESPACE","\n      ",61],["T_CONSTANT_ENCAPSED_STRING","'filters'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_ARRAY","array",62],"(",")",",",["T_WHITESPACE","\n    ",62],")",")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$full_html_format",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","save",64],"(",")",";",["T_WHITESPACE","\n\n    ",64],["T_COMMENT","\/\/ Create and log in an administrative user having access to the Full HTML\n",66],["T_WHITESPACE","    ",67],["T_COMMENT","\/\/ text format.\n",67],["T_WHITESPACE","    ",68],["T_VARIABLE","$permissions",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_ARRAY","array",68],"(",["T_WHITESPACE","\n      ",68],["T_CONSTANT_ENCAPSED_STRING","'administer filters'",69],",",["T_WHITESPACE","\n      ",69],["T_VARIABLE","$full_html_format",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getPermissionName",70],"(",")",",",["T_WHITESPACE","\n      ",70],["T_CONSTANT_ENCAPSED_STRING","'administer permissions'",71],",",["T_WHITESPACE","\n      ",71],["T_CONSTANT_ENCAPSED_STRING","'create page content'",72],",",["T_WHITESPACE","\n      ",72],["T_CONSTANT_ENCAPSED_STRING","'post comments'",73],",",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'skip comment approval'",74],",",["T_WHITESPACE","\n      ",74],["T_CONSTANT_ENCAPSED_STRING","'access comments'",75],",",["T_WHITESPACE","\n    ",75],")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","adminUser",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","drupalCreateUser",77],"(",["T_VARIABLE","$permissions",77],")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","drupalLogin",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","adminUser",78],")",";",["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ Add a comment field.\n",79],["T_WHITESPACE","    ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","addDefaultCommentField",80],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",80],",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'article'",80],")",";",["T_WHITESPACE","\n  ",80],"}",["T_WHITESPACE","\n\n  ",81],["T_DOC_COMMENT","\/**\n   * Verify that comments are rendered using proper format in search results.\n   *\/",83],["T_WHITESPACE","\n  ",85],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","testSearchResultsComment",86],"(",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$node_storage",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","container",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","get",87],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","getStorage",87],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",87],")",";",["T_WHITESPACE","\n    ",87],["T_COMMENT","\/\/ Create basic_html format that escapes all HTML.\n",88],["T_WHITESPACE","    ",89],["T_VARIABLE","$basic_html_format",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","FilterFormat",89],["T_DOUBLE_COLON","::",89],["T_STRING","create",89],"(",["T_ARRAY","array",89],"(",["T_WHITESPACE","\n      ",89],["T_CONSTANT_ENCAPSED_STRING","'format'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'basic_html'",90],",",["T_WHITESPACE","\n      ",90],["T_CONSTANT_ENCAPSED_STRING","'name'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'Basic HTML'",91],",",["T_WHITESPACE","\n      ",91],["T_CONSTANT_ENCAPSED_STRING","'weight'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_LNUMBER","1",92],",",["T_WHITESPACE","\n      ",92],["T_CONSTANT_ENCAPSED_STRING","'filters'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_ARRAY","array",93],"(",["T_WHITESPACE","\n        ",93],["T_CONSTANT_ENCAPSED_STRING","'filter_html_escape'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_ARRAY","array",94],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_LNUMBER","1",94],")",",",["T_WHITESPACE","\n      ",94],")",",",["T_WHITESPACE","\n      ",95],["T_CONSTANT_ENCAPSED_STRING","'roles'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",["T_STRING","RoleInterface",96],["T_DOUBLE_COLON","::",96],["T_STRING","AUTHENTICATED_ID",96],")",",",["T_WHITESPACE","\n    ",96],")",")",";",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$basic_html_format",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","save",98],"(",")",";",["T_WHITESPACE","\n\n    ",98],["T_VARIABLE","$comment_body",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'Test comment body'",100],";",["T_WHITESPACE","\n\n    ",100],["T_COMMENT","\/\/ Make preview optional.\n",102],["T_WHITESPACE","    ",103],["T_VARIABLE","$field",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_STRING","FieldConfig",103],["T_DOUBLE_COLON","::",103],["T_STRING","loadByName",103],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'article'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'comment'",103],")",";",["T_WHITESPACE","\n    ",103],["T_VARIABLE","$field",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","setSetting",104],"(",["T_CONSTANT_ENCAPSED_STRING","'preview'",104],",",["T_WHITESPACE"," ",104],["T_STRING","DRUPAL_OPTIONAL",104],")",";",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$field",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","save",105],"(",")",";",["T_WHITESPACE","\n\n    ",105],["T_COMMENT","\/\/ Allow anonymous users to search content.\n",107],["T_WHITESPACE","    ",108],["T_VARIABLE","$edit",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_ARRAY","array",108],"(",["T_WHITESPACE","\n      ",108],["T_STRING","RoleInterface",109],["T_DOUBLE_COLON","::",109],["T_STRING","ANONYMOUS_ID",109],["T_WHITESPACE"," ",109],".",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'[search content]'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_LNUMBER","1",109],",",["T_WHITESPACE","\n      ",109],["T_STRING","RoleInterface",110],["T_DOUBLE_COLON","::",110],["T_STRING","ANONYMOUS_ID",110],["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'[access comments]'",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_LNUMBER","1",110],",",["T_WHITESPACE","\n      ",110],["T_STRING","RoleInterface",111],["T_DOUBLE_COLON","::",111],["T_STRING","ANONYMOUS_ID",111],["T_WHITESPACE"," ",111],".",["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'[post comments]'",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_LNUMBER","1",111],",",["T_WHITESPACE","\n    ",111],")",";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","drupalPostForm",113],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/people\/permissions'",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$edit",113],",",["T_WHITESPACE"," ",113],["T_STRING","t",113],"(",["T_CONSTANT_ENCAPSED_STRING","'Save permissions'",113],")",")",";",["T_WHITESPACE","\n\n    ",113],["T_COMMENT","\/\/ Create a node.\n",115],["T_WHITESPACE","    ",116],["T_VARIABLE","$node",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","drupalCreateNode",116],"(",["T_ARRAY","array",116],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'article'",116],")",")",";",["T_WHITESPACE","\n    ",116],["T_COMMENT","\/\/ Post a comment using 'Full HTML' text format.\n",117],["T_WHITESPACE","    ",118],["T_VARIABLE","$edit_comment",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",")",";",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$edit_comment",119],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",119],"]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'Test comment subject'",119],";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$edit_comment",120],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][value]'",120],"]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'<h1>'",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_VARIABLE","$comment_body",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'<\/h1>'",120],";",["T_WHITESPACE","\n    ",120],["T_VARIABLE","$full_html_format_id",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'full_html'",121],";",["T_WHITESPACE","\n    ",121],["T_VARIABLE","$edit_comment",122],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][format]'",122],"]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$full_html_format_id",122],";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","drupalPostForm",123],"(",["T_CONSTANT_ENCAPSED_STRING","'comment\/reply\/node\/'",123],["T_WHITESPACE"," ",123],".",["T_WHITESPACE"," ",123],["T_VARIABLE","$node",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","id",123],"(",")",["T_WHITESPACE"," ",123],".",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'\/comment'",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$edit_comment",123],",",["T_WHITESPACE"," ",123],["T_STRING","t",123],"(",["T_CONSTANT_ENCAPSED_STRING","'Save'",123],")",")",";",["T_WHITESPACE","\n\n    ",123],["T_COMMENT","\/\/ Post a comment with an evil script tag in the comment subject and a\n",125],["T_WHITESPACE","    ",126],["T_COMMENT","\/\/ script tag nearby a keyword in the comment body. Use the 'FULL HTML' text\n",126],["T_WHITESPACE","    ",127],["T_COMMENT","\/\/ format so the script tag stored.\n",127],["T_WHITESPACE","    ",128],["T_VARIABLE","$edit_comment2",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_ARRAY","array",128],"(",")",";",["T_WHITESPACE","\n    ",128],["T_VARIABLE","$edit_comment2",129],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","\"<script>alert('subjectkeyword');<\/script>\"",129],";",["T_WHITESPACE","\n    ",129],["T_VARIABLE","$edit_comment2",130],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][value]'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","\"nearbykeyword<script>alert('somethinggeneric');<\/script>\"",130],";",["T_WHITESPACE","\n    ",130],["T_VARIABLE","$edit_comment2",131],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][format]'",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$full_html_format_id",131],";",["T_WHITESPACE","\n    ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","drupalPostForm",132],"(",["T_CONSTANT_ENCAPSED_STRING","'comment\/reply\/node\/'",132],["T_WHITESPACE"," ",132],".",["T_WHITESPACE"," ",132],["T_VARIABLE","$node",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","id",132],"(",")",["T_WHITESPACE"," ",132],".",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'\/comment'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$edit_comment2",132],",",["T_WHITESPACE"," ",132],["T_STRING","t",132],"(",["T_CONSTANT_ENCAPSED_STRING","'Save'",132],")",")",";",["T_WHITESPACE","\n\n    ",132],["T_COMMENT","\/\/ Post a comment with a keyword inside an evil script tag in the comment\n",134],["T_WHITESPACE","    ",135],["T_COMMENT","\/\/ body. Use the 'FULL HTML' text format so the script tag is stored.\n",135],["T_WHITESPACE","    ",136],["T_VARIABLE","$edit_comment3",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",")",";",["T_WHITESPACE","\n    ",136],["T_VARIABLE","$edit_comment3",137],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",137],"]",["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'asubject'",137],";",["T_WHITESPACE","\n    ",137],["T_VARIABLE","$edit_comment3",138],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][value]'",138],"]",["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","\"<script>alert('insidekeyword');<\/script>\"",138],";",["T_WHITESPACE","\n    ",138],["T_VARIABLE","$edit_comment3",139],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][format]'",139],"]",["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$full_html_format_id",139],";",["T_WHITESPACE","\n    ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","drupalPostForm",140],"(",["T_CONSTANT_ENCAPSED_STRING","'comment\/reply\/node\/'",140],["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_VARIABLE","$node",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","id",140],"(",")",["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'\/comment'",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$edit_comment3",140],",",["T_WHITESPACE"," ",140],["T_STRING","t",140],"(",["T_CONSTANT_ENCAPSED_STRING","'Save'",140],")",")",";",["T_WHITESPACE","\n\n    ",140],["T_COMMENT","\/\/ Invoke search index update.\n",142],["T_WHITESPACE","    ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","drupalLogout",143],"(",")",";",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","cronRun",144],"(",")",";",["T_WHITESPACE","\n\n    ",144],["T_COMMENT","\/\/ Search for the comment subject.\n",146],["T_WHITESPACE","    ",147],["T_VARIABLE","$edit",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_ARRAY","array",147],"(",["T_WHITESPACE","\n      ",147],["T_CONSTANT_ENCAPSED_STRING","'keys'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","\"'\"",148],["T_WHITESPACE"," ",148],".",["T_WHITESPACE"," ",148],["T_VARIABLE","$edit_comment",148],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",148],"]",["T_WHITESPACE"," ",148],".",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","\"'\"",148],",",["T_WHITESPACE","\n    ",148],")",";",["T_WHITESPACE","\n    ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","drupalPostForm",150],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$edit",150],",",["T_WHITESPACE"," ",150],["T_STRING","t",150],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",150],")",")",";",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$node_storage",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","resetCache",151],"(",["T_ARRAY","array",151],"(",["T_VARIABLE","$node",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","id",151],"(",")",")",")",";",["T_WHITESPACE","\n    ",151],["T_VARIABLE","$node2",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$node_storage",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","load",152],"(",["T_VARIABLE","$node",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","id",152],"(",")",")",";",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","assertText",153],"(",["T_VARIABLE","$node2",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","label",153],"(",")",",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'Node found in search results.'",153],")",";",["T_WHITESPACE","\n    ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","assertText",154],"(",["T_VARIABLE","$edit_comment",154],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",154],"]",",",["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","'Comment subject found in search results.'",154],")",";",["T_WHITESPACE","\n\n    ",154],["T_COMMENT","\/\/ Search for the comment body.\n",156],["T_WHITESPACE","    ",157],["T_VARIABLE","$edit",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_ARRAY","array",157],"(",["T_WHITESPACE","\n      ",157],["T_CONSTANT_ENCAPSED_STRING","'keys'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","\"'\"",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_VARIABLE","$comment_body",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","\"'\"",158],",",["T_WHITESPACE","\n    ",158],")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","drupalPostForm",160],"(",["T_STRING","NULL",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$edit",160],",",["T_WHITESPACE"," ",160],["T_STRING","t",160],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",160],")",")",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertText",161],"(",["T_VARIABLE","$node2",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","label",161],"(",")",",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Node found in search results.'",161],")",";",["T_WHITESPACE","\n\n    ",161],["T_COMMENT","\/\/ Verify that comment is rendered using proper format.\n",163],["T_WHITESPACE","    ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","assertText",164],"(",["T_VARIABLE","$comment_body",164],",",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","'Comment body text found in search results.'",164],")",";",["T_WHITESPACE","\n    ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","assertNoRaw",165],"(",["T_STRING","t",165],"(",["T_CONSTANT_ENCAPSED_STRING","'n\/a'",165],")",",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'HTML in comment body is not hidden.'",165],")",";",["T_WHITESPACE","\n    ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","assertNoEscaped",166],"(",["T_VARIABLE","$edit_comment",166],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][value]'",166],"]",",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'HTML in comment body is not escaped.'",166],")",";",["T_WHITESPACE","\n\n    ",166],["T_COMMENT","\/\/ Search for the evil script comment subject.\n",168],["T_WHITESPACE","    ",169],["T_VARIABLE","$edit",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_ARRAY","array",169],"(",["T_WHITESPACE","\n      ",169],["T_CONSTANT_ENCAPSED_STRING","'keys'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'subjectkeyword'",170],",",["T_WHITESPACE","\n    ",170],")",";",["T_WHITESPACE","\n    ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","drupalPostForm",172],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$edit",172],",",["T_WHITESPACE"," ",172],["T_STRING","t",172],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",172],")",")",";",["T_WHITESPACE","\n\n    ",172],["T_COMMENT","\/\/ Verify the evil comment subject is escaped in search results.\n",174],["T_WHITESPACE","    ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","assertRaw",175],"(",["T_CONSTANT_ENCAPSED_STRING","'&lt;script&gt;alert(&#039;<strong>subjectkeyword<\/strong>&#039;);'",175],")",";",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","assertNoRaw",176],"(",["T_CONSTANT_ENCAPSED_STRING","'<script>'",176],")",";",["T_WHITESPACE","\n\n    ",176],["T_COMMENT","\/\/ Search for the keyword near the evil script tag in the comment body.\n",178],["T_WHITESPACE","    ",179],["T_VARIABLE","$edit",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],"[",["T_WHITESPACE","\n      ",179],["T_CONSTANT_ENCAPSED_STRING","'keys'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'nearbykeyword'",180],",",["T_WHITESPACE","\n    ",180],"]",";",["T_WHITESPACE","\n    ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","drupalPostForm",182],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$edit",182],",",["T_WHITESPACE"," ",182],["T_STRING","t",182],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",182],")",")",";",["T_WHITESPACE","\n\n    ",182],["T_COMMENT","\/\/ Verify that nearby script tag in the evil comment body is stripped from\n",184],["T_WHITESPACE","    ",185],["T_COMMENT","\/\/ search results.\n",185],["T_WHITESPACE","    ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","assertRaw",186],"(",["T_CONSTANT_ENCAPSED_STRING","'<strong>nearbykeyword<\/strong>'",186],")",";",["T_WHITESPACE","\n    ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","assertNoRaw",187],"(",["T_CONSTANT_ENCAPSED_STRING","'<script>'",187],")",";",["T_WHITESPACE","\n\n    ",187],["T_COMMENT","\/\/ Search for contents inside the evil script tag in the comment body.\n",189],["T_WHITESPACE","    ",190],["T_VARIABLE","$edit",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],"[",["T_WHITESPACE","\n      ",190],["T_CONSTANT_ENCAPSED_STRING","'keys'",191],["T_WHITESPACE"," ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","'insidekeyword'",191],",",["T_WHITESPACE","\n    ",191],"]",";",["T_WHITESPACE","\n    ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","drupalPostForm",193],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$edit",193],",",["T_WHITESPACE"," ",193],["T_STRING","t",193],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",193],")",")",";",["T_WHITESPACE","\n\n    ",193],["T_COMMENT","\/\/ @todo Verify the actual search results.\n",195],["T_WHITESPACE","    ",196],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2551135\n",196],["T_WHITESPACE","\n    ",197],["T_COMMENT","\/\/ Verify there is no script tag in search results.\n",198],["T_WHITESPACE","    ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","assertNoRaw",199],"(",["T_CONSTANT_ENCAPSED_STRING","'<script>'",199],")",";",["T_WHITESPACE","\n\n    ",199],["T_COMMENT","\/\/ Hide comments.\n",201],["T_WHITESPACE","    ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","drupalLogin",202],"(",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","adminUser",202],")",";",["T_WHITESPACE","\n    ",202],["T_VARIABLE","$node",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","set",203],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",203],",",["T_WHITESPACE"," ",203],["T_STRING","CommentItemInterface",203],["T_DOUBLE_COLON","::",203],["T_STRING","HIDDEN",203],")",";",["T_WHITESPACE","\n    ",203],["T_VARIABLE","$node",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","save",204],"(",")",";",["T_WHITESPACE","\n\n    ",204],["T_COMMENT","\/\/ Invoke search index update.\n",206],["T_WHITESPACE","    ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","drupalLogout",207],"(",")",";",["T_WHITESPACE","\n    ",207],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","cronRun",208],"(",")",";",["T_WHITESPACE","\n\n    ",208],["T_COMMENT","\/\/ Search for $title.\n",210],["T_WHITESPACE","    ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","drupalPostForm",211],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",211],",",["T_WHITESPACE"," ",211],["T_VARIABLE","$edit",211],",",["T_WHITESPACE"," ",211],["T_STRING","t",211],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",211],")",")",";",["T_WHITESPACE","\n    ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","assertText",212],"(",["T_STRING","t",212],"(",["T_CONSTANT_ENCAPSED_STRING","'Your search yielded no results.'",212],")",")",";",["T_WHITESPACE","\n  ",212],"}",["T_WHITESPACE","\n\n  ",213],["T_DOC_COMMENT","\/**\n   * Verify access rules for comment indexing with different permissions.\n   *\/",215],["T_WHITESPACE","\n  ",217],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","testSearchResultsCommentAccess",218],"(",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n    ",218],["T_VARIABLE","$comment_body",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_CONSTANT_ENCAPSED_STRING","'Test comment body'",219],";",["T_WHITESPACE","\n    ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","commentSubject",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'Test comment subject'",220],";",["T_WHITESPACE","\n    ",220],["T_VARIABLE","$roles",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","adminUser",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getRoles",221],"(",["T_STRING","TRUE",221],")",";",["T_WHITESPACE","\n    ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","adminRole",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$roles",222],"[",["T_LNUMBER","0",222],"]",";",["T_WHITESPACE","\n\n    ",222],["T_COMMENT","\/\/ Create a node.\n",224],["T_WHITESPACE","    ",225],["T_COMMENT","\/\/ Make preview optional.\n",225],["T_WHITESPACE","    ",226],["T_VARIABLE","$field",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","FieldConfig",226],["T_DOUBLE_COLON","::",226],["T_STRING","loadByName",226],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",226],",",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'article'",226],",",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'comment'",226],")",";",["T_WHITESPACE","\n    ",226],["T_VARIABLE","$field",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","setSetting",227],"(",["T_CONSTANT_ENCAPSED_STRING","'preview'",227],",",["T_WHITESPACE"," ",227],["T_STRING","DRUPAL_OPTIONAL",227],")",";",["T_WHITESPACE","\n    ",227],["T_VARIABLE","$field",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","save",228],"(",")",";",["T_WHITESPACE","\n    ",228],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","node",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","drupalCreateNode",229],"(",["T_ARRAY","array",229],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_CONSTANT_ENCAPSED_STRING","'article'",229],")",")",";",["T_WHITESPACE","\n\n    ",229],["T_COMMENT","\/\/ Post a comment using 'Full HTML' text format.\n",231],["T_WHITESPACE","    ",232],["T_VARIABLE","$edit_comment",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_ARRAY","array",232],"(",")",";",["T_WHITESPACE","\n    ",232],["T_VARIABLE","$edit_comment",233],"[",["T_CONSTANT_ENCAPSED_STRING","'subject[0][value]'",233],"]",["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","commentSubject",233],";",["T_WHITESPACE","\n    ",233],["T_VARIABLE","$edit_comment",234],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_body[0][value]'",234],"]",["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'<h1>'",234],["T_WHITESPACE"," ",234],".",["T_WHITESPACE"," ",234],["T_VARIABLE","$comment_body",234],["T_WHITESPACE"," ",234],".",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'<\/h1>'",234],";",["T_WHITESPACE","\n    ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","drupalPostForm",235],"(",["T_CONSTANT_ENCAPSED_STRING","'comment\/reply\/node\/'",235],["T_WHITESPACE"," ",235],".",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","node",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","id",235],"(",")",["T_WHITESPACE"," ",235],".",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'\/comment'",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$edit_comment",235],",",["T_WHITESPACE"," ",235],["T_STRING","t",235],"(",["T_CONSTANT_ENCAPSED_STRING","'Save'",235],")",")",";",["T_WHITESPACE","\n\n    ",235],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","drupalLogout",237],"(",")",";",["T_WHITESPACE","\n    ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setRolePermissions",238],"(",["T_STRING","RoleInterface",238],["T_DOUBLE_COLON","::",238],["T_STRING","ANONYMOUS_ID",238],")",";",["T_WHITESPACE","\n    ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","assertCommentAccess",239],"(",["T_STRING","FALSE",239],",",["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","'Anon user has search permission but no access comments permission, comments should not be indexed'",239],")",";",["T_WHITESPACE","\n\n    ",239],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setRolePermissions",241],"(",["T_STRING","RoleInterface",241],["T_DOUBLE_COLON","::",241],["T_STRING","ANONYMOUS_ID",241],",",["T_WHITESPACE"," ",241],["T_STRING","TRUE",241],")",";",["T_WHITESPACE","\n    ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","assertCommentAccess",242],"(",["T_STRING","TRUE",242],",",["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","'Anon user has search permission and access comments permission, comments should be indexed'",242],")",";",["T_WHITESPACE","\n\n    ",242],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","drupalLogin",244],"(",["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","adminUser",244],")",";",["T_WHITESPACE","\n    ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","drupalGet",245],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/people\/permissions'",245],")",";",["T_WHITESPACE","\n\n    ",245],["T_COMMENT","\/\/ Disable search access for authenticated user to test admin user.\n",247],["T_WHITESPACE","    ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","setRolePermissions",248],"(",["T_STRING","RoleInterface",248],["T_DOUBLE_COLON","::",248],["T_STRING","AUTHENTICATED_ID",248],",",["T_WHITESPACE"," ",248],["T_STRING","FALSE",248],",",["T_WHITESPACE"," ",248],["T_STRING","FALSE",248],")",";",["T_WHITESPACE","\n\n    ",248],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","setRolePermissions",250],"(",["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","adminRole",250],")",";",["T_WHITESPACE","\n    ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","assertCommentAccess",251],"(",["T_STRING","FALSE",251],",",["T_WHITESPACE"," ",251],["T_CONSTANT_ENCAPSED_STRING","'Admin user has search permission but no access comments permission, comments should not be indexed'",251],")",";",["T_WHITESPACE","\n\n    ",251],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","drupalGet",253],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",253],["T_WHITESPACE"," ",253],".",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","node",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","id",253],"(",")",")",";",["T_WHITESPACE","\n    ",253],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","setRolePermissions",254],"(",["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","adminRole",254],",",["T_WHITESPACE"," ",254],["T_STRING","TRUE",254],")",";",["T_WHITESPACE","\n    ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","assertCommentAccess",255],"(",["T_STRING","TRUE",255],",",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'Admin user has search permission and access comments permission, comments should be indexed'",255],")",";",["T_WHITESPACE","\n\n    ",255],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","setRolePermissions",257],"(",["T_STRING","RoleInterface",257],["T_DOUBLE_COLON","::",257],["T_STRING","AUTHENTICATED_ID",257],")",";",["T_WHITESPACE","\n    ",257],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","assertCommentAccess",258],"(",["T_STRING","FALSE",258],",",["T_WHITESPACE"," ",258],["T_CONSTANT_ENCAPSED_STRING","'Authenticated user has search permission but no access comments permission, comments should not be indexed'",258],")",";",["T_WHITESPACE","\n\n    ",258],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","setRolePermissions",260],"(",["T_STRING","RoleInterface",260],["T_DOUBLE_COLON","::",260],["T_STRING","AUTHENTICATED_ID",260],",",["T_WHITESPACE"," ",260],["T_STRING","TRUE",260],")",";",["T_WHITESPACE","\n    ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","assertCommentAccess",261],"(",["T_STRING","TRUE",261],",",["T_WHITESPACE"," ",261],["T_CONSTANT_ENCAPSED_STRING","'Authenticated user has search permission and access comments permission, comments should be indexed'",261],")",";",["T_WHITESPACE","\n\n    ",261],["T_COMMENT","\/\/ Verify that access comments permission is inherited from the\n",263],["T_WHITESPACE","    ",264],["T_COMMENT","\/\/ authenticated role.\n",264],["T_WHITESPACE","    ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setRolePermissions",265],"(",["T_STRING","RoleInterface",265],["T_DOUBLE_COLON","::",265],["T_STRING","AUTHENTICATED_ID",265],",",["T_WHITESPACE"," ",265],["T_STRING","TRUE",265],",",["T_WHITESPACE"," ",265],["T_STRING","FALSE",265],")",";",["T_WHITESPACE","\n    ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","setRolePermissions",266],"(",["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","adminRole",266],")",";",["T_WHITESPACE","\n    ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","assertCommentAccess",267],"(",["T_STRING","TRUE",267],",",["T_WHITESPACE"," ",267],["T_CONSTANT_ENCAPSED_STRING","'Admin user has search permission and no access comments permission, but comments should be indexed because admin user inherits authenticated user\\'s permission to access comments'",267],")",";",["T_WHITESPACE","\n\n    ",267],["T_COMMENT","\/\/ Verify that search content permission is inherited from the authenticated\n",269],["T_WHITESPACE","    ",270],["T_COMMENT","\/\/ role.\n",270],["T_WHITESPACE","    ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","setRolePermissions",271],"(",["T_STRING","RoleInterface",271],["T_DOUBLE_COLON","::",271],["T_STRING","AUTHENTICATED_ID",271],",",["T_WHITESPACE"," ",271],["T_STRING","TRUE",271],",",["T_WHITESPACE"," ",271],["T_STRING","TRUE",271],")",";",["T_WHITESPACE","\n    ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","setRolePermissions",272],"(",["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","adminRole",272],",",["T_WHITESPACE"," ",272],["T_STRING","TRUE",272],",",["T_WHITESPACE"," ",272],["T_STRING","FALSE",272],")",";",["T_WHITESPACE","\n    ",272],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","assertCommentAccess",273],"(",["T_STRING","TRUE",273],",",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","'Admin user has access comments permission and no search permission, but comments should be indexed because admin user inherits authenticated user\\'s permission to search'",273],")",";",["T_WHITESPACE","\n  ",273],"}",["T_WHITESPACE","\n\n  ",274],["T_DOC_COMMENT","\/**\n   * Set permissions for role.\n   *\/",276],["T_WHITESPACE","\n  ",278],["T_FUNCTION","function",279],["T_WHITESPACE"," ",279],["T_STRING","setRolePermissions",279],"(",["T_VARIABLE","$rid",279],",",["T_WHITESPACE"," ",279],["T_VARIABLE","$access_comments",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_STRING","FALSE",279],",",["T_WHITESPACE"," ",279],["T_VARIABLE","$search_content",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_STRING","TRUE",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n    ",279],["T_VARIABLE","$permissions",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_ARRAY","array",280],"(",["T_WHITESPACE","\n      ",280],["T_CONSTANT_ENCAPSED_STRING","'access comments'",281],["T_WHITESPACE"," ",281],["T_DOUBLE_ARROW","=>",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$access_comments",281],",",["T_WHITESPACE","\n      ",281],["T_CONSTANT_ENCAPSED_STRING","'search content'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$search_content",282],",",["T_WHITESPACE","\n    ",282],")",";",["T_WHITESPACE","\n    ",283],["T_STRING","user_role_change_permissions",284],"(",["T_VARIABLE","$rid",284],",",["T_WHITESPACE"," ",284],["T_VARIABLE","$permissions",284],")",";",["T_WHITESPACE","\n  ",284],"}",["T_WHITESPACE","\n\n  ",285],["T_DOC_COMMENT","\/**\n   * Update search index and search for comment.\n   *\/",287],["T_WHITESPACE","\n  ",289],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","assertCommentAccess",290],"(",["T_VARIABLE","$assume_access",290],",",["T_WHITESPACE"," ",290],["T_VARIABLE","$message",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n    ",290],["T_COMMENT","\/\/ Invoke search index update.\n",291],["T_WHITESPACE","    ",292],["T_STRING","search_mark_for_reindex",292],"(",["T_CONSTANT_ENCAPSED_STRING","'node_search'",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","node",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","id",292],"(",")",")",";",["T_WHITESPACE","\n    ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","cronRun",293],"(",")",";",["T_WHITESPACE","\n\n    ",293],["T_COMMENT","\/\/ Search for the comment subject.\n",295],["T_WHITESPACE","    ",296],["T_VARIABLE","$edit",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_ARRAY","array",296],"(",["T_WHITESPACE","\n      ",296],["T_CONSTANT_ENCAPSED_STRING","'keys'",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","\"'\"",297],["T_WHITESPACE"," ",297],".",["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","commentSubject",297],["T_WHITESPACE"," ",297],".",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","\"'\"",297],",",["T_WHITESPACE","\n    ",297],")",";",["T_WHITESPACE","\n    ",298],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","drupalPostForm",299],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",299],",",["T_WHITESPACE"," ",299],["T_VARIABLE","$edit",299],",",["T_WHITESPACE"," ",299],["T_STRING","t",299],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",299],")",")",";",["T_WHITESPACE","\n\n    ",299],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$assume_access",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n      ",301],["T_VARIABLE","$expected_node_result",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","assertText",302],"(",["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","node",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","label",302],"(",")",")",";",["T_WHITESPACE","\n      ",302],["T_VARIABLE","$expected_comment_result",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","assertText",303],"(",["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","commentSubject",303],")",";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n    ",304],["T_ELSE","else",305],["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n      ",305],["T_VARIABLE","$expected_node_result",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","assertText",306],"(",["T_STRING","t",306],"(",["T_CONSTANT_ENCAPSED_STRING","'Your search yielded no results.'",306],")",")",";",["T_WHITESPACE","\n      ",306],["T_VARIABLE","$expected_comment_result",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","assertText",307],"(",["T_STRING","t",307],"(",["T_CONSTANT_ENCAPSED_STRING","'Your search yielded no results.'",307],")",")",";",["T_WHITESPACE","\n    ",307],"}",["T_WHITESPACE","\n    ",308],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","assertTrue",309],"(",["T_VARIABLE","$expected_node_result",309],["T_WHITESPACE"," ",309],["T_BOOLEAN_AND","&&",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$expected_comment_result",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$message",309],")",";",["T_WHITESPACE","\n  ",309],"}",["T_WHITESPACE","\n\n  ",310],["T_DOC_COMMENT","\/**\n   * Verify that 'add new comment' does not appear in search results or index.\n   *\/",312],["T_WHITESPACE","\n  ",314],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","testAddNewComment",315],"(",")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n    ",315],["T_COMMENT","\/\/ Create a node with a short body.\n",316],["T_WHITESPACE","    ",317],["T_VARIABLE","$settings",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_ARRAY","array",317],"(",["T_WHITESPACE","\n      ",317],["T_CONSTANT_ENCAPSED_STRING","'type'",318],["T_WHITESPACE"," ",318],["T_DOUBLE_ARROW","=>",318],["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'article'",318],",",["T_WHITESPACE","\n      ",318],["T_CONSTANT_ENCAPSED_STRING","'title'",319],["T_WHITESPACE"," ",319],["T_DOUBLE_ARROW","=>",319],["T_WHITESPACE"," ",319],["T_CONSTANT_ENCAPSED_STRING","'short title'",319],",",["T_WHITESPACE","\n      ",319],["T_CONSTANT_ENCAPSED_STRING","'body'",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_ARRAY","array",320],"(",["T_ARRAY","array",320],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'short body text'",320],")",")",",",["T_WHITESPACE","\n    ",320],")",";",["T_WHITESPACE","\n\n    ",321],["T_VARIABLE","$user",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","drupalCreateUser",323],"(",["T_ARRAY","array",323],"(",["T_WHITESPACE","\n      ",323],["T_CONSTANT_ENCAPSED_STRING","'search content'",324],",",["T_WHITESPACE","\n      ",324],["T_CONSTANT_ENCAPSED_STRING","'create article content'",325],",",["T_WHITESPACE","\n      ",325],["T_CONSTANT_ENCAPSED_STRING","'access content'",326],",",["T_WHITESPACE","\n      ",326],["T_CONSTANT_ENCAPSED_STRING","'post comments'",327],",",["T_WHITESPACE","\n      ",327],["T_CONSTANT_ENCAPSED_STRING","'access comments'",328],",",["T_WHITESPACE","\n    ",328],")",")",";",["T_WHITESPACE","\n    ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","drupalLogin",330],"(",["T_VARIABLE","$user",330],")",";",["T_WHITESPACE","\n\n    ",330],["T_VARIABLE","$node",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","drupalCreateNode",332],"(",["T_VARIABLE","$settings",332],")",";",["T_WHITESPACE","\n    ",332],["T_COMMENT","\/\/ Verify that if you view the node on its own page, 'add new comment'\n",333],["T_WHITESPACE","    ",334],["T_COMMENT","\/\/ is there.\n",334],["T_WHITESPACE","    ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","drupalGet",335],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/'",335],["T_WHITESPACE"," ",335],".",["T_WHITESPACE"," ",335],["T_VARIABLE","$node",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","id",335],"(",")",")",";",["T_WHITESPACE","\n    ",335],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","assertText",336],"(",["T_STRING","t",336],"(",["T_CONSTANT_ENCAPSED_STRING","'Add new comment'",336],")",")",";",["T_WHITESPACE","\n\n    ",336],["T_COMMENT","\/\/ Run cron to index this page.\n",338],["T_WHITESPACE","    ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","drupalLogout",339],"(",")",";",["T_WHITESPACE","\n    ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","cronRun",340],"(",")",";",["T_WHITESPACE","\n\n    ",340],["T_COMMENT","\/\/ Search for 'comment'. Should be no results.\n",342],["T_WHITESPACE","    ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","drupalLogin",343],"(",["T_VARIABLE","$user",343],")",";",["T_WHITESPACE","\n    ",343],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","drupalPostForm",344],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",344],",",["T_WHITESPACE"," ",344],["T_ARRAY","array",344],"(",["T_CONSTANT_ENCAPSED_STRING","'keys'",344],["T_WHITESPACE"," ",344],["T_DOUBLE_ARROW","=>",344],["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","'comment'",344],")",",",["T_WHITESPACE"," ",344],["T_STRING","t",344],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",344],")",")",";",["T_WHITESPACE","\n    ",344],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","assertText",345],"(",["T_STRING","t",345],"(",["T_CONSTANT_ENCAPSED_STRING","'Your search yielded no results'",345],")",")",";",["T_WHITESPACE","\n\n    ",345],["T_COMMENT","\/\/ Search for the node title. Should be found, and 'Add new comment' should\n",347],["T_WHITESPACE","    ",348],["T_COMMENT","\/\/ not be part of the search snippet.\n",348],["T_WHITESPACE","    ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","drupalPostForm",349],"(",["T_CONSTANT_ENCAPSED_STRING","'search\/node'",349],",",["T_WHITESPACE"," ",349],["T_ARRAY","array",349],"(",["T_CONSTANT_ENCAPSED_STRING","'keys'",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_CONSTANT_ENCAPSED_STRING","'short'",349],")",",",["T_WHITESPACE"," ",349],["T_STRING","t",349],"(",["T_CONSTANT_ENCAPSED_STRING","'Search'",349],")",")",";",["T_WHITESPACE","\n    ",349],["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","assertText",350],"(",["T_VARIABLE","$node",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","label",350],"(",")",",",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'Search for keyword worked'",350],")",";",["T_WHITESPACE","\n    ",350],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","assertNoText",351],"(",["T_STRING","t",351],"(",["T_CONSTANT_ENCAPSED_STRING","'Add new comment'",351],")",")",";",["T_WHITESPACE","\n  ",351],"}",["T_WHITESPACE","\n\n",352],"}",["T_WHITESPACE","\n",354]]