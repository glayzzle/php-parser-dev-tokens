[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","search",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Unicode",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Query",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SelectExtender",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Query",7],["T_NS_SEPARATOR","\\",7],["T_STRING","SelectInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Search query extender and helper functions.\n *\n * Performs a query on the full-text search index for a word or words.\n *\n * This query is used by search plugins that use the search index (not all\n * search plugins do, as some use a different searching mechanism). It\n * assumes you have set up a query on the {search_index} table with alias 'i',\n * and will only work if the user is searching for at least one \"positive\"\n * keyword or phrase.\n *\n * For efficiency, users of this query can run the prepareAndNormalize()\n * method to figure out if there are any search results, before fully setting\n * up and calling execute() to execute the query. The scoring expressions are\n * not needed until the execute() step. However, it's not really necessary\n * to do this, because this class's execute() method does that anyway.\n *\n * During both the prepareAndNormalize() and execute() steps, there can be\n * problems. Call getStatus() to figure out if the query is OK or not.\n *\n * The query object is given the tag 'search_$type' and can be further\n * extended with hook_query_alter().\n *\/",9],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","SearchQuery",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","SelectExtender",32],["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * Indicates no positive keywords were in the search expression.\n   *\n   * Positive keywords are words that are searched for, as opposed to negative\n   * keywords, which are words that are excluded. To count as a keyword, a\n   * word must be at least\n   * \\Drupal::config('search.settings')->get('index.minimum_word_size')\n   * characters.\n   *\n   * @see SearchQuery::getStatus()\n   *\/",34],["T_WHITESPACE","\n  ",44],["T_CONST","const",45],["T_WHITESPACE"," ",45],["T_STRING","NO_POSITIVE_KEYWORDS",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_LNUMBER","1",45],";",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * Indicates that part of the search expression was ignored.\n   *\n   * To prevent Denial of Service attacks, only\n   * \\Drupal::config('search.settings')->get('and_or_limit') expressions\n   * (positive keywords, phrases, negative keywords) are allowed; this flag\n   * indicates that expressions existed past that limit and they were removed.\n   *\n   * @see SearchQuery::getStatus()\n   *\/",47],["T_WHITESPACE","\n  ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","EXPRESSIONS_IGNORED",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_LNUMBER","2",57],";",["T_WHITESPACE","\n\n  ",57],["T_DOC_COMMENT","\/**\n   * Indicates that lower-case \"or\" was in the search expression.\n   *\n   * The word \"or\" in lower case was found in the search expression. This\n   * probably means someone was trying to do an OR search but used lower-case\n   * instead of upper-case.\n   *\n   * @see SearchQuery::getStatus()\n   *\/",59],["T_WHITESPACE","\n  ",67],["T_CONST","const",68],["T_WHITESPACE"," ",68],["T_STRING","LOWER_CASE_OR",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_LNUMBER","4",68],";",["T_WHITESPACE","\n\n  ",68],["T_DOC_COMMENT","\/**\n   * Indicates that no positive keyword matches were found.\n   *\n   * @see SearchQuery::getStatus()\n   *\/",70],["T_WHITESPACE","\n  ",74],["T_CONST","const",75],["T_WHITESPACE"," ",75],["T_STRING","NO_KEYWORD_MATCHES",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_LNUMBER","8",75],";",["T_WHITESPACE","\n\n  ",75],["T_DOC_COMMENT","\/**\n   * The keywords and advanced search options that are entered by the user.\n   *\n   * @var string\n   *\/",77],["T_WHITESPACE","\n  ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$searchExpression",82],";",["T_WHITESPACE","\n\n  ",82],["T_DOC_COMMENT","\/**\n   * The type of search (search type).\n   *\n   * This maps to the value of the type column in search_index, and is usually\n   * equal to the machine-readable name of the plugin or the search page.\n   *\n   * @var string\n   *\/",84],["T_WHITESPACE","\n  ",91],["T_PROTECTED","protected",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$type",92],";",["T_WHITESPACE","\n\n  ",92],["T_DOC_COMMENT","\/**\n   * Parsed-out positive and negative search keys.\n   *\n   * @var array\n   *\/",94],["T_WHITESPACE","\n  ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$keys",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_CONSTANT_ENCAPSED_STRING","'positive'",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",")",",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'negative'",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",")",")",";",["T_WHITESPACE","\n\n  ",99],["T_DOC_COMMENT","\/**\n   * Indicates whether the query conditions are simple or complex (LIKE).\n   *\n   * @var bool\n   *\/",101],["T_WHITESPACE","\n  ",105],["T_PROTECTED","protected",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$simple",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","TRUE",106],";",["T_WHITESPACE","\n\n  ",106],["T_DOC_COMMENT","\/**\n   * Conditions that are used for exact searches.\n   *\n   * This is always used for the second step in the query, but is not part of\n   * the preparation step unless $this->simple is FALSE.\n   *\n   * @var DatabaseCondition\n   *\/",108],["T_WHITESPACE","\n  ",115],["T_PROTECTED","protected",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$conditions",116],";",["T_WHITESPACE","\n\n  ",116],["T_DOC_COMMENT","\/**\n   * Indicates how many matches for a search query are necessary.\n   *\n   * @var int\n   *\/",118],["T_WHITESPACE","\n  ",122],["T_PROTECTED","protected",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$matches",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_LNUMBER","0",123],";",["T_WHITESPACE","\n\n  ",123],["T_DOC_COMMENT","\/**\n   * Array of positive search words.\n   *\n   * These words have to match against {search_index}.word.\n   *\n   * @var array\n   *\/",125],["T_WHITESPACE","\n  ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$words",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",")",";",["T_WHITESPACE","\n\n  ",132],["T_DOC_COMMENT","\/**\n   * Multiplier to normalize the keyword score.\n   *\n   * This value is calculated by the preparation step, and is used as a\n   * multiplier of the word scores to make sure they are between 0 and 1.\n   *\n   * @var float\n   *\/",134],["T_WHITESPACE","\n  ",141],["T_PROTECTED","protected",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$normalize",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_LNUMBER","0",142],";",["T_WHITESPACE","\n\n  ",142],["T_DOC_COMMENT","\/**\n   * Indicates whether the preparation step has been executed.\n   *\n   * @var bool\n   *\/",144],["T_WHITESPACE","\n  ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$executedPrepare",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","FALSE",149],";",["T_WHITESPACE","\n\n  ",149],["T_DOC_COMMENT","\/**\n   * A bitmap of status conditions, described in getStatus().\n   *\n   * @var int\n   *\n   * @see SearchQuery::getStatus()\n   *\/",151],["T_WHITESPACE","\n  ",157],["T_PROTECTED","protected",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$status",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_LNUMBER","0",158],";",["T_WHITESPACE","\n\n  ",158],["T_DOC_COMMENT","\/**\n   * The word score expressions.\n   *\n   * @var array\n   *\n   * @see SearchQuery::addScore()\n   *\/",160],["T_WHITESPACE","\n  ",166],["T_PROTECTED","protected",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$scores",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",")",";",["T_WHITESPACE","\n\n  ",167],["T_DOC_COMMENT","\/**\n   * Arguments for the score expressions.\n   *\n   * @var array\n   *\/",169],["T_WHITESPACE","\n  ",173],["T_PROTECTED","protected",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$scoresArguments",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_ARRAY","array",174],"(",")",";",["T_WHITESPACE","\n\n  ",174],["T_DOC_COMMENT","\/**\n   * The number of 'i.relevance' occurrences in score expressions.\n   *\n   * @var int\n   *\/",176],["T_WHITESPACE","\n  ",180],["T_PROTECTED","protected",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$relevance_count",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_LNUMBER","0",181],";",["T_WHITESPACE","\n\n  ",181],["T_DOC_COMMENT","\/**\n   * Multipliers for score expressions.\n   *\n   * @var array\n   *\/",183],["T_WHITESPACE","\n  ",187],["T_PROTECTED","protected",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$multiply",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_ARRAY","array",188],"(",")",";",["T_WHITESPACE","\n\n  ",188],["T_DOC_COMMENT","\/**\n   * Sets the search query expression.\n   *\n   * @param string $expression\n   *   A search string, which can contain keywords and options.\n   * @param string $type\n   *   The search type. This maps to {search_index}.type in the database.\n   *\n   * @return $this\n   *\/",190],["T_WHITESPACE","\n  ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","searchExpression",200],"(",["T_VARIABLE","$expression",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$type",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n    ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","searchExpression",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$expression",201],";",["T_WHITESPACE","\n    ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","type",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$type",202],";",["T_WHITESPACE","\n\n    ",202],["T_COMMENT","\/\/ Add query tag.\n",204],["T_WHITESPACE","    ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","addTag",205],"(",["T_CONSTANT_ENCAPSED_STRING","'search_'",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_VARIABLE","$type",205],")",";",["T_WHITESPACE","\n\n    ",205],["T_COMMENT","\/\/ Initialize conditions and status.\n",207],["T_WHITESPACE","    ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","conditions",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","db_and",208],"(",")",";",["T_WHITESPACE","\n    ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","status",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_LNUMBER","0",209],";",["T_WHITESPACE","\n\n    ",209],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],";",["T_WHITESPACE","\n  ",211],"}",["T_WHITESPACE","\n\n  ",212],["T_DOC_COMMENT","\/**\n   * Parses the search query into SQL conditions.\n   *\n   * Sets up the following variables:\n   * - $this->keys\n   * - $this->words\n   * - $this->conditions\n   * - $this->simple\n   * - $this->matches\n   *\/",214],["T_WHITESPACE","\n  ",223],["T_PROTECTED","protected",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","parseSearchExpression",224],"(",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n    ",224],["T_COMMENT","\/\/ Matches words optionally prefixed by a - sign. A word in this case is\n",225],["T_WHITESPACE","    ",226],["T_COMMENT","\/\/ something between two spaces, optionally quoted.\n",226],["T_WHITESPACE","    ",227],["T_STRING","preg_match_all",227],"(",["T_CONSTANT_ENCAPSED_STRING","'\/ (-?)(\"[^\"]+\"|[^\" ]+)\/i'",227],",",["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","' '",227],["T_WHITESPACE"," ",227],".",["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","searchExpression",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$keywords",227],",",["T_WHITESPACE"," ",227],["T_STRING","PREG_SET_ORDER",227],")",";",["T_WHITESPACE","\n\n    ",227],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_STRING","count",229],"(",["T_VARIABLE","$keywords",229],")",["T_WHITESPACE"," ",229],["T_IS_EQUAL","==",229],["T_WHITESPACE"," ",229],["T_LNUMBER","0",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n      ",229],["T_RETURN","return",230],";",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_COMMENT","\/\/ Classify tokens.\n",233],["T_WHITESPACE","    ",234],["T_VARIABLE","$in_or",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","FALSE",234],";",["T_WHITESPACE","\n    ",234],["T_VARIABLE","$limit_combinations",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_NS_SEPARATOR","\\",235],["T_STRING","Drupal",235],["T_DOUBLE_COLON","::",235],["T_STRING","config",235],"(",["T_CONSTANT_ENCAPSED_STRING","'search.settings'",235],")",["T_OBJECT_OPERATOR","->",235],["T_STRING","get",235],"(",["T_CONSTANT_ENCAPSED_STRING","'and_or_limit'",235],")",";",["T_WHITESPACE","\n    ",235],["T_COMMENT","\/\/ The first search expression does not count as AND.\n",236],["T_WHITESPACE","    ",237],["T_VARIABLE","$and_count",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],"-",["T_LNUMBER","1",237],";",["T_WHITESPACE","\n    ",237],["T_VARIABLE","$or_count",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_LNUMBER","0",238],";",["T_WHITESPACE","\n    ",238],["T_FOREACH","foreach",239],["T_WHITESPACE"," ",239],"(",["T_VARIABLE","$keywords",239],["T_WHITESPACE"," ",239],["T_AS","as",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$match",239],")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n      ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$or_count",240],["T_WHITESPACE"," ",240],["T_BOOLEAN_AND","&&",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$and_count",240],["T_WHITESPACE"," ",240],"+",["T_WHITESPACE"," ",240],["T_VARIABLE","$or_count",240],["T_WHITESPACE"," ",240],["T_IS_GREATER_OR_EQUAL",">=",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$limit_combinations",240],")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n        ",240],["T_COMMENT","\/\/ Ignore all further search expressions to prevent Denial-of-Service\n",241],["T_WHITESPACE","        ",242],["T_COMMENT","\/\/ attacks using a high number of AND\/OR combinations.\n",242],["T_WHITESPACE","        ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","status",243],["T_WHITESPACE"," ",243],["T_OR_EQUAL","|=",243],["T_WHITESPACE"," ",243],["T_STRING","SearchQuery",243],["T_DOUBLE_COLON","::",243],["T_STRING","EXPRESSIONS_IGNORED",243],";",["T_WHITESPACE","\n        ",243],["T_BREAK","break",244],";",["T_WHITESPACE","\n      ",244],"}",["T_WHITESPACE","\n\n      ",245],["T_COMMENT","\/\/ Strip off phrase quotes.\n",247],["T_WHITESPACE","      ",248],["T_VARIABLE","$phrase",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","FALSE",248],";",["T_WHITESPACE","\n      ",248],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$match",249],"[",["T_LNUMBER","2",249],"]","{",["T_LNUMBER","0",249],"}",["T_WHITESPACE"," ",249],["T_IS_EQUAL","==",249],["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","'\"'",249],")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$match",250],"[",["T_LNUMBER","2",250],"]",["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_STRING","substr",250],"(",["T_VARIABLE","$match",250],"[",["T_LNUMBER","2",250],"]",",",["T_WHITESPACE"," ",250],["T_LNUMBER","1",250],",",["T_WHITESPACE"," ",250],"-",["T_LNUMBER","1",250],")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$phrase",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","TRUE",251],";",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","simple",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_STRING","FALSE",252],";",["T_WHITESPACE","\n      ",252],"}",["T_WHITESPACE","\n\n      ",253],["T_COMMENT","\/\/ Simplify keyword according to indexing rules and external\n",255],["T_WHITESPACE","      ",256],["T_COMMENT","\/\/ preprocessors. Use same process as during search indexing, so it\n",256],["T_WHITESPACE","      ",257],["T_COMMENT","\/\/ will match search index.\n",257],["T_WHITESPACE","      ",258],["T_VARIABLE","$words",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_STRING","search_simplify",258],"(",["T_VARIABLE","$match",258],"[",["T_LNUMBER","2",258],"]",")",";",["T_WHITESPACE","\n      ",258],["T_COMMENT","\/\/ Re-explode in case simplification added more words, except when\n",259],["T_WHITESPACE","      ",260],["T_COMMENT","\/\/ matching a phrase.\n",260],["T_WHITESPACE","      ",261],["T_VARIABLE","$words",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$phrase",261],["T_WHITESPACE"," ",261],"?",["T_WHITESPACE"," ",261],["T_ARRAY","array",261],"(",["T_VARIABLE","$words",261],")",["T_WHITESPACE"," ",261],":",["T_WHITESPACE"," ",261],["T_STRING","preg_split",261],"(",["T_CONSTANT_ENCAPSED_STRING","'\/ \/'",261],",",["T_WHITESPACE"," ",261],["T_VARIABLE","$words",261],",",["T_WHITESPACE"," ",261],"-",["T_LNUMBER","1",261],",",["T_WHITESPACE"," ",261],["T_STRING","PREG_SPLIT_NO_EMPTY",261],")",";",["T_WHITESPACE","\n      ",261],["T_COMMENT","\/\/ Negative matches.\n",262],["T_WHITESPACE","      ",263],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_VARIABLE","$match",263],"[",["T_LNUMBER","1",263],"]",["T_WHITESPACE"," ",263],["T_IS_EQUAL","==",263],["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'-'",263],")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","keys",264],"[",["T_CONSTANT_ENCAPSED_STRING","'negative'",264],"]",["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_STRING","array_merge",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","keys",264],"[",["T_CONSTANT_ENCAPSED_STRING","'negative'",264],"]",",",["T_WHITESPACE"," ",264],["T_VARIABLE","$words",264],")",";",["T_WHITESPACE","\n      ",264],"}",["T_WHITESPACE","\n      ",265],["T_COMMENT","\/\/ OR operator: instead of a single keyword, we store an array of all\n",266],["T_WHITESPACE","      ",267],["T_COMMENT","\/\/ OR'd keywords.\n",267],["T_WHITESPACE","      ",268],["T_ELSEIF","elseif",268],["T_WHITESPACE"," ",268],"(",["T_VARIABLE","$match",268],"[",["T_LNUMBER","2",268],"]",["T_WHITESPACE"," ",268],["T_IS_EQUAL","==",268],["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'OR'",268],["T_WHITESPACE"," ",268],["T_BOOLEAN_AND","&&",268],["T_WHITESPACE"," ",268],["T_STRING","count",268],"(",["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","keys",268],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",268],"]",")",")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$last",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","array_pop",269],"(",["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","keys",269],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",269],"]",")",";",["T_WHITESPACE","\n        ",269],["T_COMMENT","\/\/ Starting a new OR?\n",270],["T_WHITESPACE","        ",271],["T_IF","if",271],["T_WHITESPACE"," ",271],"(","!",["T_STRING","is_array",271],"(",["T_VARIABLE","$last",271],")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n          ",271],["T_VARIABLE","$last",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_ARRAY","array",272],"(",["T_VARIABLE","$last",272],")",";",["T_WHITESPACE","\n        ",272],"}",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","keys",274],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",274],"]","[","]",["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$last",274],";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$in_or",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_STRING","TRUE",275],";",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$or_count",276],["T_INC","++",276],";",["T_WHITESPACE","\n        ",276],["T_CONTINUE","continue",277],";",["T_WHITESPACE","\n      ",277],"}",["T_WHITESPACE","\n      ",278],["T_COMMENT","\/\/ AND operator: implied, so just ignore it.\n",279],["T_WHITESPACE","      ",280],["T_ELSEIF","elseif",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$match",280],"[",["T_LNUMBER","2",280],"]",["T_WHITESPACE"," ",280],["T_IS_EQUAL","==",280],["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'AND'",280],["T_WHITESPACE"," ",280],["T_BOOLEAN_OR","||",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$match",280],"[",["T_LNUMBER","2",280],"]",["T_WHITESPACE"," ",280],["T_IS_EQUAL","==",280],["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'and'",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n        ",280],["T_CONTINUE","continue",281],";",["T_WHITESPACE","\n      ",281],"}",["T_WHITESPACE","\n\n      ",282],["T_COMMENT","\/\/ Plain keyword.\n",284],["T_WHITESPACE","      ",285],["T_ELSE","else",285],["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n        ",285],["T_IF","if",286],["T_WHITESPACE"," ",286],"(",["T_VARIABLE","$match",286],"[",["T_LNUMBER","2",286],"]",["T_WHITESPACE"," ",286],["T_IS_EQUAL","==",286],["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'or'",286],")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n          ",286],["T_COMMENT","\/\/ Lower-case \"or\" instead of \"OR\" is a warning condition.\n",287],["T_WHITESPACE","          ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","status",288],["T_WHITESPACE"," ",288],["T_OR_EQUAL","|=",288],["T_WHITESPACE"," ",288],["T_STRING","SearchQuery",288],["T_DOUBLE_COLON","::",288],["T_STRING","LOWER_CASE_OR",288],";",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE","\n        ",289],["T_IF","if",290],["T_WHITESPACE"," ",290],"(",["T_VARIABLE","$in_or",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n          ",290],["T_COMMENT","\/\/ Add to last element (which is an array).\n",291],["T_WHITESPACE","          ",292],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","keys",292],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",292],"]","[",["T_STRING","count",292],"(",["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","keys",292],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",292],"]",")",["T_WHITESPACE"," ",292],"-",["T_WHITESPACE"," ",292],["T_LNUMBER","1",292],"]",["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","array_merge",292],"(",["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","keys",292],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",292],"]","[",["T_STRING","count",292],"(",["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","keys",292],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",292],"]",")",["T_WHITESPACE"," ",292],"-",["T_WHITESPACE"," ",292],["T_LNUMBER","1",292],"]",",",["T_WHITESPACE"," ",292],["T_VARIABLE","$words",292],")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n        ",293],["T_ELSE","else",294],["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n          ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","keys",295],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",295],"]",["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_STRING","array_merge",295],"(",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","keys",295],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",295],"]",",",["T_WHITESPACE"," ",295],["T_VARIABLE","$words",295],")",";",["T_WHITESPACE","\n          ",295],["T_VARIABLE","$and_count",296],["T_INC","++",296],";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE","\n      ",297],"}",["T_WHITESPACE","\n      ",298],["T_VARIABLE","$in_or",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_STRING","FALSE",299],";",["T_WHITESPACE","\n    ",299],"}",["T_WHITESPACE","\n\n    ",300],["T_COMMENT","\/\/ Convert keywords into SQL statements.\n",302],["T_WHITESPACE","    ",303],["T_VARIABLE","$has_and",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_STRING","FALSE",303],";",["T_WHITESPACE","\n    ",303],["T_VARIABLE","$has_or",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_STRING","FALSE",304],";",["T_WHITESPACE","\n    ",304],["T_COMMENT","\/\/ Positive matches.\n",305],["T_WHITESPACE","    ",306],["T_FOREACH","foreach",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","keys",306],"[",["T_CONSTANT_ENCAPSED_STRING","'positive'",306],"]",["T_WHITESPACE"," ",306],["T_AS","as",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$key",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n      ",306],["T_COMMENT","\/\/ Group of ORed terms.\n",307],["T_WHITESPACE","      ",308],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_STRING","is_array",308],"(",["T_VARIABLE","$key",308],")",["T_WHITESPACE"," ",308],["T_BOOLEAN_AND","&&",308],["T_WHITESPACE"," ",308],["T_STRING","count",308],"(",["T_VARIABLE","$key",308],")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n        ",308],["T_COMMENT","\/\/ If we had already found one OR, this is another one AND-ed with the\n",309],["T_WHITESPACE","        ",310],["T_COMMENT","\/\/ first, meaning it is not a simple query.\n",310],["T_WHITESPACE","        ",311],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$has_or",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n          ",311],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","simple",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_STRING","FALSE",312],";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$has_or",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_STRING","TRUE",314],";",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$has_new_scores",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","FALSE",315],";",["T_WHITESPACE","\n        ",315],["T_VARIABLE","$queryor",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_STRING","db_or",316],"(",")",";",["T_WHITESPACE","\n        ",316],["T_FOREACH","foreach",317],["T_WHITESPACE"," ",317],"(",["T_VARIABLE","$key",317],["T_WHITESPACE"," ",317],["T_AS","as",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$or",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n          ",317],["T_LIST","list",318],"(",["T_VARIABLE","$num_new_scores",318],")",["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","parseWord",318],"(",["T_VARIABLE","$or",318],")",";",["T_WHITESPACE","\n          ",318],["T_VARIABLE","$has_new_scores",319],["T_WHITESPACE"," ",319],["T_OR_EQUAL","|=",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$num_new_scores",319],";",["T_WHITESPACE","\n          ",319],["T_VARIABLE","$queryor",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","condition",320],"(",["T_CONSTANT_ENCAPSED_STRING","'d.data'",320],",",["T_WHITESPACE"," ",320],"\"",["T_ENCAPSED_AND_WHITESPACE","% ",320],["T_VARIABLE","$or",320],["T_ENCAPSED_AND_WHITESPACE"," %",320],"\"",",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'LIKE'",320],")",";",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE","\n        ",321],["T_IF","if",322],["T_WHITESPACE"," ",322],"(",["T_STRING","count",322],"(",["T_VARIABLE","$queryor",322],")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n          ",322],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","conditions",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","condition",323],"(",["T_VARIABLE","$queryor",323],")",";",["T_WHITESPACE","\n          ",323],["T_COMMENT","\/\/ A group of OR keywords only needs to match once.\n",324],["T_WHITESPACE","          ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","matches",325],["T_WHITESPACE"," ",325],["T_PLUS_EQUAL","+=",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$has_new_scores",325],["T_WHITESPACE"," ",325],">",["T_WHITESPACE"," ",325],["T_LNUMBER","0",325],")",";",["T_WHITESPACE","\n        ",325],"}",["T_WHITESPACE","\n      ",326],"}",["T_WHITESPACE","\n      ",327],["T_COMMENT","\/\/ Single ANDed term.\n",328],["T_WHITESPACE","      ",329],["T_ELSE","else",329],["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$has_and",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_STRING","TRUE",330],";",["T_WHITESPACE","\n        ",330],["T_LIST","list",331],"(",["T_VARIABLE","$num_new_scores",331],",",["T_WHITESPACE"," ",331],["T_VARIABLE","$num_valid_words",331],")",["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","parseWord",331],"(",["T_VARIABLE","$key",331],")",";",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","conditions",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","condition",332],"(",["T_CONSTANT_ENCAPSED_STRING","'d.data'",332],",",["T_WHITESPACE"," ",332],"\"",["T_ENCAPSED_AND_WHITESPACE","% ",332],["T_VARIABLE","$key",332],["T_ENCAPSED_AND_WHITESPACE"," %",332],"\"",",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'LIKE'",332],")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(","!",["T_VARIABLE","$num_valid_words",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n          ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","simple",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_STRING","FALSE",334],";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_COMMENT","\/\/ Each AND keyword needs to match at least once.\n",336],["T_WHITESPACE","        ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","matches",337],["T_WHITESPACE"," ",337],["T_PLUS_EQUAL","+=",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$num_new_scores",337],";",["T_WHITESPACE","\n      ",337],"}",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n    ",339],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_VARIABLE","$has_and",340],["T_WHITESPACE"," ",340],["T_BOOLEAN_AND","&&",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$has_or",340],")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n      ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","simple",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING","FALSE",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_COMMENT","\/\/ Negative matches.\n",344],["T_WHITESPACE","    ",345],["T_FOREACH","foreach",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","keys",345],"[",["T_CONSTANT_ENCAPSED_STRING","'negative'",345],"]",["T_WHITESPACE"," ",345],["T_AS","as",345],["T_WHITESPACE"," ",345],["T_VARIABLE","$key",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n      ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","conditions",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","condition",346],"(",["T_CONSTANT_ENCAPSED_STRING","'d.data'",346],",",["T_WHITESPACE"," ",346],"\"",["T_ENCAPSED_AND_WHITESPACE","% ",346],["T_VARIABLE","$key",346],["T_ENCAPSED_AND_WHITESPACE"," %",346],"\"",",",["T_WHITESPACE"," ",346],["T_CONSTANT_ENCAPSED_STRING","'NOT LIKE'",346],")",";",["T_WHITESPACE","\n      ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","simple",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_STRING","FALSE",347],";",["T_WHITESPACE","\n    ",347],"}",["T_WHITESPACE","\n  ",348],"}",["T_WHITESPACE","\n\n  ",349],["T_DOC_COMMENT","\/**\n   * Parses a word or phrase for parseQuery().\n   *\n   * Splits a phrase into words. Adds its words to $this->words, if it is not\n   * already there. Returns a list containing the number of new words found,\n   * and the total number of words in the phrase.\n   *\/",351],["T_WHITESPACE","\n  ",357],["T_PROTECTED","protected",358],["T_WHITESPACE"," ",358],["T_FUNCTION","function",358],["T_WHITESPACE"," ",358],["T_STRING","parseWord",358],"(",["T_VARIABLE","$word",358],")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n    ",358],["T_VARIABLE","$num_new_scores",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_LNUMBER","0",359],";",["T_WHITESPACE","\n    ",359],["T_VARIABLE","$num_valid_words",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_LNUMBER","0",360],";",["T_WHITESPACE","\n\n    ",360],["T_COMMENT","\/\/ Determine the scorewords of this word\/phrase.\n",362],["T_WHITESPACE","    ",363],["T_VARIABLE","$split",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_STRING","explode",363],"(",["T_CONSTANT_ENCAPSED_STRING","' '",363],",",["T_WHITESPACE"," ",363],["T_VARIABLE","$word",363],")",";",["T_WHITESPACE","\n    ",363],["T_FOREACH","foreach",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$split",364],["T_WHITESPACE"," ",364],["T_AS","as",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$s",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n      ",364],["T_VARIABLE","$num",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","is_numeric",365],"(",["T_VARIABLE","$s",365],")",";",["T_WHITESPACE","\n      ",365],["T_IF","if",366],["T_WHITESPACE"," ",366],"(",["T_VARIABLE","$num",366],["T_WHITESPACE"," ",366],["T_BOOLEAN_OR","||",366],["T_WHITESPACE"," ",366],["T_STRING","Unicode",366],["T_DOUBLE_COLON","::",366],["T_STRING","strlen",366],"(",["T_VARIABLE","$s",366],")",["T_WHITESPACE"," ",366],["T_IS_GREATER_OR_EQUAL",">=",366],["T_WHITESPACE"," ",366],["T_NS_SEPARATOR","\\",366],["T_STRING","Drupal",366],["T_DOUBLE_COLON","::",366],["T_STRING","config",366],"(",["T_CONSTANT_ENCAPSED_STRING","'search.settings'",366],")",["T_OBJECT_OPERATOR","->",366],["T_STRING","get",366],"(",["T_CONSTANT_ENCAPSED_STRING","'index.minimum_word_size'",366],")",")",["T_WHITESPACE"," ",366],"{",["T_WHITESPACE","\n        ",366],["T_IF","if",367],["T_WHITESPACE"," ",367],"(","!",["T_ISSET","isset",367],"(",["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","words",367],"[",["T_VARIABLE","$s",367],"]",")",")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n          ",367],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","words",368],"[",["T_VARIABLE","$s",368],"]",["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$s",368],";",["T_WHITESPACE","\n          ",368],["T_VARIABLE","$num_new_scores",369],["T_INC","++",369],";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$num_valid_words",371],["T_INC","++",371],";",["T_WHITESPACE","\n      ",371],"}",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n\n    ",373],["T_COMMENT","\/\/ Return matching snippet and number of added words.\n",375],["T_WHITESPACE","    ",376],["T_RETURN","return",376],["T_WHITESPACE"," ",376],["T_ARRAY","array",376],"(",["T_VARIABLE","$num_new_scores",376],",",["T_WHITESPACE"," ",376],["T_VARIABLE","$num_valid_words",376],")",";",["T_WHITESPACE","\n  ",376],"}",["T_WHITESPACE","\n\n  ",377],["T_DOC_COMMENT","\/**\n   * Prepares the query and calculates the normalization factor.\n   *\n   * After the query is normalized the keywords are weighted to give the results\n   * a relevancy score. The query is ready for execution after this.\n   *\n   * Error and warning conditions can apply. Call getStatus() after calling\n   * this method to retrieve them.\n   *\n   * @return bool\n   *   TRUE if at least one keyword matched the search index; FALSE if not.\n   *\/",379],["T_WHITESPACE","\n  ",390],["T_PUBLIC","public",391],["T_WHITESPACE"," ",391],["T_FUNCTION","function",391],["T_WHITESPACE"," ",391],["T_STRING","prepareAndNormalize",391],"(",")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n    ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","parseSearchExpression",392],"(",")",";",["T_WHITESPACE","\n    ",392],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","executedPrepare",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","TRUE",393],";",["T_WHITESPACE","\n\n    ",393],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_STRING","count",395],"(",["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","words",395],")",["T_WHITESPACE"," ",395],["T_IS_EQUAL","==",395],["T_WHITESPACE"," ",395],["T_LNUMBER","0",395],")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n      ",395],["T_COMMENT","\/\/ Although the query could proceed, there is no point in joining\n",396],["T_WHITESPACE","      ",397],["T_COMMENT","\/\/ with other tables and attempting to normalize if there are no\n",397],["T_WHITESPACE","      ",398],["T_COMMENT","\/\/ keywords present.\n",398],["T_WHITESPACE","      ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","status",399],["T_WHITESPACE"," ",399],["T_OR_EQUAL","|=",399],["T_WHITESPACE"," ",399],["T_STRING","SearchQuery",399],["T_DOUBLE_COLON","::",399],["T_STRING","NO_POSITIVE_KEYWORDS",399],";",["T_WHITESPACE","\n      ",399],["T_RETURN","return",400],["T_WHITESPACE"," ",400],["T_STRING","FALSE",400],";",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n\n    ",401],["T_COMMENT","\/\/ Build the basic search query: match the entered keywords.\n",403],["T_WHITESPACE","    ",404],["T_VARIABLE","$or",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_STRING","db_or",404],"(",")",";",["T_WHITESPACE","\n    ",404],["T_FOREACH","foreach",405],["T_WHITESPACE"," ",405],"(",["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","words",405],["T_WHITESPACE"," ",405],["T_AS","as",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$word",405],")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n      ",405],["T_VARIABLE","$or",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","condition",406],"(",["T_CONSTANT_ENCAPSED_STRING","'i.word'",406],",",["T_WHITESPACE"," ",406],["T_VARIABLE","$word",406],")",";",["T_WHITESPACE","\n    ",406],"}",["T_WHITESPACE","\n    ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","condition",408],"(",["T_VARIABLE","$or",408],")",";",["T_WHITESPACE","\n\n    ",408],["T_COMMENT","\/\/ Add keyword normalization information to the query.\n",410],["T_WHITESPACE","    ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","join",411],"(",["T_CONSTANT_ENCAPSED_STRING","'search_total'",411],",",["T_WHITESPACE"," ",411],["T_CONSTANT_ENCAPSED_STRING","'t'",411],",",["T_WHITESPACE"," ",411],["T_CONSTANT_ENCAPSED_STRING","'i.word = t.word'",411],")",";",["T_WHITESPACE","\n    ",411],["T_VARIABLE","$this",412],["T_WHITESPACE","\n      ",412],["T_OBJECT_OPERATOR","->",413],["T_STRING","condition",413],"(",["T_CONSTANT_ENCAPSED_STRING","'i.type'",413],",",["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","type",413],")",["T_WHITESPACE","\n      ",413],["T_OBJECT_OPERATOR","->",414],["T_STRING","groupBy",414],"(",["T_CONSTANT_ENCAPSED_STRING","'i.type'",414],")",["T_WHITESPACE","\n      ",414],["T_OBJECT_OPERATOR","->",415],["T_STRING","groupBy",415],"(",["T_CONSTANT_ENCAPSED_STRING","'i.sid'",415],")",";",["T_WHITESPACE","\n\n    ",415],["T_COMMENT","\/\/ If the query is simple, we should have calculated the number of\n",417],["T_WHITESPACE","    ",418],["T_COMMENT","\/\/ matching words we need to find, so impose that criterion. For non-\n",418],["T_WHITESPACE","    ",419],["T_COMMENT","\/\/ simple queries, this condition could lead to incorrectly deciding not\n",419],["T_WHITESPACE","    ",420],["T_COMMENT","\/\/ to continue with the full query.\n",420],["T_WHITESPACE","    ",421],["T_IF","if",421],["T_WHITESPACE"," ",421],"(",["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","simple",421],")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n      ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","having",422],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*) >= :matches'",422],",",["T_WHITESPACE"," ",422],["T_ARRAY","array",422],"(",["T_CONSTANT_ENCAPSED_STRING","':matches'",422],["T_WHITESPACE"," ",422],["T_DOUBLE_ARROW","=>",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","matches",422],")",")",";",["T_WHITESPACE","\n    ",422],"}",["T_WHITESPACE","\n\n    ",423],["T_COMMENT","\/\/ Clone the query object to calculate normalization.\n",425],["T_WHITESPACE","    ",426],["T_VARIABLE","$normalize_query",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_CLONE","clone",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","query",426],";",["T_WHITESPACE","\n\n    ",426],["T_COMMENT","\/\/ For complex search queries, add the LIKE conditions; if the query is\n",428],["T_WHITESPACE","    ",429],["T_COMMENT","\/\/ simple, we do not need them for normalization.\n",429],["T_WHITESPACE","    ",430],["T_IF","if",430],["T_WHITESPACE"," ",430],"(","!",["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","simple",430],")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n      ",430],["T_VARIABLE","$normalize_query",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","join",431],"(",["T_CONSTANT_ENCAPSED_STRING","'search_dataset'",431],",",["T_WHITESPACE"," ",431],["T_CONSTANT_ENCAPSED_STRING","'d'",431],",",["T_WHITESPACE"," ",431],["T_CONSTANT_ENCAPSED_STRING","'i.sid = d.sid AND i.type = d.type AND i.langcode = d.langcode'",431],")",";",["T_WHITESPACE","\n      ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_STRING","count",432],"(",["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","conditions",432],")",")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$normalize_query",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","condition",433],"(",["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","conditions",433],")",";",["T_WHITESPACE","\n      ",433],"}",["T_WHITESPACE","\n    ",434],"}",["T_WHITESPACE","\n\n    ",435],["T_COMMENT","\/\/ Calculate normalization, which is the max of all the search scores for\n",437],["T_WHITESPACE","    ",438],["T_COMMENT","\/\/ positive keywords in the query. And note that the query could have other\n",438],["T_WHITESPACE","    ",439],["T_COMMENT","\/\/ fields added to it by the user of this extension.\n",439],["T_WHITESPACE","    ",440],["T_VARIABLE","$normalize_query",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","addExpression",440],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(i.score * t.count)'",440],",",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","'calculated_score'",440],")",";",["T_WHITESPACE","\n    ",440],["T_VARIABLE","$result",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$normalize_query",441],["T_WHITESPACE","\n      ",441],["T_OBJECT_OPERATOR","->",442],["T_STRING","range",442],"(",["T_LNUMBER","0",442],",",["T_WHITESPACE"," ",442],["T_LNUMBER","1",442],")",["T_WHITESPACE","\n      ",442],["T_OBJECT_OPERATOR","->",443],["T_STRING","orderBy",443],"(",["T_CONSTANT_ENCAPSED_STRING","'calculated_score'",443],",",["T_WHITESPACE"," ",443],["T_CONSTANT_ENCAPSED_STRING","'DESC'",443],")",["T_WHITESPACE","\n      ",443],["T_OBJECT_OPERATOR","->",444],["T_STRING","execute",444],"(",")",["T_WHITESPACE","\n      ",444],["T_OBJECT_OPERATOR","->",445],["T_STRING","fetchObject",445],"(",")",";",["T_WHITESPACE","\n    ",445],["T_IF","if",446],["T_WHITESPACE"," ",446],"(",["T_ISSET","isset",446],"(",["T_VARIABLE","$result",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","calculated_score",446],")",")",["T_WHITESPACE"," ",446],"{",["T_WHITESPACE","\n      ",446],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","normalize",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_DOUBLE_CAST","(float)",447],["T_WHITESPACE"," ",447],["T_VARIABLE","$result",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","calculated_score",447],";",["T_WHITESPACE","\n    ",447],"}",["T_WHITESPACE","\n\n    ",448],["T_IF","if",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","normalize",450],")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n      ",450],["T_RETURN","return",451],["T_WHITESPACE"," ",451],["T_STRING","TRUE",451],";",["T_WHITESPACE","\n    ",451],"}",["T_WHITESPACE","\n\n    ",452],["T_COMMENT","\/\/ If the normalization value was zero, that indicates there were no\n",454],["T_WHITESPACE","    ",455],["T_COMMENT","\/\/ matches to the supplied positive keywords.\n",455],["T_WHITESPACE","    ",456],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","status",456],["T_WHITESPACE"," ",456],["T_OR_EQUAL","|=",456],["T_WHITESPACE"," ",456],["T_STRING","SearchQuery",456],["T_DOUBLE_COLON","::",456],["T_STRING","NO_KEYWORD_MATCHES",456],";",["T_WHITESPACE","\n    ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_STRING","FALSE",457],";",["T_WHITESPACE","\n  ",457],"}",["T_WHITESPACE","\n\n  ",458],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",460],["T_WHITESPACE","\n  ",462],["T_PUBLIC","public",463],["T_WHITESPACE"," ",463],["T_FUNCTION","function",463],["T_WHITESPACE"," ",463],["T_STRING","preExecute",463],"(",["T_STRING","SelectInterface",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$query",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_STRING","NULL",463],")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n    ",463],["T_IF","if",464],["T_WHITESPACE"," ",464],"(","!",["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","executedPrepare",464],")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n      ",464],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","prepareAndNormalize",465],"(",")",";",["T_WHITESPACE","\n    ",465],"}",["T_WHITESPACE","\n\n    ",466],["T_IF","if",468],["T_WHITESPACE"," ",468],"(","!",["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","normalize",468],")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n      ",468],["T_RETURN","return",469],["T_WHITESPACE"," ",469],["T_STRING","FALSE",469],";",["T_WHITESPACE","\n    ",469],"}",["T_WHITESPACE","\n\n    ",470],["T_RETURN","return",472],["T_WHITESPACE"," ",472],["T_STRING","parent",472],["T_DOUBLE_COLON","::",472],["T_STRING","preExecute",472],"(",["T_VARIABLE","$query",472],")",";",["T_WHITESPACE","\n  ",472],"}",["T_WHITESPACE","\n\n  ",473],["T_DOC_COMMENT","\/**\n   * Adds a custom score expression to the search query.\n   *\n   * Score expressions are used to order search results. If no calls to\n   * addScore() have taken place, a default keyword relevance score will be\n   * used. However, if at least one call to addScore() has taken place, the\n   * keyword relevance score is not automatically added.\n   *\n   * Note that you must use this method to add ordering to your searches, and\n   * not call orderBy() directly, when using the SearchQuery extender. This is\n   * because of the two-pass system the SearchQuery class uses to normalize\n   * scores.\n   *\n   * @param string $score\n   *   The score expression, which should evaluate to a number between 0 and 1.\n   *   The string 'i.relevance' in a score expression will be replaced by a\n   *   measure of keyword relevance between 0 and 1.\n   * @param array $arguments\n   *   Query arguments needed to provide values to the score expression.\n   * @param float $multiply\n   *   If set, the score is multiplied with this value. However, all scores\n   *   with multipliers are then divided by the total of all multipliers, so\n   *   that overall, the normalization is maintained.\n   *\n   * @return $this\n   *\/",475],["T_WHITESPACE","\n  ",500],["T_PUBLIC","public",501],["T_WHITESPACE"," ",501],["T_FUNCTION","function",501],["T_WHITESPACE"," ",501],["T_STRING","addScore",501],"(",["T_VARIABLE","$score",501],",",["T_WHITESPACE"," ",501],["T_VARIABLE","$arguments",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_ARRAY","array",501],"(",")",",",["T_WHITESPACE"," ",501],["T_VARIABLE","$multiply",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_STRING","FALSE",501],")",["T_WHITESPACE"," ",501],"{",["T_WHITESPACE","\n    ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(",["T_VARIABLE","$multiply",502],")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n      ",502],["T_VARIABLE","$i",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_STRING","count",503],"(",["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","multiply",503],")",";",["T_WHITESPACE","\n      ",503],["T_COMMENT","\/\/ Modify the score expression so it is multiplied by the multiplier,\n",504],["T_WHITESPACE","      ",505],["T_COMMENT","\/\/ with a divisor to renormalize. Note that the ROUND here is necessary\n",505],["T_WHITESPACE","      ",506],["T_COMMENT","\/\/ for PostgreSQL and SQLite in order to ensure that the :multiply_* and\n",506],["T_WHITESPACE","      ",507],["T_COMMENT","\/\/ :total_* arguments are treated as a numeric type, because the\n",507],["T_WHITESPACE","      ",508],["T_COMMENT","\/\/ PostgreSQL PDO driver sometimes puts values in as strings instead of\n",508],["T_WHITESPACE","      ",509],["T_COMMENT","\/\/ numbers in complex expressions like this.\n",509],["T_WHITESPACE","      ",510],["T_VARIABLE","$score",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],"\"",["T_ENCAPSED_AND_WHITESPACE","(ROUND(:multiply_",510],["T_VARIABLE","$i",510],["T_ENCAPSED_AND_WHITESPACE",", 4)) * COALESCE((",510],["T_VARIABLE","$score",510],["T_ENCAPSED_AND_WHITESPACE","), 0) \/ (ROUND(:total_",510],["T_VARIABLE","$i",510],["T_ENCAPSED_AND_WHITESPACE",", 4))",510],"\"",";",["T_WHITESPACE","\n      ",510],["T_COMMENT","\/\/ Add an argument for the multiplier. The :total_$i argument is taken\n",511],["T_WHITESPACE","      ",512],["T_COMMENT","\/\/ care of in the execute() method, which is when the total divisor is\n",512],["T_WHITESPACE","      ",513],["T_COMMENT","\/\/ calculated.\n",513],["T_WHITESPACE","      ",514],["T_VARIABLE","$arguments",514],"[",["T_CONSTANT_ENCAPSED_STRING","':multiply_'",514],["T_WHITESPACE"," ",514],".",["T_WHITESPACE"," ",514],["T_VARIABLE","$i",514],"]",["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$multiply",514],";",["T_WHITESPACE","\n      ",514],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","multiply",515],"[","]",["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$multiply",515],";",["T_WHITESPACE","\n    ",515],"}",["T_WHITESPACE","\n\n    ",516],["T_COMMENT","\/\/ Search scoring needs a way to include a keyword relevance in the score.\n",518],["T_WHITESPACE","    ",519],["T_COMMENT","\/\/ For historical reasons, this is done by putting 'i.relevance' into the\n",519],["T_WHITESPACE","    ",520],["T_COMMENT","\/\/ search expression. So, use string replacement to change this to a\n",520],["T_WHITESPACE","    ",521],["T_COMMENT","\/\/ calculated query expression, counting the number of occurrences so\n",521],["T_WHITESPACE","    ",522],["T_COMMENT","\/\/ in the execute() method we can add arguments.\n",522],["T_WHITESPACE","    ",523],["T_WHILE","while",523],["T_WHITESPACE"," ",523],"(","(",["T_VARIABLE","$pos",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_STRING","strpos",523],"(",["T_VARIABLE","$score",523],",",["T_WHITESPACE"," ",523],["T_CONSTANT_ENCAPSED_STRING","'i.relevance'",523],")",")",["T_WHITESPACE"," ",523],["T_IS_NOT_IDENTICAL","!==",523],["T_WHITESPACE"," ",523],["T_STRING","FALSE",523],")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n      ",523],["T_VARIABLE","$pieces",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_STRING","explode",524],"(",["T_CONSTANT_ENCAPSED_STRING","'i.relevance'",524],",",["T_WHITESPACE"," ",524],["T_VARIABLE","$score",524],",",["T_WHITESPACE"," ",524],["T_LNUMBER","2",524],")",";",["T_WHITESPACE","\n      ",524],["T_VARIABLE","$score",525],["T_WHITESPACE"," ",525],"=",["T_WHITESPACE"," ",525],["T_STRING","implode",525],"(",["T_CONSTANT_ENCAPSED_STRING","'((ROUND(:normalization_'",525],["T_WHITESPACE"," ",525],".",["T_WHITESPACE"," ",525],["T_VARIABLE","$this",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","relevance_count",525],["T_WHITESPACE"," ",525],".",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","', 4)) * i.score * t.count)'",525],",",["T_WHITESPACE"," ",525],["T_VARIABLE","$pieces",525],")",";",["T_WHITESPACE","\n      ",525],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","relevance_count",526],["T_INC","++",526],";",["T_WHITESPACE","\n    ",526],"}",["T_WHITESPACE","\n\n    ",527],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","scores",529],"[","]",["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$score",529],";",["T_WHITESPACE","\n    ",529],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","scoresArguments",530],["T_WHITESPACE"," ",530],["T_PLUS_EQUAL","+=",530],["T_WHITESPACE"," ",530],["T_VARIABLE","$arguments",530],";",["T_WHITESPACE","\n\n    ",530],["T_RETURN","return",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],";",["T_WHITESPACE","\n  ",532],"}",["T_WHITESPACE","\n\n  ",533],["T_DOC_COMMENT","\/**\n   * Executes the search.\n   *\n   * The complex conditions are applied to the query including score\n   * expressions and ordering.\n   *\n   * Error and warning conditions can apply. Call getStatus() after calling\n   * this method to retrieve them.\n   *\n   * @return \\Drupal\\Core\\Database\\StatementInterface|null\n   *   A query result set containing the results of the query.\n   *\/",535],["T_WHITESPACE","\n  ",546],["T_PUBLIC","public",547],["T_WHITESPACE"," ",547],["T_FUNCTION","function",547],["T_WHITESPACE"," ",547],["T_STRING","execute",547],"(",")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n    ",547],["T_IF","if",548],["T_WHITESPACE"," ",548],"(","!",["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","preExecute",548],"(",["T_VARIABLE","$this",548],")",")",["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n      ",548],["T_RETURN","return",549],["T_WHITESPACE"," ",549],["T_STRING","NULL",549],";",["T_WHITESPACE","\n    ",549],"}",["T_WHITESPACE","\n\n    ",550],["T_COMMENT","\/\/ Add conditions to the query.\n",552],["T_WHITESPACE","    ",553],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","join",553],"(",["T_CONSTANT_ENCAPSED_STRING","'search_dataset'",553],",",["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'d'",553],",",["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'i.sid = d.sid AND i.type = d.type AND i.langcode = d.langcode'",553],")",";",["T_WHITESPACE","\n    ",553],["T_IF","if",554],["T_WHITESPACE"," ",554],"(",["T_STRING","count",554],"(",["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","conditions",554],")",")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n      ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","condition",555],"(",["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","conditions",555],")",";",["T_WHITESPACE","\n    ",555],"}",["T_WHITESPACE","\n\n    ",556],["T_COMMENT","\/\/ Add default score (keyword relevance) if there are not any defined.\n",558],["T_WHITESPACE","    ",559],["T_IF","if",559],["T_WHITESPACE"," ",559],"(",["T_EMPTY","empty",559],"(",["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","scores",559],")",")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n      ",559],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","addScore",560],"(",["T_CONSTANT_ENCAPSED_STRING","'i.relevance'",560],")",";",["T_WHITESPACE","\n    ",560],"}",["T_WHITESPACE","\n\n    ",561],["T_IF","if",563],["T_WHITESPACE"," ",563],"(",["T_STRING","count",563],"(",["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","multiply",563],")",")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n      ",563],["T_COMMENT","\/\/ Re-normalize scores with multipliers by dividing by the total of all\n",564],["T_WHITESPACE","      ",565],["T_COMMENT","\/\/ multipliers. The expressions were altered in addScore(), so here just\n",565],["T_WHITESPACE","      ",566],["T_COMMENT","\/\/ add the arguments for the total.\n",566],["T_WHITESPACE","      ",567],["T_VARIABLE","$sum",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_STRING","array_sum",567],"(",["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","multiply",567],")",";",["T_WHITESPACE","\n      ",567],["T_FOR","for",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$i",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_LNUMBER","0",568],";",["T_WHITESPACE"," ",568],["T_VARIABLE","$i",568],["T_WHITESPACE"," ",568],"<",["T_WHITESPACE"," ",568],["T_STRING","count",568],"(",["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","multiply",568],")",";",["T_WHITESPACE"," ",568],["T_VARIABLE","$i",568],["T_INC","++",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n        ",568],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","scoresArguments",569],"[",["T_CONSTANT_ENCAPSED_STRING","':total_'",569],["T_WHITESPACE"," ",569],".",["T_WHITESPACE"," ",569],["T_VARIABLE","$i",569],"]",["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_VARIABLE","$sum",569],";",["T_WHITESPACE","\n      ",569],"}",["T_WHITESPACE","\n    ",570],"}",["T_WHITESPACE","\n\n\n    ",571],["T_COMMENT","\/\/ Add arguments for the keyword relevance normalization number.\n",574],["T_WHITESPACE","    ",575],["T_VARIABLE","$normalization",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_DNUMBER","1.0",575],["T_WHITESPACE"," ",575],"\/",["T_WHITESPACE"," ",575],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","normalize",575],";",["T_WHITESPACE","\n    ",575],["T_FOR","for",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$i",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_LNUMBER","0",576],";",["T_WHITESPACE"," ",576],["T_VARIABLE","$i",576],["T_WHITESPACE"," ",576],"<",["T_WHITESPACE"," ",576],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","relevance_count",576],";",["T_WHITESPACE"," ",576],["T_VARIABLE","$i",576],["T_INC","++",576],["T_WHITESPACE"," ",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n      ",576],["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","scoresArguments",577],"[",["T_CONSTANT_ENCAPSED_STRING","':normalization_'",577],["T_WHITESPACE"," ",577],".",["T_WHITESPACE"," ",577],["T_VARIABLE","$i",577],"]",["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_VARIABLE","$normalization",577],";",["T_WHITESPACE","\n    ",577],"}",["T_WHITESPACE","\n\n    ",578],["T_COMMENT","\/\/ Add all scores together to form a query field.\n",580],["T_WHITESPACE","    ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","addExpression",581],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM('",581],["T_WHITESPACE"," ",581],".",["T_WHITESPACE"," ",581],["T_STRING","implode",581],"(",["T_CONSTANT_ENCAPSED_STRING","' + '",581],",",["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","scores",581],")",["T_WHITESPACE"," ",581],".",["T_WHITESPACE"," ",581],["T_CONSTANT_ENCAPSED_STRING","')'",581],",",["T_WHITESPACE"," ",581],["T_CONSTANT_ENCAPSED_STRING","'calculated_score'",581],",",["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","scoresArguments",581],")",";",["T_WHITESPACE","\n\n    ",581],["T_COMMENT","\/\/ If an order has not yet been set for this query, add a default order\n",583],["T_WHITESPACE","    ",584],["T_COMMENT","\/\/ that sorts by the calculated sum of scores.\n",584],["T_WHITESPACE","    ",585],["T_IF","if",585],["T_WHITESPACE"," ",585],"(",["T_STRING","count",585],"(",["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getOrderBy",585],"(",")",")",["T_WHITESPACE"," ",585],["T_IS_EQUAL","==",585],["T_WHITESPACE"," ",585],["T_LNUMBER","0",585],")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n      ",585],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","orderBy",586],"(",["T_CONSTANT_ENCAPSED_STRING","'calculated_score'",586],",",["T_WHITESPACE"," ",586],["T_CONSTANT_ENCAPSED_STRING","'DESC'",586],")",";",["T_WHITESPACE","\n    ",586],"}",["T_WHITESPACE","\n\n    ",587],["T_COMMENT","\/\/ Add query metadata.\n",589],["T_WHITESPACE","    ",590],["T_VARIABLE","$this",590],["T_WHITESPACE","\n      ",590],["T_OBJECT_OPERATOR","->",591],["T_STRING","addMetaData",591],"(",["T_CONSTANT_ENCAPSED_STRING","'normalize'",591],",",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","normalize",591],")",["T_WHITESPACE","\n      ",591],["T_OBJECT_OPERATOR","->",592],["T_STRING","fields",592],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",592],",",["T_WHITESPACE"," ",592],["T_ARRAY","array",592],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",592],",",["T_WHITESPACE"," ",592],["T_CONSTANT_ENCAPSED_STRING","'sid'",592],")",")",";",["T_WHITESPACE","\n    ",592],["T_RETURN","return",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$this",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","query",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","execute",593],"(",")",";",["T_WHITESPACE","\n  ",593],"}",["T_WHITESPACE","\n\n  ",594],["T_DOC_COMMENT","\/**\n   * Builds the default count query for SearchQuery.\n   *\n   * Since SearchQuery always uses GROUP BY, we can default to a subquery. We\n   * also add the same conditions as execute() because countQuery() is called\n   * first.\n   *\/",596],["T_WHITESPACE","\n  ",602],["T_PUBLIC","public",603],["T_WHITESPACE"," ",603],["T_FUNCTION","function",603],["T_WHITESPACE"," ",603],["T_STRING","countQuery",603],"(",")",["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n    ",603],["T_IF","if",604],["T_WHITESPACE"," ",604],"(","!",["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","executedPrepare",604],")",["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n      ",604],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","prepareAndNormalize",605],"(",")",";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_COMMENT","\/\/ Clone the inner query.\n",608],["T_WHITESPACE","    ",609],["T_VARIABLE","$inner",609],["T_WHITESPACE"," ",609],"=",["T_WHITESPACE"," ",609],["T_CLONE","clone",609],["T_WHITESPACE"," ",609],["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","query",609],";",["T_WHITESPACE","\n\n    ",609],["T_COMMENT","\/\/ Add conditions to query.\n",611],["T_WHITESPACE","    ",612],["T_VARIABLE","$inner",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","join",612],"(",["T_CONSTANT_ENCAPSED_STRING","'search_dataset'",612],",",["T_WHITESPACE"," ",612],["T_CONSTANT_ENCAPSED_STRING","'d'",612],",",["T_WHITESPACE"," ",612],["T_CONSTANT_ENCAPSED_STRING","'i.sid = d.sid AND i.type = d.type'",612],")",";",["T_WHITESPACE","\n    ",612],["T_IF","if",613],["T_WHITESPACE"," ",613],"(",["T_STRING","count",613],"(",["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","conditions",613],")",")",["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n      ",613],["T_VARIABLE","$inner",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","condition",614],"(",["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","conditions",614],")",";",["T_WHITESPACE","\n    ",614],"}",["T_WHITESPACE","\n\n    ",615],["T_COMMENT","\/\/ Remove existing fields and expressions, they are not needed for a count\n",617],["T_WHITESPACE","    ",618],["T_COMMENT","\/\/ query.\n",618],["T_WHITESPACE","    ",619],["T_VARIABLE","$fields",619],["T_WHITESPACE"," ",619],"=","&",["T_WHITESPACE"," ",619],["T_VARIABLE","$inner",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","getFields",619],"(",")",";",["T_WHITESPACE","\n    ",619],["T_VARIABLE","$fields",620],["T_WHITESPACE"," ",620],"=",["T_WHITESPACE"," ",620],["T_ARRAY","array",620],"(",")",";",["T_WHITESPACE","\n    ",620],["T_VARIABLE","$expressions",621],["T_WHITESPACE"," ",621],"=","&",["T_WHITESPACE"," ",621],["T_VARIABLE","$inner",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","getExpressions",621],"(",")",";",["T_WHITESPACE","\n    ",621],["T_VARIABLE","$expressions",622],["T_WHITESPACE"," ",622],"=",["T_WHITESPACE"," ",622],["T_ARRAY","array",622],"(",")",";",["T_WHITESPACE","\n\n    ",622],["T_COMMENT","\/\/ Add sid as the only field and count them as a subquery.\n",624],["T_WHITESPACE","    ",625],["T_VARIABLE","$count",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_STRING","db_select",625],"(",["T_VARIABLE","$inner",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","fields",625],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",625],",",["T_WHITESPACE"," ",625],["T_ARRAY","array",625],"(",["T_CONSTANT_ENCAPSED_STRING","'sid'",625],")",")",",",["T_WHITESPACE"," ",625],["T_STRING","NULL",625],",",["T_WHITESPACE"," ",625],["T_ARRAY","array",625],"(",["T_CONSTANT_ENCAPSED_STRING","'target'",625],["T_WHITESPACE"," ",625],["T_DOUBLE_ARROW","=>",625],["T_WHITESPACE"," ",625],["T_CONSTANT_ENCAPSED_STRING","'replica'",625],")",")",";",["T_WHITESPACE","\n\n    ",625],["T_COMMENT","\/\/ Add the COUNT() expression.\n",627],["T_WHITESPACE","    ",628],["T_VARIABLE","$count",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","addExpression",628],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",628],")",";",["T_WHITESPACE","\n\n    ",628],["T_RETURN","return",630],["T_WHITESPACE"," ",630],["T_VARIABLE","$count",630],";",["T_WHITESPACE","\n  ",630],"}",["T_WHITESPACE","\n\n  ",631],["T_DOC_COMMENT","\/**\n   * Returns the query status bitmap.\n   *\n   * @return int\n   *   A bitmap indicating query status. Zero indicates there were no problems.\n   *   A non-zero value is a combination of one or more of the following flags:\n   *   - SearchQuery::NO_POSITIVE_KEYWORDS\n   *   - SearchQuery::EXPRESSIONS_IGNORED\n   *   - SearchQuery::LOWER_CASE_OR\n   *   - SearchQuery::NO_KEYWORD_MATCHES\n   *\/",633],["T_WHITESPACE","\n  ",643],["T_PUBLIC","public",644],["T_WHITESPACE"," ",644],["T_FUNCTION","function",644],["T_WHITESPACE"," ",644],["T_STRING","getStatus",644],"(",")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n    ",644],["T_RETURN","return",645],["T_WHITESPACE"," ",645],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","status",645],";",["T_WHITESPACE","\n  ",645],"}",["T_WHITESPACE","\n\n",646],"}",["T_WHITESPACE","\n",648]]