[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","aggregator",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","aggregator",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Plugin",5],["T_NS_SEPARATOR","\\",5],["T_STRING","AggregatorPluginManager",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Plugin",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Exception",6],["T_NS_SEPARATOR","\\",6],["T_STRING","PluginException",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Config",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ConfigFactoryInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Psr",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Log",8],["T_NS_SEPARATOR","\\",8],["T_STRING","LoggerInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Defines an importer of aggregator items.\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","ItemsImporter",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_STRING","ItemsImporterInterface",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * The aggregator fetcher manager.\n   *\n   * @var \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager\n   *\/",15],["T_WHITESPACE","\n  ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$fetcherManager",20],";",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * The aggregator processor manager.\n   *\n   * @var \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$processorManager",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * The aggregator parser manager.\n   *\n   * @var \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager\n   *\/",29],["T_WHITESPACE","\n  ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$parserManager",34],";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * The aggregator.settings config object.\n   *\n   * @var \\Drupal\\Core\\Config\\Config\n   *\/",36],["T_WHITESPACE","\n  ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$config",41],";",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * A logger instance.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   *\/",43],["T_WHITESPACE","\n  ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$logger",48],";",["T_WHITESPACE","\n\n  ",48],["T_DOC_COMMENT","\/**\n   * Constructs an Importer object.\n   *\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The factory for configuration objects.\n   * @param \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager $fetcher_manager\n   *   The aggregator fetcher plugin manager.\n   * @param \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager $parser_manager\n   *   The aggregator parser plugin manager.\n   * @param \\Drupal\\aggregator\\Plugin\\AggregatorPluginManager $processor_manager\n   *   The aggregator processor plugin manager.\n   * @param \\Psr\\Log\\LoggerInterface $logger\n   *   A logger instance.\n   *\/",50],["T_WHITESPACE","\n  ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","__construct",64],"(",["T_STRING","ConfigFactoryInterface",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$config_factory",64],",",["T_WHITESPACE"," ",64],["T_STRING","AggregatorPluginManager",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$fetcher_manager",64],",",["T_WHITESPACE"," ",64],["T_STRING","AggregatorPluginManager",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$parser_manager",64],",",["T_WHITESPACE"," ",64],["T_STRING","AggregatorPluginManager",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$processor_manager",64],",",["T_WHITESPACE"," ",64],["T_STRING","LoggerInterface",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$logger",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","fetcherManager",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$fetcher_manager",65],";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","processorManager",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$processor_manager",66],";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","parserManager",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$parser_manager",67],";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","config",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$config_factory",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","get",68],"(",["T_CONSTANT_ENCAPSED_STRING","'aggregator.settings'",68],")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","logger",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$logger",69],";",["T_WHITESPACE","\n  ",69],"}",["T_WHITESPACE","\n\n  ",70],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",72],["T_WHITESPACE","\n  ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","delete",75],"(",["T_STRING","FeedInterface",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$feed",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n    ",75],["T_FOREACH","foreach",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","processorManager",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getDefinitions",76],"(",")",["T_WHITESPACE"," ",76],["T_AS","as",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$id",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$definition",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n      ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","processorManager",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","createInstance",77],"(",["T_VARIABLE","$id",77],")",["T_OBJECT_OPERATOR","->",77],["T_STRING","delete",77],"(",["T_VARIABLE","$feed",77],")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n  ",78],"}",["T_WHITESPACE","\n\n  ",79],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",81],["T_WHITESPACE","\n  ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","refresh",84],"(",["T_STRING","FeedInterface",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$feed",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n    ",84],["T_COMMENT","\/\/ Store feed URL to track changes.\n",85],["T_WHITESPACE","    ",86],["T_VARIABLE","$feed_url",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$feed",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getUrl",86],"(",")",";",["T_WHITESPACE","\n\n    ",86],["T_COMMENT","\/\/ Fetch the feed.\n",88],["T_WHITESPACE","    ",89],["T_TRY","try",89],["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n      ",89],["T_VARIABLE","$success",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","fetcherManager",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","createInstance",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","config",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","get",90],"(",["T_CONSTANT_ENCAPSED_STRING","'fetcher'",90],")",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","fetch",90],"(",["T_VARIABLE","$feed",90],")",";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n    ",91],["T_CATCH","catch",92],["T_WHITESPACE"," ",92],"(",["T_STRING","PluginException",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$e",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n      ",92],["T_VARIABLE","$success",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","FALSE",93],";",["T_WHITESPACE","\n      ",93],["T_STRING","watchdog_exception",94],"(",["T_CONSTANT_ENCAPSED_STRING","'aggregator'",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$e",94],")",";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_COMMENT","\/\/ Store instances in an array so we dont have to instantiate new objects.\n",97],["T_WHITESPACE","    ",98],["T_VARIABLE","$processor_instances",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_ARRAY","array",98],"(",")",";",["T_WHITESPACE","\n    ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","config",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","get",99],"(",["T_CONSTANT_ENCAPSED_STRING","'processors'",99],")",["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$processor",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_TRY","try",100],["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$processor_instances",101],"[",["T_VARIABLE","$processor",101],"]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","processorManager",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","createInstance",101],"(",["T_VARIABLE","$processor",101],")",";",["T_WHITESPACE","\n      ",101],"}",["T_WHITESPACE","\n      ",102],["T_CATCH","catch",103],["T_WHITESPACE"," ",103],"(",["T_STRING","PluginException",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$e",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n        ",103],["T_STRING","watchdog_exception",104],"(",["T_CONSTANT_ENCAPSED_STRING","'aggregator'",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$e",104],")",";",["T_WHITESPACE","\n      ",104],"}",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_COMMENT","\/\/ We store the hash of feed data in the database. When refreshing a\n",108],["T_WHITESPACE","    ",109],["T_COMMENT","\/\/ feed we compare stored hash and new hash calculated from downloaded\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ data. If both are equal we say that feed is not updated.\n",110],["T_WHITESPACE","    ",111],["T_VARIABLE","$hash",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","hash",111],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$feed",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","source_string",111],")",";",["T_WHITESPACE","\n    ",111],["T_VARIABLE","$has_new_content",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$success",112],["T_WHITESPACE"," ",112],["T_BOOLEAN_AND","&&",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$feed",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getHash",112],"(",")",["T_WHITESPACE"," ",112],["T_IS_NOT_EQUAL","!=",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$hash",112],")",";",["T_WHITESPACE","\n\n    ",112],["T_IF","if",114],["T_WHITESPACE"," ",114],"(",["T_VARIABLE","$has_new_content",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n      ",114],["T_COMMENT","\/\/ Parse the feed.\n",115],["T_WHITESPACE","      ",116],["T_TRY","try",116],["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n        ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","parserManager",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","createInstance",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","config",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","get",117],"(",["T_CONSTANT_ENCAPSED_STRING","'parser'",117],")",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","parse",117],"(",["T_VARIABLE","$feed",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n          ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(","!",["T_VARIABLE","$feed",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getWebsiteUrl",118],"(",")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$feed",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","setWebsiteUrl",119],"(",["T_VARIABLE","$feed",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getUrl",119],"(",")",")",";",["T_WHITESPACE","\n          ",119],"}",["T_WHITESPACE","\n          ",120],["T_VARIABLE","$feed",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","setHash",121],"(",["T_VARIABLE","$hash",121],")",";",["T_WHITESPACE","\n          ",121],["T_COMMENT","\/\/ Update feed with parsed data.\n",122],["T_WHITESPACE","          ",123],["T_VARIABLE","$feed",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","save",123],"(",")",";",["T_WHITESPACE","\n\n          ",123],["T_COMMENT","\/\/ Log if feed URL has changed.\n",125],["T_WHITESPACE","          ",126],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$feed",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getUrl",126],"(",")",["T_WHITESPACE"," ",126],["T_IS_NOT_EQUAL","!=",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$feed_url",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","logger",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","notice",127],"(",["T_CONSTANT_ENCAPSED_STRING","'Updated URL for feed %title to %url.'",127],",",["T_WHITESPACE"," ",127],["T_ARRAY","array",127],"(",["T_CONSTANT_ENCAPSED_STRING","'%title'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$feed",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","label",127],"(",")",",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'%url'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$feed",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getUrl",127],"(",")",")",")",";",["T_WHITESPACE","\n          ",127],"}",["T_WHITESPACE","\n\n          ",128],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","logger",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","notice",130],"(",["T_CONSTANT_ENCAPSED_STRING","'There is new syndicated content from %site.'",130],",",["T_WHITESPACE"," ",130],["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'%site'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$feed",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","label",130],"(",")",")",")",";",["T_WHITESPACE","\n\n          ",130],["T_COMMENT","\/\/ If there are items on the feed, let enabled processors process them.\n",132],["T_WHITESPACE","          ",133],["T_IF","if",133],["T_WHITESPACE"," ",133],"(","!",["T_EMPTY","empty",133],"(",["T_VARIABLE","$feed",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","items",133],")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_FOREACH","foreach",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$processor_instances",134],["T_WHITESPACE"," ",134],["T_AS","as",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$instance",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n              ",134],["T_VARIABLE","$instance",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","process",135],"(",["T_VARIABLE","$feed",135],")",";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n          ",136],"}",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n      ",138],"}",["T_WHITESPACE","\n      ",139],["T_CATCH","catch",140],["T_WHITESPACE"," ",140],"(",["T_STRING","PluginException",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$e",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n        ",140],["T_STRING","watchdog_exception",141],"(",["T_CONSTANT_ENCAPSED_STRING","'aggregator'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$e",141],")",";",["T_WHITESPACE","\n      ",141],"}",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_COMMENT","\/\/ Processing is done, call postProcess on enabled processors.\n",145],["T_WHITESPACE","    ",146],["T_FOREACH","foreach",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$processor_instances",146],["T_WHITESPACE"," ",146],["T_AS","as",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$instance",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n      ",146],["T_VARIABLE","$instance",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","postProcess",147],"(",["T_VARIABLE","$feed",147],")",";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$has_new_content",150],";",["T_WHITESPACE","\n  ",150],"}",["T_WHITESPACE","\n\n",151],"}",["T_WHITESPACE","\n",153]]