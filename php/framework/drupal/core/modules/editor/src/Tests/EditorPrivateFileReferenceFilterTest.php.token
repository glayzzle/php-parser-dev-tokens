[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","editor",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","file",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","File",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","BrowserTestBase",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","user",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Role",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","user",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RoleInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Tests Editor module's file reference filter with private files.\n *\n * @group editor\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","EditorPrivateFileReferenceFilterTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","BrowserTestBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PUBLIC","public",22],["T_WHITESPACE"," ",22],["T_STATIC","static",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$modules",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],"[",["T_WHITESPACE","\n    ",22],["T_COMMENT","\/\/ Needed for the config: this is the only module in core that utilizes the\n",23],["T_WHITESPACE","    ",24],["T_COMMENT","\/\/ functionality in editor.module to be tested, and depends on that.\n",24],["T_WHITESPACE","    ",25],["T_CONSTANT_ENCAPSED_STRING","'ckeditor'",25],",",["T_WHITESPACE","\n    ",25],["T_COMMENT","\/\/ Depends on filter.module (indirectly).\n",26],["T_WHITESPACE","    ",27],["T_CONSTANT_ENCAPSED_STRING","'node'",27],",",["T_WHITESPACE","\n    ",27],["T_COMMENT","\/\/ Pulls in the config we're using during testing which create a text format\n",28],["T_WHITESPACE","    ",29],["T_COMMENT","\/\/ - with the filter_html_image_secure filter DISABLED,\n",29],["T_WHITESPACE","    ",30],["T_COMMENT","\/\/ - with the editor set to CKEditor,\n",30],["T_WHITESPACE","    ",31],["T_COMMENT","\/\/ - with drupalimage.image_upload.scheme set to 'private',\n",31],["T_WHITESPACE","    ",32],["T_COMMENT","\/\/ - with drupalimage.image_upload.directory set to ''.\n",32],["T_WHITESPACE","    ",33],["T_CONSTANT_ENCAPSED_STRING","'editor_private_test'",33],",",["T_WHITESPACE","\n  ",33],"]",";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * Tests the editor file reference filter with private files.\n   *\/",36],["T_WHITESPACE","\n  ",38],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","testEditorPrivateFileReferenceFilter",39],"(",")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$author",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","drupalCreateUser",40],"(",")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","drupalLogin",41],"(",["T_VARIABLE","$author",41],")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Create a content type with a body field.\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","drupalCreateContentType",44],"(","[",["T_CONSTANT_ENCAPSED_STRING","'type'",44],["T_WHITESPACE"," ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'page'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'name'",44],["T_WHITESPACE"," ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'Basic page'",44],"]",")",";",["T_WHITESPACE","\n\n    ",44],["T_COMMENT","\/\/ Create a file in the 'private:\/\/ ' stream.\n",46],["T_WHITESPACE","    ",47],["T_VARIABLE","$filename",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'test.png'",47],";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$src",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'\/system\/files\/'",48],["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_VARIABLE","$filename",48],";",["T_WHITESPACE","\n    ",48],["T_DOC_COMMENT","\/** @var \\Drupal\\file\\FileInterface $file *\/",49],["T_WHITESPACE","\n    ",49],["T_VARIABLE","$file",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","File",50],["T_DOUBLE_COLON","::",50],["T_STRING","create",50],"(","[",["T_WHITESPACE","\n      ",50],["T_CONSTANT_ENCAPSED_STRING","'uri'",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'private:\/\/'",51],["T_WHITESPACE"," ",51],".",["T_WHITESPACE"," ",51],["T_VARIABLE","$filename",51],",",["T_WHITESPACE","\n    ",51],"]",")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$file",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","setTemporary",53],"(",")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$file",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","setOwner",54],"(",["T_VARIABLE","$author",54],")",";",["T_WHITESPACE","\n    ",54],["T_COMMENT","\/\/ Create the file itself.\n",55],["T_WHITESPACE","    ",56],["T_STRING","file_put_contents",56],"(",["T_VARIABLE","$file",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getFileUri",56],"(",")",",",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","randomString",56],"(",")",")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$file",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","save",57],"(",")",";",["T_WHITESPACE","\n\n    ",57],["T_COMMENT","\/\/ The image should be visible for its author.\n",59],["T_WHITESPACE","    ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","drupalGet",60],"(",["T_VARIABLE","$src",60],")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","assertSession",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","statusCodeEquals",61],"(",["T_LNUMBER","200",61],")",";",["T_WHITESPACE","\n    ",61],["T_COMMENT","\/\/ The not-yet-permanent image should NOT be visible for anonymous.\n",62],["T_WHITESPACE","    ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","drupalLogout",63],"(",")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","drupalGet",64],"(",["T_VARIABLE","$src",64],")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertSession",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","statusCodeEquals",65],"(",["T_LNUMBER","403",65],")",";",["T_WHITESPACE","\n\n    ",65],["T_COMMENT","\/\/ Resave the file to be permanent.\n",67],["T_WHITESPACE","    ",68],["T_VARIABLE","$file",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","setPermanent",68],"(",")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$file",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","save",69],"(",")",";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/\/ Create a node with its body field properly pointing to the just-created\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ file.\n",72],["T_WHITESPACE","    ",73],["T_VARIABLE","$node",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","drupalCreateNode",73],"(","[",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'type'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'page'",74],",",["T_WHITESPACE","\n      ",74],["T_CONSTANT_ENCAPSED_STRING","'body'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],"[",["T_WHITESPACE","\n        ",75],["T_CONSTANT_ENCAPSED_STRING","'value'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'<img alt=\"alt\" data-entity-type=\"file\" data-entity-uuid=\"'",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_VARIABLE","$file",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","uuid",76],"(",")",["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'\" src=\"'",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_VARIABLE","$src",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'\" \/>'",76],",",["T_WHITESPACE","\n        ",76],["T_CONSTANT_ENCAPSED_STRING","'format'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'private_images'",77],",",["T_WHITESPACE","\n      ",77],"]",",",["T_WHITESPACE","\n      ",78],["T_CONSTANT_ENCAPSED_STRING","'uid'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$author",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","id",79],"(",")",",",["T_WHITESPACE","\n    ",79],"]",")",";",["T_WHITESPACE","\n\n    ",80],["T_COMMENT","\/\/ Do the actual test. The image should be visible for anonymous users,\n",82],["T_WHITESPACE","    ",83],["T_COMMENT","\/\/ because they can view the referencing entity.\n",83],["T_WHITESPACE","    ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","drupalGet",84],"(",["T_VARIABLE","$node",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","toUrl",84],"(",")",")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","assertSession",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","statusCodeEquals",85],"(",["T_LNUMBER","200",85],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","drupalGet",86],"(",["T_VARIABLE","$src",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","assertSession",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","statusCodeEquals",87],"(",["T_LNUMBER","200",87],")",";",["T_WHITESPACE","\n\n    ",87],["T_COMMENT","\/\/ Disallow anonymous users to view the entity, which then should also\n",89],["T_WHITESPACE","    ",90],["T_COMMENT","\/\/ disallow them to view the image.\n",90],["T_WHITESPACE","    ",91],["T_STRING","Role",91],["T_DOUBLE_COLON","::",91],["T_STRING","load",91],"(",["T_STRING","RoleInterface",91],["T_DOUBLE_COLON","::",91],["T_STRING","ANONYMOUS_ID",91],")",["T_WHITESPACE","\n      ",91],["T_OBJECT_OPERATOR","->",92],["T_STRING","revokePermission",92],"(",["T_CONSTANT_ENCAPSED_STRING","'access content'",92],")",["T_WHITESPACE","\n      ",92],["T_OBJECT_OPERATOR","->",93],["T_STRING","save",93],"(",")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","drupalGet",94],"(",["T_VARIABLE","$node",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","toUrl",94],"(",")",")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","assertSession",95],"(",")",["T_OBJECT_OPERATOR","->",95],["T_STRING","statusCodeEquals",95],"(",["T_LNUMBER","403",95],")",";",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","drupalGet",96],"(",["T_VARIABLE","$src",96],")",";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","assertSession",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","statusCodeEquals",97],"(",["T_LNUMBER","403",97],")",";",["T_WHITESPACE","\n  ",97],"}",["T_WHITESPACE","\n\n",98],"}",["T_WHITESPACE","\n",100]]