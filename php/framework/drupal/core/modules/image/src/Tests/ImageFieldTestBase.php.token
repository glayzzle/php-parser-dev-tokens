[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","image",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Tests",5],["T_NS_SEPARATOR","\\",5],["T_STRING","image",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Kernel",5],["T_NS_SEPARATOR","\\",5],["T_STRING","ImageFieldCreationTrait",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","simpletest",6],["T_NS_SEPARATOR","\\",6],["T_STRING","WebTestBase",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * TODO: Test the following functions.\n *\n * image.effects.inc:\n *   image_style_generate()\n *   \\Drupal\\image\\ImageStyleInterface::createDerivative()\n *\n * image.module:\n *   image_style_options()\n *   \\Drupal\\image\\ImageStyleInterface::flush()\n *   image_filter_keyword()\n *\/",8],["T_WHITESPACE","\n\n",19],["T_DOC_COMMENT","\/**\n * This class provides methods specifically for testing Image's field handling.\n *\/",21],["T_WHITESPACE","\n",23],["T_ABSTRACT","abstract",24],["T_WHITESPACE"," ",24],["T_CLASS","class",24],["T_WHITESPACE"," ",24],["T_STRING","ImageFieldTestBase",24],["T_WHITESPACE"," ",24],["T_EXTENDS","extends",24],["T_WHITESPACE"," ",24],["T_STRING","WebTestBase",24],["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n\n  ",24],["T_USE","use",26],["T_WHITESPACE"," ",26],["T_STRING","ImageFieldCreationTrait",26],";",["T_WHITESPACE","\n\n  ",26],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",28],["T_WHITESPACE","\n  ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_STATIC","static",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$modules",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_ARRAY","array",33],"(",["T_CONSTANT_ENCAPSED_STRING","'node'",33],",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'image'",33],",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'field_ui'",33],",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'image_module_test'",33],")",";",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * An user with permissions to administer content types and image styles.\n   *\n   * @var \\Drupal\\user\\UserInterface\n   *\/",35],["T_WHITESPACE","\n  ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$adminUser",40],";",["T_WHITESPACE","\n\n  ",40],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","setUp",42],"(",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n    ",42],["T_STRING","parent",43],["T_DOUBLE_COLON","::",43],["T_STRING","setUp",43],"(",")",";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/\/ Create Basic page and Article node types.\n",45],["T_WHITESPACE","    ",46],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","profile",46],["T_WHITESPACE"," ",46],["T_IS_NOT_EQUAL","!=",46],["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'standard'",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n      ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","drupalCreateContentType",47],"(",["T_ARRAY","array",47],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'page'",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'name'",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'Basic page'",47],")",")",";",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","drupalCreateContentType",48],"(",["T_ARRAY","array",48],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'article'",48],",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'name'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'Article'",48],")",")",";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n\n    ",49],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","adminUser",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","drupalCreateUser",51],"(",["T_ARRAY","array",51],"(",["T_CONSTANT_ENCAPSED_STRING","'access content'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'access administration pages'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer content types'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer node fields'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer nodes'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'create article content'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'edit any article content'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'delete any article content'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer image styles'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'administer node display'",51],")",")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","drupalLogin",52],"(",["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","adminUser",52],")",";",["T_WHITESPACE","\n  ",52],"}",["T_WHITESPACE","\n\n  ",53],["T_DOC_COMMENT","\/**\n   * Preview an image in a node.\n   *\n   * @param \\Drupal\\Core\\Image\\ImageInterface $image\n   *   A file object representing the image to upload.\n   * @param string $field_name\n   *   Name of the image field the image should be attached to.\n   * @param string $type\n   *   The type of node to create.\n   *\/",55],["T_WHITESPACE","\n  ",64],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","previewNodeImage",65],"(",["T_VARIABLE","$image",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$field_name",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$type",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$edit",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",["T_WHITESPACE","\n      ",66],["T_CONSTANT_ENCAPSED_STRING","'title[0][value]'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","randomMachineName",67],"(",")",",",["T_WHITESPACE","\n    ",67],")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$edit",69],"[",["T_CONSTANT_ENCAPSED_STRING","'files['",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_VARIABLE","$field_name",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'_0]'",69],"]",["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","drupal_realpath",69],"(",["T_VARIABLE","$image",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","uri",69],")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","drupalPostForm",70],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/add\/'",70],["T_WHITESPACE"," ",70],".",["T_WHITESPACE"," ",70],["T_VARIABLE","$type",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$edit",70],",",["T_WHITESPACE"," ",70],["T_STRING","t",70],"(",["T_CONSTANT_ENCAPSED_STRING","'Preview'",70],")",")",";",["T_WHITESPACE","\n  ",70],"}",["T_WHITESPACE","\n\n  ",71],["T_DOC_COMMENT","\/**\n   * Upload an image to a node.\n   *\n   * @param $image\n   *   A file object representing the image to upload.\n   * @param $field_name\n   *   Name of the image field the image should be attached to.\n   * @param $type\n   *   The type of node to create.\n   * @param $alt\n   *   The alt text for the image. Use if the field settings require alt text.\n   *\/",73],["T_WHITESPACE","\n  ",84],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","uploadNodeImage",85],"(",["T_VARIABLE","$image",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$field_name",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$type",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$alt",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","''",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$edit",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_ARRAY","array",86],"(",["T_WHITESPACE","\n      ",86],["T_CONSTANT_ENCAPSED_STRING","'title[0][value]'",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","randomMachineName",87],"(",")",",",["T_WHITESPACE","\n    ",87],")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$edit",89],"[",["T_CONSTANT_ENCAPSED_STRING","'files['",89],["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_VARIABLE","$field_name",89],["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'_0]'",89],"]",["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","drupal_realpath",89],"(",["T_VARIABLE","$image",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","uri",89],")",";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","drupalPostForm",90],"(",["T_CONSTANT_ENCAPSED_STRING","'node\/add\/'",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$type",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$edit",90],",",["T_WHITESPACE"," ",90],["T_STRING","t",90],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and publish'",90],")",")",";",["T_WHITESPACE","\n    ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$alt",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n      ",91],["T_COMMENT","\/\/ Add alt text.\n",92],["T_WHITESPACE","      ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","drupalPostForm",93],"(",["T_STRING","NULL",93],",",["T_WHITESPACE"," ",93],"[",["T_VARIABLE","$field_name",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'[0][alt]'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$alt",93],"]",",",["T_WHITESPACE"," ",93],["T_STRING","t",93],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and publish'",93],")",")",";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_COMMENT","\/\/ Retrieve ID of the newly created node from the current URL.\n",96],["T_WHITESPACE","    ",97],["T_VARIABLE","$matches",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",")",";",["T_WHITESPACE","\n    ",97],["T_STRING","preg_match",98],"(",["T_CONSTANT_ENCAPSED_STRING","'\/node\\\/([0-9]+)\/'",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getUrl",98],"(",")",",",["T_WHITESPACE"," ",98],["T_VARIABLE","$matches",98],")",";",["T_WHITESPACE","\n    ",98],["T_RETURN","return",99],["T_WHITESPACE"," ",99],["T_ISSET","isset",99],"(",["T_VARIABLE","$matches",99],"[",["T_LNUMBER","1",99],"]",")",["T_WHITESPACE"," ",99],"?",["T_WHITESPACE"," ",99],["T_VARIABLE","$matches",99],"[",["T_LNUMBER","1",99],"]",["T_WHITESPACE"," ",99],":",["T_WHITESPACE"," ",99],["T_STRING","FALSE",99],";",["T_WHITESPACE","\n  ",99],"}",["T_WHITESPACE","\n\n  ",100],["T_DOC_COMMENT","\/**\n   * Retrieves the fid of the last inserted file.\n   *\/",102],["T_WHITESPACE","\n  ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","getLastFileId",105],"(",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n    ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_INT_CAST","(int)",106],["T_WHITESPACE"," ",106],["T_STRING","db_query",106],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT MAX(fid) FROM {file_managed}'",106],")",["T_OBJECT_OPERATOR","->",106],["T_STRING","fetchField",106],"(",")",";",["T_WHITESPACE","\n  ",106],"}",["T_WHITESPACE","\n\n",107],"}",["T_WHITESPACE","\n",109]]