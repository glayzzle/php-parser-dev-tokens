[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","image",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Controller",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Crypt",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Image",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ImageFactory",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Lock",7],["T_NS_SEPARATOR","\\",7],["T_STRING","LockBackendInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","image",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ImageStyleInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","system",9],["T_NS_SEPARATOR","\\",9],["T_STRING","FileDownloadController",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Symfony",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Component",10],["T_NS_SEPARATOR","\\",10],["T_STRING","DependencyInjection",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ContainerInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Symfony",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Component",11],["T_NS_SEPARATOR","\\",11],["T_STRING","HttpFoundation",11],["T_NS_SEPARATOR","\\",11],["T_STRING","BinaryFileResponse",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","HttpFoundation",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Request",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Symfony",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Component",13],["T_NS_SEPARATOR","\\",13],["T_STRING","HttpFoundation",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Response",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","HttpKernel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Exception",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AccessDeniedHttpException",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpKernel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Exception",15],["T_NS_SEPARATOR","\\",15],["T_STRING","ServiceUnavailableHttpException",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Defines a controller to serve image styles.\n *\/",17],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","ImageStyleDownloadController",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","FileDownloadController",20],["T_WHITESPACE"," ",20],"{",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * The lock backend.\n   *\n   * @var \\Drupal\\Core\\Lock\\LockBackendInterface\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$lock",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * The image factory.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageFactory\n   *\/",29],["T_WHITESPACE","\n  ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$imageFactory",34],";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * A logger instance.\n   *\n   * @var \\Psr\\Log\\LoggerInterface\n   *\/",36],["T_WHITESPACE","\n  ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$logger",41],";",["T_WHITESPACE","\n\n  ",41],["T_DOC_COMMENT","\/**\n   * Constructs a ImageStyleDownloadController object.\n   *\n   * @param \\Drupal\\Core\\Lock\\LockBackendInterface $lock\n   *   The lock backend.\n   * @param \\Drupal\\Core\\Image\\ImageFactory $image_factory\n   *   The image factory.\n   *\/",43],["T_WHITESPACE","\n  ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","__construct",51],"(",["T_STRING","LockBackendInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$lock",51],",",["T_WHITESPACE"," ",51],["T_STRING","ImageFactory",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$image_factory",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","lock",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$lock",52],";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","imageFactory",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$image_factory",53],";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","logger",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getLogger",54],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",54],")",";",["T_WHITESPACE","\n  ",54],"}",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",57],["T_WHITESPACE","\n  ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_STATIC","static",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","create",60],"(",["T_STRING","ContainerInterface",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$container",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n    ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_NEW","new",61],["T_WHITESPACE"," ",61],["T_STATIC","static",61],"(",["T_WHITESPACE","\n      ",61],["T_VARIABLE","$container",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","get",62],"(",["T_CONSTANT_ENCAPSED_STRING","'lock'",62],")",",",["T_WHITESPACE","\n      ",62],["T_VARIABLE","$container",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","get",63],"(",["T_CONSTANT_ENCAPSED_STRING","'image.factory'",63],")",["T_WHITESPACE","\n    ",63],")",";",["T_WHITESPACE","\n  ",64],"}",["T_WHITESPACE","\n\n  ",65],["T_DOC_COMMENT","\/**\n   * Generates a derivative, given a style and image path.\n   *\n   * After generating an image, transfer it to the requesting agent.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param string $scheme\n   *   The file scheme, defaults to 'private'.\n   * @param \\Drupal\\image\\ImageStyleInterface $image_style\n   *   The image style to deliver.\n   *\n   * @return \\Symfony\\Component\\HttpFoundation\\BinaryFileResponse|\\Symfony\\Component\\HttpFoundation\\Response\n   *   The transferred file as response or some error response.\n   *\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\AccessDeniedHttpException\n   *   Thrown when the user does not have access to the file.\n   * @throws \\Symfony\\Component\\HttpKernel\\Exception\\ServiceUnavailableHttpException\n   *   Thrown when the file is still being generated.\n   *\/",67],["T_WHITESPACE","\n  ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","deliver",87],"(",["T_STRING","Request",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$request",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$scheme",87],",",["T_WHITESPACE"," ",87],["T_STRING","ImageStyleInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$image_style",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$target",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$request",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","query",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","get",88],"(",["T_CONSTANT_ENCAPSED_STRING","'file'",88],")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$image_uri",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$scheme",89],["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","':\/\/'",89],["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_VARIABLE","$target",89],";",["T_WHITESPACE","\n\n    ",89],["T_COMMENT","\/\/ Check that the style is defined, the scheme is valid, and the image\n",91],["T_WHITESPACE","    ",92],["T_COMMENT","\/\/ derivative token is valid. Sites which require image derivatives to be\n",92],["T_WHITESPACE","    ",93],["T_COMMENT","\/\/ generated without a token can set the\n",93],["T_WHITESPACE","    ",94],["T_COMMENT","\/\/ 'image.settings:allow_insecure_derivatives' configuration to TRUE to\n",94],["T_WHITESPACE","    ",95],["T_COMMENT","\/\/ bypass the latter check, but this will increase the site's vulnerability\n",95],["T_WHITESPACE","    ",96],["T_COMMENT","\/\/ to denial-of-service attacks. To prevent this variable from leaving the\n",96],["T_WHITESPACE","    ",97],["T_COMMENT","\/\/ site vulnerable to the most serious attacks, a token is always required\n",97],["T_WHITESPACE","    ",98],["T_COMMENT","\/\/ when a derivative of a style is requested.\n",98],["T_WHITESPACE","    ",99],["T_COMMENT","\/\/ The $target variable for a derivative of a style has\n",99],["T_WHITESPACE","    ",100],["T_COMMENT","\/\/ styles\/<style_name>\/... as structure, so we check if the $target variable\n",100],["T_WHITESPACE","    ",101],["T_COMMENT","\/\/ starts with styles\/.\n",101],["T_WHITESPACE","    ",102],["T_VARIABLE","$valid",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],"!",["T_EMPTY","empty",102],"(",["T_VARIABLE","$image_style",102],")",["T_WHITESPACE"," ",102],["T_BOOLEAN_AND","&&",102],["T_WHITESPACE"," ",102],["T_STRING","file_stream_wrapper_valid_scheme",102],"(",["T_VARIABLE","$scheme",102],")",";",["T_WHITESPACE","\n    ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","config",103],"(",["T_CONSTANT_ENCAPSED_STRING","'image.settings'",103],")",["T_OBJECT_OPERATOR","->",103],["T_STRING","get",103],"(",["T_CONSTANT_ENCAPSED_STRING","'allow_insecure_derivatives'",103],")",["T_WHITESPACE"," ",103],["T_BOOLEAN_OR","||",103],["T_WHITESPACE"," ",103],["T_STRING","strpos",103],"(",["T_STRING","ltrim",103],"(",["T_VARIABLE","$target",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'\\\/'",103],")",",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'styles\/'",103],")",["T_WHITESPACE"," ",103],["T_IS_IDENTICAL","===",103],["T_WHITESPACE"," ",103],["T_LNUMBER","0",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n      ",103],["T_VARIABLE","$valid",104],["T_WHITESPACE"," ",104],["T_AND_EQUAL","&=",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$request",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","query",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","get",104],"(",["T_STRING","IMAGE_DERIVATIVE_TOKEN",104],")",["T_WHITESPACE"," ",104],["T_IS_IDENTICAL","===",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$image_style",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getPathToken",104],"(",["T_VARIABLE","$image_uri",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n    ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_VARIABLE","$valid",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n      ",106],["T_THROW","throw",107],["T_WHITESPACE"," ",107],["T_NEW","new",107],["T_WHITESPACE"," ",107],["T_STRING","AccessDeniedHttpException",107],"(",")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_VARIABLE","$derivative_uri",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$image_style",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","buildUri",110],"(",["T_VARIABLE","$image_uri",110],")",";",["T_WHITESPACE","\n    ",110],["T_VARIABLE","$headers",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n\n    ",111],["T_COMMENT","\/\/ If using the private scheme, let other modules provide headers and\n",113],["T_WHITESPACE","    ",114],["T_COMMENT","\/\/ control access to the file.\n",114],["T_WHITESPACE","    ",115],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$scheme",115],["T_WHITESPACE"," ",115],["T_IS_EQUAL","==",115],["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'private'",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n      ",115],["T_VARIABLE","$headers",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","moduleHandler",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","invokeAll",116],"(",["T_CONSTANT_ENCAPSED_STRING","'file_download'",116],",",["T_WHITESPACE"," ",116],["T_ARRAY","array",116],"(",["T_VARIABLE","$image_uri",116],")",")",";",["T_WHITESPACE","\n      ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_STRING","in_array",117],"(","-",["T_LNUMBER","1",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$headers",117],")",["T_WHITESPACE"," ",117],["T_BOOLEAN_OR","||",117],["T_WHITESPACE"," ",117],["T_EMPTY","empty",117],"(",["T_VARIABLE","$headers",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n        ",117],["T_THROW","throw",118],["T_WHITESPACE"," ",118],["T_NEW","new",118],["T_WHITESPACE"," ",118],["T_STRING","AccessDeniedHttpException",118],"(",")",";",["T_WHITESPACE","\n      ",118],"}",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_COMMENT","\/\/ Don't try to generate file if source is missing.\n",122],["T_WHITESPACE","    ",123],["T_IF","if",123],["T_WHITESPACE"," ",123],"(","!",["T_STRING","file_exists",123],"(",["T_VARIABLE","$image_uri",123],")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n      ",123],["T_COMMENT","\/\/ If the image style converted the extension, it has been added to the\n",124],["T_WHITESPACE","      ",125],["T_COMMENT","\/\/ original file, resulting in filenames like image.png.jpeg. So to find\n",125],["T_WHITESPACE","      ",126],["T_COMMENT","\/\/ the actual source image, we remove the extension and check if that\n",126],["T_WHITESPACE","      ",127],["T_COMMENT","\/\/ image exists.\n",127],["T_WHITESPACE","      ",128],["T_VARIABLE","$path_info",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","pathinfo",128],"(",["T_VARIABLE","$image_uri",128],")",";",["T_WHITESPACE","\n      ",128],["T_VARIABLE","$converted_image_uri",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$path_info",129],"[",["T_CONSTANT_ENCAPSED_STRING","'dirname'",129],"]",["T_WHITESPACE"," ",129],".",["T_WHITESPACE"," ",129],["T_STRING","DIRECTORY_SEPARATOR",129],["T_WHITESPACE"," ",129],".",["T_WHITESPACE"," ",129],["T_VARIABLE","$path_info",129],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",129],"]",";",["T_WHITESPACE","\n      ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(","!",["T_STRING","file_exists",130],"(",["T_VARIABLE","$converted_image_uri",130],")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","logger",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","notice",131],"(",["T_CONSTANT_ENCAPSED_STRING","'Source image at %source_image_path not found while trying to generate derivative image at %derivative_path.'",131],",",["T_WHITESPACE"," ",131],["T_ARRAY","array",131],"(",["T_CONSTANT_ENCAPSED_STRING","'%source_image_path'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$image_uri",131],",",["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'%derivative_path'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$derivative_uri",131],")",")",";",["T_WHITESPACE","\n        ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_NEW","new",132],["T_WHITESPACE"," ",132],["T_STRING","Response",132],"(",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","t",132],"(",["T_CONSTANT_ENCAPSED_STRING","'Error generating image, missing source file.'",132],")",",",["T_WHITESPACE"," ",132],["T_LNUMBER","404",132],")",";",["T_WHITESPACE","\n      ",132],"}",["T_WHITESPACE","\n      ",133],["T_ELSE","else",134],["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n        ",134],["T_COMMENT","\/\/ The converted file does exist, use it as the source.\n",135],["T_WHITESPACE","        ",136],["T_VARIABLE","$image_uri",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$converted_image_uri",136],";",["T_WHITESPACE","\n      ",136],"}",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_COMMENT","\/\/ Don't start generating the image if the derivative already exists or if\n",140],["T_WHITESPACE","    ",141],["T_COMMENT","\/\/ generation is in progress in another thread.\n",141],["T_WHITESPACE","    ",142],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_STRING","file_exists",142],"(",["T_VARIABLE","$derivative_uri",142],")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n      ",142],["T_VARIABLE","$lock_name",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'image_style_deliver:'",143],["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_VARIABLE","$image_style",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","id",143],"(",")",["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","':'",143],["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_STRING","Crypt",143],["T_DOUBLE_COLON","::",143],["T_STRING","hashBase64",143],"(",["T_VARIABLE","$image_uri",143],")",";",["T_WHITESPACE","\n      ",143],["T_VARIABLE","$lock_acquired",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","lock",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","acquire",144],"(",["T_VARIABLE","$lock_name",144],")",";",["T_WHITESPACE","\n      ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(","!",["T_VARIABLE","$lock_acquired",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n        ",145],["T_COMMENT","\/\/ Tell client to retry again in 3 seconds. Currently no browsers are\n",146],["T_WHITESPACE","        ",147],["T_COMMENT","\/\/ known to support Retry-After.\n",147],["T_WHITESPACE","        ",148],["T_THROW","throw",148],["T_WHITESPACE"," ",148],["T_NEW","new",148],["T_WHITESPACE"," ",148],["T_STRING","ServiceUnavailableHttpException",148],"(",["T_LNUMBER","3",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","t",148],"(",["T_CONSTANT_ENCAPSED_STRING","'Image generation in progress. Try again shortly.'",148],")",")",";",["T_WHITESPACE","\n      ",148],"}",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_COMMENT","\/\/ Try to generate the image, unless another thread just did it while we\n",152],["T_WHITESPACE","    ",153],["T_COMMENT","\/\/ were acquiring the lock.\n",153],["T_WHITESPACE","    ",154],["T_VARIABLE","$success",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_STRING","file_exists",154],"(",["T_VARIABLE","$derivative_uri",154],")",["T_WHITESPACE"," ",154],["T_BOOLEAN_OR","||",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$image_style",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","createDerivative",154],"(",["T_VARIABLE","$image_uri",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$derivative_uri",154],")",";",["T_WHITESPACE","\n\n    ",154],["T_IF","if",156],["T_WHITESPACE"," ",156],"(","!",["T_EMPTY","empty",156],"(",["T_VARIABLE","$lock_acquired",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n      ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","lock",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","release",157],"(",["T_VARIABLE","$lock_name",157],")",";",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$success",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n      ",160],["T_VARIABLE","$image",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","imageFactory",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","get",161],"(",["T_VARIABLE","$derivative_uri",161],")",";",["T_WHITESPACE","\n      ",161],["T_VARIABLE","$uri",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$image",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getSource",162],"(",")",";",["T_WHITESPACE","\n      ",162],["T_VARIABLE","$headers",163],["T_WHITESPACE"," ",163],["T_PLUS_EQUAL","+=",163],["T_WHITESPACE"," ",163],["T_ARRAY","array",163],"(",["T_WHITESPACE","\n        ",163],["T_CONSTANT_ENCAPSED_STRING","'Content-Type'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$image",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getMimeType",164],"(",")",",",["T_WHITESPACE","\n        ",164],["T_CONSTANT_ENCAPSED_STRING","'Content-Length'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$image",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getFileSize",165],"(",")",",",["T_WHITESPACE","\n      ",165],")",";",["T_WHITESPACE","\n      ",166],["T_COMMENT","\/\/ \\Drupal\\Core\\EventSubscriber\\FinishResponseSubscriber::onRespond()\n",167],["T_WHITESPACE","      ",168],["T_COMMENT","\/\/ sets response as not cacheable if the Cache-Control header is not\n",168],["T_WHITESPACE","      ",169],["T_COMMENT","\/\/ already modified. We pass in FALSE for non-private schemes for the\n",169],["T_WHITESPACE","      ",170],["T_COMMENT","\/\/ $public parameter to make sure we don't change the headers.\n",170],["T_WHITESPACE","      ",171],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_NEW","new",171],["T_WHITESPACE"," ",171],["T_STRING","BinaryFileResponse",171],"(",["T_VARIABLE","$uri",171],",",["T_WHITESPACE"," ",171],["T_LNUMBER","200",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$headers",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$scheme",171],["T_WHITESPACE"," ",171],["T_IS_NOT_IDENTICAL","!==",171],["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'private'",171],")",";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n    ",172],["T_ELSE","else",173],["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n      ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","logger",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","notice",174],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to generate the derived image located at %path.'",174],",",["T_WHITESPACE"," ",174],["T_ARRAY","array",174],"(",["T_CONSTANT_ENCAPSED_STRING","'%path'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$derivative_uri",174],")",")",";",["T_WHITESPACE","\n      ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_NEW","new",175],["T_WHITESPACE"," ",175],["T_STRING","Response",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","t",175],"(",["T_CONSTANT_ENCAPSED_STRING","'Error generating image.'",175],")",",",["T_WHITESPACE"," ",175],["T_LNUMBER","500",175],")",";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n  ",176],"}",["T_WHITESPACE","\n\n",177],"}",["T_WHITESPACE","\n",179]]