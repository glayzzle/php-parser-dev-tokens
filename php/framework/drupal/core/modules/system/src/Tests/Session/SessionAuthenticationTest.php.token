[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Url",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","basic_auth",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","BasicAuthTestTrait",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","simpletest",7],["T_NS_SEPARATOR","\\",7],["T_STRING","WebTestBase",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests if sessions are correctly handled when a user authenticates.\n *\n * @group Session\n *\/",9],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","SessionAuthenticationTest",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_STRING","WebTestBase",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\n  ",14],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","BasicAuthTestTrait",16],";",["T_WHITESPACE","\n\n  ",16],["T_DOC_COMMENT","\/**\n   * A test user.\n   *\n   * @var \\Drupal\\user\\Entity\\User\n   *\/",18],["T_WHITESPACE","\n  ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$user",23],";",["T_WHITESPACE","\n\n  ",23],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",25],["T_WHITESPACE","\n  ",27],["T_PUBLIC","public",28],["T_WHITESPACE"," ",28],["T_STATIC","static",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$modules",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],"[",["T_CONSTANT_ENCAPSED_STRING","'basic_auth'",28],",",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'session_test'",28],"]",";",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",30],["T_WHITESPACE","\n  ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","setUp",33],"(",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n    ",33],["T_STRING","parent",34],["T_DOUBLE_COLON","::",34],["T_STRING","setUp",34],"(",")",";",["T_WHITESPACE","\n\n    ",34],["T_COMMENT","\/\/ Create a test administrator user.\n",36],["T_WHITESPACE","    ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","user",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","drupalCreateUser",37],"(","[",["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",37],"]",")",";",["T_WHITESPACE","\n  ",37],"}",["T_WHITESPACE","\n\n  ",38],["T_DOC_COMMENT","\/**\n   * Check that a basic authentication session does not leak.\n   *\n   * Regression test for a bug that caused a session initiated by basic\n   * authentication to persist over subsequent unauthorized requests.\n   *\/",40],["T_WHITESPACE","\n  ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","testSessionFromBasicAuthenticationDoesNotLeak",46],"(",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_COMMENT","\/\/ This route is authorized through basic_auth only, not cookie.\n",47],["T_WHITESPACE","    ",48],["T_VARIABLE","$protected_url",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","Url",48],["T_DOUBLE_COLON","::",48],["T_STRING","fromRoute",48],"(",["T_CONSTANT_ENCAPSED_STRING","'session_test.get_session_basic_auth'",48],")",";",["T_WHITESPACE","\n\n    ",48],["T_COMMENT","\/\/ This route is not protected.\n",50],["T_WHITESPACE","    ",51],["T_VARIABLE","$unprotected_url",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","Url",51],["T_DOUBLE_COLON","::",51],["T_STRING","fromRoute",51],"(",["T_CONSTANT_ENCAPSED_STRING","'session_test.get_session_no_auth'",51],")",";",["T_WHITESPACE","\n\n    ",51],["T_COMMENT","\/\/ Test that the route is not accessible as an anonymous user.\n",53],["T_WHITESPACE","    ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","drupalGet",54],"(",["T_VARIABLE","$protected_url",54],")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertResponse",55],"(",["T_LNUMBER","401",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'An anonymous user cannot access a route protected with basic authentication.'",55],")",";",["T_WHITESPACE","\n\n    ",55],["T_COMMENT","\/\/ We should be able to access the route with basic authentication.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","basicAuthGet",58],"(",["T_VARIABLE","$protected_url",58],",",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","user",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getUsername",58],"(",")",",",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","user",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","pass_raw",58],")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","assertResponse",59],"(",["T_LNUMBER","200",59],",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'A route protected with basic authentication can be accessed by an authenticated user.'",59],")",";",["T_WHITESPACE","\n\n    ",59],["T_COMMENT","\/\/ Check that the correct user is logged in.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertEqual",62],"(",["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","user",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","id",62],"(",")",",",["T_WHITESPACE"," ",62],["T_STRING","json_decode",62],"(",["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getRawContent",62],"(",")",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","user",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'The correct user is authenticated on a route with basic authentication.'",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ If we now try to access a page without basic authentication then we\n",64],["T_WHITESPACE","    ",65],["T_COMMENT","\/\/ should no longer be logged in.\n",65],["T_WHITESPACE","    ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","drupalGet",66],"(",["T_VARIABLE","$unprotected_url",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertResponse",67],"(",["T_LNUMBER","200",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'An unprotected route can be accessed without basic authentication.'",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertFalse",68],"(",["T_STRING","json_decode",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getRawContent",68],"(",")",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","user",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'The user is no longer authenticated after visiting a page without basic authentication.'",68],")",";",["T_WHITESPACE","\n\n    ",68],["T_COMMENT","\/\/ If we access the protected page again without basic authentication we\n",70],["T_WHITESPACE","    ",71],["T_COMMENT","\/\/ should get 401 Unauthorized.\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","drupalGet",72],"(",["T_VARIABLE","$protected_url",72],")",";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertResponse",73],"(",["T_LNUMBER","401",73],",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'A subsequent request to the same route without basic authentication is not authorized.'",73],")",";",["T_WHITESPACE","\n  ",73],"}",["T_WHITESPACE","\n\n  ",74],["T_DOC_COMMENT","\/**\n   * Tests if a session can be initiated through basic authentication.\n   *\/",76],["T_WHITESPACE","\n  ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","testBasicAuthSession",79],"(",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n    ",79],["T_COMMENT","\/\/ Set a session value on a request through basic auth.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$test_value",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'alpaca'",81],";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$response",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","basicAuthGet",82],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set-session\/'",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_VARIABLE","$test_value",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","user",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getUsername",82],"(",")",",",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","user",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","pass_raw",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertSessionData",83],"(",["T_VARIABLE","$response",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$test_value",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","assertResponse",84],"(",["T_LNUMBER","200",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'The request to set a session value was successful.'",84],")",";",["T_WHITESPACE","\n\n    ",84],["T_COMMENT","\/\/ Test that on a subsequent request the session value is still present.\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$response",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","basicAuthGet",87],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get-session'",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","user",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getUsername",87],"(",")",",",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","user",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","pass_raw",87],")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","assertSessionData",88],"(",["T_VARIABLE","$response",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$test_value",88],")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","assertResponse",89],"(",["T_LNUMBER","200",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'The request to get a session value was successful.'",89],")",";",["T_WHITESPACE","\n  ",89],"}",["T_WHITESPACE","\n\n  ",90],["T_DOC_COMMENT","\/**\n   * Checks the session data returned by the session test routes.\n   *\n   * @param string $response\n   *   A response object containing the session values and the user ID.\n   * @param string $expected\n   *   The expected session value.\n   *\/",92],["T_WHITESPACE","\n  ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","assertSessionData",100],"(",["T_VARIABLE","$response",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$expected",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$response",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","json_decode",101],"(",["T_VARIABLE","$response",101],",",["T_WHITESPACE"," ",101],["T_STRING","TRUE",101],")",";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","assertEqual",102],"(","[",["T_CONSTANT_ENCAPSED_STRING","'test_value'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$expected",102],"]",",",["T_WHITESPACE"," ",102],["T_VARIABLE","$response",102],"[",["T_CONSTANT_ENCAPSED_STRING","'session'",102],"]",",",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","'The session data matches the expected value.'",102],")",";",["T_WHITESPACE","\n\n    ",102],["T_COMMENT","\/\/ Check that we are logged in as the correct user.\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","assertEqual",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","user",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","id",105],"(",")",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$response",105],"[",["T_CONSTANT_ENCAPSED_STRING","'user'",105],"]",",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'The correct user is logged in.'",105],")",";",["T_WHITESPACE","\n  ",105],"}",["T_WHITESPACE","\n\n  ",106],["T_DOC_COMMENT","\/**\n   * Tests that a session is not started automatically by basic authentication.\n   *\/",108],["T_WHITESPACE","\n  ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","testBasicAuthNoSession",111],"(",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n    ",111],["T_COMMENT","\/\/ A route that is authorized through basic_auth only, not cookie.\n",112],["T_WHITESPACE","    ",113],["T_VARIABLE","$no_cookie_url",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","Url",113],["T_DOUBLE_COLON","::",113],["T_STRING","fromRoute",113],"(",["T_CONSTANT_ENCAPSED_STRING","'session_test.get_session_basic_auth'",113],")",";",["T_WHITESPACE","\n\n    ",113],["T_COMMENT","\/\/ A route that is authorized with standard cookie authentication.\n",115],["T_WHITESPACE","    ",116],["T_VARIABLE","$cookie_url",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'<front>'",116],";",["T_WHITESPACE","\n\n    ",116],["T_COMMENT","\/\/ If we authenticate with a third party authentication system then no\n",118],["T_WHITESPACE","    ",119],["T_COMMENT","\/\/ session cookie should be set, the third party system is responsible for\n",119],["T_WHITESPACE","    ",120],["T_COMMENT","\/\/ sustaining the session.\n",120],["T_WHITESPACE","    ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","basicAuthGet",121],"(",["T_VARIABLE","$no_cookie_url",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","user",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getUsername",121],"(",")",",",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","user",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","pass_raw",121],")",";",["T_WHITESPACE","\n    ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","assertResponse",122],"(",["T_LNUMBER","200",122],",",["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'The user is successfully authenticated using basic authentication.'",122],")",";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","assertFalse",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","drupalGetHeader",123],"(",["T_CONSTANT_ENCAPSED_STRING","'set-cookie'",123],",",["T_WHITESPACE"," ",123],["T_STRING","TRUE",123],")",",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'No cookie is set on a route protected with basic authentication.'",123],")",";",["T_WHITESPACE","\n\n    ",123],["T_COMMENT","\/\/ On the other hand, authenticating using Cookie sets a cookie.\n",125],["T_WHITESPACE","    ",126],["T_VARIABLE","$edit",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","user",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getUsername",126],"(",")",",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'pass'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","user",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","pass_raw",126],"]",";",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","drupalPostForm",127],"(",["T_VARIABLE","$cookie_url",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$edit",127],",",["T_WHITESPACE"," ",127],["T_STRING","t",127],"(",["T_CONSTANT_ENCAPSED_STRING","'Log in'",127],")",")",";",["T_WHITESPACE","\n    ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","assertResponse",128],"(",["T_LNUMBER","200",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'The user is successfully authenticated using cookie authentication.'",128],")",";",["T_WHITESPACE","\n    ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","assertTrue",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","drupalGetHeader",129],"(",["T_CONSTANT_ENCAPSED_STRING","'set-cookie'",129],",",["T_WHITESPACE"," ",129],["T_STRING","TRUE",129],")",",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'A cookie is set on a route protected with cookie authentication.'",129],")",";",["T_WHITESPACE","\n  ",129],"}",["T_WHITESPACE","\n\n",130],"}",["T_WHITESPACE","\n",132]]