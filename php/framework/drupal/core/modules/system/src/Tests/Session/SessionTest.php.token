[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Drupal session handling tests.\n *\n * @group Session\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","SessionTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","WebTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",14],["T_WHITESPACE","\n  ",18],["T_PUBLIC","public",19],["T_WHITESPACE"," ",19],["T_STATIC","static",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$modules",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_ARRAY","array",19],"(",["T_CONSTANT_ENCAPSED_STRING","'session_test'",19],")",";",["T_WHITESPACE","\n\n  ",19],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$dumpHeaders",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_STRING","TRUE",21],";",["T_WHITESPACE","\n\n  ",21],["T_DOC_COMMENT","\/**\n   * Tests for \\Drupal\\Core\\Session\\WriteSafeSessionHandler::setSessionWritable()\n   * ::isSessionWritable and \\Drupal\\Core\\Session\\SessionManager::regenerate().\n   *\/",23],["T_WHITESPACE","\n  ",26],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],["T_STRING","testSessionSaveRegenerate",27],"(",")",["T_WHITESPACE"," ",27],"{",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$session_handler",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","container",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","get",28],"(",["T_CONSTANT_ENCAPSED_STRING","'session_handler.write_safe'",28],")",";",["T_WHITESPACE","\n    ",28],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","assertTrue",29],"(",["T_VARIABLE","$session_handler",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","isSessionWritable",29],"(",")",",",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'session_handler->isSessionWritable() initially returns TRUE.'",29],")",";",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$session_handler",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","setSessionWritable",30],"(",["T_STRING","FALSE",30],")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","assertFalse",31],"(",["T_VARIABLE","$session_handler",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","isSessionWritable",31],"(",")",",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'$session_handler->isSessionWritable() returns FALSE after disabling.'",31],")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$session_handler",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","setSessionWritable",32],"(",["T_STRING","TRUE",32],")",";",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","assertTrue",33],"(",["T_VARIABLE","$session_handler",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","isSessionWritable",33],"(",")",",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'$session_handler->isSessionWritable() returns TRUE after enabling.'",33],")",";",["T_WHITESPACE","\n\n    ",33],["T_COMMENT","\/\/ Test session hardening code from SA-2008-044.\n",35],["T_WHITESPACE","    ",36],["T_VARIABLE","$user",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","drupalCreateUser",36],"(",")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Enable sessions.\n",38],["T_WHITESPACE","    ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","sessionReset",39],"(",["T_VARIABLE","$user",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","id",39],"(",")",")",";",["T_WHITESPACE","\n\n    ",39],["T_COMMENT","\/\/ Make sure the session cookie is set as HttpOnly.\n",41],["T_WHITESPACE","    ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","drupalLogin",42],"(",["T_VARIABLE","$user",42],")",";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","assertTrue",43],"(",["T_STRING","preg_match",43],"(",["T_CONSTANT_ENCAPSED_STRING","'\/HttpOnly\/i'",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","drupalGetHeader",43],"(",["T_CONSTANT_ENCAPSED_STRING","'Set-Cookie'",43],",",["T_WHITESPACE"," ",43],["T_STRING","TRUE",43],")",")",",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'Session cookie is set as HttpOnly.'",43],")",";",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","drupalLogout",44],"(",")",";",["T_WHITESPACE","\n\n    ",44],["T_COMMENT","\/\/ Verify that the session is regenerated if a module calls exit\n",46],["T_WHITESPACE","    ",47],["T_COMMENT","\/\/ in hook_user_login().\n",47],["T_WHITESPACE","    ",48],["T_VARIABLE","$user",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","name",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'session_test_user'",48],";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$user",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","save",49],"(",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","drupalGet",50],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/id'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$matches",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],"(",")",";",["T_WHITESPACE","\n    ",51],["T_STRING","preg_match",52],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\s*session_id:(.*)\\n\/'",52],",",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getRawContent",52],"(",")",",",["T_WHITESPACE"," ",52],["T_VARIABLE","$matches",52],")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","assertTrue",53],"(","!",["T_EMPTY","empty",53],"(",["T_VARIABLE","$matches",53],"[",["T_LNUMBER","1",53],"]",")",",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'Found session ID before logging in.'",53],")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$original_session",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$matches",54],"[",["T_LNUMBER","1",54],"]",";",["T_WHITESPACE","\n\n    ",54],["T_COMMENT","\/\/ We cannot use $this->drupalLogin($user); because we exit in\n",56],["T_WHITESPACE","    ",57],["T_COMMENT","\/\/ session_test_user_login() which breaks a normal assertion.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$edit",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_ARRAY","array",58],"(",["T_WHITESPACE","\n      ",58],["T_CONSTANT_ENCAPSED_STRING","'name'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$user",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getUsername",59],"(",")",",",["T_WHITESPACE","\n      ",59],["T_CONSTANT_ENCAPSED_STRING","'pass'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$user",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","pass_raw",60],["T_WHITESPACE","\n    ",60],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","drupalPostForm",62],"(",["T_CONSTANT_ENCAPSED_STRING","'user\/login'",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$edit",62],",",["T_WHITESPACE"," ",62],["T_STRING","t",62],"(",["T_CONSTANT_ENCAPSED_STRING","'Log in'",62],")",")",";",["T_WHITESPACE","\n    ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","drupalGet",63],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",63],")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$pass",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","assertText",64],"(",["T_VARIABLE","$user",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getUsername",64],"(",")",",",["T_WHITESPACE"," ",64],["T_STRING","format_string",64],"(",["T_CONSTANT_ENCAPSED_STRING","'Found name: %name'",64],",",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",["T_CONSTANT_ENCAPSED_STRING","'%name'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$user",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getUsername",64],"(",")",")",")",",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'User login'",64],")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_logged_in",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$pass",65],";",["T_WHITESPACE","\n\n    ",65],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","drupalGet",67],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/id'",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$matches",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_ARRAY","array",68],"(",")",";",["T_WHITESPACE","\n    ",68],["T_STRING","preg_match",69],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\s*session_id:(.*)\\n\/'",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getRawContent",69],"(",")",",",["T_WHITESPACE"," ",69],["T_VARIABLE","$matches",69],")",";",["T_WHITESPACE","\n    ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","assertTrue",70],"(","!",["T_EMPTY","empty",70],"(",["T_VARIABLE","$matches",70],"[",["T_LNUMBER","1",70],"]",")",",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'Found session ID after logging in.'",70],")",";",["T_WHITESPACE","\n    ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertTrue",71],"(",["T_VARIABLE","$matches",71],"[",["T_LNUMBER","1",71],"]",["T_WHITESPACE"," ",71],["T_IS_NOT_EQUAL","!=",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$original_session",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'Session ID changed after login.'",71],")",";",["T_WHITESPACE","\n  ",71],"}",["T_WHITESPACE","\n\n  ",72],["T_DOC_COMMENT","\/**\n   * Test data persistence via the session_test module callbacks.\n   *\/",74],["T_WHITESPACE","\n  ",76],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","testDataPersistence",77],"(",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$user",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","drupalCreateUser",78],"(",["T_ARRAY","array",78],"(",")",")",";",["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ Enable sessions.\n",79],["T_WHITESPACE","    ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","sessionReset",80],"(",["T_VARIABLE","$user",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","id",80],"(",")",")",";",["T_WHITESPACE","\n\n    ",80],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","drupalLogin",82],"(",["T_VARIABLE","$user",82],")",";",["T_WHITESPACE","\n\n    ",82],["T_VARIABLE","$value_1",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","randomMachineName",84],"(",")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","drupalGet",85],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set\/'",85],["T_WHITESPACE"," ",85],".",["T_WHITESPACE"," ",85],["T_VARIABLE","$value_1",85],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertText",86],"(",["T_VARIABLE","$value_1",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'The session value was stored.'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'Session'",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","drupalGet",87],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",87],")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","assertText",88],"(",["T_VARIABLE","$value_1",88],",",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'Session correctly returned the stored data for an authenticated user.'",88],",",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'Session'",88],")",";",["T_WHITESPACE","\n\n    ",88],["T_COMMENT","\/\/ Attempt to write over val_1. If drupal_save_session(FALSE) is working.\n",90],["T_WHITESPACE","    ",91],["T_COMMENT","\/\/ properly, val_1 will still be set.\n",91],["T_WHITESPACE","    ",92],["T_VARIABLE","$value_2",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","randomMachineName",92],"(",")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","drupalGet",93],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/no-set\/'",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_VARIABLE","$value_2",93],")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertText",94],"(",["T_VARIABLE","$value_2",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'The session value was correctly passed to session-test\/no-set.'",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'Session'",94],")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","drupalGet",95],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",95],")",";",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","assertText",96],"(",["T_VARIABLE","$value_1",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'Session data is not saved for drupal_save_session(FALSE).'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'Session'",96],")",";",["T_WHITESPACE","\n\n    ",96],["T_COMMENT","\/\/ Switch browser cookie to anonymous user, then back to user 1.\n",98],["T_WHITESPACE","    ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","sessionReset",99],"(",")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","sessionReset",100],"(",["T_VARIABLE","$user",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","id",100],"(",")",")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","assertText",101],"(",["T_VARIABLE","$value_1",101],",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'Session data persists through browser close.'",101],",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'Session'",101],")",";",["T_WHITESPACE","\n\n    ",101],["T_COMMENT","\/\/ Logout the user and make sure the stored value no longer persists.\n",103],["T_WHITESPACE","    ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","drupalLogout",104],"(",")",";",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","sessionReset",105],"(",")",";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","drupalGet",106],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",106],")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertNoText",107],"(",["T_VARIABLE","$value_1",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","\"After logout, previous user's session data is not available.\"",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'Session'",107],")",";",["T_WHITESPACE","\n\n    ",107],["T_COMMENT","\/\/ Now try to store some data as an anonymous user.\n",109],["T_WHITESPACE","    ",110],["T_VARIABLE","$value_3",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","randomMachineName",110],"(",")",";",["T_WHITESPACE","\n    ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","drupalGet",111],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set\/'",111],["T_WHITESPACE"," ",111],".",["T_WHITESPACE"," ",111],["T_VARIABLE","$value_3",111],")",";",["T_WHITESPACE","\n    ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","assertText",112],"(",["T_VARIABLE","$value_3",112],",",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'Session data stored for anonymous user.'",112],",",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'Session'",112],")",";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","drupalGet",113],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",113],")",";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","assertText",114],"(",["T_VARIABLE","$value_3",114],",",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'Session correctly returned the stored data for an anonymous user.'",114],",",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'Session'",114],")",";",["T_WHITESPACE","\n\n    ",114],["T_COMMENT","\/\/ Try to store data when drupal_save_session(FALSE).\n",116],["T_WHITESPACE","    ",117],["T_VARIABLE","$value_4",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","randomMachineName",117],"(",")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","drupalGet",118],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/no-set\/'",118],["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_VARIABLE","$value_4",118],")",";",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","assertText",119],"(",["T_VARIABLE","$value_4",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'The session value was correctly passed to session-test\/no-set.'",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'Session'",119],")",";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","drupalGet",120],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",120],")",";",["T_WHITESPACE","\n    ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","assertText",121],"(",["T_VARIABLE","$value_3",121],",",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'Session data is not saved for drupal_save_session(FALSE).'",121],",",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'Session'",121],")",";",["T_WHITESPACE","\n\n    ",121],["T_COMMENT","\/\/ Login, the data should persist.\n",123],["T_WHITESPACE","    ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","drupalLogin",124],"(",["T_VARIABLE","$user",124],")",";",["T_WHITESPACE","\n    ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","sessionReset",125],"(",["T_VARIABLE","$user",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","id",125],"(",")",")",";",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","drupalGet",126],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",126],")",";",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","assertNoText",127],"(",["T_VARIABLE","$value_1",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'Session has persisted for an authenticated user after logging out and then back in.'",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'Session'",127],")",";",["T_WHITESPACE","\n\n    ",127],["T_COMMENT","\/\/ Change session and create another user.\n",129],["T_WHITESPACE","    ",130],["T_VARIABLE","$user2",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","drupalCreateUser",130],"(",["T_ARRAY","array",130],"(",")",")",";",["T_WHITESPACE","\n    ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","sessionReset",131],"(",["T_VARIABLE","$user2",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","id",131],"(",")",")",";",["T_WHITESPACE","\n    ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","drupalLogin",132],"(",["T_VARIABLE","$user2",132],")",";",["T_WHITESPACE","\n  ",132],"}",["T_WHITESPACE","\n\n  ",133],["T_DOC_COMMENT","\/**\n   * Tests storing data in Session() object.\n   *\/",135],["T_WHITESPACE","\n  ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","testSessionPersistenceOnLogin",138],"(",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n    ",138],["T_COMMENT","\/\/ Store information via hook_user_login().\n",139],["T_WHITESPACE","    ",140],["T_VARIABLE","$user",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","drupalCreateUser",140],"(",")",";",["T_WHITESPACE","\n    ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","drupalLogin",141],"(",["T_VARIABLE","$user",141],")",";",["T_WHITESPACE","\n    ",141],["T_COMMENT","\/\/ Test property added to session object form hook_user_login().\n",142],["T_WHITESPACE","    ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","drupalGet",143],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get-from-session-object'",143],")",";",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","assertText",144],"(",["T_CONSTANT_ENCAPSED_STRING","'foobar'",144],",",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'Session data is saved in Session() object.'",144],",",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'Session'",144],")",";",["T_WHITESPACE","\n  ",144],"}",["T_WHITESPACE","\n\n  ",145],["T_DOC_COMMENT","\/**\n   * Test that empty anonymous sessions are destroyed.\n   *\/",147],["T_WHITESPACE","\n  ",149],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","testEmptyAnonymousSession",150],"(",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n    ",150],["T_COMMENT","\/\/ Disable the dynamic_page_cache module; it'd cause session_test's debug\n",151],["T_WHITESPACE","    ",152],["T_COMMENT","\/\/ output (that is added in\n",152],["T_WHITESPACE","    ",153],["T_COMMENT","\/\/ SessionTestSubscriber::onKernelResponseSessionTest()) to not be added.\n",153],["T_WHITESPACE","    ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","container",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","get",154],"(",["T_CONSTANT_ENCAPSED_STRING","'module_installer'",154],")",["T_OBJECT_OPERATOR","->",154],["T_STRING","uninstall",154],"(","[",["T_CONSTANT_ENCAPSED_STRING","'dynamic_page_cache'",154],"]",")",";",["T_WHITESPACE","\n\n    ",154],["T_COMMENT","\/\/ Verify that no session is automatically created for anonymous user when\n",156],["T_WHITESPACE","    ",157],["T_COMMENT","\/\/ page caching is disabled.\n",157],["T_WHITESPACE","    ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","container",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","get",158],"(",["T_CONSTANT_ENCAPSED_STRING","'module_installer'",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","uninstall",158],"(","[",["T_CONSTANT_ENCAPSED_STRING","'page_cache'",158],"]",")",";",["T_WHITESPACE","\n    ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","drupalGet",159],"(",["T_CONSTANT_ENCAPSED_STRING","''",159],")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertSessionCookie",160],"(",["T_STRING","FALSE",160],")",";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertSessionEmpty",161],"(",["T_STRING","TRUE",161],")",";",["T_WHITESPACE","\n\n    ",161],["T_COMMENT","\/\/ The same behavior is expected when caching is enabled.\n",163],["T_WHITESPACE","    ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","container",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","get",164],"(",["T_CONSTANT_ENCAPSED_STRING","'module_installer'",164],")",["T_OBJECT_OPERATOR","->",164],["T_STRING","install",164],"(","[",["T_CONSTANT_ENCAPSED_STRING","'page_cache'",164],"]",")",";",["T_WHITESPACE","\n    ",164],["T_VARIABLE","$config",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","config",165],"(",["T_CONSTANT_ENCAPSED_STRING","'system.performance'",165],")",";",["T_WHITESPACE","\n    ",165],["T_VARIABLE","$config",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","set",166],"(",["T_CONSTANT_ENCAPSED_STRING","'cache.page.max_age'",166],",",["T_WHITESPACE"," ",166],["T_LNUMBER","300",166],")",";",["T_WHITESPACE","\n    ",166],["T_VARIABLE","$config",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","save",167],"(",")",";",["T_WHITESPACE","\n    ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","drupalGet",168],"(",["T_CONSTANT_ENCAPSED_STRING","''",168],")",";",["T_WHITESPACE","\n    ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","assertSessionCookie",169],"(",["T_STRING","FALSE",169],")",";",["T_WHITESPACE","\n    ",169],["T_COMMENT","\/\/ @todo Reinstate when REQUEST and RESPONSE events fire for cached pages.\n",170],["T_WHITESPACE","    ",171],["T_COMMENT","\/\/ $this->assertSessionEmpty(TRUE);\n",171],["T_WHITESPACE","    ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","assertEqual",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","drupalGetHeader",172],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Drupal-Cache'",172],")",",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'MISS'",172],",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'Page was not cached.'",172],")",";",["T_WHITESPACE","\n\n    ",172],["T_COMMENT","\/\/ Start a new session by setting a message.\n",174],["T_WHITESPACE","    ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","drupalGet",175],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set-message'",175],")",";",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","assertSessionCookie",176],"(",["T_STRING","TRUE",176],")",";",["T_WHITESPACE","\n    ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","assertTrue",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","drupalGetHeader",177],"(",["T_CONSTANT_ENCAPSED_STRING","'Set-Cookie'",177],")",",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'New session was started.'",177],")",";",["T_WHITESPACE","\n\n    ",177],["T_COMMENT","\/\/ Display the message, during the same request the session is destroyed\n",179],["T_WHITESPACE","    ",180],["T_COMMENT","\/\/ and the session cookie is unset.\n",180],["T_WHITESPACE","    ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","drupalGet",181],"(",["T_CONSTANT_ENCAPSED_STRING","''",181],")",";",["T_WHITESPACE","\n    ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","assertSessionCookie",182],"(",["T_STRING","FALSE",182],")",";",["T_WHITESPACE","\n    ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","assertSessionEmpty",183],"(",["T_STRING","FALSE",183],")",";",["T_WHITESPACE","\n    ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","assertFalse",184],"(",["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","drupalGetHeader",184],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Drupal-Cache'",184],")",",",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'Caching was bypassed.'",184],")",";",["T_WHITESPACE","\n    ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","assertText",185],"(",["T_STRING","t",185],"(",["T_CONSTANT_ENCAPSED_STRING","'This is a dummy message.'",185],")",",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'Message was displayed.'",185],")",";",["T_WHITESPACE","\n    ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","assertTrue",186],"(",["T_STRING","preg_match",186],"(",["T_CONSTANT_ENCAPSED_STRING","'\/SESS\\w+=deleted\/'",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","drupalGetHeader",186],"(",["T_CONSTANT_ENCAPSED_STRING","'Set-Cookie'",186],")",")",",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'Session cookie was deleted.'",186],")",";",["T_WHITESPACE","\n\n    ",186],["T_COMMENT","\/\/ Verify that session was destroyed.\n",188],["T_WHITESPACE","    ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","drupalGet",189],"(",["T_CONSTANT_ENCAPSED_STRING","''",189],")",";",["T_WHITESPACE","\n    ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","assertSessionCookie",190],"(",["T_STRING","FALSE",190],")",";",["T_WHITESPACE","\n    ",190],["T_COMMENT","\/\/ @todo Reinstate when REQUEST and RESPONSE events fire for cached pages.\n",191],["T_WHITESPACE","    ",192],["T_COMMENT","\/\/ $this->assertSessionEmpty(TRUE);\n",192],["T_WHITESPACE","    ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","assertNoText",193],"(",["T_STRING","t",193],"(",["T_CONSTANT_ENCAPSED_STRING","'This is a dummy message.'",193],")",",",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","'Message was not cached.'",193],")",";",["T_WHITESPACE","\n    ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","assertEqual",194],"(",["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","drupalGetHeader",194],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Drupal-Cache'",194],")",",",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'HIT'",194],",",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'Page was cached.'",194],")",";",["T_WHITESPACE","\n    ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","assertFalse",195],"(",["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","drupalGetHeader",195],"(",["T_CONSTANT_ENCAPSED_STRING","'Set-Cookie'",195],")",",",["T_WHITESPACE"," ",195],["T_CONSTANT_ENCAPSED_STRING","'New session was not started.'",195],")",";",["T_WHITESPACE","\n\n    ",195],["T_COMMENT","\/\/ Verify that no session is created if drupal_save_session(FALSE) is called.\n",197],["T_WHITESPACE","    ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","drupalGet",198],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set-message-but-dont-save'",198],")",";",["T_WHITESPACE","\n    ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","assertSessionCookie",199],"(",["T_STRING","FALSE",199],")",";",["T_WHITESPACE","\n    ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","assertSessionEmpty",200],"(",["T_STRING","TRUE",200],")",";",["T_WHITESPACE","\n\n    ",200],["T_COMMENT","\/\/ Verify that no message is displayed.\n",202],["T_WHITESPACE","    ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","drupalGet",203],"(",["T_CONSTANT_ENCAPSED_STRING","''",203],")",";",["T_WHITESPACE","\n    ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","assertSessionCookie",204],"(",["T_STRING","FALSE",204],")",";",["T_WHITESPACE","\n    ",204],["T_COMMENT","\/\/ @todo Reinstate when REQUEST and RESPONSE events fire for cached pages.\n",205],["T_WHITESPACE","    ",206],["T_COMMENT","\/\/ $this->assertSessionEmpty(TRUE);\n",206],["T_WHITESPACE","    ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","assertNoText",207],"(",["T_STRING","t",207],"(",["T_CONSTANT_ENCAPSED_STRING","'This is a dummy message.'",207],")",",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'The message was not saved.'",207],")",";",["T_WHITESPACE","\n  ",207],"}",["T_WHITESPACE","\n\n  ",208],["T_DOC_COMMENT","\/**\n   * Test that sessions are only saved when necessary.\n   *\/",210],["T_WHITESPACE","\n  ",212],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","testSessionWrite",213],"(",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n    ",213],["T_VARIABLE","$user",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","drupalCreateUser",214],"(",["T_ARRAY","array",214],"(",")",")",";",["T_WHITESPACE","\n    ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","drupalLogin",215],"(",["T_VARIABLE","$user",215],")",";",["T_WHITESPACE","\n\n    ",215],["T_VARIABLE","$sql",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","'SELECT u.access, s.timestamp FROM {users_field_data} u INNER JOIN {sessions} s ON u.uid = s.uid WHERE u.uid = :uid'",217],";",["T_WHITESPACE","\n    ",217],["T_VARIABLE","$times1",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","db_query",218],"(",["T_VARIABLE","$sql",218],",",["T_WHITESPACE"," ",218],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$user",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","id",218],"(",")",")",")",["T_OBJECT_OPERATOR","->",218],["T_STRING","fetchObject",218],"(",")",";",["T_WHITESPACE","\n\n    ",218],["T_COMMENT","\/\/ Before every request we sleep one second to make sure that if the session\n",220],["T_WHITESPACE","    ",221],["T_COMMENT","\/\/ is saved, its timestamp will change.\n",221],["T_WHITESPACE","\n    ",222],["T_COMMENT","\/\/ Modify the session.\n",223],["T_WHITESPACE","    ",224],["T_STRING","sleep",224],"(",["T_LNUMBER","1",224],")",";",["T_WHITESPACE","\n    ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","drupalGet",225],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set\/foo'",225],")",";",["T_WHITESPACE","\n    ",225],["T_VARIABLE","$times2",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","db_query",226],"(",["T_VARIABLE","$sql",226],",",["T_WHITESPACE"," ",226],["T_ARRAY","array",226],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",226],["T_WHITESPACE"," ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$user",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","id",226],"(",")",")",")",["T_OBJECT_OPERATOR","->",226],["T_STRING","fetchObject",226],"(",")",";",["T_WHITESPACE","\n    ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","assertEqual",227],"(",["T_VARIABLE","$times2",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","access",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$times1",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","access",227],",",["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","'Users table was not updated.'",227],")",";",["T_WHITESPACE","\n    ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","assertNotEqual",228],"(",["T_VARIABLE","$times2",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","timestamp",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$times1",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","timestamp",228],",",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'Sessions table was updated.'",228],")",";",["T_WHITESPACE","\n\n    ",228],["T_COMMENT","\/\/ Write the same value again, i.e. do not modify the session.\n",230],["T_WHITESPACE","    ",231],["T_STRING","sleep",231],"(",["T_LNUMBER","1",231],")",";",["T_WHITESPACE","\n    ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","drupalGet",232],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/set\/foo'",232],")",";",["T_WHITESPACE","\n    ",232],["T_VARIABLE","$times3",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_STRING","db_query",233],"(",["T_VARIABLE","$sql",233],",",["T_WHITESPACE"," ",233],["T_ARRAY","array",233],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$user",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","id",233],"(",")",")",")",["T_OBJECT_OPERATOR","->",233],["T_STRING","fetchObject",233],"(",")",";",["T_WHITESPACE","\n    ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","assertEqual",234],"(",["T_VARIABLE","$times3",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","access",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$times1",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","access",234],",",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'Users table was not updated.'",234],")",";",["T_WHITESPACE","\n    ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","assertEqual",235],"(",["T_VARIABLE","$times3",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","timestamp",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$times2",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","timestamp",235],",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'Sessions table was not updated.'",235],")",";",["T_WHITESPACE","\n\n    ",235],["T_COMMENT","\/\/ Do not change the session.\n",237],["T_WHITESPACE","    ",238],["T_STRING","sleep",238],"(",["T_LNUMBER","1",238],")",";",["T_WHITESPACE","\n    ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","drupalGet",239],"(",["T_CONSTANT_ENCAPSED_STRING","''",239],")",";",["T_WHITESPACE","\n    ",239],["T_VARIABLE","$times4",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","db_query",240],"(",["T_VARIABLE","$sql",240],",",["T_WHITESPACE"," ",240],["T_ARRAY","array",240],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",240],["T_WHITESPACE"," ",240],["T_DOUBLE_ARROW","=>",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$user",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","id",240],"(",")",")",")",["T_OBJECT_OPERATOR","->",240],["T_STRING","fetchObject",240],"(",")",";",["T_WHITESPACE","\n    ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","assertEqual",241],"(",["T_VARIABLE","$times4",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","access",241],",",["T_WHITESPACE"," ",241],["T_VARIABLE","$times3",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","access",241],",",["T_WHITESPACE"," ",241],["T_CONSTANT_ENCAPSED_STRING","'Users table was not updated.'",241],")",";",["T_WHITESPACE","\n    ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","assertEqual",242],"(",["T_VARIABLE","$times4",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","timestamp",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$times3",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","timestamp",242],",",["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","'Sessions table was not updated.'",242],")",";",["T_WHITESPACE","\n\n    ",242],["T_COMMENT","\/\/ Force updating of users and sessions table once per second.\n",244],["T_WHITESPACE","    ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","settingsSet",245],"(",["T_CONSTANT_ENCAPSED_STRING","'session_write_interval'",245],",",["T_WHITESPACE"," ",245],["T_LNUMBER","0",245],")",";",["T_WHITESPACE","\n    ",245],["T_COMMENT","\/\/ Write that value also into the test settings.php file.\n",246],["T_WHITESPACE","    ",247],["T_VARIABLE","$settings",247],"[",["T_CONSTANT_ENCAPSED_STRING","'settings'",247],"]","[",["T_CONSTANT_ENCAPSED_STRING","'session_write_interval'",247],"]",["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_OBJECT_CAST","(object)",247],["T_WHITESPACE"," ",247],["T_ARRAY","array",247],"(",["T_WHITESPACE","\n      ",247],["T_CONSTANT_ENCAPSED_STRING","'value'",248],["T_WHITESPACE"," ",248],["T_DOUBLE_ARROW","=>",248],["T_WHITESPACE"," ",248],["T_LNUMBER","0",248],",",["T_WHITESPACE","\n      ",248],["T_CONSTANT_ENCAPSED_STRING","'required'",249],["T_WHITESPACE"," ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_STRING","TRUE",249],",",["T_WHITESPACE","\n    ",249],")",";",["T_WHITESPACE","\n    ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","writeSettings",251],"(",["T_VARIABLE","$settings",251],")",";",["T_WHITESPACE","\n    ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","drupalGet",252],"(",["T_CONSTANT_ENCAPSED_STRING","''",252],")",";",["T_WHITESPACE","\n    ",252],["T_VARIABLE","$times5",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_STRING","db_query",253],"(",["T_VARIABLE","$sql",253],",",["T_WHITESPACE"," ",253],["T_ARRAY","array",253],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$user",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","id",253],"(",")",")",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","fetchObject",253],"(",")",";",["T_WHITESPACE","\n    ",253],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","assertNotEqual",254],"(",["T_VARIABLE","$times5",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","access",254],",",["T_WHITESPACE"," ",254],["T_VARIABLE","$times4",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","access",254],",",["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","'Users table was updated.'",254],")",";",["T_WHITESPACE","\n    ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","assertNotEqual",255],"(",["T_VARIABLE","$times5",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","timestamp",255],",",["T_WHITESPACE"," ",255],["T_VARIABLE","$times4",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","timestamp",255],",",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'Sessions table was updated.'",255],")",";",["T_WHITESPACE","\n  ",255],"}",["T_WHITESPACE","\n\n  ",256],["T_DOC_COMMENT","\/**\n   * Test that empty session IDs are not allowed.\n   *\/",258],["T_WHITESPACE","\n  ",260],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","testEmptySessionID",261],"(",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n    ",261],["T_VARIABLE","$user",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","drupalCreateUser",262],"(",["T_ARRAY","array",262],"(",")",")",";",["T_WHITESPACE","\n    ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","drupalLogin",263],"(",["T_VARIABLE","$user",263],")",";",["T_WHITESPACE","\n    ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","drupalGet",264],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/is-logged-in'",264],")",";",["T_WHITESPACE","\n    ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","assertResponse",265],"(",["T_LNUMBER","200",265],",",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'User is logged in.'",265],")",";",["T_WHITESPACE","\n\n    ",265],["T_COMMENT","\/\/ Reset the sid in {sessions} to a blank string. This may exist in the\n",267],["T_WHITESPACE","    ",268],["T_COMMENT","\/\/ wild in some cases, although we normally prevent it from happening.\n",268],["T_WHITESPACE","    ",269],["T_STRING","db_query",269],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE {sessions} SET sid = '' WHERE uid = :uid\"",269],",",["T_WHITESPACE"," ",269],["T_ARRAY","array",269],"(",["T_CONSTANT_ENCAPSED_STRING","':uid'",269],["T_WHITESPACE"," ",269],["T_DOUBLE_ARROW","=>",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$user",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","id",269],"(",")",")",")",";",["T_WHITESPACE","\n    ",269],["T_COMMENT","\/\/ Send a blank sid in the session cookie, and the session should no longer\n",270],["T_WHITESPACE","    ",271],["T_COMMENT","\/\/ be valid. Closing the curl handler will stop the previous session ID\n",271],["T_WHITESPACE","    ",272],["T_COMMENT","\/\/ from persisting.\n",272],["T_WHITESPACE","    ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","curlClose",273],"(",")",";",["T_WHITESPACE","\n    ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","additionalCurlOptions",274],"[",["T_STRING","CURLOPT_COOKIE",274],"]",["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_STRING","rawurlencode",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getSessionName",274],"(",")",")",["T_WHITESPACE"," ",274],".",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'=;'",274],";",["T_WHITESPACE","\n    ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","drupalGet",275],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/id-from-cookie'",275],")",";",["T_WHITESPACE","\n    ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","assertRaw",276],"(",["T_CONSTANT_ENCAPSED_STRING","\"session_id:\\n\"",276],",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'Session ID is blank as sent from cookie header.'",276],")",";",["T_WHITESPACE","\n    ",276],["T_COMMENT","\/\/ Assert that we have an anonymous session now.\n",277],["T_WHITESPACE","    ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","drupalGet",278],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/is-logged-in'",278],")",";",["T_WHITESPACE","\n    ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","assertResponse",279],"(",["T_LNUMBER","403",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'An empty session ID is not allowed.'",279],")",";",["T_WHITESPACE","\n  ",279],"}",["T_WHITESPACE","\n\n  ",280],["T_DOC_COMMENT","\/**\n   * Reset the cookie file so that it refers to the specified user.\n   *\n   * @param $uid User id to set as the active session.\n   *\/",282],["T_WHITESPACE","\n  ",286],["T_FUNCTION","function",287],["T_WHITESPACE"," ",287],["T_STRING","sessionReset",287],"(",["T_VARIABLE","$uid",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_LNUMBER","0",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n    ",287],["T_COMMENT","\/\/ Close the internal browser.\n",288],["T_WHITESPACE","    ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","curlClose",289],"(",")",";",["T_WHITESPACE","\n    ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","loggedInUser",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","FALSE",290],";",["T_WHITESPACE","\n\n    ",290],["T_COMMENT","\/\/ Change cookie file for user.\n",292],["T_WHITESPACE","    ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","cookieFile",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_NS_SEPARATOR","\\",293],["T_STRING","Drupal",293],["T_DOUBLE_COLON","::",293],["T_STRING","service",293],"(",["T_CONSTANT_ENCAPSED_STRING","'stream_wrapper_manager'",293],")",["T_OBJECT_OPERATOR","->",293],["T_STRING","getViaScheme",293],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary'",293],")",["T_OBJECT_OPERATOR","->",293],["T_STRING","getDirectoryPath",293],"(",")",["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'\/cookie.'",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_VARIABLE","$uid",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'.txt'",293],";",["T_WHITESPACE","\n    ",293],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","additionalCurlOptions",294],"[",["T_STRING","CURLOPT_COOKIEFILE",294],"]",["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","cookieFile",294],";",["T_WHITESPACE","\n    ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","additionalCurlOptions",295],"[",["T_STRING","CURLOPT_COOKIESESSION",295],"]",["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_STRING","TRUE",295],";",["T_WHITESPACE","\n    ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","drupalGet",296],"(",["T_CONSTANT_ENCAPSED_STRING","'session-test\/get'",296],")",";",["T_WHITESPACE","\n    ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","assertResponse",297],"(",["T_LNUMBER","200",297],",",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","'Session test module is correctly enabled.'",297],",",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","'Session'",297],")",";",["T_WHITESPACE","\n  ",297],"}",["T_WHITESPACE","\n\n  ",298],["T_DOC_COMMENT","\/**\n   * Assert whether the SimpleTest browser sent a session cookie.\n   *\/",300],["T_WHITESPACE","\n  ",302],["T_FUNCTION","function",303],["T_WHITESPACE"," ",303],["T_STRING","assertSessionCookie",303],"(",["T_VARIABLE","$sent",303],")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n    ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$sent",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n      ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","assertNotNull",305],"(",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","sessionId",305],",",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'Session cookie was sent.'",305],")",";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n    ",306],["T_ELSE","else",307],["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n      ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","assertNull",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","sessionId",308],",",["T_WHITESPACE"," ",308],["T_CONSTANT_ENCAPSED_STRING","'Session cookie was not sent.'",308],")",";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n  ",309],"}",["T_WHITESPACE","\n\n  ",310],["T_DOC_COMMENT","\/**\n   * Assert whether $_SESSION is empty at the beginning of the request.\n   *\/",312],["T_WHITESPACE","\n  ",314],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","assertSessionEmpty",315],"(",["T_VARIABLE","$empty",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n    ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$empty",316],")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n      ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","assertIdentical",317],"(",["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","drupalGetHeader",317],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Session-Empty'",317],")",",",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'1'",317],",",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'Session was empty.'",317],")",";",["T_WHITESPACE","\n    ",317],"}",["T_WHITESPACE","\n    ",318],["T_ELSE","else",319],["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n      ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","assertIdentical",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","drupalGetHeader",320],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Session-Empty'",320],")",",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'0'",320],",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'Session was not empty.'",320],")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n  ",321],"}",["T_WHITESPACE","\n\n",322],"}",["T_WHITESPACE","\n",324]]