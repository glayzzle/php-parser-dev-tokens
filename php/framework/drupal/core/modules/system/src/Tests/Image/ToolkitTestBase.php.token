[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Image",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Utility",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SafeMarkup",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Base class for image manipulation testing.\n *\/",8],["T_WHITESPACE","\n",10],["T_ABSTRACT","abstract",11],["T_WHITESPACE"," ",11],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","ToolkitTestBase",11],["T_WHITESPACE"," ",11],["T_EXTENDS","extends",11],["T_WHITESPACE"," ",11],["T_STRING","WebTestBase",11],["T_WHITESPACE"," ",11],"{",["T_WHITESPACE","\n\n  ",11],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",13],["T_WHITESPACE","\n  ",17],["T_PUBLIC","public",18],["T_WHITESPACE"," ",18],["T_STATIC","static",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$modules",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],"(",["T_CONSTANT_ENCAPSED_STRING","'image_test'",18],")",";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * The URI for the file.\n   *\n   * @var string\n   *\/",20],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$file",25],";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * The image factory service.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageFactory\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$imageFactory",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * The image object for the test file.\n   *\n   * @var \\Drupal\\Core\\Image\\ImageInterface\n   *\/",34],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$image",39],";",["T_WHITESPACE","\n\n  ",39],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","setUp",41],"(",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n    ",41],["T_STRING","parent",42],["T_DOUBLE_COLON","::",42],["T_STRING","setUp",42],"(",")",";",["T_WHITESPACE","\n\n    ",42],["T_COMMENT","\/\/ Set the image factory service.\n",44],["T_WHITESPACE","    ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","imageFactory",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","container",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","get",45],"(",["T_CONSTANT_ENCAPSED_STRING","'image.factory'",45],")",";",["T_WHITESPACE","\n\n    ",45],["T_COMMENT","\/\/ Pick a file for testing.\n",47],["T_WHITESPACE","    ",48],["T_VARIABLE","$file",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","current",48],"(",["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","drupalGetTestFiles",48],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",48],")",")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","file",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$file",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","uri",49],";",["T_WHITESPACE","\n\n    ",49],["T_COMMENT","\/\/ Setup a dummy image to work with.\n",51],["T_WHITESPACE","    ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","image",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getImage",52],"(",")",";",["T_WHITESPACE","\n\n    ",52],["T_COMMENT","\/\/ Clear out any hook calls.\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","imageTestReset",55],"(",")",";",["T_WHITESPACE","\n  ",55],"}",["T_WHITESPACE","\n\n  ",56],["T_DOC_COMMENT","\/**\n   * Sets up an image with the custom toolkit.\n   *\n   * @return \\Drupal\\Core\\Image\\ImageInterface\n   *   The image object.\n   *\/",58],["T_WHITESPACE","\n  ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","getImage",64],"(",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$image",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","imageFactory",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","get",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","file",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'test'",65],")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertTrue",66],"(",["T_VARIABLE","$image",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","isValid",66],"(",")",",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Image file was parsed.'",66],")",";",["T_WHITESPACE","\n    ",66],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$image",67],";",["T_WHITESPACE","\n  ",67],"}",["T_WHITESPACE","\n\n  ",68],["T_DOC_COMMENT","\/**\n   * Assert that all of the specified image toolkit operations were called\n   * exactly once once, other values result in failure.\n   *\n   * @param $expected\n   *   Array with string containing with the operation name, e.g. 'load',\n   *   'save', 'crop', etc.\n   *\/",70],["T_WHITESPACE","\n  ",77],["T_FUNCTION","function",78],["T_WHITESPACE"," ",78],["T_STRING","assertToolkitOperationsCalled",78],"(",["T_ARRAY","array",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$expected",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ If one of the image operations is expected, apply should be expected as\n",79],["T_WHITESPACE","    ",80],["T_COMMENT","\/\/ well.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$operations",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],"(",["T_WHITESPACE","\n      ",81],["T_CONSTANT_ENCAPSED_STRING","'resize'",82],",",["T_WHITESPACE","\n      ",82],["T_CONSTANT_ENCAPSED_STRING","'rotate'",83],",",["T_WHITESPACE","\n      ",83],["T_CONSTANT_ENCAPSED_STRING","'crop'",84],",",["T_WHITESPACE","\n      ",84],["T_CONSTANT_ENCAPSED_STRING","'desaturate'",85],",",["T_WHITESPACE","\n      ",85],["T_CONSTANT_ENCAPSED_STRING","'create_new'",86],",",["T_WHITESPACE","\n      ",86],["T_CONSTANT_ENCAPSED_STRING","'scale'",87],",",["T_WHITESPACE","\n      ",87],["T_CONSTANT_ENCAPSED_STRING","'scale_and_crop'",88],",",["T_WHITESPACE","\n      ",88],["T_CONSTANT_ENCAPSED_STRING","'my_operation'",89],",",["T_WHITESPACE","\n      ",89],["T_CONSTANT_ENCAPSED_STRING","'convert'",90],",",["T_WHITESPACE","\n    ",90],")",";",["T_WHITESPACE","\n    ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_STRING","count",92],"(",["T_STRING","array_intersect",92],"(",["T_VARIABLE","$expected",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$operations",92],")",")",["T_WHITESPACE"," ",92],">",["T_WHITESPACE"," ",92],["T_LNUMBER","0",92],["T_WHITESPACE"," ",92],["T_BOOLEAN_AND","&&",92],["T_WHITESPACE"," ",92],"!",["T_STRING","in_array",92],"(",["T_CONSTANT_ENCAPSED_STRING","'apply'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$expected",92],")",")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n      ",92],["T_VARIABLE","$expected",93],"[","]",["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'apply'",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_COMMENT","\/\/ Determine which operations were called.\n",96],["T_WHITESPACE","    ",97],["T_VARIABLE","$actual",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","array_keys",97],"(",["T_STRING","array_filter",97],"(",["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","imageTestGetAllCalls",97],"(",")",")",")",";",["T_WHITESPACE","\n\n    ",97],["T_COMMENT","\/\/ Determine if there were any expected that were not called.\n",99],["T_WHITESPACE","    ",100],["T_VARIABLE","$uncalled",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","array_diff",100],"(",["T_VARIABLE","$expected",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$actual",100],")",";",["T_WHITESPACE","\n    ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_STRING","count",101],"(",["T_VARIABLE","$uncalled",101],")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n      ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","assertTrue",102],"(",["T_STRING","FALSE",102],",",["T_WHITESPACE"," ",102],["T_STRING","SafeMarkup",102],["T_DOUBLE_COLON","::",102],["T_STRING","format",102],"(",["T_CONSTANT_ENCAPSED_STRING","'Expected operations %expected to be called but %uncalled was not called.'",102],",",["T_WHITESPACE"," ",102],["T_ARRAY","array",102],"(",["T_CONSTANT_ENCAPSED_STRING","'%expected'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_STRING","implode",102],"(",["T_CONSTANT_ENCAPSED_STRING","', '",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$expected",102],")",",",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","'%uncalled'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_STRING","implode",102],"(",["T_CONSTANT_ENCAPSED_STRING","', '",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$uncalled",102],")",")",")",")",";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n    ",103],["T_ELSE","else",104],["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n      ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","assertTrue",105],"(",["T_STRING","TRUE",105],",",["T_WHITESPACE"," ",105],["T_STRING","SafeMarkup",105],["T_DOUBLE_COLON","::",105],["T_STRING","format",105],"(",["T_CONSTANT_ENCAPSED_STRING","'All the expected operations were called: %expected'",105],",",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",["T_CONSTANT_ENCAPSED_STRING","'%expected'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_STRING","implode",105],"(",["T_CONSTANT_ENCAPSED_STRING","', '",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$expected",105],")",")",")",")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_COMMENT","\/\/ Determine if there were any unexpected calls.\n",108],["T_WHITESPACE","    ",109],["T_COMMENT","\/\/ If all unexpected calls are operations and apply was expected, we do not\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ count it as an error.\n",110],["T_WHITESPACE","    ",111],["T_VARIABLE","$unexpected",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","array_diff",111],"(",["T_VARIABLE","$actual",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$expected",111],")",";",["T_WHITESPACE","\n    ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_STRING","count",112],"(",["T_VARIABLE","$unexpected",112],")",["T_WHITESPACE"," ",112],["T_BOOLEAN_AND","&&",112],["T_WHITESPACE"," ",112],"(","!",["T_STRING","in_array",112],"(",["T_CONSTANT_ENCAPSED_STRING","'apply'",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$expected",112],")",["T_WHITESPACE"," ",112],["T_BOOLEAN_OR","||",112],["T_WHITESPACE"," ",112],["T_STRING","count",112],"(",["T_STRING","array_intersect",112],"(",["T_VARIABLE","$unexpected",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$operations",112],")",")",["T_WHITESPACE"," ",112],["T_IS_NOT_IDENTICAL","!==",112],["T_WHITESPACE"," ",112],["T_STRING","count",112],"(",["T_VARIABLE","$unexpected",112],")",")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n      ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","assertTrue",113],"(",["T_STRING","FALSE",113],",",["T_WHITESPACE"," ",113],["T_STRING","SafeMarkup",113],["T_DOUBLE_COLON","::",113],["T_STRING","format",113],"(",["T_CONSTANT_ENCAPSED_STRING","'Unexpected operations were called: %unexpected.'",113],",",["T_WHITESPACE"," ",113],["T_ARRAY","array",113],"(",["T_CONSTANT_ENCAPSED_STRING","'%unexpected'",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_STRING","implode",113],"(",["T_CONSTANT_ENCAPSED_STRING","', '",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$unexpected",113],")",")",")",")",";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n    ",114],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n      ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","assertTrue",116],"(",["T_STRING","TRUE",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'No unexpected operations were called.'",116],")",";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n  ",117],"}",["T_WHITESPACE","\n\n  ",118],["T_DOC_COMMENT","\/**\n   * Resets\/initializes the history of calls to the test toolkit functions.\n   *\/",120],["T_WHITESPACE","\n  ",122],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","imageTestReset",123],"(",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n    ",123],["T_COMMENT","\/\/ Keep track of calls to these operations\n",124],["T_WHITESPACE","    ",125],["T_VARIABLE","$results",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_ARRAY","array",125],"(",["T_WHITESPACE","\n      ",125],["T_CONSTANT_ENCAPSED_STRING","'parseFile'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",")",",",["T_WHITESPACE","\n      ",126],["T_CONSTANT_ENCAPSED_STRING","'save'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_ARRAY","array",127],"(",")",",",["T_WHITESPACE","\n      ",127],["T_CONSTANT_ENCAPSED_STRING","'settings'",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_ARRAY","array",128],"(",")",",",["T_WHITESPACE","\n      ",128],["T_CONSTANT_ENCAPSED_STRING","'apply'",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",")",",",["T_WHITESPACE","\n      ",129],["T_CONSTANT_ENCAPSED_STRING","'resize'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_ARRAY","array",130],"(",")",",",["T_WHITESPACE","\n      ",130],["T_CONSTANT_ENCAPSED_STRING","'rotate'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_ARRAY","array",131],"(",")",",",["T_WHITESPACE","\n      ",131],["T_CONSTANT_ENCAPSED_STRING","'crop'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",")",",",["T_WHITESPACE","\n      ",132],["T_CONSTANT_ENCAPSED_STRING","'desaturate'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",")",",",["T_WHITESPACE","\n      ",133],["T_CONSTANT_ENCAPSED_STRING","'create_new'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_ARRAY","array",134],"(",")",",",["T_WHITESPACE","\n      ",134],["T_CONSTANT_ENCAPSED_STRING","'scale'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_ARRAY","array",135],"(",")",",",["T_WHITESPACE","\n      ",135],["T_CONSTANT_ENCAPSED_STRING","'scale_and_crop'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",")",",",["T_WHITESPACE","\n      ",136],["T_CONSTANT_ENCAPSED_STRING","'convert'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",")",",",["T_WHITESPACE","\n    ",137],")",";",["T_WHITESPACE","\n    ",138],["T_NS_SEPARATOR","\\",139],["T_STRING","Drupal",139],["T_DOUBLE_COLON","::",139],["T_STRING","state",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","set",139],"(",["T_CONSTANT_ENCAPSED_STRING","'image_test.results'",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$results",139],")",";",["T_WHITESPACE","\n  ",139],"}",["T_WHITESPACE","\n\n  ",140],["T_DOC_COMMENT","\/**\n   * Gets an array of calls to the test toolkit.\n   *\n   * @return array\n   *   An array keyed by operation name ('parseFile', 'save', 'settings',\n   *   'resize', 'rotate', 'crop', 'desaturate') with values being arrays of\n   *   parameters passed to each call.\n   *\/",142],["T_WHITESPACE","\n  ",149],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","imageTestGetAllCalls",150],"(",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n    ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Drupal",151],["T_DOUBLE_COLON","::",151],["T_STRING","state",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","get",151],"(",["T_CONSTANT_ENCAPSED_STRING","'image_test.results'",151],")",["T_WHITESPACE"," ",151],"?",":",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",")",";",["T_WHITESPACE","\n  ",151],"}",["T_WHITESPACE","\n\n",152],"}",["T_WHITESPACE","\n",154]]