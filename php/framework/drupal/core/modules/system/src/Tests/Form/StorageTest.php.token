[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Form",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests a multistep form using form storage and makes sure validation and\n * caching works right.\n *\n * The tested form puts data into the storage during the initial form\n * construction. These tests verify that there are no duplicate form\n * constructions, with and without manual form caching activated. Furthermore\n * when a validation error occurs, it makes sure that changed form element\n * values are not lost due to a wrong form rebuild.\n *\n * @group Form\n *\/",7],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","StorageTest",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_STRING","WebTestBase",19],["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",21],["T_WHITESPACE","\n  ",25],["T_PUBLIC","public",26],["T_WHITESPACE"," ",26],["T_STATIC","static",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$modules",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_ARRAY","array",26],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test'",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'dblog'",26],")",";",["T_WHITESPACE","\n\n  ",26],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_FUNCTION","function",28],["T_WHITESPACE"," ",28],["T_STRING","setUp",28],"(",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n    ",28],["T_STRING","parent",29],["T_DOUBLE_COLON","::",29],["T_STRING","setUp",29],"(",")",";",["T_WHITESPACE","\n\n    ",29],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","drupalLogin",31],["T_WHITESPACE"," ",31],"(",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","drupalCreateUser",31],"(",")",")",";",["T_WHITESPACE","\n  ",31],"}",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * Tests using the form in a usual way.\n   *\/",34],["T_WHITESPACE","\n  ",36],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","testForm",37],"(",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","drupalGet",38],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",38],")",";",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","assertText",39],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 1'",39],")",";",["T_WHITESPACE","\n\n    ",39],["T_VARIABLE","$edit",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'new'",41],",",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'value'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'value_is_set'",41],")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Use form rebuilding triggered by a submit button.\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","drupalPostForm",44],"(",["T_STRING","NULL",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$edit",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",44],")",";",["T_WHITESPACE","\n    ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","assertText",45],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 2'",45],")",";",["T_WHITESPACE","\n    ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","assertText",46],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 3'",46],")",";",["T_WHITESPACE","\n\n    ",46],["T_COMMENT","\/\/ Reset the form to the values of the storage, using a form rebuild\n",48],["T_WHITESPACE","    ",49],["T_COMMENT","\/\/ triggered by button of type button.\n",49],["T_WHITESPACE","    ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","drupalPostForm",50],"(",["T_STRING","NULL",50],",",["T_WHITESPACE"," ",50],["T_ARRAY","array",50],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'changed'",50],")",",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'Reset'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","assertFieldByName",51],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'new'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'Values have been reset.'",51],")",";",["T_WHITESPACE","\n    ",51],["T_COMMENT","\/\/ After rebuilding, the form has been cached.\n",52],["T_WHITESPACE","    ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","assertText",53],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 4'",53],")",";",["T_WHITESPACE","\n\n    ",53],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","drupalPostForm",55],"(",["T_STRING","NULL",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$edit",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'Save'",55],")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","assertText",56],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 4'",56],")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","assertText",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Title: new'",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'The form storage has stored the values.'",57],")",";",["T_WHITESPACE","\n  ",57],"}",["T_WHITESPACE","\n\n  ",58],["T_DOC_COMMENT","\/**\n   * Tests using the form after calling $form_state->setCached().\n   *\/",60],["T_WHITESPACE","\n  ",62],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","testFormCached",63],"(",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","drupalGet",64],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",64],",",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",["T_CONSTANT_ENCAPSED_STRING","'query'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",["T_CONSTANT_ENCAPSED_STRING","'cache'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_LNUMBER","1",64],")",")",")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertText",65],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 1'",65],")",";",["T_WHITESPACE","\n\n    ",65],["T_VARIABLE","$edit",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_ARRAY","array",67],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'new'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'value'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'value_is_set'",67],")",";",["T_WHITESPACE","\n\n    ",67],["T_COMMENT","\/\/ Use form rebuilding triggered by a submit button.\n",69],["T_WHITESPACE","    ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","drupalPostForm",70],"(",["T_STRING","NULL",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$edit",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",70],")",";",["T_WHITESPACE","\n    ",70],["T_COMMENT","\/\/ The first one is for the building of the form.\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertText",72],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 2'",72],")",";",["T_WHITESPACE","\n    ",72],["T_COMMENT","\/\/ The second one is for the rebuilding of the form.\n",73],["T_WHITESPACE","    ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","assertText",74],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 3'",74],")",";",["T_WHITESPACE","\n\n    ",74],["T_COMMENT","\/\/ Reset the form to the values of the storage, using a form rebuild\n",76],["T_WHITESPACE","    ",77],["T_COMMENT","\/\/ triggered by button of type button.\n",77],["T_WHITESPACE","    ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","drupalPostForm",78],"(",["T_STRING","NULL",78],",",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'changed'",78],")",",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Reset'",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","assertFieldByName",79],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'new'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'Values have been reset.'",79],")",";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","assertText",80],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 4'",80],")",";",["T_WHITESPACE","\n\n    ",80],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","drupalPostForm",82],"(",["T_STRING","NULL",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$edit",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'Save'",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertText",83],"(",["T_CONSTANT_ENCAPSED_STRING","'Form constructions: 4'",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","assertText",84],"(",["T_CONSTANT_ENCAPSED_STRING","'Title: new'",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'The form storage has stored the values.'",84],")",";",["T_WHITESPACE","\n  ",84],"}",["T_WHITESPACE","\n\n  ",85],["T_DOC_COMMENT","\/**\n   * Tests validation when form storage is used.\n   *\/",87],["T_WHITESPACE","\n  ",89],["T_FUNCTION","function",90],["T_WHITESPACE"," ",90],["T_STRING","testValidation",90],"(",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","drupalPostForm",91],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",91],",",["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","''",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'value'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'value_is_set'",91],")",",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",91],")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertPattern",92],"(",["T_CONSTANT_ENCAPSED_STRING","'\/value_is_set\/'",92],",",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'The input values have been kept.'",92],")",";",["T_WHITESPACE","\n  ",92],"}",["T_WHITESPACE","\n\n  ",93],["T_DOC_COMMENT","\/**\n   * Tests updating cached form storage during form validation.\n   *\n   * If form caching is enabled and a form stores data in the form storage, then\n   * the form storage also has to be updated in case of a validation error in\n   * the form. This test re-uses the existing form for multi-step tests, but\n   * triggers a special #element_validate handler to update the form storage\n   * during form validation, while another, required element in the form\n   * triggers a form validation error.\n   *\/",95],["T_WHITESPACE","\n  ",104],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","testCachedFormStorageValidation",105],"(",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n    ",105],["T_COMMENT","\/\/ Request the form with 'cache' query parameter to enable form caching.\n",106],["T_WHITESPACE","    ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","drupalGet",107],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'query'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'cache'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_LNUMBER","1",107],")",")",")",";",["T_WHITESPACE","\n\n    ",107],["T_COMMENT","\/\/ Skip step 1 of the multi-step form, since the first step copies over\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ 'title' into form storage, but we want to verify that changes in the form\n",110],["T_WHITESPACE","    ",111],["T_COMMENT","\/\/ storage are updated in the cache during form validation.\n",111],["T_WHITESPACE","    ",112],["T_VARIABLE","$edit",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_ARRAY","array",112],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'foo'",112],")",";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","drupalPostForm",113],"(",["T_STRING","NULL",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$edit",113],",",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",113],")",";",["T_WHITESPACE","\n\n    ",113],["T_COMMENT","\/\/ In step 2, trigger a validation error for the required 'title' field, and\n",115],["T_WHITESPACE","    ",116],["T_COMMENT","\/\/ post the special 'change_title' value for the 'value' field, which\n",116],["T_WHITESPACE","    ",117],["T_COMMENT","\/\/ conditionally invokes the #element_validate handler to update the form\n",117],["T_WHITESPACE","    ",118],["T_COMMENT","\/\/ storage.\n",118],["T_WHITESPACE","    ",119],["T_VARIABLE","$edit",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","''",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'value'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'change_title'",119],")",";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","drupalPostForm",120],"(",["T_STRING","NULL",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$edit",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'Save'",120],")",";",["T_WHITESPACE","\n\n    ",120],["T_COMMENT","\/\/ At this point, the form storage should contain updated values, but we do\n",122],["T_WHITESPACE","    ",123],["T_COMMENT","\/\/ not see them, because the form has not been rebuilt yet due to the\n",123],["T_WHITESPACE","    ",124],["T_COMMENT","\/\/ validation error. Post again and verify that the rebuilt form contains\n",124],["T_WHITESPACE","    ",125],["T_COMMENT","\/\/ the values of the updated form storage.\n",125],["T_WHITESPACE","    ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","drupalPostForm",126],"(",["T_STRING","NULL",126],",",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'foo'",126],",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'value'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'bar'",126],")",",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'Save'",126],")",";",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","assertText",127],"(",["T_CONSTANT_ENCAPSED_STRING","\"The thing has been changed.\"",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'The altered form storage value was updated in cache and taken over.'",127],")",";",["T_WHITESPACE","\n  ",127],"}",["T_WHITESPACE","\n\n  ",128],["T_DOC_COMMENT","\/**\n   * Verifies that form build-id is regenerated when loading an immutable form\n   * from the cache.\n   *\/",130],["T_WHITESPACE","\n  ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","testImmutableForm",134],"(",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n    ",134],["T_COMMENT","\/\/ Request the form with 'cache' query parameter to enable form caching.\n",135],["T_WHITESPACE","    ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","drupalGet",136],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",136],",",["T_WHITESPACE"," ",136],"[",["T_CONSTANT_ENCAPSED_STRING","'query'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],"[",["T_CONSTANT_ENCAPSED_STRING","'cache'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_LNUMBER","1",136],",",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'immutable'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_LNUMBER","1",136],"]","]",")",";",["T_WHITESPACE","\n    ",136],["T_VARIABLE","$buildIdFields",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","xpath",137],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/input[@name=\"form_build_id\"]'",137],")",";",["T_WHITESPACE","\n    ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","assertEqual",138],"(",["T_STRING","count",138],"(",["T_VARIABLE","$buildIdFields",138],")",",",["T_WHITESPACE"," ",138],["T_LNUMBER","1",138],",",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'One form build id field on the page'",138],")",";",["T_WHITESPACE","\n    ",138],["T_VARIABLE","$buildId",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING_CAST","(string)",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$buildIdFields",139],"[",["T_LNUMBER","0",139],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",139],"]",";",["T_WHITESPACE","\n\n    ",139],["T_COMMENT","\/\/ Trigger validation error by submitting an empty title.\n",141],["T_WHITESPACE","    ",142],["T_VARIABLE","$edit",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","''",142],"]",";",["T_WHITESPACE","\n    ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","drupalPostForm",143],"(",["T_STRING","NULL",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$edit",143],",",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",143],")",";",["T_WHITESPACE","\n\n    ",143],["T_COMMENT","\/\/ Verify that the build-id did change.\n",145],["T_WHITESPACE","    ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","assertNoFieldByName",146],"(",["T_CONSTANT_ENCAPSED_STRING","'form_build_id'",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$buildId",146],",",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'Build id changes when form validation fails'",146],")",";",["T_WHITESPACE","\n\n    ",146],["T_COMMENT","\/\/ Retrieve the new build-id.\n",148],["T_WHITESPACE","    ",149],["T_VARIABLE","$buildIdFields",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","xpath",149],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/input[@name=\"form_build_id\"]'",149],")",";",["T_WHITESPACE","\n    ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","assertEqual",150],"(",["T_STRING","count",150],"(",["T_VARIABLE","$buildIdFields",150],")",",",["T_WHITESPACE"," ",150],["T_LNUMBER","1",150],",",["T_WHITESPACE"," ",150],["T_CONSTANT_ENCAPSED_STRING","'One form build id field on the page'",150],")",";",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$buildId",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_STRING_CAST","(string)",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$buildIdFields",151],"[",["T_LNUMBER","0",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",151],"]",";",["T_WHITESPACE","\n\n    ",151],["T_COMMENT","\/\/ Trigger validation error by again submitting an empty title.\n",153],["T_WHITESPACE","    ",154],["T_VARIABLE","$edit",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","''",154],"]",";",["T_WHITESPACE","\n    ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","drupalPostForm",155],"(",["T_STRING","NULL",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$edit",155],",",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'Continue submit'",155],")",";",["T_WHITESPACE","\n\n    ",155],["T_COMMENT","\/\/ Verify that the build-id does not change the second time.\n",157],["T_WHITESPACE","    ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","assertFieldByName",158],"(",["T_CONSTANT_ENCAPSED_STRING","'form_build_id'",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$buildId",158],",",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'Build id remains the same when form validation fails subsequently'",158],")",";",["T_WHITESPACE","\n  ",158],"}",["T_WHITESPACE","\n\n  ",159],["T_DOC_COMMENT","\/**\n   * Verify that existing contrib code cannot overwrite immutable form state.\n   *\/",161],["T_WHITESPACE","\n  ",163],["T_PUBLIC","public",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","testImmutableFormLegacyProtection",164],"(",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n    ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","drupalGet",165],"(",["T_CONSTANT_ENCAPSED_STRING","'form_test\/form-storage'",165],",",["T_WHITESPACE"," ",165],"[",["T_CONSTANT_ENCAPSED_STRING","'query'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],"[",["T_CONSTANT_ENCAPSED_STRING","'cache'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_LNUMBER","1",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'immutable'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_LNUMBER","1",165],"]","]",")",";",["T_WHITESPACE","\n    ",165],["T_VARIABLE","$build_id_fields",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","xpath",166],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/input[@name=\"form_build_id\"]'",166],")",";",["T_WHITESPACE","\n    ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","assertEqual",167],"(",["T_STRING","count",167],"(",["T_VARIABLE","$build_id_fields",167],")",",",["T_WHITESPACE"," ",167],["T_LNUMBER","1",167],",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'One form build id field on the page'",167],")",";",["T_WHITESPACE","\n    ",167],["T_VARIABLE","$build_id",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_STRING_CAST","(string)",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$build_id_fields",168],"[",["T_LNUMBER","0",168],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",168],"]",";",["T_WHITESPACE","\n\n    ",168],["T_COMMENT","\/\/ Try to poison the form cache.\n",170],["T_WHITESPACE","    ",171],["T_VARIABLE","$original",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","drupalGetAjax",171],"(",["T_CONSTANT_ENCAPSED_STRING","'form-test\/form-storage-legacy\/'",171],["T_WHITESPACE"," ",171],".",["T_WHITESPACE"," ",171],["T_VARIABLE","$build_id",171],")",";",["T_WHITESPACE","\n    ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","assertEqual",172],"(",["T_VARIABLE","$original",172],"[",["T_CONSTANT_ENCAPSED_STRING","'form'",172],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#build_id_old'",172],"]",",",["T_WHITESPACE"," ",172],["T_VARIABLE","$build_id",172],",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'Original build_id was recorded'",172],")",";",["T_WHITESPACE","\n    ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","assertNotEqual",173],"(",["T_VARIABLE","$original",173],"[",["T_CONSTANT_ENCAPSED_STRING","'form'",173],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#build_id'",173],"]",",",["T_WHITESPACE"," ",173],["T_VARIABLE","$build_id",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'New build_id was generated'",173],")",";",["T_WHITESPACE","\n\n    ",173],["T_COMMENT","\/\/ Assert that a watchdog message was logged by\n",175],["T_WHITESPACE","    ",176],["T_COMMENT","\/\/ \\Drupal::formBuilder()->setCache().\n",176],["T_WHITESPACE","    ",177],["T_VARIABLE","$status",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_BOOL_CAST","(bool)",177],["T_WHITESPACE"," ",177],["T_STRING","db_query_range",177],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT 1 FROM {watchdog} WHERE message = :message'",177],",",["T_WHITESPACE"," ",177],["T_LNUMBER","0",177],",",["T_WHITESPACE"," ",177],["T_LNUMBER","1",177],",",["T_WHITESPACE"," ",177],"[",["T_CONSTANT_ENCAPSED_STRING","':message'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'Form build-id mismatch detected while attempting to store a form in the cache.'",177],"]",")",";",["T_WHITESPACE","\n    ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","assert",178],"(",["T_VARIABLE","$status",178],",",["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'A watchdog message was logged by \\Drupal::formBuilder()->setCache'",178],")",";",["T_WHITESPACE","\n\n    ",178],["T_COMMENT","\/\/ Ensure that the form state was not poisoned by the preceding call.\n",180],["T_WHITESPACE","    ",181],["T_VARIABLE","$original",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","drupalGetAjax",181],"(",["T_CONSTANT_ENCAPSED_STRING","'form-test\/form-storage-legacy\/'",181],["T_WHITESPACE"," ",181],".",["T_WHITESPACE"," ",181],["T_VARIABLE","$build_id",181],")",";",["T_WHITESPACE","\n    ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","assertEqual",182],"(",["T_VARIABLE","$original",182],"[",["T_CONSTANT_ENCAPSED_STRING","'form'",182],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#build_id_old'",182],"]",",",["T_WHITESPACE"," ",182],["T_VARIABLE","$build_id",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'Original build_id was recorded'",182],")",";",["T_WHITESPACE","\n    ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","assertNotEqual",183],"(",["T_VARIABLE","$original",183],"[",["T_CONSTANT_ENCAPSED_STRING","'form'",183],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#build_id'",183],"]",",",["T_WHITESPACE"," ",183],["T_VARIABLE","$build_id",183],",",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'New build_id was generated'",183],")",";",["T_WHITESPACE","\n    ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","assert",184],"(",["T_EMPTY","empty",184],"(",["T_VARIABLE","$original",184],"[",["T_CONSTANT_ENCAPSED_STRING","'form'",184],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#poisoned'",184],"]",")",",",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'Original form structure was preserved'",184],")",";",["T_WHITESPACE","\n    ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","assert",185],"(",["T_EMPTY","empty",185],"(",["T_VARIABLE","$original",185],"[",["T_CONSTANT_ENCAPSED_STRING","'form_state'",185],"]","[",["T_CONSTANT_ENCAPSED_STRING","'poisoned'",185],"]",")",",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'Original form state was preserved'",185],")",";",["T_WHITESPACE","\n  ",185],"}",["T_WHITESPACE","\n\n",186],"}",["T_WHITESPACE","\n",188]]