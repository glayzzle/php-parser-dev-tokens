[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Update",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Exception",5],["T_NS_SEPARATOR","\\",5],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","entity_test",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EntityTest",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","simpletest",7],["T_NS_SEPARATOR","\\",7],["T_STRING","WebTestBase",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","system",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Tests",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Update",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DbUpdatesTrait",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Tests performing entity updates through the Update API.\n *\n * @group Entity\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","UpdateApiEntityDefinitionUpdateTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","WebTestBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","DbUpdatesTrait",17],";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",19],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_STATIC","static",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$modules",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",22],"]",";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * The entity manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",24],["T_WHITESPACE","\n  ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$entityManager",29],";",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * The entity definition update manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityDefinitionUpdateManagerInterface\n   *\/",31],["T_WHITESPACE","\n  ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$updatesManager",36],";",["T_WHITESPACE","\n\n\n  ",36],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",39],["T_WHITESPACE","\n  ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","setUp",42],"(",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n    ",42],["T_STRING","parent",43],["T_DOUBLE_COLON","::",43],["T_STRING","setUp",43],"(",")",";",["T_WHITESPACE","\n\n    ",43],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","entityManager",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","container",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","get",45],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",45],")",";",["T_WHITESPACE","\n    ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","updatesManager",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","container",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","get",46],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.definition_update_manager'",46],")",";",["T_WHITESPACE","\n\n    ",46],["T_VARIABLE","$admin",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","drupalCreateUser",48],"(","[","]",",",["T_WHITESPACE"," ",48],["T_STRING","FALSE",48],",",["T_WHITESPACE"," ",48],["T_STRING","TRUE",48],")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","drupalLogin",49],"(",["T_VARIABLE","$admin",49],")",";",["T_WHITESPACE","\n  ",49],"}",["T_WHITESPACE","\n\n  ",50],["T_DOC_COMMENT","\/**\n   * Tests that individual updates applied sequentially work as expected.\n   *\/",52],["T_WHITESPACE","\n  ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","testSingleUpdates",55],"(",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n    ",55],["T_COMMENT","\/\/ Create a test entity.\n",56],["T_WHITESPACE","    ",57],["T_VARIABLE","$user_ids",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],"[",["T_STRING","mt_rand",57],"(",")",",",["T_WHITESPACE"," ",57],["T_STRING","mt_rand",57],"(",")","]",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$entity",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","EntityTest",58],["T_DOUBLE_COLON","::",58],["T_STRING","create",58],"(","[",["T_CONSTANT_ENCAPSED_STRING","'name'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","randomString",58],"(",")",",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'user_id'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$user_ids",58],"]",")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$entity",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","save",59],"(",")",";",["T_WHITESPACE","\n\n    ",59],["T_COMMENT","\/\/ Check that only a single value is stored for 'user_id'.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$entity",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","reloadEntity",62],"(",["T_VARIABLE","$entity",62],")",";",["T_WHITESPACE","\n    ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","assertEqual",63],"(",["T_STRING","count",63],"(",["T_VARIABLE","$entity",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","user_id",63],")",",",["T_WHITESPACE"," ",63],["T_LNUMBER","1",63],")",";",["T_WHITESPACE","\n    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","assertEqual",64],"(",["T_VARIABLE","$entity",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","user_id",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","target_id",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$user_ids",64],"[",["T_LNUMBER","0",64],"]",")",";",["T_WHITESPACE","\n\n    ",64],["T_COMMENT","\/\/ Make 'user_id' multiple by applying updates.\n",66],["T_WHITESPACE","    ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","enableUpdates",67],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'entity_definition_updates'",67],",",["T_WHITESPACE"," ",67],["T_LNUMBER","8001",67],")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","applyUpdates",68],"(",")",";",["T_WHITESPACE","\n\n    ",68],["T_COMMENT","\/\/ Ensure the 'entity_test__user_id' table got created.\n",70],["T_WHITESPACE","    ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertTrue",71],"(",["T_NS_SEPARATOR","\\",71],["T_STRING","Drupal",71],["T_DOUBLE_COLON","::",71],["T_STRING","database",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","schema",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","tableExists",71],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test__user_id'",71],")",")",";",["T_WHITESPACE","\n\n    ",71],["T_COMMENT","\/\/ Check that data was correctly migrated.\n",73],["T_WHITESPACE","    ",74],["T_VARIABLE","$entity",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","reloadEntity",74],"(",["T_VARIABLE","$entity",74],")",";",["T_WHITESPACE","\n    ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","assertEqual",75],"(",["T_STRING","count",75],"(",["T_VARIABLE","$entity",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","user_id",75],")",",",["T_WHITESPACE"," ",75],["T_LNUMBER","1",75],")",";",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","assertEqual",76],"(",["T_VARIABLE","$entity",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","user_id",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","target_id",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$user_ids",76],"[",["T_LNUMBER","0",76],"]",")",";",["T_WHITESPACE","\n\n    ",76],["T_COMMENT","\/\/ Store multiple data and check it is correctly stored.\n",78],["T_WHITESPACE","    ",79],["T_VARIABLE","$entity",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","user_id",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$user_ids",79],";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$entity",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","save",80],"(",")",";",["T_WHITESPACE","\n    ",80],["T_VARIABLE","$entity",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","reloadEntity",81],"(",["T_VARIABLE","$entity",81],")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertEqual",82],"(",["T_STRING","count",82],"(",["T_VARIABLE","$entity",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","user_id",82],")",",",["T_WHITESPACE"," ",82],["T_LNUMBER","2",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertEqual",83],"(",["T_VARIABLE","$entity",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","user_id",83],"[",["T_LNUMBER","0",83],"]",["T_OBJECT_OPERATOR","->",83],["T_STRING","target_id",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$user_ids",83],"[",["T_LNUMBER","0",83],"]",")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","assertEqual",84],"(",["T_VARIABLE","$entity",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","user_id",84],"[",["T_LNUMBER","1",84],"]",["T_OBJECT_OPERATOR","->",84],["T_STRING","target_id",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$user_ids",84],"[",["T_LNUMBER","1",84],"]",")",";",["T_WHITESPACE","\n\n    ",84],["T_COMMENT","\/\/ Make 'user_id' single again by applying updates.\n",86],["T_WHITESPACE","    ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","enableUpdates",87],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'entity_definition_updates'",87],",",["T_WHITESPACE"," ",87],["T_LNUMBER","8002",87],")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","applyUpdates",88],"(",")",";",["T_WHITESPACE","\n\n    ",88],["T_COMMENT","\/\/ Check that data was correctly migrated\/dropped.\n",90],["T_WHITESPACE","    ",91],["T_VARIABLE","$entity",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","reloadEntity",91],"(",["T_VARIABLE","$entity",91],")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertEqual",92],"(",["T_STRING","count",92],"(",["T_VARIABLE","$entity",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","user_id",92],")",",",["T_WHITESPACE"," ",92],["T_LNUMBER","1",92],")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertEqual",93],"(",["T_VARIABLE","$entity",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","user_id",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","target_id",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$user_ids",93],"[",["T_LNUMBER","0",93],"]",")",";",["T_WHITESPACE","\n\n    ",93],["T_COMMENT","\/\/ Check that only a single value is stored for 'user_id' again.\n",95],["T_WHITESPACE","    ",96],["T_VARIABLE","$entity",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","user_id",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$user_ids",96],";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$entity",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","save",97],"(",")",";",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$entity",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","reloadEntity",98],"(",["T_VARIABLE","$entity",98],")",";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","assertEqual",99],"(",["T_STRING","count",99],"(",["T_VARIABLE","$entity",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","user_id",99],")",",",["T_WHITESPACE"," ",99],["T_LNUMBER","1",99],")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","assertEqual",100],"(",["T_VARIABLE","$entity",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","user_id",100],"[",["T_LNUMBER","0",100],"]",["T_OBJECT_OPERATOR","->",100],["T_STRING","target_id",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$user_ids",100],"[",["T_LNUMBER","0",100],"]",")",";",["T_WHITESPACE","\n  ",100],"}",["T_WHITESPACE","\n\n  ",101],["T_DOC_COMMENT","\/**\n   * Tests that multiple updates applied in bulk work as expected.\n   *\/",103],["T_WHITESPACE","\n  ",105],["T_PUBLIC","public",106],["T_WHITESPACE"," ",106],["T_FUNCTION","function",106],["T_WHITESPACE"," ",106],["T_STRING","testMultipleUpdates",106],"(",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n    ",106],["T_COMMENT","\/\/ Create a test entity.\n",107],["T_WHITESPACE","    ",108],["T_VARIABLE","$user_ids",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],"[",["T_STRING","mt_rand",108],"(",")",",",["T_WHITESPACE"," ",108],["T_STRING","mt_rand",108],"(",")","]",";",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$entity",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","EntityTest",109],["T_DOUBLE_COLON","::",109],["T_STRING","create",109],"(","[",["T_CONSTANT_ENCAPSED_STRING","'name'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","randomString",109],"(",")",",",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'user_id'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$user_ids",109],"]",")",";",["T_WHITESPACE","\n    ",109],["T_VARIABLE","$entity",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","save",110],"(",")",";",["T_WHITESPACE","\n\n    ",110],["T_COMMENT","\/\/ Check that only a single value is stored for 'user_id'.\n",112],["T_WHITESPACE","    ",113],["T_VARIABLE","$entity",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","reloadEntity",113],"(",["T_VARIABLE","$entity",113],")",";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","assertEqual",114],"(",["T_STRING","count",114],"(",["T_VARIABLE","$entity",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","user_id",114],")",",",["T_WHITESPACE"," ",114],["T_LNUMBER","1",114],")",";",["T_WHITESPACE","\n    ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","assertEqual",115],"(",["T_VARIABLE","$entity",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","user_id",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","target_id",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$user_ids",115],"[",["T_LNUMBER","0",115],"]",")",";",["T_WHITESPACE","\n\n    ",115],["T_COMMENT","\/\/ Make 'user_id' multiple and then single again by applying updates.\n",117],["T_WHITESPACE","    ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","enableUpdates",118],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",118],",",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'entity_definition_updates'",118],",",["T_WHITESPACE"," ",118],["T_LNUMBER","8002",118],")",";",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","applyUpdates",119],"(",")",";",["T_WHITESPACE","\n\n    ",119],["T_COMMENT","\/\/ Check that data was correctly migrated back and forth.\n",121],["T_WHITESPACE","    ",122],["T_VARIABLE","$entity",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","reloadEntity",122],"(",["T_VARIABLE","$entity",122],")",";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","assertEqual",123],"(",["T_STRING","count",123],"(",["T_VARIABLE","$entity",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","user_id",123],")",",",["T_WHITESPACE"," ",123],["T_LNUMBER","1",123],")",";",["T_WHITESPACE","\n    ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","assertEqual",124],"(",["T_VARIABLE","$entity",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","user_id",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","target_id",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$user_ids",124],"[",["T_LNUMBER","0",124],"]",")",";",["T_WHITESPACE","\n\n    ",124],["T_COMMENT","\/\/ Check that only a single value is stored for 'user_id' again.\n",126],["T_WHITESPACE","    ",127],["T_VARIABLE","$entity",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","user_id",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$user_ids",127],";",["T_WHITESPACE","\n    ",127],["T_VARIABLE","$entity",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","save",128],"(",")",";",["T_WHITESPACE","\n    ",128],["T_VARIABLE","$entity",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","reloadEntity",129],"(",["T_VARIABLE","$entity",129],")",";",["T_WHITESPACE","\n    ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","assertEqual",130],"(",["T_STRING","count",130],"(",["T_VARIABLE","$entity",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","user_id",130],")",",",["T_WHITESPACE"," ",130],["T_LNUMBER","1",130],")",";",["T_WHITESPACE","\n    ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","assertEqual",131],"(",["T_VARIABLE","$entity",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","user_id",131],"[",["T_LNUMBER","0",131],"]",["T_OBJECT_OPERATOR","->",131],["T_STRING","target_id",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$user_ids",131],"[",["T_LNUMBER","0",131],"]",")",";",["T_WHITESPACE","\n  ",131],"}",["T_WHITESPACE","\n\n  ",132],["T_DOC_COMMENT","\/**\n   * Tests that entity updates are correctly reported in the status report page.\n   *\/",134],["T_WHITESPACE","\n  ",136],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","testStatusReport",137],"(",")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n    ",137],["T_COMMENT","\/\/ Create a test entity.\n",138],["T_WHITESPACE","    ",139],["T_VARIABLE","$entity",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","EntityTest",139],["T_DOUBLE_COLON","::",139],["T_STRING","create",139],"(","[",["T_CONSTANT_ENCAPSED_STRING","'name'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","randomString",139],"(",")",",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'user_id'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_STRING","mt_rand",139],"(",")","]",")",";",["T_WHITESPACE","\n    ",139],["T_VARIABLE","$entity",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","save",140],"(",")",";",["T_WHITESPACE","\n\n    ",140],["T_COMMENT","\/\/ Check that the status report initially displays no error.\n",142],["T_WHITESPACE","    ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","drupalGet",143],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",143],")",";",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","assertNoRaw",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",144],")",";",["T_WHITESPACE","\n    ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","assertNoRaw",145],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",145],")",";",["T_WHITESPACE","\n\n    ",145],["T_COMMENT","\/\/ Enable an entity update and check that we have a dedicated status report\n",147],["T_WHITESPACE","    ",148],["T_COMMENT","\/\/ item.\n",148],["T_WHITESPACE","    ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","container",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","get",149],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",149],")",["T_OBJECT_OPERATOR","->",149],["T_STRING","set",149],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test.remove_name_field'",149],",",["T_WHITESPACE"," ",149],["T_STRING","TRUE",149],")",";",["T_WHITESPACE","\n    ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","drupalGet",150],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",150],")",";",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","assertNoRaw",151],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",151],")",";",["T_WHITESPACE","\n    ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","assertRaw",152],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",152],")",";",["T_WHITESPACE","\n\n    ",152],["T_COMMENT","\/\/ Enable a db update and check that now the entity update status report\n",154],["T_WHITESPACE","    ",155],["T_COMMENT","\/\/ item is no longer displayed. We assume an update function will fix the\n",155],["T_WHITESPACE","    ",156],["T_COMMENT","\/\/ mismatch.\n",156],["T_WHITESPACE","    ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","enableUpdates",157],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",157],",",["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'status_report'",157],",",["T_WHITESPACE"," ",157],["T_LNUMBER","8001",157],")",";",["T_WHITESPACE","\n    ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","drupalGet",158],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",158],")",";",["T_WHITESPACE","\n    ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","assertRaw",159],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",159],")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertRaw",160],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",160],")",";",["T_WHITESPACE","\n\n    ",160],["T_COMMENT","\/\/ Apply db updates and check that entity updates were not applied.\n",162],["T_WHITESPACE","    ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","applyUpdates",163],"(",")",";",["T_WHITESPACE","\n    ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","drupalGet",164],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",164],")",";",["T_WHITESPACE","\n    ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","assertNoRaw",165],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",165],")",";",["T_WHITESPACE","\n    ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","assertRaw",166],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",166],")",";",["T_WHITESPACE","\n\n    ",166],["T_COMMENT","\/\/ Check that en exception would be triggered when trying to apply them with\n",168],["T_WHITESPACE","    ",169],["T_COMMENT","\/\/ existing data.\n",169],["T_WHITESPACE","    ",170],["T_VARIABLE","$message",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'Entity updates cannot run if entity data exists.'",170],";",["T_WHITESPACE","\n    ",170],["T_TRY","try",171],["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n      ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","updatesManager",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","applyUpdates",172],"(",")",";",["T_WHITESPACE","\n      ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","fail",173],"(",["T_VARIABLE","$message",173],")",";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n    ",174],["T_CATCH","catch",175],["T_WHITESPACE"," ",175],"(",["T_STRING","FieldStorageDefinitionUpdateForbiddenException",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$e",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n      ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","pass",176],"(",["T_VARIABLE","$message",176],")",";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_COMMENT","\/\/ Check the status report is the same after trying to apply updates.\n",179],["T_WHITESPACE","    ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","drupalGet",180],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",180],")",";",["T_WHITESPACE","\n    ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","assertNoRaw",181],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",181],")",";",["T_WHITESPACE","\n    ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","assertRaw",182],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",182],")",";",["T_WHITESPACE","\n\n    ",182],["T_COMMENT","\/\/ Delete entity data, enable a new update, run updates again and check that\n",184],["T_WHITESPACE","    ",185],["T_COMMENT","\/\/ entity updates were not applied even when no data exists.\n",185],["T_WHITESPACE","    ",186],["T_VARIABLE","$entity",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","delete",186],"(",")",";",["T_WHITESPACE","\n    ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","enableUpdates",187],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",187],",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'status_report'",187],",",["T_WHITESPACE"," ",187],["T_LNUMBER","8002",187],")",";",["T_WHITESPACE","\n    ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","applyUpdates",188],"(",")",";",["T_WHITESPACE","\n    ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","drupalGet",189],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",189],")",";",["T_WHITESPACE","\n    ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","assertNoRaw",190],"(",["T_CONSTANT_ENCAPSED_STRING","'Out of date'",190],")",";",["T_WHITESPACE","\n    ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","assertRaw",191],"(",["T_CONSTANT_ENCAPSED_STRING","'Mismatched entity and\/or field definitions'",191],")",";",["T_WHITESPACE","\n  ",191],"}",["T_WHITESPACE","\n\n  ",192],["T_DOC_COMMENT","\/**\n   * Reloads the specified entity.\n   *\n   * @param \\Drupal\\entity_test\\Entity\\EntityTest $entity\n   *   An entity object.\n   *\n   * @return \\Drupal\\entity_test\\Entity\\EntityTest\n   *   The reloaded entity object.\n   *\/",194],["T_WHITESPACE","\n  ",202],["T_PROTECTED","protected",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","reloadEntity",203],"(",["T_STRING","EntityTest",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$entity",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n    ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","entityManager",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","useCaches",204],"(",["T_STRING","FALSE",204],")",";",["T_WHITESPACE","\n    ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","entityManager",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getStorage",205],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_test'",205],")",["T_OBJECT_OPERATOR","->",205],["T_STRING","resetCache",205],"(","[",["T_VARIABLE","$entity",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","id",205],"(",")","]",")",";",["T_WHITESPACE","\n    ",205],["T_RETURN","return",206],["T_WHITESPACE"," ",206],["T_STRING","EntityTest",206],["T_DOUBLE_COLON","::",206],["T_STRING","load",206],"(",["T_VARIABLE","$entity",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","id",206],"(",")",")",";",["T_WHITESPACE","\n  ",206],"}",["T_WHITESPACE","\n\n",207],"}",["T_WHITESPACE","\n",209]]