[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","System",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Render",5],["T_NS_SEPARATOR","\\",5],["T_STRING","FormattableMarkup",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Site",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Settings",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","StringTranslation",7],["T_NS_SEPARATOR","\\",7],["T_STRING","StringTranslationTrait",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","simpletest",8],["T_NS_SEPARATOR","\\",8],["T_STRING","WebTestBase",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Tests Drupal permissions hardening of \/sites subdirectories.\n *\n * @group system\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","SitesDirectoryHardeningTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","WebTestBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n  ",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","StringTranslationTrait",16],";",["T_WHITESPACE","\n\n  ",16],["T_DOC_COMMENT","\/**\n   * Tests the default behavior to restrict directory permissions is enforced.\n   *\n   * Checks both the the current sites directory and settings.php.\n   *\/",18],["T_WHITESPACE","\n  ",22],["T_PUBLIC","public",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","testSitesDirectoryHardening",23],"(",")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n    ",23],["T_VARIABLE","$site_path",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","kernel",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","getSitePath",24],"(",")",";",["T_WHITESPACE","\n    ",24],["T_VARIABLE","$settings_file",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","settingsFile",25],"(",["T_VARIABLE","$site_path",25],")",";",["T_WHITESPACE","\n\n    ",25],["T_COMMENT","\/\/ First, we check based on what the initial install has set.\n",27],["T_WHITESPACE","    ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","assertTrue",28],"(",["T_STRING","drupal_verify_install_file",28],"(",["T_VARIABLE","$site_path",28],",",["T_WHITESPACE"," ",28],["T_STRING","FILE_NOT_WRITABLE",28],",",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'dir'",28],")",",",["T_WHITESPACE"," ",28],["T_NEW","new",28],["T_WHITESPACE"," ",28],["T_STRING","FormattableMarkup",28],"(",["T_CONSTANT_ENCAPSED_STRING","'Verified permissions for @file.'",28],",",["T_WHITESPACE"," ",28],["T_ARRAY","array",28],"(",["T_CONSTANT_ENCAPSED_STRING","'@file'",28],["T_WHITESPACE"," ",28],["T_DOUBLE_ARROW","=>",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$site_path",28],")",")",")",";",["T_WHITESPACE","\n\n    ",28],["T_COMMENT","\/\/ We intentionally don't check for settings.local.php as that file is\n",30],["T_WHITESPACE","    ",31],["T_COMMENT","\/\/ not created by Drupal.\n",31],["T_WHITESPACE","    ",32],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","assertTrue",32],"(",["T_STRING","drupal_verify_install_file",32],"(",["T_VARIABLE","$settings_file",32],",",["T_WHITESPACE"," ",32],["T_STRING","FILE_EXIST",32],["T_WHITESPACE"," ",32],"|",["T_WHITESPACE"," ",32],["T_STRING","FILE_READABLE",32],["T_WHITESPACE"," ",32],"|",["T_WHITESPACE"," ",32],["T_STRING","FILE_NOT_WRITABLE",32],")",",",["T_WHITESPACE"," ",32],["T_NEW","new",32],["T_WHITESPACE"," ",32],["T_STRING","FormattableMarkup",32],"(",["T_CONSTANT_ENCAPSED_STRING","'Verified permissions for @file.'",32],",",["T_WHITESPACE"," ",32],["T_ARRAY","array",32],"(",["T_CONSTANT_ENCAPSED_STRING","'@file'",32],["T_WHITESPACE"," ",32],["T_DOUBLE_ARROW","=>",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$settings_file",32],")",")",")",";",["T_WHITESPACE","\n\n    ",32],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","makeWritable",34],"(",["T_VARIABLE","$site_path",34],")",";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","checkSystemRequirements",35],"(",")",";",["T_WHITESPACE","\n\n    ",35],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertTrue",37],"(",["T_STRING","drupal_verify_install_file",37],"(",["T_VARIABLE","$site_path",37],",",["T_WHITESPACE"," ",37],["T_STRING","FILE_NOT_WRITABLE",37],",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'dir'",37],")",",",["T_WHITESPACE"," ",37],["T_NEW","new",37],["T_WHITESPACE"," ",37],["T_STRING","FormattableMarkup",37],"(",["T_CONSTANT_ENCAPSED_STRING","'Verified permissions for @file after manual permissions change.'",37],",",["T_WHITESPACE"," ",37],["T_ARRAY","array",37],"(",["T_CONSTANT_ENCAPSED_STRING","'@file'",37],["T_WHITESPACE"," ",37],["T_DOUBLE_ARROW","=>",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$site_path",37],")",")",")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertTrue",38],"(",["T_STRING","drupal_verify_install_file",38],"(",["T_VARIABLE","$settings_file",38],",",["T_WHITESPACE"," ",38],["T_STRING","FILE_EXIST",38],["T_WHITESPACE"," ",38],"|",["T_WHITESPACE"," ",38],["T_STRING","FILE_READABLE",38],["T_WHITESPACE"," ",38],"|",["T_WHITESPACE"," ",38],["T_STRING","FILE_NOT_WRITABLE",38],")",",",["T_WHITESPACE"," ",38],["T_NEW","new",38],["T_WHITESPACE"," ",38],["T_STRING","FormattableMarkup",38],"(",["T_CONSTANT_ENCAPSED_STRING","'Verified permissions for @file after manual permissions change.'",38],",",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",["T_CONSTANT_ENCAPSED_STRING","'@file'",38],["T_WHITESPACE"," ",38],["T_DOUBLE_ARROW","=>",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$settings_file",38],")",")",")",";",["T_WHITESPACE","\n  ",38],"}",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * Tests writable files remain writable when directory hardening is disabled.\n   *\/",41],["T_WHITESPACE","\n  ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","testSitesDirectoryHardeningConfig",44],"(",")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n    ",44],["T_VARIABLE","$site_path",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","kernel",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getSitePath",45],"(",")",";",["T_WHITESPACE","\n    ",45],["T_VARIABLE","$settings_file",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","settingsFile",46],"(",["T_VARIABLE","$site_path",46],")",";",["T_WHITESPACE","\n\n    ",46],["T_COMMENT","\/\/ Disable permissions enforcement.\n",48],["T_WHITESPACE","    ",49],["T_VARIABLE","$settings",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","Settings",49],["T_DOUBLE_COLON","::",49],["T_STRING","getAll",49],"(",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$settings",50],"[",["T_CONSTANT_ENCAPSED_STRING","'skip_permissions_hardening'",50],"]",["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","TRUE",50],";",["T_WHITESPACE","\n    ",50],["T_NEW","new",51],["T_WHITESPACE"," ",51],["T_STRING","Settings",51],"(",["T_VARIABLE","$settings",51],")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","assertTrue",52],"(",["T_STRING","Settings",52],["T_DOUBLE_COLON","::",52],["T_STRING","get",52],"(",["T_CONSTANT_ENCAPSED_STRING","'skip_permissions_hardening'",52],")",",",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'Able to set hardening to true'",52],")",";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","makeWritable",53],"(",["T_VARIABLE","$site_path",53],")",";",["T_WHITESPACE","\n\n    ",53],["T_COMMENT","\/\/ Manually trigger the requirements check.\n",55],["T_WHITESPACE","    ",56],["T_VARIABLE","$requirements",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","checkSystemRequirements",56],"(",")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","assertEqual",57],"(",["T_STRING","REQUIREMENT_WARNING",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$requirements",57],"[",["T_CONSTANT_ENCAPSED_STRING","'configuration_files'",57],"]","[",["T_CONSTANT_ENCAPSED_STRING","'severity'",57],"]",",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'Warning severity is properly set.'",57],")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","assertEqual",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","t",58],"(",["T_CONSTANT_ENCAPSED_STRING","'Protection disabled'",58],")",",",["T_WHITESPACE"," ",58],["T_STRING_CAST","(string)",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$requirements",58],"[",["T_CONSTANT_ENCAPSED_STRING","'configuration_files'",58],"]","[",["T_CONSTANT_ENCAPSED_STRING","'description'",58],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#context'",58],"]","[",["T_CONSTANT_ENCAPSED_STRING","'configuration_error_list'",58],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#items'",58],"]","[",["T_LNUMBER","0",58],"]",",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'Description is properly set.'",58],")",";",["T_WHITESPACE","\n\n    ",58],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","assertTrue",60],"(",["T_STRING","is_writable",60],"(",["T_VARIABLE","$site_path",60],")",",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'Site directory remains writable when automatically fixing permissions is disabled.'",60],")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","assertTrue",61],"(",["T_STRING","is_writable",61],"(",["T_VARIABLE","$settings_file",61],")",",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'settings.php remains writable when automatically fixing permissions is disabled.'",61],")",";",["T_WHITESPACE","\n\n    ",61],["T_COMMENT","\/\/ Re-enable permissions enforcement.\n",63],["T_WHITESPACE","    ",64],["T_VARIABLE","$settings",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","Settings",64],["T_DOUBLE_COLON","::",64],["T_STRING","getAll",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_VARIABLE","$settings",65],"[",["T_CONSTANT_ENCAPSED_STRING","'skip_permissions_hardening'",65],"]",["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","FALSE",65],";",["T_WHITESPACE","\n    ",65],["T_NEW","new",66],["T_WHITESPACE"," ",66],["T_STRING","Settings",66],"(",["T_VARIABLE","$settings",66],")",";",["T_WHITESPACE","\n\n    ",66],["T_COMMENT","\/\/ Manually trigger the requirements check.\n",68],["T_WHITESPACE","    ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","checkSystemRequirements",69],"(",")",";",["T_WHITESPACE","\n\n    ",69],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","assertFalse",71],"(",["T_STRING","is_writable",71],"(",["T_VARIABLE","$site_path",71],")",",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'Site directory is protected when automatically fixing permissions is enabled.'",71],")",";",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertFalse",72],"(",["T_STRING","is_writable",72],"(",["T_VARIABLE","$settings_file",72],")",",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'settings.php is protected when automatically fixing permissions is enabled.'",72],")",";",["T_WHITESPACE","\n  ",72],"}",["T_WHITESPACE","\n\n  ",73],["T_DOC_COMMENT","\/**\n   * Checks system runtime requirements.\n   *\n   * @return array\n   *   An array of system requirements.\n   *\/",75],["T_WHITESPACE","\n  ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","checkSystemRequirements",81],"(",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n    ",81],["T_STRING","module_load_install",82],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",82],")",";",["T_WHITESPACE","\n    ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_STRING","system_requirements",83],"(",["T_CONSTANT_ENCAPSED_STRING","'runtime'",83],")",";",["T_WHITESPACE","\n  ",83],"}",["T_WHITESPACE","\n\n  ",84],["T_DOC_COMMENT","\/**\n   * Makes the given path and settings file writable.\n   *\n   * @param string $site_path\n   *   The sites directory path, such as 'sites\/default'.\n   *\/",86],["T_WHITESPACE","\n  ",91],["T_PROTECTED","protected",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","makeWritable",92],"(",["T_VARIABLE","$site_path",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n    ",92],["T_STRING","chmod",93],"(",["T_VARIABLE","$site_path",93],",",["T_WHITESPACE"," ",93],["T_LNUMBER","0755",93],")",";",["T_WHITESPACE","\n    ",93],["T_STRING","chmod",94],"(",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","settingsFile",94],"(",["T_VARIABLE","$site_path",94],")",",",["T_WHITESPACE"," ",94],["T_LNUMBER","0644",94],")",";",["T_WHITESPACE","\n  ",94],"}",["T_WHITESPACE","\n\n  ",95],["T_DOC_COMMENT","\/**\n   * Returns the path to settings.php\n   *\n   * @param string $site_path\n   *   The sites subdirectory path.\n   *\n   * @return string\n   *   The path to settings.php.\n   *\/",97],["T_WHITESPACE","\n  ",105],["T_PROTECTED","protected",106],["T_WHITESPACE"," ",106],["T_FUNCTION","function",106],["T_WHITESPACE"," ",106],["T_STRING","settingsFile",106],"(",["T_VARIABLE","$site_path",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$settings_file",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$site_path",107],["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'\/settings.php'",107],";",["T_WHITESPACE","\n    ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$settings_file",108],";",["T_WHITESPACE","\n  ",108],"}",["T_WHITESPACE","\n\n",109],"}",["T_WHITESPACE","\n",111]]