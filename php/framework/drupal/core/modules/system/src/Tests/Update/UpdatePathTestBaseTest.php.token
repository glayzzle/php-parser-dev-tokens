[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Update",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Html",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Utility",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SafeMarkup",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Tests the update path base class.\n *\n * @group Update\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","UpdatePathTestBaseTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","UpdatePathTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",15],["T_WHITESPACE","\n  ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_STATIC","static",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$modules",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],"[",["T_CONSTANT_ENCAPSED_STRING","'update_test_schema'",18],"]",";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",20],["T_WHITESPACE","\n  ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","setDatabaseDumpFiles",23],"(",")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n    ",23],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","databaseDumpFiles",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],"[",["T_WHITESPACE","\n      ",24],["T_DIR","__DIR__",25],["T_WHITESPACE"," ",25],".",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/tests\/fixtures\/update\/drupal-8.bare.standard.php.gz'",25],",",["T_WHITESPACE","\n      ",25],["T_DIR","__DIR__",26],["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/tests\/fixtures\/update\/drupal-8.update-test-schema-enabled.php'",26],",",["T_WHITESPACE","\n    ",26],"]",";",["T_WHITESPACE","\n  ",27],"}",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * Tests that the database was properly loaded.\n   *\/",30],["T_WHITESPACE","\n  ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","testDatabaseLoaded",33],"(",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n    ",33],["T_FOREACH","foreach",34],["T_WHITESPACE"," ",34],"(","[",["T_CONSTANT_ENCAPSED_STRING","'user'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'node'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'system'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'update_test_schema'",34],"]",["T_WHITESPACE"," ",34],["T_AS","as",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$module",34],")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n      ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","assertEqual",35],"(",["T_STRING","drupal_get_installed_schema_version",35],"(",["T_VARIABLE","$module",35],")",",",["T_WHITESPACE"," ",35],["T_LNUMBER","8000",35],",",["T_WHITESPACE"," ",35],["T_STRING","SafeMarkup",35],["T_DOUBLE_COLON","::",35],["T_STRING","format",35],"(",["T_CONSTANT_ENCAPSED_STRING","'Module @module schema is 8000'",35],",",["T_WHITESPACE"," ",35],"[",["T_CONSTANT_ENCAPSED_STRING","'@module'",35],["T_WHITESPACE"," ",35],["T_DOUBLE_ARROW","=>",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$module",35],"]",")",")",";",["T_WHITESPACE","\n    ",35],"}",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Ensure that all {router} entries can be unserialized. If they cannot be\n",38],["T_WHITESPACE","    ",39],["T_COMMENT","\/\/ unserialized a notice will be thrown by PHP.\n",39],["T_WHITESPACE","\n    ",40],["T_VARIABLE","$result",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Drupal",41],["T_DOUBLE_COLON","::",41],["T_STRING","database",41],"(",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","query",41],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT name, route from {router}\"",41],")",["T_OBJECT_OPERATOR","->",41],["T_STRING","fetchAllKeyed",41],"(",["T_LNUMBER","0",41],",",["T_WHITESPACE"," ",41],["T_LNUMBER","1",41],")",";",["T_WHITESPACE","\n    ",41],["T_COMMENT","\/\/ For the purpose of fetching the notices and displaying more helpful error\n",42],["T_WHITESPACE","    ",43],["T_COMMENT","\/\/ messages, let's override the error handler temporarily.\n",43],["T_WHITESPACE","    ",44],["T_STRING","set_error_handler",44],"(",["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],"(",["T_VARIABLE","$severity",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$message",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$filename",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$lineno",44],")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n      ",44],["T_THROW","throw",45],["T_WHITESPACE"," ",45],["T_NEW","new",45],["T_WHITESPACE"," ",45],["T_NS_SEPARATOR","\\",45],["T_STRING","ErrorException",45],"(",["T_VARIABLE","$message",45],",",["T_WHITESPACE"," ",45],["T_LNUMBER","0",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$severity",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$filename",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$lineno",45],")",";",["T_WHITESPACE","\n    ",45],"}",")",";",["T_WHITESPACE","\n    ",46],["T_FOREACH","foreach",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$result",47],["T_WHITESPACE"," ",47],["T_AS","as",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$route_name",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$route",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n      ",47],["T_TRY","try",48],["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n        ",48],["T_STRING","unserialize",49],"(",["T_VARIABLE","$route",49],")",";",["T_WHITESPACE","\n      ",49],"}",["T_WHITESPACE","\n      ",50],["T_CATCH","catch",51],["T_WHITESPACE"," ",51],"(",["T_NS_SEPARATOR","\\",51],["T_STRING","Exception",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$e",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","fail",52],"(",["T_STRING","sprintf",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Error \"%s\" while unserializing route %s'",52],",",["T_WHITESPACE"," ",52],["T_VARIABLE","$e",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getMessage",52],"(",")",",",["T_WHITESPACE"," ",52],["T_STRING","Html",52],["T_DOUBLE_COLON","::",52],["T_STRING","escape",52],"(",["T_VARIABLE","$route_name",52],")",")",")",";",["T_WHITESPACE","\n      ",52],"}",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n    ",54],["T_STRING","restore_error_handler",55],"(",")",";",["T_WHITESPACE","\n\n    ",55],["T_COMMENT","\/\/ Before accessing the site we need to run updates first or the site might\n",57],["T_WHITESPACE","    ",58],["T_COMMENT","\/\/ be broken.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","runUpdates",59],"(",")",";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","assertEqual",60],"(",["T_NS_SEPARATOR","\\",60],["T_STRING","Drupal",60],["T_DOUBLE_COLON","::",60],["T_STRING","config",60],"(",["T_CONSTANT_ENCAPSED_STRING","'system.site'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","get",60],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",60],")",",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'Site-Install'",60],")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","drupalGet",61],"(",["T_CONSTANT_ENCAPSED_STRING","'<front>'",61],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertText",62],"(",["T_CONSTANT_ENCAPSED_STRING","'Site-Install'",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Ensure that the database tasks have been run during set up. Neither MySQL\n",64],["T_WHITESPACE","    ",65],["T_COMMENT","\/\/ nor SQLite make changes that are testable.\n",65],["T_WHITESPACE","    ",66],["T_VARIABLE","$database",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","container",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","get",66],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",66],")",";",["T_WHITESPACE","\n    ",66],["T_IF","if",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$database",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","driver",67],"(",")",["T_WHITESPACE"," ",67],["T_IS_EQUAL","==",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'pgsql'",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n      ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertEqual",68],"(",["T_CONSTANT_ENCAPSED_STRING","'on'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$database",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","query",68],"(",["T_CONSTANT_ENCAPSED_STRING","\"SHOW standard_conforming_strings\"",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","fetchField",68],"(",")",")",";",["T_WHITESPACE","\n      ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertEqual",69],"(",["T_CONSTANT_ENCAPSED_STRING","'escape'",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$database",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","query",69],"(",["T_CONSTANT_ENCAPSED_STRING","\"SHOW bytea_output\"",69],")",["T_OBJECT_OPERATOR","->",69],["T_STRING","fetchField",69],"(",")",")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n  ",70],"}",["T_WHITESPACE","\n\n  ",71],["T_DOC_COMMENT","\/**\n   * Test that updates are properly run.\n   *\/",73],["T_WHITESPACE","\n  ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","testUpdateHookN",76],"(",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n    ",76],["T_COMMENT","\/\/ Increment the schema version.\n",77],["T_WHITESPACE","    ",78],["T_NS_SEPARATOR","\\",78],["T_STRING","Drupal",78],["T_DOUBLE_COLON","::",78],["T_STRING","state",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","set",78],"(",["T_CONSTANT_ENCAPSED_STRING","'update_test_schema_version'",78],",",["T_WHITESPACE"," ",78],["T_LNUMBER","8001",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","runUpdates",79],"(",")",";",["T_WHITESPACE","\n\n    ",79],["T_VARIABLE","$select",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_NS_SEPARATOR","\\",81],["T_STRING","Drupal",81],["T_DOUBLE_COLON","::",81],["T_STRING","database",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","select",81],"(",["T_CONSTANT_ENCAPSED_STRING","'watchdog'",81],")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$select",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","orderBy",82],"(",["T_CONSTANT_ENCAPSED_STRING","'wid'",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'DESC'",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$select",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","range",83],"(",["T_LNUMBER","0",83],",",["T_WHITESPACE"," ",83],["T_LNUMBER","5",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$select",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","fields",84],"(",["T_CONSTANT_ENCAPSED_STRING","'watchdog'",84],",",["T_WHITESPACE"," ",84],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",84],"]",")",";",["T_WHITESPACE","\n\n    ",84],["T_VARIABLE","$container_cannot_be_saved_messages",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","array_filter",86],"(",["T_STRING","iterator_to_array",86],"(",["T_VARIABLE","$select",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","execute",86],"(",")",")",",",["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],"(",["T_VARIABLE","$row",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n      ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_STRING","strpos",87],"(",["T_VARIABLE","$row",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","message",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'Container cannot be saved to cache.'",87],")",["T_WHITESPACE"," ",87],["T_IS_NOT_IDENTICAL","!==",87],["T_WHITESPACE"," ",87],["T_STRING","FALSE",87],";",["T_WHITESPACE","\n    ",87],"}",")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","assertEqual",89],"(","[","]",",",["T_WHITESPACE"," ",89],["T_VARIABLE","$container_cannot_be_saved_messages",89],")",";",["T_WHITESPACE","\n\n    ",89],["T_COMMENT","\/\/ Ensure schema has changed.\n",91],["T_WHITESPACE","    ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertEqual",92],"(",["T_STRING","drupal_get_installed_schema_version",92],"(",["T_CONSTANT_ENCAPSED_STRING","'update_test_schema'",92],",",["T_WHITESPACE"," ",92],["T_STRING","TRUE",92],")",",",["T_WHITESPACE"," ",92],["T_LNUMBER","8001",92],")",";",["T_WHITESPACE","\n    ",92],["T_COMMENT","\/\/ Ensure the index was added for column a.\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertTrue",94],"(",["T_STRING","db_index_exists",94],"(",["T_CONSTANT_ENCAPSED_STRING","'update_test_schema_table'",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'test'",94],")",",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'Version 8001 of the update_test_schema module is installed.'",94],")",";",["T_WHITESPACE","\n  ",94],"}",["T_WHITESPACE","\n\n",95],"}",["T_WHITESPACE","\n",97]]