[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","System",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests HTTP file fetching and error handling.\n *\n * @group system\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","RetrieveFileTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","WebTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n  ",12],["T_DOC_COMMENT","\/**\n   * Invokes system_retrieve_file() in several scenarios.\n   *\/",13],["T_WHITESPACE","\n  ",15],["T_FUNCTION","function",16],["T_WHITESPACE"," ",16],["T_STRING","testFileRetrieving",16],"(",")",["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n    ",16],["T_COMMENT","\/\/ Test 404 handling by trying to fetch a randomly named file.\n",17],["T_WHITESPACE","    ",18],["T_STRING","drupal_mkdir",18],"(",["T_VARIABLE","$sourcedir",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/'",18],["T_WHITESPACE"," ",18],".",["T_WHITESPACE"," ",18],["T_VARIABLE","$this",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","randomMachineName",18],"(",")",")",";",["T_WHITESPACE","\n    ",18],["T_VARIABLE","$filename",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'\u00d0\u00a4\u00d0\u00b0\u00d0\u00b9\u00d0\u00bb \u00d0\u00b4\u00d0\u00bb\u00d1\u008f \u00d1\u0082\u00d0\u00b5\u00d1\u0081\u00d1\u0082\u00d0\u00b8\u00d1\u0080\u00d0\u00be\u00d0\u00b2\u00d0\u00b0\u00d0\u00bd\u00d0\u00b8\u00d1\u008f '",19],["T_WHITESPACE"," ",19],".",["T_WHITESPACE"," ",19],["T_VARIABLE","$this",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","randomMachineName",19],"(",")",";",["T_WHITESPACE","\n    ",19],["T_VARIABLE","$url",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_STRING","file_create_url",20],"(",["T_VARIABLE","$sourcedir",20],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'\/'",20],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_VARIABLE","$filename",20],")",";",["T_WHITESPACE","\n    ",20],["T_VARIABLE","$retrieved_file",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_STRING","system_retrieve_file",21],"(",["T_VARIABLE","$url",21],")",";",["T_WHITESPACE","\n    ",21],["T_VARIABLE","$this",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","assertFalse",22],"(",["T_VARIABLE","$retrieved_file",22],",",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'Non-existent file not fetched.'",22],")",";",["T_WHITESPACE","\n\n    ",22],["T_COMMENT","\/\/ Actually create that file, download it via HTTP and test the returned path.\n",24],["T_WHITESPACE","    ",25],["T_STRING","file_put_contents",25],"(",["T_VARIABLE","$sourcedir",25],["T_WHITESPACE"," ",25],".",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'\/'",25],["T_WHITESPACE"," ",25],".",["T_WHITESPACE"," ",25],["T_VARIABLE","$filename",25],",",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'testing'",25],")",";",["T_WHITESPACE","\n    ",25],["T_VARIABLE","$retrieved_file",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_STRING","system_retrieve_file",26],"(",["T_VARIABLE","$url",26],")",";",["T_WHITESPACE","\n\n    ",26],["T_COMMENT","\/\/ URLs could not contains characters outside the ASCII set so $filename\n",28],["T_WHITESPACE","    ",29],["T_COMMENT","\/\/ has to be encoded.\n",29],["T_WHITESPACE","    ",30],["T_VARIABLE","$encoded_filename",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_STRING","rawurlencode",30],"(",["T_VARIABLE","$filename",30],")",";",["T_WHITESPACE","\n\n    ",30],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","assertEqual",32],"(",["T_VARIABLE","$retrieved_file",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'public:\/\/'",32],["T_WHITESPACE"," ",32],".",["T_WHITESPACE"," ",32],["T_VARIABLE","$encoded_filename",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'Sane path for downloaded file returned (public:\/\/ scheme).'",32],")",";",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","assertTrue",33],"(",["T_STRING","is_file",33],"(",["T_VARIABLE","$retrieved_file",33],")",",",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'Downloaded file does exist (public:\/\/ scheme).'",33],")",";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","assertEqual",34],"(",["T_STRING","filesize",34],"(",["T_VARIABLE","$retrieved_file",34],")",",",["T_WHITESPACE"," ",34],["T_LNUMBER","7",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'File size of downloaded file is correct (public:\/\/ scheme).'",34],")",";",["T_WHITESPACE","\n    ",34],["T_STRING","file_unmanaged_delete",35],"(",["T_VARIABLE","$retrieved_file",35],")",";",["T_WHITESPACE","\n\n    ",35],["T_COMMENT","\/\/ Test downloading file to a different location.\n",37],["T_WHITESPACE","    ",38],["T_STRING","drupal_mkdir",38],"(",["T_VARIABLE","$targetdir",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'temporary:\/\/'",38],["T_WHITESPACE"," ",38],".",["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","randomMachineName",38],"(",")",")",";",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$retrieved_file",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_STRING","system_retrieve_file",39],"(",["T_VARIABLE","$url",39],",",["T_WHITESPACE"," ",39],["T_VARIABLE","$targetdir",39],")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","assertEqual",40],"(",["T_VARIABLE","$retrieved_file",40],",",["T_WHITESPACE"," ",40],"\"",["T_VARIABLE","$targetdir",40],["T_ENCAPSED_AND_WHITESPACE","\/",40],["T_VARIABLE","$encoded_filename",40],"\"",",",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'Sane path for downloaded file returned (temporary:\/\/ scheme).'",40],")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","assertTrue",41],"(",["T_STRING","is_file",41],"(",["T_VARIABLE","$retrieved_file",41],")",",",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'Downloaded file does exist (temporary:\/\/ scheme).'",41],")",";",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","assertEqual",42],"(",["T_STRING","filesize",42],"(",["T_VARIABLE","$retrieved_file",42],")",",",["T_WHITESPACE"," ",42],["T_LNUMBER","7",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'File size of downloaded file is correct (temporary:\/\/ scheme).'",42],")",";",["T_WHITESPACE","\n    ",42],["T_STRING","file_unmanaged_delete",43],"(",["T_VARIABLE","$retrieved_file",43],")",";",["T_WHITESPACE","\n\n    ",43],["T_STRING","file_unmanaged_delete_recursive",45],"(",["T_VARIABLE","$sourcedir",45],")",";",["T_WHITESPACE","\n    ",45],["T_STRING","file_unmanaged_delete_recursive",46],"(",["T_VARIABLE","$targetdir",46],")",";",["T_WHITESPACE","\n  ",46],"}",["T_WHITESPACE","\n\n",47],"}",["T_WHITESPACE","\n",49]]