[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","System",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Tests cron runs.\n *\n * @group system\n *\/",7],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","CronRunTest",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","WebTestBase",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",14],["T_WHITESPACE","\n  ",18],["T_PUBLIC","public",19],["T_WHITESPACE"," ",19],["T_STATIC","static",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$modules",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],"[",["T_CONSTANT_ENCAPSED_STRING","'common_test'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'common_test_cron_helper'",19],",",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'automated_cron'",19],"]",";",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * Test cron runs.\n   *\/",21],["T_WHITESPACE","\n  ",23],["T_FUNCTION","function",24],["T_WHITESPACE"," ",24],["T_STRING","testCronRun",24],"(",")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n    ",24],["T_COMMENT","\/\/ Run cron anonymously without any cron key.\n",25],["T_WHITESPACE","    ",26],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","drupalGet",26],"(",["T_CONSTANT_ENCAPSED_STRING","'cron'",26],")",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","assertResponse",27],"(",["T_LNUMBER","404",27],")",";",["T_WHITESPACE","\n\n    ",27],["T_COMMENT","\/\/ Run cron anonymously with a random cron key.\n",29],["T_WHITESPACE","    ",30],["T_VARIABLE","$key",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","randomMachineName",30],"(",["T_LNUMBER","16",30],")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","drupalGet",31],"(",["T_CONSTANT_ENCAPSED_STRING","'cron\/'",31],["T_WHITESPACE"," ",31],".",["T_WHITESPACE"," ",31],["T_VARIABLE","$key",31],")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","assertResponse",32],"(",["T_LNUMBER","403",32],")",";",["T_WHITESPACE","\n\n    ",32],["T_COMMENT","\/\/ Run cron anonymously with the valid cron key.\n",34],["T_WHITESPACE","    ",35],["T_VARIABLE","$key",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Drupal",35],["T_DOUBLE_COLON","::",35],["T_STRING","state",35],"(",")",["T_OBJECT_OPERATOR","->",35],["T_STRING","get",35],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_key'",35],")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","drupalGet",36],"(",["T_CONSTANT_ENCAPSED_STRING","'cron\/'",36],["T_WHITESPACE"," ",36],".",["T_WHITESPACE"," ",36],["T_VARIABLE","$key",36],")",";",["T_WHITESPACE","\n    ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertResponse",37],"(",["T_LNUMBER","204",37],")",";",["T_WHITESPACE","\n  ",37],"}",["T_WHITESPACE","\n\n  ",38],["T_DOC_COMMENT","\/**\n   * Ensure that the automated cron run module is working.\n   *\n   * In these tests we do not use REQUEST_TIME to track start time, because we\n   * need the exact time when cron is triggered.\n   *\/",40],["T_WHITESPACE","\n  ",45],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","testAutomatedCron",46],"(",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_COMMENT","\/\/ Test with a logged in user; anonymous users likely don't cause Drupal to\n",47],["T_WHITESPACE","    ",48],["T_COMMENT","\/\/ fully bootstrap, because of the internal page cache or an external\n",48],["T_WHITESPACE","    ",49],["T_COMMENT","\/\/ reverse proxy. Reuse this user for disabling cron later in the test.\n",49],["T_WHITESPACE","    ",50],["T_VARIABLE","$admin_user",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","drupalCreateUser",50],"(",["T_ARRAY","array",50],"(",["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",50],")",")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","drupalLogin",51],"(",["T_VARIABLE","$admin_user",51],")",";",["T_WHITESPACE","\n\n    ",51],["T_COMMENT","\/\/ Ensure cron does not run when a non-zero cron interval is specified and\n",53],["T_WHITESPACE","    ",54],["T_COMMENT","\/\/ was not passed.\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$cron_last",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","time",55],"(",")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$cron_safe_interval",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_LNUMBER","100",56],";",["T_WHITESPACE","\n    ",56],["T_NS_SEPARATOR","\\",57],["T_STRING","Drupal",57],["T_DOUBLE_COLON","::",57],["T_STRING","state",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","set",57],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$cron_last",57],")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","config",58],"(",["T_CONSTANT_ENCAPSED_STRING","'automated_cron.settings'",58],")",["T_WHITESPACE","\n      ",58],["T_OBJECT_OPERATOR","->",59],["T_STRING","set",59],"(",["T_CONSTANT_ENCAPSED_STRING","'interval'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$cron_safe_interval",59],")",["T_WHITESPACE","\n      ",59],["T_OBJECT_OPERATOR","->",60],["T_STRING","save",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","drupalGet",61],"(",["T_CONSTANT_ENCAPSED_STRING","''",61],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertTrue",62],"(",["T_VARIABLE","$cron_last",62],["T_WHITESPACE"," ",62],["T_IS_EQUAL","==",62],["T_WHITESPACE"," ",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Drupal",62],["T_DOUBLE_COLON","::",62],["T_STRING","state",62],"(",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","get",62],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",62],")",",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'Cron does not run when the cron interval is not passed.'",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Test if cron runs when the cron interval was passed.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$cron_last",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","time",65],"(",")",["T_WHITESPACE"," ",65],"-",["T_WHITESPACE"," ",65],["T_LNUMBER","200",65],";",["T_WHITESPACE","\n    ",65],["T_NS_SEPARATOR","\\",66],["T_STRING","Drupal",66],["T_DOUBLE_COLON","::",66],["T_STRING","state",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","set",66],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$cron_last",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","drupalGet",67],"(",["T_CONSTANT_ENCAPSED_STRING","''",67],")",";",["T_WHITESPACE","\n    ",67],["T_STRING","sleep",68],"(",["T_LNUMBER","1",68],")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertTrue",69],"(",["T_VARIABLE","$cron_last",69],["T_WHITESPACE"," ",69],"<",["T_WHITESPACE"," ",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Drupal",69],["T_DOUBLE_COLON","::",69],["T_STRING","state",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",69],")",",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'Cron runs when the cron interval is passed.'",69],")",";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/\/ Disable cron through the interface by setting the interval to zero.\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","drupalPostForm",72],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/system\/cron'",72],",",["T_WHITESPACE"," ",72],"[",["T_CONSTANT_ENCAPSED_STRING","'interval'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_LNUMBER","0",72],"]",",",["T_WHITESPACE"," ",72],["T_STRING","t",72],"(",["T_CONSTANT_ENCAPSED_STRING","'Save configuration'",72],")",")",";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertText",73],"(",["T_STRING","t",73],"(",["T_CONSTANT_ENCAPSED_STRING","'The configuration options have been saved.'",73],")",")",";",["T_WHITESPACE","\n    ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","drupalLogout",74],"(",")",";",["T_WHITESPACE","\n\n    ",74],["T_COMMENT","\/\/ Test if cron does not run when the cron interval is set to zero.\n",76],["T_WHITESPACE","    ",77],["T_VARIABLE","$cron_last",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","time",77],"(",")",["T_WHITESPACE"," ",77],"-",["T_WHITESPACE"," ",77],["T_LNUMBER","200",77],";",["T_WHITESPACE","\n    ",77],["T_NS_SEPARATOR","\\",78],["T_STRING","Drupal",78],["T_DOUBLE_COLON","::",78],["T_STRING","state",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","set",78],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$cron_last",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","drupalGet",79],"(",["T_CONSTANT_ENCAPSED_STRING","''",79],")",";",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","assertTrue",80],"(",["T_VARIABLE","$cron_last",80],["T_WHITESPACE"," ",80],["T_IS_EQUAL","==",80],["T_WHITESPACE"," ",80],["T_NS_SEPARATOR","\\",80],["T_STRING","Drupal",80],["T_DOUBLE_COLON","::",80],["T_STRING","state",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","get",80],"(",["T_CONSTANT_ENCAPSED_STRING","'system.cron_last'",80],")",",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'Cron does not run when the cron threshold is disabled.'",80],")",";",["T_WHITESPACE","\n  ",80],"}",["T_WHITESPACE","\n\n  ",81],["T_DOC_COMMENT","\/**\n   * Make sure exceptions thrown on hook_cron() don't affect other modules.\n   *\/",83],["T_WHITESPACE","\n  ",85],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","testCronExceptions",86],"(",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n    ",86],["T_NS_SEPARATOR","\\",87],["T_STRING","Drupal",87],["T_DOUBLE_COLON","::",87],["T_STRING","state",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","delete",87],"(",["T_CONSTANT_ENCAPSED_STRING","'common_test.cron'",87],")",";",["T_WHITESPACE","\n    ",87],["T_COMMENT","\/\/ The common_test module throws an exception. If it isn't caught, the tests\n",88],["T_WHITESPACE","    ",89],["T_COMMENT","\/\/ won't finish successfully.\n",89],["T_WHITESPACE","    ",90],["T_COMMENT","\/\/ The common_test_cron_helper module sets the 'common_test_cron' variable.\n",90],["T_WHITESPACE","    ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","cronRun",91],"(",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$result",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Drupal",92],["T_DOUBLE_COLON","::",92],["T_STRING","state",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","get",92],"(",["T_CONSTANT_ENCAPSED_STRING","'common_test.cron'",92],")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertEqual",93],"(",["T_VARIABLE","$result",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'success'",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'Cron correctly handles exceptions thrown during hook_cron() invocations.'",93],")",";",["T_WHITESPACE","\n  ",93],"}",["T_WHITESPACE","\n\n  ",94],["T_DOC_COMMENT","\/**\n   * Make sure the cron UI reads from the state storage.\n   *\/",96],["T_WHITESPACE","\n  ",98],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","testCronUI",99],"(",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$admin_user",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","drupalCreateUser",100],"(",["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",100],")",")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","drupalLogin",101],"(",["T_VARIABLE","$admin_user",101],")",";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","drupalGet",102],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/system\/cron'",102],")",";",["T_WHITESPACE","\n    ",102],["T_COMMENT","\/\/ Don't use REQUEST to calculate the exact time, because that will\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ fail randomly. Look for the word 'years', because without a timestamp,\n",104],["T_WHITESPACE","    ",105],["T_COMMENT","\/\/ the time will start at 1 January 1970.\n",105],["T_WHITESPACE","    ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","assertNoText",106],"(",["T_CONSTANT_ENCAPSED_STRING","'years'",106],")",";",["T_WHITESPACE","\n\n    ",106],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","drupalPostForm",108],"(",["T_STRING","NULL",108],",",["T_WHITESPACE"," ",108],"[","]",",",["T_WHITESPACE"," ",108],["T_STRING","t",108],"(",["T_CONSTANT_ENCAPSED_STRING","'Save configuration'",108],")",")",";",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","assertText",109],"(",["T_STRING","t",109],"(",["T_CONSTANT_ENCAPSED_STRING","'The configuration options have been saved.'",109],")",")",";",["T_WHITESPACE","\n    ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","assertUrl",110],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/system\/cron'",110],")",";",["T_WHITESPACE","\n  ",110],"}",["T_WHITESPACE","\n\n  ",111],["T_DOC_COMMENT","\/**\n   * Ensure that the manual cron run is working.\n   *\/",113],["T_WHITESPACE","\n  ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","testManualCron",116],"(",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$admin_user",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","drupalCreateUser",117],"(",["T_ARRAY","array",117],"(",["T_CONSTANT_ENCAPSED_STRING","'administer site configuration'",117],")",")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","drupalLogin",118],"(",["T_VARIABLE","$admin_user",118],")",";",["T_WHITESPACE","\n\n    ",118],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","drupalGet",120],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status\/run-cron'",120],")",";",["T_WHITESPACE","\n    ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","assertResponse",121],"(",["T_LNUMBER","403",121],")",";",["T_WHITESPACE","\n\n    ",121],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","drupalGet",123],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/reports\/status'",123],")",";",["T_WHITESPACE","\n    ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","clickLink",124],"(",["T_STRING","t",124],"(",["T_CONSTANT_ENCAPSED_STRING","'run cron manually'",124],")",")",";",["T_WHITESPACE","\n    ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","assertResponse",125],"(",["T_LNUMBER","200",125],")",";",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","assertText",126],"(",["T_STRING","t",126],"(",["T_CONSTANT_ENCAPSED_STRING","'Cron ran successfully.'",126],")",")",";",["T_WHITESPACE","\n  ",126],"}",["T_WHITESPACE","\n\n",127],"}",["T_WHITESPACE","\n",129]]