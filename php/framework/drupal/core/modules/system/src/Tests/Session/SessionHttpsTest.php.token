[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","simpletest",5],["T_NS_SEPARATOR","\\",5],["T_STRING","WebTestBase",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Symfony",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","HttpFoundation",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Request",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Utility",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Crypt",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Session",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AccountInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Ensure that when running under HTTPS two session cookies are generated.\n *\n * @group Session\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","SessionHttpsTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","WebTestBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * The name of the session cookie when using HTTP.\n   *\n   * @var string\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$insecureSessionName",22],";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * The name of the session cookie when using HTTPS.\n   *\n   * @var string\n   *\/",24],["T_WHITESPACE","\n  ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$secureSessionName",29],";",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",31],["T_WHITESPACE","\n  ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_STATIC","static",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$modules",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_ARRAY","array",36],"(",["T_CONSTANT_ENCAPSED_STRING","'session_test'",36],")",";",["T_WHITESPACE","\n\n  ",36],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","setUp",38],"(",")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n    ",38],["T_STRING","parent",39],["T_DOUBLE_COLON","::",39],["T_STRING","setUp",39],"(",")",";",["T_WHITESPACE","\n\n    ",39],["T_VARIABLE","$request",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","Request",41],["T_DOUBLE_COLON","::",41],["T_STRING","createFromGlobals",41],"(",")",";",["T_WHITESPACE","\n    ",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(",["T_VARIABLE","$request",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","isSecure",42],"(",")",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n      ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","secureSessionName",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getSessionName",43],"(",")",";",["T_WHITESPACE","\n      ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","insecureSessionName",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","substr",44],"(",["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getSessionName",44],"(",")",",",["T_WHITESPACE"," ",44],["T_LNUMBER","1",44],")",";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n    ",45],["T_ELSE","else",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n      ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","secureSessionName",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'S'",47],["T_WHITESPACE"," ",47],".",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getSessionName",47],"(",")",";",["T_WHITESPACE","\n      ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","insecureSessionName",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getSessionName",48],"(",")",";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n  ",49],"}",["T_WHITESPACE","\n\n  ",50],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","testHttpsSession",52],"(",")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$user",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","drupalCreateUser",53],"(",["T_ARRAY","array",53],"(",["T_CONSTANT_ENCAPSED_STRING","'access administration pages'",53],")",")",";",["T_WHITESPACE","\n\n    ",53],["T_COMMENT","\/\/ Test HTTPS session handling by altering the form action to submit the\n",55],["T_WHITESPACE","    ",56],["T_COMMENT","\/\/ login form through https.php, which creates a mock HTTPS request.\n",56],["T_WHITESPACE","    ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","loginHttps",57],"(",["T_VARIABLE","$user",57],")",";",["T_WHITESPACE","\n\n    ",57],["T_COMMENT","\/\/ Test a second concurrent session.\n",59],["T_WHITESPACE","    ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","curlClose",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","curlCookies",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","loginHttps",62],"(",["T_VARIABLE","$user",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Check secure cookie on secure page.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","assertTrue",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","cookies",65],"[",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","secureSessionName",65],"]","[",["T_CONSTANT_ENCAPSED_STRING","'secure'",65],"]",",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'The secure cookie has the secure attribute'",65],")",";",["T_WHITESPACE","\n    ",65],["T_COMMENT","\/\/ Check insecure cookie is not set.\n",66],["T_WHITESPACE","    ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertFalse",67],"(",["T_ISSET","isset",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","cookies",67],"[",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","insecureSessionName",67],"]",")",")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$ssid",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","cookies",68],"[",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","secureSessionName",68],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",68],"]",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertSessionIds",69],"(",["T_VARIABLE","$ssid",69],",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'Session has a non-empty SID and a correct secure SID.'",69],")",";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/\/ Verify that user is logged in on secure URL.\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","drupalGet",72],"(",["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","httpsUrl",72],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config'",72],")",")",";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertText",73],"(",["T_STRING","t",73],"(",["T_CONSTANT_ENCAPSED_STRING","'Configuration'",73],")",")",";",["T_WHITESPACE","\n    ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","assertResponse",74],"(",["T_LNUMBER","200",74],")",";",["T_WHITESPACE","\n\n    ",74],["T_COMMENT","\/\/ Verify that user is not logged in on non-secure URL.\n",76],["T_WHITESPACE","    ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","drupalGet",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","httpUrl",77],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config'",77],")",")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertNoText",78],"(",["T_STRING","t",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Configuration'",78],")",")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","assertResponse",79],"(",["T_LNUMBER","403",79],")",";",["T_WHITESPACE","\n\n    ",79],["T_COMMENT","\/\/ Verify that empty SID cannot be used on the non-secure site.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","curlClose",82],"(",")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","curlCookies",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","insecureSessionName",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'='",83],")",";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","drupalGet",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","httpUrl",84],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config'",84],")",")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","assertResponse",85],"(",["T_LNUMBER","403",85],")",";",["T_WHITESPACE","\n\n    ",85],["T_COMMENT","\/\/ Test HTTP session handling by altering the form action to submit the\n",87],["T_WHITESPACE","    ",88],["T_COMMENT","\/\/ login form through http.php, which creates a mock HTTP request on HTTPS\n",88],["T_WHITESPACE","    ",89],["T_COMMENT","\/\/ test environments.\n",89],["T_WHITESPACE","    ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","curlClose",90],"(",")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","curlCookies",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","loginHttp",92],"(",["T_VARIABLE","$user",92],")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","drupalGet",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","httpUrl",93],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config'",93],")",")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertResponse",94],"(",["T_LNUMBER","200",94],")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$sid",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","cookies",95],"[",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","insecureSessionName",95],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",95],"]",";",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","assertSessionIds",96],"(",["T_VARIABLE","$sid",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","''",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'Session has the correct SID and an empty secure SID.'",96],")",";",["T_WHITESPACE","\n\n    ",96],["T_COMMENT","\/\/ Verify that empty secure SID cannot be used on the secure site.\n",98],["T_WHITESPACE","    ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","curlClose",99],"(",")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","curlCookies",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","secureSessionName",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'='",100],")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","drupalGet",101],"(",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","httpsUrl",101],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config'",101],")",")",";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","assertResponse",102],"(",["T_LNUMBER","403",102],")",";",["T_WHITESPACE","\n\n    ",102],["T_COMMENT","\/\/ Clear browser cookie jar.\n",104],["T_WHITESPACE","    ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","cookies",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",")",";",["T_WHITESPACE","\n  ",105],"}",["T_WHITESPACE","\n\n  ",106],["T_DOC_COMMENT","\/**\n   * Log in a user via HTTP.\n   *\n   * Note that the parents $session_id and $loggedInUser is not updated.\n   *\/",108],["T_WHITESPACE","\n  ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","loginHttp",113],"(",["T_STRING","AccountInterface",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$account",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","drupalGet",114],"(",["T_CONSTANT_ENCAPSED_STRING","'user\/login'",114],")",";",["T_WHITESPACE","\n\n    ",114],["T_COMMENT","\/\/ Alter the form action to submit the login form through http.php, which\n",116],["T_WHITESPACE","    ",117],["T_COMMENT","\/\/ creates a mock HTTP request on HTTPS test environments.\n",117],["T_WHITESPACE","    ",118],["T_VARIABLE","$form",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","xpath",118],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/form[@id=\"user-login-form\"]'",118],")",";",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$form",119],"[",["T_LNUMBER","0",119],"]","[",["T_CONSTANT_ENCAPSED_STRING","'action'",119],"]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","httpUrl",119],"(",["T_CONSTANT_ENCAPSED_STRING","'user\/login'",119],")",";",["T_WHITESPACE","\n    ",119],["T_VARIABLE","$edit",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_ARRAY","array",120],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$account",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getUsername",120],"(",")",",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'pass'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$account",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","pass_raw",120],")",";",["T_WHITESPACE","\n\n    ",120],["T_COMMENT","\/\/ When posting directly to the HTTP or HTTPS mock front controller, the\n",122],["T_WHITESPACE","    ",123],["T_COMMENT","\/\/ location header on the returned response is an absolute URL. That URL\n",123],["T_WHITESPACE","    ",124],["T_COMMENT","\/\/ needs to be converted into a request to the respective mock front\n",124],["T_WHITESPACE","    ",125],["T_COMMENT","\/\/ controller in order to retrieve the target page. Because the URL in the\n",125],["T_WHITESPACE","    ",126],["T_COMMENT","\/\/ location header needs to be modified, it is necessary to disable the\n",126],["T_WHITESPACE","    ",127],["T_COMMENT","\/\/ automatic redirects normally performed by parent::curlExec().\n",127],["T_WHITESPACE","    ",128],["T_VARIABLE","$maximum_redirects",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","maximumRedirects",128],";",["T_WHITESPACE","\n    ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","maximumRedirects",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_LNUMBER","0",129],";",["T_WHITESPACE","\n    ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","drupalPostForm",130],"(",["T_STRING","NULL",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$edit",130],",",["T_WHITESPACE"," ",130],["T_STRING","t",130],"(",["T_CONSTANT_ENCAPSED_STRING","'Log in'",130],")",")",";",["T_WHITESPACE","\n    ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","maximumRedirects",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$maximum_redirects",131],";",["T_WHITESPACE","\n\n    ",131],["T_COMMENT","\/\/ Follow the location header.\n",133],["T_WHITESPACE","    ",134],["T_VARIABLE","$path",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getPathFromLocationHeader",134],"(",["T_STRING","FALSE",134],")",";",["T_WHITESPACE","\n    ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","drupalGet",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","httpUrl",135],"(",["T_VARIABLE","$path",135],")",")",";",["T_WHITESPACE","\n    ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","assertResponse",136],"(",["T_LNUMBER","200",136],")",";",["T_WHITESPACE","\n  ",136],"}",["T_WHITESPACE","\n\n  ",137],["T_DOC_COMMENT","\/**\n   * Log in a user via HTTPS.\n   *\n   * Note that the parents $session_id and $loggedInUser is not updated.\n   *\/",139],["T_WHITESPACE","\n  ",143],["T_PROTECTED","protected",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","loginHttps",144],"(",["T_STRING","AccountInterface",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$account",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n    ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","drupalGet",145],"(",["T_CONSTANT_ENCAPSED_STRING","'user\/login'",145],")",";",["T_WHITESPACE","\n\n    ",145],["T_COMMENT","\/\/ Alter the form action to submit the login form through https.php, which\n",147],["T_WHITESPACE","    ",148],["T_COMMENT","\/\/ creates a mock HTTPS request on HTTP test environments.\n",148],["T_WHITESPACE","    ",149],["T_VARIABLE","$form",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","xpath",149],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/form[@id=\"user-login-form\"]'",149],")",";",["T_WHITESPACE","\n    ",149],["T_VARIABLE","$form",150],"[",["T_LNUMBER","0",150],"]","[",["T_CONSTANT_ENCAPSED_STRING","'action'",150],"]",["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","httpsUrl",150],"(",["T_CONSTANT_ENCAPSED_STRING","'user\/login'",150],")",";",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$edit",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$account",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getUsername",151],"(",")",",",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'pass'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$account",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","pass_raw",151],")",";",["T_WHITESPACE","\n\n    ",151],["T_COMMENT","\/\/ When posting directly to the HTTP or HTTPS mock front controller, the\n",153],["T_WHITESPACE","    ",154],["T_COMMENT","\/\/ location header on the returned response is an absolute URL. That URL\n",154],["T_WHITESPACE","    ",155],["T_COMMENT","\/\/ needs to be converted into a request to the respective mock front\n",155],["T_WHITESPACE","    ",156],["T_COMMENT","\/\/ controller in order to retrieve the target page. Because the URL in the\n",156],["T_WHITESPACE","    ",157],["T_COMMENT","\/\/ location header needs to be modified, it is necessary to disable the\n",157],["T_WHITESPACE","    ",158],["T_COMMENT","\/\/ automatic redirects normally performed by parent::curlExec().\n",158],["T_WHITESPACE","    ",159],["T_VARIABLE","$maximum_redirects",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","maximumRedirects",159],";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","maximumRedirects",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_LNUMBER","0",160],";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","drupalPostForm",161],"(",["T_STRING","NULL",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$edit",161],",",["T_WHITESPACE"," ",161],["T_STRING","t",161],"(",["T_CONSTANT_ENCAPSED_STRING","'Log in'",161],")",")",";",["T_WHITESPACE","\n    ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","maximumRedirects",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$maximum_redirects",162],";",["T_WHITESPACE","\n\n    ",162],["T_COMMENT","\/\/ When logging in via the HTTPS mock, the child site will issue a session\n",164],["T_WHITESPACE","    ",165],["T_COMMENT","\/\/ cookie with the secure attribute set. While this cookie will be stored in\n",165],["T_WHITESPACE","    ",166],["T_COMMENT","\/\/ the curl handle, it will not be used on subsequent requests via the HTTPS\n",166],["T_WHITESPACE","    ",167],["T_COMMENT","\/\/ mock, unless when operating in a true HTTPS environment. Therefore it is\n",167],["T_WHITESPACE","    ",168],["T_COMMENT","\/\/ necessary to manually collect the session cookie and add it to the\n",168],["T_WHITESPACE","    ",169],["T_COMMENT","\/\/ curlCookies property such that it will be used on subsequent requests via\n",169],["T_WHITESPACE","    ",170],["T_COMMENT","\/\/ the HTTPS mock.\n",170],["T_WHITESPACE","    ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","curlCookies",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_ARRAY","array",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","secureSessionName",171],["T_WHITESPACE"," ",171],".",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'='",171],["T_WHITESPACE"," ",171],".",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","cookies",171],"[",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","secureSessionName",171],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",171],"]",")",";",["T_WHITESPACE","\n\n    ",171],["T_COMMENT","\/\/ Follow the location header.\n",173],["T_WHITESPACE","    ",174],["T_VARIABLE","$path",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getPathFromLocationHeader",174],"(",["T_STRING","TRUE",174],")",";",["T_WHITESPACE","\n    ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","drupalGet",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","httpsUrl",175],"(",["T_VARIABLE","$path",175],")",")",";",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","assertResponse",176],"(",["T_LNUMBER","200",176],")",";",["T_WHITESPACE","\n  ",176],"}",["T_WHITESPACE","\n\n  ",177],["T_DOC_COMMENT","\/**\n   * Extract internal path from the location header on the response.\n   *\/",179],["T_WHITESPACE","\n  ",181],["T_PROTECTED","protected",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","getPathFromLocationHeader",182],"(",["T_VARIABLE","$https",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","FALSE",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$response_code",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_LNUMBER","303",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n    ",182],["T_COMMENT","\/\/ Generate the base_url.\n",183],["T_WHITESPACE","    ",184],["T_VARIABLE","$base_url",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","container",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","get",184],"(",["T_CONSTANT_ENCAPSED_STRING","'url_generator'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","generateFromRoute",184],"(",["T_CONSTANT_ENCAPSED_STRING","'<front>'",184],",",["T_WHITESPACE"," ",184],"[","]",",",["T_WHITESPACE"," ",184],"[",["T_CONSTANT_ENCAPSED_STRING","'absolute'",184],["T_WHITESPACE"," ",184],["T_DOUBLE_ARROW","=>",184],["T_WHITESPACE"," ",184],["T_STRING","TRUE",184],"]",")",";",["T_WHITESPACE","\n    ",184],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$https",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n      ",185],["T_VARIABLE","$base_url",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","str_replace",186],"(",["T_CONSTANT_ENCAPSED_STRING","'http:\/\/'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/'",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$base_url",186],")",";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n    ",187],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n      ",188],["T_VARIABLE","$base_url",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","str_replace",189],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/'",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'http:\/\/'",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$base_url",189],")",";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_COMMENT","\/\/ The mock front controllers (http.php and https.php) add the script name\n",192],["T_WHITESPACE","    ",193],["T_COMMENT","\/\/ to $_SERVER['REQEUST_URI'] and friends. Therefore it is necessary to\n",193],["T_WHITESPACE","    ",194],["T_COMMENT","\/\/ strip that also.\n",194],["T_WHITESPACE","    ",195],["T_VARIABLE","$base_url",195],["T_WHITESPACE"," ",195],["T_CONCAT_EQUAL",".=",195],["T_WHITESPACE"," ",195],["T_CONSTANT_ENCAPSED_STRING","'index.php\/'",195],";",["T_WHITESPACE","\n\n    ",195],["T_COMMENT","\/\/ Extract relative path from location header.\n",197],["T_WHITESPACE","    ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","assertResponse",198],"(",["T_VARIABLE","$response_code",198],")",";",["T_WHITESPACE","\n    ",198],["T_VARIABLE","$location",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","drupalGetHeader",199],"(",["T_CONSTANT_ENCAPSED_STRING","'location'",199],")",";",["T_WHITESPACE","\n\n    ",199],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","assertIdentical",201],"(",["T_STRING","strpos",201],"(",["T_VARIABLE","$location",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$base_url",201],")",",",["T_WHITESPACE"," ",201],["T_LNUMBER","0",201],",",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","'Location header contains expected base URL'",201],")",";",["T_WHITESPACE","\n    ",201],["T_RETURN","return",202],["T_WHITESPACE"," ",202],["T_STRING","substr",202],"(",["T_VARIABLE","$location",202],",",["T_WHITESPACE"," ",202],["T_STRING","strlen",202],"(",["T_VARIABLE","$base_url",202],")",")",";",["T_WHITESPACE","\n  ",202],"}",["T_WHITESPACE","\n\n  ",203],["T_DOC_COMMENT","\/**\n   * Test that there exists a session with two specific session IDs.\n   *\n   * @param $sid\n   *   The insecure session ID to search for.\n   * @param $assertion_text\n   *   The text to display when we perform the assertion.\n   *\n   * @return\n   *   The result of assertTrue() that there's a session in the system that\n   *   has the given insecure and secure session IDs.\n   *\/",205],["T_WHITESPACE","\n  ",216],["T_PROTECTED","protected",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","assertSessionIds",217],"(",["T_VARIABLE","$sid",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$assertion_text",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n    ",217],["T_VARIABLE","$args",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_ARRAY","array",218],"(",["T_WHITESPACE","\n      ",218],["T_CONSTANT_ENCAPSED_STRING","':sid'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_STRING","Crypt",219],["T_DOUBLE_COLON","::",219],["T_STRING","hashBase64",219],"(",["T_VARIABLE","$sid",219],")",",",["T_WHITESPACE","\n    ",219],")",";",["T_WHITESPACE","\n    ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","assertTrue",221],"(",["T_STRING","db_query",221],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT timestamp FROM {sessions} WHERE sid = :sid'",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$args",221],")",["T_OBJECT_OPERATOR","->",221],["T_STRING","fetchField",221],"(",")",",",["T_WHITESPACE"," ",221],["T_VARIABLE","$assertion_text",221],")",";",["T_WHITESPACE","\n  ",221],"}",["T_WHITESPACE","\n\n  ",222],["T_DOC_COMMENT","\/**\n   * Builds a URL for submitting a mock HTTPS request to HTTP test environments.\n   *\n   * @param $url\n   *   A Drupal path such as 'user\/login'.\n   *\n   * @return\n   *   URL prepared for the https.php mock front controller.\n   *\/",224],["T_WHITESPACE","\n  ",232],["T_PROTECTED","protected",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","httpsUrl",233],"(",["T_VARIABLE","$url",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n    ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'core\/modules\/system\/tests\/https.php\/'",234],["T_WHITESPACE"," ",234],".",["T_WHITESPACE"," ",234],["T_VARIABLE","$url",234],";",["T_WHITESPACE","\n  ",234],"}",["T_WHITESPACE","\n\n  ",235],["T_DOC_COMMENT","\/**\n   * Builds a URL for submitting a mock HTTP request to HTTPS test environments.\n   *\n   * @param $url\n   *   A Drupal path such as 'user\/login'.\n   *\n   * @return\n   *   URL prepared for the http.php mock front controller.\n   *\/",237],["T_WHITESPACE","\n  ",245],["T_PROTECTED","protected",246],["T_WHITESPACE"," ",246],["T_FUNCTION","function",246],["T_WHITESPACE"," ",246],["T_STRING","httpUrl",246],"(",["T_VARIABLE","$url",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n    ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'core\/modules\/system\/tests\/http.php\/'",247],["T_WHITESPACE"," ",247],".",["T_WHITESPACE"," ",247],["T_VARIABLE","$url",247],";",["T_WHITESPACE","\n  ",247],"}",["T_WHITESPACE","\n\n",248],"}",["T_WHITESPACE","\n",250]]