[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Kernel",3],["T_NS_SEPARATOR","\\",3],["T_STRING","System",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelTests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelTestBase",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Tests the Cron Queue runner.\n *\n * @group system\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","CronQueueTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","KernelTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * The modules to enable.\n   *\n   * @var array\n   *\/",15],["T_WHITESPACE","\n  ",19],["T_PUBLIC","public",20],["T_WHITESPACE"," ",20],["T_STATIC","static",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$modules",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],"[",["T_CONSTANT_ENCAPSED_STRING","'system'",20],",",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test'",20],"]",";",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$connection",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * The cron service.\n   *\n   * @var \\Drupal\\Core\\Cron\n   *\/",29],["T_WHITESPACE","\n  ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$cron",34],";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",36],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","setUp",39],"(",")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n    ",39],["T_STRING","parent",40],["T_DOUBLE_COLON","::",40],["T_STRING","setUp",40],"(",")",";",["T_WHITESPACE","\n\n    ",40],["T_COMMENT","\/\/ These additional tables are necessary because $this->cron->run() calls\n",42],["T_WHITESPACE","    ",43],["T_COMMENT","\/\/ system_cron().\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","installSchema",44],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",44],",",["T_WHITESPACE"," ",44],"[",["T_CONSTANT_ENCAPSED_STRING","'key_value_expire'",44],"]",")",";",["T_WHITESPACE","\n\n    ",44],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","connection",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","Database",46],["T_DOUBLE_COLON","::",46],["T_STRING","getConnection",46],"(",")",";",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","cron",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Drupal",47],["T_DOUBLE_COLON","::",47],["T_STRING","service",47],"(",["T_CONSTANT_ENCAPSED_STRING","'cron'",47],")",";",["T_WHITESPACE","\n  ",47],"}",["T_WHITESPACE","\n\n  ",48],["T_DOC_COMMENT","\/**\n   * Tests that exceptions thrown by workers are handled properly.\n   *\/",50],["T_WHITESPACE","\n  ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","testExceptions",53],"(",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n    ",53],["T_COMMENT","\/\/ Get the queue to test the normal Exception.\n",54],["T_WHITESPACE","    ",55],["T_VARIABLE","$queue",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","container",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","get",55],"(",["T_CONSTANT_ENCAPSED_STRING","'queue'",55],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","get",55],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_exception'",55],")",";",["T_WHITESPACE","\n\n    ",55],["T_COMMENT","\/\/ Enqueue an item for processing.\n",57],["T_WHITESPACE","    ",58],["T_VARIABLE","$queue",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","createItem",58],"(",["T_ARRAY","array",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","randomMachineName",58],"(",")",["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","randomMachineName",58],"(",")",")",")",";",["T_WHITESPACE","\n\n    ",58],["T_COMMENT","\/\/ Run cron; the worker for this queue should throw an exception and handle\n",60],["T_WHITESPACE","    ",61],["T_COMMENT","\/\/ it.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","cron",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","run",62],"(",")",";",["T_WHITESPACE","\n    ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","assertEqual",63],"(",["T_NS_SEPARATOR","\\",63],["T_STRING","Drupal",63],["T_DOUBLE_COLON","::",63],["T_STRING","state",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","get",63],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_exception'",63],")",",",["T_WHITESPACE"," ",63],["T_LNUMBER","1",63],")",";",["T_WHITESPACE","\n\n    ",63],["T_COMMENT","\/\/ The item should be left in the queue.\n",65],["T_WHITESPACE","    ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertEqual",66],"(",["T_VARIABLE","$queue",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","numberOfItems",66],"(",")",",",["T_WHITESPACE"," ",66],["T_LNUMBER","1",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Failing item still in the queue after throwing an exception.'",66],")",";",["T_WHITESPACE","\n\n    ",66],["T_COMMENT","\/\/ Expire the queue item manually. system_cron() relies in REQUEST_TIME to\n",68],["T_WHITESPACE","    ",69],["T_COMMENT","\/\/ find queue items whose expire field needs to be reset to 0. This is a\n",69],["T_WHITESPACE","    ",70],["T_COMMENT","\/\/ Kernel test, so REQUEST_TIME won't change when cron runs.\n",70],["T_WHITESPACE","    ",71],["T_COMMENT","\/\/ @see system_cron()\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ @see \\Drupal\\Core\\Cron::processQueues()\n",72],["T_WHITESPACE","    ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","connection",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","update",73],"(",["T_CONSTANT_ENCAPSED_STRING","'queue'",73],")",["T_WHITESPACE","\n      ",73],["T_OBJECT_OPERATOR","->",74],["T_STRING","condition",74],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",74],",",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_exception'",74],")",["T_WHITESPACE","\n      ",74],["T_OBJECT_OPERATOR","->",75],["T_STRING","fields",75],"(","[",["T_CONSTANT_ENCAPSED_STRING","'expire'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_STRING","REQUEST_TIME",75],["T_WHITESPACE"," ",75],"-",["T_WHITESPACE"," ",75],["T_LNUMBER","1",75],"]",")",["T_WHITESPACE","\n      ",75],["T_OBJECT_OPERATOR","->",76],["T_STRING","execute",76],"(",")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","cron",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","run",77],"(",")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertEqual",78],"(",["T_NS_SEPARATOR","\\",78],["T_STRING","Drupal",78],["T_DOUBLE_COLON","::",78],["T_STRING","state",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","get",78],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_exception'",78],")",",",["T_WHITESPACE"," ",78],["T_LNUMBER","2",78],")",";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","assertEqual",79],"(",["T_VARIABLE","$queue",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","numberOfItems",79],"(",")",",",["T_WHITESPACE"," ",79],["T_LNUMBER","0",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'Item was processed and removed from the queue.'",79],")",";",["T_WHITESPACE","\n\n    ",79],["T_COMMENT","\/\/ Get the queue to test the specific SuspendQueueException.\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$queue",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","container",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","get",82],"(",["T_CONSTANT_ENCAPSED_STRING","'queue'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","get",82],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_broken_queue'",82],")",";",["T_WHITESPACE","\n\n    ",82],["T_COMMENT","\/\/ Enqueue several item for processing.\n",84],["T_WHITESPACE","    ",85],["T_VARIABLE","$queue",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","createItem",85],"(",["T_CONSTANT_ENCAPSED_STRING","'process'",85],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$queue",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","createItem",86],"(",["T_CONSTANT_ENCAPSED_STRING","'crash'",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$queue",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","createItem",87],"(",["T_CONSTANT_ENCAPSED_STRING","'ignored'",87],")",";",["T_WHITESPACE","\n\n    ",87],["T_COMMENT","\/\/ Run cron; the worker for this queue should process as far as the crashing\n",89],["T_WHITESPACE","    ",90],["T_COMMENT","\/\/ item.\n",90],["T_WHITESPACE","    ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","cron",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","run",91],"(",")",";",["T_WHITESPACE","\n\n    ",91],["T_COMMENT","\/\/ Only one item should have been processed.\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertEqual",94],"(",["T_VARIABLE","$queue",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","numberOfItems",94],"(",")",",",["T_WHITESPACE"," ",94],["T_LNUMBER","2",94],",",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'Failing queue stopped processing at the failing item.'",94],")",";",["T_WHITESPACE","\n\n    ",94],["T_COMMENT","\/\/ Check the items remaining in the queue. The item that throws the\n",96],["T_WHITESPACE","    ",97],["T_COMMENT","\/\/ exception gets released by cron, so we can claim it again to check it.\n",97],["T_WHITESPACE","    ",98],["T_VARIABLE","$item",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$queue",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","claimItem",98],"(",")",";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","assertEqual",99],"(",["T_VARIABLE","$item",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","data",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'crash'",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'Failing item remains in the queue.'",99],")",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$item",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$queue",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","claimItem",100],"(",")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","assertEqual",101],"(",["T_VARIABLE","$item",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","data",101],",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'ignored'",101],",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'Item beyond the failing item remains in the queue.'",101],")",";",["T_WHITESPACE","\n\n    ",101],["T_COMMENT","\/\/ Test the requeueing functionality.\n",103],["T_WHITESPACE","    ",104],["T_VARIABLE","$queue",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","container",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","get",104],"(",["T_CONSTANT_ENCAPSED_STRING","'queue'",104],")",["T_OBJECT_OPERATOR","->",104],["T_STRING","get",104],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_requeue_exception'",104],")",";",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$queue",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","createItem",105],"(","[","]",")",";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","cron",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","run",106],"(",")",";",["T_WHITESPACE","\n\n    ",106],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","assertEqual",108],"(",["T_NS_SEPARATOR","\\",108],["T_STRING","Drupal",108],["T_DOUBLE_COLON","::",108],["T_STRING","state",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","get",108],"(",["T_CONSTANT_ENCAPSED_STRING","'cron_queue_test_requeue_exception'",108],")",",",["T_WHITESPACE"," ",108],["T_LNUMBER","2",108],")",";",["T_WHITESPACE","\n    ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","assertFalse",109],"(",["T_VARIABLE","$queue",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","numberOfItems",109],"(",")",")",";",["T_WHITESPACE","\n  ",109],"}",["T_WHITESPACE","\n\n",110],"}",["T_WHITESPACE","\n",112]]