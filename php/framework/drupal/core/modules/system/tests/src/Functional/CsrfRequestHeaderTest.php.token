[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","system",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Functional",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Url",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","BrowserTestBase",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","GuzzleHttp",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Cookie",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CookieJar",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests protecting routes by requiring CSRF token in the request header.\n *\n * @group system\n *\/",9],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","CsrfRequestHeaderTest",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_STRING","BrowserTestBase",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\n  ",14],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",16],["T_WHITESPACE","\n  ",20],["T_PUBLIC","public",21],["T_WHITESPACE"," ",21],["T_STATIC","static",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$modules",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],"[",["T_CONSTANT_ENCAPSED_STRING","'system'",21],",",["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'csrf_test'",21],"]",";",["T_WHITESPACE","\n\n  ",21],["T_DOC_COMMENT","\/**\n   * Tests access to routes protected by CSRF request header requirements.\n   *\n   * This checks one route that uses _csrf_request_header_token and one that\n   * uses the deprecated _access_rest_csrf.\n   *\/",23],["T_WHITESPACE","\n  ",28],["T_PUBLIC","public",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","testRouteAccess",29],"(",")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$client",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Drupal",30],["T_DOUBLE_COLON","::",30],["T_STRING","httpClient",30],"(",")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$csrf_token_paths",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],"[",["T_CONSTANT_ENCAPSED_STRING","'deprecated\/session\/token'",31],",",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'session\/token'",31],"]",";",["T_WHITESPACE","\n    ",31],["T_COMMENT","\/\/ Test using the both the current path and a test path that returns\n",32],["T_WHITESPACE","    ",33],["T_COMMENT","\/\/ a token using the deprecated 'rest' value.\n",33],["T_WHITESPACE","    ",34],["T_COMMENT","\/\/ Checking \/deprecated\/session\/token can be removed in 8.3.\n",34],["T_WHITESPACE","    ",35],["T_COMMENT","\/\/ @see \\Drupal\\Core\\Access\\CsrfRequestHeaderAccessCheck::access()\n",35],["T_WHITESPACE","    ",36],["T_FOREACH","foreach",36],["T_WHITESPACE"," ",36],"(",["T_VARIABLE","$csrf_token_paths",36],["T_WHITESPACE"," ",36],["T_AS","as",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$csrf_token_path",36],")",["T_WHITESPACE"," ",36],"{",["T_WHITESPACE","\n      ",36],["T_COMMENT","\/\/ Check both test routes.\n",37],["T_WHITESPACE","      ",38],["T_VARIABLE","$route_names",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],"[",["T_CONSTANT_ENCAPSED_STRING","'csrf_test.protected'",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'csrf_test.deprecated.protected'",38],"]",";",["T_WHITESPACE","\n      ",38],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$route_names",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$route_name",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$user",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","drupalCreateUser",40],"(",")",";",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","drupalLogin",41],"(",["T_VARIABLE","$user",41],")",";",["T_WHITESPACE","\n\n        ",41],["T_VARIABLE","$csrf_token",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","drupalGet",43],"(",["T_VARIABLE","$csrf_token_path",43],")",";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$url",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","Url",44],["T_DOUBLE_COLON","::",44],["T_STRING","fromRoute",44],"(",["T_VARIABLE","$route_name",44],")",["T_WHITESPACE","\n          ",44],["T_OBJECT_OPERATOR","->",45],["T_STRING","setAbsolute",45],"(",["T_STRING","TRUE",45],")",["T_WHITESPACE","\n          ",45],["T_OBJECT_OPERATOR","->",46],["T_STRING","toString",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$domain",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","parse_url",47],"(",["T_VARIABLE","$url",47],",",["T_WHITESPACE"," ",47],["T_STRING","PHP_URL_HOST",47],")",";",["T_WHITESPACE","\n\n        ",47],["T_VARIABLE","$session_id",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getSession",49],"(",")",["T_OBJECT_OPERATOR","->",49],["T_STRING","getCookie",49],"(",["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getSessionName",49],"(",")",")",";",["T_WHITESPACE","\n        ",49],["T_DOC_COMMENT","\/** @var \\GuzzleHttp\\Cookie\\CookieJar $cookies *\/",50],["T_WHITESPACE","\n        ",50],["T_VARIABLE","$cookies",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","CookieJar",51],["T_DOUBLE_COLON","::",51],["T_STRING","fromArray",51],"(","[",["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getSessionName",51],"(",")",["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$session_id",51],"]",",",["T_WHITESPACE"," ",51],["T_VARIABLE","$domain",51],")",";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$post_options",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],"[",["T_WHITESPACE","\n          ",52],["T_CONSTANT_ENCAPSED_STRING","'headers'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],"[",["T_CONSTANT_ENCAPSED_STRING","'Accept'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'text\/plain'",53],"]",",",["T_WHITESPACE","\n          ",53],["T_CONSTANT_ENCAPSED_STRING","'http_errors'",54],["T_WHITESPACE"," ",54],["T_DOUBLE_ARROW","=>",54],["T_WHITESPACE"," ",54],["T_STRING","FALSE",54],",",["T_WHITESPACE","\n        ",54],"]",";",["T_WHITESPACE","\n\n        ",55],["T_COMMENT","\/\/ Test that access is allowed for anonymous user with no token in header.\n",57],["T_WHITESPACE","        ",58],["T_VARIABLE","$result",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$client",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","post",58],"(",["T_VARIABLE","$url",58],",",["T_WHITESPACE"," ",58],["T_VARIABLE","$post_options",58],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","assertEquals",59],"(",["T_LNUMBER","200",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$result",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getStatusCode",59],"(",")",")",";",["T_WHITESPACE","\n\n        ",59],["T_COMMENT","\/\/ Add cookies to POST options so that all other requests are for the\n",61],["T_WHITESPACE","        ",62],["T_COMMENT","\/\/ authenticated user.\n",62],["T_WHITESPACE","        ",63],["T_VARIABLE","$post_options",63],"[",["T_CONSTANT_ENCAPSED_STRING","'cookies'",63],"]",["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$cookies",63],";",["T_WHITESPACE","\n\n        ",63],["T_COMMENT","\/\/ Test that access is denied with no token in header.\n",65],["T_WHITESPACE","        ",66],["T_VARIABLE","$result",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$client",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","post",66],"(",["T_VARIABLE","$url",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$post_options",66],")",";",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertEquals",67],"(",["T_LNUMBER","403",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$result",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getStatusCode",67],"(",")",")",";",["T_WHITESPACE","\n\n        ",67],["T_COMMENT","\/\/ Test that access is allowed with correct token in header.\n",69],["T_WHITESPACE","        ",70],["T_VARIABLE","$post_options",70],"[",["T_CONSTANT_ENCAPSED_STRING","'headers'",70],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",70],"]",["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$csrf_token",70],";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$result",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$client",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","post",71],"(",["T_VARIABLE","$url",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$post_options",71],")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertEquals",72],"(",["T_LNUMBER","200",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$result",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getStatusCode",72],"(",")",")",";",["T_WHITESPACE","\n\n        ",72],["T_COMMENT","\/\/ Test that access is denied with incorrect token in header.\n",74],["T_WHITESPACE","        ",75],["T_VARIABLE","$post_options",75],"[",["T_CONSTANT_ENCAPSED_STRING","'headers'",75],"]","[",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",75],"]",["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'this-is-not-the-token-you-are-looking-for'",75],";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$result",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$client",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","post",76],"(",["T_VARIABLE","$url",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$post_options",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","assertEquals",77],"(",["T_LNUMBER","403",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$result",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getStatusCode",77],"(",")",")",";",["T_WHITESPACE","\n      ",77],"}",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n  ",79],"}",["T_WHITESPACE","\n\n",81],"}",["T_WHITESPACE","\n",83]]