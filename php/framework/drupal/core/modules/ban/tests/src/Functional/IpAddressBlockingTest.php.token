[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","ban",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Functional",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Tests",5],["T_NS_SEPARATOR","\\",5],["T_STRING","BrowserTestBase",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ban",7],["T_NS_SEPARATOR","\\",7],["T_STRING","BanIpManager",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests IP address banning.\n *\n * @group ban\n *\/",9],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","IpAddressBlockingTest",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_STRING","BrowserTestBase",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\n  ",14],["T_DOC_COMMENT","\/**\n   * Modules to install.\n   *\n   * @var array\n   *\/",16],["T_WHITESPACE","\n  ",20],["T_PUBLIC","public",21],["T_WHITESPACE"," ",21],["T_STATIC","static",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$modules",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_ARRAY","array",21],"(",["T_CONSTANT_ENCAPSED_STRING","'ban'",21],")",";",["T_WHITESPACE","\n\n  ",21],["T_DOC_COMMENT","\/**\n   * Tests various user input to confirm correct validation and saving of data.\n   *\/",23],["T_WHITESPACE","\n  ",25],["T_FUNCTION","function",26],["T_WHITESPACE"," ",26],["T_STRING","testIPAddressValidation",26],"(",")",["T_WHITESPACE"," ",26],"{",["T_WHITESPACE","\n    ",26],["T_COMMENT","\/\/ Create user.\n",27],["T_WHITESPACE","    ",28],["T_VARIABLE","$admin_user",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","drupalCreateUser",28],"(",["T_ARRAY","array",28],"(",["T_CONSTANT_ENCAPSED_STRING","'ban IP addresses'",28],")",")",";",["T_WHITESPACE","\n    ",28],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","drupalLogin",29],"(",["T_VARIABLE","$admin_user",29],")",";",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","drupalGet",30],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",30],")",";",["T_WHITESPACE","\n\n    ",30],["T_COMMENT","\/\/ Ban a valid IP address.\n",32],["T_WHITESPACE","    ",33],["T_VARIABLE","$edit",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_ARRAY","array",33],"(",")",";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$edit",34],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",34],"]",["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'1.2.3.3'",34],";",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","drupalPostForm",35],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$edit",35],",",["T_WHITESPACE"," ",35],["T_STRING","t",35],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",35],")",")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$ip",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_STRING","db_query",36],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT iid from {ban_ip} WHERE ip = :ip\"",36],",",["T_WHITESPACE"," ",36],["T_ARRAY","array",36],"(",["T_CONSTANT_ENCAPSED_STRING","':ip'",36],["T_WHITESPACE"," ",36],["T_DOUBLE_ARROW","=>",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$edit",36],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",36],"]",")",")",["T_OBJECT_OPERATOR","->",36],["T_STRING","fetchField",36],"(",")",";",["T_WHITESPACE","\n    ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertTrue",37],"(",["T_VARIABLE","$ip",37],",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'IP address found in database.'",37],")",";",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","assertRaw",38],"(",["T_STRING","t",38],"(",["T_CONSTANT_ENCAPSED_STRING","'The IP address %ip has been banned.'",38],",",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",["T_CONSTANT_ENCAPSED_STRING","'%ip'",38],["T_WHITESPACE"," ",38],["T_DOUBLE_ARROW","=>",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$edit",38],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",38],"]",")",")",",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'IP address was banned.'",38],")",";",["T_WHITESPACE","\n\n    ",38],["T_COMMENT","\/\/ Try to block an IP address that's already blocked.\n",40],["T_WHITESPACE","    ",41],["T_VARIABLE","$edit",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",")",";",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$edit",42],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",42],"]",["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'1.2.3.3'",42],";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","drupalPostForm",43],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$edit",43],",",["T_WHITESPACE"," ",43],["T_STRING","t",43],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",43],")",")",";",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","assertText",44],"(",["T_STRING","t",44],"(",["T_CONSTANT_ENCAPSED_STRING","'This IP address is already banned.'",44],")",")",";",["T_WHITESPACE","\n\n    ",44],["T_COMMENT","\/\/ Try to block a reserved IP address.\n",46],["T_WHITESPACE","    ",47],["T_VARIABLE","$edit",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",")",";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$edit",48],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",48],"]",["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'255.255.255.255'",48],";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","drupalPostForm",49],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",49],",",["T_WHITESPACE"," ",49],["T_VARIABLE","$edit",49],",",["T_WHITESPACE"," ",49],["T_STRING","t",49],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",49],")",")",";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","assertText",50],"(",["T_STRING","t",50],"(",["T_CONSTANT_ENCAPSED_STRING","'Enter a valid IP address.'",50],")",")",";",["T_WHITESPACE","\n\n    ",50],["T_COMMENT","\/\/ Try to block a reserved IP address.\n",52],["T_WHITESPACE","    ",53],["T_VARIABLE","$edit",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$edit",54],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'test.example.com'",54],";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","drupalPostForm",55],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$edit",55],",",["T_WHITESPACE"," ",55],["T_STRING","t",55],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",55],")",")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","assertText",56],"(",["T_STRING","t",56],"(",["T_CONSTANT_ENCAPSED_STRING","'Enter a valid IP address.'",56],")",")",";",["T_WHITESPACE","\n\n    ",56],["T_COMMENT","\/\/ Submit an empty form.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$edit",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",")",";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$edit",60],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",60],"]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","''",60],";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","drupalPostForm",61],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban'",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$edit",61],",",["T_WHITESPACE"," ",61],["T_STRING","t",61],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",61],")",")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertText",62],"(",["T_STRING","t",62],"(",["T_CONSTANT_ENCAPSED_STRING","'Enter a valid IP address.'",62],")",")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Pass an IP address as a URL parameter and submit it.\n",64],["T_WHITESPACE","    ",65],["T_VARIABLE","$submit_ip",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'1.2.3.4'",65],";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","drupalPostForm",66],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/config\/people\/ban\/'",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$submit_ip",66],",",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",")",",",["T_WHITESPACE"," ",66],["T_STRING","t",66],"(",["T_CONSTANT_ENCAPSED_STRING","'Add'",66],")",")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$ip",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","db_query",67],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT iid from {ban_ip} WHERE ip = :ip\"",67],",",["T_WHITESPACE"," ",67],["T_ARRAY","array",67],"(",["T_CONSTANT_ENCAPSED_STRING","':ip'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$submit_ip",67],")",")",["T_OBJECT_OPERATOR","->",67],["T_STRING","fetchField",67],"(",")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertTrue",68],"(",["T_VARIABLE","$ip",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'IP address found in database'",68],")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertRaw",69],"(",["T_STRING","t",69],"(",["T_CONSTANT_ENCAPSED_STRING","'The IP address %ip has been banned.'",69],",",["T_WHITESPACE"," ",69],["T_ARRAY","array",69],"(",["T_CONSTANT_ENCAPSED_STRING","'%ip'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$submit_ip",69],")",")",",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'IP address was banned.'",69],")",";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/\/ Submit your own IP address. This fails, although it works when testing\n",71],["T_WHITESPACE","    ",72],["T_COMMENT","\/\/ manually.\n",72],["T_WHITESPACE","    ",73],["T_COMMENT","\/\/ TODO: On some systems this test fails due to a bug\/inconsistency in cURL.\n",73],["T_WHITESPACE","    ",74],["T_COMMENT","\/\/ $edit = array();\n",74],["T_WHITESPACE","    ",75],["T_COMMENT","\/\/ $edit['ip'] = \\Drupal::request()->getClientIP();\n",75],["T_WHITESPACE","    ",76],["T_COMMENT","\/\/ $this->drupalPostForm('admin\/config\/people\/ban', $edit, t('Save'));\n",76],["T_WHITESPACE","    ",77],["T_COMMENT","\/\/ $this->assertText(t('You may not ban your own IP address.'));\n",77],["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ Test duplicate ip address are not present in the 'blocked_ips' table.\n",79],["T_WHITESPACE","    ",80],["T_COMMENT","\/\/ when they are entered programmatically.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$connection",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","Database",81],["T_DOUBLE_COLON","::",81],["T_STRING","getConnection",81],"(",")",";",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$banIp",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_NEW","new",82],["T_WHITESPACE"," ",82],["T_STRING","BanIpManager",82],"(",["T_VARIABLE","$connection",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$ip",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'1.0.0.0'",83],";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$banIp",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","banIp",84],"(",["T_VARIABLE","$ip",84],")",";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$banIp",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","banIp",85],"(",["T_VARIABLE","$ip",85],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$banIp",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","banIp",86],"(",["T_VARIABLE","$ip",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$query",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","db_select",87],"(",["T_CONSTANT_ENCAPSED_STRING","'ban_ip'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'bip'",87],")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$query",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","fields",88],"(",["T_CONSTANT_ENCAPSED_STRING","'bip'",88],",",["T_WHITESPACE"," ",88],["T_ARRAY","array",88],"(",["T_CONSTANT_ENCAPSED_STRING","'iid'",88],")",")",";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$query",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","condition",89],"(",["T_CONSTANT_ENCAPSED_STRING","'bip.ip'",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$ip",89],")",";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$ip_count",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$query",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","execute",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","fetchAll",90],"(",")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertEqual",91],"(",["T_LNUMBER","1",91],",",["T_WHITESPACE"," ",91],["T_STRING","count",91],"(",["T_VARIABLE","$ip_count",91],")",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$ip",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","''",92],";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$banIp",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","banIp",93],"(",["T_VARIABLE","$ip",93],")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$banIp",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","banIp",94],"(",["T_VARIABLE","$ip",94],")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$query",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","db_select",95],"(",["T_CONSTANT_ENCAPSED_STRING","'ban_ip'",95],",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'bip'",95],")",";",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$query",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","fields",96],"(",["T_CONSTANT_ENCAPSED_STRING","'bip'",96],",",["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",["T_CONSTANT_ENCAPSED_STRING","'iid'",96],")",")",";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$query",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","condition",97],"(",["T_CONSTANT_ENCAPSED_STRING","'bip.ip'",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$ip",97],")",";",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$ip_count",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$query",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","execute",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","fetchAll",98],"(",")",";",["T_WHITESPACE","\n    ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","assertEqual",99],"(",["T_LNUMBER","1",99],",",["T_WHITESPACE"," ",99],["T_STRING","count",99],"(",["T_VARIABLE","$ip_count",99],")",")",";",["T_WHITESPACE","\n  ",99],"}",["T_WHITESPACE","\n\n",100],"}",["T_WHITESPACE","\n",102]]