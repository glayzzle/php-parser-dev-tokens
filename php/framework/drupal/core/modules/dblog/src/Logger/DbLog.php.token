[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","dblog",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Logger",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Unicode",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Connection",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Database",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DatabaseException",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","DependencyInjection",9],["T_NS_SEPARATOR","\\",9],["T_STRING","DependencySerializationTrait",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Logger",10],["T_NS_SEPARATOR","\\",10],["T_STRING","LogMessageParserInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Logger",11],["T_NS_SEPARATOR","\\",11],["T_STRING","RfcLoggerTrait",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Psr",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Log",12],["T_NS_SEPARATOR","\\",12],["T_STRING","LoggerInterface",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * Logs events in the watchdog database table.\n *\/",14],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","DbLog",17],["T_WHITESPACE"," ",17],["T_IMPLEMENTS","implements",17],["T_WHITESPACE"," ",17],["T_STRING","LoggerInterface",17],["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n  ",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","RfcLoggerTrait",18],";",["T_WHITESPACE","\n  ",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","DependencySerializationTrait",19],";",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * The dedicated database connection target to use for log entries.\n   *\/",21],["T_WHITESPACE","\n  ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","DEDICATED_DBLOG_CONNECTION_TARGET",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'dedicated_dblog'",24],";",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * The database connection object.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",26],["T_WHITESPACE","\n  ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$connection",31],";",["T_WHITESPACE","\n\n  ",31],["T_DOC_COMMENT","\/**\n   * The message's placeholders parser.\n   *\n   * @var \\Drupal\\Core\\Logger\\LogMessageParserInterface\n   *\/",33],["T_WHITESPACE","\n  ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$parser",38],";",["T_WHITESPACE","\n\n  ",38],["T_DOC_COMMENT","\/**\n   * Constructs a DbLog object.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection object.\n   * @param \\Drupal\\Core\\Logger\\LogMessageParserInterface $parser\n   *   The parser to use when extracting message variables.\n   *\/",40],["T_WHITESPACE","\n  ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","__construct",48],"(",["T_STRING","Connection",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$connection",48],",",["T_WHITESPACE"," ",48],["T_STRING","LogMessageParserInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$parser",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","connection",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$connection",49],";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","parser",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$parser",50],";",["T_WHITESPACE","\n  ",50],"}",["T_WHITESPACE","\n\n  ",51],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",53],["T_WHITESPACE","\n  ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","log",56],"(",["T_VARIABLE","$level",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$message",56],",",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$context",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n    ",56],["T_COMMENT","\/\/ Remove any backtraces since they may contain an unserializable variable.\n",57],["T_WHITESPACE","    ",58],["T_UNSET","unset",58],"(",["T_VARIABLE","$context",58],"[",["T_CONSTANT_ENCAPSED_STRING","'backtrace'",58],"]",")",";",["T_WHITESPACE","\n\n    ",58],["T_COMMENT","\/\/ Convert PSR3-style messages to SafeMarkup::format() style, so they can be\n",60],["T_WHITESPACE","    ",61],["T_COMMENT","\/\/ translated too in runtime.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$message_placeholders",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","parser",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","parseMessagePlaceholders",62],"(",["T_VARIABLE","$message",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$context",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_TRY","try",64],["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n      ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","connection",65],["T_WHITESPACE","\n        ",65],["T_OBJECT_OPERATOR","->",66],["T_STRING","insert",66],"(",["T_CONSTANT_ENCAPSED_STRING","'watchdog'",66],")",["T_WHITESPACE","\n        ",66],["T_OBJECT_OPERATOR","->",67],["T_STRING","fields",67],"(",["T_ARRAY","array",67],"(",["T_WHITESPACE","\n          ",67],["T_CONSTANT_ENCAPSED_STRING","'uid'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$context",68],"[",["T_CONSTANT_ENCAPSED_STRING","'uid'",68],"]",",",["T_WHITESPACE","\n          ",68],["T_CONSTANT_ENCAPSED_STRING","'type'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_STRING","Unicode",69],["T_DOUBLE_COLON","::",69],["T_STRING","substr",69],"(",["T_VARIABLE","$context",69],"[",["T_CONSTANT_ENCAPSED_STRING","'channel'",69],"]",",",["T_WHITESPACE"," ",69],["T_LNUMBER","0",69],",",["T_WHITESPACE"," ",69],["T_LNUMBER","64",69],")",",",["T_WHITESPACE","\n          ",69],["T_CONSTANT_ENCAPSED_STRING","'message'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$message",70],",",["T_WHITESPACE","\n          ",70],["T_CONSTANT_ENCAPSED_STRING","'variables'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_STRING","serialize",71],"(",["T_VARIABLE","$message_placeholders",71],")",",",["T_WHITESPACE","\n          ",71],["T_CONSTANT_ENCAPSED_STRING","'severity'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$level",72],",",["T_WHITESPACE","\n          ",72],["T_CONSTANT_ENCAPSED_STRING","'link'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$context",73],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",73],"]",",",["T_WHITESPACE","\n          ",73],["T_CONSTANT_ENCAPSED_STRING","'location'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$context",74],"[",["T_CONSTANT_ENCAPSED_STRING","'request_uri'",74],"]",",",["T_WHITESPACE","\n          ",74],["T_CONSTANT_ENCAPSED_STRING","'referer'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$context",75],"[",["T_CONSTANT_ENCAPSED_STRING","'referer'",75],"]",",",["T_WHITESPACE","\n          ",75],["T_CONSTANT_ENCAPSED_STRING","'hostname'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_STRING","Unicode",76],["T_DOUBLE_COLON","::",76],["T_STRING","substr",76],"(",["T_VARIABLE","$context",76],"[",["T_CONSTANT_ENCAPSED_STRING","'ip'",76],"]",",",["T_WHITESPACE"," ",76],["T_LNUMBER","0",76],",",["T_WHITESPACE"," ",76],["T_LNUMBER","128",76],")",",",["T_WHITESPACE","\n          ",76],["T_CONSTANT_ENCAPSED_STRING","'timestamp'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$context",77],"[",["T_CONSTANT_ENCAPSED_STRING","'timestamp'",77],"]",",",["T_WHITESPACE","\n        ",77],")",")",["T_WHITESPACE","\n        ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","execute",79],"(",")",";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n    ",80],["T_CATCH","catch",81],["T_WHITESPACE"," ",81],"(",["T_NS_SEPARATOR","\\",81],["T_STRING","Exception",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$e",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n      ",81],["T_COMMENT","\/\/ When running Drupal on MySQL or MariaDB you can run into several errors\n",82],["T_WHITESPACE","      ",83],["T_COMMENT","\/\/ that corrupt the database connection. Some examples for these kind of\n",83],["T_WHITESPACE","      ",84],["T_COMMENT","\/\/ errors on the database layer are \"1100 - Table 'xyz' was not locked\n",84],["T_WHITESPACE","      ",85],["T_COMMENT","\/\/ with LOCK TABLES\" and \"1153 - Got a packet bigger than\n",85],["T_WHITESPACE","      ",86],["T_COMMENT","\/\/ 'max_allowed_packet' bytes\". If such an error happens, the MySQL server\n",86],["T_WHITESPACE","      ",87],["T_COMMENT","\/\/ invalidates the connection and answers all further requests in this\n",87],["T_WHITESPACE","      ",88],["T_COMMENT","\/\/ connection with \"2006 - MySQL server had gone away\". In that case the\n",88],["T_WHITESPACE","      ",89],["T_COMMENT","\/\/ insert statement above results in a database exception. To ensure that\n",89],["T_WHITESPACE","      ",90],["T_COMMENT","\/\/ the causal error is written to the log we try once to open a dedicated\n",90],["T_WHITESPACE","      ",91],["T_COMMENT","\/\/ connection and write again.\n",91],["T_WHITESPACE","      ",92],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_WHITESPACE","\n        ",92],["T_COMMENT","\/\/ Only handle database related exceptions.\n",93],["T_WHITESPACE","        ",94],"(",["T_VARIABLE","$e",94],["T_WHITESPACE"," ",94],["T_INSTANCEOF","instanceof",94],["T_WHITESPACE"," ",94],["T_STRING","DatabaseException",94],["T_WHITESPACE"," ",94],["T_BOOLEAN_OR","||",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$e",94],["T_WHITESPACE"," ",94],["T_INSTANCEOF","instanceof",94],["T_WHITESPACE"," ",94],["T_NS_SEPARATOR","\\",94],["T_STRING","PDOException",94],")",["T_WHITESPACE"," ",94],["T_BOOLEAN_AND","&&",94],["T_WHITESPACE","\n        ",94],["T_COMMENT","\/\/ Avoid an endless loop of re-write attempts.\n",95],["T_WHITESPACE","        ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","connection",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getTarget",96],"(",")",["T_WHITESPACE"," ",96],["T_IS_NOT_EQUAL","!=",96],["T_WHITESPACE"," ",96],["T_STRING","self",96],["T_DOUBLE_COLON","::",96],["T_STRING","DEDICATED_DBLOG_CONNECTION_TARGET",96],["T_WHITESPACE","\n      ",96],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n        ",97],["T_COMMENT","\/\/ Open a dedicated connection for logging.\n",98],["T_WHITESPACE","        ",99],["T_VARIABLE","$key",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","connection",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getKey",99],"(",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$info",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","Database",100],["T_DOUBLE_COLON","::",100],["T_STRING","getConnectionInfo",100],"(",["T_VARIABLE","$key",100],")",";",["T_WHITESPACE","\n        ",100],["T_STRING","Database",101],["T_DOUBLE_COLON","::",101],["T_STRING","addConnectionInfo",101],"(",["T_VARIABLE","$key",101],",",["T_WHITESPACE"," ",101],["T_STRING","self",101],["T_DOUBLE_COLON","::",101],["T_STRING","DEDICATED_DBLOG_CONNECTION_TARGET",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$info",101],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",101],"]",")",";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","connection",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","Database",102],["T_DOUBLE_COLON","::",102],["T_STRING","getConnection",102],"(",["T_STRING","self",102],["T_DOUBLE_COLON","::",102],["T_STRING","DEDICATED_DBLOG_CONNECTION_TARGET",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$key",102],")",";",["T_WHITESPACE","\n        ",102],["T_COMMENT","\/\/ Now try once to log the error again.\n",103],["T_WHITESPACE","        ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","log",104],"(",["T_VARIABLE","$level",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$message",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$context",104],")",";",["T_WHITESPACE","\n      ",104],"}",["T_WHITESPACE","\n      ",105],["T_ELSE","else",106],["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n        ",106],["T_THROW","throw",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$e",107],";",["T_WHITESPACE","\n      ",107],"}",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n  ",109],"}",["T_WHITESPACE","\n\n",110],"}",["T_WHITESPACE","\n",112]]