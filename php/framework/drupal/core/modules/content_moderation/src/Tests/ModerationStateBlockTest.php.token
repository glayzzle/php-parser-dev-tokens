[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","content_moderation",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","block_content",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","BlockContent",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","block_content",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","BlockContentType",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Tests general content moderation workflow for blocks.\n *\n * @group content_moderation\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","ModerationStateBlockTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","ModerationStateTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",15],["T_WHITESPACE","\n  ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_FUNCTION","function",18],["T_WHITESPACE"," ",18],["T_STRING","setUp",18],"(",")",["T_WHITESPACE"," ",18],"{",["T_WHITESPACE","\n    ",18],["T_STRING","parent",19],["T_DOUBLE_COLON","::",19],["T_STRING","setUp",19],"(",")",";",["T_WHITESPACE","\n\n    ",19],["T_COMMENT","\/\/ Create the \"basic\" block type.\n",21],["T_WHITESPACE","    ",22],["T_VARIABLE","$bundle",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_STRING","BlockContentType",22],["T_DOUBLE_COLON","::",22],["T_STRING","create",22],"(","[",["T_WHITESPACE","\n      ",22],["T_CONSTANT_ENCAPSED_STRING","'id'",23],["T_WHITESPACE"," ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'basic'",23],",",["T_WHITESPACE","\n      ",23],["T_CONSTANT_ENCAPSED_STRING","'label'",24],["T_WHITESPACE"," ",24],["T_DOUBLE_ARROW","=>",24],["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'basic'",24],",",["T_WHITESPACE","\n      ",24],["T_CONSTANT_ENCAPSED_STRING","'revision'",25],["T_WHITESPACE"," ",25],["T_DOUBLE_ARROW","=>",25],["T_WHITESPACE"," ",25],["T_STRING","FALSE",25],",",["T_WHITESPACE","\n    ",25],"]",")",";",["T_WHITESPACE","\n    ",26],["T_VARIABLE","$bundle",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","save",27],"(",")",";",["T_WHITESPACE","\n\n    ",27],["T_COMMENT","\/\/ Add the body field to it.\n",29],["T_WHITESPACE","    ",30],["T_STRING","block_content_add_body_field",30],"(",["T_VARIABLE","$bundle",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","id",30],"(",")",")",";",["T_WHITESPACE","\n  ",30],"}",["T_WHITESPACE","\n\n  ",31],["T_DOC_COMMENT","\/**\n   * Tests moderating custom blocks.\n   *\n   * Blocks and any non-node-type-entities do not have a concept of\n   * \"published\". As such, we must use the \"default revision\" to know what is\n   * going to be \"published\", i.e. visible to the user.\n   *\n   * The one exception is a block that has never been \"published\". When a block\n   * is first created, it becomes the \"default revision\". For each edit of the\n   * block after that, Content Moderation checks the \"default revision\" to\n   * see if it is set to a published moderation state. If it is not, the entity\n   * being saved will become the \"default revision\".\n   *\n   * The test below is intended, in part, to make this behavior clear.\n   *\n   * @see \\Drupal\\content_moderation\\EntityOperations::entityPresave\n   * @see \\Drupal\\content_moderation\\Tests\\ModerationFormTest::testModerationForm\n   *\/",33],["T_WHITESPACE","\n  ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","testCustomBlockModeration",51],"(",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","drupalLogin",52],"(",["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","rootUser",52],")",";",["T_WHITESPACE","\n\n    ",52],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","drupalGet",54],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/block-content\/types'",54],")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertLinkByHref",55],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/block-content\/manage\/basic\/moderation'",55],")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","drupalGet",56],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/block-content\/manage\/basic'",56],")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","assertLinkByHref",57],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/block-content\/manage\/basic\/moderation'",57],")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","drupalGet",58],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/block-content\/manage\/basic\/moderation'",58],")",";",["T_WHITESPACE","\n\n    ",58],["T_COMMENT","\/\/ Enable moderation for custom blocks at\n",60],["T_WHITESPACE","    ",61],["T_COMMENT","\/\/ admin\/structure\/block\/block-content\/manage\/basic\/moderation.\n",61],["T_WHITESPACE","    ",62],["T_VARIABLE","$edit",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],"[",["T_WHITESPACE","\n      ",62],["T_CONSTANT_ENCAPSED_STRING","'enable_moderation_state'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_STRING","TRUE",63],",",["T_WHITESPACE","\n      ",63],["T_CONSTANT_ENCAPSED_STRING","'allowed_moderation_states_unpublished[draft]'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_STRING","TRUE",64],",",["T_WHITESPACE","\n      ",64],["T_CONSTANT_ENCAPSED_STRING","'allowed_moderation_states_published[published]'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_STRING","TRUE",65],",",["T_WHITESPACE","\n      ",65],["T_CONSTANT_ENCAPSED_STRING","'default_moderation_state'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'draft'",66],",",["T_WHITESPACE","\n    ",66],"]",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","drupalPostForm",68],"(",["T_STRING","NULL",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$edit",68],",",["T_WHITESPACE"," ",68],["T_STRING","t",68],"(",["T_CONSTANT_ENCAPSED_STRING","'Save'",68],")",")",";",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertText",69],"(",["T_STRING","t",69],"(",["T_CONSTANT_ENCAPSED_STRING","'Your settings have been saved.'",69],")",")",";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/\/ Create a custom block at block\/add and save it as draft.\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$body",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'Body of moderated block'",72],";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$edit",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],"[",["T_WHITESPACE","\n      ",73],["T_CONSTANT_ENCAPSED_STRING","'info[0][value]'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'Moderated block'",74],",",["T_WHITESPACE","\n      ",74],["T_CONSTANT_ENCAPSED_STRING","'body[0][value]'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$body",75],",",["T_WHITESPACE","\n    ",75],"]",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","drupalPostForm",77],"(",["T_CONSTANT_ENCAPSED_STRING","'block\/add'",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$edit",77],",",["T_WHITESPACE"," ",77],["T_STRING","t",77],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and Create New Draft'",77],")",")",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertText",78],"(",["T_STRING","t",78],"(",["T_CONSTANT_ENCAPSED_STRING","'basic Moderated block has been created.'",78],")",")",";",["T_WHITESPACE","\n\n    ",78],["T_COMMENT","\/\/ Place the block in the Sidebar First region.\n",80],["T_WHITESPACE","    ",81],["T_VARIABLE","$instance",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],"(",["T_WHITESPACE","\n      ",81],["T_CONSTANT_ENCAPSED_STRING","'id'",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'moderated_block'",82],",",["T_WHITESPACE","\n      ",82],["T_CONSTANT_ENCAPSED_STRING","'settings[label]'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$edit",83],"[",["T_CONSTANT_ENCAPSED_STRING","'info[0][value]'",83],"]",",",["T_WHITESPACE","\n      ",83],["T_CONSTANT_ENCAPSED_STRING","'region'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'sidebar_first'",84],",",["T_WHITESPACE","\n    ",84],")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$block",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","BlockContent",86],["T_DOUBLE_COLON","::",86],["T_STRING","load",86],"(",["T_LNUMBER","1",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$url",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'admin\/structure\/block\/add\/block_content:'",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_VARIABLE","$block",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","uuid",87],"(",")",["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'\/'",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","config",87],"(",["T_CONSTANT_ENCAPSED_STRING","'system.theme'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","get",87],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",87],")",";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","drupalPostForm",88],"(",["T_VARIABLE","$url",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$instance",88],",",["T_WHITESPACE"," ",88],["T_STRING","t",88],"(",["T_CONSTANT_ENCAPSED_STRING","'Save block'",88],")",")",";",["T_WHITESPACE","\n\n    ",88],["T_COMMENT","\/\/ Navigate to home page and check that the block is visible. It should be\n",90],["T_WHITESPACE","    ",91],["T_COMMENT","\/\/ visible because it is the default revision.\n",91],["T_WHITESPACE","    ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","drupalGet",92],"(",["T_CONSTANT_ENCAPSED_STRING","''",92],")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertText",93],"(",["T_VARIABLE","$body",93],")",";",["T_WHITESPACE","\n\n    ",93],["T_COMMENT","\/\/ Update the block.\n",95],["T_WHITESPACE","    ",96],["T_VARIABLE","$updated_body",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'This is the new body value'",96],";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$edit",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],"[",["T_WHITESPACE","\n      ",97],["T_CONSTANT_ENCAPSED_STRING","'body[0][value]'",98],["T_WHITESPACE"," ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$updated_body",98],",",["T_WHITESPACE","\n    ",98],"]",";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","drupalPostForm",100],"(",["T_CONSTANT_ENCAPSED_STRING","'block\/'",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_VARIABLE","$block",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","id",100],"(",")",",",["T_WHITESPACE"," ",100],["T_VARIABLE","$edit",100],",",["T_WHITESPACE"," ",100],["T_STRING","t",100],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and Create New Draft'",100],")",")",";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","assertText",101],"(",["T_STRING","t",101],"(",["T_CONSTANT_ENCAPSED_STRING","'basic Moderated block has been updated.'",101],")",")",";",["T_WHITESPACE","\n\n    ",101],["T_COMMENT","\/\/ Navigate to the home page and check that the block shows the updated\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ content. It should show the updated content because the block's default\n",104],["T_WHITESPACE","    ",105],["T_COMMENT","\/\/ revision is not a published moderation state.\n",105],["T_WHITESPACE","    ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","drupalGet",106],"(",["T_CONSTANT_ENCAPSED_STRING","''",106],")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertText",107],"(",["T_VARIABLE","$updated_body",107],")",";",["T_WHITESPACE","\n\n    ",107],["T_COMMENT","\/\/ Publish the block so we can create a forward revision.\n",109],["T_WHITESPACE","    ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","drupalPostForm",110],"(",["T_CONSTANT_ENCAPSED_STRING","'block\/'",110],["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_VARIABLE","$block",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","id",110],"(",")",",",["T_WHITESPACE"," ",110],"[","]",",",["T_WHITESPACE"," ",110],["T_STRING","t",110],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and Publish'",110],")",")",";",["T_WHITESPACE","\n\n    ",110],["T_COMMENT","\/\/ Create a forward revision.\n",112],["T_WHITESPACE","    ",113],["T_VARIABLE","$forward_revision_body",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'This is the forward revision body value'",113],";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$edit",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],"[",["T_WHITESPACE","\n      ",114],["T_CONSTANT_ENCAPSED_STRING","'body[0][value]'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$forward_revision_body",115],",",["T_WHITESPACE","\n    ",115],"]",";",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","drupalPostForm",117],"(",["T_CONSTANT_ENCAPSED_STRING","'block\/'",117],["T_WHITESPACE"," ",117],".",["T_WHITESPACE"," ",117],["T_VARIABLE","$block",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","id",117],"(",")",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$edit",117],",",["T_WHITESPACE"," ",117],["T_STRING","t",117],"(",["T_CONSTANT_ENCAPSED_STRING","'Save and Create New Draft'",117],")",")",";",["T_WHITESPACE","\n    ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","assertText",118],"(",["T_STRING","t",118],"(",["T_CONSTANT_ENCAPSED_STRING","'basic Moderated block has been updated.'",118],")",")",";",["T_WHITESPACE","\n\n    ",118],["T_COMMENT","\/\/ Navigate to home page and check that the forward revision doesn't show,\n",120],["T_WHITESPACE","    ",121],["T_COMMENT","\/\/ since it should not be set as the default revision.\n",121],["T_WHITESPACE","    ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","drupalGet",122],"(",["T_CONSTANT_ENCAPSED_STRING","''",122],")",";",["T_WHITESPACE","\n    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","assertText",123],"(",["T_VARIABLE","$updated_body",123],")",";",["T_WHITESPACE","\n\n    ",123],["T_COMMENT","\/\/ Open the latest tab and publish the new draft.\n",125],["T_WHITESPACE","    ",126],["T_VARIABLE","$edit",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],"[",["T_WHITESPACE","\n      ",126],["T_CONSTANT_ENCAPSED_STRING","'new_state'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'published'",127],",",["T_WHITESPACE","\n    ",127],"]",";",["T_WHITESPACE","\n    ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","drupalPostForm",129],"(",["T_CONSTANT_ENCAPSED_STRING","'block\/'",129],["T_WHITESPACE"," ",129],".",["T_WHITESPACE"," ",129],["T_VARIABLE","$block",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","id",129],"(",")",["T_WHITESPACE"," ",129],".",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'\/latest'",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$edit",129],",",["T_WHITESPACE"," ",129],["T_STRING","t",129],"(",["T_CONSTANT_ENCAPSED_STRING","'Apply'",129],")",")",";",["T_WHITESPACE","\n    ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","assertText",130],"(",["T_STRING","t",130],"(",["T_CONSTANT_ENCAPSED_STRING","'The moderation state has been updated.'",130],")",")",";",["T_WHITESPACE","\n\n    ",130],["T_COMMENT","\/\/ Navigate to home page and check that the forward revision is now the\n",132],["T_WHITESPACE","    ",133],["T_COMMENT","\/\/ default revision and therefore visible.\n",133],["T_WHITESPACE","    ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","drupalGet",134],"(",["T_CONSTANT_ENCAPSED_STRING","''",134],")",";",["T_WHITESPACE","\n    ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","assertText",135],"(",["T_VARIABLE","$forward_revision_body",135],")",";",["T_WHITESPACE","\n  ",135],"}",["T_WHITESPACE","\n\n",136],"}",["T_WHITESPACE","\n",138]]