[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Component",3],["T_NS_SEPARATOR","\\",3],["T_STRING","PhpStorage",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Stores PHP code in files with securely hashed names.\n *\n * The goal of this class is to ensure that if a PHP file is replaced with\n * an untrusted one, it does not get loaded. Since mtime granularity is 1\n * second, we cannot prevent an attack that happens within one second of the\n * initial save(). However, it is very unlikely for an attacker exploiting an\n * upload or file write vulnerability to also know when a legitimate file is\n * being saved, discover its hash, undo its file permissions, and override the\n * file with an upload all within a single second. Being able to accomplish\n * that would indicate a site very likely vulnerable to many other attack\n * vectors.\n *\n * Each file is stored in its own unique containing directory. The hash is\n * based on the virtual file name, the containing directory's mtime, and a\n * cryptographically hard to guess secret string. Thus, even if the hashed file\n * name is discovered and replaced by an untrusted file (e.g., via a\n * move_uploaded_file() invocation by a script that performs insufficient\n * validation), the directory's mtime gets updated in the process, invalidating\n * the hash and preventing the untrusted file from getting loaded. Also, the\n * file mtime will be checked providing security against overwriting in-place,\n * at the cost of an additional system call for every load() and exists().\n *\n * The containing directory is created with the same name as the virtual file\n * name (slashes replaced with hashmarks) to assist with debugging, since the\n * file itself is stored with a name that's meaningless to humans.\n *\/",5],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","MTimeProtectedFileStorage",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","MTimeProtectedFastFileStorage",32],["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",34],["T_WHITESPACE","\n  ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","load",37],"(",["T_VARIABLE","$name",37],")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_IF","if",38],["T_WHITESPACE"," ",38],"(","(",["T_VARIABLE","$filename",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","checkFile",38],"(",["T_VARIABLE","$name",38],")",")",["T_WHITESPACE"," ",38],["T_IS_NOT_IDENTICAL","!==",38],["T_WHITESPACE"," ",38],["T_STRING","FALSE",38],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n      ",38],["T_COMMENT","\/\/ Inline parent::load() to avoid an expensive getFullPath() call.\n",39],["T_WHITESPACE","      ",40],["T_RETURN","return",40],["T_WHITESPACE"," ",40],"(","@",["T_INCLUDE_ONCE","include_once",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$filename",40],")",["T_WHITESPACE"," ",40],["T_IS_NOT_IDENTICAL","!==",40],["T_WHITESPACE"," ",40],["T_STRING","FALSE",40],";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n    ",41],["T_RETURN","return",42],["T_WHITESPACE"," ",42],["T_STRING","FALSE",42],";",["T_WHITESPACE","\n  ",42],"}",["T_WHITESPACE","\n\n  ",43],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",45],["T_WHITESPACE","\n  ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","exists",48],"(",["T_VARIABLE","$name",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n    ",48],["T_RETURN","return",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","checkFile",49],"(",["T_VARIABLE","$name",49],")",["T_WHITESPACE"," ",49],["T_IS_NOT_IDENTICAL","!==",49],["T_WHITESPACE"," ",49],["T_STRING","FALSE",49],";",["T_WHITESPACE","\n  ",49],"}",["T_WHITESPACE","\n\n  ",50],["T_DOC_COMMENT","\/**\n   * Determines whether a protected file exists and sets the filename too.\n   *\n   * @param string $name\n   *   The virtual file name. Can be a relative path.\n   *\n   * @return string|false\n   *   The full path where the file is if it is valid, FALSE otherwise.\n   *\/",52],["T_WHITESPACE","\n  ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","checkFile",61],"(",["T_VARIABLE","$name",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$filename",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getFullPath",62],"(",["T_VARIABLE","$name",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$directory",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$directory_mtime",62],")",";",["T_WHITESPACE","\n    ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_STRING","file_exists",63],"(",["T_VARIABLE","$filename",63],")",["T_WHITESPACE"," ",63],["T_BOOLEAN_AND","&&",63],["T_WHITESPACE"," ",63],["T_STRING","filemtime",63],"(",["T_VARIABLE","$filename",63],")",["T_WHITESPACE"," ",63],["T_IS_SMALLER_OR_EQUAL","<=",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$directory_mtime",63],["T_WHITESPACE"," ",63],"?",["T_WHITESPACE"," ",63],["T_VARIABLE","$filename",63],["T_WHITESPACE"," ",63],":",["T_WHITESPACE"," ",63],["T_STRING","FALSE",63],";",["T_WHITESPACE","\n  ",63],"}",["T_WHITESPACE","\n\n  ",64],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",66],["T_WHITESPACE","\n  ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","getPath",69],"(",["T_VARIABLE","$name",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n    ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","checkFile",70],"(",["T_VARIABLE","$name",70],")",";",["T_WHITESPACE","\n  ",70],"}",["T_WHITESPACE","\n\n",71],"}",["T_WHITESPACE","\n",73]]