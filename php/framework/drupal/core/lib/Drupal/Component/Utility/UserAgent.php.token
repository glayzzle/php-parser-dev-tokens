[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Component",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Utility",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Provides user agent related utility functions.\n *\n * @ingroup utility\n *\/",5],["T_WHITESPACE","\n",9],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","UserAgent",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Identifies user agent language from the Accept-language HTTP header.\n   *\n   * The algorithm works as follows:\n   * - map user agent language codes to available language codes.\n   * - order all user agent language codes by qvalue from high to low.\n   * - add generic user agent language codes if they aren't already specified\n   *   but with a slightly lower qvalue.\n   * - find the most specific available language code with the highest qvalue.\n   * - if 2 or more languages are having the same qvalue, respect the order of\n   *   them inside the $languages array.\n   *\n   * We perform user agent accept-language parsing only if page cache is\n   * disabled, otherwise we would cache a user-specific preference.\n   *\n   * @param string $http_accept_language\n   *   The value of the \"Accept-Language\" HTTP header.\n   * @param array $langcodes\n   *   An array of available language codes to pick from.\n   * @param array $mappings\n   *   (optional) Custom mappings to support user agents that are sending non\n   *   standard language codes. No mapping is assumed by default.\n   *\n   * @return string\n   *   The selected language code or FALSE if no valid language can be\n   *   identified.\n   *\/",12],["T_WHITESPACE","\n  ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_STATIC","static",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","getBestMatchingLangcode",39],"(",["T_VARIABLE","$http_accept_language",39],",",["T_WHITESPACE"," ",39],["T_VARIABLE","$langcodes",39],",",["T_WHITESPACE"," ",39],["T_VARIABLE","$mappings",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_ARRAY","array",39],"(",")",")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n    ",39],["T_COMMENT","\/\/ The Accept-Language header contains information about the language\n",40],["T_WHITESPACE","    ",41],["T_COMMENT","\/\/ preferences configured in the user's user agent \/ operating system.\n",41],["T_WHITESPACE","    ",42],["T_COMMENT","\/\/ RFC 2616 (section 14.4) defines the Accept-Language header as follows:\n",42],["T_WHITESPACE","    ",43],["T_COMMENT","\/\/   Accept-Language = \"Accept-Language\" \":\"\n",43],["T_WHITESPACE","    ",44],["T_COMMENT","\/\/                  1#( language-range [ \";\" \"q\" \"=\" qvalue ] )\n",44],["T_WHITESPACE","    ",45],["T_COMMENT","\/\/   language-range  = ( ( 1*8ALPHA *( \"-\" 1*8ALPHA ) ) | \"*\" )\n",45],["T_WHITESPACE","    ",46],["T_COMMENT","\/\/ Samples: \"hu, en-us;q=0.66, en;q=0.33\", \"hu,en-us;q=0.5\"\n",46],["T_WHITESPACE","    ",47],["T_VARIABLE","$ua_langcodes",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",")",";",["T_WHITESPACE","\n    ",47],["T_IF","if",48],["T_WHITESPACE"," ",48],"(",["T_STRING","preg_match_all",48],"(",["T_CONSTANT_ENCAPSED_STRING","'@(?<=[, ]|^)([a-zA-Z-]+|\\*)(?:;q=([0-9.]+))?(?:$|\\s*,\\s*)@'",48],",",["T_WHITESPACE"," ",48],["T_STRING","trim",48],"(",["T_VARIABLE","$http_accept_language",48],")",",",["T_WHITESPACE"," ",48],["T_VARIABLE","$matches",48],",",["T_WHITESPACE"," ",48],["T_STRING","PREG_SET_ORDER",48],")",")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n      ",48],["T_FOREACH","foreach",49],["T_WHITESPACE"," ",49],"(",["T_VARIABLE","$matches",49],["T_WHITESPACE"," ",49],["T_AS","as",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$match",49],")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n        ",49],["T_IF","if",50],["T_WHITESPACE"," ",50],"(",["T_VARIABLE","$mappings",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n          ",50],["T_VARIABLE","$langcode",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","strtolower",51],"(",["T_VARIABLE","$match",51],"[",["T_LNUMBER","1",51],"]",")",";",["T_WHITESPACE","\n          ",51],["T_FOREACH","foreach",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$mappings",52],["T_WHITESPACE"," ",52],["T_AS","as",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$ua_langcode",52],["T_WHITESPACE"," ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$standard_langcode",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n            ",52],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$langcode",53],["T_WHITESPACE"," ",53],["T_IS_EQUAL","==",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$ua_langcode",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n              ",53],["T_VARIABLE","$match",54],"[",["T_LNUMBER","1",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$standard_langcode",54],";",["T_WHITESPACE","\n            ",54],"}",["T_WHITESPACE","\n          ",55],"}",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n        ",57],["T_COMMENT","\/\/ We can safely use strtolower() here, tags are ASCII.\n",58],["T_WHITESPACE","        ",59],["T_COMMENT","\/\/ RFC2616 mandates that the decimal part is no more than three digits,\n",59],["T_WHITESPACE","        ",60],["T_COMMENT","\/\/ so we multiply the qvalue by 1000 to avoid floating point\n",60],["T_WHITESPACE","        ",61],["T_COMMENT","\/\/ comparisons.\n",61],["T_WHITESPACE","        ",62],["T_VARIABLE","$langcode",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","strtolower",62],"(",["T_VARIABLE","$match",62],"[",["T_LNUMBER","1",62],"]",")",";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$qvalue",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_ISSET","isset",63],"(",["T_VARIABLE","$match",63],"[",["T_LNUMBER","2",63],"]",")",["T_WHITESPACE"," ",63],"?",["T_WHITESPACE"," ",63],["T_DOUBLE_CAST","(float)",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$match",63],"[",["T_LNUMBER","2",63],"]",["T_WHITESPACE"," ",63],":",["T_WHITESPACE"," ",63],["T_LNUMBER","1",63],";",["T_WHITESPACE","\n        ",63],["T_COMMENT","\/\/ Take the highest qvalue for this langcode. Although the request\n",64],["T_WHITESPACE","        ",65],["T_COMMENT","\/\/ supposedly contains unique langcodes, our mapping possibly resolves\n",65],["T_WHITESPACE","        ",66],["T_COMMENT","\/\/ to the same langcode for different qvalues. Keep the highest.\n",66],["T_WHITESPACE","        ",67],["T_VARIABLE","$ua_langcodes",67],"[",["T_VARIABLE","$langcode",67],"]",["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","max",67],"(",["T_WHITESPACE","\n          ",67],["T_INT_CAST","(int)",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$qvalue",68],["T_WHITESPACE"," ",68],"*",["T_WHITESPACE"," ",68],["T_LNUMBER","1000",68],")",",",["T_WHITESPACE","\n          ",68],"(",["T_ISSET","isset",69],"(",["T_VARIABLE","$ua_langcodes",69],"[",["T_VARIABLE","$langcode",69],"]",")",["T_WHITESPACE"," ",69],"?",["T_WHITESPACE"," ",69],["T_VARIABLE","$ua_langcodes",69],"[",["T_VARIABLE","$langcode",69],"]",["T_WHITESPACE"," ",69],":",["T_WHITESPACE"," ",69],["T_LNUMBER","0",69],")",["T_WHITESPACE","\n        ",69],")",";",["T_WHITESPACE","\n      ",70],"}",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_COMMENT","\/\/ We should take pristine values from the HTTP headers, but Internet\n",74],["T_WHITESPACE","    ",75],["T_COMMENT","\/\/ Explorer from version 7 sends only specific language tags (eg. fr-CA)\n",75],["T_WHITESPACE","    ",76],["T_COMMENT","\/\/ without the corresponding generic tag (fr) unless explicitly configured.\n",76],["T_WHITESPACE","    ",77],["T_COMMENT","\/\/ In that case, we assume that the lowest value of the specific tags is the\n",77],["T_WHITESPACE","    ",78],["T_COMMENT","\/\/ value of the generic language to be as close to the HTTP 1.1 spec as\n",78],["T_WHITESPACE","    ",79],["T_COMMENT","\/\/ possible.\n",79],["T_WHITESPACE","    ",80],["T_COMMENT","\/\/ See http:\/\/www.w3.org\/Protocols\/rfc2616\/rfc2616-sec14.html#sec14.4 and\n",80],["T_WHITESPACE","    ",81],["T_COMMENT","\/\/ http:\/\/blogs.msdn.com\/b\/ie\/archive\/2006\/10\/17\/accept-language-header-for-internet-explorer-7.aspx\n",81],["T_WHITESPACE","    ",82],["T_STRING","asort",82],"(",["T_VARIABLE","$ua_langcodes",82],")",";",["T_WHITESPACE","\n    ",82],["T_FOREACH","foreach",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$ua_langcodes",83],["T_WHITESPACE"," ",83],["T_AS","as",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$langcode",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$qvalue",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n      ",83],["T_COMMENT","\/\/ For Chinese languages the generic tag is either zh-hans or zh-hant, so\n",84],["T_WHITESPACE","      ",85],["T_COMMENT","\/\/ we need to handle this separately, we can not split $langcode on the\n",85],["T_WHITESPACE","      ",86],["T_COMMENT","\/\/ first occurrence of '-' otherwise we get a non-existing language zh.\n",86],["T_WHITESPACE","      ",87],["T_COMMENT","\/\/ All other languages use a langcode without a '-', so we can safely\n",87],["T_WHITESPACE","      ",88],["T_COMMENT","\/\/ split on the first occurrence of it.\n",88],["T_WHITESPACE","      ",89],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_STRING","strlen",89],"(",["T_VARIABLE","$langcode",89],")",["T_WHITESPACE"," ",89],">",["T_WHITESPACE"," ",89],["T_LNUMBER","7",89],["T_WHITESPACE"," ",89],["T_BOOLEAN_AND","&&",89],["T_WHITESPACE"," ",89],"(",["T_STRING","substr",89],"(",["T_VARIABLE","$langcode",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","0",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","7",89],")",["T_WHITESPACE"," ",89],["T_IS_EQUAL","==",89],["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'zh-hant'",89],["T_WHITESPACE"," ",89],["T_BOOLEAN_OR","||",89],["T_WHITESPACE"," ",89],["T_STRING","substr",89],"(",["T_VARIABLE","$langcode",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","0",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","7",89],")",["T_WHITESPACE"," ",89],["T_IS_EQUAL","==",89],["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'zh-hans'",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$generic_tag",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","substr",90],"(",["T_VARIABLE","$langcode",90],",",["T_WHITESPACE"," ",90],["T_LNUMBER","0",90],",",["T_WHITESPACE"," ",90],["T_LNUMBER","7",90],")",";",["T_WHITESPACE","\n      ",90],"}",["T_WHITESPACE","\n      ",91],["T_ELSE","else",92],["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$generic_tag",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","strtok",93],"(",["T_VARIABLE","$langcode",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'-'",93],")",";",["T_WHITESPACE","\n      ",93],"}",["T_WHITESPACE","\n      ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_EMPTY","empty",95],"(",["T_VARIABLE","$generic_tag",95],")",["T_WHITESPACE"," ",95],["T_BOOLEAN_AND","&&",95],["T_WHITESPACE"," ",95],"!",["T_ISSET","isset",95],"(",["T_VARIABLE","$ua_langcodes",95],"[",["T_VARIABLE","$generic_tag",95],"]",")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n        ",95],["T_COMMENT","\/\/ Add the generic langcode, but make sure it has a lower qvalue as the\n",96],["T_WHITESPACE","        ",97],["T_COMMENT","\/\/ more specific one, so the more specific one gets selected if it's\n",97],["T_WHITESPACE","        ",98],["T_COMMENT","\/\/ defined by both the user agent and us.\n",98],["T_WHITESPACE","        ",99],["T_VARIABLE","$ua_langcodes",99],"[",["T_VARIABLE","$generic_tag",99],"]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$qvalue",99],["T_WHITESPACE"," ",99],"-",["T_WHITESPACE"," ",99],["T_DNUMBER","0.1",99],";",["T_WHITESPACE","\n      ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_COMMENT","\/\/ Find the added language with the greatest qvalue, following the rules\n",103],["T_WHITESPACE","    ",104],["T_COMMENT","\/\/ of RFC 2616 (section 14.4). If several languages have the same qvalue,\n",104],["T_WHITESPACE","    ",105],["T_COMMENT","\/\/ prefer the one with the greatest weight.\n",105],["T_WHITESPACE","    ",106],["T_VARIABLE","$best_match_langcode",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","FALSE",106],";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$max_qvalue",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_LNUMBER","0",107],";",["T_WHITESPACE","\n    ",107],["T_FOREACH","foreach",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$langcodes",108],["T_WHITESPACE"," ",108],["T_AS","as",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$langcode_case_sensitive",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n      ",108],["T_COMMENT","\/\/ Language tags are case insensitive (RFC2616, sec 3.10).\n",109],["T_WHITESPACE","      ",110],["T_VARIABLE","$langcode",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","strtolower",110],"(",["T_VARIABLE","$langcode_case_sensitive",110],")",";",["T_WHITESPACE","\n\n      ",110],["T_COMMENT","\/\/ If nothing matches below, the default qvalue is the one of the wildcard\n",112],["T_WHITESPACE","      ",113],["T_COMMENT","\/\/ language, if set, or is 0 (which will never match).\n",113],["T_WHITESPACE","      ",114],["T_VARIABLE","$qvalue",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_ISSET","isset",114],"(",["T_VARIABLE","$ua_langcodes",114],"[",["T_CONSTANT_ENCAPSED_STRING","'*'",114],"]",")",["T_WHITESPACE"," ",114],"?",["T_WHITESPACE"," ",114],["T_VARIABLE","$ua_langcodes",114],"[",["T_CONSTANT_ENCAPSED_STRING","'*'",114],"]",["T_WHITESPACE"," ",114],":",["T_WHITESPACE"," ",114],["T_LNUMBER","0",114],";",["T_WHITESPACE","\n\n      ",114],["T_COMMENT","\/\/ Find the longest possible prefix of the user agent supplied language\n",116],["T_WHITESPACE","      ",117],["T_COMMENT","\/\/ ('the language-range') that matches this site language ('the language\n",117],["T_WHITESPACE","      ",118],["T_COMMENT","\/\/ tag').\n",118],["T_WHITESPACE","      ",119],["T_VARIABLE","$prefix",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$langcode",119],";",["T_WHITESPACE","\n      ",119],["T_DO","do",120],["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n        ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_ISSET","isset",121],"(",["T_VARIABLE","$ua_langcodes",121],"[",["T_VARIABLE","$prefix",121],"]",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n          ",121],["T_VARIABLE","$qvalue",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$ua_langcodes",122],"[",["T_VARIABLE","$prefix",122],"]",";",["T_WHITESPACE","\n          ",122],["T_BREAK","break",123],";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n      ",124],"}",["T_WHITESPACE"," ",125],["T_WHILE","while",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$prefix",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","substr",125],"(",["T_VARIABLE","$prefix",125],",",["T_WHITESPACE"," ",125],["T_LNUMBER","0",125],",",["T_WHITESPACE"," ",125],["T_STRING","strrpos",125],"(",["T_VARIABLE","$prefix",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'-'",125],")",")",")",";",["T_WHITESPACE","\n\n      ",125],["T_COMMENT","\/\/ Find the best match.\n",127],["T_WHITESPACE","      ",128],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$qvalue",128],["T_WHITESPACE"," ",128],">",["T_WHITESPACE"," ",128],["T_VARIABLE","$max_qvalue",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$best_match_langcode",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$langcode_case_sensitive",129],";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$max_qvalue",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$qvalue",130],";",["T_WHITESPACE","\n      ",130],"}",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$best_match_langcode",134],";",["T_WHITESPACE","\n  ",134],"}",["T_WHITESPACE","\n\n",135],"}",["T_WHITESPACE","\n",137]]