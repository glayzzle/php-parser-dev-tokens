[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Render",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Cache",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Cache",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Cache",6],["T_NS_SEPARATOR","\\",6],["T_STRING","CacheableMetadata",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Cache",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Context",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CacheContextsManager",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Cache",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CacheFactoryInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Symfony",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Component",9],["T_NS_SEPARATOR","\\",9],["T_STRING","HttpFoundation",9],["T_NS_SEPARATOR","\\",9],["T_STRING","RequestStack",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Wraps the caching logic for the render caching system.\n *\n * @internal\n *\n * @todo Refactor this out into a generic service capable of cache redirects,\n *   and let RenderCache use that. https:\/\/www.drupal.org\/node\/2551419\n *\/",11],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","RenderCache",19],["T_WHITESPACE"," ",19],["T_IMPLEMENTS","implements",19],["T_WHITESPACE"," ",19],["T_STRING","RenderCacheInterface",19],["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n\n  ",19],["T_DOC_COMMENT","\/**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   *\/",21],["T_WHITESPACE","\n  ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$requestStack",26],";",["T_WHITESPACE","\n\n  ",26],["T_DOC_COMMENT","\/**\n   * The cache factory.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheFactoryInterface\n   *\/",28],["T_WHITESPACE","\n  ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$cacheFactory",33],";",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * The cache contexts manager.\n   *\n   * @var \\Drupal\\Core\\Cache\\Context\\CacheContextsManager\n   *\/",35],["T_WHITESPACE","\n  ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$cacheContextsManager",40],";",["T_WHITESPACE","\n\n  ",40],["T_DOC_COMMENT","\/**\n   * Constructs a new RenderCache object.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack.\n   * @param \\Drupal\\Core\\Cache\\CacheFactoryInterface $cache_factory\n   *   The cache factory.\n   * @param \\Drupal\\Core\\Cache\\Context\\CacheContextsManager $cache_contexts_manager\n   *   The cache contexts manager.\n   *\/",42],["T_WHITESPACE","\n  ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","__construct",52],"(",["T_STRING","RequestStack",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$request_stack",52],",",["T_WHITESPACE"," ",52],["T_STRING","CacheFactoryInterface",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$cache_factory",52],",",["T_WHITESPACE"," ",52],["T_STRING","CacheContextsManager",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$cache_contexts_manager",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","requestStack",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$request_stack",53],";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","cacheFactory",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$cache_factory",54],";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","cacheContextsManager",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$cache_contexts_manager",55],";",["T_WHITESPACE","\n  ",55],"}",["T_WHITESPACE","\n\n  ",56],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",58],["T_WHITESPACE","\n  ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","get",61],"(",["T_ARRAY","array",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$elements",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n    ",61],["T_COMMENT","\/\/ Form submissions rely on the form being built during the POST request,\n",62],["T_WHITESPACE","    ",63],["T_COMMENT","\/\/ and render caching of forms prevents this from happening.\n",63],["T_WHITESPACE","    ",64],["T_COMMENT","\/\/ @todo remove the isMethodSafe() check when\n",64],["T_WHITESPACE","    ",65],["T_COMMENT","\/\/       https:\/\/www.drupal.org\/node\/2367555 lands.\n",65],["T_WHITESPACE","    ",66],["T_IF","if",66],["T_WHITESPACE"," ",66],"(","!",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","requestStack",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getCurrentRequest",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","isMethodSafe",66],"(",")",["T_WHITESPACE"," ",66],["T_BOOLEAN_OR","||",66],["T_WHITESPACE"," ",66],"!",["T_VARIABLE","$cid",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","createCacheID",66],"(",["T_VARIABLE","$elements",66],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n      ",66],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_STRING","FALSE",67],";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n    ",68],["T_VARIABLE","$bin",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_ISSET","isset",69],"(",["T_VARIABLE","$elements",69],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",69],"]","[",["T_CONSTANT_ENCAPSED_STRING","'bin'",69],"]",")",["T_WHITESPACE"," ",69],"?",["T_WHITESPACE"," ",69],["T_VARIABLE","$elements",69],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",69],"]","[",["T_CONSTANT_ENCAPSED_STRING","'bin'",69],"]",["T_WHITESPACE"," ",69],":",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'render'",69],";",["T_WHITESPACE","\n\n    ",69],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_EMPTY","empty",71],"(",["T_VARIABLE","$cid",71],")",["T_WHITESPACE"," ",71],["T_BOOLEAN_AND","&&",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$cache_bin",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","cacheFactory",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","get",71],"(",["T_VARIABLE","$bin",71],")",")",["T_WHITESPACE"," ",71],["T_BOOLEAN_AND","&&",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$cache",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$cache_bin",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","get",71],"(",["T_VARIABLE","$cid",71],")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n      ",71],["T_VARIABLE","$cached_element",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$cache",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","data",72],";",["T_WHITESPACE","\n      ",72],["T_COMMENT","\/\/ Two-tier caching: redirect to actual (post-bubbling) cache item.\n",73],["T_WHITESPACE","      ",74],["T_COMMENT","\/\/ @see \\Drupal\\Core\\Render\\RendererInterface::render()\n",74],["T_WHITESPACE","      ",75],["T_COMMENT","\/\/ @see ::set()\n",75],["T_WHITESPACE","      ",76],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_ISSET","isset",76],"(",["T_VARIABLE","$cached_element",76],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_redirect'",76],"]",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n        ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","get",77],"(",["T_VARIABLE","$cached_element",77],")",";",["T_WHITESPACE","\n      ",77],"}",["T_WHITESPACE","\n      ",78],["T_COMMENT","\/\/ Return the cached element.\n",79],["T_WHITESPACE","      ",80],["T_RETURN","return",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$cached_element",80],";",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n    ",81],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_STRING","FALSE",82],";",["T_WHITESPACE","\n  ",82],"}",["T_WHITESPACE","\n\n  ",83],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",85],["T_WHITESPACE","\n  ",87],["T_PUBLIC","public",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","set",88],"(",["T_ARRAY","array",88],["T_WHITESPACE"," ",88],"&",["T_VARIABLE","$elements",88],",",["T_WHITESPACE"," ",88],["T_ARRAY","array",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$pre_bubbling_elements",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n    ",88],["T_COMMENT","\/\/ Form submissions rely on the form being built during the POST request,\n",89],["T_WHITESPACE","    ",90],["T_COMMENT","\/\/ and render caching of forms prevents this from happening.\n",90],["T_WHITESPACE","    ",91],["T_COMMENT","\/\/ @todo remove the isMethodSafe() check when\n",91],["T_WHITESPACE","    ",92],["T_COMMENT","\/\/       https:\/\/www.drupal.org\/node\/2367555 lands.\n",92],["T_WHITESPACE","    ",93],["T_IF","if",93],["T_WHITESPACE"," ",93],"(","!",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","requestStack",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getCurrentRequest",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","isMethodSafe",93],"(",")",["T_WHITESPACE"," ",93],["T_BOOLEAN_OR","||",93],["T_WHITESPACE"," ",93],"!",["T_VARIABLE","$cid",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","createCacheID",93],"(",["T_VARIABLE","$elements",93],")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n      ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_STRING","FALSE",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_VARIABLE","$data",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getCacheableRenderArray",97],"(",["T_VARIABLE","$elements",97],")",";",["T_WHITESPACE","\n\n    ",97],["T_VARIABLE","$bin",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ISSET","isset",99],"(",["T_VARIABLE","$elements",99],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",99],"]","[",["T_CONSTANT_ENCAPSED_STRING","'bin'",99],"]",")",["T_WHITESPACE"," ",99],"?",["T_WHITESPACE"," ",99],["T_VARIABLE","$elements",99],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",99],"]","[",["T_CONSTANT_ENCAPSED_STRING","'bin'",99],"]",["T_WHITESPACE"," ",99],":",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'render'",99],";",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$cache",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","cacheFactory",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","get",100],"(",["T_VARIABLE","$bin",100],")",";",["T_WHITESPACE","\n\n    ",100],["T_COMMENT","\/\/ Calculate the pre-bubbling CID.\n",102],["T_WHITESPACE","    ",103],["T_VARIABLE","$pre_bubbling_cid",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","createCacheID",103],"(",["T_VARIABLE","$pre_bubbling_elements",103],")",";",["T_WHITESPACE","\n\n    ",103],["T_COMMENT","\/\/ Two-tier caching: detect different CID post-bubbling, create redirect,\n",105],["T_WHITESPACE","    ",106],["T_COMMENT","\/\/ update redirect if different set of cache contexts.\n",106],["T_WHITESPACE","    ",107],["T_COMMENT","\/\/ @see \\Drupal\\Core\\Render\\RendererInterface::render()\n",107],["T_WHITESPACE","    ",108],["T_COMMENT","\/\/ @see ::get()\n",108],["T_WHITESPACE","    ",109],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$pre_bubbling_cid",109],["T_WHITESPACE"," ",109],["T_BOOLEAN_AND","&&",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$pre_bubbling_cid",109],["T_WHITESPACE"," ",109],["T_IS_NOT_IDENTICAL","!==",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$cid",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n      ",109],["T_COMMENT","\/\/ The cache redirection strategy we're implementing here is pretty\n",110],["T_WHITESPACE","      ",111],["T_COMMENT","\/\/ simple in concept. Suppose we have the following render structure:\n",111],["T_WHITESPACE","      ",112],["T_COMMENT","\/\/ - A (pre-bubbling, specifies #cache['keys'] = ['foo'])\n",112],["T_WHITESPACE","      ",113],["T_COMMENT","\/\/ -- B (specifies #cache['contexts'] = ['b'])\n",113],["T_WHITESPACE","      ",114],["T_COMMENT","\/\/\n",114],["T_WHITESPACE","      ",115],["T_COMMENT","\/\/ At the time that we're evaluating whether A's rendering can be\n",115],["T_WHITESPACE","      ",116],["T_COMMENT","\/\/ retrieved from cache, we won't know the contexts required by its\n",116],["T_WHITESPACE","      ",117],["T_COMMENT","\/\/ children (the children might not even be built yet), so cacheGet()\n",117],["T_WHITESPACE","      ",118],["T_COMMENT","\/\/ will only be able to get what is cached for a $cid of 'foo'. But at\n",118],["T_WHITESPACE","      ",119],["T_COMMENT","\/\/ the time we're writing to that cache, we do know all the contexts that\n",119],["T_WHITESPACE","      ",120],["T_COMMENT","\/\/ were specified by all children, so what we need is a way to\n",120],["T_WHITESPACE","      ",121],["T_COMMENT","\/\/ persist that information between the cache write and the next cache\n",121],["T_WHITESPACE","      ",122],["T_COMMENT","\/\/ read. So, what we can do is store the following into 'foo':\n",122],["T_WHITESPACE","      ",123],["T_COMMENT","\/\/ [\n",123],["T_WHITESPACE","      ",124],["T_COMMENT","\/\/   '#cache_redirect' => TRUE,\n",124],["T_WHITESPACE","      ",125],["T_COMMENT","\/\/   '#cache' => [\n",125],["T_WHITESPACE","      ",126],["T_COMMENT","\/\/     ...\n",126],["T_WHITESPACE","      ",127],["T_COMMENT","\/\/     'contexts' => ['b'],\n",127],["T_WHITESPACE","      ",128],["T_COMMENT","\/\/   ],\n",128],["T_WHITESPACE","      ",129],["T_COMMENT","\/\/ ]\n",129],["T_WHITESPACE","      ",130],["T_COMMENT","\/\/\n",130],["T_WHITESPACE","      ",131],["T_COMMENT","\/\/ This efficiently lets cacheGet() redirect to a $cid that includes all\n",131],["T_WHITESPACE","      ",132],["T_COMMENT","\/\/ of the required contexts. The strategy is on-demand: in the case where\n",132],["T_WHITESPACE","      ",133],["T_COMMENT","\/\/ there aren't any additional contexts required by children that aren't\n",133],["T_WHITESPACE","      ",134],["T_COMMENT","\/\/ already included in the parent's pre-bubbled #cache information, no\n",134],["T_WHITESPACE","      ",135],["T_COMMENT","\/\/ cache redirection is needed.\n",135],["T_WHITESPACE","      ",136],["T_COMMENT","\/\/\n",136],["T_WHITESPACE","      ",137],["T_COMMENT","\/\/ When implementing this redirection strategy, special care is needed to\n",137],["T_WHITESPACE","      ",138],["T_COMMENT","\/\/ resolve potential cache ping-pong problems. For example, consider the\n",138],["T_WHITESPACE","      ",139],["T_COMMENT","\/\/ following render structure:\n",139],["T_WHITESPACE","      ",140],["T_COMMENT","\/\/ - A (pre-bubbling, specifies #cache['keys'] = ['foo'])\n",140],["T_WHITESPACE","      ",141],["T_COMMENT","\/\/ -- B (pre-bubbling, specifies #cache['contexts'] = ['b'])\n",141],["T_WHITESPACE","      ",142],["T_COMMENT","\/\/ --- C (pre-bubbling, specifies #cache['contexts'] = ['c'])\n",142],["T_WHITESPACE","      ",143],["T_COMMENT","\/\/ --- D (pre-bubbling, specifies #cache['contexts'] = ['d'])\n",143],["T_WHITESPACE","      ",144],["T_COMMENT","\/\/\n",144],["T_WHITESPACE","      ",145],["T_COMMENT","\/\/ Additionally, suppose that:\n",145],["T_WHITESPACE","      ",146],["T_COMMENT","\/\/ - C only exists for a 'b' context value of 'b1'\n",146],["T_WHITESPACE","      ",147],["T_COMMENT","\/\/ - D only exists for a 'b' context value of 'b2'\n",147],["T_WHITESPACE","      ",148],["T_COMMENT","\/\/ This is an acceptable variation, since B specifies that its contents\n",148],["T_WHITESPACE","      ",149],["T_COMMENT","\/\/ vary on context 'b'.\n",149],["T_WHITESPACE","      ",150],["T_COMMENT","\/\/\n",150],["T_WHITESPACE","      ",151],["T_COMMENT","\/\/ A naive implementation of cache redirection would result in the\n",151],["T_WHITESPACE","      ",152],["T_COMMENT","\/\/ following:\n",152],["T_WHITESPACE","      ",153],["T_COMMENT","\/\/ - When a request is processed where context 'b' = 'b1', what would be\n",153],["T_WHITESPACE","      ",154],["T_COMMENT","\/\/   cached for a $pre_bubbling_cid of 'foo' is:\n",154],["T_WHITESPACE","      ",155],["T_COMMENT","\/\/   [\n",155],["T_WHITESPACE","      ",156],["T_COMMENT","\/\/     '#cache_redirect' => TRUE,\n",156],["T_WHITESPACE","      ",157],["T_COMMENT","\/\/     '#cache' => [\n",157],["T_WHITESPACE","      ",158],["T_COMMENT","\/\/       ...\n",158],["T_WHITESPACE","      ",159],["T_COMMENT","\/\/       'contexts' => ['b', 'c'],\n",159],["T_WHITESPACE","      ",160],["T_COMMENT","\/\/     ],\n",160],["T_WHITESPACE","      ",161],["T_COMMENT","\/\/   ]\n",161],["T_WHITESPACE","      ",162],["T_COMMENT","\/\/ - When a request is processed where context 'b' = 'b2', we would\n",162],["T_WHITESPACE","      ",163],["T_COMMENT","\/\/   retrieve the above from cache, but when following that redirection,\n",163],["T_WHITESPACE","      ",164],["T_COMMENT","\/\/   get a cache miss, since we're processing a 'b' context value that\n",164],["T_WHITESPACE","      ",165],["T_COMMENT","\/\/   has not yet been cached. Given the cache miss, we would continue\n",165],["T_WHITESPACE","      ",166],["T_COMMENT","\/\/   with rendering the structure, perform the required context bubbling\n",166],["T_WHITESPACE","      ",167],["T_COMMENT","\/\/   and then overwrite the above item with:\n",167],["T_WHITESPACE","      ",168],["T_COMMENT","\/\/   [\n",168],["T_WHITESPACE","      ",169],["T_COMMENT","\/\/     '#cache_redirect' => TRUE,\n",169],["T_WHITESPACE","      ",170],["T_COMMENT","\/\/     '#cache' => [\n",170],["T_WHITESPACE","      ",171],["T_COMMENT","\/\/       ...\n",171],["T_WHITESPACE","      ",172],["T_COMMENT","\/\/       'contexts' => ['b', 'd'],\n",172],["T_WHITESPACE","      ",173],["T_COMMENT","\/\/     ],\n",173],["T_WHITESPACE","      ",174],["T_COMMENT","\/\/   ]\n",174],["T_WHITESPACE","      ",175],["T_COMMENT","\/\/ - Now, if a request comes in where context 'b' = 'b1' again, the above\n",175],["T_WHITESPACE","      ",176],["T_COMMENT","\/\/   would redirect to a cache key that doesn't exist, since we have not\n",176],["T_WHITESPACE","      ",177],["T_COMMENT","\/\/   yet cached an item that includes 'b'='b1' and something for 'd'. So\n",177],["T_WHITESPACE","      ",178],["T_COMMENT","\/\/   we would process this request as a cache miss, at the end of which,\n",178],["T_WHITESPACE","      ",179],["T_COMMENT","\/\/   we would overwrite the above item back to:\n",179],["T_WHITESPACE","      ",180],["T_COMMENT","\/\/   [\n",180],["T_WHITESPACE","      ",181],["T_COMMENT","\/\/     '#cache_redirect' => TRUE,\n",181],["T_WHITESPACE","      ",182],["T_COMMENT","\/\/     '#cache' => [\n",182],["T_WHITESPACE","      ",183],["T_COMMENT","\/\/       ...\n",183],["T_WHITESPACE","      ",184],["T_COMMENT","\/\/       'contexts' => ['b', 'c'],\n",184],["T_WHITESPACE","      ",185],["T_COMMENT","\/\/     ],\n",185],["T_WHITESPACE","      ",186],["T_COMMENT","\/\/   ]\n",186],["T_WHITESPACE","      ",187],["T_COMMENT","\/\/ - The above would always result in accurate renderings, but would\n",187],["T_WHITESPACE","      ",188],["T_COMMENT","\/\/   result in poor performance as we keep processing requests as cache\n",188],["T_WHITESPACE","      ",189],["T_COMMENT","\/\/   misses even though the target of the redirection is cached, and\n",189],["T_WHITESPACE","      ",190],["T_COMMENT","\/\/   it's only the redirection element itself that is creating the\n",190],["T_WHITESPACE","      ",191],["T_COMMENT","\/\/   ping-pong problem.\n",191],["T_WHITESPACE","      ",192],["T_COMMENT","\/\/\n",192],["T_WHITESPACE","      ",193],["T_COMMENT","\/\/ A way to resolve the ping-pong problem is to eventually reach a cache\n",193],["T_WHITESPACE","      ",194],["T_COMMENT","\/\/ state where the redirection element includes all of the contexts used\n",194],["T_WHITESPACE","      ",195],["T_COMMENT","\/\/ throughout all requests:\n",195],["T_WHITESPACE","      ",196],["T_COMMENT","\/\/ [\n",196],["T_WHITESPACE","      ",197],["T_COMMENT","\/\/   '#cache_redirect' => TRUE,\n",197],["T_WHITESPACE","      ",198],["T_COMMENT","\/\/   '#cache' => [\n",198],["T_WHITESPACE","      ",199],["T_COMMENT","\/\/     ...\n",199],["T_WHITESPACE","      ",200],["T_COMMENT","\/\/     'contexts' => ['b', 'c', 'd'],\n",200],["T_WHITESPACE","      ",201],["T_COMMENT","\/\/   ],\n",201],["T_WHITESPACE","      ",202],["T_COMMENT","\/\/ ]\n",202],["T_WHITESPACE","      ",203],["T_COMMENT","\/\/\n",203],["T_WHITESPACE","      ",204],["T_COMMENT","\/\/ We can't reach that state right away, since we don't know what the\n",204],["T_WHITESPACE","      ",205],["T_COMMENT","\/\/ result of future requests will be, but we can incrementally move\n",205],["T_WHITESPACE","      ",206],["T_COMMENT","\/\/ towards that state by progressively merging the 'contexts' value\n",206],["T_WHITESPACE","      ",207],["T_COMMENT","\/\/ across requests. That's the strategy employed below and tested in\n",207],["T_WHITESPACE","      ",208],["T_COMMENT","\/\/ \\Drupal\\Tests\\Core\\Render\\RendererBubblingTest::testConditionalCacheContextBubblingSelfHealing().\n",208],["T_WHITESPACE","\n      ",209],["T_COMMENT","\/\/ Get the cacheability of this element according to the current (stored)\n",210],["T_WHITESPACE","      ",211],["T_COMMENT","\/\/ redirecting cache item, if any.\n",211],["T_WHITESPACE","      ",212],["T_VARIABLE","$redirect_cacheability",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_NEW","new",212],["T_WHITESPACE"," ",212],["T_STRING","CacheableMetadata",212],"(",")",";",["T_WHITESPACE","\n      ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$stored_cache_redirect",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$cache",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","get",213],"(",["T_VARIABLE","$pre_bubbling_cid",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$redirect_cacheability",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_STRING","CacheableMetadata",214],["T_DOUBLE_COLON","::",214],["T_STRING","createFromRenderArray",214],"(",["T_VARIABLE","$stored_cache_redirect",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","data",214],")",";",["T_WHITESPACE","\n      ",214],"}",["T_WHITESPACE","\n\n      ",215],["T_COMMENT","\/\/ Calculate the union of the cacheability for this request and the\n",217],["T_WHITESPACE","      ",218],["T_COMMENT","\/\/ current (stored) redirecting cache item. We need:\n",218],["T_WHITESPACE","      ",219],["T_COMMENT","\/\/ - the union of cache contexts, because that is how we know which cache\n",219],["T_WHITESPACE","      ",220],["T_COMMENT","\/\/   item to redirect to;\n",220],["T_WHITESPACE","      ",221],["T_COMMENT","\/\/ - the union of cache tags, because that is how we know when the cache\n",221],["T_WHITESPACE","      ",222],["T_COMMENT","\/\/   redirect cache item itself is invalidated;\n",222],["T_WHITESPACE","      ",223],["T_COMMENT","\/\/ - the union of max ages, because that is how we know when the cache\n",223],["T_WHITESPACE","      ",224],["T_COMMENT","\/\/   redirect cache item itself becomes stale. (Without this, we might end\n",224],["T_WHITESPACE","      ",225],["T_COMMENT","\/\/   up toggling between a permanently and a briefly cacheable cache\n",225],["T_WHITESPACE","      ",226],["T_COMMENT","\/\/   redirect, because the last update's max-age would always \"win\".)\n",226],["T_WHITESPACE","      ",227],["T_VARIABLE","$redirect_cacheability_updated",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","CacheableMetadata",227],["T_DOUBLE_COLON","::",227],["T_STRING","createFromRenderArray",227],"(",["T_VARIABLE","$data",227],")",["T_OBJECT_OPERATOR","->",227],["T_STRING","merge",227],"(",["T_VARIABLE","$redirect_cacheability",227],")",";",["T_WHITESPACE","\n\n      ",227],["T_COMMENT","\/\/ Stored cache contexts incomplete: this request causes cache contexts to\n",229],["T_WHITESPACE","      ",230],["T_COMMENT","\/\/ be added to the redirecting cache item.\n",230],["T_WHITESPACE","      ",231],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_STRING","array_diff",231],"(",["T_VARIABLE","$redirect_cacheability_updated",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getCacheContexts",231],"(",")",",",["T_WHITESPACE"," ",231],["T_VARIABLE","$redirect_cacheability",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getCacheContexts",231],"(",")",")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$redirect_data",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],"[",["T_WHITESPACE","\n          ",232],["T_CONSTANT_ENCAPSED_STRING","'#cache_redirect'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_STRING","TRUE",233],",",["T_WHITESPACE","\n          ",233],["T_CONSTANT_ENCAPSED_STRING","'#cache'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],"[",["T_WHITESPACE","\n            ",234],["T_COMMENT","\/\/ The cache keys of the current element; this remains the same\n",235],["T_WHITESPACE","            ",236],["T_COMMENT","\/\/ across requests.\n",236],["T_WHITESPACE","            ",237],["T_CONSTANT_ENCAPSED_STRING","'keys'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$elements",237],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",237],"]","[",["T_CONSTANT_ENCAPSED_STRING","'keys'",237],"]",",",["T_WHITESPACE","\n            ",237],["T_COMMENT","\/\/ The union of the current element's and stored cache contexts.\n",238],["T_WHITESPACE","            ",239],["T_CONSTANT_ENCAPSED_STRING","'contexts'",239],["T_WHITESPACE"," ",239],["T_DOUBLE_ARROW","=>",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$redirect_cacheability_updated",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getCacheContexts",239],"(",")",",",["T_WHITESPACE","\n            ",239],["T_COMMENT","\/\/ The union of the current element's and stored cache tags.\n",240],["T_WHITESPACE","            ",241],["T_CONSTANT_ENCAPSED_STRING","'tags'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$redirect_cacheability_updated",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getCacheTags",241],"(",")",",",["T_WHITESPACE","\n            ",241],["T_COMMENT","\/\/ The union of the current element's and stored cache max-ages.\n",242],["T_WHITESPACE","            ",243],["T_CONSTANT_ENCAPSED_STRING","'max-age'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$redirect_cacheability_updated",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getCacheMaxAge",243],"(",")",",",["T_WHITESPACE","\n            ",243],["T_COMMENT","\/\/ The same cache bin as the one for the actual render cache items.\n",244],["T_WHITESPACE","            ",245],["T_CONSTANT_ENCAPSED_STRING","'bin'",245],["T_WHITESPACE"," ",245],["T_DOUBLE_ARROW","=>",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$bin",245],",",["T_WHITESPACE","\n          ",245],"]",",",["T_WHITESPACE","\n        ",246],"]",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$cache",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","set",248],"(",["T_VARIABLE","$pre_bubbling_cid",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$redirect_data",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","maxAgeToExpire",248],"(",["T_VARIABLE","$redirect_cacheability_updated",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getCacheMaxAge",248],"(",")",")",",",["T_WHITESPACE"," ",248],["T_STRING","Cache",248],["T_DOUBLE_COLON","::",248],["T_STRING","mergeTags",248],"(",["T_VARIABLE","$redirect_data",248],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",248],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tags'",248],"]",",",["T_WHITESPACE"," ",248],"[",["T_CONSTANT_ENCAPSED_STRING","'rendered'",248],"]",")",")",";",["T_WHITESPACE","\n      ",248],"}",["T_WHITESPACE","\n\n      ",249],["T_COMMENT","\/\/ Current cache contexts incomplete: this request only uses a subset of\n",251],["T_WHITESPACE","      ",252],["T_COMMENT","\/\/ the cache contexts stored in the redirecting cache item. Vary by these\n",252],["T_WHITESPACE","      ",253],["T_COMMENT","\/\/ additional (conditional) cache contexts as well, otherwise the\n",253],["T_WHITESPACE","      ",254],["T_COMMENT","\/\/ redirecting cache item would be pointing to a cache item that can never\n",254],["T_WHITESPACE","      ",255],["T_COMMENT","\/\/ exist.\n",255],["T_WHITESPACE","      ",256],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_STRING","array_diff",256],"(",["T_VARIABLE","$redirect_cacheability_updated",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getCacheContexts",256],"(",")",",",["T_WHITESPACE"," ",256],["T_VARIABLE","$data",256],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",256],"]","[",["T_CONSTANT_ENCAPSED_STRING","'contexts'",256],"]",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n        ",256],["T_COMMENT","\/\/ Recalculate the cache ID.\n",257],["T_WHITESPACE","        ",258],["T_VARIABLE","$recalculated_cid_pseudo_element",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],"[",["T_WHITESPACE","\n          ",258],["T_CONSTANT_ENCAPSED_STRING","'#cache'",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],"[",["T_WHITESPACE","\n            ",259],["T_CONSTANT_ENCAPSED_STRING","'keys'",260],["T_WHITESPACE"," ",260],["T_DOUBLE_ARROW","=>",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$elements",260],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",260],"]","[",["T_CONSTANT_ENCAPSED_STRING","'keys'",260],"]",",",["T_WHITESPACE","\n            ",260],["T_CONSTANT_ENCAPSED_STRING","'contexts'",261],["T_WHITESPACE"," ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$redirect_cacheability_updated",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getCacheContexts",261],"(",")",",",["T_WHITESPACE","\n          ",261],"]",["T_WHITESPACE","\n        ",262],"]",";",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$cid",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","createCacheID",264],"(",["T_VARIABLE","$recalculated_cid_pseudo_element",264],")",";",["T_WHITESPACE","\n        ",264],["T_COMMENT","\/\/ Ensure the about-to-be-cached data uses the merged cache contexts.\n",265],["T_WHITESPACE","        ",266],["T_VARIABLE","$data",266],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",266],"]","[",["T_CONSTANT_ENCAPSED_STRING","'contexts'",266],"]",["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$redirect_cacheability_updated",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getCacheContexts",266],"(",")",";",["T_WHITESPACE","\n      ",266],"}",["T_WHITESPACE","\n    ",267],"}",["T_WHITESPACE","\n    ",268],["T_VARIABLE","$cache",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","set",269],"(",["T_VARIABLE","$cid",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$data",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","maxAgeToExpire",269],"(",["T_VARIABLE","$elements",269],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",269],"]","[",["T_CONSTANT_ENCAPSED_STRING","'max-age'",269],"]",")",",",["T_WHITESPACE"," ",269],["T_STRING","Cache",269],["T_DOUBLE_COLON","::",269],["T_STRING","mergeTags",269],"(",["T_VARIABLE","$data",269],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",269],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tags'",269],"]",",",["T_WHITESPACE"," ",269],"[",["T_CONSTANT_ENCAPSED_STRING","'rendered'",269],"]",")",")",";",["T_WHITESPACE","\n  ",269],"}",["T_WHITESPACE","\n\n  ",270],["T_DOC_COMMENT","\/**\n   * Maps a #cache[max-age] value to an \"expire\" value for the Cache API.\n   *\n   * @param int $max_age\n   *   A #cache[max-age] value.\n   *\n   * @return int\n   *   A corresponding \"expire\" value.\n   *\n   * @see \\Drupal\\Core\\Cache\\CacheBackendInterface::set()\n   *\/",272],["T_WHITESPACE","\n  ",282],["T_PROTECTED","protected",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","maxAgeToExpire",283],"(",["T_VARIABLE","$max_age",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n    ",283],["T_RETURN","return",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$max_age",284],["T_WHITESPACE"," ",284],["T_IS_IDENTICAL","===",284],["T_WHITESPACE"," ",284],["T_STRING","Cache",284],["T_DOUBLE_COLON","::",284],["T_STRING","PERMANENT",284],")",["T_WHITESPACE"," ",284],"?",["T_WHITESPACE"," ",284],["T_STRING","Cache",284],["T_DOUBLE_COLON","::",284],["T_STRING","PERMANENT",284],["T_WHITESPACE"," ",284],":",["T_WHITESPACE"," ",284],["T_INT_CAST","(int)",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","requestStack",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getMasterRequest",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","server",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","get",284],"(",["T_CONSTANT_ENCAPSED_STRING","'REQUEST_TIME'",284],")",["T_WHITESPACE"," ",284],"+",["T_WHITESPACE"," ",284],["T_VARIABLE","$max_age",284],";",["T_WHITESPACE","\n  ",284],"}",["T_WHITESPACE","\n\n  ",285],["T_DOC_COMMENT","\/**\n   * Creates the cache ID for a renderable element.\n   *\n   * Creates the cache ID string based on #cache['keys'] + #cache['contexts'].\n   *\n   * @param array &$elements\n   *   A renderable array.\n   *\n   * @return string\n   *   The cache ID string, or FALSE if the element may not be cached.\n   *\/",287],["T_WHITESPACE","\n  ",297],["T_PROTECTED","protected",298],["T_WHITESPACE"," ",298],["T_FUNCTION","function",298],["T_WHITESPACE"," ",298],["T_STRING","createCacheID",298],"(",["T_ARRAY","array",298],["T_WHITESPACE"," ",298],"&",["T_VARIABLE","$elements",298],")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n    ",298],["T_COMMENT","\/\/ If the maximum age is zero, then caching is effectively prohibited.\n",299],["T_WHITESPACE","    ",300],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_ISSET","isset",300],"(",["T_VARIABLE","$elements",300],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",300],"]","[",["T_CONSTANT_ENCAPSED_STRING","'max-age'",300],"]",")",["T_WHITESPACE"," ",300],["T_BOOLEAN_AND","&&",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$elements",300],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",300],"]","[",["T_CONSTANT_ENCAPSED_STRING","'max-age'",300],"]",["T_WHITESPACE"," ",300],["T_IS_IDENTICAL","===",300],["T_WHITESPACE"," ",300],["T_LNUMBER","0",300],")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n      ",300],["T_RETURN","return",301],["T_WHITESPACE"," ",301],["T_STRING","FALSE",301],";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n\n    ",302],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_ISSET","isset",304],"(",["T_VARIABLE","$elements",304],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",304],"]","[",["T_CONSTANT_ENCAPSED_STRING","'keys'",304],"]",")",")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n      ",304],["T_VARIABLE","$cid_parts",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$elements",305],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",305],"]","[",["T_CONSTANT_ENCAPSED_STRING","'keys'",305],"]",";",["T_WHITESPACE","\n      ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(","!",["T_EMPTY","empty",306],"(",["T_VARIABLE","$elements",306],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",306],"]","[",["T_CONSTANT_ENCAPSED_STRING","'contexts'",306],"]",")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$context_cache_keys",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","cacheContextsManager",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","convertTokensToKeys",307],"(",["T_VARIABLE","$elements",307],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",307],"]","[",["T_CONSTANT_ENCAPSED_STRING","'contexts'",307],"]",")",";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$cid_parts",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_STRING","array_merge",308],"(",["T_VARIABLE","$cid_parts",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$context_cache_keys",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getKeys",308],"(",")",")",";",["T_WHITESPACE","\n        ",308],["T_STRING","CacheableMetadata",309],["T_DOUBLE_COLON","::",309],["T_STRING","createFromRenderArray",309],"(",["T_VARIABLE","$elements",309],")",["T_WHITESPACE","\n          ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","merge",310],"(",["T_VARIABLE","$context_cache_keys",310],")",["T_WHITESPACE","\n          ",310],["T_OBJECT_OPERATOR","->",311],["T_STRING","applyTo",311],"(",["T_VARIABLE","$elements",311],")",";",["T_WHITESPACE","\n      ",311],"}",["T_WHITESPACE","\n      ",312],["T_RETURN","return",313],["T_WHITESPACE"," ",313],["T_STRING","implode",313],"(",["T_CONSTANT_ENCAPSED_STRING","':'",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$cid_parts",313],")",";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n    ",314],["T_RETURN","return",315],["T_WHITESPACE"," ",315],["T_STRING","FALSE",315],";",["T_WHITESPACE","\n  ",315],"}",["T_WHITESPACE","\n\n  ",316],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",318],["T_WHITESPACE","\n  ",320],["T_PUBLIC","public",321],["T_WHITESPACE"," ",321],["T_FUNCTION","function",321],["T_WHITESPACE"," ",321],["T_STRING","getCacheableRenderArray",321],"(",["T_ARRAY","array",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$elements",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n    ",321],["T_VARIABLE","$data",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],"[",["T_WHITESPACE","\n      ",322],["T_CONSTANT_ENCAPSED_STRING","'#markup'",323],["T_WHITESPACE"," ",323],["T_DOUBLE_ARROW","=>",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$elements",323],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",323],"]",",",["T_WHITESPACE","\n      ",323],["T_CONSTANT_ENCAPSED_STRING","'#attached'",324],["T_WHITESPACE"," ",324],["T_DOUBLE_ARROW","=>",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$elements",324],"[",["T_CONSTANT_ENCAPSED_STRING","'#attached'",324],"]",",",["T_WHITESPACE","\n      ",324],["T_CONSTANT_ENCAPSED_STRING","'#cache'",325],["T_WHITESPACE"," ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],"[",["T_WHITESPACE","\n        ",325],["T_CONSTANT_ENCAPSED_STRING","'contexts'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$elements",326],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",326],"]","[",["T_CONSTANT_ENCAPSED_STRING","'contexts'",326],"]",",",["T_WHITESPACE","\n        ",326],["T_CONSTANT_ENCAPSED_STRING","'tags'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$elements",327],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",327],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tags'",327],"]",",",["T_WHITESPACE","\n        ",327],["T_CONSTANT_ENCAPSED_STRING","'max-age'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$elements",328],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache'",328],"]","[",["T_CONSTANT_ENCAPSED_STRING","'max-age'",328],"]",",",["T_WHITESPACE","\n      ",328],"]",",",["T_WHITESPACE","\n    ",329],"]",";",["T_WHITESPACE","\n\n    ",330],["T_COMMENT","\/\/ Preserve cacheable items if specified. If we are preserving any cacheable\n",332],["T_WHITESPACE","    ",333],["T_COMMENT","\/\/ children of the element, we assume we are only interested in their\n",333],["T_WHITESPACE","    ",334],["T_COMMENT","\/\/ individual markup and not the parent's one, thus we empty it to minimize\n",334],["T_WHITESPACE","    ",335],["T_COMMENT","\/\/ the cache entry size.\n",335],["T_WHITESPACE","    ",336],["T_IF","if",336],["T_WHITESPACE"," ",336],"(","!",["T_EMPTY","empty",336],"(",["T_VARIABLE","$elements",336],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_properties'",336],"]",")",["T_WHITESPACE"," ",336],["T_BOOLEAN_AND","&&",336],["T_WHITESPACE"," ",336],["T_STRING","is_array",336],"(",["T_VARIABLE","$elements",336],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_properties'",336],"]",")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n      ",336],["T_VARIABLE","$data",337],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_properties'",337],"]",["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$elements",337],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_properties'",337],"]",";",["T_WHITESPACE","\n\n      ",337],["T_COMMENT","\/\/ Extract all the cacheable items from the element using cache\n",339],["T_WHITESPACE","      ",340],["T_COMMENT","\/\/ properties.\n",340],["T_WHITESPACE","      ",341],["T_VARIABLE","$cacheable_items",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING","array_intersect_key",341],"(",["T_VARIABLE","$elements",341],",",["T_WHITESPACE"," ",341],["T_STRING","array_flip",341],"(",["T_VARIABLE","$elements",341],"[",["T_CONSTANT_ENCAPSED_STRING","'#cache_properties'",341],"]",")",")",";",["T_WHITESPACE","\n      ",341],["T_VARIABLE","$cacheable_children",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_STRING","Element",342],["T_DOUBLE_COLON","::",342],["T_STRING","children",342],"(",["T_VARIABLE","$cacheable_items",342],")",";",["T_WHITESPACE","\n      ",342],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$cacheable_children",343],")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$data",344],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",344],"]",["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","''",344],";",["T_WHITESPACE","\n        ",344],["T_COMMENT","\/\/ Cache only cacheable children's markup.\n",345],["T_WHITESPACE","        ",346],["T_FOREACH","foreach",346],["T_WHITESPACE"," ",346],"(",["T_VARIABLE","$cacheable_children",346],["T_WHITESPACE"," ",346],["T_AS","as",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$key",346],")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n          ",346],["T_COMMENT","\/\/ We can assume that #markup is safe at this point.\n",347],["T_WHITESPACE","          ",348],["T_VARIABLE","$cacheable_items",348],"[",["T_VARIABLE","$key",348],"]",["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_STRING","Markup",348],["T_DOUBLE_COLON","::",348],["T_STRING","create",348],"(",["T_VARIABLE","$cacheable_items",348],"[",["T_VARIABLE","$key",348],"]","[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",348],"]",")","]",";",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE","\n      ",349],"}",["T_WHITESPACE","\n      ",350],["T_VARIABLE","$data",351],["T_WHITESPACE"," ",351],["T_PLUS_EQUAL","+=",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$cacheable_items",351],";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_VARIABLE","$data",354],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",354],"]",["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_STRING","Markup",354],["T_DOUBLE_COLON","::",354],["T_STRING","create",354],"(",["T_VARIABLE","$data",354],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",354],"]",")",";",["T_WHITESPACE","\n    ",354],["T_RETURN","return",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$data",355],";",["T_WHITESPACE","\n  ",355],"}",["T_WHITESPACE","\n\n",356],"}",["T_WHITESPACE","\n",358]]