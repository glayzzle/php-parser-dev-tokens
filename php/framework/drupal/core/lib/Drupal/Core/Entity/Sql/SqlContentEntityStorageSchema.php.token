[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Sql",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Connection",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","DatabaseException",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DependencyInjection",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DependencySerializationTrait",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Entity",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ContentEntityTypeInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Entity",9],["T_NS_SEPARATOR","\\",9],["T_STRING","EntityManagerInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Entity",10],["T_NS_SEPARATOR","\\",10],["T_STRING","EntityStorageException",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Entity",11],["T_NS_SEPARATOR","\\",11],["T_STRING","EntityTypeInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Drupal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Core",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Entity",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Exception",12],["T_NS_SEPARATOR","\\",12],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Drupal",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Core",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Entity",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Schema",13],["T_NS_SEPARATOR","\\",13],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Drupal",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Core",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Field",14],["T_NS_SEPARATOR","\\",14],["T_STRING","FieldException",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Drupal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Core",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Field",15],["T_NS_SEPARATOR","\\",15],["T_STRING","FieldStorageDefinitionInterface",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Drupal",16],["T_NS_SEPARATOR","\\",16],["T_STRING","field",16],["T_NS_SEPARATOR","\\",16],["T_STRING","FieldStorageConfigInterface",16],";",["T_WHITESPACE","\n\n",16],["T_DOC_COMMENT","\/**\n * Defines a schema handler that supports revisionable, translatable entities.\n *\n * Entity types may extend this class and optimize the generated schema for all\n * entity base tables by overriding getEntitySchema() for cross-field\n * optimizations and getSharedTableFieldSchema() for optimizations applying to\n * a single field.\n *\/",18],["T_WHITESPACE","\n",25],["T_CLASS","class",26],["T_WHITESPACE"," ",26],["T_STRING","SqlContentEntityStorageSchema",26],["T_WHITESPACE"," ",26],["T_IMPLEMENTS","implements",26],["T_WHITESPACE"," ",26],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",26],["T_WHITESPACE"," ",26],"{",["T_WHITESPACE","\n\n  ",26],["T_USE","use",28],["T_WHITESPACE"," ",28],["T_STRING","DependencySerializationTrait",28],";",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * The entity manager.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",30],["T_WHITESPACE","\n  ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$entityManager",35],";",["T_WHITESPACE","\n\n  ",35],["T_DOC_COMMENT","\/**\n   * The entity type this schema builder is responsible for.\n   *\n   * @var \\Drupal\\Core\\Entity\\ContentEntityTypeInterface\n   *\/",37],["T_WHITESPACE","\n  ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$entityType",42],";",["T_WHITESPACE","\n\n  ",42],["T_DOC_COMMENT","\/**\n   * The storage field definitions for this entity type.\n   *\n   * @var \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface[]\n   *\/",44],["T_WHITESPACE","\n  ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$fieldStorageDefinitions",49],";",["T_WHITESPACE","\n\n  ",49],["T_DOC_COMMENT","\/**\n   * The original storage field definitions for this entity type. Used during\n   * field schema updates.\n   *\n   * @var \\Drupal\\Core\\Field\\FieldDefinitionInterface[]\n   *\/",51],["T_WHITESPACE","\n  ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$originalDefinitions",57],";",["T_WHITESPACE","\n\n  ",57],["T_DOC_COMMENT","\/**\n   * The storage object for the given entity type.\n   *\n   * @var \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage\n   *\/",59],["T_WHITESPACE","\n  ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$storage",64],";",["T_WHITESPACE","\n\n  ",64],["T_DOC_COMMENT","\/**\n   * A static cache of the generated schema array.\n   *\n   * @var array\n   *\/",66],["T_WHITESPACE","\n  ",70],["T_PROTECTED","protected",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$schema",71],";",["T_WHITESPACE","\n\n  ",71],["T_DOC_COMMENT","\/**\n   * The database connection to be used.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",73],["T_WHITESPACE","\n  ",77],["T_PROTECTED","protected",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$database",78],";",["T_WHITESPACE","\n\n  ",78],["T_DOC_COMMENT","\/**\n   * The key-value collection for tracking installed storage schema.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueStoreInterface\n   *\/",80],["T_WHITESPACE","\n  ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$installedStorageSchema",85],";",["T_WHITESPACE","\n\n  ",85],["T_DOC_COMMENT","\/**\n   * Constructs a SqlContentEntityStorageSchema.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityManagerInterface $entity_manager\n   *   The entity manager.\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorage $storage\n   *   The storage of the entity type. This must be an SQL-based storage.\n   * @param \\Drupal\\Core\\Database\\Connection $database\n   *   The database connection to be used.\n   *\/",87],["T_WHITESPACE","\n  ",98],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","__construct",99],"(",["T_STRING","EntityManagerInterface",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$entity_manager",99],",",["T_WHITESPACE"," ",99],["T_STRING","ContentEntityTypeInterface",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$entity_type",99],",",["T_WHITESPACE"," ",99],["T_STRING","SqlContentEntityStorage",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$storage",99],",",["T_WHITESPACE"," ",99],["T_STRING","Connection",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$database",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","entityManager",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$entity_manager",100],";",["T_WHITESPACE","\n    ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","entityType",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$entity_type",101],";",["T_WHITESPACE","\n    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","fieldStorageDefinitions",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$entity_manager",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getFieldStorageDefinitions",102],"(",["T_VARIABLE","$entity_type",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","id",102],"(",")",")",";",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","storage",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$storage",103],";",["T_WHITESPACE","\n    ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","database",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$database",104],";",["T_WHITESPACE","\n  ",104],"}",["T_WHITESPACE","\n\n  ",105],["T_DOC_COMMENT","\/**\n   * Gets the keyvalue collection for tracking the installed schema.\n   *\n   * @return \\Drupal\\Core\\KeyValueStore\\KeyValueStoreInterface\n   *\n   * @todo Inject this dependency in the constructor once this class can be\n   *   instantiated as a regular entity handler:\n   *   https:\/\/www.drupal.org\/node\/2332857.\n   *\/",107],["T_WHITESPACE","\n  ",115],["T_PROTECTED","protected",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","installedStorageSchema",116],"(",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n    ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(","!",["T_ISSET","isset",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","installedStorageSchema",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n      ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","installedStorageSchema",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Drupal",118],["T_DOUBLE_COLON","::",118],["T_STRING","keyValue",118],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.storage_schema.sql'",118],")",";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n    ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","installedStorageSchema",120],";",["T_WHITESPACE","\n  ",120],"}",["T_WHITESPACE","\n\n  ",121],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",123],["T_WHITESPACE","\n  ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","requiresEntityStorageSchemaChanges",126],"(",["T_STRING","EntityTypeInterface",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$entity_type",126],",",["T_WHITESPACE"," ",126],["T_STRING","EntityTypeInterface",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$original",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n    ",126],["T_RETURN","return",127],["T_WHITESPACE","\n      ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","hasSharedTableStructureChange",128],"(",["T_VARIABLE","$entity_type",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$original",128],")",["T_WHITESPACE"," ",128],["T_BOOLEAN_OR","||",128],["T_WHITESPACE","\n      ",128],["T_COMMENT","\/\/ Detect changes in key or index definitions.\n",129],["T_WHITESPACE","      ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getEntitySchemaData",130],"(",["T_VARIABLE","$entity_type",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getEntitySchema",130],"(",["T_VARIABLE","$entity_type",130],",",["T_WHITESPACE"," ",130],["T_STRING","TRUE",130],")",")",["T_WHITESPACE"," ",130],["T_IS_NOT_EQUAL","!=",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","loadEntitySchemaData",130],"(",["T_VARIABLE","$original",130],")",";",["T_WHITESPACE","\n  ",130],"}",["T_WHITESPACE","\n\n  ",131],["T_DOC_COMMENT","\/**\n   * Detects whether there is a change in the shared table structure.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The new entity type.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The origin entity type.\n   *\n   * @return bool\n   *   Returns TRUE if either the revisionable or translatable flag changes or\n   *   a table has been renamed.\n   *\/",133],["T_WHITESPACE","\n  ",144],["T_PROTECTED","protected",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","hasSharedTableStructureChange",145],"(",["T_STRING","EntityTypeInterface",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$entity_type",145],",",["T_WHITESPACE"," ",145],["T_STRING","EntityTypeInterface",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$original",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n    ",145],["T_RETURN","return",146],["T_WHITESPACE","\n      ",146],["T_VARIABLE","$entity_type",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","isRevisionable",147],"(",")",["T_WHITESPACE"," ",147],["T_IS_NOT_EQUAL","!=",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$original",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","isRevisionable",147],"(",")",["T_WHITESPACE"," ",147],["T_BOOLEAN_OR","||",147],["T_WHITESPACE","\n      ",147],["T_VARIABLE","$entity_type",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","isTranslatable",148],"(",")",["T_WHITESPACE"," ",148],["T_IS_NOT_EQUAL","!=",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$original",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","isTranslatable",148],"(",")",["T_WHITESPACE"," ",148],["T_BOOLEAN_OR","||",148],["T_WHITESPACE","\n      ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","hasSharedTableNameChanges",149],"(",["T_VARIABLE","$entity_type",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$original",149],")",";",["T_WHITESPACE","\n  ",149],"}",["T_WHITESPACE","\n\n  ",150],["T_DOC_COMMENT","\/**\n   * Detects whether any table name got renamed in an entity type update.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The new entity type.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The origin entity type.\n   *\n   * @return bool\n   *   Returns TRUE if there have been changes.\n   *\/",152],["T_WHITESPACE","\n  ",162],["T_PROTECTED","protected",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","hasSharedTableNameChanges",163],"(",["T_STRING","EntityTypeInterface",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$entity_type",163],",",["T_WHITESPACE"," ",163],["T_STRING","EntityTypeInterface",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$original",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n    ",163],["T_RETURN","return",164],["T_WHITESPACE","\n      ",164],["T_VARIABLE","$entity_type",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getBaseTable",165],"(",")",["T_WHITESPACE"," ",165],["T_IS_NOT_EQUAL","!=",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$original",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getBaseTable",165],"(",")",["T_WHITESPACE"," ",165],["T_BOOLEAN_OR","||",165],["T_WHITESPACE","\n      ",165],["T_VARIABLE","$entity_type",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getDataTable",166],"(",")",["T_WHITESPACE"," ",166],["T_IS_NOT_EQUAL","!=",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$original",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getDataTable",166],"(",")",["T_WHITESPACE"," ",166],["T_BOOLEAN_OR","||",166],["T_WHITESPACE","\n      ",166],["T_VARIABLE","$entity_type",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getRevisionTable",167],"(",")",["T_WHITESPACE"," ",167],["T_IS_NOT_EQUAL","!=",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$original",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getRevisionTable",167],"(",")",["T_WHITESPACE"," ",167],["T_BOOLEAN_OR","||",167],["T_WHITESPACE","\n      ",167],["T_VARIABLE","$entity_type",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getRevisionDataTable",168],"(",")",["T_WHITESPACE"," ",168],["T_IS_NOT_EQUAL","!=",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$original",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getRevisionDataTable",168],"(",")",";",["T_WHITESPACE","\n  ",168],"}",["T_WHITESPACE","\n\n  ",169],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",171],["T_WHITESPACE","\n  ",173],["T_PUBLIC","public",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","requiresFieldStorageSchemaChanges",174],"(",["T_STRING","FieldStorageDefinitionInterface",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$storage_definition",174],",",["T_WHITESPACE"," ",174],["T_STRING","FieldStorageDefinitionInterface",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$original",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n    ",174],["T_VARIABLE","$table_mapping",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","storage",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getTableMapping",175],"(",")",";",["T_WHITESPACE","\n\n    ",175],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_WHITESPACE","\n      ",177],["T_VARIABLE","$storage_definition",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","hasCustomStorage",178],"(",")",["T_WHITESPACE"," ",178],["T_IS_NOT_EQUAL","!=",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$original",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","hasCustomStorage",178],"(",")",["T_WHITESPACE"," ",178],["T_BOOLEAN_OR","||",178],["T_WHITESPACE","\n      ",178],["T_VARIABLE","$storage_definition",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getSchema",179],"(",")",["T_WHITESPACE"," ",179],["T_IS_NOT_EQUAL","!=",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$original",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getSchema",179],"(",")",["T_WHITESPACE"," ",179],["T_BOOLEAN_OR","||",179],["T_WHITESPACE","\n      ",179],["T_VARIABLE","$storage_definition",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","isRevisionable",180],"(",")",["T_WHITESPACE"," ",180],["T_IS_NOT_EQUAL","!=",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$original",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","isRevisionable",180],"(",")",["T_WHITESPACE"," ",180],["T_BOOLEAN_OR","||",180],["T_WHITESPACE","\n      ",180],["T_VARIABLE","$table_mapping",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","allowsSharedTableStorage",181],"(",["T_VARIABLE","$storage_definition",181],")",["T_WHITESPACE"," ",181],["T_IS_NOT_EQUAL","!=",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$table_mapping",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","allowsSharedTableStorage",181],"(",["T_VARIABLE","$original",181],")",["T_WHITESPACE"," ",181],["T_BOOLEAN_OR","||",181],["T_WHITESPACE","\n      ",181],["T_VARIABLE","$table_mapping",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","requiresDedicatedTableStorage",182],"(",["T_VARIABLE","$storage_definition",182],")",["T_WHITESPACE"," ",182],["T_IS_NOT_EQUAL","!=",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$table_mapping",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","requiresDedicatedTableStorage",182],"(",["T_VARIABLE","$original",182],")",["T_WHITESPACE","\n    ",182],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n      ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_STRING","TRUE",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$storage_definition",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","hasCustomStorage",187],"(",")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n      ",187],["T_COMMENT","\/\/ The field has custom storage, so we don't know if a schema change is\n",188],["T_WHITESPACE","      ",189],["T_COMMENT","\/\/ needed or not, but since per the initial checks earlier in this\n",189],["T_WHITESPACE","      ",190],["T_COMMENT","\/\/ function, nothing about the definition changed that we manage, we\n",190],["T_WHITESPACE","      ",191],["T_COMMENT","\/\/ return FALSE.\n",191],["T_WHITESPACE","      ",192],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_STRING","FALSE",192],";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n\n    ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getSchemaFromStorageDefinition",195],"(",["T_VARIABLE","$storage_definition",195],")",["T_WHITESPACE"," ",195],["T_IS_NOT_EQUAL","!=",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","loadFieldSchemaData",195],"(",["T_VARIABLE","$original",195],")",";",["T_WHITESPACE","\n  ",195],"}",["T_WHITESPACE","\n\n  ",196],["T_DOC_COMMENT","\/**\n   * Gets the schema data for the given field storage definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition. The field that must not have custom\n   *   storage, i.e. the storage must take care of storing the field.\n   *\n   * @return array\n   *   The schema data.\n   *\/",198],["T_WHITESPACE","\n  ",207],["T_PROTECTED","protected",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","getSchemaFromStorageDefinition",208],"(",["T_STRING","FieldStorageDefinitionInterface",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$storage_definition",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n    ",208],["T_STRING","assert",209],"(",["T_CONSTANT_ENCAPSED_STRING","'!$storage_definition->hasCustomStorage();'",209],")",";",["T_WHITESPACE","\n    ",209],["T_VARIABLE","$table_mapping",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","storage",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getTableMapping",210],"(",")",";",["T_WHITESPACE","\n    ",210],["T_VARIABLE","$schema",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],"[","]",";",["T_WHITESPACE","\n    ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$table_mapping",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","requiresDedicatedTableStorage",212],"(",["T_VARIABLE","$storage_definition",212],")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n      ",212],["T_VARIABLE","$schema",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getDedicatedTableSchema",213],"(",["T_VARIABLE","$storage_definition",213],")",";",["T_WHITESPACE","\n    ",213],"}",["T_WHITESPACE","\n    ",214],["T_ELSEIF","elseif",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$table_mapping",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","allowsSharedTableStorage",215],"(",["T_VARIABLE","$storage_definition",215],")",")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n      ",215],["T_VARIABLE","$field_name",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$storage_definition",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getName",216],"(",")",";",["T_WHITESPACE","\n      ",216],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_STRING","array_diff",217],"(",["T_VARIABLE","$table_mapping",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getTableNames",217],"(",")",",",["T_WHITESPACE"," ",217],["T_VARIABLE","$table_mapping",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getDedicatedTableNames",217],"(",")",")",["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$table_name",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_STRING","in_array",218],"(",["T_VARIABLE","$field_name",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$table_mapping",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getFieldNames",218],"(",["T_VARIABLE","$table_name",218],")",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n          ",218],["T_VARIABLE","$column_names",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$table_mapping",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getColumnNames",219],"(",["T_VARIABLE","$storage_definition",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getName",219],"(",")",")",";",["T_WHITESPACE","\n          ",219],["T_VARIABLE","$schema",220],"[",["T_VARIABLE","$table_name",220],"]",["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getSharedTableFieldSchema",220],"(",["T_VARIABLE","$storage_definition",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$table_name",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$column_names",220],")",";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n      ",221],"}",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n    ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$schema",224],";",["T_WHITESPACE","\n  ",224],"}",["T_WHITESPACE","\n\n  ",225],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",227],["T_WHITESPACE","\n  ",229],["T_PUBLIC","public",230],["T_WHITESPACE"," ",230],["T_FUNCTION","function",230],["T_WHITESPACE"," ",230],["T_STRING","requiresEntityDataMigration",230],"(",["T_STRING","EntityTypeInterface",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$entity_type",230],",",["T_WHITESPACE"," ",230],["T_STRING","EntityTypeInterface",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$original",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n    ",230],["T_COMMENT","\/\/ If the original storage has existing entities, or it is impossible to\n",231],["T_WHITESPACE","    ",232],["T_COMMENT","\/\/ determine if that is the case, require entity data to be migrated.\n",232],["T_WHITESPACE","    ",233],["T_VARIABLE","$original_storage_class",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$original",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getStorageClass",233],"(",")",";",["T_WHITESPACE","\n    ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_STRING","class_exists",234],"(",["T_VARIABLE","$original_storage_class",234],")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n      ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","TRUE",235],";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_COMMENT","\/\/ Data migration is not needed when only indexes changed, as they can be\n",238],["T_WHITESPACE","    ",239],["T_COMMENT","\/\/ applied if there is data.\n",239],["T_WHITESPACE","    ",240],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","hasSharedTableStructureChange",240],"(",["T_VARIABLE","$entity_type",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$original",240],")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n      ",240],["T_RETURN","return",241],["T_WHITESPACE"," ",241],["T_STRING","FALSE",241],";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_COMMENT","\/\/ Use the original entity type since the storage has not been updated.\n",244],["T_WHITESPACE","    ",245],["T_VARIABLE","$original_storage",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","entityManager",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","createHandlerInstance",245],"(",["T_VARIABLE","$original_storage_class",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$original",245],")",";",["T_WHITESPACE","\n    ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$original_storage",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","hasData",246],"(",")",";",["T_WHITESPACE","\n  ",246],"}",["T_WHITESPACE","\n\n  ",247],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",249],["T_WHITESPACE","\n  ",251],["T_PUBLIC","public",252],["T_WHITESPACE"," ",252],["T_FUNCTION","function",252],["T_WHITESPACE"," ",252],["T_STRING","requiresFieldDataMigration",252],"(",["T_STRING","FieldStorageDefinitionInterface",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$storage_definition",252],",",["T_WHITESPACE"," ",252],["T_STRING","FieldStorageDefinitionInterface",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$original",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n    ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],"!",["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","storage",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","countFieldData",253],"(",["T_VARIABLE","$original",253],",",["T_WHITESPACE"," ",253],["T_STRING","TRUE",253],")",";",["T_WHITESPACE","\n  ",253],"}",["T_WHITESPACE","\n\n  ",254],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",256],["T_WHITESPACE","\n  ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","onEntityTypeCreate",259],"(",["T_STRING","EntityTypeInterface",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$entity_type",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n    ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","checkEntityType",260],"(",["T_VARIABLE","$entity_type",260],")",";",["T_WHITESPACE","\n    ",260],["T_VARIABLE","$schema_handler",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","database",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","schema",261],"(",")",";",["T_WHITESPACE","\n\n    ",261],["T_COMMENT","\/\/ Create entity tables.\n",263],["T_WHITESPACE","    ",264],["T_VARIABLE","$schema",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getEntitySchema",264],"(",["T_VARIABLE","$entity_type",264],",",["T_WHITESPACE"," ",264],["T_STRING","TRUE",264],")",";",["T_WHITESPACE","\n    ",264],["T_FOREACH","foreach",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$schema",265],["T_WHITESPACE"," ",265],["T_AS","as",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$table_name",265],["T_WHITESPACE"," ",265],["T_DOUBLE_ARROW","=>",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$table_schema",265],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n      ",265],["T_IF","if",266],["T_WHITESPACE"," ",266],"(","!",["T_VARIABLE","$schema_handler",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","tableExists",266],"(",["T_VARIABLE","$table_name",266],")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$schema_handler",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","createTable",267],"(",["T_VARIABLE","$table_name",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$table_schema",267],")",";",["T_WHITESPACE","\n      ",267],"}",["T_WHITESPACE","\n    ",268],"}",["T_WHITESPACE","\n\n    ",269],["T_COMMENT","\/\/ Create dedicated field tables.\n",271],["T_WHITESPACE","    ",272],["T_VARIABLE","$field_storage_definitions",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","entityManager",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getFieldStorageDefinitions",272],"(",["T_VARIABLE","$entity_type",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","id",272],"(",")",")",";",["T_WHITESPACE","\n    ",272],["T_VARIABLE","$table_mapping",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","storage",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getTableMapping",273],"(",["T_VARIABLE","$field_storage_definitions",273],")",";",["T_WHITESPACE","\n    ",273],["T_FOREACH","foreach",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$field_storage_definitions",274],["T_WHITESPACE"," ",274],["T_AS","as",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$field_storage_definition",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n      ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$table_mapping",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","requiresDedicatedTableStorage",275],"(",["T_VARIABLE","$field_storage_definition",275],")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","createDedicatedTableSchema",276],"(",["T_VARIABLE","$field_storage_definition",276],")",";",["T_WHITESPACE","\n      ",276],"}",["T_WHITESPACE","\n      ",277],["T_ELSEIF","elseif",278],["T_WHITESPACE"," ",278],"(",["T_VARIABLE","$table_mapping",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","allowsSharedTableStorage",278],"(",["T_VARIABLE","$field_storage_definition",278],")",")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n        ",278],["T_COMMENT","\/\/ The shared tables are already fully created, but we need to save the\n",279],["T_WHITESPACE","        ",280],["T_COMMENT","\/\/ per-field schema definitions for later use.\n",280],["T_WHITESPACE","        ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","createSharedTableSchema",281],"(",["T_VARIABLE","$field_storage_definition",281],",",["T_WHITESPACE"," ",281],["T_STRING","TRUE",281],")",";",["T_WHITESPACE","\n      ",281],"}",["T_WHITESPACE","\n    ",282],"}",["T_WHITESPACE","\n\n    ",283],["T_COMMENT","\/\/ Save data about entity indexes and keys.\n",285],["T_WHITESPACE","    ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","saveEntitySchemaData",286],"(",["T_VARIABLE","$entity_type",286],",",["T_WHITESPACE"," ",286],["T_VARIABLE","$schema",286],")",";",["T_WHITESPACE","\n  ",286],"}",["T_WHITESPACE","\n\n  ",287],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",289],["T_WHITESPACE","\n  ",291],["T_PUBLIC","public",292],["T_WHITESPACE"," ",292],["T_FUNCTION","function",292],["T_WHITESPACE"," ",292],["T_STRING","onEntityTypeUpdate",292],"(",["T_STRING","EntityTypeInterface",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$entity_type",292],",",["T_WHITESPACE"," ",292],["T_STRING","EntityTypeInterface",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$original",292],")",["T_WHITESPACE"," ",292],"{",["T_WHITESPACE","\n    ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","checkEntityType",293],"(",["T_VARIABLE","$entity_type",293],")",";",["T_WHITESPACE","\n    ",293],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","checkEntityType",294],"(",["T_VARIABLE","$original",294],")",";",["T_WHITESPACE","\n\n    ",294],["T_COMMENT","\/\/ If no schema changes are needed, we don't need to do anything.\n",296],["T_WHITESPACE","    ",297],["T_IF","if",297],["T_WHITESPACE"," ",297],"(","!",["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","requiresEntityStorageSchemaChanges",297],"(",["T_VARIABLE","$entity_type",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$original",297],")",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n      ",297],["T_RETURN","return",298],";",["T_WHITESPACE","\n    ",298],"}",["T_WHITESPACE","\n\n    ",299],["T_COMMENT","\/\/ If a migration is required, we can't proceed.\n",301],["T_WHITESPACE","    ",302],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","requiresEntityDataMigration",302],"(",["T_VARIABLE","$entity_type",302],",",["T_WHITESPACE"," ",302],["T_VARIABLE","$original",302],")",")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n      ",302],["T_THROW","throw",303],["T_WHITESPACE"," ",303],["T_NEW","new",303],["T_WHITESPACE"," ",303],["T_STRING","EntityStorageException",303],"(",["T_CONSTANT_ENCAPSED_STRING","'The SQL storage cannot change the schema for an existing entity type ('",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$entity_type",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","id",303],"(",")",["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","') with data.'",303],")",";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n\n    ",304],["T_COMMENT","\/\/ If we have no data just recreate the entity schema from scratch.\n",306],["T_WHITESPACE","    ",307],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","isTableEmpty",307],"(",["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","storage",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getBaseTable",307],"(",")",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n      ",307],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","database",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","supportsTransactionalDDL",308],"(",")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n        ",308],["T_COMMENT","\/\/ If the database supports transactional DDL, we can go ahead and rely\n",309],["T_WHITESPACE","        ",310],["T_COMMENT","\/\/ on it. If not, we will have to rollback manually if something fails.\n",310],["T_WHITESPACE","        ",311],["T_VARIABLE","$transaction",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","database",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","startTransaction",311],"(",")",";",["T_WHITESPACE","\n      ",311],"}",["T_WHITESPACE","\n      ",312],["T_TRY","try",313],["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","onEntityTypeDelete",314],"(",["T_VARIABLE","$original",314],")",";",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","onEntityTypeCreate",315],"(",["T_VARIABLE","$entity_type",315],")",";",["T_WHITESPACE","\n      ",315],"}",["T_WHITESPACE","\n      ",316],["T_CATCH","catch",317],["T_WHITESPACE"," ",317],"(",["T_NS_SEPARATOR","\\",317],["T_STRING","Exception",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$e",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n        ",317],["T_IF","if",318],["T_WHITESPACE"," ",318],"(",["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","database",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","supportsTransactionalDDL",318],"(",")",")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n          ",318],["T_VARIABLE","$transaction",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","rollback",319],"(",")",";",["T_WHITESPACE","\n        ",319],"}",["T_WHITESPACE","\n        ",320],["T_ELSE","else",321],["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n          ",321],["T_COMMENT","\/\/ Recreate original schema.\n",322],["T_WHITESPACE","          ",323],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","onEntityTypeCreate",323],"(",["T_VARIABLE","$original",323],")",";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE","\n        ",324],["T_THROW","throw",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$e",325],";",["T_WHITESPACE","\n      ",325],"}",["T_WHITESPACE","\n    ",326],"}",["T_WHITESPACE","\n    ",327],["T_ELSE","else",328],["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n      ",328],["T_COMMENT","\/\/ Drop original indexes and unique keys.\n",329],["T_WHITESPACE","      ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","deleteEntitySchemaIndexes",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","loadEntitySchemaData",330],"(",["T_VARIABLE","$entity_type",330],")",")",";",["T_WHITESPACE","\n\n      ",330],["T_COMMENT","\/\/ Create new indexes and unique keys.\n",332],["T_WHITESPACE","      ",333],["T_VARIABLE","$entity_schema",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getEntitySchema",333],"(",["T_VARIABLE","$entity_type",333],",",["T_WHITESPACE"," ",333],["T_STRING","TRUE",333],")",";",["T_WHITESPACE","\n      ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","createEntitySchemaIndexes",334],"(",["T_VARIABLE","$entity_schema",334],")",";",["T_WHITESPACE","\n\n      ",334],["T_COMMENT","\/\/ Store the updated entity schema.\n",336],["T_WHITESPACE","      ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","saveEntitySchemaData",337],"(",["T_VARIABLE","$entity_type",337],",",["T_WHITESPACE"," ",337],["T_VARIABLE","$entity_schema",337],")",";",["T_WHITESPACE","\n    ",337],"}",["T_WHITESPACE","\n  ",338],"}",["T_WHITESPACE","\n\n  ",339],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",341],["T_WHITESPACE","\n  ",343],["T_PUBLIC","public",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","onEntityTypeDelete",344],"(",["T_STRING","EntityTypeInterface",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$entity_type",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n    ",344],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","checkEntityType",345],"(",["T_VARIABLE","$entity_type",345],")",";",["T_WHITESPACE","\n    ",345],["T_VARIABLE","$schema_handler",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","database",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","schema",346],"(",")",";",["T_WHITESPACE","\n    ",346],["T_VARIABLE","$actual_definition",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","entityManager",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getDefinition",347],"(",["T_VARIABLE","$entity_type",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","id",347],"(",")",")",";",["T_WHITESPACE","\n    ",347],["T_COMMENT","\/\/ @todo Instead of switching the wrapped entity type, we should be able to\n",348],["T_WHITESPACE","    ",349],["T_COMMENT","\/\/   instantiate a new table mapping for each entity type definition. See\n",349],["T_WHITESPACE","    ",350],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2274017.\n",350],["T_WHITESPACE","    ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","storage",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","setEntityType",351],"(",["T_VARIABLE","$entity_type",351],")",";",["T_WHITESPACE","\n\n    ",351],["T_COMMENT","\/\/ Delete entity tables.\n",353],["T_WHITESPACE","    ",354],["T_FOREACH","foreach",354],["T_WHITESPACE"," ",354],"(",["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getEntitySchemaTables",354],"(",")",["T_WHITESPACE"," ",354],["T_AS","as",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$table_name",354],")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n      ",354],["T_IF","if",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$schema_handler",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","tableExists",355],"(",["T_VARIABLE","$table_name",355],")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n        ",355],["T_VARIABLE","$schema_handler",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","dropTable",356],"(",["T_VARIABLE","$table_name",356],")",";",["T_WHITESPACE","\n      ",356],"}",["T_WHITESPACE","\n    ",357],"}",["T_WHITESPACE","\n\n    ",358],["T_COMMENT","\/\/ Delete dedicated field tables.\n",360],["T_WHITESPACE","    ",361],["T_VARIABLE","$field_storage_definitions",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","entityManager",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getLastInstalledFieldStorageDefinitions",361],"(",["T_VARIABLE","$entity_type",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","id",361],"(",")",")",";",["T_WHITESPACE","\n    ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","originalDefinitions",362],["T_WHITESPACE"," ",362],"=",["T_WHITESPACE"," ",362],["T_VARIABLE","$field_storage_definitions",362],";",["T_WHITESPACE","\n    ",362],["T_VARIABLE","$table_mapping",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","storage",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getTableMapping",363],"(",["T_VARIABLE","$field_storage_definitions",363],")",";",["T_WHITESPACE","\n    ",363],["T_FOREACH","foreach",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$field_storage_definitions",364],["T_WHITESPACE"," ",364],["T_AS","as",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$field_storage_definition",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n      ",364],["T_COMMENT","\/\/ If we have a field having dedicated storage we need to drop it,\n",365],["T_WHITESPACE","      ",366],["T_COMMENT","\/\/ otherwise we just remove the related schema data.\n",366],["T_WHITESPACE","      ",367],["T_IF","if",367],["T_WHITESPACE"," ",367],"(",["T_VARIABLE","$table_mapping",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","requiresDedicatedTableStorage",367],"(",["T_VARIABLE","$field_storage_definition",367],")",")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","deleteDedicatedTableSchema",368],"(",["T_VARIABLE","$field_storage_definition",368],")",";",["T_WHITESPACE","\n      ",368],"}",["T_WHITESPACE","\n      ",369],["T_ELSEIF","elseif",370],["T_WHITESPACE"," ",370],"(",["T_VARIABLE","$table_mapping",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","allowsSharedTableStorage",370],"(",["T_VARIABLE","$field_storage_definition",370],")",")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","deleteFieldSchemaData",371],"(",["T_VARIABLE","$field_storage_definition",371],")",";",["T_WHITESPACE","\n      ",371],"}",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n    ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","originalDefinitions",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_STRING","NULL",374],";",["T_WHITESPACE","\n\n    ",374],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","storage",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","setEntityType",376],"(",["T_VARIABLE","$actual_definition",376],")",";",["T_WHITESPACE","\n\n    ",376],["T_COMMENT","\/\/ Delete the entity schema.\n",378],["T_WHITESPACE","    ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","deleteEntitySchemaData",379],"(",["T_VARIABLE","$entity_type",379],")",";",["T_WHITESPACE","\n  ",379],"}",["T_WHITESPACE","\n\n  ",380],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",382],["T_WHITESPACE","\n  ",384],["T_PUBLIC","public",385],["T_WHITESPACE"," ",385],["T_FUNCTION","function",385],["T_WHITESPACE"," ",385],["T_STRING","onFieldStorageDefinitionCreate",385],"(",["T_STRING","FieldStorageDefinitionInterface",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$storage_definition",385],")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n    ",385],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","performFieldSchemaOperation",386],"(",["T_CONSTANT_ENCAPSED_STRING","'create'",386],",",["T_WHITESPACE"," ",386],["T_VARIABLE","$storage_definition",386],")",";",["T_WHITESPACE","\n  ",386],"}",["T_WHITESPACE","\n\n  ",387],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",389],["T_WHITESPACE","\n  ",391],["T_PUBLIC","public",392],["T_WHITESPACE"," ",392],["T_FUNCTION","function",392],["T_WHITESPACE"," ",392],["T_STRING","onFieldStorageDefinitionUpdate",392],"(",["T_STRING","FieldStorageDefinitionInterface",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$storage_definition",392],",",["T_WHITESPACE"," ",392],["T_STRING","FieldStorageDefinitionInterface",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$original",392],")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n    ",392],["T_COMMENT","\/\/ Store original definitions so that switching between shared and dedicated\n",393],["T_WHITESPACE","    ",394],["T_COMMENT","\/\/ field table layout works.\n",394],["T_WHITESPACE","    ",395],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","originalDefinitions",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","fieldStorageDefinitions",395],";",["T_WHITESPACE","\n    ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","originalDefinitions",396],"[",["T_VARIABLE","$original",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getName",396],"(",")","]",["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_VARIABLE","$original",396],";",["T_WHITESPACE","\n    ",396],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","performFieldSchemaOperation",397],"(",["T_CONSTANT_ENCAPSED_STRING","'update'",397],",",["T_WHITESPACE"," ",397],["T_VARIABLE","$storage_definition",397],",",["T_WHITESPACE"," ",397],["T_VARIABLE","$original",397],")",";",["T_WHITESPACE","\n    ",397],["T_VARIABLE","$this",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","originalDefinitions",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_STRING","NULL",398],";",["T_WHITESPACE","\n  ",398],"}",["T_WHITESPACE","\n\n  ",399],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",401],["T_WHITESPACE","\n  ",403],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","onFieldStorageDefinitionDelete",404],"(",["T_STRING","FieldStorageDefinitionInterface",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$storage_definition",404],")",["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n    ",404],["T_COMMENT","\/\/ Only configurable fields currently support purging, so prevent deletion\n",405],["T_WHITESPACE","    ",406],["T_COMMENT","\/\/ of ones we can't purge if they have existing data.\n",406],["T_WHITESPACE","    ",407],["T_COMMENT","\/\/ @todo Add purging to all fields: https:\/\/www.drupal.org\/node\/2282119.\n",407],["T_WHITESPACE","    ",408],["T_TRY","try",408],["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n      ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(","!","(",["T_VARIABLE","$storage_definition",409],["T_WHITESPACE"," ",409],["T_INSTANCEOF","instanceof",409],["T_WHITESPACE"," ",409],["T_STRING","FieldStorageConfigInterface",409],")",["T_WHITESPACE"," ",409],["T_BOOLEAN_AND","&&",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","storage",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","countFieldData",409],"(",["T_VARIABLE","$storage_definition",409],",",["T_WHITESPACE"," ",409],["T_STRING","TRUE",409],")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n        ",409],["T_THROW","throw",410],["T_WHITESPACE"," ",410],["T_NEW","new",410],["T_WHITESPACE"," ",410],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",410],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to delete a field ('",410],["T_WHITESPACE"," ",410],".",["T_WHITESPACE"," ",410],["T_VARIABLE","$storage_definition",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getName",410],"(",")",["T_WHITESPACE"," ",410],".",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","' in '",410],["T_WHITESPACE"," ",410],".",["T_WHITESPACE"," ",410],["T_VARIABLE","$storage_definition",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getTargetEntityTypeId",410],"(",")",["T_WHITESPACE"," ",410],".",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","' entity) with data that cannot be purged.'",410],")",";",["T_WHITESPACE","\n      ",410],"}",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n    ",412],["T_CATCH","catch",413],["T_WHITESPACE"," ",413],"(",["T_STRING","DatabaseException",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$e",413],")",["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n      ",413],["T_COMMENT","\/\/ This may happen when changing field storage schema, since we are not\n",414],["T_WHITESPACE","      ",415],["T_COMMENT","\/\/ able to use a table mapping matching the passed storage definition.\n",415],["T_WHITESPACE","      ",416],["T_COMMENT","\/\/ @todo Revisit this once we are able to instantiate the table mapping\n",416],["T_WHITESPACE","      ",417],["T_COMMENT","\/\/   properly. See https:\/\/www.drupal.org\/node\/2274017.\n",417],["T_WHITESPACE","      ",418],["T_RETURN","return",418],";",["T_WHITESPACE","\n    ",418],"}",["T_WHITESPACE","\n\n    ",419],["T_COMMENT","\/\/ Retrieve a table mapping which contains the deleted field still.\n",421],["T_WHITESPACE","    ",422],["T_VARIABLE","$table_mapping",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","storage",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getTableMapping",422],"(",["T_WHITESPACE","\n      ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","entityManager",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getLastInstalledFieldStorageDefinitions",423],"(",["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","entityType",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","id",423],"(",")",")",["T_WHITESPACE","\n    ",423],")",";",["T_WHITESPACE","\n    ",424],["T_IF","if",425],["T_WHITESPACE"," ",425],"(",["T_VARIABLE","$table_mapping",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","requiresDedicatedTableStorage",425],"(",["T_VARIABLE","$storage_definition",425],")",")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n      ",425],["T_COMMENT","\/\/ Move the table to a unique name while the table contents are being\n",426],["T_WHITESPACE","      ",427],["T_COMMENT","\/\/ deleted.\n",427],["T_WHITESPACE","      ",428],["T_VARIABLE","$table",428],["T_WHITESPACE"," ",428],"=",["T_WHITESPACE"," ",428],["T_VARIABLE","$table_mapping",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getDedicatedDataTableName",428],"(",["T_VARIABLE","$storage_definition",428],")",";",["T_WHITESPACE","\n      ",428],["T_VARIABLE","$new_table",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$table_mapping",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getDedicatedDataTableName",429],"(",["T_VARIABLE","$storage_definition",429],",",["T_WHITESPACE"," ",429],["T_STRING","TRUE",429],")",";",["T_WHITESPACE","\n      ",429],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","database",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","schema",430],"(",")",["T_OBJECT_OPERATOR","->",430],["T_STRING","renameTable",430],"(",["T_VARIABLE","$table",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$new_table",430],")",";",["T_WHITESPACE","\n      ",430],["T_IF","if",431],["T_WHITESPACE"," ",431],"(",["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","entityType",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","isRevisionable",431],"(",")",")",["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$revision_table",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_VARIABLE","$table_mapping",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getDedicatedRevisionTableName",432],"(",["T_VARIABLE","$storage_definition",432],")",";",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$revision_new_table",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$table_mapping",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getDedicatedRevisionTableName",433],"(",["T_VARIABLE","$storage_definition",433],",",["T_WHITESPACE"," ",433],["T_STRING","TRUE",433],")",";",["T_WHITESPACE","\n        ",433],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","database",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","schema",434],"(",")",["T_OBJECT_OPERATOR","->",434],["T_STRING","renameTable",434],"(",["T_VARIABLE","$revision_table",434],",",["T_WHITESPACE"," ",434],["T_VARIABLE","$revision_new_table",434],")",";",["T_WHITESPACE","\n      ",434],"}",["T_WHITESPACE","\n    ",435],"}",["T_WHITESPACE","\n\n    ",436],["T_COMMENT","\/\/ @todo Remove when finalizePurge() is invoked from the outside for all\n",438],["T_WHITESPACE","    ",439],["T_COMMENT","\/\/   fields: https:\/\/www.drupal.org\/node\/2282119.\n",439],["T_WHITESPACE","    ",440],["T_IF","if",440],["T_WHITESPACE"," ",440],"(","!","(",["T_VARIABLE","$storage_definition",440],["T_WHITESPACE"," ",440],["T_INSTANCEOF","instanceof",440],["T_WHITESPACE"," ",440],["T_STRING","FieldStorageConfigInterface",440],")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n      ",440],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","performFieldSchemaOperation",441],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",441],",",["T_WHITESPACE"," ",441],["T_VARIABLE","$storage_definition",441],")",";",["T_WHITESPACE","\n    ",441],"}",["T_WHITESPACE","\n  ",442],"}",["T_WHITESPACE","\n\n  ",443],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",445],["T_WHITESPACE","\n  ",447],["T_PUBLIC","public",448],["T_WHITESPACE"," ",448],["T_FUNCTION","function",448],["T_WHITESPACE"," ",448],["T_STRING","finalizePurge",448],"(",["T_STRING","FieldStorageDefinitionInterface",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$storage_definition",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n    ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","performFieldSchemaOperation",449],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",449],",",["T_WHITESPACE"," ",449],["T_VARIABLE","$storage_definition",449],")",";",["T_WHITESPACE","\n  ",449],"}",["T_WHITESPACE","\n\n  ",450],["T_DOC_COMMENT","\/**\n   * Checks that we are dealing with the correct entity type.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type to be checked.\n   *\n   * @return bool\n   *   TRUE if the entity type matches the current one.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityStorageException\n   *\/",452],["T_WHITESPACE","\n  ",462],["T_PROTECTED","protected",463],["T_WHITESPACE"," ",463],["T_FUNCTION","function",463],["T_WHITESPACE"," ",463],["T_STRING","checkEntityType",463],"(",["T_STRING","EntityTypeInterface",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$entity_type",463],")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n    ",463],["T_IF","if",464],["T_WHITESPACE"," ",464],"(",["T_VARIABLE","$entity_type",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","id",464],"(",")",["T_WHITESPACE"," ",464],["T_IS_NOT_EQUAL","!=",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","entityType",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","id",464],"(",")",")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n      ",464],["T_THROW","throw",465],["T_WHITESPACE"," ",465],["T_NEW","new",465],["T_WHITESPACE"," ",465],["T_STRING","EntityStorageException",465],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Unsupported entity type ",465],["T_CURLY_OPEN","{",465],["T_VARIABLE","$entity_type",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","id",465],"(",")","}","\"",")",";",["T_WHITESPACE","\n    ",465],"}",["T_WHITESPACE","\n    ",466],["T_RETURN","return",467],["T_WHITESPACE"," ",467],["T_STRING","TRUE",467],";",["T_WHITESPACE","\n  ",467],"}",["T_WHITESPACE","\n\n  ",468],["T_DOC_COMMENT","\/**\n   * Gets the entity schema for the specified entity type.\n   *\n   * Entity types may override this method in order to optimize the generated\n   * schema of the entity tables. However, only cross-field optimizations should\n   * be added here; e.g., an index spanning multiple fields. Optimizations that\n   * apply to a single field have to be added via\n   * SqlContentEntityStorageSchema::getSharedTableFieldSchema() instead.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param bool $reset\n   *   (optional) If set to TRUE static cache will be ignored and a new schema\n   *   array generation will be performed. Defaults to FALSE.\n   *\n   * @return array\n   *   A Schema API array describing the entity schema, excluding dedicated\n   *   field tables.\n   *\n   * @throws \\Drupal\\Core\\Field\\FieldException\n   *\/",470],["T_WHITESPACE","\n  ",490],["T_PROTECTED","protected",491],["T_WHITESPACE"," ",491],["T_FUNCTION","function",491],["T_WHITESPACE"," ",491],["T_STRING","getEntitySchema",491],"(",["T_STRING","ContentEntityTypeInterface",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$entity_type",491],",",["T_WHITESPACE"," ",491],["T_VARIABLE","$reset",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_STRING","FALSE",491],")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n    ",491],["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","checkEntityType",492],"(",["T_VARIABLE","$entity_type",492],")",";",["T_WHITESPACE","\n    ",492],["T_VARIABLE","$entity_type_id",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_VARIABLE","$entity_type",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","id",493],"(",")",";",["T_WHITESPACE","\n\n    ",493],["T_IF","if",495],["T_WHITESPACE"," ",495],"(","!",["T_ISSET","isset",495],"(",["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","schema",495],"[",["T_VARIABLE","$entity_type_id",495],"]",")",["T_WHITESPACE"," ",495],["T_BOOLEAN_OR","||",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$reset",495],")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n      ",495],["T_COMMENT","\/\/ Back up the storage definition and replace it with the passed one.\n",496],["T_WHITESPACE","      ",497],["T_COMMENT","\/\/ @todo Instead of switching the wrapped entity type, we should be able\n",497],["T_WHITESPACE","      ",498],["T_COMMENT","\/\/   to instantiate a new table mapping for each entity type definition.\n",498],["T_WHITESPACE","      ",499],["T_COMMENT","\/\/   See https:\/\/www.drupal.org\/node\/2274017.\n",499],["T_WHITESPACE","      ",500],["T_VARIABLE","$actual_definition",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","entityManager",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getDefinition",500],"(",["T_VARIABLE","$entity_type_id",500],")",";",["T_WHITESPACE","\n      ",500],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","storage",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","setEntityType",501],"(",["T_VARIABLE","$entity_type",501],")",";",["T_WHITESPACE","\n\n      ",501],["T_COMMENT","\/\/ Prepare basic information about the entity type.\n",503],["T_WHITESPACE","      ",504],["T_VARIABLE","$tables",504],["T_WHITESPACE"," ",504],"=",["T_WHITESPACE"," ",504],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getEntitySchemaTables",504],"(",")",";",["T_WHITESPACE","\n\n      ",504],["T_COMMENT","\/\/ Initialize the table schema.\n",506],["T_WHITESPACE","      ",507],["T_VARIABLE","$schema",507],"[",["T_VARIABLE","$tables",507],"[",["T_CONSTANT_ENCAPSED_STRING","'base_table'",507],"]","]",["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","initializeBaseTable",507],"(",["T_VARIABLE","$entity_type",507],")",";",["T_WHITESPACE","\n      ",507],["T_IF","if",508],["T_WHITESPACE"," ",508],"(",["T_ISSET","isset",508],"(",["T_VARIABLE","$tables",508],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_table'",508],"]",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n        ",508],["T_VARIABLE","$schema",509],"[",["T_VARIABLE","$tables",509],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_table'",509],"]","]",["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","initializeRevisionTable",509],"(",["T_VARIABLE","$entity_type",509],")",";",["T_WHITESPACE","\n      ",509],"}",["T_WHITESPACE","\n      ",510],["T_IF","if",511],["T_WHITESPACE"," ",511],"(",["T_ISSET","isset",511],"(",["T_VARIABLE","$tables",511],"[",["T_CONSTANT_ENCAPSED_STRING","'data_table'",511],"]",")",")",["T_WHITESPACE"," ",511],"{",["T_WHITESPACE","\n        ",511],["T_VARIABLE","$schema",512],"[",["T_VARIABLE","$tables",512],"[",["T_CONSTANT_ENCAPSED_STRING","'data_table'",512],"]","]",["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","initializeDataTable",512],"(",["T_VARIABLE","$entity_type",512],")",";",["T_WHITESPACE","\n      ",512],"}",["T_WHITESPACE","\n      ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(",["T_ISSET","isset",514],"(",["T_VARIABLE","$tables",514],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_data_table'",514],"]",")",")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n        ",514],["T_VARIABLE","$schema",515],"[",["T_VARIABLE","$tables",515],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_data_table'",515],"]","]",["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","initializeRevisionDataTable",515],"(",["T_VARIABLE","$entity_type",515],")",";",["T_WHITESPACE","\n      ",515],"}",["T_WHITESPACE","\n\n      ",516],["T_COMMENT","\/\/ We need to act only on shared entity schema tables.\n",518],["T_WHITESPACE","      ",519],["T_VARIABLE","$table_mapping",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","storage",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getTableMapping",519],"(",")",";",["T_WHITESPACE","\n      ",519],["T_VARIABLE","$table_names",520],["T_WHITESPACE"," ",520],"=",["T_WHITESPACE"," ",520],["T_STRING","array_diff",520],"(",["T_VARIABLE","$table_mapping",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getTableNames",520],"(",")",",",["T_WHITESPACE"," ",520],["T_VARIABLE","$table_mapping",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getDedicatedTableNames",520],"(",")",")",";",["T_WHITESPACE","\n      ",520],["T_VARIABLE","$storage_definitions",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","entityManager",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getFieldStorageDefinitions",521],"(",["T_VARIABLE","$entity_type_id",521],")",";",["T_WHITESPACE","\n      ",521],["T_FOREACH","foreach",522],["T_WHITESPACE"," ",522],"(",["T_VARIABLE","$table_names",522],["T_WHITESPACE"," ",522],["T_AS","as",522],["T_WHITESPACE"," ",522],["T_VARIABLE","$table_name",522],")",["T_WHITESPACE"," ",522],"{",["T_WHITESPACE","\n        ",522],["T_IF","if",523],["T_WHITESPACE"," ",523],"(","!",["T_ISSET","isset",523],"(",["T_VARIABLE","$schema",523],"[",["T_VARIABLE","$table_name",523],"]",")",")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n          ",523],["T_VARIABLE","$schema",524],"[",["T_VARIABLE","$table_name",524],"]",["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_ARRAY","array",524],"(",")",";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n        ",525],["T_FOREACH","foreach",526],["T_WHITESPACE"," ",526],"(",["T_VARIABLE","$table_mapping",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getFieldNames",526],"(",["T_VARIABLE","$table_name",526],")",["T_WHITESPACE"," ",526],["T_AS","as",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$field_name",526],")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n          ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(","!",["T_ISSET","isset",527],"(",["T_VARIABLE","$storage_definitions",527],"[",["T_VARIABLE","$field_name",527],"]",")",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n            ",527],["T_THROW","throw",528],["T_WHITESPACE"," ",528],["T_NEW","new",528],["T_WHITESPACE"," ",528],["T_STRING","FieldException",528],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Field storage definition for '",528],["T_VARIABLE","$field_name",528],["T_ENCAPSED_AND_WHITESPACE","' could not be found.",528],"\"",")",";",["T_WHITESPACE","\n          ",528],"}",["T_WHITESPACE","\n          ",529],["T_COMMENT","\/\/ Add the schema for base field definitions.\n",530],["T_WHITESPACE","          ",531],["T_ELSEIF","elseif",531],["T_WHITESPACE"," ",531],"(",["T_VARIABLE","$table_mapping",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","allowsSharedTableStorage",531],"(",["T_VARIABLE","$storage_definitions",531],"[",["T_VARIABLE","$field_name",531],"]",")",")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n            ",531],["T_VARIABLE","$column_names",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_VARIABLE","$table_mapping",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","getColumnNames",532],"(",["T_VARIABLE","$field_name",532],")",";",["T_WHITESPACE","\n            ",532],["T_VARIABLE","$storage_definition",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$storage_definitions",533],"[",["T_VARIABLE","$field_name",533],"]",";",["T_WHITESPACE","\n            ",533],["T_VARIABLE","$schema",534],"[",["T_VARIABLE","$table_name",534],"]",["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_STRING","array_merge_recursive",534],"(",["T_VARIABLE","$schema",534],"[",["T_VARIABLE","$table_name",534],"]",",",["T_WHITESPACE"," ",534],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","getSharedTableFieldSchema",534],"(",["T_VARIABLE","$storage_definition",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$table_name",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$column_names",534],")",")",";",["T_WHITESPACE","\n          ",534],"}",["T_WHITESPACE","\n        ",535],"}",["T_WHITESPACE","\n      ",536],"}",["T_WHITESPACE","\n\n      ",537],["T_COMMENT","\/\/ Process tables after having gathered field information.\n",539],["T_WHITESPACE","      ",540],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","processBaseTable",540],"(",["T_VARIABLE","$entity_type",540],",",["T_WHITESPACE"," ",540],["T_VARIABLE","$schema",540],"[",["T_VARIABLE","$tables",540],"[",["T_CONSTANT_ENCAPSED_STRING","'base_table'",540],"]","]",")",";",["T_WHITESPACE","\n      ",540],["T_IF","if",541],["T_WHITESPACE"," ",541],"(",["T_ISSET","isset",541],"(",["T_VARIABLE","$tables",541],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_table'",541],"]",")",")",["T_WHITESPACE"," ",541],"{",["T_WHITESPACE","\n        ",541],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","processRevisionTable",542],"(",["T_VARIABLE","$entity_type",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$schema",542],"[",["T_VARIABLE","$tables",542],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_table'",542],"]","]",")",";",["T_WHITESPACE","\n      ",542],"}",["T_WHITESPACE","\n      ",543],["T_IF","if",544],["T_WHITESPACE"," ",544],"(",["T_ISSET","isset",544],"(",["T_VARIABLE","$tables",544],"[",["T_CONSTANT_ENCAPSED_STRING","'data_table'",544],"]",")",")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","processDataTable",545],"(",["T_VARIABLE","$entity_type",545],",",["T_WHITESPACE"," ",545],["T_VARIABLE","$schema",545],"[",["T_VARIABLE","$tables",545],"[",["T_CONSTANT_ENCAPSED_STRING","'data_table'",545],"]","]",")",";",["T_WHITESPACE","\n      ",545],"}",["T_WHITESPACE","\n      ",546],["T_IF","if",547],["T_WHITESPACE"," ",547],"(",["T_ISSET","isset",547],"(",["T_VARIABLE","$tables",547],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_data_table'",547],"]",")",")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n        ",547],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","processRevisionDataTable",548],"(",["T_VARIABLE","$entity_type",548],",",["T_WHITESPACE"," ",548],["T_VARIABLE","$schema",548],"[",["T_VARIABLE","$tables",548],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_data_table'",548],"]","]",")",";",["T_WHITESPACE","\n      ",548],"}",["T_WHITESPACE","\n\n      ",549],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","schema",551],"[",["T_VARIABLE","$entity_type_id",551],"]",["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_VARIABLE","$schema",551],";",["T_WHITESPACE","\n\n      ",551],["T_COMMENT","\/\/ Restore the actual definition.\n",553],["T_WHITESPACE","      ",554],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","storage",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","setEntityType",554],"(",["T_VARIABLE","$actual_definition",554],")",";",["T_WHITESPACE","\n    ",554],"}",["T_WHITESPACE","\n\n    ",555],["T_RETURN","return",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","schema",557],"[",["T_VARIABLE","$entity_type_id",557],"]",";",["T_WHITESPACE","\n  ",557],"}",["T_WHITESPACE","\n\n  ",558],["T_DOC_COMMENT","\/**\n   * Gets a list of entity type tables.\n   *\n   * @return array\n   *   A list of entity type tables, keyed by table key.\n   *\/",560],["T_WHITESPACE","\n  ",565],["T_PROTECTED","protected",566],["T_WHITESPACE"," ",566],["T_FUNCTION","function",566],["T_WHITESPACE"," ",566],["T_STRING","getEntitySchemaTables",566],"(",")",["T_WHITESPACE"," ",566],"{",["T_WHITESPACE","\n    ",566],["T_RETURN","return",567],["T_WHITESPACE"," ",567],["T_STRING","array_filter",567],"(",["T_ARRAY","array",567],"(",["T_WHITESPACE","\n      ",567],["T_CONSTANT_ENCAPSED_STRING","'base_table'",568],["T_WHITESPACE"," ",568],["T_DOUBLE_ARROW","=>",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","storage",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getBaseTable",568],"(",")",",",["T_WHITESPACE","\n      ",568],["T_CONSTANT_ENCAPSED_STRING","'revision_table'",569],["T_WHITESPACE"," ",569],["T_DOUBLE_ARROW","=>",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","storage",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","getRevisionTable",569],"(",")",",",["T_WHITESPACE","\n      ",569],["T_CONSTANT_ENCAPSED_STRING","'data_table'",570],["T_WHITESPACE"," ",570],["T_DOUBLE_ARROW","=>",570],["T_WHITESPACE"," ",570],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","storage",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","getDataTable",570],"(",")",",",["T_WHITESPACE","\n      ",570],["T_CONSTANT_ENCAPSED_STRING","'revision_data_table'",571],["T_WHITESPACE"," ",571],["T_DOUBLE_ARROW","=>",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","storage",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getRevisionDataTable",571],"(",")",",",["T_WHITESPACE","\n    ",571],")",")",";",["T_WHITESPACE","\n  ",572],"}",["T_WHITESPACE","\n\n  ",573],["T_DOC_COMMENT","\/**\n   * Gets entity schema definitions for index and key definitions.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param array $schema\n   *   The entity schema array.\n   *\n   * @return array\n   *   A stripped down version of the $schema Schema API array containing, for\n   *   each table, only the key and index definitions not derived from field\n   *   storage definitions.\n   *\/",575],["T_WHITESPACE","\n  ",587],["T_PROTECTED","protected",588],["T_WHITESPACE"," ",588],["T_FUNCTION","function",588],["T_WHITESPACE"," ",588],["T_STRING","getEntitySchemaData",588],"(",["T_STRING","ContentEntityTypeInterface",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$entity_type",588],",",["T_WHITESPACE"," ",588],["T_ARRAY","array",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$schema",588],")",["T_WHITESPACE"," ",588],"{",["T_WHITESPACE","\n    ",588],["T_VARIABLE","$entity_type_id",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_VARIABLE","$entity_type",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","id",589],"(",")",";",["T_WHITESPACE","\n\n    ",589],["T_COMMENT","\/\/ Collect all possible field schema identifiers for shared table fields.\n",591],["T_WHITESPACE","    ",592],["T_COMMENT","\/\/ These will be used to detect entity schema data in the subsequent loop.\n",592],["T_WHITESPACE","    ",593],["T_VARIABLE","$field_schema_identifiers",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],"[","]",";",["T_WHITESPACE","\n    ",593],["T_VARIABLE","$storage_definitions",594],["T_WHITESPACE"," ",594],"=",["T_WHITESPACE"," ",594],["T_VARIABLE","$this",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","entityManager",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getFieldStorageDefinitions",594],"(",["T_VARIABLE","$entity_type_id",594],")",";",["T_WHITESPACE","\n    ",594],["T_VARIABLE","$table_mapping",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","storage",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getTableMapping",595],"(",["T_VARIABLE","$storage_definitions",595],")",";",["T_WHITESPACE","\n    ",595],["T_FOREACH","foreach",596],["T_WHITESPACE"," ",596],"(",["T_VARIABLE","$storage_definitions",596],["T_WHITESPACE"," ",596],["T_AS","as",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$field_name",596],["T_WHITESPACE"," ",596],["T_DOUBLE_ARROW","=>",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$storage_definition",596],")",["T_WHITESPACE"," ",596],"{",["T_WHITESPACE","\n      ",596],["T_IF","if",597],["T_WHITESPACE"," ",597],"(",["T_VARIABLE","$table_mapping",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","allowsSharedTableStorage",597],"(",["T_VARIABLE","$storage_definition",597],")",")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n        ",597],["T_COMMENT","\/\/ Make sure both base identifier names and suffixed names are listed.\n",598],["T_WHITESPACE","        ",599],["T_VARIABLE","$name",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","getFieldSchemaIdentifierName",599],"(",["T_VARIABLE","$entity_type_id",599],",",["T_WHITESPACE"," ",599],["T_VARIABLE","$field_name",599],")",";",["T_WHITESPACE","\n        ",599],["T_VARIABLE","$field_schema_identifiers",600],"[",["T_VARIABLE","$name",600],"]",["T_WHITESPACE"," ",600],"=",["T_WHITESPACE"," ",600],["T_VARIABLE","$name",600],";",["T_WHITESPACE","\n        ",600],["T_FOREACH","foreach",601],["T_WHITESPACE"," ",601],"(",["T_VARIABLE","$storage_definition",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getColumns",601],"(",")",["T_WHITESPACE"," ",601],["T_AS","as",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$key",601],["T_WHITESPACE"," ",601],["T_DOUBLE_ARROW","=>",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$columns",601],")",["T_WHITESPACE"," ",601],"{",["T_WHITESPACE","\n          ",601],["T_VARIABLE","$name",602],["T_WHITESPACE"," ",602],"=",["T_WHITESPACE"," ",602],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getFieldSchemaIdentifierName",602],"(",["T_VARIABLE","$entity_type_id",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$field_name",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$key",602],")",";",["T_WHITESPACE","\n          ",602],["T_VARIABLE","$field_schema_identifiers",603],"[",["T_VARIABLE","$name",603],"]",["T_WHITESPACE"," ",603],"=",["T_WHITESPACE"," ",603],["T_VARIABLE","$name",603],";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n      ",604],"}",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_COMMENT","\/\/ Extract entity schema data from the Schema API definition.\n",608],["T_WHITESPACE","    ",609],["T_VARIABLE","$schema_data",609],["T_WHITESPACE"," ",609],"=",["T_WHITESPACE"," ",609],"[","]",";",["T_WHITESPACE","\n    ",609],["T_VARIABLE","$keys",610],["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",610],",",["T_WHITESPACE"," ",610],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",610],"]",";",["T_WHITESPACE","\n    ",610],["T_VARIABLE","$unused_keys",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_STRING","array_flip",611],"(","[",["T_CONSTANT_ENCAPSED_STRING","'description'",611],",",["T_WHITESPACE"," ",611],["T_CONSTANT_ENCAPSED_STRING","'fields'",611],",",["T_WHITESPACE"," ",611],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",611],"]",")",";",["T_WHITESPACE","\n    ",611],["T_FOREACH","foreach",612],["T_WHITESPACE"," ",612],"(",["T_VARIABLE","$schema",612],["T_WHITESPACE"," ",612],["T_AS","as",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$table_name",612],["T_WHITESPACE"," ",612],["T_DOUBLE_ARROW","=>",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$table_schema",612],")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n      ",612],["T_VARIABLE","$table_schema",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_STRING","array_diff_key",613],"(",["T_VARIABLE","$table_schema",613],",",["T_WHITESPACE"," ",613],["T_VARIABLE","$unused_keys",613],")",";",["T_WHITESPACE","\n      ",613],["T_FOREACH","foreach",614],["T_WHITESPACE"," ",614],"(",["T_VARIABLE","$keys",614],["T_WHITESPACE"," ",614],["T_AS","as",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$key",614],")",["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n        ",614],["T_COMMENT","\/\/ Exclude data generated from field storage definitions, we will check\n",615],["T_WHITESPACE","        ",616],["T_COMMENT","\/\/ that separately.\n",616],["T_WHITESPACE","        ",617],["T_IF","if",617],["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$field_schema_identifiers",617],["T_WHITESPACE"," ",617],["T_BOOLEAN_AND","&&",617],["T_WHITESPACE"," ",617],"!",["T_EMPTY","empty",617],"(",["T_VARIABLE","$table_schema",617],"[",["T_VARIABLE","$key",617],"]",")",")",["T_WHITESPACE"," ",617],"{",["T_WHITESPACE","\n          ",617],["T_VARIABLE","$table_schema",618],"[",["T_VARIABLE","$key",618],"]",["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_STRING","array_diff_key",618],"(",["T_VARIABLE","$table_schema",618],"[",["T_VARIABLE","$key",618],"]",",",["T_WHITESPACE"," ",618],["T_VARIABLE","$field_schema_identifiers",618],")",";",["T_WHITESPACE","\n        ",618],"}",["T_WHITESPACE","\n      ",619],"}",["T_WHITESPACE","\n      ",620],["T_VARIABLE","$schema_data",621],"[",["T_VARIABLE","$table_name",621],"]",["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_STRING","array_filter",621],"(",["T_VARIABLE","$table_schema",621],")",";",["T_WHITESPACE","\n    ",621],"}",["T_WHITESPACE","\n\n    ",622],["T_RETURN","return",624],["T_WHITESPACE"," ",624],["T_VARIABLE","$schema_data",624],";",["T_WHITESPACE","\n  ",624],"}",["T_WHITESPACE","\n\n  ",625],["T_DOC_COMMENT","\/**\n   * Gets an index schema array for a given field.\n   *\n   * @param string $field_name\n   *   The name of the field.\n   * @param array $field_schema\n   *   The schema of the field.\n   * @param string[] $column_mapping\n   *   A mapping of field column names to database column names.\n   *\n   * @return array\n   *   The schema definition for the indexes.\n   *\/",627],["T_WHITESPACE","\n  ",639],["T_PROTECTED","protected",640],["T_WHITESPACE"," ",640],["T_FUNCTION","function",640],["T_WHITESPACE"," ",640],["T_STRING","getFieldIndexes",640],"(",["T_VARIABLE","$field_name",640],",",["T_WHITESPACE"," ",640],["T_ARRAY","array",640],["T_WHITESPACE"," ",640],["T_VARIABLE","$field_schema",640],",",["T_WHITESPACE"," ",640],["T_ARRAY","array",640],["T_WHITESPACE"," ",640],["T_VARIABLE","$column_mapping",640],")",["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n    ",640],["T_RETURN","return",641],["T_WHITESPACE"," ",641],["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getFieldSchemaData",641],"(",["T_VARIABLE","$field_name",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$field_schema",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$column_mapping",641],",",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'indexes'",641],")",";",["T_WHITESPACE","\n  ",641],"}",["T_WHITESPACE","\n\n  ",642],["T_DOC_COMMENT","\/**\n   * Gets a unique key schema array for a given field.\n   *\n   * @param string $field_name\n   *   The name of the field.\n   * @param array $field_schema\n   *   The schema of the field.\n   * @param string[] $column_mapping\n   *   A mapping of field column names to database column names.\n   *\n   * @return array\n   *   The schema definition for the unique keys.\n   *\/",644],["T_WHITESPACE","\n  ",656],["T_PROTECTED","protected",657],["T_WHITESPACE"," ",657],["T_FUNCTION","function",657],["T_WHITESPACE"," ",657],["T_STRING","getFieldUniqueKeys",657],"(",["T_VARIABLE","$field_name",657],",",["T_WHITESPACE"," ",657],["T_ARRAY","array",657],["T_WHITESPACE"," ",657],["T_VARIABLE","$field_schema",657],",",["T_WHITESPACE"," ",657],["T_ARRAY","array",657],["T_WHITESPACE"," ",657],["T_VARIABLE","$column_mapping",657],")",["T_WHITESPACE"," ",657],"{",["T_WHITESPACE","\n    ",657],["T_RETURN","return",658],["T_WHITESPACE"," ",658],["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","getFieldSchemaData",658],"(",["T_VARIABLE","$field_name",658],",",["T_WHITESPACE"," ",658],["T_VARIABLE","$field_schema",658],",",["T_WHITESPACE"," ",658],["T_VARIABLE","$column_mapping",658],",",["T_WHITESPACE"," ",658],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",658],")",";",["T_WHITESPACE","\n  ",658],"}",["T_WHITESPACE","\n\n  ",659],["T_DOC_COMMENT","\/**\n   * Gets field schema data for the given key.\n   *\n   * @param string $field_name\n   *   The name of the field.\n   * @param array $field_schema\n   *   The schema of the field.\n   * @param string[] $column_mapping\n   *   A mapping of field column names to database column names.\n   * @param string $schema_key\n   *   The type of schema data. Either 'indexes' or 'unique keys'.\n   *\n   * @return array\n   *   The schema definition for the specified key.\n   *\/",661],["T_WHITESPACE","\n  ",675],["T_PROTECTED","protected",676],["T_WHITESPACE"," ",676],["T_FUNCTION","function",676],["T_WHITESPACE"," ",676],["T_STRING","getFieldSchemaData",676],"(",["T_VARIABLE","$field_name",676],",",["T_WHITESPACE"," ",676],["T_ARRAY","array",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$field_schema",676],",",["T_WHITESPACE"," ",676],["T_ARRAY","array",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$column_mapping",676],",",["T_WHITESPACE"," ",676],["T_VARIABLE","$schema_key",676],")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n    ",676],["T_VARIABLE","$data",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_ARRAY","array",677],"(",")",";",["T_WHITESPACE","\n\n    ",677],["T_FOREACH","foreach",679],["T_WHITESPACE"," ",679],"(",["T_VARIABLE","$field_schema",679],"[",["T_VARIABLE","$schema_key",679],"]",["T_WHITESPACE"," ",679],["T_AS","as",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$key",679],["T_WHITESPACE"," ",679],["T_DOUBLE_ARROW","=>",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$columns",679],")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n      ",679],["T_COMMENT","\/\/ To avoid clashes with entity-level indexes or unique keys we use\n",680],["T_WHITESPACE","      ",681],["T_COMMENT","\/\/ \"{$entity_type_id}_field__\" as a prefix instead of just\n",681],["T_WHITESPACE","      ",682],["T_COMMENT","\/\/ \"{$entity_type_id}__\". We additionally namespace the specifier by the\n",682],["T_WHITESPACE","      ",683],["T_COMMENT","\/\/ field name to avoid clashes when multiple fields of the same type are\n",683],["T_WHITESPACE","      ",684],["T_COMMENT","\/\/ added to an entity type.\n",684],["T_WHITESPACE","      ",685],["T_VARIABLE","$entity_type_id",685],["T_WHITESPACE"," ",685],"=",["T_WHITESPACE"," ",685],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","entityType",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","id",685],"(",")",";",["T_WHITESPACE","\n      ",685],["T_VARIABLE","$real_key",686],["T_WHITESPACE"," ",686],"=",["T_WHITESPACE"," ",686],["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getFieldSchemaIdentifierName",686],"(",["T_VARIABLE","$entity_type_id",686],",",["T_WHITESPACE"," ",686],["T_VARIABLE","$field_name",686],",",["T_WHITESPACE"," ",686],["T_VARIABLE","$key",686],")",";",["T_WHITESPACE","\n      ",686],["T_FOREACH","foreach",687],["T_WHITESPACE"," ",687],"(",["T_VARIABLE","$columns",687],["T_WHITESPACE"," ",687],["T_AS","as",687],["T_WHITESPACE"," ",687],["T_VARIABLE","$column",687],")",["T_WHITESPACE"," ",687],"{",["T_WHITESPACE","\n        ",687],["T_COMMENT","\/\/ Allow for indexes and unique keys to specified as an array of column\n",688],["T_WHITESPACE","        ",689],["T_COMMENT","\/\/ name and length.\n",689],["T_WHITESPACE","        ",690],["T_IF","if",690],["T_WHITESPACE"," ",690],"(",["T_STRING","is_array",690],"(",["T_VARIABLE","$column",690],")",")",["T_WHITESPACE"," ",690],"{",["T_WHITESPACE","\n          ",690],["T_LIST","list",691],"(",["T_VARIABLE","$column_name",691],",",["T_WHITESPACE"," ",691],["T_VARIABLE","$length",691],")",["T_WHITESPACE"," ",691],"=",["T_WHITESPACE"," ",691],["T_VARIABLE","$column",691],";",["T_WHITESPACE","\n          ",691],["T_VARIABLE","$data",692],"[",["T_VARIABLE","$real_key",692],"]","[","]",["T_WHITESPACE"," ",692],"=",["T_WHITESPACE"," ",692],["T_ARRAY","array",692],"(",["T_VARIABLE","$column_mapping",692],"[",["T_VARIABLE","$column_name",692],"]",",",["T_WHITESPACE"," ",692],["T_VARIABLE","$length",692],")",";",["T_WHITESPACE","\n        ",692],"}",["T_WHITESPACE","\n        ",693],["T_ELSE","else",694],["T_WHITESPACE"," ",694],"{",["T_WHITESPACE","\n          ",694],["T_VARIABLE","$data",695],"[",["T_VARIABLE","$real_key",695],"]","[","]",["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_VARIABLE","$column_mapping",695],"[",["T_VARIABLE","$column",695],"]",";",["T_WHITESPACE","\n        ",695],"}",["T_WHITESPACE","\n      ",696],"}",["T_WHITESPACE","\n    ",697],"}",["T_WHITESPACE","\n\n    ",698],["T_RETURN","return",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$data",700],";",["T_WHITESPACE","\n  ",700],"}",["T_WHITESPACE","\n\n  ",701],["T_DOC_COMMENT","\/**\n   * Generates a safe schema identifier (name of an index, column name etc.).\n   *\n   * @param string $entity_type_id\n   *   The ID of the entity type.\n   * @param string $field_name\n   *   The name of the field.\n   * @param string|null $key\n   *   (optional) A further key to append to the name.\n   *\n   * @return string\n   *   The field identifier name.\n   *\/",703],["T_WHITESPACE","\n  ",715],["T_PROTECTED","protected",716],["T_WHITESPACE"," ",716],["T_FUNCTION","function",716],["T_WHITESPACE"," ",716],["T_STRING","getFieldSchemaIdentifierName",716],"(",["T_VARIABLE","$entity_type_id",716],",",["T_WHITESPACE"," ",716],["T_VARIABLE","$field_name",716],",",["T_WHITESPACE"," ",716],["T_VARIABLE","$key",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],["T_STRING","NULL",716],")",["T_WHITESPACE"," ",716],"{",["T_WHITESPACE","\n    ",716],["T_VARIABLE","$real_key",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_ISSET","isset",717],"(",["T_VARIABLE","$key",717],")",["T_WHITESPACE"," ",717],"?",["T_WHITESPACE"," ",717],"\"",["T_CURLY_OPEN","{",717],["T_VARIABLE","$entity_type_id",717],"}",["T_ENCAPSED_AND_WHITESPACE","_field__",717],["T_CURLY_OPEN","{",717],["T_VARIABLE","$field_name",717],"}",["T_ENCAPSED_AND_WHITESPACE","__",717],["T_CURLY_OPEN","{",717],["T_VARIABLE","$key",717],"}","\"",["T_WHITESPACE"," ",717],":",["T_WHITESPACE"," ",717],"\"",["T_CURLY_OPEN","{",717],["T_VARIABLE","$entity_type_id",717],"}",["T_ENCAPSED_AND_WHITESPACE","_field__",717],["T_CURLY_OPEN","{",717],["T_VARIABLE","$field_name",717],"}","\"",";",["T_WHITESPACE","\n    ",717],["T_COMMENT","\/\/ Limit the string to 48 characters, keeping a 16 characters margin for db\n",718],["T_WHITESPACE","    ",719],["T_COMMENT","\/\/ prefixes.\n",719],["T_WHITESPACE","    ",720],["T_IF","if",720],["T_WHITESPACE"," ",720],"(",["T_STRING","strlen",720],"(",["T_VARIABLE","$real_key",720],")",["T_WHITESPACE"," ",720],">",["T_WHITESPACE"," ",720],["T_LNUMBER","48",720],")",["T_WHITESPACE"," ",720],"{",["T_WHITESPACE","\n      ",720],["T_COMMENT","\/\/ Use a shorter separator, a truncated entity_type, and a hash of the\n",721],["T_WHITESPACE","      ",722],["T_COMMENT","\/\/ field name.\n",722],["T_WHITESPACE","      ",723],["T_COMMENT","\/\/ Truncate to the same length for the current and revision tables.\n",723],["T_WHITESPACE","      ",724],["T_VARIABLE","$entity_type",724],["T_WHITESPACE"," ",724],"=",["T_WHITESPACE"," ",724],["T_STRING","substr",724],"(",["T_VARIABLE","$entity_type_id",724],",",["T_WHITESPACE"," ",724],["T_LNUMBER","0",724],",",["T_WHITESPACE"," ",724],["T_LNUMBER","36",724],")",";",["T_WHITESPACE","\n      ",724],["T_VARIABLE","$field_hash",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","substr",725],"(",["T_STRING","hash",725],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",725],",",["T_WHITESPACE"," ",725],["T_VARIABLE","$real_key",725],")",",",["T_WHITESPACE"," ",725],["T_LNUMBER","0",725],",",["T_WHITESPACE"," ",725],["T_LNUMBER","10",725],")",";",["T_WHITESPACE","\n      ",725],["T_VARIABLE","$real_key",726],["T_WHITESPACE"," ",726],"=",["T_WHITESPACE"," ",726],["T_VARIABLE","$entity_type",726],["T_WHITESPACE"," ",726],".",["T_WHITESPACE"," ",726],["T_CONSTANT_ENCAPSED_STRING","'__'",726],["T_WHITESPACE"," ",726],".",["T_WHITESPACE"," ",726],["T_VARIABLE","$field_hash",726],";",["T_WHITESPACE","\n    ",726],"}",["T_WHITESPACE","\n    ",727],["T_RETURN","return",728],["T_WHITESPACE"," ",728],["T_VARIABLE","$real_key",728],";",["T_WHITESPACE","\n  ",728],"}",["T_WHITESPACE","\n\n  ",729],["T_DOC_COMMENT","\/**\n   * Gets field foreign keys.\n   *\n   * @param string $field_name\n   *   The name of the field.\n   * @param array $field_schema\n   *   The schema of the field.\n   * @param string[] $column_mapping\n   *   A mapping of field column names to database column names.\n   *\n   * @return array\n   *   The schema definition for the foreign keys.\n   *\/",731],["T_WHITESPACE","\n  ",743],["T_PROTECTED","protected",744],["T_WHITESPACE"," ",744],["T_FUNCTION","function",744],["T_WHITESPACE"," ",744],["T_STRING","getFieldForeignKeys",744],"(",["T_VARIABLE","$field_name",744],",",["T_WHITESPACE"," ",744],["T_ARRAY","array",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$field_schema",744],",",["T_WHITESPACE"," ",744],["T_ARRAY","array",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$column_mapping",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n    ",744],["T_VARIABLE","$foreign_keys",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_ARRAY","array",745],"(",")",";",["T_WHITESPACE","\n\n    ",745],["T_FOREACH","foreach",747],["T_WHITESPACE"," ",747],"(",["T_VARIABLE","$field_schema",747],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",747],"]",["T_WHITESPACE"," ",747],["T_AS","as",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$specifier",747],["T_WHITESPACE"," ",747],["T_DOUBLE_ARROW","=>",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$specification",747],")",["T_WHITESPACE"," ",747],"{",["T_WHITESPACE","\n      ",747],["T_COMMENT","\/\/ To avoid clashes with entity-level foreign keys we use\n",748],["T_WHITESPACE","      ",749],["T_COMMENT","\/\/ \"{$entity_type_id}_field__\" as a prefix instead of just\n",749],["T_WHITESPACE","      ",750],["T_COMMENT","\/\/ \"{$entity_type_id}__\". We additionally namespace the specifier by the\n",750],["T_WHITESPACE","      ",751],["T_COMMENT","\/\/ field name to avoid clashes when multiple fields of the same type are\n",751],["T_WHITESPACE","      ",752],["T_COMMENT","\/\/ added to an entity type.\n",752],["T_WHITESPACE","      ",753],["T_VARIABLE","$entity_type_id",753],["T_WHITESPACE"," ",753],"=",["T_WHITESPACE"," ",753],["T_VARIABLE","$this",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","entityType",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","id",753],"(",")",";",["T_WHITESPACE","\n      ",753],["T_VARIABLE","$real_specifier",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],"\"",["T_CURLY_OPEN","{",754],["T_VARIABLE","$entity_type_id",754],"}",["T_ENCAPSED_AND_WHITESPACE","_field__",754],["T_CURLY_OPEN","{",754],["T_VARIABLE","$field_name",754],"}",["T_ENCAPSED_AND_WHITESPACE","__",754],["T_CURLY_OPEN","{",754],["T_VARIABLE","$specifier",754],"}","\"",";",["T_WHITESPACE","\n      ",754],["T_VARIABLE","$foreign_keys",755],"[",["T_VARIABLE","$real_specifier",755],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",755],"]",["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_VARIABLE","$specification",755],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",755],"]",";",["T_WHITESPACE","\n      ",755],["T_FOREACH","foreach",756],["T_WHITESPACE"," ",756],"(",["T_VARIABLE","$specification",756],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",756],"]",["T_WHITESPACE"," ",756],["T_AS","as",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$column",756],["T_WHITESPACE"," ",756],["T_DOUBLE_ARROW","=>",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$referenced",756],")",["T_WHITESPACE"," ",756],"{",["T_WHITESPACE","\n        ",756],["T_VARIABLE","$foreign_keys",757],"[",["T_VARIABLE","$real_specifier",757],"]","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",757],"]","[",["T_VARIABLE","$column_mapping",757],"[",["T_VARIABLE","$column",757],"]","]",["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_VARIABLE","$referenced",757],";",["T_WHITESPACE","\n      ",757],"}",["T_WHITESPACE","\n    ",758],"}",["T_WHITESPACE","\n\n    ",759],["T_RETURN","return",761],["T_WHITESPACE"," ",761],["T_VARIABLE","$foreign_keys",761],";",["T_WHITESPACE","\n  ",761],"}",["T_WHITESPACE","\n\n  ",762],["T_DOC_COMMENT","\/**\n   * Loads stored schema data for the given entity type definition.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   *\n   * @return array\n   *   The entity schema data array.\n   *\/",764],["T_WHITESPACE","\n  ",772],["T_PROTECTED","protected",773],["T_WHITESPACE"," ",773],["T_FUNCTION","function",773],["T_WHITESPACE"," ",773],["T_STRING","loadEntitySchemaData",773],"(",["T_STRING","EntityTypeInterface",773],["T_WHITESPACE"," ",773],["T_VARIABLE","$entity_type",773],")",["T_WHITESPACE"," ",773],"{",["T_WHITESPACE","\n    ",773],["T_RETURN","return",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$this",774],["T_OBJECT_OPERATOR","->",774],["T_STRING","installedStorageSchema",774],"(",")",["T_OBJECT_OPERATOR","->",774],["T_STRING","get",774],"(",["T_VARIABLE","$entity_type",774],["T_OBJECT_OPERATOR","->",774],["T_STRING","id",774],"(",")",["T_WHITESPACE"," ",774],".",["T_WHITESPACE"," ",774],["T_CONSTANT_ENCAPSED_STRING","'.entity_schema_data'",774],",",["T_WHITESPACE"," ",774],["T_ARRAY","array",774],"(",")",")",";",["T_WHITESPACE","\n  ",774],"}",["T_WHITESPACE","\n\n  ",775],["T_DOC_COMMENT","\/**\n   * Stores schema data for the given entity type definition.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param array $schema\n   *   The entity schema data array.\n   *\/",777],["T_WHITESPACE","\n  ",784],["T_PROTECTED","protected",785],["T_WHITESPACE"," ",785],["T_FUNCTION","function",785],["T_WHITESPACE"," ",785],["T_STRING","saveEntitySchemaData",785],"(",["T_STRING","EntityTypeInterface",785],["T_WHITESPACE"," ",785],["T_VARIABLE","$entity_type",785],",",["T_WHITESPACE"," ",785],["T_VARIABLE","$schema",785],")",["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n    ",785],["T_VARIABLE","$data",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getEntitySchemaData",786],"(",["T_VARIABLE","$entity_type",786],",",["T_WHITESPACE"," ",786],["T_VARIABLE","$schema",786],")",";",["T_WHITESPACE","\n    ",786],["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","installedStorageSchema",787],"(",")",["T_OBJECT_OPERATOR","->",787],["T_STRING","set",787],"(",["T_VARIABLE","$entity_type",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","id",787],"(",")",["T_WHITESPACE"," ",787],".",["T_WHITESPACE"," ",787],["T_CONSTANT_ENCAPSED_STRING","'.entity_schema_data'",787],",",["T_WHITESPACE"," ",787],["T_VARIABLE","$data",787],")",";",["T_WHITESPACE","\n  ",787],"}",["T_WHITESPACE","\n\n  ",788],["T_DOC_COMMENT","\/**\n   * Deletes schema data for the given entity type definition.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   *\/",790],["T_WHITESPACE","\n  ",795],["T_PROTECTED","protected",796],["T_WHITESPACE"," ",796],["T_FUNCTION","function",796],["T_WHITESPACE"," ",796],["T_STRING","deleteEntitySchemaData",796],"(",["T_STRING","EntityTypeInterface",796],["T_WHITESPACE"," ",796],["T_VARIABLE","$entity_type",796],")",["T_WHITESPACE"," ",796],"{",["T_WHITESPACE","\n    ",796],["T_VARIABLE","$this",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","installedStorageSchema",797],"(",")",["T_OBJECT_OPERATOR","->",797],["T_STRING","delete",797],"(",["T_VARIABLE","$entity_type",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","id",797],"(",")",["T_WHITESPACE"," ",797],".",["T_WHITESPACE"," ",797],["T_CONSTANT_ENCAPSED_STRING","'.entity_schema_data'",797],")",";",["T_WHITESPACE","\n  ",797],"}",["T_WHITESPACE","\n\n  ",798],["T_DOC_COMMENT","\/**\n   * Loads stored schema data for the given field storage definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   *\n   * @return array\n   *   The field schema data array.\n   *\/",800],["T_WHITESPACE","\n  ",808],["T_PROTECTED","protected",809],["T_WHITESPACE"," ",809],["T_FUNCTION","function",809],["T_WHITESPACE"," ",809],["T_STRING","loadFieldSchemaData",809],"(",["T_STRING","FieldStorageDefinitionInterface",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$storage_definition",809],")",["T_WHITESPACE"," ",809],"{",["T_WHITESPACE","\n    ",809],["T_RETURN","return",810],["T_WHITESPACE"," ",810],["T_VARIABLE","$this",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","installedStorageSchema",810],"(",")",["T_OBJECT_OPERATOR","->",810],["T_STRING","get",810],"(",["T_VARIABLE","$storage_definition",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","getTargetEntityTypeId",810],"(",")",["T_WHITESPACE"," ",810],".",["T_WHITESPACE"," ",810],["T_CONSTANT_ENCAPSED_STRING","'.field_schema_data.'",810],["T_WHITESPACE"," ",810],".",["T_WHITESPACE"," ",810],["T_VARIABLE","$storage_definition",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","getName",810],"(",")",",",["T_WHITESPACE"," ",810],["T_ARRAY","array",810],"(",")",")",";",["T_WHITESPACE","\n  ",810],"}",["T_WHITESPACE","\n\n  ",811],["T_DOC_COMMENT","\/**\n   * Stores schema data for the given field storage definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   * @param array $schema\n   *   The field schema data array.\n   *\/",813],["T_WHITESPACE","\n  ",820],["T_PROTECTED","protected",821],["T_WHITESPACE"," ",821],["T_FUNCTION","function",821],["T_WHITESPACE"," ",821],["T_STRING","saveFieldSchemaData",821],"(",["T_STRING","FieldStorageDefinitionInterface",821],["T_WHITESPACE"," ",821],["T_VARIABLE","$storage_definition",821],",",["T_WHITESPACE"," ",821],["T_VARIABLE","$schema",821],")",["T_WHITESPACE"," ",821],"{",["T_WHITESPACE","\n    ",821],["T_VARIABLE","$this",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","installedStorageSchema",822],"(",")",["T_OBJECT_OPERATOR","->",822],["T_STRING","set",822],"(",["T_VARIABLE","$storage_definition",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","getTargetEntityTypeId",822],"(",")",["T_WHITESPACE"," ",822],".",["T_WHITESPACE"," ",822],["T_CONSTANT_ENCAPSED_STRING","'.field_schema_data.'",822],["T_WHITESPACE"," ",822],".",["T_WHITESPACE"," ",822],["T_VARIABLE","$storage_definition",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","getName",822],"(",")",",",["T_WHITESPACE"," ",822],["T_VARIABLE","$schema",822],")",";",["T_WHITESPACE","\n  ",822],"}",["T_WHITESPACE","\n\n  ",823],["T_DOC_COMMENT","\/**\n   * Deletes schema data for the given field storage definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   *\/",825],["T_WHITESPACE","\n  ",830],["T_PROTECTED","protected",831],["T_WHITESPACE"," ",831],["T_FUNCTION","function",831],["T_WHITESPACE"," ",831],["T_STRING","deleteFieldSchemaData",831],"(",["T_STRING","FieldStorageDefinitionInterface",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$storage_definition",831],")",["T_WHITESPACE"," ",831],"{",["T_WHITESPACE","\n    ",831],["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","installedStorageSchema",832],"(",")",["T_OBJECT_OPERATOR","->",832],["T_STRING","delete",832],"(",["T_VARIABLE","$storage_definition",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","getTargetEntityTypeId",832],"(",")",["T_WHITESPACE"," ",832],".",["T_WHITESPACE"," ",832],["T_CONSTANT_ENCAPSED_STRING","'.field_schema_data.'",832],["T_WHITESPACE"," ",832],".",["T_WHITESPACE"," ",832],["T_VARIABLE","$storage_definition",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","getName",832],"(",")",")",";",["T_WHITESPACE","\n  ",832],"}",["T_WHITESPACE","\n\n  ",833],["T_DOC_COMMENT","\/**\n   * Initializes common information for a base table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   *\n   * @return array\n   *   A partial schema array for the base table.\n   *\/",835],["T_WHITESPACE","\n  ",843],["T_PROTECTED","protected",844],["T_WHITESPACE"," ",844],["T_FUNCTION","function",844],["T_WHITESPACE"," ",844],["T_STRING","initializeBaseTable",844],"(",["T_STRING","ContentEntityTypeInterface",844],["T_WHITESPACE"," ",844],["T_VARIABLE","$entity_type",844],")",["T_WHITESPACE"," ",844],"{",["T_WHITESPACE","\n    ",844],["T_VARIABLE","$entity_type_id",845],["T_WHITESPACE"," ",845],"=",["T_WHITESPACE"," ",845],["T_VARIABLE","$entity_type",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","id",845],"(",")",";",["T_WHITESPACE","\n\n    ",845],["T_VARIABLE","$schema",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_ARRAY","array",847],"(",["T_WHITESPACE","\n      ",847],["T_CONSTANT_ENCAPSED_STRING","'description'",848],["T_WHITESPACE"," ",848],["T_DOUBLE_ARROW","=>",848],["T_WHITESPACE"," ",848],"\"",["T_ENCAPSED_AND_WHITESPACE","The base table for ",848],["T_VARIABLE","$entity_type_id",848],["T_ENCAPSED_AND_WHITESPACE"," entities.",848],"\"",",",["T_WHITESPACE","\n      ",848],["T_CONSTANT_ENCAPSED_STRING","'primary key'",849],["T_WHITESPACE"," ",849],["T_DOUBLE_ARROW","=>",849],["T_WHITESPACE"," ",849],["T_ARRAY","array",849],"(",["T_VARIABLE","$entity_type",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","getKey",849],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",849],")",")",",",["T_WHITESPACE","\n      ",849],["T_CONSTANT_ENCAPSED_STRING","'indexes'",850],["T_WHITESPACE"," ",850],["T_DOUBLE_ARROW","=>",850],["T_WHITESPACE"," ",850],["T_ARRAY","array",850],"(",")",",",["T_WHITESPACE","\n      ",850],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",851],["T_WHITESPACE"," ",851],["T_DOUBLE_ARROW","=>",851],["T_WHITESPACE"," ",851],["T_ARRAY","array",851],"(",")",",",["T_WHITESPACE","\n    ",851],")",";",["T_WHITESPACE","\n\n    ",852],["T_IF","if",854],["T_WHITESPACE"," ",854],"(",["T_VARIABLE","$entity_type",854],["T_OBJECT_OPERATOR","->",854],["T_STRING","hasKey",854],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",854],")",")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n      ",854],["T_VARIABLE","$revision_key",855],["T_WHITESPACE"," ",855],"=",["T_WHITESPACE"," ",855],["T_VARIABLE","$entity_type",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","getKey",855],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",855],")",";",["T_WHITESPACE","\n      ",855],["T_VARIABLE","$key_name",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_VARIABLE","$this",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","getEntityIndexName",856],"(",["T_VARIABLE","$entity_type",856],",",["T_WHITESPACE"," ",856],["T_VARIABLE","$revision_key",856],")",";",["T_WHITESPACE","\n      ",856],["T_VARIABLE","$schema",857],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",857],"]","[",["T_VARIABLE","$key_name",857],"]",["T_WHITESPACE"," ",857],"=",["T_WHITESPACE"," ",857],["T_ARRAY","array",857],"(",["T_VARIABLE","$revision_key",857],")",";",["T_WHITESPACE","\n      ",857],["T_VARIABLE","$schema",858],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",858],"]","[",["T_VARIABLE","$entity_type_id",858],["T_WHITESPACE"," ",858],".",["T_WHITESPACE"," ",858],["T_CONSTANT_ENCAPSED_STRING","'__revision'",858],"]",["T_WHITESPACE"," ",858],"=",["T_WHITESPACE"," ",858],["T_ARRAY","array",858],"(",["T_WHITESPACE","\n        ",858],["T_CONSTANT_ENCAPSED_STRING","'table'",859],["T_WHITESPACE"," ",859],["T_DOUBLE_ARROW","=>",859],["T_WHITESPACE"," ",859],["T_VARIABLE","$this",859],["T_OBJECT_OPERATOR","->",859],["T_STRING","storage",859],["T_OBJECT_OPERATOR","->",859],["T_STRING","getRevisionTable",859],"(",")",",",["T_WHITESPACE","\n        ",859],["T_CONSTANT_ENCAPSED_STRING","'columns'",860],["T_WHITESPACE"," ",860],["T_DOUBLE_ARROW","=>",860],["T_WHITESPACE"," ",860],["T_ARRAY","array",860],"(",["T_VARIABLE","$revision_key",860],["T_WHITESPACE"," ",860],["T_DOUBLE_ARROW","=>",860],["T_WHITESPACE"," ",860],["T_VARIABLE","$revision_key",860],")",",",["T_WHITESPACE","\n      ",860],")",";",["T_WHITESPACE","\n    ",861],"}",["T_WHITESPACE","\n\n    ",862],["T_VARIABLE","$this",864],["T_OBJECT_OPERATOR","->",864],["T_STRING","addTableDefaults",864],"(",["T_VARIABLE","$schema",864],")",";",["T_WHITESPACE","\n\n    ",864],["T_RETURN","return",866],["T_WHITESPACE"," ",866],["T_VARIABLE","$schema",866],";",["T_WHITESPACE","\n  ",866],"}",["T_WHITESPACE","\n\n  ",867],["T_DOC_COMMENT","\/**\n   * Initializes common information for a revision table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   *\n   * @return array\n   *   A partial schema array for the revision table.\n   *\/",869],["T_WHITESPACE","\n  ",877],["T_PROTECTED","protected",878],["T_WHITESPACE"," ",878],["T_FUNCTION","function",878],["T_WHITESPACE"," ",878],["T_STRING","initializeRevisionTable",878],"(",["T_STRING","ContentEntityTypeInterface",878],["T_WHITESPACE"," ",878],["T_VARIABLE","$entity_type",878],")",["T_WHITESPACE"," ",878],"{",["T_WHITESPACE","\n    ",878],["T_VARIABLE","$entity_type_id",879],["T_WHITESPACE"," ",879],"=",["T_WHITESPACE"," ",879],["T_VARIABLE","$entity_type",879],["T_OBJECT_OPERATOR","->",879],["T_STRING","id",879],"(",")",";",["T_WHITESPACE","\n    ",879],["T_VARIABLE","$id_key",880],["T_WHITESPACE"," ",880],"=",["T_WHITESPACE"," ",880],["T_VARIABLE","$entity_type",880],["T_OBJECT_OPERATOR","->",880],["T_STRING","getKey",880],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",880],")",";",["T_WHITESPACE","\n    ",880],["T_VARIABLE","$revision_key",881],["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_VARIABLE","$entity_type",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getKey",881],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",881],")",";",["T_WHITESPACE","\n\n    ",881],["T_VARIABLE","$schema",883],["T_WHITESPACE"," ",883],"=",["T_WHITESPACE"," ",883],["T_ARRAY","array",883],"(",["T_WHITESPACE","\n      ",883],["T_CONSTANT_ENCAPSED_STRING","'description'",884],["T_WHITESPACE"," ",884],["T_DOUBLE_ARROW","=>",884],["T_WHITESPACE"," ",884],"\"",["T_ENCAPSED_AND_WHITESPACE","The revision table for ",884],["T_VARIABLE","$entity_type_id",884],["T_ENCAPSED_AND_WHITESPACE"," entities.",884],"\"",",",["T_WHITESPACE","\n      ",884],["T_CONSTANT_ENCAPSED_STRING","'primary key'",885],["T_WHITESPACE"," ",885],["T_DOUBLE_ARROW","=>",885],["T_WHITESPACE"," ",885],["T_ARRAY","array",885],"(",["T_VARIABLE","$revision_key",885],")",",",["T_WHITESPACE","\n      ",885],["T_CONSTANT_ENCAPSED_STRING","'indexes'",886],["T_WHITESPACE"," ",886],["T_DOUBLE_ARROW","=>",886],["T_WHITESPACE"," ",886],["T_ARRAY","array",886],"(",")",",",["T_WHITESPACE","\n      ",886],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",887],["T_WHITESPACE"," ",887],["T_DOUBLE_ARROW","=>",887],["T_WHITESPACE"," ",887],["T_ARRAY","array",887],"(",["T_WHITESPACE","\n        ",887],["T_VARIABLE","$entity_type_id",888],["T_WHITESPACE"," ",888],".",["T_WHITESPACE"," ",888],["T_CONSTANT_ENCAPSED_STRING","'__revisioned'",888],["T_WHITESPACE"," ",888],["T_DOUBLE_ARROW","=>",888],["T_WHITESPACE"," ",888],["T_ARRAY","array",888],"(",["T_WHITESPACE","\n          ",888],["T_CONSTANT_ENCAPSED_STRING","'table'",889],["T_WHITESPACE"," ",889],["T_DOUBLE_ARROW","=>",889],["T_WHITESPACE"," ",889],["T_VARIABLE","$this",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","storage",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","getBaseTable",889],"(",")",",",["T_WHITESPACE","\n          ",889],["T_CONSTANT_ENCAPSED_STRING","'columns'",890],["T_WHITESPACE"," ",890],["T_DOUBLE_ARROW","=>",890],["T_WHITESPACE"," ",890],["T_ARRAY","array",890],"(",["T_VARIABLE","$id_key",890],["T_WHITESPACE"," ",890],["T_DOUBLE_ARROW","=>",890],["T_WHITESPACE"," ",890],["T_VARIABLE","$id_key",890],")",",",["T_WHITESPACE","\n        ",890],")",",",["T_WHITESPACE","\n      ",891],")",",",["T_WHITESPACE","\n    ",892],")",";",["T_WHITESPACE","\n\n    ",893],["T_VARIABLE","$schema",895],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",895],"]","[",["T_VARIABLE","$this",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","getEntityIndexName",895],"(",["T_VARIABLE","$entity_type",895],",",["T_WHITESPACE"," ",895],["T_VARIABLE","$id_key",895],")","]",["T_WHITESPACE"," ",895],"=",["T_WHITESPACE"," ",895],["T_ARRAY","array",895],"(",["T_VARIABLE","$id_key",895],")",";",["T_WHITESPACE","\n\n    ",895],["T_VARIABLE","$this",897],["T_OBJECT_OPERATOR","->",897],["T_STRING","addTableDefaults",897],"(",["T_VARIABLE","$schema",897],")",";",["T_WHITESPACE","\n\n    ",897],["T_RETURN","return",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$schema",899],";",["T_WHITESPACE","\n  ",899],"}",["T_WHITESPACE","\n\n  ",900],["T_DOC_COMMENT","\/**\n   * Initializes common information for a data table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   *\n   * @return array\n   *   A partial schema array for the data table.\n   *\/",902],["T_WHITESPACE","\n  ",910],["T_PROTECTED","protected",911],["T_WHITESPACE"," ",911],["T_FUNCTION","function",911],["T_WHITESPACE"," ",911],["T_STRING","initializeDataTable",911],"(",["T_STRING","ContentEntityTypeInterface",911],["T_WHITESPACE"," ",911],["T_VARIABLE","$entity_type",911],")",["T_WHITESPACE"," ",911],"{",["T_WHITESPACE","\n    ",911],["T_VARIABLE","$entity_type_id",912],["T_WHITESPACE"," ",912],"=",["T_WHITESPACE"," ",912],["T_VARIABLE","$entity_type",912],["T_OBJECT_OPERATOR","->",912],["T_STRING","id",912],"(",")",";",["T_WHITESPACE","\n    ",912],["T_VARIABLE","$id_key",913],["T_WHITESPACE"," ",913],"=",["T_WHITESPACE"," ",913],["T_VARIABLE","$entity_type",913],["T_OBJECT_OPERATOR","->",913],["T_STRING","getKey",913],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",913],")",";",["T_WHITESPACE","\n\n    ",913],["T_VARIABLE","$schema",915],["T_WHITESPACE"," ",915],"=",["T_WHITESPACE"," ",915],["T_ARRAY","array",915],"(",["T_WHITESPACE","\n      ",915],["T_CONSTANT_ENCAPSED_STRING","'description'",916],["T_WHITESPACE"," ",916],["T_DOUBLE_ARROW","=>",916],["T_WHITESPACE"," ",916],"\"",["T_ENCAPSED_AND_WHITESPACE","The data table for ",916],["T_VARIABLE","$entity_type_id",916],["T_ENCAPSED_AND_WHITESPACE"," entities.",916],"\"",",",["T_WHITESPACE","\n      ",916],["T_CONSTANT_ENCAPSED_STRING","'primary key'",917],["T_WHITESPACE"," ",917],["T_DOUBLE_ARROW","=>",917],["T_WHITESPACE"," ",917],["T_ARRAY","array",917],"(",["T_VARIABLE","$id_key",917],",",["T_WHITESPACE"," ",917],["T_VARIABLE","$entity_type",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","getKey",917],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",917],")",")",",",["T_WHITESPACE","\n      ",917],["T_CONSTANT_ENCAPSED_STRING","'indexes'",918],["T_WHITESPACE"," ",918],["T_DOUBLE_ARROW","=>",918],["T_WHITESPACE"," ",918],["T_ARRAY","array",918],"(",["T_WHITESPACE","\n        ",918],["T_VARIABLE","$entity_type_id",919],["T_WHITESPACE"," ",919],".",["T_WHITESPACE"," ",919],["T_CONSTANT_ENCAPSED_STRING","'__id__default_langcode__langcode'",919],["T_WHITESPACE"," ",919],["T_DOUBLE_ARROW","=>",919],["T_WHITESPACE"," ",919],["T_ARRAY","array",919],"(",["T_VARIABLE","$id_key",919],",",["T_WHITESPACE"," ",919],["T_VARIABLE","$entity_type",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","getKey",919],"(",["T_CONSTANT_ENCAPSED_STRING","'default_langcode'",919],")",",",["T_WHITESPACE"," ",919],["T_VARIABLE","$entity_type",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","getKey",919],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",919],")",")",",",["T_WHITESPACE","\n      ",919],")",",",["T_WHITESPACE","\n      ",920],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",921],["T_WHITESPACE"," ",921],["T_DOUBLE_ARROW","=>",921],["T_WHITESPACE"," ",921],["T_ARRAY","array",921],"(",["T_WHITESPACE","\n        ",921],["T_VARIABLE","$entity_type_id",922],["T_WHITESPACE"," ",922],["T_DOUBLE_ARROW","=>",922],["T_WHITESPACE"," ",922],["T_ARRAY","array",922],"(",["T_WHITESPACE","\n          ",922],["T_CONSTANT_ENCAPSED_STRING","'table'",923],["T_WHITESPACE"," ",923],["T_DOUBLE_ARROW","=>",923],["T_WHITESPACE"," ",923],["T_VARIABLE","$this",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","storage",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","getBaseTable",923],"(",")",",",["T_WHITESPACE","\n          ",923],["T_CONSTANT_ENCAPSED_STRING","'columns'",924],["T_WHITESPACE"," ",924],["T_DOUBLE_ARROW","=>",924],["T_WHITESPACE"," ",924],["T_ARRAY","array",924],"(",["T_VARIABLE","$id_key",924],["T_WHITESPACE"," ",924],["T_DOUBLE_ARROW","=>",924],["T_WHITESPACE"," ",924],["T_VARIABLE","$id_key",924],")",",",["T_WHITESPACE","\n        ",924],")",",",["T_WHITESPACE","\n      ",925],")",",",["T_WHITESPACE","\n    ",926],")",";",["T_WHITESPACE","\n\n    ",927],["T_IF","if",929],["T_WHITESPACE"," ",929],"(",["T_VARIABLE","$entity_type",929],["T_OBJECT_OPERATOR","->",929],["T_STRING","hasKey",929],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",929],")",")",["T_WHITESPACE"," ",929],"{",["T_WHITESPACE","\n      ",929],["T_VARIABLE","$key",930],["T_WHITESPACE"," ",930],"=",["T_WHITESPACE"," ",930],["T_VARIABLE","$entity_type",930],["T_OBJECT_OPERATOR","->",930],["T_STRING","getKey",930],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",930],")",";",["T_WHITESPACE","\n      ",930],["T_VARIABLE","$schema",931],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",931],"]","[",["T_VARIABLE","$this",931],["T_OBJECT_OPERATOR","->",931],["T_STRING","getEntityIndexName",931],"(",["T_VARIABLE","$entity_type",931],",",["T_WHITESPACE"," ",931],["T_VARIABLE","$key",931],")","]",["T_WHITESPACE"," ",931],"=",["T_WHITESPACE"," ",931],["T_ARRAY","array",931],"(",["T_VARIABLE","$key",931],")",";",["T_WHITESPACE","\n    ",931],"}",["T_WHITESPACE","\n\n    ",932],["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","addTableDefaults",934],"(",["T_VARIABLE","$schema",934],")",";",["T_WHITESPACE","\n\n    ",934],["T_RETURN","return",936],["T_WHITESPACE"," ",936],["T_VARIABLE","$schema",936],";",["T_WHITESPACE","\n  ",936],"}",["T_WHITESPACE","\n\n  ",937],["T_DOC_COMMENT","\/**\n   * Initializes common information for a revision data table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   *\n   * @return array\n   *   A partial schema array for the revision data table.\n   *\/",939],["T_WHITESPACE","\n  ",947],["T_PROTECTED","protected",948],["T_WHITESPACE"," ",948],["T_FUNCTION","function",948],["T_WHITESPACE"," ",948],["T_STRING","initializeRevisionDataTable",948],"(",["T_STRING","ContentEntityTypeInterface",948],["T_WHITESPACE"," ",948],["T_VARIABLE","$entity_type",948],")",["T_WHITESPACE"," ",948],"{",["T_WHITESPACE","\n    ",948],["T_VARIABLE","$entity_type_id",949],["T_WHITESPACE"," ",949],"=",["T_WHITESPACE"," ",949],["T_VARIABLE","$entity_type",949],["T_OBJECT_OPERATOR","->",949],["T_STRING","id",949],"(",")",";",["T_WHITESPACE","\n    ",949],["T_VARIABLE","$id_key",950],["T_WHITESPACE"," ",950],"=",["T_WHITESPACE"," ",950],["T_VARIABLE","$entity_type",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","getKey",950],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",950],")",";",["T_WHITESPACE","\n    ",950],["T_VARIABLE","$revision_key",951],["T_WHITESPACE"," ",951],"=",["T_WHITESPACE"," ",951],["T_VARIABLE","$entity_type",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","getKey",951],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",951],")",";",["T_WHITESPACE","\n\n    ",951],["T_VARIABLE","$schema",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],["T_ARRAY","array",953],"(",["T_WHITESPACE","\n      ",953],["T_CONSTANT_ENCAPSED_STRING","'description'",954],["T_WHITESPACE"," ",954],["T_DOUBLE_ARROW","=>",954],["T_WHITESPACE"," ",954],"\"",["T_ENCAPSED_AND_WHITESPACE","The revision data table for ",954],["T_VARIABLE","$entity_type_id",954],["T_ENCAPSED_AND_WHITESPACE"," entities.",954],"\"",",",["T_WHITESPACE","\n      ",954],["T_CONSTANT_ENCAPSED_STRING","'primary key'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_ARRAY","array",955],"(",["T_VARIABLE","$revision_key",955],",",["T_WHITESPACE"," ",955],["T_VARIABLE","$entity_type",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getKey",955],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",955],")",")",",",["T_WHITESPACE","\n      ",955],["T_CONSTANT_ENCAPSED_STRING","'indexes'",956],["T_WHITESPACE"," ",956],["T_DOUBLE_ARROW","=>",956],["T_WHITESPACE"," ",956],["T_ARRAY","array",956],"(",["T_WHITESPACE","\n        ",956],["T_VARIABLE","$entity_type_id",957],["T_WHITESPACE"," ",957],".",["T_WHITESPACE"," ",957],["T_CONSTANT_ENCAPSED_STRING","'__id__default_langcode__langcode'",957],["T_WHITESPACE"," ",957],["T_DOUBLE_ARROW","=>",957],["T_WHITESPACE"," ",957],["T_ARRAY","array",957],"(",["T_VARIABLE","$id_key",957],",",["T_WHITESPACE"," ",957],["T_VARIABLE","$entity_type",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getKey",957],"(",["T_CONSTANT_ENCAPSED_STRING","'default_langcode'",957],")",",",["T_WHITESPACE"," ",957],["T_VARIABLE","$entity_type",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getKey",957],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",957],")",")",",",["T_WHITESPACE","\n      ",957],")",",",["T_WHITESPACE","\n      ",958],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",959],["T_WHITESPACE"," ",959],["T_DOUBLE_ARROW","=>",959],["T_WHITESPACE"," ",959],["T_ARRAY","array",959],"(",["T_WHITESPACE","\n        ",959],["T_VARIABLE","$entity_type_id",960],["T_WHITESPACE"," ",960],["T_DOUBLE_ARROW","=>",960],["T_WHITESPACE"," ",960],["T_ARRAY","array",960],"(",["T_WHITESPACE","\n          ",960],["T_CONSTANT_ENCAPSED_STRING","'table'",961],["T_WHITESPACE"," ",961],["T_DOUBLE_ARROW","=>",961],["T_WHITESPACE"," ",961],["T_VARIABLE","$this",961],["T_OBJECT_OPERATOR","->",961],["T_STRING","storage",961],["T_OBJECT_OPERATOR","->",961],["T_STRING","getBaseTable",961],"(",")",",",["T_WHITESPACE","\n          ",961],["T_CONSTANT_ENCAPSED_STRING","'columns'",962],["T_WHITESPACE"," ",962],["T_DOUBLE_ARROW","=>",962],["T_WHITESPACE"," ",962],["T_ARRAY","array",962],"(",["T_VARIABLE","$id_key",962],["T_WHITESPACE"," ",962],["T_DOUBLE_ARROW","=>",962],["T_WHITESPACE"," ",962],["T_VARIABLE","$id_key",962],")",",",["T_WHITESPACE","\n        ",962],")",",",["T_WHITESPACE","\n        ",963],["T_VARIABLE","$entity_type_id",964],["T_WHITESPACE"," ",964],".",["T_WHITESPACE"," ",964],["T_CONSTANT_ENCAPSED_STRING","'__revision'",964],["T_WHITESPACE"," ",964],["T_DOUBLE_ARROW","=>",964],["T_WHITESPACE"," ",964],["T_ARRAY","array",964],"(",["T_WHITESPACE","\n          ",964],["T_CONSTANT_ENCAPSED_STRING","'table'",965],["T_WHITESPACE"," ",965],["T_DOUBLE_ARROW","=>",965],["T_WHITESPACE"," ",965],["T_VARIABLE","$this",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","storage",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","getRevisionTable",965],"(",")",",",["T_WHITESPACE","\n          ",965],["T_CONSTANT_ENCAPSED_STRING","'columns'",966],["T_WHITESPACE"," ",966],["T_DOUBLE_ARROW","=>",966],["T_WHITESPACE"," ",966],["T_ARRAY","array",966],"(",["T_VARIABLE","$revision_key",966],["T_WHITESPACE"," ",966],["T_DOUBLE_ARROW","=>",966],["T_WHITESPACE"," ",966],["T_VARIABLE","$revision_key",966],")",",",["T_WHITESPACE","\n        ",966],")",["T_WHITESPACE","\n      ",967],")",",",["T_WHITESPACE","\n    ",968],")",";",["T_WHITESPACE","\n\n    ",969],["T_VARIABLE","$this",971],["T_OBJECT_OPERATOR","->",971],["T_STRING","addTableDefaults",971],"(",["T_VARIABLE","$schema",971],")",";",["T_WHITESPACE","\n\n    ",971],["T_RETURN","return",973],["T_WHITESPACE"," ",973],["T_VARIABLE","$schema",973],";",["T_WHITESPACE","\n  ",973],"}",["T_WHITESPACE","\n\n  ",974],["T_DOC_COMMENT","\/**\n   * Adds defaults to a table schema definition.\n   *\n   * @param $schema\n   *   The schema definition array for a single table, passed by reference.\n   *\/",976],["T_WHITESPACE","\n  ",981],["T_PROTECTED","protected",982],["T_WHITESPACE"," ",982],["T_FUNCTION","function",982],["T_WHITESPACE"," ",982],["T_STRING","addTableDefaults",982],"(","&",["T_VARIABLE","$schema",982],")",["T_WHITESPACE"," ",982],"{",["T_WHITESPACE","\n    ",982],["T_VARIABLE","$schema",983],["T_WHITESPACE"," ",983],["T_PLUS_EQUAL","+=",983],["T_WHITESPACE"," ",983],["T_ARRAY","array",983],"(",["T_WHITESPACE","\n      ",983],["T_CONSTANT_ENCAPSED_STRING","'fields'",984],["T_WHITESPACE"," ",984],["T_DOUBLE_ARROW","=>",984],["T_WHITESPACE"," ",984],["T_ARRAY","array",984],"(",")",",",["T_WHITESPACE","\n      ",984],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",985],["T_WHITESPACE"," ",985],["T_DOUBLE_ARROW","=>",985],["T_WHITESPACE"," ",985],["T_ARRAY","array",985],"(",")",",",["T_WHITESPACE","\n      ",985],["T_CONSTANT_ENCAPSED_STRING","'indexes'",986],["T_WHITESPACE"," ",986],["T_DOUBLE_ARROW","=>",986],["T_WHITESPACE"," ",986],["T_ARRAY","array",986],"(",")",",",["T_WHITESPACE","\n      ",986],["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",987],["T_WHITESPACE"," ",987],["T_DOUBLE_ARROW","=>",987],["T_WHITESPACE"," ",987],["T_ARRAY","array",987],"(",")",",",["T_WHITESPACE","\n    ",987],")",";",["T_WHITESPACE","\n  ",988],"}",["T_WHITESPACE","\n\n  ",989],["T_DOC_COMMENT","\/**\n   * Processes the gathered schema for a base table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param array $schema\n   *   The table schema, passed by reference.\n   *\n   * @return array\n   *   A partial schema array for the base table.\n   *\/",991],["T_WHITESPACE","\n  ",1001],["T_PROTECTED","protected",1002],["T_WHITESPACE"," ",1002],["T_FUNCTION","function",1002],["T_WHITESPACE"," ",1002],["T_STRING","processBaseTable",1002],"(",["T_STRING","ContentEntityTypeInterface",1002],["T_WHITESPACE"," ",1002],["T_VARIABLE","$entity_type",1002],",",["T_WHITESPACE"," ",1002],["T_ARRAY","array",1002],["T_WHITESPACE"," ",1002],"&",["T_VARIABLE","$schema",1002],")",["T_WHITESPACE"," ",1002],"{",["T_WHITESPACE","\n    ",1002],["T_VARIABLE","$this",1003],["T_OBJECT_OPERATOR","->",1003],["T_STRING","processIdentifierSchema",1003],"(",["T_VARIABLE","$schema",1003],",",["T_WHITESPACE"," ",1003],["T_VARIABLE","$entity_type",1003],["T_OBJECT_OPERATOR","->",1003],["T_STRING","getKey",1003],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",1003],")",")",";",["T_WHITESPACE","\n  ",1003],"}",["T_WHITESPACE","\n\n  ",1004],["T_DOC_COMMENT","\/**\n   * Processes the gathered schema for a base table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param array $schema\n   *   The table schema, passed by reference.\n   *\n   * @return array\n   *   A partial schema array for the base table.\n   *\/",1006],["T_WHITESPACE","\n  ",1016],["T_PROTECTED","protected",1017],["T_WHITESPACE"," ",1017],["T_FUNCTION","function",1017],["T_WHITESPACE"," ",1017],["T_STRING","processRevisionTable",1017],"(",["T_STRING","ContentEntityTypeInterface",1017],["T_WHITESPACE"," ",1017],["T_VARIABLE","$entity_type",1017],",",["T_WHITESPACE"," ",1017],["T_ARRAY","array",1017],["T_WHITESPACE"," ",1017],"&",["T_VARIABLE","$schema",1017],")",["T_WHITESPACE"," ",1017],"{",["T_WHITESPACE","\n    ",1017],["T_VARIABLE","$this",1018],["T_OBJECT_OPERATOR","->",1018],["T_STRING","processIdentifierSchema",1018],"(",["T_VARIABLE","$schema",1018],",",["T_WHITESPACE"," ",1018],["T_VARIABLE","$entity_type",1018],["T_OBJECT_OPERATOR","->",1018],["T_STRING","getKey",1018],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",1018],")",")",";",["T_WHITESPACE","\n  ",1018],"}",["T_WHITESPACE","\n\n  ",1019],["T_DOC_COMMENT","\/**\n   * Processes the gathered schema for a base table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param array $schema\n   *   The table schema, passed by reference.\n   *\n   * @return array\n   *   A partial schema array for the base table.\n   *\/",1021],["T_WHITESPACE","\n  ",1031],["T_PROTECTED","protected",1032],["T_WHITESPACE"," ",1032],["T_FUNCTION","function",1032],["T_WHITESPACE"," ",1032],["T_STRING","processDataTable",1032],"(",["T_STRING","ContentEntityTypeInterface",1032],["T_WHITESPACE"," ",1032],["T_VARIABLE","$entity_type",1032],",",["T_WHITESPACE"," ",1032],["T_ARRAY","array",1032],["T_WHITESPACE"," ",1032],"&",["T_VARIABLE","$schema",1032],")",["T_WHITESPACE"," ",1032],"{",["T_WHITESPACE","\n    ",1032],["T_COMMENT","\/\/ Marking the respective fields as NOT NULL makes the indexes more\n",1033],["T_WHITESPACE","    ",1034],["T_COMMENT","\/\/ performant.\n",1034],["T_WHITESPACE","    ",1035],["T_VARIABLE","$schema",1035],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1035],"]","[",["T_VARIABLE","$entity_type",1035],["T_OBJECT_OPERATOR","->",1035],["T_STRING","getKey",1035],"(",["T_CONSTANT_ENCAPSED_STRING","'default_langcode'",1035],")","]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1035],"]",["T_WHITESPACE"," ",1035],"=",["T_WHITESPACE"," ",1035],["T_STRING","TRUE",1035],";",["T_WHITESPACE","\n  ",1035],"}",["T_WHITESPACE","\n\n  ",1036],["T_DOC_COMMENT","\/**\n   * Processes the gathered schema for a base table.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param array $schema\n   *   The table schema, passed by reference.\n   *\n   * @return array\n   *   A partial schema array for the base table.\n   *\/",1038],["T_WHITESPACE","\n  ",1048],["T_PROTECTED","protected",1049],["T_WHITESPACE"," ",1049],["T_FUNCTION","function",1049],["T_WHITESPACE"," ",1049],["T_STRING","processRevisionDataTable",1049],"(",["T_STRING","ContentEntityTypeInterface",1049],["T_WHITESPACE"," ",1049],["T_VARIABLE","$entity_type",1049],",",["T_WHITESPACE"," ",1049],["T_ARRAY","array",1049],["T_WHITESPACE"," ",1049],"&",["T_VARIABLE","$schema",1049],")",["T_WHITESPACE"," ",1049],"{",["T_WHITESPACE","\n    ",1049],["T_COMMENT","\/\/ Marking the respective fields as NOT NULL makes the indexes more\n",1050],["T_WHITESPACE","    ",1051],["T_COMMENT","\/\/ performant.\n",1051],["T_WHITESPACE","    ",1052],["T_VARIABLE","$schema",1052],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1052],"]","[",["T_VARIABLE","$entity_type",1052],["T_OBJECT_OPERATOR","->",1052],["T_STRING","getKey",1052],"(",["T_CONSTANT_ENCAPSED_STRING","'default_langcode'",1052],")","]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1052],"]",["T_WHITESPACE"," ",1052],"=",["T_WHITESPACE"," ",1052],["T_STRING","TRUE",1052],";",["T_WHITESPACE","\n  ",1052],"}",["T_WHITESPACE","\n\n  ",1053],["T_DOC_COMMENT","\/**\n   * Processes the specified entity key.\n   *\n   * @param array $schema\n   *   The table schema, passed by reference.\n   * @param string $key\n   *   The entity key name.\n   *\/",1055],["T_WHITESPACE","\n  ",1062],["T_PROTECTED","protected",1063],["T_WHITESPACE"," ",1063],["T_FUNCTION","function",1063],["T_WHITESPACE"," ",1063],["T_STRING","processIdentifierSchema",1063],"(","&",["T_VARIABLE","$schema",1063],",",["T_WHITESPACE"," ",1063],["T_VARIABLE","$key",1063],")",["T_WHITESPACE"," ",1063],"{",["T_WHITESPACE","\n    ",1063],["T_IF","if",1064],["T_WHITESPACE"," ",1064],"(",["T_VARIABLE","$schema",1064],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1064],"]","[",["T_VARIABLE","$key",1064],"]","[",["T_CONSTANT_ENCAPSED_STRING","'type'",1064],"]",["T_WHITESPACE"," ",1064],["T_IS_EQUAL","==",1064],["T_WHITESPACE"," ",1064],["T_CONSTANT_ENCAPSED_STRING","'int'",1064],")",["T_WHITESPACE"," ",1064],"{",["T_WHITESPACE","\n      ",1064],["T_VARIABLE","$schema",1065],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1065],"]","[",["T_VARIABLE","$key",1065],"]","[",["T_CONSTANT_ENCAPSED_STRING","'type'",1065],"]",["T_WHITESPACE"," ",1065],"=",["T_WHITESPACE"," ",1065],["T_CONSTANT_ENCAPSED_STRING","'serial'",1065],";",["T_WHITESPACE","\n    ",1065],"}",["T_WHITESPACE","\n    ",1066],["T_VARIABLE","$schema",1067],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1067],"]","[",["T_VARIABLE","$key",1067],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1067],"]",["T_WHITESPACE"," ",1067],"=",["T_WHITESPACE"," ",1067],["T_STRING","TRUE",1067],";",["T_WHITESPACE","\n    ",1067],["T_UNSET","unset",1068],"(",["T_VARIABLE","$schema",1068],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1068],"]","[",["T_VARIABLE","$key",1068],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default'",1068],"]",")",";",["T_WHITESPACE","\n  ",1068],"}",["T_WHITESPACE","\n\n  ",1069],["T_DOC_COMMENT","\/**\n   * Performs the specified operation on a field.\n   *\n   * This figures out whether the field is stored in a dedicated or shared table\n   * and forwards the call to the proper handler.\n   *\n   * @param string $operation\n   *   The name of the operation to be performed.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $original\n   *   (optional) The original field storage definition. This is relevant (and\n   *   required) only for updates. Defaults to NULL.\n   *\/",1071],["T_WHITESPACE","\n  ",1084],["T_PROTECTED","protected",1085],["T_WHITESPACE"," ",1085],["T_FUNCTION","function",1085],["T_WHITESPACE"," ",1085],["T_STRING","performFieldSchemaOperation",1085],"(",["T_VARIABLE","$operation",1085],",",["T_WHITESPACE"," ",1085],["T_STRING","FieldStorageDefinitionInterface",1085],["T_WHITESPACE"," ",1085],["T_VARIABLE","$storage_definition",1085],",",["T_WHITESPACE"," ",1085],["T_STRING","FieldStorageDefinitionInterface",1085],["T_WHITESPACE"," ",1085],["T_VARIABLE","$original",1085],["T_WHITESPACE"," ",1085],"=",["T_WHITESPACE"," ",1085],["T_STRING","NULL",1085],")",["T_WHITESPACE"," ",1085],"{",["T_WHITESPACE","\n    ",1085],["T_VARIABLE","$table_mapping",1086],["T_WHITESPACE"," ",1086],"=",["T_WHITESPACE"," ",1086],["T_VARIABLE","$this",1086],["T_OBJECT_OPERATOR","->",1086],["T_STRING","storage",1086],["T_OBJECT_OPERATOR","->",1086],["T_STRING","getTableMapping",1086],"(",")",";",["T_WHITESPACE","\n    ",1086],["T_IF","if",1087],["T_WHITESPACE"," ",1087],"(",["T_VARIABLE","$table_mapping",1087],["T_OBJECT_OPERATOR","->",1087],["T_STRING","requiresDedicatedTableStorage",1087],"(",["T_VARIABLE","$storage_definition",1087],")",")",["T_WHITESPACE"," ",1087],"{",["T_WHITESPACE","\n      ",1087],["T_VARIABLE","$this",1088],["T_OBJECT_OPERATOR","->",1088],"{",["T_VARIABLE","$operation",1088],["T_WHITESPACE"," ",1088],".",["T_WHITESPACE"," ",1088],["T_CONSTANT_ENCAPSED_STRING","'DedicatedTableSchema'",1088],"}","(",["T_VARIABLE","$storage_definition",1088],",",["T_WHITESPACE"," ",1088],["T_VARIABLE","$original",1088],")",";",["T_WHITESPACE","\n    ",1088],"}",["T_WHITESPACE","\n    ",1089],["T_ELSEIF","elseif",1090],["T_WHITESPACE"," ",1090],"(",["T_VARIABLE","$table_mapping",1090],["T_OBJECT_OPERATOR","->",1090],["T_STRING","allowsSharedTableStorage",1090],"(",["T_VARIABLE","$storage_definition",1090],")",")",["T_WHITESPACE"," ",1090],"{",["T_WHITESPACE","\n      ",1090],["T_VARIABLE","$this",1091],["T_OBJECT_OPERATOR","->",1091],"{",["T_VARIABLE","$operation",1091],["T_WHITESPACE"," ",1091],".",["T_WHITESPACE"," ",1091],["T_CONSTANT_ENCAPSED_STRING","'SharedTableSchema'",1091],"}","(",["T_VARIABLE","$storage_definition",1091],",",["T_WHITESPACE"," ",1091],["T_VARIABLE","$original",1091],")",";",["T_WHITESPACE","\n    ",1091],"}",["T_WHITESPACE","\n  ",1092],"}",["T_WHITESPACE","\n\n  ",1093],["T_DOC_COMMENT","\/**\n   * Creates the schema for a field stored in a dedicated table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being created.\n   *\/",1095],["T_WHITESPACE","\n  ",1100],["T_PROTECTED","protected",1101],["T_WHITESPACE"," ",1101],["T_FUNCTION","function",1101],["T_WHITESPACE"," ",1101],["T_STRING","createDedicatedTableSchema",1101],"(",["T_STRING","FieldStorageDefinitionInterface",1101],["T_WHITESPACE"," ",1101],["T_VARIABLE","$storage_definition",1101],")",["T_WHITESPACE"," ",1101],"{",["T_WHITESPACE","\n    ",1101],["T_VARIABLE","$schema",1102],["T_WHITESPACE"," ",1102],"=",["T_WHITESPACE"," ",1102],["T_VARIABLE","$this",1102],["T_OBJECT_OPERATOR","->",1102],["T_STRING","getDedicatedTableSchema",1102],"(",["T_VARIABLE","$storage_definition",1102],")",";",["T_WHITESPACE","\n    ",1102],["T_FOREACH","foreach",1103],["T_WHITESPACE"," ",1103],"(",["T_VARIABLE","$schema",1103],["T_WHITESPACE"," ",1103],["T_AS","as",1103],["T_WHITESPACE"," ",1103],["T_VARIABLE","$name",1103],["T_WHITESPACE"," ",1103],["T_DOUBLE_ARROW","=>",1103],["T_WHITESPACE"," ",1103],["T_VARIABLE","$table",1103],")",["T_WHITESPACE"," ",1103],"{",["T_WHITESPACE","\n      ",1103],["T_COMMENT","\/\/ Check if the table exists because it might already have been\n",1104],["T_WHITESPACE","      ",1105],["T_COMMENT","\/\/ created as part of the earlier entity type update event.\n",1105],["T_WHITESPACE","      ",1106],["T_IF","if",1106],["T_WHITESPACE"," ",1106],"(","!",["T_VARIABLE","$this",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","database",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","schema",1106],"(",")",["T_OBJECT_OPERATOR","->",1106],["T_STRING","tableExists",1106],"(",["T_VARIABLE","$name",1106],")",")",["T_WHITESPACE"," ",1106],"{",["T_WHITESPACE","\n        ",1106],["T_VARIABLE","$this",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","database",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","schema",1107],"(",")",["T_OBJECT_OPERATOR","->",1107],["T_STRING","createTable",1107],"(",["T_VARIABLE","$name",1107],",",["T_WHITESPACE"," ",1107],["T_VARIABLE","$table",1107],")",";",["T_WHITESPACE","\n      ",1107],"}",["T_WHITESPACE","\n    ",1108],"}",["T_WHITESPACE","\n    ",1109],["T_VARIABLE","$this",1110],["T_OBJECT_OPERATOR","->",1110],["T_STRING","saveFieldSchemaData",1110],"(",["T_VARIABLE","$storage_definition",1110],",",["T_WHITESPACE"," ",1110],["T_VARIABLE","$schema",1110],")",";",["T_WHITESPACE","\n  ",1110],"}",["T_WHITESPACE","\n\n  ",1111],["T_DOC_COMMENT","\/**\n   * Creates the schema for a field stored in a shared table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being created.\n   * @param bool $only_save\n   *   (optional) Whether to skip modification of database tables and only save\n   *   the schema data for future comparison. For internal use only. This is\n   *   used by onEntityTypeCreate() after it has already fully created the\n   *   shared tables.\n   *\/",1113],["T_WHITESPACE","\n  ",1123],["T_PROTECTED","protected",1124],["T_WHITESPACE"," ",1124],["T_FUNCTION","function",1124],["T_WHITESPACE"," ",1124],["T_STRING","createSharedTableSchema",1124],"(",["T_STRING","FieldStorageDefinitionInterface",1124],["T_WHITESPACE"," ",1124],["T_VARIABLE","$storage_definition",1124],",",["T_WHITESPACE"," ",1124],["T_VARIABLE","$only_save",1124],["T_WHITESPACE"," ",1124],"=",["T_WHITESPACE"," ",1124],["T_STRING","FALSE",1124],")",["T_WHITESPACE"," ",1124],"{",["T_WHITESPACE","\n    ",1124],["T_VARIABLE","$created_field_name",1125],["T_WHITESPACE"," ",1125],"=",["T_WHITESPACE"," ",1125],["T_VARIABLE","$storage_definition",1125],["T_OBJECT_OPERATOR","->",1125],["T_STRING","getName",1125],"(",")",";",["T_WHITESPACE","\n    ",1125],["T_VARIABLE","$table_mapping",1126],["T_WHITESPACE"," ",1126],"=",["T_WHITESPACE"," ",1126],["T_VARIABLE","$this",1126],["T_OBJECT_OPERATOR","->",1126],["T_STRING","storage",1126],["T_OBJECT_OPERATOR","->",1126],["T_STRING","getTableMapping",1126],"(",")",";",["T_WHITESPACE","\n    ",1126],["T_VARIABLE","$column_names",1127],["T_WHITESPACE"," ",1127],"=",["T_WHITESPACE"," ",1127],["T_VARIABLE","$table_mapping",1127],["T_OBJECT_OPERATOR","->",1127],["T_STRING","getColumnNames",1127],"(",["T_VARIABLE","$created_field_name",1127],")",";",["T_WHITESPACE","\n    ",1127],["T_VARIABLE","$schema_handler",1128],["T_WHITESPACE"," ",1128],"=",["T_WHITESPACE"," ",1128],["T_VARIABLE","$this",1128],["T_OBJECT_OPERATOR","->",1128],["T_STRING","database",1128],["T_OBJECT_OPERATOR","->",1128],["T_STRING","schema",1128],"(",")",";",["T_WHITESPACE","\n    ",1128],["T_VARIABLE","$shared_table_names",1129],["T_WHITESPACE"," ",1129],"=",["T_WHITESPACE"," ",1129],["T_STRING","array_diff",1129],"(",["T_VARIABLE","$table_mapping",1129],["T_OBJECT_OPERATOR","->",1129],["T_STRING","getTableNames",1129],"(",")",",",["T_WHITESPACE"," ",1129],["T_VARIABLE","$table_mapping",1129],["T_OBJECT_OPERATOR","->",1129],["T_STRING","getDedicatedTableNames",1129],"(",")",")",";",["T_WHITESPACE","\n\n    ",1129],["T_COMMENT","\/\/ Iterate over the mapped table to find the ones that will host the created\n",1131],["T_WHITESPACE","    ",1132],["T_COMMENT","\/\/ field schema.\n",1132],["T_WHITESPACE","    ",1133],["T_VARIABLE","$schema",1133],["T_WHITESPACE"," ",1133],"=",["T_WHITESPACE"," ",1133],["T_ARRAY","array",1133],"(",")",";",["T_WHITESPACE","\n    ",1133],["T_FOREACH","foreach",1134],["T_WHITESPACE"," ",1134],"(",["T_VARIABLE","$shared_table_names",1134],["T_WHITESPACE"," ",1134],["T_AS","as",1134],["T_WHITESPACE"," ",1134],["T_VARIABLE","$table_name",1134],")",["T_WHITESPACE"," ",1134],"{",["T_WHITESPACE","\n      ",1134],["T_FOREACH","foreach",1135],["T_WHITESPACE"," ",1135],"(",["T_VARIABLE","$table_mapping",1135],["T_OBJECT_OPERATOR","->",1135],["T_STRING","getFieldNames",1135],"(",["T_VARIABLE","$table_name",1135],")",["T_WHITESPACE"," ",1135],["T_AS","as",1135],["T_WHITESPACE"," ",1135],["T_VARIABLE","$field_name",1135],")",["T_WHITESPACE"," ",1135],"{",["T_WHITESPACE","\n        ",1135],["T_IF","if",1136],["T_WHITESPACE"," ",1136],"(",["T_VARIABLE","$field_name",1136],["T_WHITESPACE"," ",1136],["T_IS_EQUAL","==",1136],["T_WHITESPACE"," ",1136],["T_VARIABLE","$created_field_name",1136],")",["T_WHITESPACE"," ",1136],"{",["T_WHITESPACE","\n          ",1136],["T_COMMENT","\/\/ Create field columns.\n",1137],["T_WHITESPACE","          ",1138],["T_VARIABLE","$schema",1138],"[",["T_VARIABLE","$table_name",1138],"]",["T_WHITESPACE"," ",1138],"=",["T_WHITESPACE"," ",1138],["T_VARIABLE","$this",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","getSharedTableFieldSchema",1138],"(",["T_VARIABLE","$storage_definition",1138],",",["T_WHITESPACE"," ",1138],["T_VARIABLE","$table_name",1138],",",["T_WHITESPACE"," ",1138],["T_VARIABLE","$column_names",1138],")",";",["T_WHITESPACE","\n          ",1138],["T_IF","if",1139],["T_WHITESPACE"," ",1139],"(","!",["T_VARIABLE","$only_save",1139],")",["T_WHITESPACE"," ",1139],"{",["T_WHITESPACE","\n            ",1139],["T_FOREACH","foreach",1140],["T_WHITESPACE"," ",1140],"(",["T_VARIABLE","$schema",1140],"[",["T_VARIABLE","$table_name",1140],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1140],"]",["T_WHITESPACE"," ",1140],["T_AS","as",1140],["T_WHITESPACE"," ",1140],["T_VARIABLE","$name",1140],["T_WHITESPACE"," ",1140],["T_DOUBLE_ARROW","=>",1140],["T_WHITESPACE"," ",1140],["T_VARIABLE","$specifier",1140],")",["T_WHITESPACE"," ",1140],"{",["T_WHITESPACE","\n              ",1140],["T_COMMENT","\/\/ Check if the field exists because it might already have been\n",1141],["T_WHITESPACE","              ",1142],["T_COMMENT","\/\/ created as part of the earlier entity type update event.\n",1142],["T_WHITESPACE","              ",1143],["T_IF","if",1143],["T_WHITESPACE"," ",1143],"(","!",["T_VARIABLE","$schema_handler",1143],["T_OBJECT_OPERATOR","->",1143],["T_STRING","fieldExists",1143],"(",["T_VARIABLE","$table_name",1143],",",["T_WHITESPACE"," ",1143],["T_VARIABLE","$name",1143],")",")",["T_WHITESPACE"," ",1143],"{",["T_WHITESPACE","\n                ",1143],["T_VARIABLE","$schema_handler",1144],["T_OBJECT_OPERATOR","->",1144],["T_STRING","addField",1144],"(",["T_VARIABLE","$table_name",1144],",",["T_WHITESPACE"," ",1144],["T_VARIABLE","$name",1144],",",["T_WHITESPACE"," ",1144],["T_VARIABLE","$specifier",1144],")",";",["T_WHITESPACE","\n              ",1144],"}",["T_WHITESPACE","\n            ",1145],"}",["T_WHITESPACE","\n            ",1146],["T_IF","if",1147],["T_WHITESPACE"," ",1147],"(","!",["T_EMPTY","empty",1147],"(",["T_VARIABLE","$schema",1147],"[",["T_VARIABLE","$table_name",1147],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1147],"]",")",")",["T_WHITESPACE"," ",1147],"{",["T_WHITESPACE","\n              ",1147],["T_FOREACH","foreach",1148],["T_WHITESPACE"," ",1148],"(",["T_VARIABLE","$schema",1148],"[",["T_VARIABLE","$table_name",1148],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1148],"]",["T_WHITESPACE"," ",1148],["T_AS","as",1148],["T_WHITESPACE"," ",1148],["T_VARIABLE","$name",1148],["T_WHITESPACE"," ",1148],["T_DOUBLE_ARROW","=>",1148],["T_WHITESPACE"," ",1148],["T_VARIABLE","$specifier",1148],")",["T_WHITESPACE"," ",1148],"{",["T_WHITESPACE","\n                ",1148],["T_COMMENT","\/\/ Check if the index exists because it might already have been\n",1149],["T_WHITESPACE","                ",1150],["T_COMMENT","\/\/ created as part of the earlier entity type update event.\n",1150],["T_WHITESPACE","                ",1151],["T_VARIABLE","$this",1151],["T_OBJECT_OPERATOR","->",1151],["T_STRING","addIndex",1151],"(",["T_VARIABLE","$table_name",1151],",",["T_WHITESPACE"," ",1151],["T_VARIABLE","$name",1151],",",["T_WHITESPACE"," ",1151],["T_VARIABLE","$specifier",1151],",",["T_WHITESPACE"," ",1151],["T_VARIABLE","$schema",1151],"[",["T_VARIABLE","$table_name",1151],"]",")",";",["T_WHITESPACE","\n              ",1151],"}",["T_WHITESPACE","\n            ",1152],"}",["T_WHITESPACE","\n            ",1153],["T_IF","if",1154],["T_WHITESPACE"," ",1154],"(","!",["T_EMPTY","empty",1154],"(",["T_VARIABLE","$schema",1154],"[",["T_VARIABLE","$table_name",1154],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1154],"]",")",")",["T_WHITESPACE"," ",1154],"{",["T_WHITESPACE","\n              ",1154],["T_FOREACH","foreach",1155],["T_WHITESPACE"," ",1155],"(",["T_VARIABLE","$schema",1155],"[",["T_VARIABLE","$table_name",1155],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1155],"]",["T_WHITESPACE"," ",1155],["T_AS","as",1155],["T_WHITESPACE"," ",1155],["T_VARIABLE","$name",1155],["T_WHITESPACE"," ",1155],["T_DOUBLE_ARROW","=>",1155],["T_WHITESPACE"," ",1155],["T_VARIABLE","$specifier",1155],")",["T_WHITESPACE"," ",1155],"{",["T_WHITESPACE","\n                ",1155],["T_VARIABLE","$schema_handler",1156],["T_OBJECT_OPERATOR","->",1156],["T_STRING","addUniqueKey",1156],"(",["T_VARIABLE","$table_name",1156],",",["T_WHITESPACE"," ",1156],["T_VARIABLE","$name",1156],",",["T_WHITESPACE"," ",1156],["T_VARIABLE","$specifier",1156],")",";",["T_WHITESPACE","\n              ",1156],"}",["T_WHITESPACE","\n            ",1157],"}",["T_WHITESPACE","\n          ",1158],"}",["T_WHITESPACE","\n          ",1159],["T_COMMENT","\/\/ After creating the field schema skip to the next table.\n",1160],["T_WHITESPACE","          ",1161],["T_BREAK","break",1161],";",["T_WHITESPACE","\n        ",1161],"}",["T_WHITESPACE","\n      ",1162],"}",["T_WHITESPACE","\n    ",1163],"}",["T_WHITESPACE","\n\n    ",1164],["T_VARIABLE","$this",1166],["T_OBJECT_OPERATOR","->",1166],["T_STRING","saveFieldSchemaData",1166],"(",["T_VARIABLE","$storage_definition",1166],",",["T_WHITESPACE"," ",1166],["T_VARIABLE","$schema",1166],")",";",["T_WHITESPACE","\n\n    ",1166],["T_IF","if",1168],["T_WHITESPACE"," ",1168],"(","!",["T_VARIABLE","$only_save",1168],")",["T_WHITESPACE"," ",1168],"{",["T_WHITESPACE","\n      ",1168],["T_COMMENT","\/\/ Make sure any entity index involving this field is re-created if\n",1169],["T_WHITESPACE","      ",1170],["T_COMMENT","\/\/ needed.\n",1170],["T_WHITESPACE","      ",1171],["T_VARIABLE","$this",1171],["T_OBJECT_OPERATOR","->",1171],["T_STRING","createEntitySchemaIndexes",1171],"(",["T_VARIABLE","$this",1171],["T_OBJECT_OPERATOR","->",1171],["T_STRING","getEntitySchema",1171],"(",["T_VARIABLE","$this",1171],["T_OBJECT_OPERATOR","->",1171],["T_STRING","entityType",1171],")",",",["T_WHITESPACE"," ",1171],["T_VARIABLE","$storage_definition",1171],")",";",["T_WHITESPACE","\n    ",1171],"}",["T_WHITESPACE","\n  ",1172],"}",["T_WHITESPACE","\n\n  ",1173],["T_DOC_COMMENT","\/**\n   * Deletes the schema for a field stored in a dedicated table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being deleted.\n   *\/",1175],["T_WHITESPACE","\n  ",1180],["T_PROTECTED","protected",1181],["T_WHITESPACE"," ",1181],["T_FUNCTION","function",1181],["T_WHITESPACE"," ",1181],["T_STRING","deleteDedicatedTableSchema",1181],"(",["T_STRING","FieldStorageDefinitionInterface",1181],["T_WHITESPACE"," ",1181],["T_VARIABLE","$storage_definition",1181],")",["T_WHITESPACE"," ",1181],"{",["T_WHITESPACE","\n    ",1181],["T_COMMENT","\/\/ When switching from dedicated to shared field table layout we need need\n",1182],["T_WHITESPACE","    ",1183],["T_COMMENT","\/\/ to delete the field tables with their regular names. When this happens\n",1183],["T_WHITESPACE","    ",1184],["T_COMMENT","\/\/ original definitions will be defined.\n",1184],["T_WHITESPACE","    ",1185],["T_VARIABLE","$deleted",1185],["T_WHITESPACE"," ",1185],"=",["T_WHITESPACE"," ",1185],"!",["T_VARIABLE","$this",1185],["T_OBJECT_OPERATOR","->",1185],["T_STRING","originalDefinitions",1185],";",["T_WHITESPACE","\n    ",1185],["T_VARIABLE","$table_mapping",1186],["T_WHITESPACE"," ",1186],"=",["T_WHITESPACE"," ",1186],["T_VARIABLE","$this",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","storage",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","getTableMapping",1186],"(",")",";",["T_WHITESPACE","\n    ",1186],["T_VARIABLE","$table_name",1187],["T_WHITESPACE"," ",1187],"=",["T_WHITESPACE"," ",1187],["T_VARIABLE","$table_mapping",1187],["T_OBJECT_OPERATOR","->",1187],["T_STRING","getDedicatedDataTableName",1187],"(",["T_VARIABLE","$storage_definition",1187],",",["T_WHITESPACE"," ",1187],["T_VARIABLE","$deleted",1187],")",";",["T_WHITESPACE","\n    ",1187],["T_VARIABLE","$this",1188],["T_OBJECT_OPERATOR","->",1188],["T_STRING","database",1188],["T_OBJECT_OPERATOR","->",1188],["T_STRING","schema",1188],"(",")",["T_OBJECT_OPERATOR","->",1188],["T_STRING","dropTable",1188],"(",["T_VARIABLE","$table_name",1188],")",";",["T_WHITESPACE","\n    ",1188],["T_IF","if",1189],["T_WHITESPACE"," ",1189],"(",["T_VARIABLE","$this",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","entityType",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","isRevisionable",1189],"(",")",")",["T_WHITESPACE"," ",1189],"{",["T_WHITESPACE","\n      ",1189],["T_VARIABLE","$revision_name",1190],["T_WHITESPACE"," ",1190],"=",["T_WHITESPACE"," ",1190],["T_VARIABLE","$table_mapping",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","getDedicatedRevisionTableName",1190],"(",["T_VARIABLE","$storage_definition",1190],",",["T_WHITESPACE"," ",1190],["T_VARIABLE","$deleted",1190],")",";",["T_WHITESPACE","\n      ",1190],["T_VARIABLE","$this",1191],["T_OBJECT_OPERATOR","->",1191],["T_STRING","database",1191],["T_OBJECT_OPERATOR","->",1191],["T_STRING","schema",1191],"(",")",["T_OBJECT_OPERATOR","->",1191],["T_STRING","dropTable",1191],"(",["T_VARIABLE","$revision_name",1191],")",";",["T_WHITESPACE","\n    ",1191],"}",["T_WHITESPACE","\n    ",1192],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","deleteFieldSchemaData",1193],"(",["T_VARIABLE","$storage_definition",1193],")",";",["T_WHITESPACE","\n  ",1193],"}",["T_WHITESPACE","\n\n  ",1194],["T_DOC_COMMENT","\/**\n   * Deletes the schema for a field stored in a shared table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being deleted.\n   *\/",1196],["T_WHITESPACE","\n  ",1201],["T_PROTECTED","protected",1202],["T_WHITESPACE"," ",1202],["T_FUNCTION","function",1202],["T_WHITESPACE"," ",1202],["T_STRING","deleteSharedTableSchema",1202],"(",["T_STRING","FieldStorageDefinitionInterface",1202],["T_WHITESPACE"," ",1202],["T_VARIABLE","$storage_definition",1202],")",["T_WHITESPACE"," ",1202],"{",["T_WHITESPACE","\n    ",1202],["T_COMMENT","\/\/ Make sure any entity index involving this field is dropped.\n",1203],["T_WHITESPACE","    ",1204],["T_VARIABLE","$this",1204],["T_OBJECT_OPERATOR","->",1204],["T_STRING","deleteEntitySchemaIndexes",1204],"(",["T_VARIABLE","$this",1204],["T_OBJECT_OPERATOR","->",1204],["T_STRING","loadEntitySchemaData",1204],"(",["T_VARIABLE","$this",1204],["T_OBJECT_OPERATOR","->",1204],["T_STRING","entityType",1204],")",",",["T_WHITESPACE"," ",1204],["T_VARIABLE","$storage_definition",1204],")",";",["T_WHITESPACE","\n\n    ",1204],["T_VARIABLE","$deleted_field_name",1206],["T_WHITESPACE"," ",1206],"=",["T_WHITESPACE"," ",1206],["T_VARIABLE","$storage_definition",1206],["T_OBJECT_OPERATOR","->",1206],["T_STRING","getName",1206],"(",")",";",["T_WHITESPACE","\n    ",1206],["T_VARIABLE","$table_mapping",1207],["T_WHITESPACE"," ",1207],"=",["T_WHITESPACE"," ",1207],["T_VARIABLE","$this",1207],["T_OBJECT_OPERATOR","->",1207],["T_STRING","storage",1207],["T_OBJECT_OPERATOR","->",1207],["T_STRING","getTableMapping",1207],"(",["T_WHITESPACE","\n      ",1207],["T_VARIABLE","$this",1208],["T_OBJECT_OPERATOR","->",1208],["T_STRING","entityManager",1208],["T_OBJECT_OPERATOR","->",1208],["T_STRING","getLastInstalledFieldStorageDefinitions",1208],"(",["T_VARIABLE","$this",1208],["T_OBJECT_OPERATOR","->",1208],["T_STRING","entityType",1208],["T_OBJECT_OPERATOR","->",1208],["T_STRING","id",1208],"(",")",")",["T_WHITESPACE","\n    ",1208],")",";",["T_WHITESPACE","\n    ",1209],["T_VARIABLE","$column_names",1210],["T_WHITESPACE"," ",1210],"=",["T_WHITESPACE"," ",1210],["T_VARIABLE","$table_mapping",1210],["T_OBJECT_OPERATOR","->",1210],["T_STRING","getColumnNames",1210],"(",["T_VARIABLE","$deleted_field_name",1210],")",";",["T_WHITESPACE","\n    ",1210],["T_VARIABLE","$schema_handler",1211],["T_WHITESPACE"," ",1211],"=",["T_WHITESPACE"," ",1211],["T_VARIABLE","$this",1211],["T_OBJECT_OPERATOR","->",1211],["T_STRING","database",1211],["T_OBJECT_OPERATOR","->",1211],["T_STRING","schema",1211],"(",")",";",["T_WHITESPACE","\n    ",1211],["T_VARIABLE","$shared_table_names",1212],["T_WHITESPACE"," ",1212],"=",["T_WHITESPACE"," ",1212],["T_STRING","array_diff",1212],"(",["T_VARIABLE","$table_mapping",1212],["T_OBJECT_OPERATOR","->",1212],["T_STRING","getTableNames",1212],"(",")",",",["T_WHITESPACE"," ",1212],["T_VARIABLE","$table_mapping",1212],["T_OBJECT_OPERATOR","->",1212],["T_STRING","getDedicatedTableNames",1212],"(",")",")",";",["T_WHITESPACE","\n\n    ",1212],["T_COMMENT","\/\/ Iterate over the mapped table to find the ones that host the deleted\n",1214],["T_WHITESPACE","    ",1215],["T_COMMENT","\/\/ field schema.\n",1215],["T_WHITESPACE","    ",1216],["T_FOREACH","foreach",1216],["T_WHITESPACE"," ",1216],"(",["T_VARIABLE","$shared_table_names",1216],["T_WHITESPACE"," ",1216],["T_AS","as",1216],["T_WHITESPACE"," ",1216],["T_VARIABLE","$table_name",1216],")",["T_WHITESPACE"," ",1216],"{",["T_WHITESPACE","\n      ",1216],["T_FOREACH","foreach",1217],["T_WHITESPACE"," ",1217],"(",["T_VARIABLE","$table_mapping",1217],["T_OBJECT_OPERATOR","->",1217],["T_STRING","getFieldNames",1217],"(",["T_VARIABLE","$table_name",1217],")",["T_WHITESPACE"," ",1217],["T_AS","as",1217],["T_WHITESPACE"," ",1217],["T_VARIABLE","$field_name",1217],")",["T_WHITESPACE"," ",1217],"{",["T_WHITESPACE","\n        ",1217],["T_IF","if",1218],["T_WHITESPACE"," ",1218],"(",["T_VARIABLE","$field_name",1218],["T_WHITESPACE"," ",1218],["T_IS_EQUAL","==",1218],["T_WHITESPACE"," ",1218],["T_VARIABLE","$deleted_field_name",1218],")",["T_WHITESPACE"," ",1218],"{",["T_WHITESPACE","\n          ",1218],["T_VARIABLE","$schema",1219],["T_WHITESPACE"," ",1219],"=",["T_WHITESPACE"," ",1219],["T_VARIABLE","$this",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","getSharedTableFieldSchema",1219],"(",["T_VARIABLE","$storage_definition",1219],",",["T_WHITESPACE"," ",1219],["T_VARIABLE","$table_name",1219],",",["T_WHITESPACE"," ",1219],["T_VARIABLE","$column_names",1219],")",";",["T_WHITESPACE","\n\n          ",1219],["T_COMMENT","\/\/ Drop indexes and unique keys first.\n",1221],["T_WHITESPACE","          ",1222],["T_IF","if",1222],["T_WHITESPACE"," ",1222],"(","!",["T_EMPTY","empty",1222],"(",["T_VARIABLE","$schema",1222],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1222],"]",")",")",["T_WHITESPACE"," ",1222],"{",["T_WHITESPACE","\n            ",1222],["T_FOREACH","foreach",1223],["T_WHITESPACE"," ",1223],"(",["T_VARIABLE","$schema",1223],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1223],"]",["T_WHITESPACE"," ",1223],["T_AS","as",1223],["T_WHITESPACE"," ",1223],["T_VARIABLE","$name",1223],["T_WHITESPACE"," ",1223],["T_DOUBLE_ARROW","=>",1223],["T_WHITESPACE"," ",1223],["T_VARIABLE","$specifier",1223],")",["T_WHITESPACE"," ",1223],"{",["T_WHITESPACE","\n              ",1223],["T_VARIABLE","$schema_handler",1224],["T_OBJECT_OPERATOR","->",1224],["T_STRING","dropIndex",1224],"(",["T_VARIABLE","$table_name",1224],",",["T_WHITESPACE"," ",1224],["T_VARIABLE","$name",1224],")",";",["T_WHITESPACE","\n            ",1224],"}",["T_WHITESPACE","\n          ",1225],"}",["T_WHITESPACE","\n          ",1226],["T_IF","if",1227],["T_WHITESPACE"," ",1227],"(","!",["T_EMPTY","empty",1227],"(",["T_VARIABLE","$schema",1227],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1227],"]",")",")",["T_WHITESPACE"," ",1227],"{",["T_WHITESPACE","\n            ",1227],["T_FOREACH","foreach",1228],["T_WHITESPACE"," ",1228],"(",["T_VARIABLE","$schema",1228],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1228],"]",["T_WHITESPACE"," ",1228],["T_AS","as",1228],["T_WHITESPACE"," ",1228],["T_VARIABLE","$name",1228],["T_WHITESPACE"," ",1228],["T_DOUBLE_ARROW","=>",1228],["T_WHITESPACE"," ",1228],["T_VARIABLE","$specifier",1228],")",["T_WHITESPACE"," ",1228],"{",["T_WHITESPACE","\n              ",1228],["T_VARIABLE","$schema_handler",1229],["T_OBJECT_OPERATOR","->",1229],["T_STRING","dropUniqueKey",1229],"(",["T_VARIABLE","$table_name",1229],",",["T_WHITESPACE"," ",1229],["T_VARIABLE","$name",1229],")",";",["T_WHITESPACE","\n            ",1229],"}",["T_WHITESPACE","\n          ",1230],"}",["T_WHITESPACE","\n          ",1231],["T_COMMENT","\/\/ Drop columns.\n",1232],["T_WHITESPACE","          ",1233],["T_FOREACH","foreach",1233],["T_WHITESPACE"," ",1233],"(",["T_VARIABLE","$column_names",1233],["T_WHITESPACE"," ",1233],["T_AS","as",1233],["T_WHITESPACE"," ",1233],["T_VARIABLE","$column_name",1233],")",["T_WHITESPACE"," ",1233],"{",["T_WHITESPACE","\n            ",1233],["T_VARIABLE","$schema_handler",1234],["T_OBJECT_OPERATOR","->",1234],["T_STRING","dropField",1234],"(",["T_VARIABLE","$table_name",1234],",",["T_WHITESPACE"," ",1234],["T_VARIABLE","$column_name",1234],")",";",["T_WHITESPACE","\n          ",1234],"}",["T_WHITESPACE","\n          ",1235],["T_COMMENT","\/\/ After deleting the field schema skip to the next table.\n",1236],["T_WHITESPACE","          ",1237],["T_BREAK","break",1237],";",["T_WHITESPACE","\n        ",1237],"}",["T_WHITESPACE","\n      ",1238],"}",["T_WHITESPACE","\n    ",1239],"}",["T_WHITESPACE","\n\n    ",1240],["T_VARIABLE","$this",1242],["T_OBJECT_OPERATOR","->",1242],["T_STRING","deleteFieldSchemaData",1242],"(",["T_VARIABLE","$storage_definition",1242],")",";",["T_WHITESPACE","\n  ",1242],"}",["T_WHITESPACE","\n\n  ",1243],["T_DOC_COMMENT","\/**\n   * Updates the schema for a field stored in a shared table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being updated.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $original\n   *   The original storage definition; i.e., the definition before the update.\n   *\n   * @throws \\Drupal\\Core\\Entity\\Exception\\FieldStorageDefinitionUpdateForbiddenException\n   *   Thrown when the update to the field is forbidden.\n   * @throws \\Exception\n   *   Rethrown exception if the table recreation fails.\n   *\/",1245],["T_WHITESPACE","\n  ",1257],["T_PROTECTED","protected",1258],["T_WHITESPACE"," ",1258],["T_FUNCTION","function",1258],["T_WHITESPACE"," ",1258],["T_STRING","updateDedicatedTableSchema",1258],"(",["T_STRING","FieldStorageDefinitionInterface",1258],["T_WHITESPACE"," ",1258],["T_VARIABLE","$storage_definition",1258],",",["T_WHITESPACE"," ",1258],["T_STRING","FieldStorageDefinitionInterface",1258],["T_WHITESPACE"," ",1258],["T_VARIABLE","$original",1258],")",["T_WHITESPACE"," ",1258],"{",["T_WHITESPACE","\n    ",1258],["T_IF","if",1259],["T_WHITESPACE"," ",1259],"(","!",["T_VARIABLE","$this",1259],["T_OBJECT_OPERATOR","->",1259],["T_STRING","storage",1259],["T_OBJECT_OPERATOR","->",1259],["T_STRING","countFieldData",1259],"(",["T_VARIABLE","$original",1259],",",["T_WHITESPACE"," ",1259],["T_STRING","TRUE",1259],")",")",["T_WHITESPACE"," ",1259],"{",["T_WHITESPACE","\n      ",1259],["T_COMMENT","\/\/ There is no data. Re-create the tables completely.\n",1260],["T_WHITESPACE","      ",1261],["T_IF","if",1261],["T_WHITESPACE"," ",1261],"(",["T_VARIABLE","$this",1261],["T_OBJECT_OPERATOR","->",1261],["T_STRING","database",1261],["T_OBJECT_OPERATOR","->",1261],["T_STRING","supportsTransactionalDDL",1261],"(",")",")",["T_WHITESPACE"," ",1261],"{",["T_WHITESPACE","\n        ",1261],["T_COMMENT","\/\/ If the database supports transactional DDL, we can go ahead and rely\n",1262],["T_WHITESPACE","        ",1263],["T_COMMENT","\/\/ on it. If not, we will have to rollback manually if something fails.\n",1263],["T_WHITESPACE","        ",1264],["T_VARIABLE","$transaction",1264],["T_WHITESPACE"," ",1264],"=",["T_WHITESPACE"," ",1264],["T_VARIABLE","$this",1264],["T_OBJECT_OPERATOR","->",1264],["T_STRING","database",1264],["T_OBJECT_OPERATOR","->",1264],["T_STRING","startTransaction",1264],"(",")",";",["T_WHITESPACE","\n      ",1264],"}",["T_WHITESPACE","\n      ",1265],["T_TRY","try",1266],["T_WHITESPACE"," ",1266],"{",["T_WHITESPACE","\n        ",1266],["T_COMMENT","\/\/ Since there is no data we may be switching from a shared table schema\n",1267],["T_WHITESPACE","        ",1268],["T_COMMENT","\/\/ to a dedicated table schema, hence we should use the proper API.\n",1268],["T_WHITESPACE","        ",1269],["T_VARIABLE","$this",1269],["T_OBJECT_OPERATOR","->",1269],["T_STRING","performFieldSchemaOperation",1269],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",1269],",",["T_WHITESPACE"," ",1269],["T_VARIABLE","$original",1269],")",";",["T_WHITESPACE","\n        ",1269],["T_VARIABLE","$this",1270],["T_OBJECT_OPERATOR","->",1270],["T_STRING","performFieldSchemaOperation",1270],"(",["T_CONSTANT_ENCAPSED_STRING","'create'",1270],",",["T_WHITESPACE"," ",1270],["T_VARIABLE","$storage_definition",1270],")",";",["T_WHITESPACE","\n      ",1270],"}",["T_WHITESPACE","\n      ",1271],["T_CATCH","catch",1272],["T_WHITESPACE"," ",1272],"(",["T_NS_SEPARATOR","\\",1272],["T_STRING","Exception",1272],["T_WHITESPACE"," ",1272],["T_VARIABLE","$e",1272],")",["T_WHITESPACE"," ",1272],"{",["T_WHITESPACE","\n        ",1272],["T_IF","if",1273],["T_WHITESPACE"," ",1273],"(",["T_VARIABLE","$this",1273],["T_OBJECT_OPERATOR","->",1273],["T_STRING","database",1273],["T_OBJECT_OPERATOR","->",1273],["T_STRING","supportsTransactionalDDL",1273],"(",")",")",["T_WHITESPACE"," ",1273],"{",["T_WHITESPACE","\n          ",1273],["T_VARIABLE","$transaction",1274],["T_OBJECT_OPERATOR","->",1274],["T_STRING","rollback",1274],"(",")",";",["T_WHITESPACE","\n        ",1274],"}",["T_WHITESPACE","\n        ",1275],["T_ELSE","else",1276],["T_WHITESPACE"," ",1276],"{",["T_WHITESPACE","\n          ",1276],["T_COMMENT","\/\/ Recreate tables.\n",1277],["T_WHITESPACE","          ",1278],["T_VARIABLE","$this",1278],["T_OBJECT_OPERATOR","->",1278],["T_STRING","performFieldSchemaOperation",1278],"(",["T_CONSTANT_ENCAPSED_STRING","'create'",1278],",",["T_WHITESPACE"," ",1278],["T_VARIABLE","$original",1278],")",";",["T_WHITESPACE","\n        ",1278],"}",["T_WHITESPACE","\n        ",1279],["T_THROW","throw",1280],["T_WHITESPACE"," ",1280],["T_VARIABLE","$e",1280],";",["T_WHITESPACE","\n      ",1280],"}",["T_WHITESPACE","\n    ",1281],"}",["T_WHITESPACE","\n    ",1282],["T_ELSE","else",1283],["T_WHITESPACE"," ",1283],"{",["T_WHITESPACE","\n      ",1283],["T_IF","if",1284],["T_WHITESPACE"," ",1284],"(",["T_VARIABLE","$this",1284],["T_OBJECT_OPERATOR","->",1284],["T_STRING","hasColumnChanges",1284],"(",["T_VARIABLE","$storage_definition",1284],",",["T_WHITESPACE"," ",1284],["T_VARIABLE","$original",1284],")",")",["T_WHITESPACE"," ",1284],"{",["T_WHITESPACE","\n        ",1284],["T_THROW","throw",1285],["T_WHITESPACE"," ",1285],["T_NEW","new",1285],["T_WHITESPACE"," ",1285],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",1285],"(",["T_CONSTANT_ENCAPSED_STRING","'The SQL storage cannot change the schema for an existing field ('",1285],["T_WHITESPACE"," ",1285],".",["T_WHITESPACE"," ",1285],["T_VARIABLE","$storage_definition",1285],["T_OBJECT_OPERATOR","->",1285],["T_STRING","getName",1285],"(",")",["T_WHITESPACE"," ",1285],".",["T_WHITESPACE"," ",1285],["T_CONSTANT_ENCAPSED_STRING","' in '",1285],["T_WHITESPACE"," ",1285],".",["T_WHITESPACE"," ",1285],["T_VARIABLE","$storage_definition",1285],["T_OBJECT_OPERATOR","->",1285],["T_STRING","getTargetEntityTypeId",1285],"(",")",["T_WHITESPACE"," ",1285],".",["T_WHITESPACE"," ",1285],["T_CONSTANT_ENCAPSED_STRING","' entity) with data.'",1285],")",";",["T_WHITESPACE","\n      ",1285],"}",["T_WHITESPACE","\n      ",1286],["T_COMMENT","\/\/ There is data, so there are no column changes. Drop all the prior\n",1287],["T_WHITESPACE","      ",1288],["T_COMMENT","\/\/ indexes and create all the new ones, except for all the priors that\n",1288],["T_WHITESPACE","      ",1289],["T_COMMENT","\/\/ exist unchanged.\n",1289],["T_WHITESPACE","      ",1290],["T_VARIABLE","$table_mapping",1290],["T_WHITESPACE"," ",1290],"=",["T_WHITESPACE"," ",1290],["T_VARIABLE","$this",1290],["T_OBJECT_OPERATOR","->",1290],["T_STRING","storage",1290],["T_OBJECT_OPERATOR","->",1290],["T_STRING","getTableMapping",1290],"(",")",";",["T_WHITESPACE","\n      ",1290],["T_VARIABLE","$table",1291],["T_WHITESPACE"," ",1291],"=",["T_WHITESPACE"," ",1291],["T_VARIABLE","$table_mapping",1291],["T_OBJECT_OPERATOR","->",1291],["T_STRING","getDedicatedDataTableName",1291],"(",["T_VARIABLE","$original",1291],")",";",["T_WHITESPACE","\n      ",1291],["T_VARIABLE","$revision_table",1292],["T_WHITESPACE"," ",1292],"=",["T_WHITESPACE"," ",1292],["T_VARIABLE","$table_mapping",1292],["T_OBJECT_OPERATOR","->",1292],["T_STRING","getDedicatedRevisionTableName",1292],"(",["T_VARIABLE","$original",1292],")",";",["T_WHITESPACE","\n\n      ",1292],["T_COMMENT","\/\/ Get the field schemas.\n",1294],["T_WHITESPACE","      ",1295],["T_VARIABLE","$schema",1295],["T_WHITESPACE"," ",1295],"=",["T_WHITESPACE"," ",1295],["T_VARIABLE","$storage_definition",1295],["T_OBJECT_OPERATOR","->",1295],["T_STRING","getSchema",1295],"(",")",";",["T_WHITESPACE","\n      ",1295],["T_VARIABLE","$original_schema",1296],["T_WHITESPACE"," ",1296],"=",["T_WHITESPACE"," ",1296],["T_VARIABLE","$original",1296],["T_OBJECT_OPERATOR","->",1296],["T_STRING","getSchema",1296],"(",")",";",["T_WHITESPACE","\n\n      ",1296],["T_COMMENT","\/\/ Gets the SQL schema for a dedicated tables.\n",1298],["T_WHITESPACE","      ",1299],["T_VARIABLE","$actual_schema",1299],["T_WHITESPACE"," ",1299],"=",["T_WHITESPACE"," ",1299],["T_VARIABLE","$this",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","getDedicatedTableSchema",1299],"(",["T_VARIABLE","$storage_definition",1299],")",";",["T_WHITESPACE","\n\n      ",1299],["T_FOREACH","foreach",1301],["T_WHITESPACE"," ",1301],"(",["T_VARIABLE","$original_schema",1301],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1301],"]",["T_WHITESPACE"," ",1301],["T_AS","as",1301],["T_WHITESPACE"," ",1301],["T_VARIABLE","$name",1301],["T_WHITESPACE"," ",1301],["T_DOUBLE_ARROW","=>",1301],["T_WHITESPACE"," ",1301],["T_VARIABLE","$columns",1301],")",["T_WHITESPACE"," ",1301],"{",["T_WHITESPACE","\n        ",1301],["T_IF","if",1302],["T_WHITESPACE"," ",1302],"(","!",["T_ISSET","isset",1302],"(",["T_VARIABLE","$schema",1302],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1302],"]","[",["T_VARIABLE","$name",1302],"]",")",["T_WHITESPACE"," ",1302],["T_BOOLEAN_OR","||",1302],["T_WHITESPACE"," ",1302],["T_VARIABLE","$columns",1302],["T_WHITESPACE"," ",1302],["T_IS_NOT_EQUAL","!=",1302],["T_WHITESPACE"," ",1302],["T_VARIABLE","$schema",1302],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1302],"]","[",["T_VARIABLE","$name",1302],"]",")",["T_WHITESPACE"," ",1302],"{",["T_WHITESPACE","\n          ",1302],["T_VARIABLE","$real_name",1303],["T_WHITESPACE"," ",1303],"=",["T_WHITESPACE"," ",1303],["T_VARIABLE","$this",1303],["T_OBJECT_OPERATOR","->",1303],["T_STRING","getFieldIndexName",1303],"(",["T_VARIABLE","$storage_definition",1303],",",["T_WHITESPACE"," ",1303],["T_VARIABLE","$name",1303],")",";",["T_WHITESPACE","\n          ",1303],["T_VARIABLE","$this",1304],["T_OBJECT_OPERATOR","->",1304],["T_STRING","database",1304],["T_OBJECT_OPERATOR","->",1304],["T_STRING","schema",1304],"(",")",["T_OBJECT_OPERATOR","->",1304],["T_STRING","dropIndex",1304],"(",["T_VARIABLE","$table",1304],",",["T_WHITESPACE"," ",1304],["T_VARIABLE","$real_name",1304],")",";",["T_WHITESPACE","\n          ",1304],["T_VARIABLE","$this",1305],["T_OBJECT_OPERATOR","->",1305],["T_STRING","database",1305],["T_OBJECT_OPERATOR","->",1305],["T_STRING","schema",1305],"(",")",["T_OBJECT_OPERATOR","->",1305],["T_STRING","dropIndex",1305],"(",["T_VARIABLE","$revision_table",1305],",",["T_WHITESPACE"," ",1305],["T_VARIABLE","$real_name",1305],")",";",["T_WHITESPACE","\n        ",1305],"}",["T_WHITESPACE","\n      ",1306],"}",["T_WHITESPACE","\n      ",1307],["T_VARIABLE","$table",1308],["T_WHITESPACE"," ",1308],"=",["T_WHITESPACE"," ",1308],["T_VARIABLE","$table_mapping",1308],["T_OBJECT_OPERATOR","->",1308],["T_STRING","getDedicatedDataTableName",1308],"(",["T_VARIABLE","$storage_definition",1308],")",";",["T_WHITESPACE","\n      ",1308],["T_VARIABLE","$revision_table",1309],["T_WHITESPACE"," ",1309],"=",["T_WHITESPACE"," ",1309],["T_VARIABLE","$table_mapping",1309],["T_OBJECT_OPERATOR","->",1309],["T_STRING","getDedicatedRevisionTableName",1309],"(",["T_VARIABLE","$storage_definition",1309],")",";",["T_WHITESPACE","\n      ",1309],["T_FOREACH","foreach",1310],["T_WHITESPACE"," ",1310],"(",["T_VARIABLE","$schema",1310],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1310],"]",["T_WHITESPACE"," ",1310],["T_AS","as",1310],["T_WHITESPACE"," ",1310],["T_VARIABLE","$name",1310],["T_WHITESPACE"," ",1310],["T_DOUBLE_ARROW","=>",1310],["T_WHITESPACE"," ",1310],["T_VARIABLE","$columns",1310],")",["T_WHITESPACE"," ",1310],"{",["T_WHITESPACE","\n        ",1310],["T_IF","if",1311],["T_WHITESPACE"," ",1311],"(","!",["T_ISSET","isset",1311],"(",["T_VARIABLE","$original_schema",1311],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1311],"]","[",["T_VARIABLE","$name",1311],"]",")",["T_WHITESPACE"," ",1311],["T_BOOLEAN_OR","||",1311],["T_WHITESPACE"," ",1311],["T_VARIABLE","$columns",1311],["T_WHITESPACE"," ",1311],["T_IS_NOT_EQUAL","!=",1311],["T_WHITESPACE"," ",1311],["T_VARIABLE","$original_schema",1311],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1311],"]","[",["T_VARIABLE","$name",1311],"]",")",["T_WHITESPACE"," ",1311],"{",["T_WHITESPACE","\n          ",1311],["T_VARIABLE","$real_name",1312],["T_WHITESPACE"," ",1312],"=",["T_WHITESPACE"," ",1312],["T_VARIABLE","$this",1312],["T_OBJECT_OPERATOR","->",1312],["T_STRING","getFieldIndexName",1312],"(",["T_VARIABLE","$storage_definition",1312],",",["T_WHITESPACE"," ",1312],["T_VARIABLE","$name",1312],")",";",["T_WHITESPACE","\n          ",1312],["T_VARIABLE","$real_columns",1313],["T_WHITESPACE"," ",1313],"=",["T_WHITESPACE"," ",1313],["T_ARRAY","array",1313],"(",")",";",["T_WHITESPACE","\n          ",1313],["T_FOREACH","foreach",1314],["T_WHITESPACE"," ",1314],"(",["T_VARIABLE","$columns",1314],["T_WHITESPACE"," ",1314],["T_AS","as",1314],["T_WHITESPACE"," ",1314],["T_VARIABLE","$column_name",1314],")",["T_WHITESPACE"," ",1314],"{",["T_WHITESPACE","\n            ",1314],["T_COMMENT","\/\/ Indexes can be specified as either a column name or an array with\n",1315],["T_WHITESPACE","            ",1316],["T_COMMENT","\/\/ column name and length. Allow for either case.\n",1316],["T_WHITESPACE","            ",1317],["T_IF","if",1317],["T_WHITESPACE"," ",1317],"(",["T_STRING","is_array",1317],"(",["T_VARIABLE","$column_name",1317],")",")",["T_WHITESPACE"," ",1317],"{",["T_WHITESPACE","\n              ",1317],["T_VARIABLE","$real_columns",1318],"[","]",["T_WHITESPACE"," ",1318],"=",["T_WHITESPACE"," ",1318],["T_ARRAY","array",1318],"(",["T_WHITESPACE","\n                ",1318],["T_VARIABLE","$table_mapping",1319],["T_OBJECT_OPERATOR","->",1319],["T_STRING","getFieldColumnName",1319],"(",["T_VARIABLE","$storage_definition",1319],",",["T_WHITESPACE"," ",1319],["T_VARIABLE","$column_name",1319],"[",["T_LNUMBER","0",1319],"]",")",",",["T_WHITESPACE","\n                ",1319],["T_VARIABLE","$column_name",1320],"[",["T_LNUMBER","1",1320],"]",",",["T_WHITESPACE","\n              ",1320],")",";",["T_WHITESPACE","\n            ",1321],"}",["T_WHITESPACE","\n            ",1322],["T_ELSE","else",1323],["T_WHITESPACE"," ",1323],"{",["T_WHITESPACE","\n              ",1323],["T_VARIABLE","$real_columns",1324],"[","]",["T_WHITESPACE"," ",1324],"=",["T_WHITESPACE"," ",1324],["T_VARIABLE","$table_mapping",1324],["T_OBJECT_OPERATOR","->",1324],["T_STRING","getFieldColumnName",1324],"(",["T_VARIABLE","$storage_definition",1324],",",["T_WHITESPACE"," ",1324],["T_VARIABLE","$column_name",1324],")",";",["T_WHITESPACE","\n            ",1324],"}",["T_WHITESPACE","\n          ",1325],"}",["T_WHITESPACE","\n          ",1326],["T_COMMENT","\/\/ Check if the index exists because it might already have been\n",1327],["T_WHITESPACE","          ",1328],["T_COMMENT","\/\/ created as part of the earlier entity type update event.\n",1328],["T_WHITESPACE","          ",1329],["T_VARIABLE","$this",1329],["T_OBJECT_OPERATOR","->",1329],["T_STRING","addIndex",1329],"(",["T_VARIABLE","$table",1329],",",["T_WHITESPACE"," ",1329],["T_VARIABLE","$real_name",1329],",",["T_WHITESPACE"," ",1329],["T_VARIABLE","$real_columns",1329],",",["T_WHITESPACE"," ",1329],["T_VARIABLE","$actual_schema",1329],"[",["T_VARIABLE","$table",1329],"]",")",";",["T_WHITESPACE","\n          ",1329],["T_VARIABLE","$this",1330],["T_OBJECT_OPERATOR","->",1330],["T_STRING","addIndex",1330],"(",["T_VARIABLE","$revision_table",1330],",",["T_WHITESPACE"," ",1330],["T_VARIABLE","$real_name",1330],",",["T_WHITESPACE"," ",1330],["T_VARIABLE","$real_columns",1330],",",["T_WHITESPACE"," ",1330],["T_VARIABLE","$actual_schema",1330],"[",["T_VARIABLE","$revision_table",1330],"]",")",";",["T_WHITESPACE","\n        ",1330],"}",["T_WHITESPACE","\n      ",1331],"}",["T_WHITESPACE","\n      ",1332],["T_VARIABLE","$this",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","saveFieldSchemaData",1333],"(",["T_VARIABLE","$storage_definition",1333],",",["T_WHITESPACE"," ",1333],["T_VARIABLE","$this",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","getDedicatedTableSchema",1333],"(",["T_VARIABLE","$storage_definition",1333],")",")",";",["T_WHITESPACE","\n    ",1333],"}",["T_WHITESPACE","\n  ",1334],"}",["T_WHITESPACE","\n\n  ",1335],["T_DOC_COMMENT","\/**\n   * Updates the schema for a field stored in a shared table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field being updated.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $original\n   *   The original storage definition; i.e., the definition before the update.\n   *\n   * @throws \\Drupal\\Core\\Entity\\Exception\\FieldStorageDefinitionUpdateForbiddenException\n   *   Thrown when the update to the field is forbidden.\n   * @throws \\Exception\n   *   Rethrown exception if the table recreation fails.\n   *\/",1337],["T_WHITESPACE","\n  ",1349],["T_PROTECTED","protected",1350],["T_WHITESPACE"," ",1350],["T_FUNCTION","function",1350],["T_WHITESPACE"," ",1350],["T_STRING","updateSharedTableSchema",1350],"(",["T_STRING","FieldStorageDefinitionInterface",1350],["T_WHITESPACE"," ",1350],["T_VARIABLE","$storage_definition",1350],",",["T_WHITESPACE"," ",1350],["T_STRING","FieldStorageDefinitionInterface",1350],["T_WHITESPACE"," ",1350],["T_VARIABLE","$original",1350],")",["T_WHITESPACE"," ",1350],"{",["T_WHITESPACE","\n    ",1350],["T_IF","if",1351],["T_WHITESPACE"," ",1351],"(","!",["T_VARIABLE","$this",1351],["T_OBJECT_OPERATOR","->",1351],["T_STRING","storage",1351],["T_OBJECT_OPERATOR","->",1351],["T_STRING","countFieldData",1351],"(",["T_VARIABLE","$original",1351],",",["T_WHITESPACE"," ",1351],["T_STRING","TRUE",1351],")",")",["T_WHITESPACE"," ",1351],"{",["T_WHITESPACE","\n      ",1351],["T_IF","if",1352],["T_WHITESPACE"," ",1352],"(",["T_VARIABLE","$this",1352],["T_OBJECT_OPERATOR","->",1352],["T_STRING","database",1352],["T_OBJECT_OPERATOR","->",1352],["T_STRING","supportsTransactionalDDL",1352],"(",")",")",["T_WHITESPACE"," ",1352],"{",["T_WHITESPACE","\n        ",1352],["T_COMMENT","\/\/ If the database supports transactional DDL, we can go ahead and rely\n",1353],["T_WHITESPACE","        ",1354],["T_COMMENT","\/\/ on it. If not, we will have to rollback manually if something fails.\n",1354],["T_WHITESPACE","        ",1355],["T_VARIABLE","$transaction",1355],["T_WHITESPACE"," ",1355],"=",["T_WHITESPACE"," ",1355],["T_VARIABLE","$this",1355],["T_OBJECT_OPERATOR","->",1355],["T_STRING","database",1355],["T_OBJECT_OPERATOR","->",1355],["T_STRING","startTransaction",1355],"(",")",";",["T_WHITESPACE","\n      ",1355],"}",["T_WHITESPACE","\n      ",1356],["T_TRY","try",1357],["T_WHITESPACE"," ",1357],"{",["T_WHITESPACE","\n        ",1357],["T_COMMENT","\/\/ Since there is no data we may be switching from a dedicated table\n",1358],["T_WHITESPACE","        ",1359],["T_COMMENT","\/\/ to a schema table schema, hence we should use the proper API.\n",1359],["T_WHITESPACE","        ",1360],["T_VARIABLE","$this",1360],["T_OBJECT_OPERATOR","->",1360],["T_STRING","performFieldSchemaOperation",1360],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",1360],",",["T_WHITESPACE"," ",1360],["T_VARIABLE","$original",1360],")",";",["T_WHITESPACE","\n        ",1360],["T_VARIABLE","$this",1361],["T_OBJECT_OPERATOR","->",1361],["T_STRING","performFieldSchemaOperation",1361],"(",["T_CONSTANT_ENCAPSED_STRING","'create'",1361],",",["T_WHITESPACE"," ",1361],["T_VARIABLE","$storage_definition",1361],")",";",["T_WHITESPACE","\n      ",1361],"}",["T_WHITESPACE","\n      ",1362],["T_CATCH","catch",1363],["T_WHITESPACE"," ",1363],"(",["T_NS_SEPARATOR","\\",1363],["T_STRING","Exception",1363],["T_WHITESPACE"," ",1363],["T_VARIABLE","$e",1363],")",["T_WHITESPACE"," ",1363],"{",["T_WHITESPACE","\n        ",1363],["T_IF","if",1364],["T_WHITESPACE"," ",1364],"(",["T_VARIABLE","$this",1364],["T_OBJECT_OPERATOR","->",1364],["T_STRING","database",1364],["T_OBJECT_OPERATOR","->",1364],["T_STRING","supportsTransactionalDDL",1364],"(",")",")",["T_WHITESPACE"," ",1364],"{",["T_WHITESPACE","\n          ",1364],["T_VARIABLE","$transaction",1365],["T_OBJECT_OPERATOR","->",1365],["T_STRING","rollback",1365],"(",")",";",["T_WHITESPACE","\n        ",1365],"}",["T_WHITESPACE","\n        ",1366],["T_ELSE","else",1367],["T_WHITESPACE"," ",1367],"{",["T_WHITESPACE","\n          ",1367],["T_COMMENT","\/\/ Recreate original schema.\n",1368],["T_WHITESPACE","          ",1369],["T_VARIABLE","$this",1369],["T_OBJECT_OPERATOR","->",1369],["T_STRING","createSharedTableSchema",1369],"(",["T_VARIABLE","$original",1369],")",";",["T_WHITESPACE","\n        ",1369],"}",["T_WHITESPACE","\n        ",1370],["T_THROW","throw",1371],["T_WHITESPACE"," ",1371],["T_VARIABLE","$e",1371],";",["T_WHITESPACE","\n      ",1371],"}",["T_WHITESPACE","\n    ",1372],"}",["T_WHITESPACE","\n    ",1373],["T_ELSE","else",1374],["T_WHITESPACE"," ",1374],"{",["T_WHITESPACE","\n      ",1374],["T_IF","if",1375],["T_WHITESPACE"," ",1375],"(",["T_VARIABLE","$this",1375],["T_OBJECT_OPERATOR","->",1375],["T_STRING","hasColumnChanges",1375],"(",["T_VARIABLE","$storage_definition",1375],",",["T_WHITESPACE"," ",1375],["T_VARIABLE","$original",1375],")",")",["T_WHITESPACE"," ",1375],"{",["T_WHITESPACE","\n        ",1375],["T_THROW","throw",1376],["T_WHITESPACE"," ",1376],["T_NEW","new",1376],["T_WHITESPACE"," ",1376],["T_STRING","FieldStorageDefinitionUpdateForbiddenException",1376],"(",["T_CONSTANT_ENCAPSED_STRING","'The SQL storage cannot change the schema for an existing field ('",1376],["T_WHITESPACE"," ",1376],".",["T_WHITESPACE"," ",1376],["T_VARIABLE","$storage_definition",1376],["T_OBJECT_OPERATOR","->",1376],["T_STRING","getName",1376],"(",")",["T_WHITESPACE"," ",1376],".",["T_WHITESPACE"," ",1376],["T_CONSTANT_ENCAPSED_STRING","' in '",1376],["T_WHITESPACE"," ",1376],".",["T_WHITESPACE"," ",1376],["T_VARIABLE","$storage_definition",1376],["T_OBJECT_OPERATOR","->",1376],["T_STRING","getTargetEntityTypeId",1376],"(",")",["T_WHITESPACE"," ",1376],".",["T_WHITESPACE"," ",1376],["T_CONSTANT_ENCAPSED_STRING","' entity) with data.'",1376],")",";",["T_WHITESPACE","\n      ",1376],"}",["T_WHITESPACE","\n\n      ",1377],["T_VARIABLE","$updated_field_name",1379],["T_WHITESPACE"," ",1379],"=",["T_WHITESPACE"," ",1379],["T_VARIABLE","$storage_definition",1379],["T_OBJECT_OPERATOR","->",1379],["T_STRING","getName",1379],"(",")",";",["T_WHITESPACE","\n      ",1379],["T_VARIABLE","$table_mapping",1380],["T_WHITESPACE"," ",1380],"=",["T_WHITESPACE"," ",1380],["T_VARIABLE","$this",1380],["T_OBJECT_OPERATOR","->",1380],["T_STRING","storage",1380],["T_OBJECT_OPERATOR","->",1380],["T_STRING","getTableMapping",1380],"(",")",";",["T_WHITESPACE","\n      ",1380],["T_VARIABLE","$column_names",1381],["T_WHITESPACE"," ",1381],"=",["T_WHITESPACE"," ",1381],["T_VARIABLE","$table_mapping",1381],["T_OBJECT_OPERATOR","->",1381],["T_STRING","getColumnNames",1381],"(",["T_VARIABLE","$updated_field_name",1381],")",";",["T_WHITESPACE","\n      ",1381],["T_VARIABLE","$schema_handler",1382],["T_WHITESPACE"," ",1382],"=",["T_WHITESPACE"," ",1382],["T_VARIABLE","$this",1382],["T_OBJECT_OPERATOR","->",1382],["T_STRING","database",1382],["T_OBJECT_OPERATOR","->",1382],["T_STRING","schema",1382],"(",")",";",["T_WHITESPACE","\n\n      ",1382],["T_COMMENT","\/\/ Iterate over the mapped table to find the ones that host the deleted\n",1384],["T_WHITESPACE","      ",1385],["T_COMMENT","\/\/ field schema.\n",1385],["T_WHITESPACE","      ",1386],["T_VARIABLE","$original_schema",1386],["T_WHITESPACE"," ",1386],"=",["T_WHITESPACE"," ",1386],["T_VARIABLE","$this",1386],["T_OBJECT_OPERATOR","->",1386],["T_STRING","loadFieldSchemaData",1386],"(",["T_VARIABLE","$original",1386],")",";",["T_WHITESPACE","\n      ",1386],["T_VARIABLE","$schema",1387],["T_WHITESPACE"," ",1387],"=",["T_WHITESPACE"," ",1387],["T_ARRAY","array",1387],"(",")",";",["T_WHITESPACE","\n      ",1387],["T_FOREACH","foreach",1388],["T_WHITESPACE"," ",1388],"(",["T_VARIABLE","$table_mapping",1388],["T_OBJECT_OPERATOR","->",1388],["T_STRING","getTableNames",1388],"(",")",["T_WHITESPACE"," ",1388],["T_AS","as",1388],["T_WHITESPACE"," ",1388],["T_VARIABLE","$table_name",1388],")",["T_WHITESPACE"," ",1388],"{",["T_WHITESPACE","\n        ",1388],["T_FOREACH","foreach",1389],["T_WHITESPACE"," ",1389],"(",["T_VARIABLE","$table_mapping",1389],["T_OBJECT_OPERATOR","->",1389],["T_STRING","getFieldNames",1389],"(",["T_VARIABLE","$table_name",1389],")",["T_WHITESPACE"," ",1389],["T_AS","as",1389],["T_WHITESPACE"," ",1389],["T_VARIABLE","$field_name",1389],")",["T_WHITESPACE"," ",1389],"{",["T_WHITESPACE","\n          ",1389],["T_IF","if",1390],["T_WHITESPACE"," ",1390],"(",["T_VARIABLE","$field_name",1390],["T_WHITESPACE"," ",1390],["T_IS_EQUAL","==",1390],["T_WHITESPACE"," ",1390],["T_VARIABLE","$updated_field_name",1390],")",["T_WHITESPACE"," ",1390],"{",["T_WHITESPACE","\n            ",1390],["T_VARIABLE","$schema",1391],"[",["T_VARIABLE","$table_name",1391],"]",["T_WHITESPACE"," ",1391],"=",["T_WHITESPACE"," ",1391],["T_VARIABLE","$this",1391],["T_OBJECT_OPERATOR","->",1391],["T_STRING","getSharedTableFieldSchema",1391],"(",["T_VARIABLE","$storage_definition",1391],",",["T_WHITESPACE"," ",1391],["T_VARIABLE","$table_name",1391],",",["T_WHITESPACE"," ",1391],["T_VARIABLE","$column_names",1391],")",";",["T_WHITESPACE","\n\n            ",1391],["T_COMMENT","\/\/ Handle NOT NULL constraints.\n",1393],["T_WHITESPACE","            ",1394],["T_FOREACH","foreach",1394],["T_WHITESPACE"," ",1394],"(",["T_VARIABLE","$schema",1394],"[",["T_VARIABLE","$table_name",1394],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1394],"]",["T_WHITESPACE"," ",1394],["T_AS","as",1394],["T_WHITESPACE"," ",1394],["T_VARIABLE","$column_name",1394],["T_WHITESPACE"," ",1394],["T_DOUBLE_ARROW","=>",1394],["T_WHITESPACE"," ",1394],["T_VARIABLE","$specifier",1394],")",["T_WHITESPACE"," ",1394],"{",["T_WHITESPACE","\n              ",1394],["T_VARIABLE","$not_null",1395],["T_WHITESPACE"," ",1395],"=",["T_WHITESPACE"," ",1395],"!",["T_EMPTY","empty",1395],"(",["T_VARIABLE","$specifier",1395],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1395],"]",")",";",["T_WHITESPACE","\n              ",1395],["T_VARIABLE","$original_not_null",1396],["T_WHITESPACE"," ",1396],"=",["T_WHITESPACE"," ",1396],"!",["T_EMPTY","empty",1396],"(",["T_VARIABLE","$original_schema",1396],"[",["T_VARIABLE","$table_name",1396],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1396],"]","[",["T_VARIABLE","$column_name",1396],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1396],"]",")",";",["T_WHITESPACE","\n              ",1396],["T_IF","if",1397],["T_WHITESPACE"," ",1397],"(",["T_VARIABLE","$not_null",1397],["T_WHITESPACE"," ",1397],["T_IS_NOT_IDENTICAL","!==",1397],["T_WHITESPACE"," ",1397],["T_VARIABLE","$original_not_null",1397],")",["T_WHITESPACE"," ",1397],"{",["T_WHITESPACE","\n                ",1397],["T_IF","if",1398],["T_WHITESPACE"," ",1398],"(",["T_VARIABLE","$not_null",1398],["T_WHITESPACE"," ",1398],["T_BOOLEAN_AND","&&",1398],["T_WHITESPACE"," ",1398],["T_VARIABLE","$this",1398],["T_OBJECT_OPERATOR","->",1398],["T_STRING","hasNullFieldPropertyData",1398],"(",["T_VARIABLE","$table_name",1398],",",["T_WHITESPACE"," ",1398],["T_VARIABLE","$column_name",1398],")",")",["T_WHITESPACE"," ",1398],"{",["T_WHITESPACE","\n                  ",1398],["T_THROW","throw",1399],["T_WHITESPACE"," ",1399],["T_NEW","new",1399],["T_WHITESPACE"," ",1399],["T_STRING","EntityStorageException",1399],"(","\"",["T_ENCAPSED_AND_WHITESPACE","The ",1399],["T_VARIABLE","$column_name",1399],["T_ENCAPSED_AND_WHITESPACE"," column cannot have NOT NULL constraints as it holds NULL values.",1399],"\"",")",";",["T_WHITESPACE","\n                ",1399],"}",["T_WHITESPACE","\n                ",1400],["T_VARIABLE","$column_schema",1401],["T_WHITESPACE"," ",1401],"=",["T_WHITESPACE"," ",1401],["T_VARIABLE","$original_schema",1401],"[",["T_VARIABLE","$table_name",1401],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1401],"]","[",["T_VARIABLE","$column_name",1401],"]",";",["T_WHITESPACE","\n                ",1401],["T_VARIABLE","$column_schema",1402],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1402],"]",["T_WHITESPACE"," ",1402],"=",["T_WHITESPACE"," ",1402],["T_VARIABLE","$not_null",1402],";",["T_WHITESPACE","\n                ",1402],["T_VARIABLE","$schema_handler",1403],["T_OBJECT_OPERATOR","->",1403],["T_STRING","changeField",1403],"(",["T_VARIABLE","$table_name",1403],",",["T_WHITESPACE"," ",1403],["T_VARIABLE","$field_name",1403],",",["T_WHITESPACE"," ",1403],["T_VARIABLE","$field_name",1403],",",["T_WHITESPACE"," ",1403],["T_VARIABLE","$column_schema",1403],")",";",["T_WHITESPACE","\n              ",1403],"}",["T_WHITESPACE","\n            ",1404],"}",["T_WHITESPACE","\n\n            ",1405],["T_COMMENT","\/\/ Drop original indexes and unique keys.\n",1407],["T_WHITESPACE","            ",1408],["T_IF","if",1408],["T_WHITESPACE"," ",1408],"(","!",["T_EMPTY","empty",1408],"(",["T_VARIABLE","$original_schema",1408],"[",["T_VARIABLE","$table_name",1408],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1408],"]",")",")",["T_WHITESPACE"," ",1408],"{",["T_WHITESPACE","\n              ",1408],["T_FOREACH","foreach",1409],["T_WHITESPACE"," ",1409],"(",["T_VARIABLE","$original_schema",1409],"[",["T_VARIABLE","$table_name",1409],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1409],"]",["T_WHITESPACE"," ",1409],["T_AS","as",1409],["T_WHITESPACE"," ",1409],["T_VARIABLE","$name",1409],["T_WHITESPACE"," ",1409],["T_DOUBLE_ARROW","=>",1409],["T_WHITESPACE"," ",1409],["T_VARIABLE","$specifier",1409],")",["T_WHITESPACE"," ",1409],"{",["T_WHITESPACE","\n                ",1409],["T_VARIABLE","$schema_handler",1410],["T_OBJECT_OPERATOR","->",1410],["T_STRING","dropIndex",1410],"(",["T_VARIABLE","$table_name",1410],",",["T_WHITESPACE"," ",1410],["T_VARIABLE","$name",1410],")",";",["T_WHITESPACE","\n              ",1410],"}",["T_WHITESPACE","\n            ",1411],"}",["T_WHITESPACE","\n            ",1412],["T_IF","if",1413],["T_WHITESPACE"," ",1413],"(","!",["T_EMPTY","empty",1413],"(",["T_VARIABLE","$original_schema",1413],"[",["T_VARIABLE","$table_name",1413],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1413],"]",")",")",["T_WHITESPACE"," ",1413],"{",["T_WHITESPACE","\n              ",1413],["T_FOREACH","foreach",1414],["T_WHITESPACE"," ",1414],"(",["T_VARIABLE","$original_schema",1414],"[",["T_VARIABLE","$table_name",1414],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1414],"]",["T_WHITESPACE"," ",1414],["T_AS","as",1414],["T_WHITESPACE"," ",1414],["T_VARIABLE","$name",1414],["T_WHITESPACE"," ",1414],["T_DOUBLE_ARROW","=>",1414],["T_WHITESPACE"," ",1414],["T_VARIABLE","$specifier",1414],")",["T_WHITESPACE"," ",1414],"{",["T_WHITESPACE","\n                ",1414],["T_VARIABLE","$schema_handler",1415],["T_OBJECT_OPERATOR","->",1415],["T_STRING","dropUniqueKey",1415],"(",["T_VARIABLE","$table_name",1415],",",["T_WHITESPACE"," ",1415],["T_VARIABLE","$name",1415],")",";",["T_WHITESPACE","\n              ",1415],"}",["T_WHITESPACE","\n            ",1416],"}",["T_WHITESPACE","\n            ",1417],["T_COMMENT","\/\/ Create new indexes and unique keys.\n",1418],["T_WHITESPACE","            ",1419],["T_IF","if",1419],["T_WHITESPACE"," ",1419],"(","!",["T_EMPTY","empty",1419],"(",["T_VARIABLE","$schema",1419],"[",["T_VARIABLE","$table_name",1419],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1419],"]",")",")",["T_WHITESPACE"," ",1419],"{",["T_WHITESPACE","\n              ",1419],["T_FOREACH","foreach",1420],["T_WHITESPACE"," ",1420],"(",["T_VARIABLE","$schema",1420],"[",["T_VARIABLE","$table_name",1420],"]","[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1420],"]",["T_WHITESPACE"," ",1420],["T_AS","as",1420],["T_WHITESPACE"," ",1420],["T_VARIABLE","$name",1420],["T_WHITESPACE"," ",1420],["T_DOUBLE_ARROW","=>",1420],["T_WHITESPACE"," ",1420],["T_VARIABLE","$specifier",1420],")",["T_WHITESPACE"," ",1420],"{",["T_WHITESPACE","\n                ",1420],["T_COMMENT","\/\/ Check if the index exists because it might already have been\n",1421],["T_WHITESPACE","                ",1422],["T_COMMENT","\/\/ created as part of the earlier entity type update event.\n",1422],["T_WHITESPACE","                ",1423],["T_VARIABLE","$this",1423],["T_OBJECT_OPERATOR","->",1423],["T_STRING","addIndex",1423],"(",["T_VARIABLE","$table_name",1423],",",["T_WHITESPACE"," ",1423],["T_VARIABLE","$name",1423],",",["T_WHITESPACE"," ",1423],["T_VARIABLE","$specifier",1423],",",["T_WHITESPACE"," ",1423],["T_VARIABLE","$schema",1423],"[",["T_VARIABLE","$table_name",1423],"]",")",";",["T_WHITESPACE","\n\n              ",1423],"}",["T_WHITESPACE","\n            ",1425],"}",["T_WHITESPACE","\n            ",1426],["T_IF","if",1427],["T_WHITESPACE"," ",1427],"(","!",["T_EMPTY","empty",1427],"(",["T_VARIABLE","$schema",1427],"[",["T_VARIABLE","$table_name",1427],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1427],"]",")",")",["T_WHITESPACE"," ",1427],"{",["T_WHITESPACE","\n              ",1427],["T_FOREACH","foreach",1428],["T_WHITESPACE"," ",1428],"(",["T_VARIABLE","$schema",1428],"[",["T_VARIABLE","$table_name",1428],"]","[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1428],"]",["T_WHITESPACE"," ",1428],["T_AS","as",1428],["T_WHITESPACE"," ",1428],["T_VARIABLE","$name",1428],["T_WHITESPACE"," ",1428],["T_DOUBLE_ARROW","=>",1428],["T_WHITESPACE"," ",1428],["T_VARIABLE","$specifier",1428],")",["T_WHITESPACE"," ",1428],"{",["T_WHITESPACE","\n                ",1428],["T_VARIABLE","$schema_handler",1429],["T_OBJECT_OPERATOR","->",1429],["T_STRING","addUniqueKey",1429],"(",["T_VARIABLE","$table_name",1429],",",["T_WHITESPACE"," ",1429],["T_VARIABLE","$name",1429],",",["T_WHITESPACE"," ",1429],["T_VARIABLE","$specifier",1429],")",";",["T_WHITESPACE","\n              ",1429],"}",["T_WHITESPACE","\n            ",1430],"}",["T_WHITESPACE","\n            ",1431],["T_COMMENT","\/\/ After deleting the field schema skip to the next table.\n",1432],["T_WHITESPACE","            ",1433],["T_BREAK","break",1433],";",["T_WHITESPACE","\n          ",1433],"}",["T_WHITESPACE","\n        ",1434],"}",["T_WHITESPACE","\n      ",1435],"}",["T_WHITESPACE","\n      ",1436],["T_VARIABLE","$this",1437],["T_OBJECT_OPERATOR","->",1437],["T_STRING","saveFieldSchemaData",1437],"(",["T_VARIABLE","$storage_definition",1437],",",["T_WHITESPACE"," ",1437],["T_VARIABLE","$schema",1437],")",";",["T_WHITESPACE","\n    ",1437],"}",["T_WHITESPACE","\n  ",1438],"}",["T_WHITESPACE","\n\n  ",1439],["T_DOC_COMMENT","\/**\n   * Creates the specified entity schema indexes and keys.\n   *\n   * @param array $entity_schema\n   *   The entity schema definition.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface|null $storage_definition\n   *   (optional) If a field storage definition is specified, only indexes and\n   *   keys involving its columns will be processed. Otherwise all defined\n   *   entity indexes and keys will be processed.\n   *\/",1441],["T_WHITESPACE","\n  ",1450],["T_PROTECTED","protected",1451],["T_WHITESPACE"," ",1451],["T_FUNCTION","function",1451],["T_WHITESPACE"," ",1451],["T_STRING","createEntitySchemaIndexes",1451],"(",["T_ARRAY","array",1451],["T_WHITESPACE"," ",1451],["T_VARIABLE","$entity_schema",1451],",",["T_WHITESPACE"," ",1451],["T_STRING","FieldStorageDefinitionInterface",1451],["T_WHITESPACE"," ",1451],["T_VARIABLE","$storage_definition",1451],["T_WHITESPACE"," ",1451],"=",["T_WHITESPACE"," ",1451],["T_STRING","NULL",1451],")",["T_WHITESPACE"," ",1451],"{",["T_WHITESPACE","\n    ",1451],["T_VARIABLE","$schema_handler",1452],["T_WHITESPACE"," ",1452],"=",["T_WHITESPACE"," ",1452],["T_VARIABLE","$this",1452],["T_OBJECT_OPERATOR","->",1452],["T_STRING","database",1452],["T_OBJECT_OPERATOR","->",1452],["T_STRING","schema",1452],"(",")",";",["T_WHITESPACE","\n\n    ",1452],["T_IF","if",1454],["T_WHITESPACE"," ",1454],"(",["T_VARIABLE","$storage_definition",1454],")",["T_WHITESPACE"," ",1454],"{",["T_WHITESPACE","\n      ",1454],["T_VARIABLE","$table_mapping",1455],["T_WHITESPACE"," ",1455],"=",["T_WHITESPACE"," ",1455],["T_VARIABLE","$this",1455],["T_OBJECT_OPERATOR","->",1455],["T_STRING","storage",1455],["T_OBJECT_OPERATOR","->",1455],["T_STRING","getTableMapping",1455],"(",")",";",["T_WHITESPACE","\n      ",1455],["T_VARIABLE","$column_names",1456],["T_WHITESPACE"," ",1456],"=",["T_WHITESPACE"," ",1456],["T_VARIABLE","$table_mapping",1456],["T_OBJECT_OPERATOR","->",1456],["T_STRING","getColumnNames",1456],"(",["T_VARIABLE","$storage_definition",1456],["T_OBJECT_OPERATOR","->",1456],["T_STRING","getName",1456],"(",")",")",";",["T_WHITESPACE","\n    ",1456],"}",["T_WHITESPACE","\n\n    ",1457],["T_VARIABLE","$index_keys",1459],["T_WHITESPACE"," ",1459],"=",["T_WHITESPACE"," ",1459],"[",["T_WHITESPACE","\n      ",1459],["T_CONSTANT_ENCAPSED_STRING","'indexes'",1460],["T_WHITESPACE"," ",1460],["T_DOUBLE_ARROW","=>",1460],["T_WHITESPACE"," ",1460],["T_CONSTANT_ENCAPSED_STRING","'addIndex'",1460],",",["T_WHITESPACE","\n      ",1460],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1461],["T_WHITESPACE"," ",1461],["T_DOUBLE_ARROW","=>",1461],["T_WHITESPACE"," ",1461],["T_CONSTANT_ENCAPSED_STRING","'addUniqueKey'",1461],",",["T_WHITESPACE","\n    ",1461],"]",";",["T_WHITESPACE","\n\n    ",1462],["T_FOREACH","foreach",1464],["T_WHITESPACE"," ",1464],"(",["T_VARIABLE","$this",1464],["T_OBJECT_OPERATOR","->",1464],["T_STRING","getEntitySchemaData",1464],"(",["T_VARIABLE","$this",1464],["T_OBJECT_OPERATOR","->",1464],["T_STRING","entityType",1464],",",["T_WHITESPACE"," ",1464],["T_VARIABLE","$entity_schema",1464],")",["T_WHITESPACE"," ",1464],["T_AS","as",1464],["T_WHITESPACE"," ",1464],["T_VARIABLE","$table_name",1464],["T_WHITESPACE"," ",1464],["T_DOUBLE_ARROW","=>",1464],["T_WHITESPACE"," ",1464],["T_VARIABLE","$schema",1464],")",["T_WHITESPACE"," ",1464],"{",["T_WHITESPACE","\n      ",1464],["T_COMMENT","\/\/ Add fields schema because database driver may depend on this data to\n",1465],["T_WHITESPACE","      ",1466],["T_COMMENT","\/\/ perform index normalization.\n",1466],["T_WHITESPACE","      ",1467],["T_VARIABLE","$schema",1467],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1467],"]",["T_WHITESPACE"," ",1467],"=",["T_WHITESPACE"," ",1467],["T_VARIABLE","$entity_schema",1467],"[",["T_VARIABLE","$table_name",1467],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1467],"]",";",["T_WHITESPACE","\n\n      ",1467],["T_FOREACH","foreach",1469],["T_WHITESPACE"," ",1469],"(",["T_VARIABLE","$index_keys",1469],["T_WHITESPACE"," ",1469],["T_AS","as",1469],["T_WHITESPACE"," ",1469],["T_VARIABLE","$key",1469],["T_WHITESPACE"," ",1469],["T_DOUBLE_ARROW","=>",1469],["T_WHITESPACE"," ",1469],["T_VARIABLE","$add_method",1469],")",["T_WHITESPACE"," ",1469],"{",["T_WHITESPACE","\n        ",1469],["T_IF","if",1470],["T_WHITESPACE"," ",1470],"(","!",["T_EMPTY","empty",1470],"(",["T_VARIABLE","$schema",1470],"[",["T_VARIABLE","$key",1470],"]",")",")",["T_WHITESPACE"," ",1470],"{",["T_WHITESPACE","\n          ",1470],["T_FOREACH","foreach",1471],["T_WHITESPACE"," ",1471],"(",["T_VARIABLE","$schema",1471],"[",["T_VARIABLE","$key",1471],"]",["T_WHITESPACE"," ",1471],["T_AS","as",1471],["T_WHITESPACE"," ",1471],["T_VARIABLE","$name",1471],["T_WHITESPACE"," ",1471],["T_DOUBLE_ARROW","=>",1471],["T_WHITESPACE"," ",1471],["T_VARIABLE","$specifier",1471],")",["T_WHITESPACE"," ",1471],"{",["T_WHITESPACE","\n            ",1471],["T_COMMENT","\/\/ If a set of field columns were specified we process only indexes\n",1472],["T_WHITESPACE","            ",1473],["T_COMMENT","\/\/ involving them. Only indexes for which all columns exist are\n",1473],["T_WHITESPACE","            ",1474],["T_COMMENT","\/\/ actually created.\n",1474],["T_WHITESPACE","            ",1475],["T_VARIABLE","$create",1475],["T_WHITESPACE"," ",1475],"=",["T_WHITESPACE"," ",1475],["T_STRING","FALSE",1475],";",["T_WHITESPACE","\n            ",1475],["T_VARIABLE","$specifier_columns",1476],["T_WHITESPACE"," ",1476],"=",["T_WHITESPACE"," ",1476],["T_STRING","array_map",1476],"(",["T_FUNCTION","function",1476],"(",["T_VARIABLE","$item",1476],")",["T_WHITESPACE"," ",1476],"{",["T_WHITESPACE"," ",1476],["T_RETURN","return",1476],["T_WHITESPACE"," ",1476],["T_STRING","is_string",1476],"(",["T_VARIABLE","$item",1476],")",["T_WHITESPACE"," ",1476],"?",["T_WHITESPACE"," ",1476],["T_VARIABLE","$item",1476],["T_WHITESPACE"," ",1476],":",["T_WHITESPACE"," ",1476],["T_STRING","reset",1476],"(",["T_VARIABLE","$item",1476],")",";",["T_WHITESPACE"," ",1476],"}",",",["T_WHITESPACE"," ",1476],["T_VARIABLE","$specifier",1476],")",";",["T_WHITESPACE","\n            ",1476],["T_IF","if",1477],["T_WHITESPACE"," ",1477],"(","!",["T_ISSET","isset",1477],"(",["T_VARIABLE","$column_names",1477],")",["T_WHITESPACE"," ",1477],["T_BOOLEAN_OR","||",1477],["T_WHITESPACE"," ",1477],["T_STRING","array_intersect",1477],"(",["T_VARIABLE","$specifier_columns",1477],",",["T_WHITESPACE"," ",1477],["T_VARIABLE","$column_names",1477],")",")",["T_WHITESPACE"," ",1477],"{",["T_WHITESPACE","\n              ",1477],["T_VARIABLE","$create",1478],["T_WHITESPACE"," ",1478],"=",["T_WHITESPACE"," ",1478],["T_STRING","TRUE",1478],";",["T_WHITESPACE","\n              ",1478],["T_FOREACH","foreach",1479],["T_WHITESPACE"," ",1479],"(",["T_VARIABLE","$specifier_columns",1479],["T_WHITESPACE"," ",1479],["T_AS","as",1479],["T_WHITESPACE"," ",1479],["T_VARIABLE","$specifier_column_name",1479],")",["T_WHITESPACE"," ",1479],"{",["T_WHITESPACE","\n                ",1479],["T_COMMENT","\/\/ This may happen when adding more than one field in the same\n",1480],["T_WHITESPACE","                ",1481],["T_COMMENT","\/\/ update run. Eventually when all field columns have been\n",1481],["T_WHITESPACE","                ",1482],["T_COMMENT","\/\/ created the index will be created too.\n",1482],["T_WHITESPACE","                ",1483],["T_IF","if",1483],["T_WHITESPACE"," ",1483],"(","!",["T_VARIABLE","$schema_handler",1483],["T_OBJECT_OPERATOR","->",1483],["T_STRING","fieldExists",1483],"(",["T_VARIABLE","$table_name",1483],",",["T_WHITESPACE"," ",1483],["T_VARIABLE","$specifier_column_name",1483],")",")",["T_WHITESPACE"," ",1483],"{",["T_WHITESPACE","\n                  ",1483],["T_VARIABLE","$create",1484],["T_WHITESPACE"," ",1484],"=",["T_WHITESPACE"," ",1484],["T_STRING","FALSE",1484],";",["T_WHITESPACE","\n                  ",1484],["T_BREAK","break",1485],";",["T_WHITESPACE","\n                ",1485],"}",["T_WHITESPACE","\n              ",1486],"}",["T_WHITESPACE","\n            ",1487],"}",["T_WHITESPACE","\n            ",1488],["T_IF","if",1489],["T_WHITESPACE"," ",1489],"(",["T_VARIABLE","$create",1489],")",["T_WHITESPACE"," ",1489],"{",["T_WHITESPACE","\n              ",1489],["T_VARIABLE","$this",1490],["T_OBJECT_OPERATOR","->",1490],"{",["T_VARIABLE","$add_method",1490],"}","(",["T_VARIABLE","$table_name",1490],",",["T_WHITESPACE"," ",1490],["T_VARIABLE","$name",1490],",",["T_WHITESPACE"," ",1490],["T_VARIABLE","$specifier",1490],",",["T_WHITESPACE"," ",1490],["T_VARIABLE","$schema",1490],")",";",["T_WHITESPACE","\n            ",1490],"}",["T_WHITESPACE","\n          ",1491],"}",["T_WHITESPACE","\n        ",1492],"}",["T_WHITESPACE","\n      ",1493],"}",["T_WHITESPACE","\n    ",1494],"}",["T_WHITESPACE","\n  ",1495],"}",["T_WHITESPACE","\n\n  ",1496],["T_DOC_COMMENT","\/**\n   * Deletes the specified entity schema indexes and keys.\n   *\n   * @param array $entity_schema_data\n   *   The entity schema data definition.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface|null $storage_definition\n   *   (optional) If a field storage definition is specified, only indexes and\n   *   keys involving its columns will be processed. Otherwise all defined\n   *   entity indexes and keys will be processed.\n   *\/",1498],["T_WHITESPACE","\n  ",1507],["T_PROTECTED","protected",1508],["T_WHITESPACE"," ",1508],["T_FUNCTION","function",1508],["T_WHITESPACE"," ",1508],["T_STRING","deleteEntitySchemaIndexes",1508],"(",["T_ARRAY","array",1508],["T_WHITESPACE"," ",1508],["T_VARIABLE","$entity_schema_data",1508],",",["T_WHITESPACE"," ",1508],["T_STRING","FieldStorageDefinitionInterface",1508],["T_WHITESPACE"," ",1508],["T_VARIABLE","$storage_definition",1508],["T_WHITESPACE"," ",1508],"=",["T_WHITESPACE"," ",1508],["T_STRING","NULL",1508],")",["T_WHITESPACE"," ",1508],"{",["T_WHITESPACE","\n    ",1508],["T_VARIABLE","$schema_handler",1509],["T_WHITESPACE"," ",1509],"=",["T_WHITESPACE"," ",1509],["T_VARIABLE","$this",1509],["T_OBJECT_OPERATOR","->",1509],["T_STRING","database",1509],["T_OBJECT_OPERATOR","->",1509],["T_STRING","schema",1509],"(",")",";",["T_WHITESPACE","\n\n    ",1509],["T_IF","if",1511],["T_WHITESPACE"," ",1511],"(",["T_VARIABLE","$storage_definition",1511],")",["T_WHITESPACE"," ",1511],"{",["T_WHITESPACE","\n      ",1511],["T_VARIABLE","$table_mapping",1512],["T_WHITESPACE"," ",1512],"=",["T_WHITESPACE"," ",1512],["T_VARIABLE","$this",1512],["T_OBJECT_OPERATOR","->",1512],["T_STRING","storage",1512],["T_OBJECT_OPERATOR","->",1512],["T_STRING","getTableMapping",1512],"(",")",";",["T_WHITESPACE","\n      ",1512],["T_VARIABLE","$column_names",1513],["T_WHITESPACE"," ",1513],"=",["T_WHITESPACE"," ",1513],["T_VARIABLE","$table_mapping",1513],["T_OBJECT_OPERATOR","->",1513],["T_STRING","getColumnNames",1513],"(",["T_VARIABLE","$storage_definition",1513],["T_OBJECT_OPERATOR","->",1513],["T_STRING","getName",1513],"(",")",")",";",["T_WHITESPACE","\n    ",1513],"}",["T_WHITESPACE","\n\n    ",1514],["T_VARIABLE","$index_keys",1516],["T_WHITESPACE"," ",1516],"=",["T_WHITESPACE"," ",1516],"[",["T_WHITESPACE","\n      ",1516],["T_CONSTANT_ENCAPSED_STRING","'indexes'",1517],["T_WHITESPACE"," ",1517],["T_DOUBLE_ARROW","=>",1517],["T_WHITESPACE"," ",1517],["T_CONSTANT_ENCAPSED_STRING","'dropIndex'",1517],",",["T_WHITESPACE","\n      ",1517],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1518],["T_WHITESPACE"," ",1518],["T_DOUBLE_ARROW","=>",1518],["T_WHITESPACE"," ",1518],["T_CONSTANT_ENCAPSED_STRING","'dropUniqueKey'",1518],",",["T_WHITESPACE","\n    ",1518],"]",";",["T_WHITESPACE","\n\n    ",1519],["T_FOREACH","foreach",1521],["T_WHITESPACE"," ",1521],"(",["T_VARIABLE","$entity_schema_data",1521],["T_WHITESPACE"," ",1521],["T_AS","as",1521],["T_WHITESPACE"," ",1521],["T_VARIABLE","$table_name",1521],["T_WHITESPACE"," ",1521],["T_DOUBLE_ARROW","=>",1521],["T_WHITESPACE"," ",1521],["T_VARIABLE","$schema",1521],")",["T_WHITESPACE"," ",1521],"{",["T_WHITESPACE","\n      ",1521],["T_FOREACH","foreach",1522],["T_WHITESPACE"," ",1522],"(",["T_VARIABLE","$index_keys",1522],["T_WHITESPACE"," ",1522],["T_AS","as",1522],["T_WHITESPACE"," ",1522],["T_VARIABLE","$key",1522],["T_WHITESPACE"," ",1522],["T_DOUBLE_ARROW","=>",1522],["T_WHITESPACE"," ",1522],["T_VARIABLE","$drop_method",1522],")",["T_WHITESPACE"," ",1522],"{",["T_WHITESPACE","\n        ",1522],["T_IF","if",1523],["T_WHITESPACE"," ",1523],"(","!",["T_EMPTY","empty",1523],"(",["T_VARIABLE","$schema",1523],"[",["T_VARIABLE","$key",1523],"]",")",")",["T_WHITESPACE"," ",1523],"{",["T_WHITESPACE","\n          ",1523],["T_FOREACH","foreach",1524],["T_WHITESPACE"," ",1524],"(",["T_VARIABLE","$schema",1524],"[",["T_VARIABLE","$key",1524],"]",["T_WHITESPACE"," ",1524],["T_AS","as",1524],["T_WHITESPACE"," ",1524],["T_VARIABLE","$name",1524],["T_WHITESPACE"," ",1524],["T_DOUBLE_ARROW","=>",1524],["T_WHITESPACE"," ",1524],["T_VARIABLE","$specifier",1524],")",["T_WHITESPACE"," ",1524],"{",["T_WHITESPACE","\n            ",1524],["T_VARIABLE","$specifier_columns",1525],["T_WHITESPACE"," ",1525],"=",["T_WHITESPACE"," ",1525],["T_STRING","array_map",1525],"(",["T_FUNCTION","function",1525],"(",["T_VARIABLE","$item",1525],")",["T_WHITESPACE"," ",1525],"{",["T_WHITESPACE"," ",1525],["T_RETURN","return",1525],["T_WHITESPACE"," ",1525],["T_STRING","is_string",1525],"(",["T_VARIABLE","$item",1525],")",["T_WHITESPACE"," ",1525],"?",["T_WHITESPACE"," ",1525],["T_VARIABLE","$item",1525],["T_WHITESPACE"," ",1525],":",["T_WHITESPACE"," ",1525],["T_STRING","reset",1525],"(",["T_VARIABLE","$item",1525],")",";",["T_WHITESPACE"," ",1525],"}",",",["T_WHITESPACE"," ",1525],["T_VARIABLE","$specifier",1525],")",";",["T_WHITESPACE","\n            ",1525],["T_IF","if",1526],["T_WHITESPACE"," ",1526],"(","!",["T_ISSET","isset",1526],"(",["T_VARIABLE","$column_names",1526],")",["T_WHITESPACE"," ",1526],["T_BOOLEAN_OR","||",1526],["T_WHITESPACE"," ",1526],["T_STRING","array_intersect",1526],"(",["T_VARIABLE","$specifier_columns",1526],",",["T_WHITESPACE"," ",1526],["T_VARIABLE","$column_names",1526],")",")",["T_WHITESPACE"," ",1526],"{",["T_WHITESPACE","\n              ",1526],["T_VARIABLE","$schema_handler",1527],["T_OBJECT_OPERATOR","->",1527],"{",["T_VARIABLE","$drop_method",1527],"}","(",["T_VARIABLE","$table_name",1527],",",["T_WHITESPACE"," ",1527],["T_VARIABLE","$name",1527],")",";",["T_WHITESPACE","\n            ",1527],"}",["T_WHITESPACE","\n          ",1528],"}",["T_WHITESPACE","\n        ",1529],"}",["T_WHITESPACE","\n      ",1530],"}",["T_WHITESPACE","\n    ",1531],"}",["T_WHITESPACE","\n  ",1532],"}",["T_WHITESPACE","\n\n  ",1533],["T_DOC_COMMENT","\/**\n   * Checks whether a field property has NULL values.\n   *\n   * @param string $table_name\n   *   The name of the table to inspect.\n   * @param string $column_name\n   *   The name of the column holding the field property data.\n   *\n   * @return bool\n   *   TRUE if NULL data is found, FALSE otherwise.\n   *\/",1535],["T_WHITESPACE","\n  ",1545],["T_PROTECTED","protected",1546],["T_WHITESPACE"," ",1546],["T_FUNCTION","function",1546],["T_WHITESPACE"," ",1546],["T_STRING","hasNullFieldPropertyData",1546],"(",["T_VARIABLE","$table_name",1546],",",["T_WHITESPACE"," ",1546],["T_VARIABLE","$column_name",1546],")",["T_WHITESPACE"," ",1546],"{",["T_WHITESPACE","\n    ",1546],["T_VARIABLE","$query",1547],["T_WHITESPACE"," ",1547],"=",["T_WHITESPACE"," ",1547],["T_VARIABLE","$this",1547],["T_OBJECT_OPERATOR","->",1547],["T_STRING","database",1547],["T_OBJECT_OPERATOR","->",1547],["T_STRING","select",1547],"(",["T_VARIABLE","$table_name",1547],",",["T_WHITESPACE"," ",1547],["T_CONSTANT_ENCAPSED_STRING","'t'",1547],")",["T_WHITESPACE","\n      ",1547],["T_OBJECT_OPERATOR","->",1548],["T_STRING","fields",1548],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1548],",",["T_WHITESPACE"," ",1548],"[",["T_VARIABLE","$column_name",1548],"]",")",["T_WHITESPACE","\n      ",1548],["T_OBJECT_OPERATOR","->",1549],["T_STRING","range",1549],"(",["T_LNUMBER","0",1549],",",["T_WHITESPACE"," ",1549],["T_LNUMBER","1",1549],")",";",["T_WHITESPACE","\n    ",1549],["T_VARIABLE","$query",1550],["T_OBJECT_OPERATOR","->",1550],["T_STRING","isNull",1550],"(",["T_CONSTANT_ENCAPSED_STRING","'t.'",1550],["T_WHITESPACE"," ",1550],".",["T_WHITESPACE"," ",1550],["T_VARIABLE","$column_name",1550],")",";",["T_WHITESPACE","\n    ",1550],["T_VARIABLE","$result",1551],["T_WHITESPACE"," ",1551],"=",["T_WHITESPACE"," ",1551],["T_VARIABLE","$query",1551],["T_OBJECT_OPERATOR","->",1551],["T_STRING","execute",1551],"(",")",["T_OBJECT_OPERATOR","->",1551],["T_STRING","fetchAssoc",1551],"(",")",";",["T_WHITESPACE","\n    ",1551],["T_RETURN","return",1552],["T_WHITESPACE"," ",1552],["T_BOOL_CAST","(bool)",1552],["T_WHITESPACE"," ",1552],["T_VARIABLE","$result",1552],";",["T_WHITESPACE","\n  ",1552],"}",["T_WHITESPACE","\n\n  ",1553],["T_DOC_COMMENT","\/**\n   * Gets the schema for a single field definition.\n   *\n   * Entity types may override this method in order to optimize the generated\n   * schema for given field. While all optimizations that apply to a single\n   * field have to be added here, all cross-field optimizations should be via\n   * SqlContentEntityStorageSchema::getEntitySchema() instead; e.g.,\n   * an index spanning multiple fields.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field whose schema has to be returned.\n   * @param string $table_name\n   *   The name of the table columns will be added to.\n   * @param string[] $column_mapping\n   *   A mapping of field column names to database column names.\n   *\n   * @return array\n   *   The schema definition for the table with the following keys:\n   *   - fields: The schema definition for the each field columns.\n   *   - indexes: The schema definition for the indexes.\n   *   - unique keys: The schema definition for the unique keys.\n   *   - foreign keys: The schema definition for the foreign keys.\n   *\n   * @throws \\Drupal\\Core\\Field\\FieldException\n   *   Exception thrown if the schema contains reserved column names.\n   *\/",1555],["T_WHITESPACE","\n  ",1580],["T_PROTECTED","protected",1581],["T_WHITESPACE"," ",1581],["T_FUNCTION","function",1581],["T_WHITESPACE"," ",1581],["T_STRING","getSharedTableFieldSchema",1581],"(",["T_STRING","FieldStorageDefinitionInterface",1581],["T_WHITESPACE"," ",1581],["T_VARIABLE","$storage_definition",1581],",",["T_WHITESPACE"," ",1581],["T_VARIABLE","$table_name",1581],",",["T_WHITESPACE"," ",1581],["T_ARRAY","array",1581],["T_WHITESPACE"," ",1581],["T_VARIABLE","$column_mapping",1581],")",["T_WHITESPACE"," ",1581],"{",["T_WHITESPACE","\n    ",1581],["T_VARIABLE","$schema",1582],["T_WHITESPACE"," ",1582],"=",["T_WHITESPACE"," ",1582],["T_ARRAY","array",1582],"(",")",";",["T_WHITESPACE","\n    ",1582],["T_VARIABLE","$field_schema",1583],["T_WHITESPACE"," ",1583],"=",["T_WHITESPACE"," ",1583],["T_VARIABLE","$storage_definition",1583],["T_OBJECT_OPERATOR","->",1583],["T_STRING","getSchema",1583],"(",")",";",["T_WHITESPACE","\n\n    ",1583],["T_COMMENT","\/\/ Check that the schema does not include forbidden column names.\n",1585],["T_WHITESPACE","    ",1586],["T_IF","if",1586],["T_WHITESPACE"," ",1586],"(",["T_STRING","array_intersect",1586],"(",["T_STRING","array_keys",1586],"(",["T_VARIABLE","$field_schema",1586],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1586],"]",")",",",["T_WHITESPACE"," ",1586],["T_VARIABLE","$this",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","storage",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","getTableMapping",1586],"(",")",["T_OBJECT_OPERATOR","->",1586],["T_STRING","getReservedColumns",1586],"(",")",")",")",["T_WHITESPACE"," ",1586],"{",["T_WHITESPACE","\n      ",1586],["T_THROW","throw",1587],["T_WHITESPACE"," ",1587],["T_NEW","new",1587],["T_WHITESPACE"," ",1587],["T_STRING","FieldException",1587],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Illegal field column names on ",1587],["T_CURLY_OPEN","{",1587],["T_VARIABLE","$storage_definition",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","getName",1587],"(",")","}","\"",")",";",["T_WHITESPACE","\n    ",1587],"}",["T_WHITESPACE","\n\n    ",1588],["T_VARIABLE","$field_name",1590],["T_WHITESPACE"," ",1590],"=",["T_WHITESPACE"," ",1590],["T_VARIABLE","$storage_definition",1590],["T_OBJECT_OPERATOR","->",1590],["T_STRING","getName",1590],"(",")",";",["T_WHITESPACE","\n    ",1590],["T_VARIABLE","$base_table",1591],["T_WHITESPACE"," ",1591],"=",["T_WHITESPACE"," ",1591],["T_VARIABLE","$this",1591],["T_OBJECT_OPERATOR","->",1591],["T_STRING","storage",1591],["T_OBJECT_OPERATOR","->",1591],["T_STRING","getBaseTable",1591],"(",")",";",["T_WHITESPACE","\n\n    ",1591],["T_COMMENT","\/\/ A shared table contains rows for entities where the field is empty\n",1593],["T_WHITESPACE","    ",1594],["T_COMMENT","\/\/ (since other fields stored in the same table might not be empty), thus\n",1594],["T_WHITESPACE","    ",1595],["T_COMMENT","\/\/ the only columns that can be 'not null' are those for required\n",1595],["T_WHITESPACE","    ",1596],["T_COMMENT","\/\/ properties of required fields. However, even those would break in the\n",1596],["T_WHITESPACE","    ",1597],["T_COMMENT","\/\/ case where a new field is added to a table that contains existing rows.\n",1597],["T_WHITESPACE","    ",1598],["T_COMMENT","\/\/ For now, we only hardcode 'not null' to a couple \"entity keys\", in order\n",1598],["T_WHITESPACE","    ",1599],["T_COMMENT","\/\/ to keep their indexes optimized.\n",1599],["T_WHITESPACE","    ",1600],["T_COMMENT","\/\/ @todo Revisit once we have support for 'initial' in\n",1600],["T_WHITESPACE","    ",1601],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2346019.\n",1601],["T_WHITESPACE","    ",1602],["T_VARIABLE","$not_null_keys",1602],["T_WHITESPACE"," ",1602],"=",["T_WHITESPACE"," ",1602],["T_VARIABLE","$this",1602],["T_OBJECT_OPERATOR","->",1602],["T_STRING","entityType",1602],["T_OBJECT_OPERATOR","->",1602],["T_STRING","getKeys",1602],"(",")",";",["T_WHITESPACE","\n    ",1602],["T_COMMENT","\/\/ Label fields are not necessarily required.\n",1603],["T_WHITESPACE","    ",1604],["T_UNSET","unset",1604],"(",["T_VARIABLE","$not_null_keys",1604],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",1604],"]",")",";",["T_WHITESPACE","\n    ",1604],["T_COMMENT","\/\/ Because entity ID and revision ID are both serial fields in the base and\n",1605],["T_WHITESPACE","    ",1606],["T_COMMENT","\/\/ revision table respectively, the revision ID is not known yet, when\n",1606],["T_WHITESPACE","    ",1607],["T_COMMENT","\/\/ inserting data into the base table. Instead the revision ID in the base\n",1607],["T_WHITESPACE","    ",1608],["T_COMMENT","\/\/ table is updated after the data has been inserted into the revision\n",1608],["T_WHITESPACE","    ",1609],["T_COMMENT","\/\/ table. For this reason the revision ID field cannot be marked as NOT\n",1609],["T_WHITESPACE","    ",1610],["T_COMMENT","\/\/ NULL.\n",1610],["T_WHITESPACE","    ",1611],["T_IF","if",1611],["T_WHITESPACE"," ",1611],"(",["T_VARIABLE","$table_name",1611],["T_WHITESPACE"," ",1611],["T_IS_EQUAL","==",1611],["T_WHITESPACE"," ",1611],["T_VARIABLE","$base_table",1611],")",["T_WHITESPACE"," ",1611],"{",["T_WHITESPACE","\n      ",1611],["T_UNSET","unset",1612],"(",["T_VARIABLE","$not_null_keys",1612],"[",["T_CONSTANT_ENCAPSED_STRING","'revision'",1612],"]",")",";",["T_WHITESPACE","\n    ",1612],"}",["T_WHITESPACE","\n\n    ",1613],["T_FOREACH","foreach",1615],["T_WHITESPACE"," ",1615],"(",["T_VARIABLE","$column_mapping",1615],["T_WHITESPACE"," ",1615],["T_AS","as",1615],["T_WHITESPACE"," ",1615],["T_VARIABLE","$field_column_name",1615],["T_WHITESPACE"," ",1615],["T_DOUBLE_ARROW","=>",1615],["T_WHITESPACE"," ",1615],["T_VARIABLE","$schema_field_name",1615],")",["T_WHITESPACE"," ",1615],"{",["T_WHITESPACE","\n      ",1615],["T_VARIABLE","$column_schema",1616],["T_WHITESPACE"," ",1616],"=",["T_WHITESPACE"," ",1616],["T_VARIABLE","$field_schema",1616],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1616],"]","[",["T_VARIABLE","$field_column_name",1616],"]",";",["T_WHITESPACE","\n\n      ",1616],["T_VARIABLE","$schema",1618],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1618],"]","[",["T_VARIABLE","$schema_field_name",1618],"]",["T_WHITESPACE"," ",1618],"=",["T_WHITESPACE"," ",1618],["T_VARIABLE","$column_schema",1618],";",["T_WHITESPACE","\n      ",1618],["T_VARIABLE","$schema",1619],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1619],"]","[",["T_VARIABLE","$schema_field_name",1619],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1619],"]",["T_WHITESPACE"," ",1619],"=",["T_WHITESPACE"," ",1619],["T_STRING","in_array",1619],"(",["T_VARIABLE","$field_name",1619],",",["T_WHITESPACE"," ",1619],["T_VARIABLE","$not_null_keys",1619],")",";",["T_WHITESPACE","\n    ",1619],"}",["T_WHITESPACE","\n\n    ",1620],["T_IF","if",1622],["T_WHITESPACE"," ",1622],"(","!",["T_EMPTY","empty",1622],"(",["T_VARIABLE","$field_schema",1622],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1622],"]",")",")",["T_WHITESPACE"," ",1622],"{",["T_WHITESPACE","\n      ",1622],["T_VARIABLE","$schema",1623],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1623],"]",["T_WHITESPACE"," ",1623],"=",["T_WHITESPACE"," ",1623],["T_VARIABLE","$this",1623],["T_OBJECT_OPERATOR","->",1623],["T_STRING","getFieldIndexes",1623],"(",["T_VARIABLE","$field_name",1623],",",["T_WHITESPACE"," ",1623],["T_VARIABLE","$field_schema",1623],",",["T_WHITESPACE"," ",1623],["T_VARIABLE","$column_mapping",1623],")",";",["T_WHITESPACE","\n    ",1623],"}",["T_WHITESPACE","\n\n    ",1624],["T_IF","if",1626],["T_WHITESPACE"," ",1626],"(","!",["T_EMPTY","empty",1626],"(",["T_VARIABLE","$field_schema",1626],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1626],"]",")",")",["T_WHITESPACE"," ",1626],"{",["T_WHITESPACE","\n      ",1626],["T_VARIABLE","$schema",1627],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1627],"]",["T_WHITESPACE"," ",1627],"=",["T_WHITESPACE"," ",1627],["T_VARIABLE","$this",1627],["T_OBJECT_OPERATOR","->",1627],["T_STRING","getFieldUniqueKeys",1627],"(",["T_VARIABLE","$field_name",1627],",",["T_WHITESPACE"," ",1627],["T_VARIABLE","$field_schema",1627],",",["T_WHITESPACE"," ",1627],["T_VARIABLE","$column_mapping",1627],")",";",["T_WHITESPACE","\n    ",1627],"}",["T_WHITESPACE","\n\n    ",1628],["T_IF","if",1630],["T_WHITESPACE"," ",1630],"(","!",["T_EMPTY","empty",1630],"(",["T_VARIABLE","$field_schema",1630],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1630],"]",")",")",["T_WHITESPACE"," ",1630],"{",["T_WHITESPACE","\n      ",1630],["T_VARIABLE","$schema",1631],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1631],"]",["T_WHITESPACE"," ",1631],"=",["T_WHITESPACE"," ",1631],["T_VARIABLE","$this",1631],["T_OBJECT_OPERATOR","->",1631],["T_STRING","getFieldForeignKeys",1631],"(",["T_VARIABLE","$field_name",1631],",",["T_WHITESPACE"," ",1631],["T_VARIABLE","$field_schema",1631],",",["T_WHITESPACE"," ",1631],["T_VARIABLE","$column_mapping",1631],")",";",["T_WHITESPACE","\n    ",1631],"}",["T_WHITESPACE","\n\n    ",1632],["T_RETURN","return",1634],["T_WHITESPACE"," ",1634],["T_VARIABLE","$schema",1634],";",["T_WHITESPACE","\n  ",1634],"}",["T_WHITESPACE","\n\n  ",1635],["T_DOC_COMMENT","\/**\n   * Adds an index for the specified field to the given schema definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field for which an index should be added.\n   * @param array $schema\n   *   A reference to the schema array to be updated.\n   * @param bool $not_null\n   *   (optional) Whether to also add a 'not null' constraint to the column\n   *   being indexed. Doing so improves index performance. Defaults to FALSE,\n   *   in case the field needs to support NULL values.\n   * @param int $size\n   *   (optional) The index size. Defaults to no limit.\n   *\/",1637],["T_WHITESPACE","\n  ",1650],["T_PROTECTED","protected",1651],["T_WHITESPACE"," ",1651],["T_FUNCTION","function",1651],["T_WHITESPACE"," ",1651],["T_STRING","addSharedTableFieldIndex",1651],"(",["T_STRING","FieldStorageDefinitionInterface",1651],["T_WHITESPACE"," ",1651],["T_VARIABLE","$storage_definition",1651],",",["T_WHITESPACE"," ",1651],"&",["T_VARIABLE","$schema",1651],",",["T_WHITESPACE"," ",1651],["T_VARIABLE","$not_null",1651],["T_WHITESPACE"," ",1651],"=",["T_WHITESPACE"," ",1651],["T_STRING","FALSE",1651],",",["T_WHITESPACE"," ",1651],["T_VARIABLE","$size",1651],["T_WHITESPACE"," ",1651],"=",["T_WHITESPACE"," ",1651],["T_STRING","NULL",1651],")",["T_WHITESPACE"," ",1651],"{",["T_WHITESPACE","\n    ",1651],["T_VARIABLE","$name",1652],["T_WHITESPACE"," ",1652],"=",["T_WHITESPACE"," ",1652],["T_VARIABLE","$storage_definition",1652],["T_OBJECT_OPERATOR","->",1652],["T_STRING","getName",1652],"(",")",";",["T_WHITESPACE","\n    ",1652],["T_VARIABLE","$real_key",1653],["T_WHITESPACE"," ",1653],"=",["T_WHITESPACE"," ",1653],["T_VARIABLE","$this",1653],["T_OBJECT_OPERATOR","->",1653],["T_STRING","getFieldSchemaIdentifierName",1653],"(",["T_VARIABLE","$storage_definition",1653],["T_OBJECT_OPERATOR","->",1653],["T_STRING","getTargetEntityTypeId",1653],"(",")",",",["T_WHITESPACE"," ",1653],["T_VARIABLE","$name",1653],")",";",["T_WHITESPACE","\n    ",1653],["T_VARIABLE","$schema",1654],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1654],"]","[",["T_VARIABLE","$real_key",1654],"]",["T_WHITESPACE"," ",1654],"=",["T_WHITESPACE"," ",1654],["T_ARRAY","array",1654],"(",["T_VARIABLE","$size",1654],["T_WHITESPACE"," ",1654],"?",["T_WHITESPACE"," ",1654],["T_ARRAY","array",1654],"(",["T_VARIABLE","$name",1654],",",["T_WHITESPACE"," ",1654],["T_VARIABLE","$size",1654],")",["T_WHITESPACE"," ",1654],":",["T_WHITESPACE"," ",1654],["T_VARIABLE","$name",1654],")",";",["T_WHITESPACE","\n    ",1654],["T_IF","if",1655],["T_WHITESPACE"," ",1655],"(",["T_VARIABLE","$not_null",1655],")",["T_WHITESPACE"," ",1655],"{",["T_WHITESPACE","\n      ",1655],["T_VARIABLE","$schema",1656],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1656],"]","[",["T_VARIABLE","$name",1656],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1656],"]",["T_WHITESPACE"," ",1656],"=",["T_WHITESPACE"," ",1656],["T_STRING","TRUE",1656],";",["T_WHITESPACE","\n    ",1656],"}",["T_WHITESPACE","\n  ",1657],"}",["T_WHITESPACE","\n\n  ",1658],["T_DOC_COMMENT","\/**\n   * Adds a unique key for the specified field to the given schema definition.\n   *\n   * Also adds a 'not null' constraint, because many databases do not reliably\n   * support unique keys on null columns.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field to which to add a unique key.\n   * @param array $schema\n   *   A reference to the schema array to be updated.\n   *\/",1660],["T_WHITESPACE","\n  ",1670],["T_PROTECTED","protected",1671],["T_WHITESPACE"," ",1671],["T_FUNCTION","function",1671],["T_WHITESPACE"," ",1671],["T_STRING","addSharedTableFieldUniqueKey",1671],"(",["T_STRING","FieldStorageDefinitionInterface",1671],["T_WHITESPACE"," ",1671],["T_VARIABLE","$storage_definition",1671],",",["T_WHITESPACE"," ",1671],"&",["T_VARIABLE","$schema",1671],")",["T_WHITESPACE"," ",1671],"{",["T_WHITESPACE","\n    ",1671],["T_VARIABLE","$name",1672],["T_WHITESPACE"," ",1672],"=",["T_WHITESPACE"," ",1672],["T_VARIABLE","$storage_definition",1672],["T_OBJECT_OPERATOR","->",1672],["T_STRING","getName",1672],"(",")",";",["T_WHITESPACE","\n    ",1672],["T_VARIABLE","$real_key",1673],["T_WHITESPACE"," ",1673],"=",["T_WHITESPACE"," ",1673],["T_VARIABLE","$this",1673],["T_OBJECT_OPERATOR","->",1673],["T_STRING","getFieldSchemaIdentifierName",1673],"(",["T_VARIABLE","$storage_definition",1673],["T_OBJECT_OPERATOR","->",1673],["T_STRING","getTargetEntityTypeId",1673],"(",")",",",["T_WHITESPACE"," ",1673],["T_VARIABLE","$name",1673],")",";",["T_WHITESPACE","\n    ",1673],["T_VARIABLE","$schema",1674],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1674],"]","[",["T_VARIABLE","$real_key",1674],"]",["T_WHITESPACE"," ",1674],"=",["T_WHITESPACE"," ",1674],["T_ARRAY","array",1674],"(",["T_VARIABLE","$name",1674],")",";",["T_WHITESPACE","\n    ",1674],["T_VARIABLE","$schema",1675],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1675],"]","[",["T_VARIABLE","$name",1675],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1675],"]",["T_WHITESPACE"," ",1675],"=",["T_WHITESPACE"," ",1675],["T_STRING","TRUE",1675],";",["T_WHITESPACE","\n  ",1675],"}",["T_WHITESPACE","\n\n  ",1676],["T_DOC_COMMENT","\/**\n   * Adds a foreign key for the specified field to the given schema definition.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The storage definition of the field to which to add a foreign key.\n   * @param array $schema\n   *   A reference to the schema array to be updated.\n   * @param string $foreign_table\n   *   The foreign table.\n   * @param string $foreign_column\n   *   The foreign column.\n   *\/",1678],["T_WHITESPACE","\n  ",1689],["T_PROTECTED","protected",1690],["T_WHITESPACE"," ",1690],["T_FUNCTION","function",1690],["T_WHITESPACE"," ",1690],["T_STRING","addSharedTableFieldForeignKey",1690],"(",["T_STRING","FieldStorageDefinitionInterface",1690],["T_WHITESPACE"," ",1690],["T_VARIABLE","$storage_definition",1690],",",["T_WHITESPACE"," ",1690],"&",["T_VARIABLE","$schema",1690],",",["T_WHITESPACE"," ",1690],["T_VARIABLE","$foreign_table",1690],",",["T_WHITESPACE"," ",1690],["T_VARIABLE","$foreign_column",1690],")",["T_WHITESPACE"," ",1690],"{",["T_WHITESPACE","\n    ",1690],["T_VARIABLE","$name",1691],["T_WHITESPACE"," ",1691],"=",["T_WHITESPACE"," ",1691],["T_VARIABLE","$storage_definition",1691],["T_OBJECT_OPERATOR","->",1691],["T_STRING","getName",1691],"(",")",";",["T_WHITESPACE","\n    ",1691],["T_VARIABLE","$real_key",1692],["T_WHITESPACE"," ",1692],"=",["T_WHITESPACE"," ",1692],["T_VARIABLE","$this",1692],["T_OBJECT_OPERATOR","->",1692],["T_STRING","getFieldSchemaIdentifierName",1692],"(",["T_VARIABLE","$storage_definition",1692],["T_OBJECT_OPERATOR","->",1692],["T_STRING","getTargetEntityTypeId",1692],"(",")",",",["T_WHITESPACE"," ",1692],["T_VARIABLE","$name",1692],")",";",["T_WHITESPACE","\n    ",1692],["T_VARIABLE","$schema",1693],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1693],"]","[",["T_VARIABLE","$real_key",1693],"]",["T_WHITESPACE"," ",1693],"=",["T_WHITESPACE"," ",1693],["T_ARRAY","array",1693],"(",["T_WHITESPACE","\n      ",1693],["T_CONSTANT_ENCAPSED_STRING","'table'",1694],["T_WHITESPACE"," ",1694],["T_DOUBLE_ARROW","=>",1694],["T_WHITESPACE"," ",1694],["T_VARIABLE","$foreign_table",1694],",",["T_WHITESPACE","\n      ",1694],["T_CONSTANT_ENCAPSED_STRING","'columns'",1695],["T_WHITESPACE"," ",1695],["T_DOUBLE_ARROW","=>",1695],["T_WHITESPACE"," ",1695],["T_ARRAY","array",1695],"(",["T_VARIABLE","$name",1695],["T_WHITESPACE"," ",1695],["T_DOUBLE_ARROW","=>",1695],["T_WHITESPACE"," ",1695],["T_VARIABLE","$foreign_column",1695],")",",",["T_WHITESPACE","\n    ",1695],")",";",["T_WHITESPACE","\n  ",1696],"}",["T_WHITESPACE","\n\n  ",1697],["T_DOC_COMMENT","\/**\n   * Gets the SQL schema for a dedicated table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   (optional) The entity type definition. Defaults to the one returned by\n   *   the entity manager.\n   *\n   * @return array\n   *   The schema definition for the table with the following keys:\n   *   - fields: The schema definition for the each field columns.\n   *   - indexes: The schema definition for the indexes.\n   *   - unique keys: The schema definition for the unique keys.\n   *   - foreign keys: The schema definition for the foreign keys.\n   *\n   * @throws \\Drupal\\Core\\Field\\FieldException\n   *   Exception thrown if the schema contains reserved column names.\n   *\n   * @see hook_schema()\n   *\/",1699],["T_WHITESPACE","\n  ",1719],["T_PROTECTED","protected",1720],["T_WHITESPACE"," ",1720],["T_FUNCTION","function",1720],["T_WHITESPACE"," ",1720],["T_STRING","getDedicatedTableSchema",1720],"(",["T_STRING","FieldStorageDefinitionInterface",1720],["T_WHITESPACE"," ",1720],["T_VARIABLE","$storage_definition",1720],",",["T_WHITESPACE"," ",1720],["T_STRING","ContentEntityTypeInterface",1720],["T_WHITESPACE"," ",1720],["T_VARIABLE","$entity_type",1720],["T_WHITESPACE"," ",1720],"=",["T_WHITESPACE"," ",1720],["T_STRING","NULL",1720],")",["T_WHITESPACE"," ",1720],"{",["T_WHITESPACE","\n    ",1720],["T_VARIABLE","$description_current",1721],["T_WHITESPACE"," ",1721],"=",["T_WHITESPACE"," ",1721],"\"",["T_ENCAPSED_AND_WHITESPACE","Data storage for ",1721],["T_CURLY_OPEN","{",1721],["T_VARIABLE","$storage_definition",1721],["T_OBJECT_OPERATOR","->",1721],["T_STRING","getTargetEntityTypeId",1721],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," field ",1721],["T_CURLY_OPEN","{",1721],["T_VARIABLE","$storage_definition",1721],["T_OBJECT_OPERATOR","->",1721],["T_STRING","getName",1721],"(",")","}",["T_ENCAPSED_AND_WHITESPACE",".",1721],"\"",";",["T_WHITESPACE","\n    ",1721],["T_VARIABLE","$description_revision",1722],["T_WHITESPACE"," ",1722],"=",["T_WHITESPACE"," ",1722],"\"",["T_ENCAPSED_AND_WHITESPACE","Revision archive storage for ",1722],["T_CURLY_OPEN","{",1722],["T_VARIABLE","$storage_definition",1722],["T_OBJECT_OPERATOR","->",1722],["T_STRING","getTargetEntityTypeId",1722],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," field ",1722],["T_CURLY_OPEN","{",1722],["T_VARIABLE","$storage_definition",1722],["T_OBJECT_OPERATOR","->",1722],["T_STRING","getName",1722],"(",")","}",["T_ENCAPSED_AND_WHITESPACE",".",1722],"\"",";",["T_WHITESPACE","\n\n    ",1722],["T_VARIABLE","$id_definition",1724],["T_WHITESPACE"," ",1724],"=",["T_WHITESPACE"," ",1724],["T_VARIABLE","$this",1724],["T_OBJECT_OPERATOR","->",1724],["T_STRING","fieldStorageDefinitions",1724],"[",["T_VARIABLE","$this",1724],["T_OBJECT_OPERATOR","->",1724],["T_STRING","entityType",1724],["T_OBJECT_OPERATOR","->",1724],["T_STRING","getKey",1724],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",1724],")","]",";",["T_WHITESPACE","\n    ",1724],["T_IF","if",1725],["T_WHITESPACE"," ",1725],"(",["T_VARIABLE","$id_definition",1725],["T_OBJECT_OPERATOR","->",1725],["T_STRING","getType",1725],"(",")",["T_WHITESPACE"," ",1725],["T_IS_EQUAL","==",1725],["T_WHITESPACE"," ",1725],["T_CONSTANT_ENCAPSED_STRING","'integer'",1725],")",["T_WHITESPACE"," ",1725],"{",["T_WHITESPACE","\n      ",1725],["T_VARIABLE","$id_schema",1726],["T_WHITESPACE"," ",1726],"=",["T_WHITESPACE"," ",1726],["T_ARRAY","array",1726],"(",["T_WHITESPACE","\n        ",1726],["T_CONSTANT_ENCAPSED_STRING","'type'",1727],["T_WHITESPACE"," ",1727],["T_DOUBLE_ARROW","=>",1727],["T_WHITESPACE"," ",1727],["T_CONSTANT_ENCAPSED_STRING","'int'",1727],",",["T_WHITESPACE","\n        ",1727],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",1728],["T_WHITESPACE"," ",1728],["T_DOUBLE_ARROW","=>",1728],["T_WHITESPACE"," ",1728],["T_STRING","TRUE",1728],",",["T_WHITESPACE","\n        ",1728],["T_CONSTANT_ENCAPSED_STRING","'not null'",1729],["T_WHITESPACE"," ",1729],["T_DOUBLE_ARROW","=>",1729],["T_WHITESPACE"," ",1729],["T_STRING","TRUE",1729],",",["T_WHITESPACE","\n        ",1729],["T_CONSTANT_ENCAPSED_STRING","'description'",1730],["T_WHITESPACE"," ",1730],["T_DOUBLE_ARROW","=>",1730],["T_WHITESPACE"," ",1730],["T_CONSTANT_ENCAPSED_STRING","'The entity id this data is attached to'",1730],",",["T_WHITESPACE","\n      ",1730],")",";",["T_WHITESPACE","\n    ",1731],"}",["T_WHITESPACE","\n    ",1732],["T_ELSE","else",1733],["T_WHITESPACE"," ",1733],"{",["T_WHITESPACE","\n      ",1733],["T_VARIABLE","$id_schema",1734],["T_WHITESPACE"," ",1734],"=",["T_WHITESPACE"," ",1734],["T_ARRAY","array",1734],"(",["T_WHITESPACE","\n        ",1734],["T_CONSTANT_ENCAPSED_STRING","'type'",1735],["T_WHITESPACE"," ",1735],["T_DOUBLE_ARROW","=>",1735],["T_WHITESPACE"," ",1735],["T_CONSTANT_ENCAPSED_STRING","'varchar_ascii'",1735],",",["T_WHITESPACE","\n        ",1735],["T_CONSTANT_ENCAPSED_STRING","'length'",1736],["T_WHITESPACE"," ",1736],["T_DOUBLE_ARROW","=>",1736],["T_WHITESPACE"," ",1736],["T_LNUMBER","128",1736],",",["T_WHITESPACE","\n        ",1736],["T_CONSTANT_ENCAPSED_STRING","'not null'",1737],["T_WHITESPACE"," ",1737],["T_DOUBLE_ARROW","=>",1737],["T_WHITESPACE"," ",1737],["T_STRING","TRUE",1737],",",["T_WHITESPACE","\n        ",1737],["T_CONSTANT_ENCAPSED_STRING","'description'",1738],["T_WHITESPACE"," ",1738],["T_DOUBLE_ARROW","=>",1738],["T_WHITESPACE"," ",1738],["T_CONSTANT_ENCAPSED_STRING","'The entity id this data is attached to'",1738],",",["T_WHITESPACE","\n      ",1738],")",";",["T_WHITESPACE","\n    ",1739],"}",["T_WHITESPACE","\n\n    ",1740],["T_COMMENT","\/\/ Define the revision ID schema.\n",1742],["T_WHITESPACE","    ",1743],["T_IF","if",1743],["T_WHITESPACE"," ",1743],"(","!",["T_VARIABLE","$this",1743],["T_OBJECT_OPERATOR","->",1743],["T_STRING","entityType",1743],["T_OBJECT_OPERATOR","->",1743],["T_STRING","isRevisionable",1743],"(",")",")",["T_WHITESPACE"," ",1743],"{",["T_WHITESPACE","\n      ",1743],["T_VARIABLE","$revision_id_schema",1744],["T_WHITESPACE"," ",1744],"=",["T_WHITESPACE"," ",1744],["T_VARIABLE","$id_schema",1744],";",["T_WHITESPACE","\n      ",1744],["T_VARIABLE","$revision_id_schema",1745],"[",["T_CONSTANT_ENCAPSED_STRING","'description'",1745],"]",["T_WHITESPACE"," ",1745],"=",["T_WHITESPACE"," ",1745],["T_CONSTANT_ENCAPSED_STRING","'The entity revision id this data is attached to, which for an unversioned entity type is the same as the entity id'",1745],";",["T_WHITESPACE","\n    ",1745],"}",["T_WHITESPACE","\n    ",1746],["T_ELSEIF","elseif",1747],["T_WHITESPACE"," ",1747],"(",["T_VARIABLE","$this",1747],["T_OBJECT_OPERATOR","->",1747],["T_STRING","fieldStorageDefinitions",1747],"[",["T_VARIABLE","$this",1747],["T_OBJECT_OPERATOR","->",1747],["T_STRING","entityType",1747],["T_OBJECT_OPERATOR","->",1747],["T_STRING","getKey",1747],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",1747],")","]",["T_OBJECT_OPERATOR","->",1747],["T_STRING","getType",1747],"(",")",["T_WHITESPACE"," ",1747],["T_IS_EQUAL","==",1747],["T_WHITESPACE"," ",1747],["T_CONSTANT_ENCAPSED_STRING","'integer'",1747],")",["T_WHITESPACE"," ",1747],"{",["T_WHITESPACE","\n      ",1747],["T_VARIABLE","$revision_id_schema",1748],["T_WHITESPACE"," ",1748],"=",["T_WHITESPACE"," ",1748],["T_ARRAY","array",1748],"(",["T_WHITESPACE","\n        ",1748],["T_CONSTANT_ENCAPSED_STRING","'type'",1749],["T_WHITESPACE"," ",1749],["T_DOUBLE_ARROW","=>",1749],["T_WHITESPACE"," ",1749],["T_CONSTANT_ENCAPSED_STRING","'int'",1749],",",["T_WHITESPACE","\n        ",1749],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",1750],["T_WHITESPACE"," ",1750],["T_DOUBLE_ARROW","=>",1750],["T_WHITESPACE"," ",1750],["T_STRING","TRUE",1750],",",["T_WHITESPACE","\n        ",1750],["T_CONSTANT_ENCAPSED_STRING","'not null'",1751],["T_WHITESPACE"," ",1751],["T_DOUBLE_ARROW","=>",1751],["T_WHITESPACE"," ",1751],["T_STRING","TRUE",1751],",",["T_WHITESPACE","\n        ",1751],["T_CONSTANT_ENCAPSED_STRING","'description'",1752],["T_WHITESPACE"," ",1752],["T_DOUBLE_ARROW","=>",1752],["T_WHITESPACE"," ",1752],["T_CONSTANT_ENCAPSED_STRING","'The entity revision id this data is attached to'",1752],",",["T_WHITESPACE","\n      ",1752],")",";",["T_WHITESPACE","\n    ",1753],"}",["T_WHITESPACE","\n    ",1754],["T_ELSE","else",1755],["T_WHITESPACE"," ",1755],"{",["T_WHITESPACE","\n      ",1755],["T_VARIABLE","$revision_id_schema",1756],["T_WHITESPACE"," ",1756],"=",["T_WHITESPACE"," ",1756],["T_ARRAY","array",1756],"(",["T_WHITESPACE","\n        ",1756],["T_CONSTANT_ENCAPSED_STRING","'type'",1757],["T_WHITESPACE"," ",1757],["T_DOUBLE_ARROW","=>",1757],["T_WHITESPACE"," ",1757],["T_CONSTANT_ENCAPSED_STRING","'varchar'",1757],",",["T_WHITESPACE","\n        ",1757],["T_CONSTANT_ENCAPSED_STRING","'length'",1758],["T_WHITESPACE"," ",1758],["T_DOUBLE_ARROW","=>",1758],["T_WHITESPACE"," ",1758],["T_LNUMBER","128",1758],",",["T_WHITESPACE","\n        ",1758],["T_CONSTANT_ENCAPSED_STRING","'not null'",1759],["T_WHITESPACE"," ",1759],["T_DOUBLE_ARROW","=>",1759],["T_WHITESPACE"," ",1759],["T_STRING","TRUE",1759],",",["T_WHITESPACE","\n        ",1759],["T_CONSTANT_ENCAPSED_STRING","'description'",1760],["T_WHITESPACE"," ",1760],["T_DOUBLE_ARROW","=>",1760],["T_WHITESPACE"," ",1760],["T_CONSTANT_ENCAPSED_STRING","'The entity revision id this data is attached to'",1760],",",["T_WHITESPACE","\n      ",1760],")",";",["T_WHITESPACE","\n    ",1761],"}",["T_WHITESPACE","\n\n    ",1762],["T_VARIABLE","$data_schema",1764],["T_WHITESPACE"," ",1764],"=",["T_WHITESPACE"," ",1764],["T_ARRAY","array",1764],"(",["T_WHITESPACE","\n      ",1764],["T_CONSTANT_ENCAPSED_STRING","'description'",1765],["T_WHITESPACE"," ",1765],["T_DOUBLE_ARROW","=>",1765],["T_WHITESPACE"," ",1765],["T_VARIABLE","$description_current",1765],",",["T_WHITESPACE","\n      ",1765],["T_CONSTANT_ENCAPSED_STRING","'fields'",1766],["T_WHITESPACE"," ",1766],["T_DOUBLE_ARROW","=>",1766],["T_WHITESPACE"," ",1766],["T_ARRAY","array",1766],"(",["T_WHITESPACE","\n        ",1766],["T_CONSTANT_ENCAPSED_STRING","'bundle'",1767],["T_WHITESPACE"," ",1767],["T_DOUBLE_ARROW","=>",1767],["T_WHITESPACE"," ",1767],["T_ARRAY","array",1767],"(",["T_WHITESPACE","\n          ",1767],["T_CONSTANT_ENCAPSED_STRING","'type'",1768],["T_WHITESPACE"," ",1768],["T_DOUBLE_ARROW","=>",1768],["T_WHITESPACE"," ",1768],["T_CONSTANT_ENCAPSED_STRING","'varchar_ascii'",1768],",",["T_WHITESPACE","\n          ",1768],["T_CONSTANT_ENCAPSED_STRING","'length'",1769],["T_WHITESPACE"," ",1769],["T_DOUBLE_ARROW","=>",1769],["T_WHITESPACE"," ",1769],["T_LNUMBER","128",1769],",",["T_WHITESPACE","\n          ",1769],["T_CONSTANT_ENCAPSED_STRING","'not null'",1770],["T_WHITESPACE"," ",1770],["T_DOUBLE_ARROW","=>",1770],["T_WHITESPACE"," ",1770],["T_STRING","TRUE",1770],",",["T_WHITESPACE","\n          ",1770],["T_CONSTANT_ENCAPSED_STRING","'default'",1771],["T_WHITESPACE"," ",1771],["T_DOUBLE_ARROW","=>",1771],["T_WHITESPACE"," ",1771],["T_CONSTANT_ENCAPSED_STRING","''",1771],",",["T_WHITESPACE","\n          ",1771],["T_CONSTANT_ENCAPSED_STRING","'description'",1772],["T_WHITESPACE"," ",1772],["T_DOUBLE_ARROW","=>",1772],["T_WHITESPACE"," ",1772],["T_CONSTANT_ENCAPSED_STRING","'The field instance bundle to which this row belongs, used when deleting a field instance'",1772],",",["T_WHITESPACE","\n        ",1772],")",",",["T_WHITESPACE","\n        ",1773],["T_CONSTANT_ENCAPSED_STRING","'deleted'",1774],["T_WHITESPACE"," ",1774],["T_DOUBLE_ARROW","=>",1774],["T_WHITESPACE"," ",1774],["T_ARRAY","array",1774],"(",["T_WHITESPACE","\n          ",1774],["T_CONSTANT_ENCAPSED_STRING","'type'",1775],["T_WHITESPACE"," ",1775],["T_DOUBLE_ARROW","=>",1775],["T_WHITESPACE"," ",1775],["T_CONSTANT_ENCAPSED_STRING","'int'",1775],",",["T_WHITESPACE","\n          ",1775],["T_CONSTANT_ENCAPSED_STRING","'size'",1776],["T_WHITESPACE"," ",1776],["T_DOUBLE_ARROW","=>",1776],["T_WHITESPACE"," ",1776],["T_CONSTANT_ENCAPSED_STRING","'tiny'",1776],",",["T_WHITESPACE","\n          ",1776],["T_CONSTANT_ENCAPSED_STRING","'not null'",1777],["T_WHITESPACE"," ",1777],["T_DOUBLE_ARROW","=>",1777],["T_WHITESPACE"," ",1777],["T_STRING","TRUE",1777],",",["T_WHITESPACE","\n          ",1777],["T_CONSTANT_ENCAPSED_STRING","'default'",1778],["T_WHITESPACE"," ",1778],["T_DOUBLE_ARROW","=>",1778],["T_WHITESPACE"," ",1778],["T_LNUMBER","0",1778],",",["T_WHITESPACE","\n          ",1778],["T_CONSTANT_ENCAPSED_STRING","'description'",1779],["T_WHITESPACE"," ",1779],["T_DOUBLE_ARROW","=>",1779],["T_WHITESPACE"," ",1779],["T_CONSTANT_ENCAPSED_STRING","'A boolean indicating whether this data item has been deleted'",1779],["T_WHITESPACE","\n        ",1779],")",",",["T_WHITESPACE","\n        ",1780],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1781],["T_WHITESPACE"," ",1781],["T_DOUBLE_ARROW","=>",1781],["T_WHITESPACE"," ",1781],["T_VARIABLE","$id_schema",1781],",",["T_WHITESPACE","\n        ",1781],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1782],["T_WHITESPACE"," ",1782],["T_DOUBLE_ARROW","=>",1782],["T_WHITESPACE"," ",1782],["T_VARIABLE","$revision_id_schema",1782],",",["T_WHITESPACE","\n        ",1782],["T_CONSTANT_ENCAPSED_STRING","'langcode'",1783],["T_WHITESPACE"," ",1783],["T_DOUBLE_ARROW","=>",1783],["T_WHITESPACE"," ",1783],["T_ARRAY","array",1783],"(",["T_WHITESPACE","\n          ",1783],["T_CONSTANT_ENCAPSED_STRING","'type'",1784],["T_WHITESPACE"," ",1784],["T_DOUBLE_ARROW","=>",1784],["T_WHITESPACE"," ",1784],["T_CONSTANT_ENCAPSED_STRING","'varchar_ascii'",1784],",",["T_WHITESPACE","\n          ",1784],["T_CONSTANT_ENCAPSED_STRING","'length'",1785],["T_WHITESPACE"," ",1785],["T_DOUBLE_ARROW","=>",1785],["T_WHITESPACE"," ",1785],["T_LNUMBER","32",1785],",",["T_WHITESPACE","\n          ",1785],["T_CONSTANT_ENCAPSED_STRING","'not null'",1786],["T_WHITESPACE"," ",1786],["T_DOUBLE_ARROW","=>",1786],["T_WHITESPACE"," ",1786],["T_STRING","TRUE",1786],",",["T_WHITESPACE","\n          ",1786],["T_CONSTANT_ENCAPSED_STRING","'default'",1787],["T_WHITESPACE"," ",1787],["T_DOUBLE_ARROW","=>",1787],["T_WHITESPACE"," ",1787],["T_CONSTANT_ENCAPSED_STRING","''",1787],",",["T_WHITESPACE","\n          ",1787],["T_CONSTANT_ENCAPSED_STRING","'description'",1788],["T_WHITESPACE"," ",1788],["T_DOUBLE_ARROW","=>",1788],["T_WHITESPACE"," ",1788],["T_CONSTANT_ENCAPSED_STRING","'The language code for this data item.'",1788],",",["T_WHITESPACE","\n        ",1788],")",",",["T_WHITESPACE","\n        ",1789],["T_CONSTANT_ENCAPSED_STRING","'delta'",1790],["T_WHITESPACE"," ",1790],["T_DOUBLE_ARROW","=>",1790],["T_WHITESPACE"," ",1790],["T_ARRAY","array",1790],"(",["T_WHITESPACE","\n          ",1790],["T_CONSTANT_ENCAPSED_STRING","'type'",1791],["T_WHITESPACE"," ",1791],["T_DOUBLE_ARROW","=>",1791],["T_WHITESPACE"," ",1791],["T_CONSTANT_ENCAPSED_STRING","'int'",1791],",",["T_WHITESPACE","\n          ",1791],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",1792],["T_WHITESPACE"," ",1792],["T_DOUBLE_ARROW","=>",1792],["T_WHITESPACE"," ",1792],["T_STRING","TRUE",1792],",",["T_WHITESPACE","\n          ",1792],["T_CONSTANT_ENCAPSED_STRING","'not null'",1793],["T_WHITESPACE"," ",1793],["T_DOUBLE_ARROW","=>",1793],["T_WHITESPACE"," ",1793],["T_STRING","TRUE",1793],",",["T_WHITESPACE","\n          ",1793],["T_CONSTANT_ENCAPSED_STRING","'description'",1794],["T_WHITESPACE"," ",1794],["T_DOUBLE_ARROW","=>",1794],["T_WHITESPACE"," ",1794],["T_CONSTANT_ENCAPSED_STRING","'The sequence number for this data item, used for multi-value fields'",1794],",",["T_WHITESPACE","\n        ",1794],")",",",["T_WHITESPACE","\n      ",1795],")",",",["T_WHITESPACE","\n      ",1796],["T_CONSTANT_ENCAPSED_STRING","'primary key'",1797],["T_WHITESPACE"," ",1797],["T_DOUBLE_ARROW","=>",1797],["T_WHITESPACE"," ",1797],["T_ARRAY","array",1797],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1797],",",["T_WHITESPACE"," ",1797],["T_CONSTANT_ENCAPSED_STRING","'deleted'",1797],",",["T_WHITESPACE"," ",1797],["T_CONSTANT_ENCAPSED_STRING","'delta'",1797],",",["T_WHITESPACE"," ",1797],["T_CONSTANT_ENCAPSED_STRING","'langcode'",1797],")",",",["T_WHITESPACE","\n      ",1797],["T_CONSTANT_ENCAPSED_STRING","'indexes'",1798],["T_WHITESPACE"," ",1798],["T_DOUBLE_ARROW","=>",1798],["T_WHITESPACE"," ",1798],["T_ARRAY","array",1798],"(",["T_WHITESPACE","\n        ",1798],["T_CONSTANT_ENCAPSED_STRING","'bundle'",1799],["T_WHITESPACE"," ",1799],["T_DOUBLE_ARROW","=>",1799],["T_WHITESPACE"," ",1799],["T_ARRAY","array",1799],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",1799],")",",",["T_WHITESPACE","\n        ",1799],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1800],["T_WHITESPACE"," ",1800],["T_DOUBLE_ARROW","=>",1800],["T_WHITESPACE"," ",1800],["T_ARRAY","array",1800],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1800],")",",",["T_WHITESPACE","\n      ",1800],")",",",["T_WHITESPACE","\n    ",1801],")",";",["T_WHITESPACE","\n\n    ",1802],["T_COMMENT","\/\/ Check that the schema does not include forbidden column names.\n",1804],["T_WHITESPACE","    ",1805],["T_VARIABLE","$schema",1805],["T_WHITESPACE"," ",1805],"=",["T_WHITESPACE"," ",1805],["T_VARIABLE","$storage_definition",1805],["T_OBJECT_OPERATOR","->",1805],["T_STRING","getSchema",1805],"(",")",";",["T_WHITESPACE","\n    ",1805],["T_VARIABLE","$properties",1806],["T_WHITESPACE"," ",1806],"=",["T_WHITESPACE"," ",1806],["T_VARIABLE","$storage_definition",1806],["T_OBJECT_OPERATOR","->",1806],["T_STRING","getPropertyDefinitions",1806],"(",")",";",["T_WHITESPACE","\n    ",1806],["T_VARIABLE","$table_mapping",1807],["T_WHITESPACE"," ",1807],"=",["T_WHITESPACE"," ",1807],["T_VARIABLE","$this",1807],["T_OBJECT_OPERATOR","->",1807],["T_STRING","storage",1807],["T_OBJECT_OPERATOR","->",1807],["T_STRING","getTableMapping",1807],"(",")",";",["T_WHITESPACE","\n    ",1807],["T_IF","if",1808],["T_WHITESPACE"," ",1808],"(",["T_STRING","array_intersect",1808],"(",["T_STRING","array_keys",1808],"(",["T_VARIABLE","$schema",1808],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1808],"]",")",",",["T_WHITESPACE"," ",1808],["T_VARIABLE","$table_mapping",1808],["T_OBJECT_OPERATOR","->",1808],["T_STRING","getReservedColumns",1808],"(",")",")",")",["T_WHITESPACE"," ",1808],"{",["T_WHITESPACE","\n      ",1808],["T_THROW","throw",1809],["T_WHITESPACE"," ",1809],["T_NEW","new",1809],["T_WHITESPACE"," ",1809],["T_STRING","FieldException",1809],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Illegal field column names on ",1809],["T_CURLY_OPEN","{",1809],["T_VARIABLE","$storage_definition",1809],["T_OBJECT_OPERATOR","->",1809],["T_STRING","getName",1809],"(",")","}","\"",")",";",["T_WHITESPACE","\n    ",1809],"}",["T_WHITESPACE","\n\n    ",1810],["T_COMMENT","\/\/ Add field columns.\n",1812],["T_WHITESPACE","    ",1813],["T_FOREACH","foreach",1813],["T_WHITESPACE"," ",1813],"(",["T_VARIABLE","$schema",1813],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1813],"]",["T_WHITESPACE"," ",1813],["T_AS","as",1813],["T_WHITESPACE"," ",1813],["T_VARIABLE","$column_name",1813],["T_WHITESPACE"," ",1813],["T_DOUBLE_ARROW","=>",1813],["T_WHITESPACE"," ",1813],["T_VARIABLE","$attributes",1813],")",["T_WHITESPACE"," ",1813],"{",["T_WHITESPACE","\n      ",1813],["T_VARIABLE","$real_name",1814],["T_WHITESPACE"," ",1814],"=",["T_WHITESPACE"," ",1814],["T_VARIABLE","$table_mapping",1814],["T_OBJECT_OPERATOR","->",1814],["T_STRING","getFieldColumnName",1814],"(",["T_VARIABLE","$storage_definition",1814],",",["T_WHITESPACE"," ",1814],["T_VARIABLE","$column_name",1814],")",";",["T_WHITESPACE","\n      ",1814],["T_VARIABLE","$data_schema",1815],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1815],"]","[",["T_VARIABLE","$real_name",1815],"]",["T_WHITESPACE"," ",1815],"=",["T_WHITESPACE"," ",1815],["T_VARIABLE","$attributes",1815],";",["T_WHITESPACE","\n      ",1815],["T_COMMENT","\/\/ A dedicated table only contain rows for actual field values, and no\n",1816],["T_WHITESPACE","      ",1817],["T_COMMENT","\/\/ rows for entities where the field is empty. Thus, we can safely\n",1817],["T_WHITESPACE","      ",1818],["T_COMMENT","\/\/ enforce 'not null' on the columns for the field's required properties.\n",1818],["T_WHITESPACE","      ",1819],["T_VARIABLE","$data_schema",1819],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1819],"]","[",["T_VARIABLE","$real_name",1819],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1819],"]",["T_WHITESPACE"," ",1819],"=",["T_WHITESPACE"," ",1819],["T_VARIABLE","$properties",1819],"[",["T_VARIABLE","$column_name",1819],"]",["T_OBJECT_OPERATOR","->",1819],["T_STRING","isRequired",1819],"(",")",";",["T_WHITESPACE","\n    ",1819],"}",["T_WHITESPACE","\n\n    ",1820],["T_COMMENT","\/\/ Add indexes.\n",1822],["T_WHITESPACE","    ",1823],["T_FOREACH","foreach",1823],["T_WHITESPACE"," ",1823],"(",["T_VARIABLE","$schema",1823],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1823],"]",["T_WHITESPACE"," ",1823],["T_AS","as",1823],["T_WHITESPACE"," ",1823],["T_VARIABLE","$index_name",1823],["T_WHITESPACE"," ",1823],["T_DOUBLE_ARROW","=>",1823],["T_WHITESPACE"," ",1823],["T_VARIABLE","$columns",1823],")",["T_WHITESPACE"," ",1823],"{",["T_WHITESPACE","\n      ",1823],["T_VARIABLE","$real_name",1824],["T_WHITESPACE"," ",1824],"=",["T_WHITESPACE"," ",1824],["T_VARIABLE","$this",1824],["T_OBJECT_OPERATOR","->",1824],["T_STRING","getFieldIndexName",1824],"(",["T_VARIABLE","$storage_definition",1824],",",["T_WHITESPACE"," ",1824],["T_VARIABLE","$index_name",1824],")",";",["T_WHITESPACE","\n      ",1824],["T_FOREACH","foreach",1825],["T_WHITESPACE"," ",1825],"(",["T_VARIABLE","$columns",1825],["T_WHITESPACE"," ",1825],["T_AS","as",1825],["T_WHITESPACE"," ",1825],["T_VARIABLE","$column_name",1825],")",["T_WHITESPACE"," ",1825],"{",["T_WHITESPACE","\n        ",1825],["T_COMMENT","\/\/ Indexes can be specified as either a column name or an array with\n",1826],["T_WHITESPACE","        ",1827],["T_COMMENT","\/\/ column name and length. Allow for either case.\n",1827],["T_WHITESPACE","        ",1828],["T_IF","if",1828],["T_WHITESPACE"," ",1828],"(",["T_STRING","is_array",1828],"(",["T_VARIABLE","$column_name",1828],")",")",["T_WHITESPACE"," ",1828],"{",["T_WHITESPACE","\n          ",1828],["T_VARIABLE","$data_schema",1829],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1829],"]","[",["T_VARIABLE","$real_name",1829],"]","[","]",["T_WHITESPACE"," ",1829],"=",["T_WHITESPACE"," ",1829],["T_ARRAY","array",1829],"(",["T_WHITESPACE","\n            ",1829],["T_VARIABLE","$table_mapping",1830],["T_OBJECT_OPERATOR","->",1830],["T_STRING","getFieldColumnName",1830],"(",["T_VARIABLE","$storage_definition",1830],",",["T_WHITESPACE"," ",1830],["T_VARIABLE","$column_name",1830],"[",["T_LNUMBER","0",1830],"]",")",",",["T_WHITESPACE","\n            ",1830],["T_VARIABLE","$column_name",1831],"[",["T_LNUMBER","1",1831],"]",",",["T_WHITESPACE","\n          ",1831],")",";",["T_WHITESPACE","\n        ",1832],"}",["T_WHITESPACE","\n        ",1833],["T_ELSE","else",1834],["T_WHITESPACE"," ",1834],"{",["T_WHITESPACE","\n          ",1834],["T_VARIABLE","$data_schema",1835],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",1835],"]","[",["T_VARIABLE","$real_name",1835],"]","[","]",["T_WHITESPACE"," ",1835],"=",["T_WHITESPACE"," ",1835],["T_VARIABLE","$table_mapping",1835],["T_OBJECT_OPERATOR","->",1835],["T_STRING","getFieldColumnName",1835],"(",["T_VARIABLE","$storage_definition",1835],",",["T_WHITESPACE"," ",1835],["T_VARIABLE","$column_name",1835],")",";",["T_WHITESPACE","\n        ",1835],"}",["T_WHITESPACE","\n      ",1836],"}",["T_WHITESPACE","\n    ",1837],"}",["T_WHITESPACE","\n\n    ",1838],["T_COMMENT","\/\/ Add unique keys.\n",1840],["T_WHITESPACE","    ",1841],["T_FOREACH","foreach",1841],["T_WHITESPACE"," ",1841],"(",["T_VARIABLE","$schema",1841],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1841],"]",["T_WHITESPACE"," ",1841],["T_AS","as",1841],["T_WHITESPACE"," ",1841],["T_VARIABLE","$index_name",1841],["T_WHITESPACE"," ",1841],["T_DOUBLE_ARROW","=>",1841],["T_WHITESPACE"," ",1841],["T_VARIABLE","$columns",1841],")",["T_WHITESPACE"," ",1841],"{",["T_WHITESPACE","\n      ",1841],["T_VARIABLE","$real_name",1842],["T_WHITESPACE"," ",1842],"=",["T_WHITESPACE"," ",1842],["T_VARIABLE","$this",1842],["T_OBJECT_OPERATOR","->",1842],["T_STRING","getFieldIndexName",1842],"(",["T_VARIABLE","$storage_definition",1842],",",["T_WHITESPACE"," ",1842],["T_VARIABLE","$index_name",1842],")",";",["T_WHITESPACE","\n      ",1842],["T_FOREACH","foreach",1843],["T_WHITESPACE"," ",1843],"(",["T_VARIABLE","$columns",1843],["T_WHITESPACE"," ",1843],["T_AS","as",1843],["T_WHITESPACE"," ",1843],["T_VARIABLE","$column_name",1843],")",["T_WHITESPACE"," ",1843],"{",["T_WHITESPACE","\n        ",1843],["T_COMMENT","\/\/ Unique keys can be specified as either a column name or an array with\n",1844],["T_WHITESPACE","        ",1845],["T_COMMENT","\/\/ column name and length. Allow for either case.\n",1845],["T_WHITESPACE","        ",1846],["T_IF","if",1846],["T_WHITESPACE"," ",1846],"(",["T_STRING","is_array",1846],"(",["T_VARIABLE","$column_name",1846],")",")",["T_WHITESPACE"," ",1846],"{",["T_WHITESPACE","\n          ",1846],["T_VARIABLE","$data_schema",1847],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1847],"]","[",["T_VARIABLE","$real_name",1847],"]","[","]",["T_WHITESPACE"," ",1847],"=",["T_WHITESPACE"," ",1847],["T_ARRAY","array",1847],"(",["T_WHITESPACE","\n            ",1847],["T_VARIABLE","$table_mapping",1848],["T_OBJECT_OPERATOR","->",1848],["T_STRING","getFieldColumnName",1848],"(",["T_VARIABLE","$storage_definition",1848],",",["T_WHITESPACE"," ",1848],["T_VARIABLE","$column_name",1848],"[",["T_LNUMBER","0",1848],"]",")",",",["T_WHITESPACE","\n            ",1848],["T_VARIABLE","$column_name",1849],"[",["T_LNUMBER","1",1849],"]",",",["T_WHITESPACE","\n          ",1849],")",";",["T_WHITESPACE","\n        ",1850],"}",["T_WHITESPACE","\n        ",1851],["T_ELSE","else",1852],["T_WHITESPACE"," ",1852],"{",["T_WHITESPACE","\n          ",1852],["T_VARIABLE","$data_schema",1853],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",1853],"]","[",["T_VARIABLE","$real_name",1853],"]","[","]",["T_WHITESPACE"," ",1853],"=",["T_WHITESPACE"," ",1853],["T_VARIABLE","$table_mapping",1853],["T_OBJECT_OPERATOR","->",1853],["T_STRING","getFieldColumnName",1853],"(",["T_VARIABLE","$storage_definition",1853],",",["T_WHITESPACE"," ",1853],["T_VARIABLE","$column_name",1853],")",";",["T_WHITESPACE","\n        ",1853],"}",["T_WHITESPACE","\n      ",1854],"}",["T_WHITESPACE","\n    ",1855],"}",["T_WHITESPACE","\n\n    ",1856],["T_COMMENT","\/\/ Add foreign keys.\n",1858],["T_WHITESPACE","    ",1859],["T_FOREACH","foreach",1859],["T_WHITESPACE"," ",1859],"(",["T_VARIABLE","$schema",1859],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1859],"]",["T_WHITESPACE"," ",1859],["T_AS","as",1859],["T_WHITESPACE"," ",1859],["T_VARIABLE","$specifier",1859],["T_WHITESPACE"," ",1859],["T_DOUBLE_ARROW","=>",1859],["T_WHITESPACE"," ",1859],["T_VARIABLE","$specification",1859],")",["T_WHITESPACE"," ",1859],"{",["T_WHITESPACE","\n      ",1859],["T_VARIABLE","$real_name",1860],["T_WHITESPACE"," ",1860],"=",["T_WHITESPACE"," ",1860],["T_VARIABLE","$this",1860],["T_OBJECT_OPERATOR","->",1860],["T_STRING","getFieldIndexName",1860],"(",["T_VARIABLE","$storage_definition",1860],",",["T_WHITESPACE"," ",1860],["T_VARIABLE","$specifier",1860],")",";",["T_WHITESPACE","\n      ",1860],["T_VARIABLE","$data_schema",1861],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1861],"]","[",["T_VARIABLE","$real_name",1861],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",1861],"]",["T_WHITESPACE"," ",1861],"=",["T_WHITESPACE"," ",1861],["T_VARIABLE","$specification",1861],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",1861],"]",";",["T_WHITESPACE","\n      ",1861],["T_FOREACH","foreach",1862],["T_WHITESPACE"," ",1862],"(",["T_VARIABLE","$specification",1862],"[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1862],"]",["T_WHITESPACE"," ",1862],["T_AS","as",1862],["T_WHITESPACE"," ",1862],["T_VARIABLE","$column_name",1862],["T_WHITESPACE"," ",1862],["T_DOUBLE_ARROW","=>",1862],["T_WHITESPACE"," ",1862],["T_VARIABLE","$referenced",1862],")",["T_WHITESPACE"," ",1862],"{",["T_WHITESPACE","\n        ",1862],["T_VARIABLE","$sql_storage_column",1863],["T_WHITESPACE"," ",1863],"=",["T_WHITESPACE"," ",1863],["T_VARIABLE","$table_mapping",1863],["T_OBJECT_OPERATOR","->",1863],["T_STRING","getFieldColumnName",1863],"(",["T_VARIABLE","$storage_definition",1863],",",["T_WHITESPACE"," ",1863],["T_VARIABLE","$column_name",1863],")",";",["T_WHITESPACE","\n        ",1863],["T_VARIABLE","$data_schema",1864],"[",["T_CONSTANT_ENCAPSED_STRING","'foreign keys'",1864],"]","[",["T_VARIABLE","$real_name",1864],"]","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",1864],"]","[",["T_VARIABLE","$sql_storage_column",1864],"]",["T_WHITESPACE"," ",1864],"=",["T_WHITESPACE"," ",1864],["T_VARIABLE","$referenced",1864],";",["T_WHITESPACE","\n      ",1864],"}",["T_WHITESPACE","\n    ",1865],"}",["T_WHITESPACE","\n\n    ",1866],["T_VARIABLE","$dedicated_table_schema",1868],["T_WHITESPACE"," ",1868],"=",["T_WHITESPACE"," ",1868],["T_ARRAY","array",1868],"(",["T_VARIABLE","$table_mapping",1868],["T_OBJECT_OPERATOR","->",1868],["T_STRING","getDedicatedDataTableName",1868],"(",["T_VARIABLE","$storage_definition",1868],")",["T_WHITESPACE"," ",1868],["T_DOUBLE_ARROW","=>",1868],["T_WHITESPACE"," ",1868],["T_VARIABLE","$data_schema",1868],")",";",["T_WHITESPACE","\n\n    ",1868],["T_COMMENT","\/\/ If the entity type is revisionable, construct the revision table.\n",1870],["T_WHITESPACE","    ",1871],["T_VARIABLE","$entity_type",1871],["T_WHITESPACE"," ",1871],"=",["T_WHITESPACE"," ",1871],["T_VARIABLE","$entity_type",1871],["T_WHITESPACE"," ",1871],"?",":",["T_WHITESPACE"," ",1871],["T_VARIABLE","$this",1871],["T_OBJECT_OPERATOR","->",1871],["T_STRING","entityType",1871],";",["T_WHITESPACE","\n    ",1871],["T_IF","if",1872],["T_WHITESPACE"," ",1872],"(",["T_VARIABLE","$entity_type",1872],["T_OBJECT_OPERATOR","->",1872],["T_STRING","isRevisionable",1872],"(",")",")",["T_WHITESPACE"," ",1872],"{",["T_WHITESPACE","\n      ",1872],["T_VARIABLE","$revision_schema",1873],["T_WHITESPACE"," ",1873],"=",["T_WHITESPACE"," ",1873],["T_VARIABLE","$data_schema",1873],";",["T_WHITESPACE","\n      ",1873],["T_VARIABLE","$revision_schema",1874],"[",["T_CONSTANT_ENCAPSED_STRING","'description'",1874],"]",["T_WHITESPACE"," ",1874],"=",["T_WHITESPACE"," ",1874],["T_VARIABLE","$description_revision",1874],";",["T_WHITESPACE","\n      ",1874],["T_VARIABLE","$revision_schema",1875],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",1875],"]",["T_WHITESPACE"," ",1875],"=",["T_WHITESPACE"," ",1875],["T_ARRAY","array",1875],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1875],",",["T_WHITESPACE"," ",1875],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1875],",",["T_WHITESPACE"," ",1875],["T_CONSTANT_ENCAPSED_STRING","'deleted'",1875],",",["T_WHITESPACE"," ",1875],["T_CONSTANT_ENCAPSED_STRING","'delta'",1875],",",["T_WHITESPACE"," ",1875],["T_CONSTANT_ENCAPSED_STRING","'langcode'",1875],")",";",["T_WHITESPACE","\n      ",1875],["T_VARIABLE","$revision_schema",1876],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1876],"]","[",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1876],"]","[",["T_CONSTANT_ENCAPSED_STRING","'not null'",1876],"]",["T_WHITESPACE"," ",1876],"=",["T_WHITESPACE"," ",1876],["T_STRING","TRUE",1876],";",["T_WHITESPACE","\n      ",1876],["T_VARIABLE","$revision_schema",1877],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1877],"]","[",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1877],"]","[",["T_CONSTANT_ENCAPSED_STRING","'description'",1877],"]",["T_WHITESPACE"," ",1877],"=",["T_WHITESPACE"," ",1877],["T_CONSTANT_ENCAPSED_STRING","'The entity revision id this data is attached to'",1877],";",["T_WHITESPACE","\n      ",1877],["T_VARIABLE","$dedicated_table_schema",1878],["T_WHITESPACE"," ",1878],["T_PLUS_EQUAL","+=",1878],["T_WHITESPACE"," ",1878],["T_ARRAY","array",1878],"(",["T_VARIABLE","$table_mapping",1878],["T_OBJECT_OPERATOR","->",1878],["T_STRING","getDedicatedRevisionTableName",1878],"(",["T_VARIABLE","$storage_definition",1878],")",["T_WHITESPACE"," ",1878],["T_DOUBLE_ARROW","=>",1878],["T_WHITESPACE"," ",1878],["T_VARIABLE","$revision_schema",1878],")",";",["T_WHITESPACE","\n    ",1878],"}",["T_WHITESPACE","\n\n    ",1879],["T_RETURN","return",1881],["T_WHITESPACE"," ",1881],["T_VARIABLE","$dedicated_table_schema",1881],";",["T_WHITESPACE","\n  ",1881],"}",["T_WHITESPACE","\n\n  ",1882],["T_DOC_COMMENT","\/**\n   * Gets the name to be used for the given entity index.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityTypeInterface $entity_type\n   *   The entity type.\n   * @param string $index\n   *   The index column name.\n   *\n   * @return string\n   *   The index name.\n   *\/",1884],["T_WHITESPACE","\n  ",1894],["T_PROTECTED","protected",1895],["T_WHITESPACE"," ",1895],["T_FUNCTION","function",1895],["T_WHITESPACE"," ",1895],["T_STRING","getEntityIndexName",1895],"(",["T_STRING","ContentEntityTypeInterface",1895],["T_WHITESPACE"," ",1895],["T_VARIABLE","$entity_type",1895],",",["T_WHITESPACE"," ",1895],["T_VARIABLE","$index",1895],")",["T_WHITESPACE"," ",1895],"{",["T_WHITESPACE","\n    ",1895],["T_RETURN","return",1896],["T_WHITESPACE"," ",1896],["T_VARIABLE","$entity_type",1896],["T_OBJECT_OPERATOR","->",1896],["T_STRING","id",1896],"(",")",["T_WHITESPACE"," ",1896],".",["T_WHITESPACE"," ",1896],["T_CONSTANT_ENCAPSED_STRING","'__'",1896],["T_WHITESPACE"," ",1896],".",["T_WHITESPACE"," ",1896],["T_VARIABLE","$index",1896],";",["T_WHITESPACE","\n  ",1896],"}",["T_WHITESPACE","\n\n  ",1897],["T_DOC_COMMENT","\/**\n   * Generates an index name for a field data table.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   * @param string $index\n   *   The name of the index.\n   *\n   * @return string\n   *   A string containing a generated index name for a field data table that is\n   *   unique among all other fields.\n   *\/",1899],["T_WHITESPACE","\n  ",1910],["T_PROTECTED","protected",1911],["T_WHITESPACE"," ",1911],["T_FUNCTION","function",1911],["T_WHITESPACE"," ",1911],["T_STRING","getFieldIndexName",1911],"(",["T_STRING","FieldStorageDefinitionInterface",1911],["T_WHITESPACE"," ",1911],["T_VARIABLE","$storage_definition",1911],",",["T_WHITESPACE"," ",1911],["T_VARIABLE","$index",1911],")",["T_WHITESPACE"," ",1911],"{",["T_WHITESPACE","\n    ",1911],["T_RETURN","return",1912],["T_WHITESPACE"," ",1912],["T_VARIABLE","$storage_definition",1912],["T_OBJECT_OPERATOR","->",1912],["T_STRING","getName",1912],"(",")",["T_WHITESPACE"," ",1912],".",["T_WHITESPACE"," ",1912],["T_CONSTANT_ENCAPSED_STRING","'_'",1912],["T_WHITESPACE"," ",1912],".",["T_WHITESPACE"," ",1912],["T_VARIABLE","$index",1912],";",["T_WHITESPACE","\n  ",1912],"}",["T_WHITESPACE","\n\n  ",1913],["T_DOC_COMMENT","\/**\n   * Checks whether a database table is non-existent or empty.\n   *\n   * Empty tables can be dropped and recreated without data loss.\n   *\n   * @param string $table_name\n   *   The database table to check.\n   *\n   * @return bool\n   *   TRUE if the table is empty, FALSE otherwise.\n   *\/",1915],["T_WHITESPACE","\n  ",1925],["T_PROTECTED","protected",1926],["T_WHITESPACE"," ",1926],["T_FUNCTION","function",1926],["T_WHITESPACE"," ",1926],["T_STRING","isTableEmpty",1926],"(",["T_VARIABLE","$table_name",1926],")",["T_WHITESPACE"," ",1926],"{",["T_WHITESPACE","\n    ",1926],["T_RETURN","return",1927],["T_WHITESPACE"," ",1927],"!",["T_VARIABLE","$this",1927],["T_OBJECT_OPERATOR","->",1927],["T_STRING","database",1927],["T_OBJECT_OPERATOR","->",1927],["T_STRING","schema",1927],"(",")",["T_OBJECT_OPERATOR","->",1927],["T_STRING","tableExists",1927],"(",["T_VARIABLE","$table_name",1927],")",["T_WHITESPACE"," ",1927],["T_BOOLEAN_OR","||",1927],["T_WHITESPACE","\n      ",1927],"!",["T_VARIABLE","$this",1928],["T_OBJECT_OPERATOR","->",1928],["T_STRING","database",1928],["T_OBJECT_OPERATOR","->",1928],["T_STRING","select",1928],"(",["T_VARIABLE","$table_name",1928],")",["T_WHITESPACE","\n        ",1928],["T_OBJECT_OPERATOR","->",1929],["T_STRING","countQuery",1929],"(",")",["T_WHITESPACE","\n        ",1929],["T_OBJECT_OPERATOR","->",1930],["T_STRING","range",1930],"(",["T_LNUMBER","0",1930],",",["T_WHITESPACE"," ",1930],["T_LNUMBER","1",1930],")",["T_WHITESPACE","\n        ",1930],["T_OBJECT_OPERATOR","->",1931],["T_STRING","execute",1931],"(",")",["T_WHITESPACE","\n        ",1931],["T_OBJECT_OPERATOR","->",1932],["T_STRING","fetchField",1932],"(",")",";",["T_WHITESPACE","\n  ",1932],"}",["T_WHITESPACE","\n\n  ",1933],["T_DOC_COMMENT","\/**\n   * Compares schemas to check for changes in the column definitions.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   Current field storage definition.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $original\n   *   The original field storage definition.\n   *\n   * @return bool\n   *   Returns TRUE if there are schema changes in the column definitions.\n   *\/",1935],["T_WHITESPACE","\n  ",1945],["T_PROTECTED","protected",1946],["T_WHITESPACE"," ",1946],["T_FUNCTION","function",1946],["T_WHITESPACE"," ",1946],["T_STRING","hasColumnChanges",1946],"(",["T_STRING","FieldStorageDefinitionInterface",1946],["T_WHITESPACE"," ",1946],["T_VARIABLE","$storage_definition",1946],",",["T_WHITESPACE"," ",1946],["T_STRING","FieldStorageDefinitionInterface",1946],["T_WHITESPACE"," ",1946],["T_VARIABLE","$original",1946],")",["T_WHITESPACE"," ",1946],"{",["T_WHITESPACE","\n    ",1946],["T_IF","if",1947],["T_WHITESPACE"," ",1947],"(",["T_VARIABLE","$storage_definition",1947],["T_OBJECT_OPERATOR","->",1947],["T_STRING","getColumns",1947],"(",")",["T_WHITESPACE"," ",1947],["T_IS_NOT_EQUAL","!=",1947],["T_WHITESPACE"," ",1947],["T_VARIABLE","$original",1947],["T_OBJECT_OPERATOR","->",1947],["T_STRING","getColumns",1947],"(",")",")",["T_WHITESPACE"," ",1947],"{",["T_WHITESPACE","\n      ",1947],["T_COMMENT","\/\/ Base field definitions have schema data stored in the original\n",1948],["T_WHITESPACE","      ",1949],["T_COMMENT","\/\/ definition.\n",1949],["T_WHITESPACE","      ",1950],["T_RETURN","return",1950],["T_WHITESPACE"," ",1950],["T_STRING","TRUE",1950],";",["T_WHITESPACE","\n    ",1950],"}",["T_WHITESPACE","\n\n    ",1951],["T_IF","if",1953],["T_WHITESPACE"," ",1953],"(","!",["T_VARIABLE","$storage_definition",1953],["T_OBJECT_OPERATOR","->",1953],["T_STRING","hasCustomStorage",1953],"(",")",")",["T_WHITESPACE"," ",1953],"{",["T_WHITESPACE","\n      ",1953],["T_VARIABLE","$keys",1954],["T_WHITESPACE"," ",1954],"=",["T_WHITESPACE"," ",1954],["T_STRING","array_flip",1954],"(",["T_VARIABLE","$this",1954],["T_OBJECT_OPERATOR","->",1954],["T_STRING","getColumnSchemaRelevantKeys",1954],"(",")",")",";",["T_WHITESPACE","\n      ",1954],["T_VARIABLE","$definition_schema",1955],["T_WHITESPACE"," ",1955],"=",["T_WHITESPACE"," ",1955],["T_VARIABLE","$this",1955],["T_OBJECT_OPERATOR","->",1955],["T_STRING","getSchemaFromStorageDefinition",1955],"(",["T_VARIABLE","$storage_definition",1955],")",";",["T_WHITESPACE","\n      ",1955],["T_FOREACH","foreach",1956],["T_WHITESPACE"," ",1956],"(",["T_VARIABLE","$this",1956],["T_OBJECT_OPERATOR","->",1956],["T_STRING","loadFieldSchemaData",1956],"(",["T_VARIABLE","$original",1956],")",["T_WHITESPACE"," ",1956],["T_AS","as",1956],["T_WHITESPACE"," ",1956],["T_VARIABLE","$table",1956],["T_WHITESPACE"," ",1956],["T_DOUBLE_ARROW","=>",1956],["T_WHITESPACE"," ",1956],["T_VARIABLE","$table_schema",1956],")",["T_WHITESPACE"," ",1956],"{",["T_WHITESPACE","\n        ",1956],["T_FOREACH","foreach",1957],["T_WHITESPACE"," ",1957],"(",["T_VARIABLE","$table_schema",1957],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1957],"]",["T_WHITESPACE"," ",1957],["T_AS","as",1957],["T_WHITESPACE"," ",1957],["T_VARIABLE","$name",1957],["T_WHITESPACE"," ",1957],["T_DOUBLE_ARROW","=>",1957],["T_WHITESPACE"," ",1957],["T_VARIABLE","$spec",1957],")",["T_WHITESPACE"," ",1957],"{",["T_WHITESPACE","\n          ",1957],["T_VARIABLE","$definition_spec",1958],["T_WHITESPACE"," ",1958],"=",["T_WHITESPACE"," ",1958],["T_STRING","array_intersect_key",1958],"(",["T_VARIABLE","$definition_schema",1958],"[",["T_VARIABLE","$table",1958],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fields'",1958],"]","[",["T_VARIABLE","$name",1958],"]",",",["T_WHITESPACE"," ",1958],["T_VARIABLE","$keys",1958],")",";",["T_WHITESPACE","\n          ",1958],["T_VARIABLE","$stored_spec",1959],["T_WHITESPACE"," ",1959],"=",["T_WHITESPACE"," ",1959],["T_STRING","array_intersect_key",1959],"(",["T_VARIABLE","$spec",1959],",",["T_WHITESPACE"," ",1959],["T_VARIABLE","$keys",1959],")",";",["T_WHITESPACE","\n          ",1959],["T_IF","if",1960],["T_WHITESPACE"," ",1960],"(",["T_VARIABLE","$definition_spec",1960],["T_WHITESPACE"," ",1960],["T_IS_NOT_EQUAL","!=",1960],["T_WHITESPACE"," ",1960],["T_VARIABLE","$stored_spec",1960],")",["T_WHITESPACE"," ",1960],"{",["T_WHITESPACE","\n            ",1960],["T_RETURN","return",1961],["T_WHITESPACE"," ",1961],["T_STRING","TRUE",1961],";",["T_WHITESPACE","\n          ",1961],"}",["T_WHITESPACE","\n        ",1962],"}",["T_WHITESPACE","\n      ",1963],"}",["T_WHITESPACE","\n    ",1964],"}",["T_WHITESPACE","\n\n    ",1965],["T_RETURN","return",1967],["T_WHITESPACE"," ",1967],["T_STRING","FALSE",1967],";",["T_WHITESPACE","\n  ",1967],"}",["T_WHITESPACE","\n\n  ",1968],["T_DOC_COMMENT","\/**\n   * Returns a list of column schema keys affecting data storage.\n   *\n   * When comparing schema definitions, only changes in certain properties\n   * actually affect how data is stored and thus, if applied, may imply data\n   * manipulation.\n   *\n   * @return string[]\n   *   An array of key names.\n   *\/",1970],["T_WHITESPACE","\n  ",1979],["T_PROTECTED","protected",1980],["T_WHITESPACE"," ",1980],["T_FUNCTION","function",1980],["T_WHITESPACE"," ",1980],["T_STRING","getColumnSchemaRelevantKeys",1980],"(",")",["T_WHITESPACE"," ",1980],"{",["T_WHITESPACE","\n    ",1980],["T_RETURN","return",1981],["T_WHITESPACE"," ",1981],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",1981],",",["T_WHITESPACE"," ",1981],["T_CONSTANT_ENCAPSED_STRING","'size'",1981],",",["T_WHITESPACE"," ",1981],["T_CONSTANT_ENCAPSED_STRING","'length'",1981],",",["T_WHITESPACE"," ",1981],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",1981],"]",";",["T_WHITESPACE","\n  ",1981],"}",["T_WHITESPACE","\n\n  ",1982],["T_DOC_COMMENT","\/**\n   * Creates an index, dropping it if already existing.\n   *\n   * @param string $table\n   *   The table name.\n   * @param string $name\n   *   The index name.\n   * @param array $specifier\n   *   The fields to index.\n   * @param array $schema\n   *   The table specification.\n   *\n   * @see \\Drupal\\Core\\Database\\Schema::addIndex()\n   *\/",1984],["T_WHITESPACE","\n  ",1997],["T_PROTECTED","protected",1998],["T_WHITESPACE"," ",1998],["T_FUNCTION","function",1998],["T_WHITESPACE"," ",1998],["T_STRING","addIndex",1998],"(",["T_VARIABLE","$table",1998],",",["T_WHITESPACE"," ",1998],["T_VARIABLE","$name",1998],",",["T_WHITESPACE"," ",1998],["T_ARRAY","array",1998],["T_WHITESPACE"," ",1998],["T_VARIABLE","$specifier",1998],",",["T_WHITESPACE"," ",1998],["T_ARRAY","array",1998],["T_WHITESPACE"," ",1998],["T_VARIABLE","$schema",1998],")",["T_WHITESPACE"," ",1998],"{",["T_WHITESPACE","\n    ",1998],["T_VARIABLE","$schema_handler",1999],["T_WHITESPACE"," ",1999],"=",["T_WHITESPACE"," ",1999],["T_VARIABLE","$this",1999],["T_OBJECT_OPERATOR","->",1999],["T_STRING","database",1999],["T_OBJECT_OPERATOR","->",1999],["T_STRING","schema",1999],"(",")",";",["T_WHITESPACE","\n    ",1999],["T_VARIABLE","$schema_handler",2000],["T_OBJECT_OPERATOR","->",2000],["T_STRING","dropIndex",2000],"(",["T_VARIABLE","$table",2000],",",["T_WHITESPACE"," ",2000],["T_VARIABLE","$name",2000],")",";",["T_WHITESPACE","\n    ",2000],["T_VARIABLE","$schema_handler",2001],["T_OBJECT_OPERATOR","->",2001],["T_STRING","addIndex",2001],"(",["T_VARIABLE","$table",2001],",",["T_WHITESPACE"," ",2001],["T_VARIABLE","$name",2001],",",["T_WHITESPACE"," ",2001],["T_VARIABLE","$specifier",2001],",",["T_WHITESPACE"," ",2001],["T_VARIABLE","$schema",2001],")",";",["T_WHITESPACE","\n  ",2001],"}",["T_WHITESPACE","\n\n  ",2002],["T_DOC_COMMENT","\/**\n   * Creates a unique key, dropping it if already existing.\n   *\n   * @param string $table\n   *   The table name.\n   * @param string $name\n   *   The index name.\n   * @param array $specifier\n   *   The unique fields.\n   *\n   * @see \\Drupal\\Core\\Database\\Schema::addUniqueKey()\n   *\/",2004],["T_WHITESPACE","\n  ",2015],["T_PROTECTED","protected",2016],["T_WHITESPACE"," ",2016],["T_FUNCTION","function",2016],["T_WHITESPACE"," ",2016],["T_STRING","addUniqueKey",2016],"(",["T_VARIABLE","$table",2016],",",["T_WHITESPACE"," ",2016],["T_VARIABLE","$name",2016],",",["T_WHITESPACE"," ",2016],["T_ARRAY","array",2016],["T_WHITESPACE"," ",2016],["T_VARIABLE","$specifier",2016],")",["T_WHITESPACE"," ",2016],"{",["T_WHITESPACE","\n    ",2016],["T_VARIABLE","$schema_handler",2017],["T_WHITESPACE"," ",2017],"=",["T_WHITESPACE"," ",2017],["T_VARIABLE","$this",2017],["T_OBJECT_OPERATOR","->",2017],["T_STRING","database",2017],["T_OBJECT_OPERATOR","->",2017],["T_STRING","schema",2017],"(",")",";",["T_WHITESPACE","\n    ",2017],["T_VARIABLE","$schema_handler",2018],["T_OBJECT_OPERATOR","->",2018],["T_STRING","dropUniqueKey",2018],"(",["T_VARIABLE","$table",2018],",",["T_WHITESPACE"," ",2018],["T_VARIABLE","$name",2018],")",";",["T_WHITESPACE","\n    ",2018],["T_VARIABLE","$schema_handler",2019],["T_OBJECT_OPERATOR","->",2019],["T_STRING","addUniqueKey",2019],"(",["T_VARIABLE","$table",2019],",",["T_WHITESPACE"," ",2019],["T_VARIABLE","$name",2019],",",["T_WHITESPACE"," ",2019],["T_VARIABLE","$specifier",2019],")",";",["T_WHITESPACE","\n  ",2019],"}",["T_WHITESPACE","\n\n",2020],"}",["T_WHITESPACE","\n",2022]]