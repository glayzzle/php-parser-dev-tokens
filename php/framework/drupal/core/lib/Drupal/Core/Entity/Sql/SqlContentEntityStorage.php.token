[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Sql",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Cache",5],["T_NS_SEPARATOR","\\",5],["T_STRING","CacheBackendInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Connection",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Database",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DatabaseExceptionWrapper",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Database",9],["T_NS_SEPARATOR","\\",9],["T_STRING","SchemaException",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Entity",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ContentEntityInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Entity",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ContentEntityStorageBase",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Drupal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Core",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Entity",12],["T_NS_SEPARATOR","\\",12],["T_STRING","EntityBundleListenerInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Drupal",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Core",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Entity",13],["T_NS_SEPARATOR","\\",13],["T_STRING","EntityInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Drupal",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Core",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Entity",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EntityManagerInterface",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Drupal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Core",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Entity",15],["T_NS_SEPARATOR","\\",15],["T_STRING","EntityStorageException",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Drupal",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Core",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Entity",16],["T_NS_SEPARATOR","\\",16],["T_STRING","EntityTypeInterface",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Drupal",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Core",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Entity",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Query",17],["T_NS_SEPARATOR","\\",17],["T_STRING","QueryInterface",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Drupal",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Core",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Entity",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Schema",18],["T_NS_SEPARATOR","\\",18],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Drupal",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Core",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Field",19],["T_NS_SEPARATOR","\\",19],["T_STRING","FieldDefinitionInterface",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Drupal",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Core",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Field",20],["T_NS_SEPARATOR","\\",20],["T_STRING","FieldStorageDefinitionInterface",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Drupal",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Core",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Language",21],["T_NS_SEPARATOR","\\",21],["T_STRING","LanguageInterface",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Drupal",22],["T_NS_SEPARATOR","\\",22],["T_STRING","field",22],["T_NS_SEPARATOR","\\",22],["T_STRING","FieldStorageConfigInterface",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Drupal",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Core",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Language",23],["T_NS_SEPARATOR","\\",23],["T_STRING","LanguageManagerInterface",23],";",["T_WHITESPACE","\n",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","Symfony",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Component",24],["T_NS_SEPARATOR","\\",24],["T_STRING","DependencyInjection",24],["T_NS_SEPARATOR","\\",24],["T_STRING","ContainerInterface",24],";",["T_WHITESPACE","\n\n",24],["T_DOC_COMMENT","\/**\n * A content entity database storage implementation.\n *\n * This class can be used as-is by most content entity types. Entity types\n * requiring special handling can extend the class.\n *\n * The class uses \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema\n * internally in order to automatically generate the database schema based on\n * the defined base fields. Entity types can override the schema handler to\n * customize the generated schema; e.g., to add additional indexes.\n *\n * @ingroup entity_api\n *\/",26],["T_WHITESPACE","\n",38],["T_CLASS","class",39],["T_WHITESPACE"," ",39],["T_STRING","SqlContentEntityStorage",39],["T_WHITESPACE"," ",39],["T_EXTENDS","extends",39],["T_WHITESPACE"," ",39],["T_STRING","ContentEntityStorageBase",39],["T_WHITESPACE"," ",39],["T_IMPLEMENTS","implements",39],["T_WHITESPACE"," ",39],["T_STRING","SqlEntityStorageInterface",39],",",["T_WHITESPACE"," ",39],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",39],",",["T_WHITESPACE"," ",39],["T_STRING","EntityBundleListenerInterface",39],["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * The mapping of field columns to SQL tables.\n   *\n   * @var \\Drupal\\Core\\Entity\\Sql\\TableMappingInterface\n   *\/",41],["T_WHITESPACE","\n  ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$tableMapping",46],";",["T_WHITESPACE","\n\n  ",46],["T_DOC_COMMENT","\/**\n   * Name of entity's revision database table field, if it supports revisions.\n   *\n   * Has the value FALSE if this entity does not use revisions.\n   *\n   * @var string\n   *\/",48],["T_WHITESPACE","\n  ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$revisionKey",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","FALSE",55],";",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * The entity langcode key.\n   *\n   * @var string|bool\n   *\/",57],["T_WHITESPACE","\n  ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$langcodeKey",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","FALSE",62],";",["T_WHITESPACE","\n\n  ",62],["T_DOC_COMMENT","\/**\n   * The default language entity key.\n   *\n   * @var string\n   *\/",64],["T_WHITESPACE","\n  ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$defaultLangcodeKey",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","FALSE",69],";",["T_WHITESPACE","\n\n  ",69],["T_DOC_COMMENT","\/**\n   * The base table of the entity.\n   *\n   * @var string\n   *\/",71],["T_WHITESPACE","\n  ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$baseTable",76],";",["T_WHITESPACE","\n\n  ",76],["T_DOC_COMMENT","\/**\n   * The table that stores revisions, if the entity supports revisions.\n   *\n   * @var string\n   *\/",78],["T_WHITESPACE","\n  ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$revisionTable",83],";",["T_WHITESPACE","\n\n  ",83],["T_DOC_COMMENT","\/**\n   * The table that stores properties, if the entity has multilingual support.\n   *\n   * @var string\n   *\/",85],["T_WHITESPACE","\n  ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$dataTable",90],";",["T_WHITESPACE","\n\n  ",90],["T_DOC_COMMENT","\/**\n   * The table that stores revision field data if the entity supports revisions.\n   *\n   * @var string\n   *\/",92],["T_WHITESPACE","\n  ",96],["T_PROTECTED","protected",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$revisionDataTable",97],";",["T_WHITESPACE","\n\n  ",97],["T_DOC_COMMENT","\/**\n   * Active database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",99],["T_WHITESPACE","\n  ",103],["T_PROTECTED","protected",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$database",104],";",["T_WHITESPACE","\n\n  ",104],["T_DOC_COMMENT","\/**\n   * The entity type's storage schema object.\n   *\n   * @var \\Drupal\\Core\\Entity\\Schema\\EntityStorageSchemaInterface\n   *\/",106],["T_WHITESPACE","\n  ",110],["T_PROTECTED","protected",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$storageSchema",111],";",["T_WHITESPACE","\n\n  ",111],["T_DOC_COMMENT","\/**\n   * The language manager.\n   *\n   * @var \\Drupal\\Core\\Language\\LanguageManagerInterface\n   *\/",113],["T_WHITESPACE","\n  ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$languageManager",118],";",["T_WHITESPACE","\n\n  ",118],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",120],["T_WHITESPACE","\n  ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_STATIC","static",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","createInstance",123],"(",["T_STRING","ContainerInterface",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$container",123],",",["T_WHITESPACE"," ",123],["T_STRING","EntityTypeInterface",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$entity_type",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n    ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_NEW","new",124],["T_WHITESPACE"," ",124],["T_STATIC","static",124],"(",["T_WHITESPACE","\n      ",124],["T_VARIABLE","$entity_type",125],",",["T_WHITESPACE","\n      ",125],["T_VARIABLE","$container",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","get",126],"(",["T_CONSTANT_ENCAPSED_STRING","'database'",126],")",",",["T_WHITESPACE","\n      ",126],["T_VARIABLE","$container",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","get",127],"(",["T_CONSTANT_ENCAPSED_STRING","'entity.manager'",127],")",",",["T_WHITESPACE","\n      ",127],["T_VARIABLE","$container",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","get",128],"(",["T_CONSTANT_ENCAPSED_STRING","'cache.entity'",128],")",",",["T_WHITESPACE","\n      ",128],["T_VARIABLE","$container",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","get",129],"(",["T_CONSTANT_ENCAPSED_STRING","'language_manager'",129],")",["T_WHITESPACE","\n    ",129],")",";",["T_WHITESPACE","\n  ",130],"}",["T_WHITESPACE","\n\n  ",131],["T_DOC_COMMENT","\/**\n   * Gets the base field definitions for a content entity type.\n   *\n   * @return \\Drupal\\Core\\Field\\FieldDefinitionInterface[]\n   *   The array of base field definitions for the entity type, keyed by field\n   *   name.\n   *\/",133],["T_WHITESPACE","\n  ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","getFieldStorageDefinitions",140],"(",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n    ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","entityManager",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getBaseFieldDefinitions",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","entityTypeId",141],")",";",["T_WHITESPACE","\n  ",141],"}",["T_WHITESPACE","\n\n  ",142],["T_DOC_COMMENT","\/**\n   * Constructs a SqlContentEntityStorage object.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The entity type definition.\n   * @param \\Drupal\\Core\\Database\\Connection $database\n   *   The database connection to be used.\n   * @param \\Drupal\\Core\\Entity\\EntityManagerInterface $entity_manager\n   *   The entity manager.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache\n   *   The cache backend to be used.\n   * @param \\Drupal\\Core\\Language\\LanguageManagerInterface $language_manager\n   *   The language manager.\n   *\/",144],["T_WHITESPACE","\n  ",157],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","__construct",158],"(",["T_STRING","EntityTypeInterface",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$entity_type",158],",",["T_WHITESPACE"," ",158],["T_STRING","Connection",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$database",158],",",["T_WHITESPACE"," ",158],["T_STRING","EntityManagerInterface",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$entity_manager",158],",",["T_WHITESPACE"," ",158],["T_STRING","CacheBackendInterface",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$cache",158],",",["T_WHITESPACE"," ",158],["T_STRING","LanguageManagerInterface",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$language_manager",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n    ",158],["T_STRING","parent",159],["T_DOUBLE_COLON","::",159],["T_STRING","__construct",159],"(",["T_VARIABLE","$entity_type",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$entity_manager",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$cache",159],")",";",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","database",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$database",160],";",["T_WHITESPACE","\n    ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","languageManager",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$language_manager",161],";",["T_WHITESPACE","\n    ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","initTableLayout",162],"(",")",";",["T_WHITESPACE","\n  ",162],"}",["T_WHITESPACE","\n\n  ",163],["T_DOC_COMMENT","\/**\n   * Initializes table name variables.\n   *\/",165],["T_WHITESPACE","\n  ",167],["T_PROTECTED","protected",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","initTableLayout",168],"(",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n    ",168],["T_COMMENT","\/\/ Reset table field values to ensure changes in the entity type definition\n",169],["T_WHITESPACE","    ",170],["T_COMMENT","\/\/ are correctly reflected in the table layout.\n",170],["T_WHITESPACE","    ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","tableMapping",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_STRING","NULL",171],";",["T_WHITESPACE","\n    ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","revisionKey",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","NULL",172],";",["T_WHITESPACE","\n    ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","revisionTable",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","NULL",173],";",["T_WHITESPACE","\n    ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","dataTable",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","NULL",174],";",["T_WHITESPACE","\n    ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","revisionDataTable",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_STRING","NULL",175],";",["T_WHITESPACE","\n\n    ",175],["T_COMMENT","\/\/ @todo Remove table names from the entity type definition in\n",177],["T_WHITESPACE","    ",178],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2232465.\n",178],["T_WHITESPACE","    ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","baseTable",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","entityType",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getBaseTable",179],"(",")",["T_WHITESPACE"," ",179],"?",":",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","entityTypeId",179],";",["T_WHITESPACE","\n    ",179],["T_VARIABLE","$revisionable",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","entityType",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","isRevisionable",180],"(",")",";",["T_WHITESPACE","\n    ",180],["T_IF","if",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$revisionable",181],")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n      ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","revisionKey",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","entityType",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getKey",182],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",182],")",["T_WHITESPACE"," ",182],"?",":",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",182],";",["T_WHITESPACE","\n      ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","revisionTable",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","entityType",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getRevisionTable",183],"(",")",["T_WHITESPACE"," ",183],"?",":",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","entityTypeId",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'_revision'",183],";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n    ",184],["T_VARIABLE","$translatable",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","entityType",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","isTranslatable",185],"(",")",";",["T_WHITESPACE","\n    ",185],["T_IF","if",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$translatable",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n      ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","dataTable",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","entityType",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getDataTable",187],"(",")",["T_WHITESPACE"," ",187],"?",":",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","entityTypeId",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'_field_data'",187],";",["T_WHITESPACE","\n      ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","langcodeKey",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","entityType",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getKey",188],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",188],")",";",["T_WHITESPACE","\n      ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","defaultLangcodeKey",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","entityType",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getKey",189],"(",["T_CONSTANT_ENCAPSED_STRING","'default_langcode'",189],")",";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n    ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$revisionable",191],["T_WHITESPACE"," ",191],["T_BOOLEAN_AND","&&",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$translatable",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n      ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","revisionDataTable",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","entityType",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getRevisionDataTable",192],"(",")",["T_WHITESPACE"," ",192],"?",":",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","entityTypeId",192],["T_WHITESPACE"," ",192],".",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'_field_revision'",192],";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n  ",193],"}",["T_WHITESPACE","\n\n  ",194],["T_DOC_COMMENT","\/**\n   * Gets the base table name.\n   *\n   * @return string\n   *   The table name.\n   *\/",196],["T_WHITESPACE","\n  ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","getBaseTable",202],"(",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n    ",202],["T_RETURN","return",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","baseTable",203],";",["T_WHITESPACE","\n  ",203],"}",["T_WHITESPACE","\n\n  ",204],["T_DOC_COMMENT","\/**\n   * Gets the revision table name.\n   *\n   * @return string|false\n   *   The table name or FALSE if it is not available.\n   *\/",206],["T_WHITESPACE","\n  ",211],["T_PUBLIC","public",212],["T_WHITESPACE"," ",212],["T_FUNCTION","function",212],["T_WHITESPACE"," ",212],["T_STRING","getRevisionTable",212],"(",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n    ",212],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","revisionTable",213],";",["T_WHITESPACE","\n  ",213],"}",["T_WHITESPACE","\n\n  ",214],["T_DOC_COMMENT","\/**\n   * Gets the data table name.\n   *\n   * @return string|false\n   *   The table name or FALSE if it is not available.\n   *\/",216],["T_WHITESPACE","\n  ",221],["T_PUBLIC","public",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","getDataTable",222],"(",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n    ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","dataTable",223],";",["T_WHITESPACE","\n  ",223],"}",["T_WHITESPACE","\n\n  ",224],["T_DOC_COMMENT","\/**\n   * Gets the revision data table name.\n   *\n   * @return string|false\n   *   The table name or FALSE if it is not available.\n   *\/",226],["T_WHITESPACE","\n  ",231],["T_PUBLIC","public",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","getRevisionDataTable",232],"(",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n    ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","revisionDataTable",233],";",["T_WHITESPACE","\n  ",233],"}",["T_WHITESPACE","\n\n  ",234],["T_DOC_COMMENT","\/**\n   * Gets the entity type's storage schema object.\n   *\n   * @return \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema\n   *   The schema object.\n   *\/",236],["T_WHITESPACE","\n  ",241],["T_PROTECTED","protected",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","getStorageSchema",242],"(",")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n    ",242],["T_IF","if",243],["T_WHITESPACE"," ",243],"(","!",["T_ISSET","isset",243],"(",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","storageSchema",243],")",")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n      ",243],["T_VARIABLE","$class",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","entityType",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getHandlerClass",244],"(",["T_CONSTANT_ENCAPSED_STRING","'storage_schema'",244],")",["T_WHITESPACE"," ",244],"?",":",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema'",244],";",["T_WHITESPACE","\n      ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","storageSchema",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_NEW","new",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$class",245],"(",["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","entityManager",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","entityType",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","database",245],")",";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n    ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","storageSchema",247],";",["T_WHITESPACE","\n  ",247],"}",["T_WHITESPACE","\n\n  ",248],["T_DOC_COMMENT","\/**\n   * Updates the wrapped entity type definition.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The update entity type.\n   *\n   * @internal Only to be used internally by Entity API. Expected to be\n   *   removed by https:\/\/www.drupal.org\/node\/2274017.\n   *\/",250],["T_WHITESPACE","\n  ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","setEntityType",259],"(",["T_STRING","EntityTypeInterface",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$entity_type",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n    ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","entityType",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","id",260],"(",")",["T_WHITESPACE"," ",260],["T_IS_EQUAL","==",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$entity_type",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","id",260],"(",")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n      ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","entityType",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$entity_type",261],";",["T_WHITESPACE","\n      ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","initTableLayout",262],"(",")",";",["T_WHITESPACE","\n    ",262],"}",["T_WHITESPACE","\n    ",263],["T_ELSE","else",264],["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n      ",264],["T_THROW","throw",265],["T_WHITESPACE"," ",265],["T_NEW","new",265],["T_WHITESPACE"," ",265],["T_STRING","EntityStorageException",265],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Unsupported entity type ",265],["T_CURLY_OPEN","{",265],["T_VARIABLE","$entity_type",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","id",265],"(",")","}","\"",")",";",["T_WHITESPACE","\n    ",265],"}",["T_WHITESPACE","\n  ",266],"}",["T_WHITESPACE","\n\n  ",267],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",269],["T_WHITESPACE","\n  ",271],["T_PUBLIC","public",272],["T_WHITESPACE"," ",272],["T_FUNCTION","function",272],["T_WHITESPACE"," ",272],["T_STRING","getTableMapping",272],"(",["T_ARRAY","array",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$storage_definitions",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","NULL",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n    ",272],["T_VARIABLE","$table_mapping",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","tableMapping",273],";",["T_WHITESPACE","\n\n    ",273],["T_COMMENT","\/\/ If we are using our internal storage definitions, which is our main use\n",275],["T_WHITESPACE","    ",276],["T_COMMENT","\/\/ case, we can statically cache the computed table mapping. If a new set\n",276],["T_WHITESPACE","    ",277],["T_COMMENT","\/\/ of field storage definitions is passed, for instance when comparing old\n",277],["T_WHITESPACE","    ",278],["T_COMMENT","\/\/ and new storage schema, we compute the table mapping without caching.\n",278],["T_WHITESPACE","    ",279],["T_COMMENT","\/\/ @todo Clean-up this in https:\/\/www.drupal.org\/node\/2274017 so we can\n",279],["T_WHITESPACE","    ",280],["T_COMMENT","\/\/   easily instantiate a new table mapping whenever needed.\n",280],["T_WHITESPACE","    ",281],["T_IF","if",281],["T_WHITESPACE"," ",281],"(","!",["T_ISSET","isset",281],"(",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","tableMapping",281],")",["T_WHITESPACE"," ",281],["T_BOOLEAN_OR","||",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$storage_definitions",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n      ",281],["T_VARIABLE","$definitions",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$storage_definitions",282],["T_WHITESPACE"," ",282],"?",":",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","entityManager",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getFieldStorageDefinitions",282],"(",["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","entityTypeId",282],")",";",["T_WHITESPACE","\n      ",282],["T_VARIABLE","$table_mapping",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_NEW","new",283],["T_WHITESPACE"," ",283],["T_STRING","DefaultTableMapping",283],"(",["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","entityType",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$definitions",283],")",";",["T_WHITESPACE","\n\n      ",283],["T_VARIABLE","$shared_table_definitions",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","array_filter",285],"(",["T_VARIABLE","$definitions",285],",",["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],"(",["T_STRING","FieldStorageDefinitionInterface",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$definition",285],")",["T_WHITESPACE"," ",285],["T_USE","use",285],["T_WHITESPACE"," ",285],"(",["T_VARIABLE","$table_mapping",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n        ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$table_mapping",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","allowsSharedTableStorage",286],"(",["T_VARIABLE","$definition",286],")",";",["T_WHITESPACE","\n      ",286],"}",")",";",["T_WHITESPACE","\n\n      ",287],["T_VARIABLE","$key_fields",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","array_values",289],"(",["T_STRING","array_filter",289],"(",["T_ARRAY","array",289],"(",["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","idKey",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","revisionKey",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","bundleKey",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","uuidKey",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","langcodeKey",289],")",")",")",";",["T_WHITESPACE","\n      ",289],["T_VARIABLE","$all_fields",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","array_keys",290],"(",["T_VARIABLE","$shared_table_definitions",290],")",";",["T_WHITESPACE","\n      ",290],["T_VARIABLE","$revisionable_fields",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_STRING","array_keys",291],"(",["T_STRING","array_filter",291],"(",["T_VARIABLE","$shared_table_definitions",291],",",["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],"(",["T_STRING","FieldStorageDefinitionInterface",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$definition",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n        ",291],["T_RETURN","return",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$definition",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","isRevisionable",292],"(",")",";",["T_WHITESPACE","\n      ",292],"}",")",")",";",["T_WHITESPACE","\n      ",293],["T_COMMENT","\/\/ Make sure the key fields come first in the list of fields.\n",294],["T_WHITESPACE","      ",295],["T_VARIABLE","$all_fields",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_STRING","array_merge",295],"(",["T_VARIABLE","$key_fields",295],",",["T_WHITESPACE"," ",295],["T_STRING","array_diff",295],"(",["T_VARIABLE","$all_fields",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$key_fields",295],")",")",";",["T_WHITESPACE","\n\n      ",295],["T_COMMENT","\/\/ Nodes have all three of these fields, while custom blocks only have\n",297],["T_WHITESPACE","      ",298],["T_COMMENT","\/\/ log.\n",298],["T_WHITESPACE","      ",299],["T_COMMENT","\/\/ @todo Provide automatic definitions for revision metadata fields in\n",299],["T_WHITESPACE","      ",300],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2248983.\n",300],["T_WHITESPACE","      ",301],["T_VARIABLE","$revision_metadata_fields",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_STRING","array_intersect",301],"(",["T_ARRAY","array",301],"(",["T_WHITESPACE","\n        ",301],["T_CONSTANT_ENCAPSED_STRING","'revision_timestamp'",302],",",["T_WHITESPACE","\n        ",302],["T_CONSTANT_ENCAPSED_STRING","'revision_uid'",303],",",["T_WHITESPACE","\n        ",303],["T_CONSTANT_ENCAPSED_STRING","'revision_log'",304],",",["T_WHITESPACE","\n      ",304],")",",",["T_WHITESPACE"," ",305],["T_VARIABLE","$all_fields",305],")",";",["T_WHITESPACE","\n\n      ",305],["T_VARIABLE","$revisionable",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","entityType",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","isRevisionable",307],"(",")",";",["T_WHITESPACE","\n      ",307],["T_VARIABLE","$translatable",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","entityType",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","isTranslatable",308],"(",")",";",["T_WHITESPACE","\n      ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(","!",["T_VARIABLE","$revisionable",309],["T_WHITESPACE"," ",309],["T_BOOLEAN_AND","&&",309],["T_WHITESPACE"," ",309],"!",["T_VARIABLE","$translatable",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n        ",309],["T_COMMENT","\/\/ The base layout stores all the base field values in the base table.\n",310],["T_WHITESPACE","        ",311],["T_VARIABLE","$table_mapping",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setFieldNames",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","baseTable",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$all_fields",311],")",";",["T_WHITESPACE","\n      ",311],"}",["T_WHITESPACE","\n      ",312],["T_ELSEIF","elseif",313],["T_WHITESPACE"," ",313],"(",["T_VARIABLE","$revisionable",313],["T_WHITESPACE"," ",313],["T_BOOLEAN_AND","&&",313],["T_WHITESPACE"," ",313],"!",["T_VARIABLE","$translatable",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n        ",313],["T_COMMENT","\/\/ The revisionable layout stores all the base field values in the base\n",314],["T_WHITESPACE","        ",315],["T_COMMENT","\/\/ table, except for revision metadata fields. Revisionable fields\n",315],["T_WHITESPACE","        ",316],["T_COMMENT","\/\/ denormalized in the base table but also stored in the revision table\n",316],["T_WHITESPACE","        ",317],["T_COMMENT","\/\/ together with the entity ID and the revision ID as identifiers.\n",317],["T_WHITESPACE","        ",318],["T_VARIABLE","$table_mapping",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","setFieldNames",318],"(",["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","baseTable",318],",",["T_WHITESPACE"," ",318],["T_STRING","array_diff",318],"(",["T_VARIABLE","$all_fields",318],",",["T_WHITESPACE"," ",318],["T_VARIABLE","$revision_metadata_fields",318],")",")",";",["T_WHITESPACE","\n        ",318],["T_VARIABLE","$revision_key_fields",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_ARRAY","array",319],"(",["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","idKey",319],",",["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","revisionKey",319],")",";",["T_WHITESPACE","\n        ",319],["T_VARIABLE","$table_mapping",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","setFieldNames",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","revisionTable",320],",",["T_WHITESPACE"," ",320],["T_STRING","array_merge",320],"(",["T_VARIABLE","$revision_key_fields",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$revisionable_fields",320],")",")",";",["T_WHITESPACE","\n      ",320],"}",["T_WHITESPACE","\n      ",321],["T_ELSEIF","elseif",322],["T_WHITESPACE"," ",322],"(","!",["T_VARIABLE","$revisionable",322],["T_WHITESPACE"," ",322],["T_BOOLEAN_AND","&&",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$translatable",322],")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n        ",322],["T_COMMENT","\/\/ Multilingual layouts store key field values in the base table. The\n",323],["T_WHITESPACE","        ",324],["T_COMMENT","\/\/ other base field values are stored in the data table, no matter\n",324],["T_WHITESPACE","        ",325],["T_COMMENT","\/\/ whether they are translatable or not. The data table holds also a\n",325],["T_WHITESPACE","        ",326],["T_COMMENT","\/\/ denormalized copy of the bundle field value to allow for more\n",326],["T_WHITESPACE","        ",327],["T_COMMENT","\/\/ performant queries. This means that only the UUID is not stored on\n",327],["T_WHITESPACE","        ",328],["T_COMMENT","\/\/ the data table.\n",328],["T_WHITESPACE","        ",329],["T_VARIABLE","$table_mapping",329],["T_WHITESPACE","\n          ",329],["T_OBJECT_OPERATOR","->",330],["T_STRING","setFieldNames",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","baseTable",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$key_fields",330],")",["T_WHITESPACE","\n          ",330],["T_OBJECT_OPERATOR","->",331],["T_STRING","setFieldNames",331],"(",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","dataTable",331],",",["T_WHITESPACE"," ",331],["T_STRING","array_values",331],"(",["T_STRING","array_diff",331],"(",["T_VARIABLE","$all_fields",331],",",["T_WHITESPACE"," ",331],["T_ARRAY","array",331],"(",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","uuidKey",331],")",")",")",")",";",["T_WHITESPACE","\n      ",331],"}",["T_WHITESPACE","\n      ",332],["T_ELSEIF","elseif",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$revisionable",333],["T_WHITESPACE"," ",333],["T_BOOLEAN_AND","&&",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$translatable",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n        ",333],["T_COMMENT","\/\/ The revisionable multilingual layout stores key field values in the\n",334],["T_WHITESPACE","        ",335],["T_COMMENT","\/\/ base table, except for language, which is stored in the revision\n",335],["T_WHITESPACE","        ",336],["T_COMMENT","\/\/ table along with revision metadata. The revision data table holds\n",336],["T_WHITESPACE","        ",337],["T_COMMENT","\/\/ data field values for all the revisionable fields and the data table\n",337],["T_WHITESPACE","        ",338],["T_COMMENT","\/\/ holds the data field values for all non-revisionable fields. The data\n",338],["T_WHITESPACE","        ",339],["T_COMMENT","\/\/ field values of revisionable fields are denormalized in the data\n",339],["T_WHITESPACE","        ",340],["T_COMMENT","\/\/ table, as well.\n",340],["T_WHITESPACE","        ",341],["T_VARIABLE","$table_mapping",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","setFieldNames",341],"(",["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","baseTable",341],",",["T_WHITESPACE"," ",341],["T_STRING","array_values",341],"(",["T_VARIABLE","$key_fields",341],")",")",";",["T_WHITESPACE","\n\n        ",341],["T_COMMENT","\/\/ Like in the multilingual, non-revisionable case the UUID is not\n",343],["T_WHITESPACE","        ",344],["T_COMMENT","\/\/ in the data table. Additionally, do not store revision metadata\n",344],["T_WHITESPACE","        ",345],["T_COMMENT","\/\/ fields in the data table.\n",345],["T_WHITESPACE","        ",346],["T_VARIABLE","$data_fields",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_STRING","array_values",346],"(",["T_STRING","array_diff",346],"(",["T_VARIABLE","$all_fields",346],",",["T_WHITESPACE"," ",346],["T_ARRAY","array",346],"(",["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","uuidKey",346],")",",",["T_WHITESPACE"," ",346],["T_VARIABLE","$revision_metadata_fields",346],")",")",";",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$table_mapping",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","setFieldNames",347],"(",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","dataTable",347],",",["T_WHITESPACE"," ",347],["T_VARIABLE","$data_fields",347],")",";",["T_WHITESPACE","\n\n        ",347],["T_VARIABLE","$revision_base_fields",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","array_merge",349],"(",["T_ARRAY","array",349],"(",["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","idKey",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","revisionKey",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","langcodeKey",349],")",",",["T_WHITESPACE"," ",349],["T_VARIABLE","$revision_metadata_fields",349],")",";",["T_WHITESPACE","\n        ",349],["T_VARIABLE","$table_mapping",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","setFieldNames",350],"(",["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","revisionTable",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$revision_base_fields",350],")",";",["T_WHITESPACE","\n\n        ",350],["T_VARIABLE","$revision_data_key_fields",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_ARRAY","array",352],"(",["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","idKey",352],",",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","revisionKey",352],",",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","langcodeKey",352],")",";",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$revision_data_fields",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_STRING","array_diff",353],"(",["T_VARIABLE","$revisionable_fields",353],",",["T_WHITESPACE"," ",353],["T_VARIABLE","$revision_metadata_fields",353],",",["T_WHITESPACE"," ",353],["T_ARRAY","array",353],"(",["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","langcodeKey",353],")",")",";",["T_WHITESPACE","\n        ",353],["T_VARIABLE","$table_mapping",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","setFieldNames",354],"(",["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","revisionDataTable",354],",",["T_WHITESPACE"," ",354],["T_STRING","array_merge",354],"(",["T_VARIABLE","$revision_data_key_fields",354],",",["T_WHITESPACE"," ",354],["T_VARIABLE","$revision_data_fields",354],")",")",";",["T_WHITESPACE","\n      ",354],"}",["T_WHITESPACE","\n\n      ",355],["T_COMMENT","\/\/ Add dedicated tables.\n",357],["T_WHITESPACE","      ",358],["T_VARIABLE","$dedicated_table_definitions",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_STRING","array_filter",358],"(",["T_VARIABLE","$definitions",358],",",["T_WHITESPACE"," ",358],["T_FUNCTION","function",358],["T_WHITESPACE"," ",358],"(",["T_STRING","FieldStorageDefinitionInterface",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$definition",358],")",["T_WHITESPACE"," ",358],["T_USE","use",358],["T_WHITESPACE"," ",358],"(",["T_VARIABLE","$table_mapping",358],")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n        ",358],["T_RETURN","return",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$table_mapping",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","requiresDedicatedTableStorage",359],"(",["T_VARIABLE","$definition",359],")",";",["T_WHITESPACE","\n      ",359],"}",")",";",["T_WHITESPACE","\n      ",360],["T_VARIABLE","$extra_columns",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_ARRAY","array",361],"(",["T_WHITESPACE","\n        ",361],["T_CONSTANT_ENCAPSED_STRING","'bundle'",362],",",["T_WHITESPACE","\n        ",362],["T_CONSTANT_ENCAPSED_STRING","'deleted'",363],",",["T_WHITESPACE","\n        ",363],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",364],",",["T_WHITESPACE","\n        ",364],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",365],",",["T_WHITESPACE","\n        ",365],["T_CONSTANT_ENCAPSED_STRING","'langcode'",366],",",["T_WHITESPACE","\n        ",366],["T_CONSTANT_ENCAPSED_STRING","'delta'",367],",",["T_WHITESPACE","\n      ",367],")",";",["T_WHITESPACE","\n      ",368],["T_FOREACH","foreach",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$dedicated_table_definitions",369],["T_WHITESPACE"," ",369],["T_AS","as",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$field_name",369],["T_WHITESPACE"," ",369],["T_DOUBLE_ARROW","=>",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$definition",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$tables",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],"[",["T_VARIABLE","$table_mapping",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getDedicatedDataTableName",370],"(",["T_VARIABLE","$definition",370],")","]",";",["T_WHITESPACE","\n        ",370],["T_IF","if",371],["T_WHITESPACE"," ",371],"(",["T_VARIABLE","$revisionable",371],["T_WHITESPACE"," ",371],["T_BOOLEAN_AND","&&",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$definition",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","isRevisionable",371],"(",")",")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n          ",371],["T_VARIABLE","$tables",372],"[","]",["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_VARIABLE","$table_mapping",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getDedicatedRevisionTableName",372],"(",["T_VARIABLE","$definition",372],")",";",["T_WHITESPACE","\n        ",372],"}",["T_WHITESPACE","\n        ",373],["T_FOREACH","foreach",374],["T_WHITESPACE"," ",374],"(",["T_VARIABLE","$tables",374],["T_WHITESPACE"," ",374],["T_AS","as",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$table_name",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n          ",374],["T_VARIABLE","$table_mapping",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","setFieldNames",375],"(",["T_VARIABLE","$table_name",375],",",["T_WHITESPACE"," ",375],["T_ARRAY","array",375],"(",["T_VARIABLE","$field_name",375],")",")",";",["T_WHITESPACE","\n          ",375],["T_VARIABLE","$table_mapping",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","setExtraColumns",376],"(",["T_VARIABLE","$table_name",376],",",["T_WHITESPACE"," ",376],["T_VARIABLE","$extra_columns",376],")",";",["T_WHITESPACE","\n        ",376],"}",["T_WHITESPACE","\n      ",377],"}",["T_WHITESPACE","\n\n      ",378],["T_COMMENT","\/\/ Cache the computed table mapping only if we are using our internal\n",380],["T_WHITESPACE","      ",381],["T_COMMENT","\/\/ storage definitions.\n",381],["T_WHITESPACE","      ",382],["T_IF","if",382],["T_WHITESPACE"," ",382],"(","!",["T_VARIABLE","$storage_definitions",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","tableMapping",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$table_mapping",383],";",["T_WHITESPACE","\n      ",383],"}",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$table_mapping",387],";",["T_WHITESPACE","\n  ",387],"}",["T_WHITESPACE","\n\n  ",388],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",390],["T_WHITESPACE","\n  ",392],["T_PROTECTED","protected",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","doLoadMultiple",393],"(",["T_ARRAY","array",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$ids",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","NULL",393],")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n    ",393],["T_COMMENT","\/\/ Attempt to load entities from the persistent cache. This will remove IDs\n",394],["T_WHITESPACE","    ",395],["T_COMMENT","\/\/ that were loaded from $ids.\n",395],["T_WHITESPACE","    ",396],["T_VARIABLE","$entities_from_cache",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getFromPersistentCache",396],"(",["T_VARIABLE","$ids",396],")",";",["T_WHITESPACE","\n\n    ",396],["T_COMMENT","\/\/ Load any remaining entities from the database.\n",398],["T_WHITESPACE","    ",399],["T_IF","if",399],["T_WHITESPACE"," ",399],"(",["T_VARIABLE","$entities_from_storage",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getFromStorage",399],"(",["T_VARIABLE","$ids",399],")",")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n      ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","invokeStorageLoadHook",400],"(",["T_VARIABLE","$entities_from_storage",400],")",";",["T_WHITESPACE","\n      ",400],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","setPersistentCache",401],"(",["T_VARIABLE","$entities_from_storage",401],")",";",["T_WHITESPACE","\n    ",401],"}",["T_WHITESPACE","\n\n    ",402],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$entities_from_cache",404],["T_WHITESPACE"," ",404],"+",["T_WHITESPACE"," ",404],["T_VARIABLE","$entities_from_storage",404],";",["T_WHITESPACE","\n  ",404],"}",["T_WHITESPACE","\n\n  ",405],["T_DOC_COMMENT","\/**\n   * Gets entities from the storage.\n   *\n   * @param array|null $ids\n   *   If not empty, return entities that match these IDs. Return all entities\n   *   when NULL.\n   *\n   * @return \\Drupal\\Core\\Entity\\ContentEntityInterface[]\n   *   Array of entities from the storage.\n   *\/",407],["T_WHITESPACE","\n  ",416],["T_PROTECTED","protected",417],["T_WHITESPACE"," ",417],["T_FUNCTION","function",417],["T_WHITESPACE"," ",417],["T_STRING","getFromStorage",417],"(",["T_ARRAY","array",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$ids",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_STRING","NULL",417],")",["T_WHITESPACE"," ",417],"{",["T_WHITESPACE","\n    ",417],["T_VARIABLE","$entities",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_ARRAY","array",418],"(",")",";",["T_WHITESPACE","\n\n    ",418],["T_IF","if",420],["T_WHITESPACE"," ",420],"(","!",["T_EMPTY","empty",420],"(",["T_VARIABLE","$ids",420],")",")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n      ",420],["T_COMMENT","\/\/ Sanitize IDs. Before feeding ID array into buildQuery, check whether\n",421],["T_WHITESPACE","      ",422],["T_COMMENT","\/\/ it is empty as this would load all entities.\n",422],["T_WHITESPACE","      ",423],["T_VARIABLE","$ids",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","cleanIds",423],"(",["T_VARIABLE","$ids",423],")",";",["T_WHITESPACE","\n    ",423],"}",["T_WHITESPACE","\n\n    ",424],["T_IF","if",426],["T_WHITESPACE"," ",426],"(",["T_VARIABLE","$ids",426],["T_WHITESPACE"," ",426],["T_IS_IDENTICAL","===",426],["T_WHITESPACE"," ",426],["T_STRING","NULL",426],["T_WHITESPACE"," ",426],["T_BOOLEAN_OR","||",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$ids",426],")",["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n      ",426],["T_COMMENT","\/\/ Build and execute the query.\n",427],["T_WHITESPACE","      ",428],["T_VARIABLE","$query_result",428],["T_WHITESPACE"," ",428],"=",["T_WHITESPACE"," ",428],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","buildQuery",428],"(",["T_VARIABLE","$ids",428],")",["T_OBJECT_OPERATOR","->",428],["T_STRING","execute",428],"(",")",";",["T_WHITESPACE","\n      ",428],["T_VARIABLE","$records",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$query_result",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","fetchAllAssoc",429],"(",["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","idKey",429],")",";",["T_WHITESPACE","\n\n      ",429],["T_COMMENT","\/\/ Map the loaded records into entity objects and according fields.\n",431],["T_WHITESPACE","      ",432],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_VARIABLE","$records",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$entities",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","mapFromStorageRecords",433],"(",["T_VARIABLE","$records",433],")",";",["T_WHITESPACE","\n      ",433],"}",["T_WHITESPACE","\n    ",434],"}",["T_WHITESPACE","\n\n    ",435],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$entities",437],";",["T_WHITESPACE","\n  ",437],"}",["T_WHITESPACE","\n\n  ",438],["T_DOC_COMMENT","\/**\n   * Maps from storage records to entity objects, and attaches fields.\n   *\n   * @param array $records\n   *   Associative array of query results, keyed on the entity ID.\n   * @param bool $load_from_revision\n   *   Flag to indicate whether revisions should be loaded or not.\n   *\n   * @return array\n   *   An array of entity objects implementing the EntityInterface.\n   *\/",440],["T_WHITESPACE","\n  ",450],["T_PROTECTED","protected",451],["T_WHITESPACE"," ",451],["T_FUNCTION","function",451],["T_WHITESPACE"," ",451],["T_STRING","mapFromStorageRecords",451],"(",["T_ARRAY","array",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$records",451],",",["T_WHITESPACE"," ",451],["T_VARIABLE","$load_from_revision",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],["T_STRING","FALSE",451],")",["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n    ",451],["T_IF","if",452],["T_WHITESPACE"," ",452],"(","!",["T_VARIABLE","$records",452],")",["T_WHITESPACE"," ",452],"{",["T_WHITESPACE","\n      ",452],["T_RETURN","return",453],["T_WHITESPACE"," ",453],["T_ARRAY","array",453],"(",")",";",["T_WHITESPACE","\n    ",453],"}",["T_WHITESPACE","\n\n    ",454],["T_VARIABLE","$values",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_ARRAY","array",456],"(",")",";",["T_WHITESPACE","\n    ",456],["T_FOREACH","foreach",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$records",457],["T_WHITESPACE"," ",457],["T_AS","as",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$id",457],["T_WHITESPACE"," ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$record",457],")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n      ",457],["T_VARIABLE","$values",458],"[",["T_VARIABLE","$id",458],"]",["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_ARRAY","array",458],"(",")",";",["T_WHITESPACE","\n      ",458],["T_COMMENT","\/\/ Skip the item delta and item value levels (if possible) but let the\n",459],["T_WHITESPACE","      ",460],["T_COMMENT","\/\/ field assign the value as suiting. This avoids unnecessary array\n",460],["T_WHITESPACE","      ",461],["T_COMMENT","\/\/ hierarchies and saves memory here.\n",461],["T_WHITESPACE","      ",462],["T_FOREACH","foreach",462],["T_WHITESPACE"," ",462],"(",["T_VARIABLE","$record",462],["T_WHITESPACE"," ",462],["T_AS","as",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$name",462],["T_WHITESPACE"," ",462],["T_DOUBLE_ARROW","=>",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$value",462],")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n        ",462],["T_COMMENT","\/\/ Handle columns named [field_name]__[column_name] (e.g for field types\n",463],["T_WHITESPACE","        ",464],["T_COMMENT","\/\/ that store several properties).\n",464],["T_WHITESPACE","        ",465],["T_IF","if",465],["T_WHITESPACE"," ",465],"(",["T_VARIABLE","$field_name",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_STRING","strstr",465],"(",["T_VARIABLE","$name",465],",",["T_WHITESPACE"," ",465],["T_CONSTANT_ENCAPSED_STRING","'__'",465],",",["T_WHITESPACE"," ",465],["T_STRING","TRUE",465],")",")",["T_WHITESPACE"," ",465],"{",["T_WHITESPACE","\n          ",465],["T_VARIABLE","$property_name",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_STRING","substr",466],"(",["T_VARIABLE","$name",466],",",["T_WHITESPACE"," ",466],["T_STRING","strpos",466],"(",["T_VARIABLE","$name",466],",",["T_WHITESPACE"," ",466],["T_CONSTANT_ENCAPSED_STRING","'__'",466],")",["T_WHITESPACE"," ",466],"+",["T_WHITESPACE"," ",466],["T_LNUMBER","2",466],")",";",["T_WHITESPACE","\n          ",466],["T_VARIABLE","$values",467],"[",["T_VARIABLE","$id",467],"]","[",["T_VARIABLE","$field_name",467],"]","[",["T_STRING","LanguageInterface",467],["T_DOUBLE_COLON","::",467],["T_STRING","LANGCODE_DEFAULT",467],"]","[",["T_VARIABLE","$property_name",467],"]",["T_WHITESPACE"," ",467],"=",["T_WHITESPACE"," ",467],["T_VARIABLE","$value",467],";",["T_WHITESPACE","\n        ",467],"}",["T_WHITESPACE","\n        ",468],["T_ELSE","else",469],["T_WHITESPACE"," ",469],"{",["T_WHITESPACE","\n          ",469],["T_COMMENT","\/\/ Handle columns named directly after the field (e.g if the field\n",470],["T_WHITESPACE","          ",471],["T_COMMENT","\/\/ type only stores one property).\n",471],["T_WHITESPACE","          ",472],["T_VARIABLE","$values",472],"[",["T_VARIABLE","$id",472],"]","[",["T_VARIABLE","$name",472],"]","[",["T_STRING","LanguageInterface",472],["T_DOUBLE_COLON","::",472],["T_STRING","LANGCODE_DEFAULT",472],"]",["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$value",472],";",["T_WHITESPACE","\n        ",472],"}",["T_WHITESPACE","\n      ",473],"}",["T_WHITESPACE","\n    ",474],"}",["T_WHITESPACE","\n\n    ",475],["T_COMMENT","\/\/ Initialize translations array.\n",477],["T_WHITESPACE","    ",478],["T_VARIABLE","$translations",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_STRING","array_fill_keys",478],"(",["T_STRING","array_keys",478],"(",["T_VARIABLE","$values",478],")",",",["T_WHITESPACE"," ",478],["T_ARRAY","array",478],"(",")",")",";",["T_WHITESPACE","\n\n    ",478],["T_COMMENT","\/\/ Load values from shared and dedicated tables.\n",480],["T_WHITESPACE","    ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","loadFromSharedTables",481],"(",["T_VARIABLE","$values",481],",",["T_WHITESPACE"," ",481],["T_VARIABLE","$translations",481],")",";",["T_WHITESPACE","\n    ",481],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","loadFromDedicatedTables",482],"(",["T_VARIABLE","$values",482],",",["T_WHITESPACE"," ",482],["T_VARIABLE","$load_from_revision",482],")",";",["T_WHITESPACE","\n\n    ",482],["T_VARIABLE","$entities",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_ARRAY","array",484],"(",")",";",["T_WHITESPACE","\n    ",484],["T_FOREACH","foreach",485],["T_WHITESPACE"," ",485],"(",["T_VARIABLE","$values",485],["T_WHITESPACE"," ",485],["T_AS","as",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$id",485],["T_WHITESPACE"," ",485],["T_DOUBLE_ARROW","=>",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$entity_values",485],")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n      ",485],["T_VARIABLE","$bundle",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","bundleKey",486],["T_WHITESPACE"," ",486],"?",["T_WHITESPACE"," ",486],["T_VARIABLE","$entity_values",486],"[",["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","bundleKey",486],"]","[",["T_STRING","LanguageInterface",486],["T_DOUBLE_COLON","::",486],["T_STRING","LANGCODE_DEFAULT",486],"]",["T_WHITESPACE"," ",486],":",["T_WHITESPACE"," ",486],["T_STRING","FALSE",486],";",["T_WHITESPACE","\n      ",486],["T_COMMENT","\/\/ Turn the record into an entity class.\n",487],["T_WHITESPACE","      ",488],["T_VARIABLE","$entities",488],"[",["T_VARIABLE","$id",488],"]",["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_NEW","new",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","entityClass",488],"(",["T_VARIABLE","$entity_values",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","entityTypeId",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$bundle",488],",",["T_WHITESPACE"," ",488],["T_STRING","array_keys",488],"(",["T_VARIABLE","$translations",488],"[",["T_VARIABLE","$id",488],"]",")",")",";",["T_WHITESPACE","\n    ",488],"}",["T_WHITESPACE","\n\n    ",489],["T_RETURN","return",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$entities",491],";",["T_WHITESPACE","\n  ",491],"}",["T_WHITESPACE","\n\n  ",492],["T_DOC_COMMENT","\/**\n   * Loads values for fields stored in the shared data tables.\n   *\n   * @param array &$values\n   *   Associative array of entities values, keyed on the entity ID.\n   * @param array &$translations\n   *   List of translations, keyed on the entity ID.\n   *\/",494],["T_WHITESPACE","\n  ",501],["T_PROTECTED","protected",502],["T_WHITESPACE"," ",502],["T_FUNCTION","function",502],["T_WHITESPACE"," ",502],["T_STRING","loadFromSharedTables",502],"(",["T_ARRAY","array",502],["T_WHITESPACE"," ",502],"&",["T_VARIABLE","$values",502],",",["T_WHITESPACE"," ",502],["T_ARRAY","array",502],["T_WHITESPACE"," ",502],"&",["T_VARIABLE","$translations",502],")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n    ",502],["T_IF","if",503],["T_WHITESPACE"," ",503],"(",["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","dataTable",503],")",["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n      ",503],["T_COMMENT","\/\/ If a revision table is available, we need all the properties of the\n",504],["T_WHITESPACE","      ",505],["T_COMMENT","\/\/ latest revision. Otherwise we fall back to the data table.\n",505],["T_WHITESPACE","      ",506],["T_VARIABLE","$table",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","revisionDataTable",506],["T_WHITESPACE"," ",506],"?",":",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","dataTable",506],";",["T_WHITESPACE","\n      ",506],["T_VARIABLE","$alias",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","revisionDataTable",507],["T_WHITESPACE"," ",507],"?",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'revision'",507],["T_WHITESPACE"," ",507],":",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'data'",507],";",["T_WHITESPACE","\n      ",507],["T_VARIABLE","$query",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","database",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","select",508],"(",["T_VARIABLE","$table",508],",",["T_WHITESPACE"," ",508],["T_VARIABLE","$alias",508],",",["T_WHITESPACE"," ",508],["T_ARRAY","array",508],"(",["T_CONSTANT_ENCAPSED_STRING","'fetch'",508],["T_WHITESPACE"," ",508],["T_DOUBLE_ARROW","=>",508],["T_WHITESPACE"," ",508],["T_NS_SEPARATOR","\\",508],["T_STRING","PDO",508],["T_DOUBLE_COLON","::",508],["T_STRING","FETCH_ASSOC",508],")",")",["T_WHITESPACE","\n        ",508],["T_OBJECT_OPERATOR","->",509],["T_STRING","fields",509],"(",["T_VARIABLE","$alias",509],")",["T_WHITESPACE","\n        ",509],["T_OBJECT_OPERATOR","->",510],["T_STRING","condition",510],"(",["T_VARIABLE","$alias",510],["T_WHITESPACE"," ",510],".",["T_WHITESPACE"," ",510],["T_CONSTANT_ENCAPSED_STRING","'.'",510],["T_WHITESPACE"," ",510],".",["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","idKey",510],",",["T_WHITESPACE"," ",510],["T_STRING","array_keys",510],"(",["T_VARIABLE","$values",510],")",",",["T_WHITESPACE"," ",510],["T_CONSTANT_ENCAPSED_STRING","'IN'",510],")",["T_WHITESPACE","\n        ",510],["T_OBJECT_OPERATOR","->",511],["T_STRING","orderBy",511],"(",["T_VARIABLE","$alias",511],["T_WHITESPACE"," ",511],".",["T_WHITESPACE"," ",511],["T_CONSTANT_ENCAPSED_STRING","'.'",511],["T_WHITESPACE"," ",511],".",["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","idKey",511],")",";",["T_WHITESPACE","\n\n      ",511],["T_VARIABLE","$table_mapping",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getTableMapping",513],"(",")",";",["T_WHITESPACE","\n      ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(",["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","revisionDataTable",514],")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n        ",514],["T_COMMENT","\/\/ Find revisioned fields that are not entity keys. Exclude the langcode\n",515],["T_WHITESPACE","        ",516],["T_COMMENT","\/\/ key as the base table holds only the default language.\n",516],["T_WHITESPACE","        ",517],["T_VARIABLE","$base_fields",517],["T_WHITESPACE"," ",517],"=",["T_WHITESPACE"," ",517],["T_STRING","array_diff",517],"(",["T_VARIABLE","$table_mapping",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","getFieldNames",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","baseTable",517],")",",",["T_WHITESPACE"," ",517],["T_ARRAY","array",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","langcodeKey",517],")",")",";",["T_WHITESPACE","\n        ",517],["T_VARIABLE","$revisioned_fields",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_STRING","array_diff",518],"(",["T_VARIABLE","$table_mapping",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getFieldNames",518],"(",["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","revisionDataTable",518],")",",",["T_WHITESPACE"," ",518],["T_VARIABLE","$base_fields",518],")",";",["T_WHITESPACE","\n\n        ",518],["T_COMMENT","\/\/ Find fields that are not revisioned or entity keys. Data fields have\n",520],["T_WHITESPACE","        ",521],["T_COMMENT","\/\/ the same value regardless of entity revision.\n",521],["T_WHITESPACE","        ",522],["T_VARIABLE","$data_fields",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_STRING","array_diff",522],"(",["T_VARIABLE","$table_mapping",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getFieldNames",522],"(",["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","dataTable",522],")",",",["T_WHITESPACE"," ",522],["T_VARIABLE","$revisioned_fields",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$base_fields",522],")",";",["T_WHITESPACE","\n        ",522],["T_COMMENT","\/\/ If there are no data fields then only revisioned fields are needed\n",523],["T_WHITESPACE","        ",524],["T_COMMENT","\/\/ else both data fields and revisioned fields are needed to map the\n",524],["T_WHITESPACE","        ",525],["T_COMMENT","\/\/ entity values.\n",525],["T_WHITESPACE","        ",526],["T_VARIABLE","$all_fields",526],["T_WHITESPACE"," ",526],"=",["T_WHITESPACE"," ",526],["T_VARIABLE","$revisioned_fields",526],";",["T_WHITESPACE","\n        ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(",["T_VARIABLE","$data_fields",527],")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n          ",527],["T_VARIABLE","$all_fields",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_STRING","array_merge",528],"(",["T_VARIABLE","$revisioned_fields",528],",",["T_WHITESPACE"," ",528],["T_VARIABLE","$data_fields",528],")",";",["T_WHITESPACE","\n          ",528],["T_VARIABLE","$query",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","leftJoin",529],"(",["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","dataTable",529],",",["T_WHITESPACE"," ",529],["T_CONSTANT_ENCAPSED_STRING","'data'",529],",",["T_WHITESPACE"," ",529],"\"",["T_ENCAPSED_AND_WHITESPACE","(revision.",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","idKey",529],["T_ENCAPSED_AND_WHITESPACE"," = data.",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","idKey",529],["T_ENCAPSED_AND_WHITESPACE"," and revision.",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","langcodeKey",529],["T_ENCAPSED_AND_WHITESPACE"," = data.",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","langcodeKey",529],["T_ENCAPSED_AND_WHITESPACE",")",529],"\"",")",";",["T_WHITESPACE","\n          ",529],["T_VARIABLE","$column_names",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],"[","]",";",["T_WHITESPACE","\n          ",530],["T_COMMENT","\/\/ Some fields can have more then one columns in the data table so\n",531],["T_WHITESPACE","          ",532],["T_COMMENT","\/\/ column names are needed.\n",532],["T_WHITESPACE","          ",533],["T_FOREACH","foreach",533],["T_WHITESPACE"," ",533],"(",["T_VARIABLE","$data_fields",533],["T_WHITESPACE"," ",533],["T_AS","as",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$data_field",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n            ",533],["T_COMMENT","\/\/ \\Drupal\\Core\\Entity\\Sql\\TableMappingInterface:: getColumNames()\n",534],["T_WHITESPACE","            ",535],["T_COMMENT","\/\/ returns an array keyed by property names so remove the keys\n",535],["T_WHITESPACE","            ",536],["T_COMMENT","\/\/ before array_merge() to avoid losing data with fields having the\n",536],["T_WHITESPACE","            ",537],["T_COMMENT","\/\/ same columns i.e. value.\n",537],["T_WHITESPACE","            ",538],["T_VARIABLE","$column_names",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_STRING","array_merge",538],"(",["T_VARIABLE","$column_names",538],",",["T_WHITESPACE"," ",538],["T_STRING","array_values",538],"(",["T_VARIABLE","$table_mapping",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getColumnNames",538],"(",["T_VARIABLE","$data_field",538],")",")",")",";",["T_WHITESPACE","\n          ",538],"}",["T_WHITESPACE","\n          ",539],["T_VARIABLE","$query",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","fields",540],"(",["T_CONSTANT_ENCAPSED_STRING","'data'",540],",",["T_WHITESPACE"," ",540],["T_VARIABLE","$column_names",540],")",";",["T_WHITESPACE","\n        ",540],"}",["T_WHITESPACE","\n\n        ",541],["T_COMMENT","\/\/ Get the revision IDs.\n",543],["T_WHITESPACE","        ",544],["T_VARIABLE","$revision_ids",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_ARRAY","array",544],"(",")",";",["T_WHITESPACE","\n        ",544],["T_FOREACH","foreach",545],["T_WHITESPACE"," ",545],"(",["T_VARIABLE","$values",545],["T_WHITESPACE"," ",545],["T_AS","as",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$entity_values",545],")",["T_WHITESPACE"," ",545],"{",["T_WHITESPACE","\n          ",545],["T_VARIABLE","$revision_ids",546],"[","]",["T_WHITESPACE"," ",546],"=",["T_WHITESPACE"," ",546],["T_VARIABLE","$entity_values",546],"[",["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","revisionKey",546],"]","[",["T_STRING","LanguageInterface",546],["T_DOUBLE_COLON","::",546],["T_STRING","LANGCODE_DEFAULT",546],"]",";",["T_WHITESPACE","\n        ",546],"}",["T_WHITESPACE","\n        ",547],["T_VARIABLE","$query",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","condition",548],"(",["T_CONSTANT_ENCAPSED_STRING","'revision.'",548],["T_WHITESPACE"," ",548],".",["T_WHITESPACE"," ",548],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","revisionKey",548],",",["T_WHITESPACE"," ",548],["T_VARIABLE","$revision_ids",548],",",["T_WHITESPACE"," ",548],["T_CONSTANT_ENCAPSED_STRING","'IN'",548],")",";",["T_WHITESPACE","\n      ",548],"}",["T_WHITESPACE","\n      ",549],["T_ELSE","else",550],["T_WHITESPACE"," ",550],"{",["T_WHITESPACE","\n        ",550],["T_VARIABLE","$all_fields",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_VARIABLE","$table_mapping",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getFieldNames",551],"(",["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","dataTable",551],")",";",["T_WHITESPACE","\n      ",551],"}",["T_WHITESPACE","\n\n      ",552],["T_VARIABLE","$result",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_VARIABLE","$query",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","execute",554],"(",")",";",["T_WHITESPACE","\n      ",554],["T_FOREACH","foreach",555],["T_WHITESPACE"," ",555],"(",["T_VARIABLE","$result",555],["T_WHITESPACE"," ",555],["T_AS","as",555],["T_WHITESPACE"," ",555],["T_VARIABLE","$row",555],")",["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$id",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_VARIABLE","$row",556],"[",["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","idKey",556],"]",";",["T_WHITESPACE","\n\n        ",556],["T_COMMENT","\/\/ Field values in default language are stored with\n",558],["T_WHITESPACE","        ",559],["T_COMMENT","\/\/ LanguageInterface::LANGCODE_DEFAULT as key.\n",559],["T_WHITESPACE","        ",560],["T_VARIABLE","$langcode",560],["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_EMPTY","empty",560],"(",["T_VARIABLE","$row",560],"[",["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","defaultLangcodeKey",560],"]",")",["T_WHITESPACE"," ",560],"?",["T_WHITESPACE"," ",560],["T_VARIABLE","$row",560],"[",["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","langcodeKey",560],"]",["T_WHITESPACE"," ",560],":",["T_WHITESPACE"," ",560],["T_STRING","LanguageInterface",560],["T_DOUBLE_COLON","::",560],["T_STRING","LANGCODE_DEFAULT",560],";",["T_WHITESPACE","\n\n        ",560],["T_VARIABLE","$translations",562],"[",["T_VARIABLE","$id",562],"]","[",["T_VARIABLE","$langcode",562],"]",["T_WHITESPACE"," ",562],"=",["T_WHITESPACE"," ",562],["T_STRING","TRUE",562],";",["T_WHITESPACE","\n\n        ",562],["T_FOREACH","foreach",564],["T_WHITESPACE"," ",564],"(",["T_VARIABLE","$all_fields",564],["T_WHITESPACE"," ",564],["T_AS","as",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$field_name",564],")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n          ",564],["T_VARIABLE","$columns",565],["T_WHITESPACE"," ",565],"=",["T_WHITESPACE"," ",565],["T_VARIABLE","$table_mapping",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","getColumnNames",565],"(",["T_VARIABLE","$field_name",565],")",";",["T_WHITESPACE","\n          ",565],["T_COMMENT","\/\/ Do not key single-column fields by property name.\n",566],["T_WHITESPACE","          ",567],["T_IF","if",567],["T_WHITESPACE"," ",567],"(",["T_STRING","count",567],"(",["T_VARIABLE","$columns",567],")",["T_WHITESPACE"," ",567],["T_IS_EQUAL","==",567],["T_WHITESPACE"," ",567],["T_LNUMBER","1",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_VARIABLE","$values",568],"[",["T_VARIABLE","$id",568],"]","[",["T_VARIABLE","$field_name",568],"]","[",["T_VARIABLE","$langcode",568],"]",["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$row",568],"[",["T_STRING","reset",568],"(",["T_VARIABLE","$columns",568],")","]",";",["T_WHITESPACE","\n          ",568],"}",["T_WHITESPACE","\n          ",569],["T_ELSE","else",570],["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n            ",570],["T_FOREACH","foreach",571],["T_WHITESPACE"," ",571],"(",["T_VARIABLE","$columns",571],["T_WHITESPACE"," ",571],["T_AS","as",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$property_name",571],["T_WHITESPACE"," ",571],["T_DOUBLE_ARROW","=>",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$column_name",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n              ",571],["T_VARIABLE","$values",572],"[",["T_VARIABLE","$id",572],"]","[",["T_VARIABLE","$field_name",572],"]","[",["T_VARIABLE","$langcode",572],"]","[",["T_VARIABLE","$property_name",572],"]",["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$row",572],"[",["T_VARIABLE","$column_name",572],"]",";",["T_WHITESPACE","\n            ",572],"}",["T_WHITESPACE","\n          ",573],"}",["T_WHITESPACE","\n        ",574],"}",["T_WHITESPACE","\n      ",575],"}",["T_WHITESPACE","\n    ",576],"}",["T_WHITESPACE","\n  ",577],"}",["T_WHITESPACE","\n\n  ",578],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",580],["T_WHITESPACE","\n  ",582],["T_PROTECTED","protected",583],["T_WHITESPACE"," ",583],["T_FUNCTION","function",583],["T_WHITESPACE"," ",583],["T_STRING","doLoadRevisionFieldItems",583],"(",["T_VARIABLE","$revision_id",583],")",["T_WHITESPACE"," ",583],"{",["T_WHITESPACE","\n    ",583],["T_VARIABLE","$revision",584],["T_WHITESPACE"," ",584],"=",["T_WHITESPACE"," ",584],["T_STRING","NULL",584],";",["T_WHITESPACE","\n\n    ",584],["T_COMMENT","\/\/ Build and execute the query.\n",586],["T_WHITESPACE","    ",587],["T_VARIABLE","$query_result",587],["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","buildQuery",587],"(",["T_ARRAY","array",587],"(",")",",",["T_WHITESPACE"," ",587],["T_VARIABLE","$revision_id",587],")",["T_OBJECT_OPERATOR","->",587],["T_STRING","execute",587],"(",")",";",["T_WHITESPACE","\n    ",587],["T_VARIABLE","$records",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$query_result",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","fetchAllAssoc",588],"(",["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","idKey",588],")",";",["T_WHITESPACE","\n\n    ",588],["T_IF","if",590],["T_WHITESPACE"," ",590],"(","!",["T_EMPTY","empty",590],"(",["T_VARIABLE","$records",590],")",")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n      ",590],["T_COMMENT","\/\/ Convert the raw records to entity objects.\n",591],["T_WHITESPACE","      ",592],["T_VARIABLE","$entities",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","mapFromStorageRecords",592],"(",["T_VARIABLE","$records",592],",",["T_WHITESPACE"," ",592],["T_STRING","TRUE",592],")",";",["T_WHITESPACE","\n      ",592],["T_VARIABLE","$revision",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_STRING","reset",593],"(",["T_VARIABLE","$entities",593],")",["T_WHITESPACE"," ",593],"?",":",["T_WHITESPACE"," ",593],["T_STRING","NULL",593],";",["T_WHITESPACE","\n    ",593],"}",["T_WHITESPACE","\n\n    ",594],["T_RETURN","return",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$revision",596],";",["T_WHITESPACE","\n  ",596],"}",["T_WHITESPACE","\n\n  ",597],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",599],["T_WHITESPACE","\n  ",601],["T_PROTECTED","protected",602],["T_WHITESPACE"," ",602],["T_FUNCTION","function",602],["T_WHITESPACE"," ",602],["T_STRING","doDeleteRevisionFieldItems",602],"(",["T_STRING","ContentEntityInterface",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$revision",602],")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n    ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","database",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","delete",603],"(",["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","revisionTable",603],")",["T_WHITESPACE","\n      ",603],["T_OBJECT_OPERATOR","->",604],["T_STRING","condition",604],"(",["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","revisionKey",604],",",["T_WHITESPACE"," ",604],["T_VARIABLE","$revision",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","getRevisionId",604],"(",")",")",["T_WHITESPACE","\n      ",604],["T_OBJECT_OPERATOR","->",605],["T_STRING","execute",605],"(",")",";",["T_WHITESPACE","\n    ",605],["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","deleteRevisionFromDedicatedTables",606],"(",["T_VARIABLE","$revision",606],")",";",["T_WHITESPACE","\n  ",606],"}",["T_WHITESPACE","\n\n  ",607],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",609],["T_WHITESPACE","\n  ",611],["T_PROTECTED","protected",612],["T_WHITESPACE"," ",612],["T_FUNCTION","function",612],["T_WHITESPACE"," ",612],["T_STRING","buildPropertyQuery",612],"(",["T_STRING","QueryInterface",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$entity_query",612],",",["T_WHITESPACE"," ",612],["T_ARRAY","array",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$values",612],")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n    ",612],["T_IF","if",613],["T_WHITESPACE"," ",613],"(",["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","dataTable",613],")",["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n      ",613],["T_COMMENT","\/\/ @todo We should not be using a condition to specify whether conditions\n",614],["T_WHITESPACE","      ",615],["T_COMMENT","\/\/   apply to the default language. See\n",615],["T_WHITESPACE","      ",616],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/1866330.\n",616],["T_WHITESPACE","      ",617],["T_COMMENT","\/\/ Default to the original entity language if not explicitly specified\n",617],["T_WHITESPACE","      ",618],["T_COMMENT","\/\/ otherwise.\n",618],["T_WHITESPACE","      ",619],["T_IF","if",619],["T_WHITESPACE"," ",619],"(","!",["T_STRING","array_key_exists",619],"(",["T_VARIABLE","$this",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","defaultLangcodeKey",619],",",["T_WHITESPACE"," ",619],["T_VARIABLE","$values",619],")",")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n        ",619],["T_VARIABLE","$values",620],"[",["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","defaultLangcodeKey",620],"]",["T_WHITESPACE"," ",620],"=",["T_WHITESPACE"," ",620],["T_LNUMBER","1",620],";",["T_WHITESPACE","\n      ",620],"}",["T_WHITESPACE","\n      ",621],["T_COMMENT","\/\/ If the 'default_langcode' flag is explicitly not set, we do not care\n",622],["T_WHITESPACE","      ",623],["T_COMMENT","\/\/ whether the queried values are in the original entity language or not.\n",623],["T_WHITESPACE","      ",624],["T_ELSEIF","elseif",624],["T_WHITESPACE"," ",624],"(",["T_VARIABLE","$values",624],"[",["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","defaultLangcodeKey",624],"]",["T_WHITESPACE"," ",624],["T_IS_IDENTICAL","===",624],["T_WHITESPACE"," ",624],["T_STRING","NULL",624],")",["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n        ",624],["T_UNSET","unset",625],"(",["T_VARIABLE","$values",625],"[",["T_VARIABLE","$this",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","defaultLangcodeKey",625],"]",")",";",["T_WHITESPACE","\n      ",625],"}",["T_WHITESPACE","\n    ",626],"}",["T_WHITESPACE","\n\n    ",627],["T_STRING","parent",629],["T_DOUBLE_COLON","::",629],["T_STRING","buildPropertyQuery",629],"(",["T_VARIABLE","$entity_query",629],",",["T_WHITESPACE"," ",629],["T_VARIABLE","$values",629],")",";",["T_WHITESPACE","\n  ",629],"}",["T_WHITESPACE","\n\n  ",630],["T_DOC_COMMENT","\/**\n   * Builds the query to load the entity.\n   *\n   * This has full revision support. For entities requiring special queries,\n   * the class can be extended, and the default query can be constructed by\n   * calling parent::buildQuery(). This is usually necessary when the object\n   * being loaded needs to be augmented with additional data from another\n   * table, such as loading node type into comments or vocabulary machine name\n   * into terms, however it can also support $conditions on different tables.\n   * See Drupal\\comment\\CommentStorage::buildQuery() for an example.\n   *\n   * @param array|null $ids\n   *   An array of entity IDs, or NULL to load all entities.\n   * @param $revision_id\n   *   The ID of the revision to load, or FALSE if this query is asking for the\n   *   most current revision(s).\n   *\n   * @return \\Drupal\\Core\\Database\\Query\\Select\n   *   A SelectQuery object for loading the entity.\n   *\/",632],["T_WHITESPACE","\n  ",651],["T_PROTECTED","protected",652],["T_WHITESPACE"," ",652],["T_FUNCTION","function",652],["T_WHITESPACE"," ",652],["T_STRING","buildQuery",652],"(",["T_VARIABLE","$ids",652],",",["T_WHITESPACE"," ",652],["T_VARIABLE","$revision_id",652],["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_STRING","FALSE",652],")",["T_WHITESPACE"," ",652],"{",["T_WHITESPACE","\n    ",652],["T_VARIABLE","$query",653],["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_VARIABLE","$this",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","database",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","select",653],"(",["T_VARIABLE","$this",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","entityType",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","getBaseTable",653],"(",")",",",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","'base'",653],")",";",["T_WHITESPACE","\n\n    ",653],["T_VARIABLE","$query",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","addTag",655],"(",["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","entityTypeId",655],["T_WHITESPACE"," ",655],".",["T_WHITESPACE"," ",655],["T_CONSTANT_ENCAPSED_STRING","'_load_multiple'",655],")",";",["T_WHITESPACE","\n\n    ",655],["T_IF","if",657],["T_WHITESPACE"," ",657],"(",["T_VARIABLE","$revision_id",657],")",["T_WHITESPACE"," ",657],"{",["T_WHITESPACE","\n      ",657],["T_VARIABLE","$query",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","join",658],"(",["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","revisionTable",658],",",["T_WHITESPACE"," ",658],["T_CONSTANT_ENCAPSED_STRING","'revision'",658],",",["T_WHITESPACE"," ",658],"\"",["T_ENCAPSED_AND_WHITESPACE","revision.",658],["T_CURLY_OPEN","{",658],["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","idKey",658],"}",["T_ENCAPSED_AND_WHITESPACE"," = base.",658],["T_CURLY_OPEN","{",658],["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","idKey",658],"}",["T_ENCAPSED_AND_WHITESPACE"," AND revision.",658],["T_CURLY_OPEN","{",658],["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","revisionKey",658],"}",["T_ENCAPSED_AND_WHITESPACE"," = :revisionId",658],"\"",",",["T_WHITESPACE"," ",658],["T_ARRAY","array",658],"(",["T_CONSTANT_ENCAPSED_STRING","':revisionId'",658],["T_WHITESPACE"," ",658],["T_DOUBLE_ARROW","=>",658],["T_WHITESPACE"," ",658],["T_VARIABLE","$revision_id",658],")",")",";",["T_WHITESPACE","\n    ",658],"}",["T_WHITESPACE","\n    ",659],["T_ELSEIF","elseif",660],["T_WHITESPACE"," ",660],"(",["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","revisionTable",660],")",["T_WHITESPACE"," ",660],"{",["T_WHITESPACE","\n      ",660],["T_VARIABLE","$query",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","join",661],"(",["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","revisionTable",661],",",["T_WHITESPACE"," ",661],["T_CONSTANT_ENCAPSED_STRING","'revision'",661],",",["T_WHITESPACE"," ",661],"\"",["T_ENCAPSED_AND_WHITESPACE","revision.",661],["T_CURLY_OPEN","{",661],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","revisionKey",661],"}",["T_ENCAPSED_AND_WHITESPACE"," = base.",661],["T_CURLY_OPEN","{",661],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","revisionKey",661],"}","\"",")",";",["T_WHITESPACE","\n    ",661],"}",["T_WHITESPACE","\n\n    ",662],["T_COMMENT","\/\/ Add fields from the {entity} table.\n",664],["T_WHITESPACE","    ",665],["T_VARIABLE","$table_mapping",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getTableMapping",665],"(",")",";",["T_WHITESPACE","\n    ",665],["T_VARIABLE","$entity_fields",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_VARIABLE","$table_mapping",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getAllColumns",666],"(",["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","baseTable",666],")",";",["T_WHITESPACE","\n\n    ",666],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","revisionTable",668],")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n      ",668],["T_COMMENT","\/\/ Add all fields from the {entity_revision} table.\n",669],["T_WHITESPACE","      ",670],["T_VARIABLE","$entity_revision_fields",670],["T_WHITESPACE"," ",670],"=",["T_WHITESPACE"," ",670],["T_VARIABLE","$table_mapping",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getAllColumns",670],"(",["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","revisionTable",670],")",";",["T_WHITESPACE","\n      ",670],["T_VARIABLE","$entity_revision_fields",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_STRING","array_combine",671],"(",["T_VARIABLE","$entity_revision_fields",671],",",["T_WHITESPACE"," ",671],["T_VARIABLE","$entity_revision_fields",671],")",";",["T_WHITESPACE","\n      ",671],["T_COMMENT","\/\/ The ID field is provided by entity, so remove it.\n",672],["T_WHITESPACE","      ",673],["T_UNSET","unset",673],"(",["T_VARIABLE","$entity_revision_fields",673],"[",["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","idKey",673],"]",")",";",["T_WHITESPACE","\n\n      ",673],["T_COMMENT","\/\/ Remove all fields from the base table that are also fields by the same\n",675],["T_WHITESPACE","      ",676],["T_COMMENT","\/\/ name in the revision table.\n",676],["T_WHITESPACE","      ",677],["T_VARIABLE","$entity_field_keys",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_STRING","array_flip",677],"(",["T_VARIABLE","$entity_fields",677],")",";",["T_WHITESPACE","\n      ",677],["T_FOREACH","foreach",678],["T_WHITESPACE"," ",678],"(",["T_VARIABLE","$entity_revision_fields",678],["T_WHITESPACE"," ",678],["T_AS","as",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$name",678],")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n        ",678],["T_IF","if",679],["T_WHITESPACE"," ",679],"(",["T_ISSET","isset",679],"(",["T_VARIABLE","$entity_field_keys",679],"[",["T_VARIABLE","$name",679],"]",")",")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n          ",679],["T_UNSET","unset",680],"(",["T_VARIABLE","$entity_fields",680],"[",["T_VARIABLE","$entity_field_keys",680],"[",["T_VARIABLE","$name",680],"]","]",")",";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE","\n      ",681],"}",["T_WHITESPACE","\n      ",682],["T_VARIABLE","$query",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","fields",683],"(",["T_CONSTANT_ENCAPSED_STRING","'revision'",683],",",["T_WHITESPACE"," ",683],["T_VARIABLE","$entity_revision_fields",683],")",";",["T_WHITESPACE","\n\n      ",683],["T_COMMENT","\/\/ Compare revision ID of the base and revision table, if equal then this\n",685],["T_WHITESPACE","      ",686],["T_COMMENT","\/\/ is the default revision.\n",686],["T_WHITESPACE","      ",687],["T_VARIABLE","$query",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","addExpression",687],"(",["T_CONSTANT_ENCAPSED_STRING","'CASE base.'",687],["T_WHITESPACE"," ",687],".",["T_WHITESPACE"," ",687],["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","revisionKey",687],["T_WHITESPACE"," ",687],".",["T_WHITESPACE"," ",687],["T_CONSTANT_ENCAPSED_STRING","' WHEN revision.'",687],["T_WHITESPACE"," ",687],".",["T_WHITESPACE"," ",687],["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","revisionKey",687],["T_WHITESPACE"," ",687],".",["T_WHITESPACE"," ",687],["T_CONSTANT_ENCAPSED_STRING","' THEN 1 ELSE 0 END'",687],",",["T_WHITESPACE"," ",687],["T_CONSTANT_ENCAPSED_STRING","'isDefaultRevision'",687],")",";",["T_WHITESPACE","\n    ",687],"}",["T_WHITESPACE","\n\n    ",688],["T_VARIABLE","$query",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","fields",690],"(",["T_CONSTANT_ENCAPSED_STRING","'base'",690],",",["T_WHITESPACE"," ",690],["T_VARIABLE","$entity_fields",690],")",";",["T_WHITESPACE","\n\n    ",690],["T_IF","if",692],["T_WHITESPACE"," ",692],"(",["T_VARIABLE","$ids",692],")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n      ",692],["T_VARIABLE","$query",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","condition",693],"(","\"",["T_ENCAPSED_AND_WHITESPACE","base.",693],["T_CURLY_OPEN","{",693],["T_VARIABLE","$this",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","idKey",693],"}","\"",",",["T_WHITESPACE"," ",693],["T_VARIABLE","$ids",693],",",["T_WHITESPACE"," ",693],["T_CONSTANT_ENCAPSED_STRING","'IN'",693],")",";",["T_WHITESPACE","\n    ",693],"}",["T_WHITESPACE","\n\n    ",694],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$query",696],";",["T_WHITESPACE","\n  ",696],"}",["T_WHITESPACE","\n\n  ",697],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",699],["T_WHITESPACE","\n  ",701],["T_PUBLIC","public",702],["T_WHITESPACE"," ",702],["T_FUNCTION","function",702],["T_WHITESPACE"," ",702],["T_STRING","delete",702],"(",["T_ARRAY","array",702],["T_WHITESPACE"," ",702],["T_VARIABLE","$entities",702],")",["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n    ",702],["T_IF","if",703],["T_WHITESPACE"," ",703],"(","!",["T_VARIABLE","$entities",703],")",["T_WHITESPACE"," ",703],"{",["T_WHITESPACE","\n      ",703],["T_COMMENT","\/\/ If no IDs or invalid IDs were passed, do nothing.\n",704],["T_WHITESPACE","      ",705],["T_RETURN","return",705],";",["T_WHITESPACE","\n    ",705],"}",["T_WHITESPACE","\n\n    ",706],["T_VARIABLE","$transaction",708],["T_WHITESPACE"," ",708],"=",["T_WHITESPACE"," ",708],["T_VARIABLE","$this",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","database",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","startTransaction",708],"(",")",";",["T_WHITESPACE","\n    ",708],["T_TRY","try",709],["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n      ",709],["T_STRING","parent",710],["T_DOUBLE_COLON","::",710],["T_STRING","delete",710],"(",["T_VARIABLE","$entities",710],")",";",["T_WHITESPACE","\n\n      ",710],["T_COMMENT","\/\/ Ignore replica server temporarily.\n",712],["T_WHITESPACE","      ",713],["T_STRING","db_ignore_replica",713],"(",")",";",["T_WHITESPACE","\n    ",713],"}",["T_WHITESPACE","\n    ",714],["T_CATCH","catch",715],["T_WHITESPACE"," ",715],"(",["T_NS_SEPARATOR","\\",715],["T_STRING","Exception",715],["T_WHITESPACE"," ",715],["T_VARIABLE","$e",715],")",["T_WHITESPACE"," ",715],"{",["T_WHITESPACE","\n      ",715],["T_VARIABLE","$transaction",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","rollback",716],"(",")",";",["T_WHITESPACE","\n      ",716],["T_STRING","watchdog_exception",717],"(",["T_VARIABLE","$this",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","entityTypeId",717],",",["T_WHITESPACE"," ",717],["T_VARIABLE","$e",717],")",";",["T_WHITESPACE","\n      ",717],["T_THROW","throw",718],["T_WHITESPACE"," ",718],["T_NEW","new",718],["T_WHITESPACE"," ",718],["T_STRING","EntityStorageException",718],"(",["T_VARIABLE","$e",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getMessage",718],"(",")",",",["T_WHITESPACE"," ",718],["T_VARIABLE","$e",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getCode",718],"(",")",",",["T_WHITESPACE"," ",718],["T_VARIABLE","$e",718],")",";",["T_WHITESPACE","\n    ",718],"}",["T_WHITESPACE","\n  ",719],"}",["T_WHITESPACE","\n\n  ",720],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",722],["T_WHITESPACE","\n  ",724],["T_PROTECTED","protected",725],["T_WHITESPACE"," ",725],["T_FUNCTION","function",725],["T_WHITESPACE"," ",725],["T_STRING","doDeleteFieldItems",725],"(",["T_VARIABLE","$entities",725],")",["T_WHITESPACE"," ",725],"{",["T_WHITESPACE","\n    ",725],["T_VARIABLE","$ids",726],["T_WHITESPACE"," ",726],"=",["T_WHITESPACE"," ",726],["T_STRING","array_keys",726],"(",["T_VARIABLE","$entities",726],")",";",["T_WHITESPACE","\n\n    ",726],["T_VARIABLE","$this",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","database",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","delete",728],"(",["T_VARIABLE","$this",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","entityType",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","getBaseTable",728],"(",")",")",["T_WHITESPACE","\n      ",728],["T_OBJECT_OPERATOR","->",729],["T_STRING","condition",729],"(",["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","idKey",729],",",["T_WHITESPACE"," ",729],["T_VARIABLE","$ids",729],",",["T_WHITESPACE"," ",729],["T_CONSTANT_ENCAPSED_STRING","'IN'",729],")",["T_WHITESPACE","\n      ",729],["T_OBJECT_OPERATOR","->",730],["T_STRING","execute",730],"(",")",";",["T_WHITESPACE","\n\n    ",730],["T_IF","if",732],["T_WHITESPACE"," ",732],"(",["T_VARIABLE","$this",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","revisionTable",732],")",["T_WHITESPACE"," ",732],"{",["T_WHITESPACE","\n      ",732],["T_VARIABLE","$this",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","database",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","delete",733],"(",["T_VARIABLE","$this",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","revisionTable",733],")",["T_WHITESPACE","\n        ",733],["T_OBJECT_OPERATOR","->",734],["T_STRING","condition",734],"(",["T_VARIABLE","$this",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","idKey",734],",",["T_WHITESPACE"," ",734],["T_VARIABLE","$ids",734],",",["T_WHITESPACE"," ",734],["T_CONSTANT_ENCAPSED_STRING","'IN'",734],")",["T_WHITESPACE","\n        ",734],["T_OBJECT_OPERATOR","->",735],["T_STRING","execute",735],"(",")",";",["T_WHITESPACE","\n    ",735],"}",["T_WHITESPACE","\n\n    ",736],["T_IF","if",738],["T_WHITESPACE"," ",738],"(",["T_VARIABLE","$this",738],["T_OBJECT_OPERATOR","->",738],["T_STRING","dataTable",738],")",["T_WHITESPACE"," ",738],"{",["T_WHITESPACE","\n      ",738],["T_VARIABLE","$this",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","database",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","delete",739],"(",["T_VARIABLE","$this",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","dataTable",739],")",["T_WHITESPACE","\n        ",739],["T_OBJECT_OPERATOR","->",740],["T_STRING","condition",740],"(",["T_VARIABLE","$this",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","idKey",740],",",["T_WHITESPACE"," ",740],["T_VARIABLE","$ids",740],",",["T_WHITESPACE"," ",740],["T_CONSTANT_ENCAPSED_STRING","'IN'",740],")",["T_WHITESPACE","\n        ",740],["T_OBJECT_OPERATOR","->",741],["T_STRING","execute",741],"(",")",";",["T_WHITESPACE","\n    ",741],"}",["T_WHITESPACE","\n\n    ",742],["T_IF","if",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","revisionDataTable",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n      ",744],["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","database",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","delete",745],"(",["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","revisionDataTable",745],")",["T_WHITESPACE","\n        ",745],["T_OBJECT_OPERATOR","->",746],["T_STRING","condition",746],"(",["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","idKey",746],",",["T_WHITESPACE"," ",746],["T_VARIABLE","$ids",746],",",["T_WHITESPACE"," ",746],["T_CONSTANT_ENCAPSED_STRING","'IN'",746],")",["T_WHITESPACE","\n        ",746],["T_OBJECT_OPERATOR","->",747],["T_STRING","execute",747],"(",")",";",["T_WHITESPACE","\n    ",747],"}",["T_WHITESPACE","\n\n    ",748],["T_FOREACH","foreach",750],["T_WHITESPACE"," ",750],"(",["T_VARIABLE","$entities",750],["T_WHITESPACE"," ",750],["T_AS","as",750],["T_WHITESPACE"," ",750],["T_VARIABLE","$entity",750],")",["T_WHITESPACE"," ",750],"{",["T_WHITESPACE","\n      ",750],["T_VARIABLE","$this",751],["T_OBJECT_OPERATOR","->",751],["T_STRING","deleteFromDedicatedTables",751],"(",["T_VARIABLE","$entity",751],")",";",["T_WHITESPACE","\n    ",751],"}",["T_WHITESPACE","\n  ",752],"}",["T_WHITESPACE","\n\n  ",753],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",755],["T_WHITESPACE","\n  ",757],["T_PUBLIC","public",758],["T_WHITESPACE"," ",758],["T_FUNCTION","function",758],["T_WHITESPACE"," ",758],["T_STRING","save",758],"(",["T_STRING","EntityInterface",758],["T_WHITESPACE"," ",758],["T_VARIABLE","$entity",758],")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n    ",758],["T_VARIABLE","$transaction",759],["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_VARIABLE","$this",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","database",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","startTransaction",759],"(",")",";",["T_WHITESPACE","\n    ",759],["T_TRY","try",760],["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n      ",760],["T_VARIABLE","$return",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_STRING","parent",761],["T_DOUBLE_COLON","::",761],["T_STRING","save",761],"(",["T_VARIABLE","$entity",761],")",";",["T_WHITESPACE","\n\n      ",761],["T_COMMENT","\/\/ Ignore replica server temporarily.\n",763],["T_WHITESPACE","      ",764],["T_STRING","db_ignore_replica",764],"(",")",";",["T_WHITESPACE","\n      ",764],["T_RETURN","return",765],["T_WHITESPACE"," ",765],["T_VARIABLE","$return",765],";",["T_WHITESPACE","\n    ",765],"}",["T_WHITESPACE","\n    ",766],["T_CATCH","catch",767],["T_WHITESPACE"," ",767],"(",["T_NS_SEPARATOR","\\",767],["T_STRING","Exception",767],["T_WHITESPACE"," ",767],["T_VARIABLE","$e",767],")",["T_WHITESPACE"," ",767],"{",["T_WHITESPACE","\n      ",767],["T_VARIABLE","$transaction",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","rollback",768],"(",")",";",["T_WHITESPACE","\n      ",768],["T_STRING","watchdog_exception",769],"(",["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","entityTypeId",769],",",["T_WHITESPACE"," ",769],["T_VARIABLE","$e",769],")",";",["T_WHITESPACE","\n      ",769],["T_THROW","throw",770],["T_WHITESPACE"," ",770],["T_NEW","new",770],["T_WHITESPACE"," ",770],["T_STRING","EntityStorageException",770],"(",["T_VARIABLE","$e",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getMessage",770],"(",")",",",["T_WHITESPACE"," ",770],["T_VARIABLE","$e",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getCode",770],"(",")",",",["T_WHITESPACE"," ",770],["T_VARIABLE","$e",770],")",";",["T_WHITESPACE","\n    ",770],"}",["T_WHITESPACE","\n  ",771],"}",["T_WHITESPACE","\n\n  ",772],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",774],["T_WHITESPACE","\n  ",776],["T_PROTECTED","protected",777],["T_WHITESPACE"," ",777],["T_FUNCTION","function",777],["T_WHITESPACE"," ",777],["T_STRING","doSaveFieldItems",777],"(",["T_STRING","ContentEntityInterface",777],["T_WHITESPACE"," ",777],["T_VARIABLE","$entity",777],",",["T_WHITESPACE"," ",777],["T_ARRAY","array",777],["T_WHITESPACE"," ",777],["T_VARIABLE","$names",777],["T_WHITESPACE"," ",777],"=",["T_WHITESPACE"," ",777],"[","]",")",["T_WHITESPACE"," ",777],"{",["T_WHITESPACE","\n    ",777],["T_VARIABLE","$full_save",778],["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_EMPTY","empty",778],"(",["T_VARIABLE","$names",778],")",";",["T_WHITESPACE","\n    ",778],["T_VARIABLE","$update",779],["T_WHITESPACE"," ",779],"=",["T_WHITESPACE"," ",779],"!",["T_VARIABLE","$full_save",779],["T_WHITESPACE"," ",779],["T_BOOLEAN_OR","||",779],["T_WHITESPACE"," ",779],"!",["T_VARIABLE","$entity",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","isNew",779],"(",")",";",["T_WHITESPACE","\n\n    ",779],["T_IF","if",781],["T_WHITESPACE"," ",781],"(",["T_VARIABLE","$full_save",781],")",["T_WHITESPACE"," ",781],"{",["T_WHITESPACE","\n      ",781],["T_VARIABLE","$shared_table_fields",782],["T_WHITESPACE"," ",782],"=",["T_WHITESPACE"," ",782],["T_STRING","TRUE",782],";",["T_WHITESPACE","\n      ",782],["T_VARIABLE","$dedicated_table_fields",783],["T_WHITESPACE"," ",783],"=",["T_WHITESPACE"," ",783],["T_STRING","TRUE",783],";",["T_WHITESPACE","\n    ",783],"}",["T_WHITESPACE","\n    ",784],["T_ELSE","else",785],["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n      ",785],["T_VARIABLE","$table_mapping",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getTableMapping",786],"(",")",";",["T_WHITESPACE","\n      ",786],["T_VARIABLE","$storage_definitions",787],["T_WHITESPACE"," ",787],"=",["T_WHITESPACE"," ",787],["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","entityManager",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getFieldStorageDefinitions",787],"(",["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","entityTypeId",787],")",";",["T_WHITESPACE","\n      ",787],["T_VARIABLE","$shared_table_fields",788],["T_WHITESPACE"," ",788],"=",["T_WHITESPACE"," ",788],["T_STRING","FALSE",788],";",["T_WHITESPACE","\n      ",788],["T_VARIABLE","$dedicated_table_fields",789],["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],"[","]",";",["T_WHITESPACE","\n\n      ",789],["T_COMMENT","\/\/ Collect the name of fields to be written in dedicated tables and check\n",791],["T_WHITESPACE","      ",792],["T_COMMENT","\/\/ whether shared table records need to be updated.\n",792],["T_WHITESPACE","      ",793],["T_FOREACH","foreach",793],["T_WHITESPACE"," ",793],"(",["T_VARIABLE","$names",793],["T_WHITESPACE"," ",793],["T_AS","as",793],["T_WHITESPACE"," ",793],["T_VARIABLE","$name",793],")",["T_WHITESPACE"," ",793],"{",["T_WHITESPACE","\n        ",793],["T_VARIABLE","$storage_definition",794],["T_WHITESPACE"," ",794],"=",["T_WHITESPACE"," ",794],["T_VARIABLE","$storage_definitions",794],"[",["T_VARIABLE","$name",794],"]",";",["T_WHITESPACE","\n        ",794],["T_IF","if",795],["T_WHITESPACE"," ",795],"(",["T_VARIABLE","$table_mapping",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","allowsSharedTableStorage",795],"(",["T_VARIABLE","$storage_definition",795],")",")",["T_WHITESPACE"," ",795],"{",["T_WHITESPACE","\n          ",795],["T_VARIABLE","$shared_table_fields",796],["T_WHITESPACE"," ",796],"=",["T_WHITESPACE"," ",796],["T_STRING","TRUE",796],";",["T_WHITESPACE","\n        ",796],"}",["T_WHITESPACE","\n        ",797],["T_ELSEIF","elseif",798],["T_WHITESPACE"," ",798],"(",["T_VARIABLE","$table_mapping",798],["T_OBJECT_OPERATOR","->",798],["T_STRING","requiresDedicatedTableStorage",798],"(",["T_VARIABLE","$storage_definition",798],")",")",["T_WHITESPACE"," ",798],"{",["T_WHITESPACE","\n          ",798],["T_VARIABLE","$dedicated_table_fields",799],"[","]",["T_WHITESPACE"," ",799],"=",["T_WHITESPACE"," ",799],["T_VARIABLE","$name",799],";",["T_WHITESPACE","\n        ",799],"}",["T_WHITESPACE","\n      ",800],"}",["T_WHITESPACE","\n    ",801],"}",["T_WHITESPACE","\n\n    ",802],["T_COMMENT","\/\/ Update shared table records if necessary.\n",804],["T_WHITESPACE","    ",805],["T_IF","if",805],["T_WHITESPACE"," ",805],"(",["T_VARIABLE","$shared_table_fields",805],")",["T_WHITESPACE"," ",805],"{",["T_WHITESPACE","\n      ",805],["T_VARIABLE","$record",806],["T_WHITESPACE"," ",806],"=",["T_WHITESPACE"," ",806],["T_VARIABLE","$this",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","mapToStorageRecord",806],"(",["T_VARIABLE","$entity",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getUntranslated",806],"(",")",",",["T_WHITESPACE"," ",806],["T_VARIABLE","$this",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","baseTable",806],")",";",["T_WHITESPACE","\n      ",806],["T_COMMENT","\/\/ Create the storage record to be saved.\n",807],["T_WHITESPACE","      ",808],["T_IF","if",808],["T_WHITESPACE"," ",808],"(",["T_VARIABLE","$update",808],")",["T_WHITESPACE"," ",808],"{",["T_WHITESPACE","\n        ",808],["T_VARIABLE","$default_revision",809],["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$entity",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","isDefaultRevision",809],"(",")",";",["T_WHITESPACE","\n        ",809],["T_IF","if",810],["T_WHITESPACE"," ",810],"(",["T_VARIABLE","$default_revision",810],")",["T_WHITESPACE"," ",810],"{",["T_WHITESPACE","\n          ",810],["T_VARIABLE","$this",811],["T_OBJECT_OPERATOR","->",811],["T_STRING","database",811],["T_WHITESPACE","\n            ",811],["T_OBJECT_OPERATOR","->",812],["T_STRING","update",812],"(",["T_VARIABLE","$this",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","baseTable",812],")",["T_WHITESPACE","\n            ",812],["T_OBJECT_OPERATOR","->",813],["T_STRING","fields",813],"(",["T_ARRAY_CAST","(array)",813],["T_WHITESPACE"," ",813],["T_VARIABLE","$record",813],")",["T_WHITESPACE","\n            ",813],["T_OBJECT_OPERATOR","->",814],["T_STRING","condition",814],"(",["T_VARIABLE","$this",814],["T_OBJECT_OPERATOR","->",814],["T_STRING","idKey",814],",",["T_WHITESPACE"," ",814],["T_VARIABLE","$record",814],["T_OBJECT_OPERATOR","->",814],"{",["T_VARIABLE","$this",814],["T_OBJECT_OPERATOR","->",814],["T_STRING","idKey",814],"}",")",["T_WHITESPACE","\n            ",814],["T_OBJECT_OPERATOR","->",815],["T_STRING","execute",815],"(",")",";",["T_WHITESPACE","\n        ",815],"}",["T_WHITESPACE","\n        ",816],["T_IF","if",817],["T_WHITESPACE"," ",817],"(",["T_VARIABLE","$this",817],["T_OBJECT_OPERATOR","->",817],["T_STRING","revisionTable",817],")",["T_WHITESPACE"," ",817],"{",["T_WHITESPACE","\n          ",817],["T_IF","if",818],["T_WHITESPACE"," ",818],"(",["T_VARIABLE","$full_save",818],")",["T_WHITESPACE"," ",818],"{",["T_WHITESPACE","\n            ",818],["T_VARIABLE","$entity",819],["T_OBJECT_OPERATOR","->",819],"{",["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","revisionKey",819],"}",["T_WHITESPACE"," ",819],"=",["T_WHITESPACE"," ",819],["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","saveRevision",819],"(",["T_VARIABLE","$entity",819],")",";",["T_WHITESPACE","\n          ",819],"}",["T_WHITESPACE","\n          ",820],["T_ELSE","else",821],["T_WHITESPACE"," ",821],"{",["T_WHITESPACE","\n            ",821],["T_VARIABLE","$record",822],["T_WHITESPACE"," ",822],"=",["T_WHITESPACE"," ",822],["T_VARIABLE","$this",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","mapToStorageRecord",822],"(",["T_VARIABLE","$entity",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","getUntranslated",822],"(",")",",",["T_WHITESPACE"," ",822],["T_VARIABLE","$this",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","revisionTable",822],")",";",["T_WHITESPACE","\n            ",822],["T_VARIABLE","$entity",823],["T_OBJECT_OPERATOR","->",823],["T_STRING","preSaveRevision",823],"(",["T_VARIABLE","$this",823],",",["T_WHITESPACE"," ",823],["T_VARIABLE","$record",823],")",";",["T_WHITESPACE","\n            ",823],["T_VARIABLE","$this",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","database",824],["T_WHITESPACE","\n              ",824],["T_OBJECT_OPERATOR","->",825],["T_STRING","update",825],"(",["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","revisionTable",825],")",["T_WHITESPACE","\n              ",825],["T_OBJECT_OPERATOR","->",826],["T_STRING","fields",826],"(",["T_ARRAY_CAST","(array)",826],["T_WHITESPACE"," ",826],["T_VARIABLE","$record",826],")",["T_WHITESPACE","\n              ",826],["T_OBJECT_OPERATOR","->",827],["T_STRING","condition",827],"(",["T_VARIABLE","$this",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","revisionKey",827],",",["T_WHITESPACE"," ",827],["T_VARIABLE","$record",827],["T_OBJECT_OPERATOR","->",827],"{",["T_VARIABLE","$this",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","revisionKey",827],"}",")",["T_WHITESPACE","\n              ",827],["T_OBJECT_OPERATOR","->",828],["T_STRING","execute",828],"(",")",";",["T_WHITESPACE","\n          ",828],"}",["T_WHITESPACE","\n        ",829],"}",["T_WHITESPACE","\n        ",830],["T_IF","if",831],["T_WHITESPACE"," ",831],"(",["T_VARIABLE","$default_revision",831],["T_WHITESPACE"," ",831],["T_BOOLEAN_AND","&&",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$this",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","dataTable",831],")",["T_WHITESPACE"," ",831],"{",["T_WHITESPACE","\n          ",831],["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","saveToSharedTables",832],"(",["T_VARIABLE","$entity",832],")",";",["T_WHITESPACE","\n        ",832],"}",["T_WHITESPACE","\n        ",833],["T_IF","if",834],["T_WHITESPACE"," ",834],"(",["T_VARIABLE","$this",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","revisionDataTable",834],")",["T_WHITESPACE"," ",834],"{",["T_WHITESPACE","\n          ",834],["T_VARIABLE","$new_revision",835],["T_WHITESPACE"," ",835],"=",["T_WHITESPACE"," ",835],["T_VARIABLE","$full_save",835],["T_WHITESPACE"," ",835],["T_BOOLEAN_AND","&&",835],["T_WHITESPACE"," ",835],["T_VARIABLE","$entity",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","isNewRevision",835],"(",")",";",["T_WHITESPACE","\n          ",835],["T_VARIABLE","$this",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","saveToSharedTables",836],"(",["T_VARIABLE","$entity",836],",",["T_WHITESPACE"," ",836],["T_VARIABLE","$this",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","revisionDataTable",836],",",["T_WHITESPACE"," ",836],["T_VARIABLE","$new_revision",836],")",";",["T_WHITESPACE","\n        ",836],"}",["T_WHITESPACE","\n      ",837],"}",["T_WHITESPACE","\n      ",838],["T_ELSE","else",839],["T_WHITESPACE"," ",839],"{",["T_WHITESPACE","\n        ",839],["T_VARIABLE","$insert_id",840],["T_WHITESPACE"," ",840],"=",["T_WHITESPACE"," ",840],["T_VARIABLE","$this",840],["T_OBJECT_OPERATOR","->",840],["T_STRING","database",840],["T_WHITESPACE","\n          ",840],["T_OBJECT_OPERATOR","->",841],["T_STRING","insert",841],"(",["T_VARIABLE","$this",841],["T_OBJECT_OPERATOR","->",841],["T_STRING","baseTable",841],",",["T_WHITESPACE"," ",841],["T_ARRAY","array",841],"(",["T_CONSTANT_ENCAPSED_STRING","'return'",841],["T_WHITESPACE"," ",841],["T_DOUBLE_ARROW","=>",841],["T_WHITESPACE"," ",841],["T_STRING","Database",841],["T_DOUBLE_COLON","::",841],["T_STRING","RETURN_INSERT_ID",841],")",")",["T_WHITESPACE","\n          ",841],["T_OBJECT_OPERATOR","->",842],["T_STRING","fields",842],"(",["T_ARRAY_CAST","(array)",842],["T_WHITESPACE"," ",842],["T_VARIABLE","$record",842],")",["T_WHITESPACE","\n          ",842],["T_OBJECT_OPERATOR","->",843],["T_STRING","execute",843],"(",")",";",["T_WHITESPACE","\n        ",843],["T_COMMENT","\/\/ Even if this is a new entity the ID key might have been set, in which\n",844],["T_WHITESPACE","        ",845],["T_COMMENT","\/\/ case we should not override the provided ID. An ID key that is not set\n",845],["T_WHITESPACE","        ",846],["T_COMMENT","\/\/ to any value is interpreted as NULL (or DEFAULT) and thus overridden.\n",846],["T_WHITESPACE","        ",847],["T_IF","if",847],["T_WHITESPACE"," ",847],"(","!",["T_ISSET","isset",847],"(",["T_VARIABLE","$record",847],["T_OBJECT_OPERATOR","->",847],"{",["T_VARIABLE","$this",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","idKey",847],"}",")",")",["T_WHITESPACE"," ",847],"{",["T_WHITESPACE","\n          ",847],["T_VARIABLE","$record",848],["T_OBJECT_OPERATOR","->",848],"{",["T_VARIABLE","$this",848],["T_OBJECT_OPERATOR","->",848],["T_STRING","idKey",848],"}",["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_VARIABLE","$insert_id",848],";",["T_WHITESPACE","\n        ",848],"}",["T_WHITESPACE","\n        ",849],["T_VARIABLE","$entity",850],["T_OBJECT_OPERATOR","->",850],"{",["T_VARIABLE","$this",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","idKey",850],"}",["T_WHITESPACE"," ",850],"=",["T_WHITESPACE"," ",850],["T_STRING_CAST","(string)",850],["T_WHITESPACE"," ",850],["T_VARIABLE","$record",850],["T_OBJECT_OPERATOR","->",850],"{",["T_VARIABLE","$this",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","idKey",850],"}",";",["T_WHITESPACE","\n        ",850],["T_IF","if",851],["T_WHITESPACE"," ",851],"(",["T_VARIABLE","$this",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","revisionTable",851],")",["T_WHITESPACE"," ",851],"{",["T_WHITESPACE","\n          ",851],["T_VARIABLE","$record",852],["T_OBJECT_OPERATOR","->",852],"{",["T_VARIABLE","$this",852],["T_OBJECT_OPERATOR","->",852],["T_STRING","revisionKey",852],"}",["T_WHITESPACE"," ",852],"=",["T_WHITESPACE"," ",852],["T_VARIABLE","$this",852],["T_OBJECT_OPERATOR","->",852],["T_STRING","saveRevision",852],"(",["T_VARIABLE","$entity",852],")",";",["T_WHITESPACE","\n        ",852],"}",["T_WHITESPACE","\n        ",853],["T_IF","if",854],["T_WHITESPACE"," ",854],"(",["T_VARIABLE","$this",854],["T_OBJECT_OPERATOR","->",854],["T_STRING","dataTable",854],")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n          ",854],["T_VARIABLE","$this",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","saveToSharedTables",855],"(",["T_VARIABLE","$entity",855],")",";",["T_WHITESPACE","\n        ",855],"}",["T_WHITESPACE","\n        ",856],["T_IF","if",857],["T_WHITESPACE"," ",857],"(",["T_VARIABLE","$this",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","revisionDataTable",857],")",["T_WHITESPACE"," ",857],"{",["T_WHITESPACE","\n          ",857],["T_VARIABLE","$this",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","saveToSharedTables",858],"(",["T_VARIABLE","$entity",858],",",["T_WHITESPACE"," ",858],["T_VARIABLE","$this",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","revisionDataTable",858],")",";",["T_WHITESPACE","\n        ",858],"}",["T_WHITESPACE","\n      ",859],"}",["T_WHITESPACE","\n    ",860],"}",["T_WHITESPACE","\n\n    ",861],["T_COMMENT","\/\/ Update dedicated table records if necessary.\n",863],["T_WHITESPACE","    ",864],["T_IF","if",864],["T_WHITESPACE"," ",864],"(",["T_VARIABLE","$dedicated_table_fields",864],")",["T_WHITESPACE"," ",864],"{",["T_WHITESPACE","\n      ",864],["T_VARIABLE","$names",865],["T_WHITESPACE"," ",865],"=",["T_WHITESPACE"," ",865],["T_STRING","is_array",865],"(",["T_VARIABLE","$dedicated_table_fields",865],")",["T_WHITESPACE"," ",865],"?",["T_WHITESPACE"," ",865],["T_VARIABLE","$dedicated_table_fields",865],["T_WHITESPACE"," ",865],":",["T_WHITESPACE"," ",865],"[","]",";",["T_WHITESPACE","\n      ",865],["T_VARIABLE","$this",866],["T_OBJECT_OPERATOR","->",866],["T_STRING","saveToDedicatedTables",866],"(",["T_VARIABLE","$entity",866],",",["T_WHITESPACE"," ",866],["T_VARIABLE","$update",866],",",["T_WHITESPACE"," ",866],["T_VARIABLE","$names",866],")",";",["T_WHITESPACE","\n    ",866],"}",["T_WHITESPACE","\n  ",867],"}",["T_WHITESPACE","\n\n  ",868],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",870],["T_WHITESPACE","\n  ",872],["T_PROTECTED","protected",873],["T_WHITESPACE"," ",873],["T_FUNCTION","function",873],["T_WHITESPACE"," ",873],["T_STRING","has",873],"(",["T_VARIABLE","$id",873],",",["T_WHITESPACE"," ",873],["T_STRING","EntityInterface",873],["T_WHITESPACE"," ",873],["T_VARIABLE","$entity",873],")",["T_WHITESPACE"," ",873],"{",["T_WHITESPACE","\n    ",873],["T_RETURN","return",874],["T_WHITESPACE"," ",874],"!",["T_VARIABLE","$entity",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","isNew",874],"(",")",";",["T_WHITESPACE","\n  ",874],"}",["T_WHITESPACE","\n\n  ",875],["T_DOC_COMMENT","\/**\n   * Saves fields that use the shared tables.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity object.\n   * @param string $table_name\n   *   (optional) The table name to save to. Defaults to the data table.\n   * @param bool $new_revision\n   *   (optional) Whether we are dealing with a new revision. By default fetches\n   *   the information from the entity object.\n   *\/",877],["T_WHITESPACE","\n  ",887],["T_PROTECTED","protected",888],["T_WHITESPACE"," ",888],["T_FUNCTION","function",888],["T_WHITESPACE"," ",888],["T_STRING","saveToSharedTables",888],"(",["T_STRING","ContentEntityInterface",888],["T_WHITESPACE"," ",888],["T_VARIABLE","$entity",888],",",["T_WHITESPACE"," ",888],["T_VARIABLE","$table_name",888],["T_WHITESPACE"," ",888],"=",["T_WHITESPACE"," ",888],["T_STRING","NULL",888],",",["T_WHITESPACE"," ",888],["T_VARIABLE","$new_revision",888],["T_WHITESPACE"," ",888],"=",["T_WHITESPACE"," ",888],["T_STRING","NULL",888],")",["T_WHITESPACE"," ",888],"{",["T_WHITESPACE","\n    ",888],["T_IF","if",889],["T_WHITESPACE"," ",889],"(","!",["T_ISSET","isset",889],"(",["T_VARIABLE","$table_name",889],")",")",["T_WHITESPACE"," ",889],"{",["T_WHITESPACE","\n      ",889],["T_VARIABLE","$table_name",890],["T_WHITESPACE"," ",890],"=",["T_WHITESPACE"," ",890],["T_VARIABLE","$this",890],["T_OBJECT_OPERATOR","->",890],["T_STRING","dataTable",890],";",["T_WHITESPACE","\n    ",890],"}",["T_WHITESPACE","\n    ",891],["T_IF","if",892],["T_WHITESPACE"," ",892],"(","!",["T_ISSET","isset",892],"(",["T_VARIABLE","$new_revision",892],")",")",["T_WHITESPACE"," ",892],"{",["T_WHITESPACE","\n      ",892],["T_VARIABLE","$new_revision",893],["T_WHITESPACE"," ",893],"=",["T_WHITESPACE"," ",893],["T_VARIABLE","$entity",893],["T_OBJECT_OPERATOR","->",893],["T_STRING","isNewRevision",893],"(",")",";",["T_WHITESPACE","\n    ",893],"}",["T_WHITESPACE","\n    ",894],["T_VARIABLE","$revision",895],["T_WHITESPACE"," ",895],"=",["T_WHITESPACE"," ",895],["T_VARIABLE","$table_name",895],["T_WHITESPACE"," ",895],["T_IS_NOT_EQUAL","!=",895],["T_WHITESPACE"," ",895],["T_VARIABLE","$this",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","dataTable",895],";",["T_WHITESPACE","\n\n    ",895],["T_IF","if",897],["T_WHITESPACE"," ",897],"(","!",["T_VARIABLE","$revision",897],["T_WHITESPACE"," ",897],["T_BOOLEAN_OR","||",897],["T_WHITESPACE"," ",897],"!",["T_VARIABLE","$new_revision",897],")",["T_WHITESPACE"," ",897],"{",["T_WHITESPACE","\n      ",897],["T_VARIABLE","$key",898],["T_WHITESPACE"," ",898],"=",["T_WHITESPACE"," ",898],["T_VARIABLE","$revision",898],["T_WHITESPACE"," ",898],"?",["T_WHITESPACE"," ",898],["T_VARIABLE","$this",898],["T_OBJECT_OPERATOR","->",898],["T_STRING","revisionKey",898],["T_WHITESPACE"," ",898],":",["T_WHITESPACE"," ",898],["T_VARIABLE","$this",898],["T_OBJECT_OPERATOR","->",898],["T_STRING","idKey",898],";",["T_WHITESPACE","\n      ",898],["T_VARIABLE","$value",899],["T_WHITESPACE"," ",899],"=",["T_WHITESPACE"," ",899],["T_VARIABLE","$revision",899],["T_WHITESPACE"," ",899],"?",["T_WHITESPACE"," ",899],["T_VARIABLE","$entity",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","getRevisionId",899],"(",")",["T_WHITESPACE"," ",899],":",["T_WHITESPACE"," ",899],["T_VARIABLE","$entity",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","id",899],"(",")",";",["T_WHITESPACE","\n      ",899],["T_COMMENT","\/\/ Delete and insert to handle removed values.\n",900],["T_WHITESPACE","      ",901],["T_VARIABLE","$this",901],["T_OBJECT_OPERATOR","->",901],["T_STRING","database",901],["T_OBJECT_OPERATOR","->",901],["T_STRING","delete",901],"(",["T_VARIABLE","$table_name",901],")",["T_WHITESPACE","\n        ",901],["T_OBJECT_OPERATOR","->",902],["T_STRING","condition",902],"(",["T_VARIABLE","$key",902],",",["T_WHITESPACE"," ",902],["T_VARIABLE","$value",902],")",["T_WHITESPACE","\n        ",902],["T_OBJECT_OPERATOR","->",903],["T_STRING","execute",903],"(",")",";",["T_WHITESPACE","\n    ",903],"}",["T_WHITESPACE","\n\n    ",904],["T_VARIABLE","$query",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_VARIABLE","$this",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","database",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","insert",906],"(",["T_VARIABLE","$table_name",906],")",";",["T_WHITESPACE","\n\n    ",906],["T_FOREACH","foreach",908],["T_WHITESPACE"," ",908],"(",["T_VARIABLE","$entity",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getTranslationLanguages",908],"(",")",["T_WHITESPACE"," ",908],["T_AS","as",908],["T_WHITESPACE"," ",908],["T_VARIABLE","$langcode",908],["T_WHITESPACE"," ",908],["T_DOUBLE_ARROW","=>",908],["T_WHITESPACE"," ",908],["T_VARIABLE","$language",908],")",["T_WHITESPACE"," ",908],"{",["T_WHITESPACE","\n      ",908],["T_VARIABLE","$translation",909],["T_WHITESPACE"," ",909],"=",["T_WHITESPACE"," ",909],["T_VARIABLE","$entity",909],["T_OBJECT_OPERATOR","->",909],["T_STRING","getTranslation",909],"(",["T_VARIABLE","$langcode",909],")",";",["T_WHITESPACE","\n      ",909],["T_VARIABLE","$record",910],["T_WHITESPACE"," ",910],"=",["T_WHITESPACE"," ",910],["T_VARIABLE","$this",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","mapToDataStorageRecord",910],"(",["T_VARIABLE","$translation",910],",",["T_WHITESPACE"," ",910],["T_VARIABLE","$table_name",910],")",";",["T_WHITESPACE","\n      ",910],["T_VARIABLE","$values",911],["T_WHITESPACE"," ",911],"=",["T_WHITESPACE"," ",911],["T_ARRAY_CAST","(array)",911],["T_WHITESPACE"," ",911],["T_VARIABLE","$record",911],";",["T_WHITESPACE","\n      ",911],["T_VARIABLE","$query",912],["T_WHITESPACE","\n        ",912],["T_OBJECT_OPERATOR","->",913],["T_STRING","fields",913],"(",["T_STRING","array_keys",913],"(",["T_VARIABLE","$values",913],")",")",["T_WHITESPACE","\n        ",913],["T_OBJECT_OPERATOR","->",914],["T_STRING","values",914],"(",["T_VARIABLE","$values",914],")",";",["T_WHITESPACE","\n    ",914],"}",["T_WHITESPACE","\n\n    ",915],["T_VARIABLE","$query",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","execute",917],"(",")",";",["T_WHITESPACE","\n  ",917],"}",["T_WHITESPACE","\n\n  ",918],["T_DOC_COMMENT","\/**\n   * Maps from an entity object to the storage record.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity object.\n   * @param string $table_name\n   *   (optional) The table name to map records to. Defaults to the base table.\n   *\n   * @return \\stdClass\n   *   The record to store.\n   *\/",920],["T_WHITESPACE","\n  ",930],["T_PROTECTED","protected",931],["T_WHITESPACE"," ",931],["T_FUNCTION","function",931],["T_WHITESPACE"," ",931],["T_STRING","mapToStorageRecord",931],"(",["T_STRING","ContentEntityInterface",931],["T_WHITESPACE"," ",931],["T_VARIABLE","$entity",931],",",["T_WHITESPACE"," ",931],["T_VARIABLE","$table_name",931],["T_WHITESPACE"," ",931],"=",["T_WHITESPACE"," ",931],["T_STRING","NULL",931],")",["T_WHITESPACE"," ",931],"{",["T_WHITESPACE","\n    ",931],["T_IF","if",932],["T_WHITESPACE"," ",932],"(","!",["T_ISSET","isset",932],"(",["T_VARIABLE","$table_name",932],")",")",["T_WHITESPACE"," ",932],"{",["T_WHITESPACE","\n      ",932],["T_VARIABLE","$table_name",933],["T_WHITESPACE"," ",933],"=",["T_WHITESPACE"," ",933],["T_VARIABLE","$this",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","baseTable",933],";",["T_WHITESPACE","\n    ",933],"}",["T_WHITESPACE","\n\n    ",934],["T_VARIABLE","$record",936],["T_WHITESPACE"," ",936],"=",["T_WHITESPACE"," ",936],["T_NEW","new",936],["T_WHITESPACE"," ",936],["T_NS_SEPARATOR","\\",936],["T_STRING","stdClass",936],"(",")",";",["T_WHITESPACE","\n    ",936],["T_VARIABLE","$table_mapping",937],["T_WHITESPACE"," ",937],"=",["T_WHITESPACE"," ",937],["T_VARIABLE","$this",937],["T_OBJECT_OPERATOR","->",937],["T_STRING","getTableMapping",937],"(",")",";",["T_WHITESPACE","\n    ",937],["T_FOREACH","foreach",938],["T_WHITESPACE"," ",938],"(",["T_VARIABLE","$table_mapping",938],["T_OBJECT_OPERATOR","->",938],["T_STRING","getFieldNames",938],"(",["T_VARIABLE","$table_name",938],")",["T_WHITESPACE"," ",938],["T_AS","as",938],["T_WHITESPACE"," ",938],["T_VARIABLE","$field_name",938],")",["T_WHITESPACE"," ",938],"{",["T_WHITESPACE","\n\n      ",938],["T_IF","if",940],["T_WHITESPACE"," ",940],"(",["T_EMPTY","empty",940],"(",["T_VARIABLE","$this",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","getFieldStorageDefinitions",940],"(",")","[",["T_VARIABLE","$field_name",940],"]",")",")",["T_WHITESPACE"," ",940],"{",["T_WHITESPACE","\n        ",940],["T_THROW","throw",941],["T_WHITESPACE"," ",941],["T_NEW","new",941],["T_WHITESPACE"," ",941],["T_STRING","EntityStorageException",941],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Table mapping contains invalid field ",941],["T_VARIABLE","$field_name",941],["T_ENCAPSED_AND_WHITESPACE",".",941],"\"",")",";",["T_WHITESPACE","\n      ",941],"}",["T_WHITESPACE","\n      ",942],["T_VARIABLE","$definition",943],["T_WHITESPACE"," ",943],"=",["T_WHITESPACE"," ",943],["T_VARIABLE","$this",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","getFieldStorageDefinitions",943],"(",")","[",["T_VARIABLE","$field_name",943],"]",";",["T_WHITESPACE","\n      ",943],["T_VARIABLE","$columns",944],["T_WHITESPACE"," ",944],"=",["T_WHITESPACE"," ",944],["T_VARIABLE","$table_mapping",944],["T_OBJECT_OPERATOR","->",944],["T_STRING","getColumnNames",944],"(",["T_VARIABLE","$field_name",944],")",";",["T_WHITESPACE","\n\n      ",944],["T_FOREACH","foreach",946],["T_WHITESPACE"," ",946],"(",["T_VARIABLE","$columns",946],["T_WHITESPACE"," ",946],["T_AS","as",946],["T_WHITESPACE"," ",946],["T_VARIABLE","$column_name",946],["T_WHITESPACE"," ",946],["T_DOUBLE_ARROW","=>",946],["T_WHITESPACE"," ",946],["T_VARIABLE","$schema_name",946],")",["T_WHITESPACE"," ",946],"{",["T_WHITESPACE","\n        ",946],["T_COMMENT","\/\/ If there is no main property and only a single column, get all\n",947],["T_WHITESPACE","        ",948],["T_COMMENT","\/\/ properties from the first field item and assume that they will be\n",948],["T_WHITESPACE","        ",949],["T_COMMENT","\/\/ stored serialized.\n",949],["T_WHITESPACE","        ",950],["T_COMMENT","\/\/ @todo Give field types more control over this behavior in\n",950],["T_WHITESPACE","        ",951],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2232427.\n",951],["T_WHITESPACE","        ",952],["T_IF","if",952],["T_WHITESPACE"," ",952],"(","!",["T_VARIABLE","$definition",952],["T_OBJECT_OPERATOR","->",952],["T_STRING","getMainPropertyName",952],"(",")",["T_WHITESPACE"," ",952],["T_BOOLEAN_AND","&&",952],["T_WHITESPACE"," ",952],["T_STRING","count",952],"(",["T_VARIABLE","$columns",952],")",["T_WHITESPACE"," ",952],["T_IS_EQUAL","==",952],["T_WHITESPACE"," ",952],["T_LNUMBER","1",952],")",["T_WHITESPACE"," ",952],"{",["T_WHITESPACE","\n          ",952],["T_VARIABLE","$value",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],"(",["T_VARIABLE","$item",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],["T_VARIABLE","$entity",953],["T_OBJECT_OPERATOR","->",953],["T_VARIABLE","$field_name",953],["T_OBJECT_OPERATOR","->",953],["T_STRING","first",953],"(",")",")",["T_WHITESPACE"," ",953],"?",["T_WHITESPACE"," ",953],["T_VARIABLE","$item",953],["T_OBJECT_OPERATOR","->",953],["T_STRING","getValue",953],"(",")",["T_WHITESPACE"," ",953],":",["T_WHITESPACE"," ",953],["T_ARRAY","array",953],"(",")",";",["T_WHITESPACE","\n        ",953],"}",["T_WHITESPACE","\n        ",954],["T_ELSE","else",955],["T_WHITESPACE"," ",955],"{",["T_WHITESPACE","\n          ",955],["T_VARIABLE","$value",956],["T_WHITESPACE"," ",956],"=",["T_WHITESPACE"," ",956],["T_ISSET","isset",956],"(",["T_VARIABLE","$entity",956],["T_OBJECT_OPERATOR","->",956],["T_VARIABLE","$field_name",956],["T_OBJECT_OPERATOR","->",956],["T_VARIABLE","$column_name",956],")",["T_WHITESPACE"," ",956],"?",["T_WHITESPACE"," ",956],["T_VARIABLE","$entity",956],["T_OBJECT_OPERATOR","->",956],["T_VARIABLE","$field_name",956],["T_OBJECT_OPERATOR","->",956],["T_VARIABLE","$column_name",956],["T_WHITESPACE"," ",956],":",["T_WHITESPACE"," ",956],["T_STRING","NULL",956],";",["T_WHITESPACE","\n        ",956],"}",["T_WHITESPACE","\n        ",957],["T_IF","if",958],["T_WHITESPACE"," ",958],"(","!",["T_EMPTY","empty",958],"(",["T_VARIABLE","$definition",958],["T_OBJECT_OPERATOR","->",958],["T_STRING","getSchema",958],"(",")","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",958],"]","[",["T_VARIABLE","$column_name",958],"]","[",["T_CONSTANT_ENCAPSED_STRING","'serialize'",958],"]",")",")",["T_WHITESPACE"," ",958],"{",["T_WHITESPACE","\n          ",958],["T_VARIABLE","$value",959],["T_WHITESPACE"," ",959],"=",["T_WHITESPACE"," ",959],["T_STRING","serialize",959],"(",["T_VARIABLE","$value",959],")",";",["T_WHITESPACE","\n        ",959],"}",["T_WHITESPACE","\n\n        ",960],["T_COMMENT","\/\/ Do not set serial fields if we do not have a value. This supports all\n",962],["T_WHITESPACE","        ",963],["T_COMMENT","\/\/ SQL database drivers.\n",963],["T_WHITESPACE","        ",964],["T_COMMENT","\/\/ @see https:\/\/www.drupal.org\/node\/2279395\n",964],["T_WHITESPACE","        ",965],["T_VARIABLE","$value",965],["T_WHITESPACE"," ",965],"=",["T_WHITESPACE"," ",965],["T_STRING","drupal_schema_get_field_value",965],"(",["T_VARIABLE","$definition",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","getSchema",965],"(",")","[",["T_CONSTANT_ENCAPSED_STRING","'columns'",965],"]","[",["T_VARIABLE","$column_name",965],"]",",",["T_WHITESPACE"," ",965],["T_VARIABLE","$value",965],")",";",["T_WHITESPACE","\n        ",965],["T_IF","if",966],["T_WHITESPACE"," ",966],"(","!","(",["T_EMPTY","empty",966],"(",["T_VARIABLE","$value",966],")",["T_WHITESPACE"," ",966],["T_BOOLEAN_AND","&&",966],["T_WHITESPACE"," ",966],["T_VARIABLE","$this",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","isColumnSerial",966],"(",["T_VARIABLE","$table_name",966],",",["T_WHITESPACE"," ",966],["T_VARIABLE","$schema_name",966],")",")",")",["T_WHITESPACE"," ",966],"{",["T_WHITESPACE","\n          ",966],["T_VARIABLE","$record",967],["T_OBJECT_OPERATOR","->",967],["T_VARIABLE","$schema_name",967],["T_WHITESPACE"," ",967],"=",["T_WHITESPACE"," ",967],["T_VARIABLE","$value",967],";",["T_WHITESPACE","\n        ",967],"}",["T_WHITESPACE","\n      ",968],"}",["T_WHITESPACE","\n    ",969],"}",["T_WHITESPACE","\n\n    ",970],["T_RETURN","return",972],["T_WHITESPACE"," ",972],["T_VARIABLE","$record",972],";",["T_WHITESPACE","\n  ",972],"}",["T_WHITESPACE","\n\n  ",973],["T_DOC_COMMENT","\/**\n   * Checks whether a field column should be treated as serial.\n   *\n   * @param $table_name\n   *   The name of the table the field column belongs to.\n   * @param $schema_name\n   *   The schema name of the field column.\n   *\n   * @return bool\n   *   TRUE if the column is serial, FALSE otherwise.\n   *\n   * @see \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema::processBaseTable()\n   * @see \\Drupal\\Core\\Entity\\Sql\\SqlContentEntityStorageSchema::processRevisionTable()\n   *\/",975],["T_WHITESPACE","\n  ",988],["T_PROTECTED","protected",989],["T_WHITESPACE"," ",989],["T_FUNCTION","function",989],["T_WHITESPACE"," ",989],["T_STRING","isColumnSerial",989],"(",["T_VARIABLE","$table_name",989],",",["T_WHITESPACE"," ",989],["T_VARIABLE","$schema_name",989],")",["T_WHITESPACE"," ",989],"{",["T_WHITESPACE","\n    ",989],["T_VARIABLE","$result",990],["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_STRING","FALSE",990],";",["T_WHITESPACE","\n\n    ",990],["T_SWITCH","switch",992],["T_WHITESPACE"," ",992],"(",["T_VARIABLE","$table_name",992],")",["T_WHITESPACE"," ",992],"{",["T_WHITESPACE","\n      ",992],["T_CASE","case",993],["T_WHITESPACE"," ",993],["T_VARIABLE","$this",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","baseTable",993],":",["T_WHITESPACE","\n        ",993],["T_VARIABLE","$result",994],["T_WHITESPACE"," ",994],"=",["T_WHITESPACE"," ",994],["T_VARIABLE","$schema_name",994],["T_WHITESPACE"," ",994],["T_IS_EQUAL","==",994],["T_WHITESPACE"," ",994],["T_VARIABLE","$this",994],["T_OBJECT_OPERATOR","->",994],["T_STRING","idKey",994],";",["T_WHITESPACE","\n        ",994],["T_BREAK","break",995],";",["T_WHITESPACE","\n\n      ",995],["T_CASE","case",997],["T_WHITESPACE"," ",997],["T_VARIABLE","$this",997],["T_OBJECT_OPERATOR","->",997],["T_STRING","revisionTable",997],":",["T_WHITESPACE","\n        ",997],["T_VARIABLE","$result",998],["T_WHITESPACE"," ",998],"=",["T_WHITESPACE"," ",998],["T_VARIABLE","$schema_name",998],["T_WHITESPACE"," ",998],["T_IS_EQUAL","==",998],["T_WHITESPACE"," ",998],["T_VARIABLE","$this",998],["T_OBJECT_OPERATOR","->",998],["T_STRING","revisionKey",998],";",["T_WHITESPACE","\n        ",998],["T_BREAK","break",999],";",["T_WHITESPACE","\n    ",999],"}",["T_WHITESPACE","\n\n    ",1000],["T_RETURN","return",1002],["T_WHITESPACE"," ",1002],["T_VARIABLE","$result",1002],";",["T_WHITESPACE","\n  ",1002],"}",["T_WHITESPACE","\n\n  ",1003],["T_DOC_COMMENT","\/**\n   * Maps from an entity object to the storage record of the field data.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityInterface $entity\n   *   The entity object.\n   * @param string $table_name\n   *   (optional) The table name to map records to. Defaults to the data table.\n   *\n   * @return \\stdClass\n   *   The record to store.\n   *\/",1005],["T_WHITESPACE","\n  ",1015],["T_PROTECTED","protected",1016],["T_WHITESPACE"," ",1016],["T_FUNCTION","function",1016],["T_WHITESPACE"," ",1016],["T_STRING","mapToDataStorageRecord",1016],"(",["T_STRING","EntityInterface",1016],["T_WHITESPACE"," ",1016],["T_VARIABLE","$entity",1016],",",["T_WHITESPACE"," ",1016],["T_VARIABLE","$table_name",1016],["T_WHITESPACE"," ",1016],"=",["T_WHITESPACE"," ",1016],["T_STRING","NULL",1016],")",["T_WHITESPACE"," ",1016],"{",["T_WHITESPACE","\n    ",1016],["T_IF","if",1017],["T_WHITESPACE"," ",1017],"(","!",["T_ISSET","isset",1017],"(",["T_VARIABLE","$table_name",1017],")",")",["T_WHITESPACE"," ",1017],"{",["T_WHITESPACE","\n      ",1017],["T_VARIABLE","$table_name",1018],["T_WHITESPACE"," ",1018],"=",["T_WHITESPACE"," ",1018],["T_VARIABLE","$this",1018],["T_OBJECT_OPERATOR","->",1018],["T_STRING","dataTable",1018],";",["T_WHITESPACE","\n    ",1018],"}",["T_WHITESPACE","\n    ",1019],["T_VARIABLE","$record",1020],["T_WHITESPACE"," ",1020],"=",["T_WHITESPACE"," ",1020],["T_VARIABLE","$this",1020],["T_OBJECT_OPERATOR","->",1020],["T_STRING","mapToStorageRecord",1020],"(",["T_VARIABLE","$entity",1020],",",["T_WHITESPACE"," ",1020],["T_VARIABLE","$table_name",1020],")",";",["T_WHITESPACE","\n    ",1020],["T_RETURN","return",1021],["T_WHITESPACE"," ",1021],["T_VARIABLE","$record",1021],";",["T_WHITESPACE","\n  ",1021],"}",["T_WHITESPACE","\n\n  ",1022],["T_DOC_COMMENT","\/**\n   * Saves an entity revision.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity object.\n   *\n   * @return int\n   *   The revision id.\n   *\/",1024],["T_WHITESPACE","\n  ",1032],["T_PROTECTED","protected",1033],["T_WHITESPACE"," ",1033],["T_FUNCTION","function",1033],["T_WHITESPACE"," ",1033],["T_STRING","saveRevision",1033],"(",["T_STRING","ContentEntityInterface",1033],["T_WHITESPACE"," ",1033],["T_VARIABLE","$entity",1033],")",["T_WHITESPACE"," ",1033],"{",["T_WHITESPACE","\n    ",1033],["T_VARIABLE","$record",1034],["T_WHITESPACE"," ",1034],"=",["T_WHITESPACE"," ",1034],["T_VARIABLE","$this",1034],["T_OBJECT_OPERATOR","->",1034],["T_STRING","mapToStorageRecord",1034],"(",["T_VARIABLE","$entity",1034],["T_OBJECT_OPERATOR","->",1034],["T_STRING","getUntranslated",1034],"(",")",",",["T_WHITESPACE"," ",1034],["T_VARIABLE","$this",1034],["T_OBJECT_OPERATOR","->",1034],["T_STRING","revisionTable",1034],")",";",["T_WHITESPACE","\n\n    ",1034],["T_VARIABLE","$entity",1036],["T_OBJECT_OPERATOR","->",1036],["T_STRING","preSaveRevision",1036],"(",["T_VARIABLE","$this",1036],",",["T_WHITESPACE"," ",1036],["T_VARIABLE","$record",1036],")",";",["T_WHITESPACE","\n\n    ",1036],["T_IF","if",1038],["T_WHITESPACE"," ",1038],"(",["T_VARIABLE","$entity",1038],["T_OBJECT_OPERATOR","->",1038],["T_STRING","isNewRevision",1038],"(",")",")",["T_WHITESPACE"," ",1038],"{",["T_WHITESPACE","\n      ",1038],["T_VARIABLE","$insert_id",1039],["T_WHITESPACE"," ",1039],"=",["T_WHITESPACE"," ",1039],["T_VARIABLE","$this",1039],["T_OBJECT_OPERATOR","->",1039],["T_STRING","database",1039],["T_WHITESPACE","\n        ",1039],["T_OBJECT_OPERATOR","->",1040],["T_STRING","insert",1040],"(",["T_VARIABLE","$this",1040],["T_OBJECT_OPERATOR","->",1040],["T_STRING","revisionTable",1040],",",["T_WHITESPACE"," ",1040],["T_ARRAY","array",1040],"(",["T_CONSTANT_ENCAPSED_STRING","'return'",1040],["T_WHITESPACE"," ",1040],["T_DOUBLE_ARROW","=>",1040],["T_WHITESPACE"," ",1040],["T_STRING","Database",1040],["T_DOUBLE_COLON","::",1040],["T_STRING","RETURN_INSERT_ID",1040],")",")",["T_WHITESPACE","\n        ",1040],["T_OBJECT_OPERATOR","->",1041],["T_STRING","fields",1041],"(",["T_ARRAY_CAST","(array)",1041],["T_WHITESPACE"," ",1041],["T_VARIABLE","$record",1041],")",["T_WHITESPACE","\n        ",1041],["T_OBJECT_OPERATOR","->",1042],["T_STRING","execute",1042],"(",")",";",["T_WHITESPACE","\n      ",1042],["T_COMMENT","\/\/ Even if this is a new revision, the revision ID key might have been\n",1043],["T_WHITESPACE","      ",1044],["T_COMMENT","\/\/ set in which case we should not override the provided revision ID.\n",1044],["T_WHITESPACE","      ",1045],["T_IF","if",1045],["T_WHITESPACE"," ",1045],"(","!",["T_ISSET","isset",1045],"(",["T_VARIABLE","$record",1045],["T_OBJECT_OPERATOR","->",1045],"{",["T_VARIABLE","$this",1045],["T_OBJECT_OPERATOR","->",1045],["T_STRING","revisionKey",1045],"}",")",")",["T_WHITESPACE"," ",1045],"{",["T_WHITESPACE","\n        ",1045],["T_VARIABLE","$record",1046],["T_OBJECT_OPERATOR","->",1046],"{",["T_VARIABLE","$this",1046],["T_OBJECT_OPERATOR","->",1046],["T_STRING","revisionKey",1046],"}",["T_WHITESPACE"," ",1046],"=",["T_WHITESPACE"," ",1046],["T_VARIABLE","$insert_id",1046],";",["T_WHITESPACE","\n      ",1046],"}",["T_WHITESPACE","\n      ",1047],["T_IF","if",1048],["T_WHITESPACE"," ",1048],"(",["T_VARIABLE","$entity",1048],["T_OBJECT_OPERATOR","->",1048],["T_STRING","isDefaultRevision",1048],"(",")",")",["T_WHITESPACE"," ",1048],"{",["T_WHITESPACE","\n        ",1048],["T_VARIABLE","$this",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","database",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","update",1049],"(",["T_VARIABLE","$this",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","entityType",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","getBaseTable",1049],"(",")",")",["T_WHITESPACE","\n          ",1049],["T_OBJECT_OPERATOR","->",1050],["T_STRING","fields",1050],"(",["T_ARRAY","array",1050],"(",["T_VARIABLE","$this",1050],["T_OBJECT_OPERATOR","->",1050],["T_STRING","revisionKey",1050],["T_WHITESPACE"," ",1050],["T_DOUBLE_ARROW","=>",1050],["T_WHITESPACE"," ",1050],["T_VARIABLE","$record",1050],["T_OBJECT_OPERATOR","->",1050],"{",["T_VARIABLE","$this",1050],["T_OBJECT_OPERATOR","->",1050],["T_STRING","revisionKey",1050],"}",")",")",["T_WHITESPACE","\n          ",1050],["T_OBJECT_OPERATOR","->",1051],["T_STRING","condition",1051],"(",["T_VARIABLE","$this",1051],["T_OBJECT_OPERATOR","->",1051],["T_STRING","idKey",1051],",",["T_WHITESPACE"," ",1051],["T_VARIABLE","$record",1051],["T_OBJECT_OPERATOR","->",1051],"{",["T_VARIABLE","$this",1051],["T_OBJECT_OPERATOR","->",1051],["T_STRING","idKey",1051],"}",")",["T_WHITESPACE","\n          ",1051],["T_OBJECT_OPERATOR","->",1052],["T_STRING","execute",1052],"(",")",";",["T_WHITESPACE","\n      ",1052],"}",["T_WHITESPACE","\n    ",1053],"}",["T_WHITESPACE","\n    ",1054],["T_ELSE","else",1055],["T_WHITESPACE"," ",1055],"{",["T_WHITESPACE","\n      ",1055],["T_VARIABLE","$this",1056],["T_OBJECT_OPERATOR","->",1056],["T_STRING","database",1056],["T_WHITESPACE","\n        ",1056],["T_OBJECT_OPERATOR","->",1057],["T_STRING","update",1057],"(",["T_VARIABLE","$this",1057],["T_OBJECT_OPERATOR","->",1057],["T_STRING","revisionTable",1057],")",["T_WHITESPACE","\n        ",1057],["T_OBJECT_OPERATOR","->",1058],["T_STRING","fields",1058],"(",["T_ARRAY_CAST","(array)",1058],["T_WHITESPACE"," ",1058],["T_VARIABLE","$record",1058],")",["T_WHITESPACE","\n        ",1058],["T_OBJECT_OPERATOR","->",1059],["T_STRING","condition",1059],"(",["T_VARIABLE","$this",1059],["T_OBJECT_OPERATOR","->",1059],["T_STRING","revisionKey",1059],",",["T_WHITESPACE"," ",1059],["T_VARIABLE","$record",1059],["T_OBJECT_OPERATOR","->",1059],"{",["T_VARIABLE","$this",1059],["T_OBJECT_OPERATOR","->",1059],["T_STRING","revisionKey",1059],"}",")",["T_WHITESPACE","\n        ",1059],["T_OBJECT_OPERATOR","->",1060],["T_STRING","execute",1060],"(",")",";",["T_WHITESPACE","\n    ",1060],"}",["T_WHITESPACE","\n\n    ",1061],["T_COMMENT","\/\/ Make sure to update the new revision key for the entity.\n",1063],["T_WHITESPACE","    ",1064],["T_VARIABLE","$entity",1064],["T_OBJECT_OPERATOR","->",1064],"{",["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","revisionKey",1064],"}",["T_OBJECT_OPERATOR","->",1064],["T_STRING","value",1064],["T_WHITESPACE"," ",1064],"=",["T_WHITESPACE"," ",1064],["T_VARIABLE","$record",1064],["T_OBJECT_OPERATOR","->",1064],"{",["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","revisionKey",1064],"}",";",["T_WHITESPACE","\n\n    ",1064],["T_RETURN","return",1066],["T_WHITESPACE"," ",1066],["T_VARIABLE","$record",1066],["T_OBJECT_OPERATOR","->",1066],"{",["T_VARIABLE","$this",1066],["T_OBJECT_OPERATOR","->",1066],["T_STRING","revisionKey",1066],"}",";",["T_WHITESPACE","\n  ",1066],"}",["T_WHITESPACE","\n\n  ",1067],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1069],["T_WHITESPACE","\n  ",1071],["T_PROTECTED","protected",1072],["T_WHITESPACE"," ",1072],["T_FUNCTION","function",1072],["T_WHITESPACE"," ",1072],["T_STRING","getQueryServiceName",1072],"(",")",["T_WHITESPACE"," ",1072],"{",["T_WHITESPACE","\n    ",1072],["T_RETURN","return",1073],["T_WHITESPACE"," ",1073],["T_CONSTANT_ENCAPSED_STRING","'entity.query.sql'",1073],";",["T_WHITESPACE","\n  ",1073],"}",["T_WHITESPACE","\n\n  ",1074],["T_DOC_COMMENT","\/**\n   * Loads values of fields stored in dedicated tables for a group of entities.\n   *\n   * @param array &$values\n   *   An array of values keyed by entity ID.\n   * @param bool $load_from_revision\n   *   (optional) Flag to indicate whether revisions should be loaded or not,\n   *   defaults to FALSE.\n   *\/",1076],["T_WHITESPACE","\n  ",1084],["T_PROTECTED","protected",1085],["T_WHITESPACE"," ",1085],["T_FUNCTION","function",1085],["T_WHITESPACE"," ",1085],["T_STRING","loadFromDedicatedTables",1085],"(",["T_ARRAY","array",1085],["T_WHITESPACE"," ",1085],"&",["T_VARIABLE","$values",1085],",",["T_WHITESPACE"," ",1085],["T_VARIABLE","$load_from_revision",1085],")",["T_WHITESPACE"," ",1085],"{",["T_WHITESPACE","\n    ",1085],["T_IF","if",1086],["T_WHITESPACE"," ",1086],"(",["T_EMPTY","empty",1086],"(",["T_VARIABLE","$values",1086],")",")",["T_WHITESPACE"," ",1086],"{",["T_WHITESPACE","\n      ",1086],["T_RETURN","return",1087],";",["T_WHITESPACE","\n    ",1087],"}",["T_WHITESPACE","\n\n    ",1088],["T_COMMENT","\/\/ Collect entities ids, bundles and languages.\n",1090],["T_WHITESPACE","    ",1091],["T_VARIABLE","$bundles",1091],["T_WHITESPACE"," ",1091],"=",["T_WHITESPACE"," ",1091],["T_ARRAY","array",1091],"(",")",";",["T_WHITESPACE","\n    ",1091],["T_VARIABLE","$ids",1092],["T_WHITESPACE"," ",1092],"=",["T_WHITESPACE"," ",1092],["T_ARRAY","array",1092],"(",")",";",["T_WHITESPACE","\n    ",1092],["T_VARIABLE","$default_langcodes",1093],["T_WHITESPACE"," ",1093],"=",["T_WHITESPACE"," ",1093],["T_ARRAY","array",1093],"(",")",";",["T_WHITESPACE","\n    ",1093],["T_FOREACH","foreach",1094],["T_WHITESPACE"," ",1094],"(",["T_VARIABLE","$values",1094],["T_WHITESPACE"," ",1094],["T_AS","as",1094],["T_WHITESPACE"," ",1094],["T_VARIABLE","$key",1094],["T_WHITESPACE"," ",1094],["T_DOUBLE_ARROW","=>",1094],["T_WHITESPACE"," ",1094],["T_VARIABLE","$entity_values",1094],")",["T_WHITESPACE"," ",1094],"{",["T_WHITESPACE","\n      ",1094],["T_VARIABLE","$bundles",1095],"[",["T_VARIABLE","$this",1095],["T_OBJECT_OPERATOR","->",1095],["T_STRING","bundleKey",1095],["T_WHITESPACE"," ",1095],"?",["T_WHITESPACE"," ",1095],["T_VARIABLE","$entity_values",1095],"[",["T_VARIABLE","$this",1095],["T_OBJECT_OPERATOR","->",1095],["T_STRING","bundleKey",1095],"]","[",["T_STRING","LanguageInterface",1095],["T_DOUBLE_COLON","::",1095],["T_STRING","LANGCODE_DEFAULT",1095],"]",["T_WHITESPACE"," ",1095],":",["T_WHITESPACE"," ",1095],["T_VARIABLE","$this",1095],["T_OBJECT_OPERATOR","->",1095],["T_STRING","entityTypeId",1095],"]",["T_WHITESPACE"," ",1095],"=",["T_WHITESPACE"," ",1095],["T_STRING","TRUE",1095],";",["T_WHITESPACE","\n      ",1095],["T_VARIABLE","$ids",1096],"[","]",["T_WHITESPACE"," ",1096],"=",["T_WHITESPACE"," ",1096],"!",["T_VARIABLE","$load_from_revision",1096],["T_WHITESPACE"," ",1096],"?",["T_WHITESPACE"," ",1096],["T_VARIABLE","$key",1096],["T_WHITESPACE"," ",1096],":",["T_WHITESPACE"," ",1096],["T_VARIABLE","$entity_values",1096],"[",["T_VARIABLE","$this",1096],["T_OBJECT_OPERATOR","->",1096],["T_STRING","revisionKey",1096],"]","[",["T_STRING","LanguageInterface",1096],["T_DOUBLE_COLON","::",1096],["T_STRING","LANGCODE_DEFAULT",1096],"]",";",["T_WHITESPACE","\n      ",1096],["T_IF","if",1097],["T_WHITESPACE"," ",1097],"(",["T_VARIABLE","$this",1097],["T_OBJECT_OPERATOR","->",1097],["T_STRING","langcodeKey",1097],["T_WHITESPACE"," ",1097],["T_BOOLEAN_AND","&&",1097],["T_WHITESPACE"," ",1097],["T_ISSET","isset",1097],"(",["T_VARIABLE","$entity_values",1097],"[",["T_VARIABLE","$this",1097],["T_OBJECT_OPERATOR","->",1097],["T_STRING","langcodeKey",1097],"]","[",["T_STRING","LanguageInterface",1097],["T_DOUBLE_COLON","::",1097],["T_STRING","LANGCODE_DEFAULT",1097],"]",")",")",["T_WHITESPACE"," ",1097],"{",["T_WHITESPACE","\n        ",1097],["T_VARIABLE","$default_langcodes",1098],"[",["T_VARIABLE","$key",1098],"]",["T_WHITESPACE"," ",1098],"=",["T_WHITESPACE"," ",1098],["T_VARIABLE","$entity_values",1098],"[",["T_VARIABLE","$this",1098],["T_OBJECT_OPERATOR","->",1098],["T_STRING","langcodeKey",1098],"]","[",["T_STRING","LanguageInterface",1098],["T_DOUBLE_COLON","::",1098],["T_STRING","LANGCODE_DEFAULT",1098],"]",";",["T_WHITESPACE","\n      ",1098],"}",["T_WHITESPACE","\n    ",1099],"}",["T_WHITESPACE","\n\n    ",1100],["T_COMMENT","\/\/ Collect impacted fields.\n",1102],["T_WHITESPACE","    ",1103],["T_VARIABLE","$storage_definitions",1103],["T_WHITESPACE"," ",1103],"=",["T_WHITESPACE"," ",1103],["T_ARRAY","array",1103],"(",")",";",["T_WHITESPACE","\n    ",1103],["T_VARIABLE","$definitions",1104],["T_WHITESPACE"," ",1104],"=",["T_WHITESPACE"," ",1104],["T_ARRAY","array",1104],"(",")",";",["T_WHITESPACE","\n    ",1104],["T_VARIABLE","$table_mapping",1105],["T_WHITESPACE"," ",1105],"=",["T_WHITESPACE"," ",1105],["T_VARIABLE","$this",1105],["T_OBJECT_OPERATOR","->",1105],["T_STRING","getTableMapping",1105],"(",")",";",["T_WHITESPACE","\n    ",1105],["T_FOREACH","foreach",1106],["T_WHITESPACE"," ",1106],"(",["T_VARIABLE","$bundles",1106],["T_WHITESPACE"," ",1106],["T_AS","as",1106],["T_WHITESPACE"," ",1106],["T_VARIABLE","$bundle",1106],["T_WHITESPACE"," ",1106],["T_DOUBLE_ARROW","=>",1106],["T_WHITESPACE"," ",1106],["T_VARIABLE","$v",1106],")",["T_WHITESPACE"," ",1106],"{",["T_WHITESPACE","\n      ",1106],["T_VARIABLE","$definitions",1107],"[",["T_VARIABLE","$bundle",1107],"]",["T_WHITESPACE"," ",1107],"=",["T_WHITESPACE"," ",1107],["T_VARIABLE","$this",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","entityManager",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","getFieldDefinitions",1107],"(",["T_VARIABLE","$this",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","entityTypeId",1107],",",["T_WHITESPACE"," ",1107],["T_VARIABLE","$bundle",1107],")",";",["T_WHITESPACE","\n      ",1107],["T_FOREACH","foreach",1108],["T_WHITESPACE"," ",1108],"(",["T_VARIABLE","$definitions",1108],"[",["T_VARIABLE","$bundle",1108],"]",["T_WHITESPACE"," ",1108],["T_AS","as",1108],["T_WHITESPACE"," ",1108],["T_VARIABLE","$field_name",1108],["T_WHITESPACE"," ",1108],["T_DOUBLE_ARROW","=>",1108],["T_WHITESPACE"," ",1108],["T_VARIABLE","$field_definition",1108],")",["T_WHITESPACE"," ",1108],"{",["T_WHITESPACE","\n        ",1108],["T_VARIABLE","$storage_definition",1109],["T_WHITESPACE"," ",1109],"=",["T_WHITESPACE"," ",1109],["T_VARIABLE","$field_definition",1109],["T_OBJECT_OPERATOR","->",1109],["T_STRING","getFieldStorageDefinition",1109],"(",")",";",["T_WHITESPACE","\n        ",1109],["T_IF","if",1110],["T_WHITESPACE"," ",1110],"(",["T_VARIABLE","$table_mapping",1110],["T_OBJECT_OPERATOR","->",1110],["T_STRING","requiresDedicatedTableStorage",1110],"(",["T_VARIABLE","$storage_definition",1110],")",")",["T_WHITESPACE"," ",1110],"{",["T_WHITESPACE","\n          ",1110],["T_VARIABLE","$storage_definitions",1111],"[",["T_VARIABLE","$field_name",1111],"]",["T_WHITESPACE"," ",1111],"=",["T_WHITESPACE"," ",1111],["T_VARIABLE","$storage_definition",1111],";",["T_WHITESPACE","\n        ",1111],"}",["T_WHITESPACE","\n      ",1112],"}",["T_WHITESPACE","\n    ",1113],"}",["T_WHITESPACE","\n\n    ",1114],["T_COMMENT","\/\/ Load field data.\n",1116],["T_WHITESPACE","    ",1117],["T_VARIABLE","$langcodes",1117],["T_WHITESPACE"," ",1117],"=",["T_WHITESPACE"," ",1117],["T_STRING","array_keys",1117],"(",["T_VARIABLE","$this",1117],["T_OBJECT_OPERATOR","->",1117],["T_STRING","languageManager",1117],["T_OBJECT_OPERATOR","->",1117],["T_STRING","getLanguages",1117],"(",["T_STRING","LanguageInterface",1117],["T_DOUBLE_COLON","::",1117],["T_STRING","STATE_ALL",1117],")",")",";",["T_WHITESPACE","\n    ",1117],["T_FOREACH","foreach",1118],["T_WHITESPACE"," ",1118],"(",["T_VARIABLE","$storage_definitions",1118],["T_WHITESPACE"," ",1118],["T_AS","as",1118],["T_WHITESPACE"," ",1118],["T_VARIABLE","$field_name",1118],["T_WHITESPACE"," ",1118],["T_DOUBLE_ARROW","=>",1118],["T_WHITESPACE"," ",1118],["T_VARIABLE","$storage_definition",1118],")",["T_WHITESPACE"," ",1118],"{",["T_WHITESPACE","\n      ",1118],["T_VARIABLE","$table",1119],["T_WHITESPACE"," ",1119],"=",["T_WHITESPACE"," ",1119],"!",["T_VARIABLE","$load_from_revision",1119],["T_WHITESPACE"," ",1119],"?",["T_WHITESPACE"," ",1119],["T_VARIABLE","$table_mapping",1119],["T_OBJECT_OPERATOR","->",1119],["T_STRING","getDedicatedDataTableName",1119],"(",["T_VARIABLE","$storage_definition",1119],")",["T_WHITESPACE"," ",1119],":",["T_WHITESPACE"," ",1119],["T_VARIABLE","$table_mapping",1119],["T_OBJECT_OPERATOR","->",1119],["T_STRING","getDedicatedRevisionTableName",1119],"(",["T_VARIABLE","$storage_definition",1119],")",";",["T_WHITESPACE","\n\n      ",1119],["T_COMMENT","\/\/ Ensure that only values having valid languages are retrieved. Since we\n",1121],["T_WHITESPACE","      ",1122],["T_COMMENT","\/\/ are loading values for multiple entities, we cannot limit the query to\n",1122],["T_WHITESPACE","      ",1123],["T_COMMENT","\/\/ the available translations.\n",1123],["T_WHITESPACE","      ",1124],["T_VARIABLE","$results",1124],["T_WHITESPACE"," ",1124],"=",["T_WHITESPACE"," ",1124],["T_VARIABLE","$this",1124],["T_OBJECT_OPERATOR","->",1124],["T_STRING","database",1124],["T_OBJECT_OPERATOR","->",1124],["T_STRING","select",1124],"(",["T_VARIABLE","$table",1124],",",["T_WHITESPACE"," ",1124],["T_CONSTANT_ENCAPSED_STRING","'t'",1124],")",["T_WHITESPACE","\n        ",1124],["T_OBJECT_OPERATOR","->",1125],["T_STRING","fields",1125],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1125],")",["T_WHITESPACE","\n        ",1125],["T_OBJECT_OPERATOR","->",1126],["T_STRING","condition",1126],"(","!",["T_VARIABLE","$load_from_revision",1126],["T_WHITESPACE"," ",1126],"?",["T_WHITESPACE"," ",1126],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1126],["T_WHITESPACE"," ",1126],":",["T_WHITESPACE"," ",1126],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1126],",",["T_WHITESPACE"," ",1126],["T_VARIABLE","$ids",1126],",",["T_WHITESPACE"," ",1126],["T_CONSTANT_ENCAPSED_STRING","'IN'",1126],")",["T_WHITESPACE","\n        ",1126],["T_OBJECT_OPERATOR","->",1127],["T_STRING","condition",1127],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1127],",",["T_WHITESPACE"," ",1127],["T_LNUMBER","0",1127],")",["T_WHITESPACE","\n        ",1127],["T_OBJECT_OPERATOR","->",1128],["T_STRING","condition",1128],"(",["T_CONSTANT_ENCAPSED_STRING","'langcode'",1128],",",["T_WHITESPACE"," ",1128],["T_VARIABLE","$langcodes",1128],",",["T_WHITESPACE"," ",1128],["T_CONSTANT_ENCAPSED_STRING","'IN'",1128],")",["T_WHITESPACE","\n        ",1128],["T_OBJECT_OPERATOR","->",1129],["T_STRING","orderBy",1129],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",1129],")",["T_WHITESPACE","\n        ",1129],["T_OBJECT_OPERATOR","->",1130],["T_STRING","execute",1130],"(",")",";",["T_WHITESPACE","\n\n      ",1130],["T_FOREACH","foreach",1132],["T_WHITESPACE"," ",1132],"(",["T_VARIABLE","$results",1132],["T_WHITESPACE"," ",1132],["T_AS","as",1132],["T_WHITESPACE"," ",1132],["T_VARIABLE","$row",1132],")",["T_WHITESPACE"," ",1132],"{",["T_WHITESPACE","\n        ",1132],["T_VARIABLE","$bundle",1133],["T_WHITESPACE"," ",1133],"=",["T_WHITESPACE"," ",1133],["T_VARIABLE","$row",1133],["T_OBJECT_OPERATOR","->",1133],["T_STRING","bundle",1133],";",["T_WHITESPACE","\n\n        ",1133],["T_COMMENT","\/\/ Field values in default language are stored with\n",1135],["T_WHITESPACE","        ",1136],["T_COMMENT","\/\/ LanguageInterface::LANGCODE_DEFAULT as key.\n",1136],["T_WHITESPACE","        ",1137],["T_VARIABLE","$langcode",1137],["T_WHITESPACE"," ",1137],"=",["T_WHITESPACE"," ",1137],["T_STRING","LanguageInterface",1137],["T_DOUBLE_COLON","::",1137],["T_STRING","LANGCODE_DEFAULT",1137],";",["T_WHITESPACE","\n        ",1137],["T_IF","if",1138],["T_WHITESPACE"," ",1138],"(",["T_VARIABLE","$this",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","langcodeKey",1138],["T_WHITESPACE"," ",1138],["T_BOOLEAN_AND","&&",1138],["T_WHITESPACE"," ",1138],["T_ISSET","isset",1138],"(",["T_VARIABLE","$default_langcodes",1138],"[",["T_VARIABLE","$row",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","entity_id",1138],"]",")",["T_WHITESPACE"," ",1138],["T_BOOLEAN_AND","&&",1138],["T_WHITESPACE"," ",1138],["T_VARIABLE","$row",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","langcode",1138],["T_WHITESPACE"," ",1138],["T_IS_NOT_EQUAL","!=",1138],["T_WHITESPACE"," ",1138],["T_VARIABLE","$default_langcodes",1138],"[",["T_VARIABLE","$row",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","entity_id",1138],"]",")",["T_WHITESPACE"," ",1138],"{",["T_WHITESPACE","\n          ",1138],["T_VARIABLE","$langcode",1139],["T_WHITESPACE"," ",1139],"=",["T_WHITESPACE"," ",1139],["T_VARIABLE","$row",1139],["T_OBJECT_OPERATOR","->",1139],["T_STRING","langcode",1139],";",["T_WHITESPACE","\n        ",1139],"}",["T_WHITESPACE","\n\n        ",1140],["T_IF","if",1142],["T_WHITESPACE"," ",1142],"(","!",["T_ISSET","isset",1142],"(",["T_VARIABLE","$values",1142],"[",["T_VARIABLE","$row",1142],["T_OBJECT_OPERATOR","->",1142],["T_STRING","entity_id",1142],"]","[",["T_VARIABLE","$field_name",1142],"]","[",["T_VARIABLE","$langcode",1142],"]",")",")",["T_WHITESPACE"," ",1142],"{",["T_WHITESPACE","\n          ",1142],["T_VARIABLE","$values",1143],"[",["T_VARIABLE","$row",1143],["T_OBJECT_OPERATOR","->",1143],["T_STRING","entity_id",1143],"]","[",["T_VARIABLE","$field_name",1143],"]","[",["T_VARIABLE","$langcode",1143],"]",["T_WHITESPACE"," ",1143],"=",["T_WHITESPACE"," ",1143],["T_ARRAY","array",1143],"(",")",";",["T_WHITESPACE","\n        ",1143],"}",["T_WHITESPACE","\n\n        ",1144],["T_COMMENT","\/\/ Ensure that records for non-translatable fields having invalid\n",1146],["T_WHITESPACE","        ",1147],["T_COMMENT","\/\/ languages are skipped.\n",1147],["T_WHITESPACE","        ",1148],["T_IF","if",1148],["T_WHITESPACE"," ",1148],"(",["T_VARIABLE","$langcode",1148],["T_WHITESPACE"," ",1148],["T_IS_EQUAL","==",1148],["T_WHITESPACE"," ",1148],["T_STRING","LanguageInterface",1148],["T_DOUBLE_COLON","::",1148],["T_STRING","LANGCODE_DEFAULT",1148],["T_WHITESPACE"," ",1148],["T_BOOLEAN_OR","||",1148],["T_WHITESPACE"," ",1148],["T_VARIABLE","$definitions",1148],"[",["T_VARIABLE","$bundle",1148],"]","[",["T_VARIABLE","$field_name",1148],"]",["T_OBJECT_OPERATOR","->",1148],["T_STRING","isTranslatable",1148],"(",")",")",["T_WHITESPACE"," ",1148],"{",["T_WHITESPACE","\n          ",1148],["T_IF","if",1149],["T_WHITESPACE"," ",1149],"(",["T_VARIABLE","$storage_definition",1149],["T_OBJECT_OPERATOR","->",1149],["T_STRING","getCardinality",1149],"(",")",["T_WHITESPACE"," ",1149],["T_IS_EQUAL","==",1149],["T_WHITESPACE"," ",1149],["T_STRING","FieldStorageDefinitionInterface",1149],["T_DOUBLE_COLON","::",1149],["T_STRING","CARDINALITY_UNLIMITED",1149],["T_WHITESPACE"," ",1149],["T_BOOLEAN_OR","||",1149],["T_WHITESPACE"," ",1149],["T_STRING","count",1149],"(",["T_VARIABLE","$values",1149],"[",["T_VARIABLE","$row",1149],["T_OBJECT_OPERATOR","->",1149],["T_STRING","entity_id",1149],"]","[",["T_VARIABLE","$field_name",1149],"]","[",["T_VARIABLE","$langcode",1149],"]",")",["T_WHITESPACE"," ",1149],"<",["T_WHITESPACE"," ",1149],["T_VARIABLE","$storage_definition",1149],["T_OBJECT_OPERATOR","->",1149],["T_STRING","getCardinality",1149],"(",")",")",["T_WHITESPACE"," ",1149],"{",["T_WHITESPACE","\n            ",1149],["T_VARIABLE","$item",1150],["T_WHITESPACE"," ",1150],"=",["T_WHITESPACE"," ",1150],["T_ARRAY","array",1150],"(",")",";",["T_WHITESPACE","\n            ",1150],["T_COMMENT","\/\/ For each column declared by the field, populate the item from the\n",1151],["T_WHITESPACE","            ",1152],["T_COMMENT","\/\/ prefixed database column.\n",1152],["T_WHITESPACE","            ",1153],["T_FOREACH","foreach",1153],["T_WHITESPACE"," ",1153],"(",["T_VARIABLE","$storage_definition",1153],["T_OBJECT_OPERATOR","->",1153],["T_STRING","getColumns",1153],"(",")",["T_WHITESPACE"," ",1153],["T_AS","as",1153],["T_WHITESPACE"," ",1153],["T_VARIABLE","$column",1153],["T_WHITESPACE"," ",1153],["T_DOUBLE_ARROW","=>",1153],["T_WHITESPACE"," ",1153],["T_VARIABLE","$attributes",1153],")",["T_WHITESPACE"," ",1153],"{",["T_WHITESPACE","\n              ",1153],["T_VARIABLE","$column_name",1154],["T_WHITESPACE"," ",1154],"=",["T_WHITESPACE"," ",1154],["T_VARIABLE","$table_mapping",1154],["T_OBJECT_OPERATOR","->",1154],["T_STRING","getFieldColumnName",1154],"(",["T_VARIABLE","$storage_definition",1154],",",["T_WHITESPACE"," ",1154],["T_VARIABLE","$column",1154],")",";",["T_WHITESPACE","\n              ",1154],["T_COMMENT","\/\/ Unserialize the value if specified in the column schema.\n",1155],["T_WHITESPACE","              ",1156],["T_VARIABLE","$item",1156],"[",["T_VARIABLE","$column",1156],"]",["T_WHITESPACE"," ",1156],"=",["T_WHITESPACE"," ",1156],"(","!",["T_EMPTY","empty",1156],"(",["T_VARIABLE","$attributes",1156],"[",["T_CONSTANT_ENCAPSED_STRING","'serialize'",1156],"]",")",")",["T_WHITESPACE"," ",1156],"?",["T_WHITESPACE"," ",1156],["T_STRING","unserialize",1156],"(",["T_VARIABLE","$row",1156],["T_OBJECT_OPERATOR","->",1156],["T_VARIABLE","$column_name",1156],")",["T_WHITESPACE"," ",1156],":",["T_WHITESPACE"," ",1156],["T_VARIABLE","$row",1156],["T_OBJECT_OPERATOR","->",1156],["T_VARIABLE","$column_name",1156],";",["T_WHITESPACE","\n            ",1156],"}",["T_WHITESPACE","\n\n            ",1157],["T_COMMENT","\/\/ Add the item to the field values for the entity.\n",1159],["T_WHITESPACE","            ",1160],["T_VARIABLE","$values",1160],"[",["T_VARIABLE","$row",1160],["T_OBJECT_OPERATOR","->",1160],["T_STRING","entity_id",1160],"]","[",["T_VARIABLE","$field_name",1160],"]","[",["T_VARIABLE","$langcode",1160],"]","[","]",["T_WHITESPACE"," ",1160],"=",["T_WHITESPACE"," ",1160],["T_VARIABLE","$item",1160],";",["T_WHITESPACE","\n          ",1160],"}",["T_WHITESPACE","\n        ",1161],"}",["T_WHITESPACE","\n      ",1162],"}",["T_WHITESPACE","\n    ",1163],"}",["T_WHITESPACE","\n  ",1164],"}",["T_WHITESPACE","\n\n  ",1165],["T_DOC_COMMENT","\/**\n   * Saves values of fields that use dedicated tables.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity.\n   * @param bool $update\n   *   TRUE if the entity is being updated, FALSE if it is being inserted.\n   * @param string[] $names\n   *   (optional) The names of the fields to be stored. Defaults to all the\n   *   available fields.\n   *\/",1167],["T_WHITESPACE","\n  ",1177],["T_PROTECTED","protected",1178],["T_WHITESPACE"," ",1178],["T_FUNCTION","function",1178],["T_WHITESPACE"," ",1178],["T_STRING","saveToDedicatedTables",1178],"(",["T_STRING","ContentEntityInterface",1178],["T_WHITESPACE"," ",1178],["T_VARIABLE","$entity",1178],",",["T_WHITESPACE"," ",1178],["T_VARIABLE","$update",1178],["T_WHITESPACE"," ",1178],"=",["T_WHITESPACE"," ",1178],["T_STRING","TRUE",1178],",",["T_WHITESPACE"," ",1178],["T_VARIABLE","$names",1178],["T_WHITESPACE"," ",1178],"=",["T_WHITESPACE"," ",1178],["T_ARRAY","array",1178],"(",")",")",["T_WHITESPACE"," ",1178],"{",["T_WHITESPACE","\n    ",1178],["T_VARIABLE","$vid",1179],["T_WHITESPACE"," ",1179],"=",["T_WHITESPACE"," ",1179],["T_VARIABLE","$entity",1179],["T_OBJECT_OPERATOR","->",1179],["T_STRING","getRevisionId",1179],"(",")",";",["T_WHITESPACE","\n    ",1179],["T_VARIABLE","$id",1180],["T_WHITESPACE"," ",1180],"=",["T_WHITESPACE"," ",1180],["T_VARIABLE","$entity",1180],["T_OBJECT_OPERATOR","->",1180],["T_STRING","id",1180],"(",")",";",["T_WHITESPACE","\n    ",1180],["T_VARIABLE","$bundle",1181],["T_WHITESPACE"," ",1181],"=",["T_WHITESPACE"," ",1181],["T_VARIABLE","$entity",1181],["T_OBJECT_OPERATOR","->",1181],["T_STRING","bundle",1181],"(",")",";",["T_WHITESPACE","\n    ",1181],["T_VARIABLE","$entity_type",1182],["T_WHITESPACE"," ",1182],"=",["T_WHITESPACE"," ",1182],["T_VARIABLE","$entity",1182],["T_OBJECT_OPERATOR","->",1182],["T_STRING","getEntityTypeId",1182],"(",")",";",["T_WHITESPACE","\n    ",1182],["T_VARIABLE","$default_langcode",1183],["T_WHITESPACE"," ",1183],"=",["T_WHITESPACE"," ",1183],["T_VARIABLE","$entity",1183],["T_OBJECT_OPERATOR","->",1183],["T_STRING","getUntranslated",1183],"(",")",["T_OBJECT_OPERATOR","->",1183],["T_STRING","language",1183],"(",")",["T_OBJECT_OPERATOR","->",1183],["T_STRING","getId",1183],"(",")",";",["T_WHITESPACE","\n    ",1183],["T_VARIABLE","$translation_langcodes",1184],["T_WHITESPACE"," ",1184],"=",["T_WHITESPACE"," ",1184],["T_STRING","array_keys",1184],"(",["T_VARIABLE","$entity",1184],["T_OBJECT_OPERATOR","->",1184],["T_STRING","getTranslationLanguages",1184],"(",")",")",";",["T_WHITESPACE","\n    ",1184],["T_VARIABLE","$table_mapping",1185],["T_WHITESPACE"," ",1185],"=",["T_WHITESPACE"," ",1185],["T_VARIABLE","$this",1185],["T_OBJECT_OPERATOR","->",1185],["T_STRING","getTableMapping",1185],"(",")",";",["T_WHITESPACE","\n\n    ",1185],["T_IF","if",1187],["T_WHITESPACE"," ",1187],"(","!",["T_ISSET","isset",1187],"(",["T_VARIABLE","$vid",1187],")",")",["T_WHITESPACE"," ",1187],"{",["T_WHITESPACE","\n      ",1187],["T_VARIABLE","$vid",1188],["T_WHITESPACE"," ",1188],"=",["T_WHITESPACE"," ",1188],["T_VARIABLE","$id",1188],";",["T_WHITESPACE","\n    ",1188],"}",["T_WHITESPACE","\n\n    ",1189],["T_VARIABLE","$original",1191],["T_WHITESPACE"," ",1191],"=",["T_WHITESPACE"," ",1191],"!",["T_EMPTY","empty",1191],"(",["T_VARIABLE","$entity",1191],["T_OBJECT_OPERATOR","->",1191],["T_STRING","original",1191],")",["T_WHITESPACE"," ",1191],"?",["T_WHITESPACE"," ",1191],["T_VARIABLE","$entity",1191],["T_OBJECT_OPERATOR","->",1191],["T_STRING","original",1191],["T_WHITESPACE"," ",1191],":",["T_WHITESPACE"," ",1191],["T_STRING","NULL",1191],";",["T_WHITESPACE","\n\n    ",1191],["T_COMMENT","\/\/ Determine which fields should be actually stored.\n",1193],["T_WHITESPACE","    ",1194],["T_VARIABLE","$definitions",1194],["T_WHITESPACE"," ",1194],"=",["T_WHITESPACE"," ",1194],["T_VARIABLE","$this",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","entityManager",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","getFieldDefinitions",1194],"(",["T_VARIABLE","$entity_type",1194],",",["T_WHITESPACE"," ",1194],["T_VARIABLE","$bundle",1194],")",";",["T_WHITESPACE","\n    ",1194],["T_IF","if",1195],["T_WHITESPACE"," ",1195],"(",["T_VARIABLE","$names",1195],")",["T_WHITESPACE"," ",1195],"{",["T_WHITESPACE","\n      ",1195],["T_VARIABLE","$definitions",1196],["T_WHITESPACE"," ",1196],"=",["T_WHITESPACE"," ",1196],["T_STRING","array_intersect_key",1196],"(",["T_VARIABLE","$definitions",1196],",",["T_WHITESPACE"," ",1196],["T_STRING","array_flip",1196],"(",["T_VARIABLE","$names",1196],")",")",";",["T_WHITESPACE","\n    ",1196],"}",["T_WHITESPACE","\n\n    ",1197],["T_FOREACH","foreach",1199],["T_WHITESPACE"," ",1199],"(",["T_VARIABLE","$definitions",1199],["T_WHITESPACE"," ",1199],["T_AS","as",1199],["T_WHITESPACE"," ",1199],["T_VARIABLE","$field_name",1199],["T_WHITESPACE"," ",1199],["T_DOUBLE_ARROW","=>",1199],["T_WHITESPACE"," ",1199],["T_VARIABLE","$field_definition",1199],")",["T_WHITESPACE"," ",1199],"{",["T_WHITESPACE","\n      ",1199],["T_VARIABLE","$storage_definition",1200],["T_WHITESPACE"," ",1200],"=",["T_WHITESPACE"," ",1200],["T_VARIABLE","$field_definition",1200],["T_OBJECT_OPERATOR","->",1200],["T_STRING","getFieldStorageDefinition",1200],"(",")",";",["T_WHITESPACE","\n      ",1200],["T_IF","if",1201],["T_WHITESPACE"," ",1201],"(","!",["T_VARIABLE","$table_mapping",1201],["T_OBJECT_OPERATOR","->",1201],["T_STRING","requiresDedicatedTableStorage",1201],"(",["T_VARIABLE","$storage_definition",1201],")",")",["T_WHITESPACE"," ",1201],"{",["T_WHITESPACE","\n        ",1201],["T_CONTINUE","continue",1202],";",["T_WHITESPACE","\n      ",1202],"}",["T_WHITESPACE","\n\n      ",1203],["T_COMMENT","\/\/ When updating an existing revision, keep the existing records if the\n",1205],["T_WHITESPACE","      ",1206],["T_COMMENT","\/\/ field values did not change.\n",1206],["T_WHITESPACE","      ",1207],["T_IF","if",1207],["T_WHITESPACE"," ",1207],"(","!",["T_VARIABLE","$entity",1207],["T_OBJECT_OPERATOR","->",1207],["T_STRING","isNewRevision",1207],"(",")",["T_WHITESPACE"," ",1207],["T_BOOLEAN_AND","&&",1207],["T_WHITESPACE"," ",1207],["T_VARIABLE","$original",1207],["T_WHITESPACE"," ",1207],["T_BOOLEAN_AND","&&",1207],["T_WHITESPACE"," ",1207],"!",["T_VARIABLE","$this",1207],["T_OBJECT_OPERATOR","->",1207],["T_STRING","hasFieldValueChanged",1207],"(",["T_VARIABLE","$field_definition",1207],",",["T_WHITESPACE"," ",1207],["T_VARIABLE","$entity",1207],",",["T_WHITESPACE"," ",1207],["T_VARIABLE","$original",1207],")",")",["T_WHITESPACE"," ",1207],"{",["T_WHITESPACE","\n        ",1207],["T_CONTINUE","continue",1208],";",["T_WHITESPACE","\n      ",1208],"}",["T_WHITESPACE","\n\n      ",1209],["T_VARIABLE","$table_name",1211],["T_WHITESPACE"," ",1211],"=",["T_WHITESPACE"," ",1211],["T_VARIABLE","$table_mapping",1211],["T_OBJECT_OPERATOR","->",1211],["T_STRING","getDedicatedDataTableName",1211],"(",["T_VARIABLE","$storage_definition",1211],")",";",["T_WHITESPACE","\n      ",1211],["T_VARIABLE","$revision_name",1212],["T_WHITESPACE"," ",1212],"=",["T_WHITESPACE"," ",1212],["T_VARIABLE","$table_mapping",1212],["T_OBJECT_OPERATOR","->",1212],["T_STRING","getDedicatedRevisionTableName",1212],"(",["T_VARIABLE","$storage_definition",1212],")",";",["T_WHITESPACE","\n\n      ",1212],["T_COMMENT","\/\/ Delete and insert, rather than update, in case a value was added.\n",1214],["T_WHITESPACE","      ",1215],["T_IF","if",1215],["T_WHITESPACE"," ",1215],"(",["T_VARIABLE","$update",1215],")",["T_WHITESPACE"," ",1215],"{",["T_WHITESPACE","\n        ",1215],["T_COMMENT","\/\/ Only overwrite the field's base table if saving the default revision\n",1216],["T_WHITESPACE","        ",1217],["T_COMMENT","\/\/ of an entity.\n",1217],["T_WHITESPACE","        ",1218],["T_IF","if",1218],["T_WHITESPACE"," ",1218],"(",["T_VARIABLE","$entity",1218],["T_OBJECT_OPERATOR","->",1218],["T_STRING","isDefaultRevision",1218],"(",")",")",["T_WHITESPACE"," ",1218],"{",["T_WHITESPACE","\n          ",1218],["T_VARIABLE","$this",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","database",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","delete",1219],"(",["T_VARIABLE","$table_name",1219],")",["T_WHITESPACE","\n            ",1219],["T_OBJECT_OPERATOR","->",1220],["T_STRING","condition",1220],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1220],",",["T_WHITESPACE"," ",1220],["T_VARIABLE","$id",1220],")",["T_WHITESPACE","\n            ",1220],["T_OBJECT_OPERATOR","->",1221],["T_STRING","execute",1221],"(",")",";",["T_WHITESPACE","\n        ",1221],"}",["T_WHITESPACE","\n        ",1222],["T_IF","if",1223],["T_WHITESPACE"," ",1223],"(",["T_VARIABLE","$this",1223],["T_OBJECT_OPERATOR","->",1223],["T_STRING","entityType",1223],["T_OBJECT_OPERATOR","->",1223],["T_STRING","isRevisionable",1223],"(",")",")",["T_WHITESPACE"," ",1223],"{",["T_WHITESPACE","\n          ",1223],["T_VARIABLE","$this",1224],["T_OBJECT_OPERATOR","->",1224],["T_STRING","database",1224],["T_OBJECT_OPERATOR","->",1224],["T_STRING","delete",1224],"(",["T_VARIABLE","$revision_name",1224],")",["T_WHITESPACE","\n            ",1224],["T_OBJECT_OPERATOR","->",1225],["T_STRING","condition",1225],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1225],",",["T_WHITESPACE"," ",1225],["T_VARIABLE","$id",1225],")",["T_WHITESPACE","\n            ",1225],["T_OBJECT_OPERATOR","->",1226],["T_STRING","condition",1226],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1226],",",["T_WHITESPACE"," ",1226],["T_VARIABLE","$vid",1226],")",["T_WHITESPACE","\n            ",1226],["T_OBJECT_OPERATOR","->",1227],["T_STRING","execute",1227],"(",")",";",["T_WHITESPACE","\n        ",1227],"}",["T_WHITESPACE","\n      ",1228],"}",["T_WHITESPACE","\n\n      ",1229],["T_COMMENT","\/\/ Prepare the multi-insert query.\n",1231],["T_WHITESPACE","      ",1232],["T_VARIABLE","$do_insert",1232],["T_WHITESPACE"," ",1232],"=",["T_WHITESPACE"," ",1232],["T_STRING","FALSE",1232],";",["T_WHITESPACE","\n      ",1232],["T_VARIABLE","$columns",1233],["T_WHITESPACE"," ",1233],"=",["T_WHITESPACE"," ",1233],["T_ARRAY","array",1233],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1233],",",["T_WHITESPACE"," ",1233],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1233],",",["T_WHITESPACE"," ",1233],["T_CONSTANT_ENCAPSED_STRING","'bundle'",1233],",",["T_WHITESPACE"," ",1233],["T_CONSTANT_ENCAPSED_STRING","'delta'",1233],",",["T_WHITESPACE"," ",1233],["T_CONSTANT_ENCAPSED_STRING","'langcode'",1233],")",";",["T_WHITESPACE","\n      ",1233],["T_FOREACH","foreach",1234],["T_WHITESPACE"," ",1234],"(",["T_VARIABLE","$storage_definition",1234],["T_OBJECT_OPERATOR","->",1234],["T_STRING","getColumns",1234],"(",")",["T_WHITESPACE"," ",1234],["T_AS","as",1234],["T_WHITESPACE"," ",1234],["T_VARIABLE","$column",1234],["T_WHITESPACE"," ",1234],["T_DOUBLE_ARROW","=>",1234],["T_WHITESPACE"," ",1234],["T_VARIABLE","$attributes",1234],")",["T_WHITESPACE"," ",1234],"{",["T_WHITESPACE","\n        ",1234],["T_VARIABLE","$columns",1235],"[","]",["T_WHITESPACE"," ",1235],"=",["T_WHITESPACE"," ",1235],["T_VARIABLE","$table_mapping",1235],["T_OBJECT_OPERATOR","->",1235],["T_STRING","getFieldColumnName",1235],"(",["T_VARIABLE","$storage_definition",1235],",",["T_WHITESPACE"," ",1235],["T_VARIABLE","$column",1235],")",";",["T_WHITESPACE","\n      ",1235],"}",["T_WHITESPACE","\n      ",1236],["T_VARIABLE","$query",1237],["T_WHITESPACE"," ",1237],"=",["T_WHITESPACE"," ",1237],["T_VARIABLE","$this",1237],["T_OBJECT_OPERATOR","->",1237],["T_STRING","database",1237],["T_OBJECT_OPERATOR","->",1237],["T_STRING","insert",1237],"(",["T_VARIABLE","$table_name",1237],")",["T_OBJECT_OPERATOR","->",1237],["T_STRING","fields",1237],"(",["T_VARIABLE","$columns",1237],")",";",["T_WHITESPACE","\n      ",1237],["T_IF","if",1238],["T_WHITESPACE"," ",1238],"(",["T_VARIABLE","$this",1238],["T_OBJECT_OPERATOR","->",1238],["T_STRING","entityType",1238],["T_OBJECT_OPERATOR","->",1238],["T_STRING","isRevisionable",1238],"(",")",")",["T_WHITESPACE"," ",1238],"{",["T_WHITESPACE","\n        ",1238],["T_VARIABLE","$revision_query",1239],["T_WHITESPACE"," ",1239],"=",["T_WHITESPACE"," ",1239],["T_VARIABLE","$this",1239],["T_OBJECT_OPERATOR","->",1239],["T_STRING","database",1239],["T_OBJECT_OPERATOR","->",1239],["T_STRING","insert",1239],"(",["T_VARIABLE","$revision_name",1239],")",["T_OBJECT_OPERATOR","->",1239],["T_STRING","fields",1239],"(",["T_VARIABLE","$columns",1239],")",";",["T_WHITESPACE","\n      ",1239],"}",["T_WHITESPACE","\n\n      ",1240],["T_VARIABLE","$langcodes",1242],["T_WHITESPACE"," ",1242],"=",["T_WHITESPACE"," ",1242],["T_VARIABLE","$field_definition",1242],["T_OBJECT_OPERATOR","->",1242],["T_STRING","isTranslatable",1242],"(",")",["T_WHITESPACE"," ",1242],"?",["T_WHITESPACE"," ",1242],["T_VARIABLE","$translation_langcodes",1242],["T_WHITESPACE"," ",1242],":",["T_WHITESPACE"," ",1242],["T_ARRAY","array",1242],"(",["T_VARIABLE","$default_langcode",1242],")",";",["T_WHITESPACE","\n      ",1242],["T_FOREACH","foreach",1243],["T_WHITESPACE"," ",1243],"(",["T_VARIABLE","$langcodes",1243],["T_WHITESPACE"," ",1243],["T_AS","as",1243],["T_WHITESPACE"," ",1243],["T_VARIABLE","$langcode",1243],")",["T_WHITESPACE"," ",1243],"{",["T_WHITESPACE","\n        ",1243],["T_VARIABLE","$delta_count",1244],["T_WHITESPACE"," ",1244],"=",["T_WHITESPACE"," ",1244],["T_LNUMBER","0",1244],";",["T_WHITESPACE","\n        ",1244],["T_VARIABLE","$items",1245],["T_WHITESPACE"," ",1245],"=",["T_WHITESPACE"," ",1245],["T_VARIABLE","$entity",1245],["T_OBJECT_OPERATOR","->",1245],["T_STRING","getTranslation",1245],"(",["T_VARIABLE","$langcode",1245],")",["T_OBJECT_OPERATOR","->",1245],["T_STRING","get",1245],"(",["T_VARIABLE","$field_name",1245],")",";",["T_WHITESPACE","\n        ",1245],["T_VARIABLE","$items",1246],["T_OBJECT_OPERATOR","->",1246],["T_STRING","filterEmptyItems",1246],"(",")",";",["T_WHITESPACE","\n        ",1246],["T_FOREACH","foreach",1247],["T_WHITESPACE"," ",1247],"(",["T_VARIABLE","$items",1247],["T_WHITESPACE"," ",1247],["T_AS","as",1247],["T_WHITESPACE"," ",1247],["T_VARIABLE","$delta",1247],["T_WHITESPACE"," ",1247],["T_DOUBLE_ARROW","=>",1247],["T_WHITESPACE"," ",1247],["T_VARIABLE","$item",1247],")",["T_WHITESPACE"," ",1247],"{",["T_WHITESPACE","\n          ",1247],["T_COMMENT","\/\/ We now know we have something to insert.\n",1248],["T_WHITESPACE","          ",1249],["T_VARIABLE","$do_insert",1249],["T_WHITESPACE"," ",1249],"=",["T_WHITESPACE"," ",1249],["T_STRING","TRUE",1249],";",["T_WHITESPACE","\n          ",1249],["T_VARIABLE","$record",1250],["T_WHITESPACE"," ",1250],"=",["T_WHITESPACE"," ",1250],["T_ARRAY","array",1250],"(",["T_WHITESPACE","\n            ",1250],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1251],["T_WHITESPACE"," ",1251],["T_DOUBLE_ARROW","=>",1251],["T_WHITESPACE"," ",1251],["T_VARIABLE","$id",1251],",",["T_WHITESPACE","\n            ",1251],["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1252],["T_WHITESPACE"," ",1252],["T_DOUBLE_ARROW","=>",1252],["T_WHITESPACE"," ",1252],["T_VARIABLE","$vid",1252],",",["T_WHITESPACE","\n            ",1252],["T_CONSTANT_ENCAPSED_STRING","'bundle'",1253],["T_WHITESPACE"," ",1253],["T_DOUBLE_ARROW","=>",1253],["T_WHITESPACE"," ",1253],["T_VARIABLE","$bundle",1253],",",["T_WHITESPACE","\n            ",1253],["T_CONSTANT_ENCAPSED_STRING","'delta'",1254],["T_WHITESPACE"," ",1254],["T_DOUBLE_ARROW","=>",1254],["T_WHITESPACE"," ",1254],["T_VARIABLE","$delta",1254],",",["T_WHITESPACE","\n            ",1254],["T_CONSTANT_ENCAPSED_STRING","'langcode'",1255],["T_WHITESPACE"," ",1255],["T_DOUBLE_ARROW","=>",1255],["T_WHITESPACE"," ",1255],["T_VARIABLE","$langcode",1255],",",["T_WHITESPACE","\n          ",1255],")",";",["T_WHITESPACE","\n          ",1256],["T_FOREACH","foreach",1257],["T_WHITESPACE"," ",1257],"(",["T_VARIABLE","$storage_definition",1257],["T_OBJECT_OPERATOR","->",1257],["T_STRING","getColumns",1257],"(",")",["T_WHITESPACE"," ",1257],["T_AS","as",1257],["T_WHITESPACE"," ",1257],["T_VARIABLE","$column",1257],["T_WHITESPACE"," ",1257],["T_DOUBLE_ARROW","=>",1257],["T_WHITESPACE"," ",1257],["T_VARIABLE","$attributes",1257],")",["T_WHITESPACE"," ",1257],"{",["T_WHITESPACE","\n            ",1257],["T_VARIABLE","$column_name",1258],["T_WHITESPACE"," ",1258],"=",["T_WHITESPACE"," ",1258],["T_VARIABLE","$table_mapping",1258],["T_OBJECT_OPERATOR","->",1258],["T_STRING","getFieldColumnName",1258],"(",["T_VARIABLE","$storage_definition",1258],",",["T_WHITESPACE"," ",1258],["T_VARIABLE","$column",1258],")",";",["T_WHITESPACE","\n            ",1258],["T_COMMENT","\/\/ Serialize the value if specified in the column schema.\n",1259],["T_WHITESPACE","            ",1260],["T_VARIABLE","$value",1260],["T_WHITESPACE"," ",1260],"=",["T_WHITESPACE"," ",1260],["T_VARIABLE","$item",1260],["T_OBJECT_OPERATOR","->",1260],["T_VARIABLE","$column",1260],";",["T_WHITESPACE","\n            ",1260],["T_IF","if",1261],["T_WHITESPACE"," ",1261],"(","!",["T_EMPTY","empty",1261],"(",["T_VARIABLE","$attributes",1261],"[",["T_CONSTANT_ENCAPSED_STRING","'serialize'",1261],"]",")",")",["T_WHITESPACE"," ",1261],"{",["T_WHITESPACE","\n              ",1261],["T_VARIABLE","$value",1262],["T_WHITESPACE"," ",1262],"=",["T_WHITESPACE"," ",1262],["T_STRING","serialize",1262],"(",["T_VARIABLE","$value",1262],")",";",["T_WHITESPACE","\n            ",1262],"}",["T_WHITESPACE","\n            ",1263],["T_VARIABLE","$record",1264],"[",["T_VARIABLE","$column_name",1264],"]",["T_WHITESPACE"," ",1264],"=",["T_WHITESPACE"," ",1264],["T_STRING","drupal_schema_get_field_value",1264],"(",["T_VARIABLE","$attributes",1264],",",["T_WHITESPACE"," ",1264],["T_VARIABLE","$value",1264],")",";",["T_WHITESPACE","\n          ",1264],"}",["T_WHITESPACE","\n          ",1265],["T_VARIABLE","$query",1266],["T_OBJECT_OPERATOR","->",1266],["T_STRING","values",1266],"(",["T_VARIABLE","$record",1266],")",";",["T_WHITESPACE","\n          ",1266],["T_IF","if",1267],["T_WHITESPACE"," ",1267],"(",["T_VARIABLE","$this",1267],["T_OBJECT_OPERATOR","->",1267],["T_STRING","entityType",1267],["T_OBJECT_OPERATOR","->",1267],["T_STRING","isRevisionable",1267],"(",")",")",["T_WHITESPACE"," ",1267],"{",["T_WHITESPACE","\n            ",1267],["T_VARIABLE","$revision_query",1268],["T_OBJECT_OPERATOR","->",1268],["T_STRING","values",1268],"(",["T_VARIABLE","$record",1268],")",";",["T_WHITESPACE","\n          ",1268],"}",["T_WHITESPACE","\n\n          ",1269],["T_IF","if",1271],["T_WHITESPACE"," ",1271],"(",["T_VARIABLE","$storage_definition",1271],["T_OBJECT_OPERATOR","->",1271],["T_STRING","getCardinality",1271],"(",")",["T_WHITESPACE"," ",1271],["T_IS_NOT_EQUAL","!=",1271],["T_WHITESPACE"," ",1271],["T_STRING","FieldStorageDefinitionInterface",1271],["T_DOUBLE_COLON","::",1271],["T_STRING","CARDINALITY_UNLIMITED",1271],["T_WHITESPACE"," ",1271],["T_BOOLEAN_AND","&&",1271],["T_WHITESPACE"," ",1271],["T_INC","++",1271],["T_VARIABLE","$delta_count",1271],["T_WHITESPACE"," ",1271],["T_IS_EQUAL","==",1271],["T_WHITESPACE"," ",1271],["T_VARIABLE","$storage_definition",1271],["T_OBJECT_OPERATOR","->",1271],["T_STRING","getCardinality",1271],"(",")",")",["T_WHITESPACE"," ",1271],"{",["T_WHITESPACE","\n            ",1271],["T_BREAK","break",1272],";",["T_WHITESPACE","\n          ",1272],"}",["T_WHITESPACE","\n        ",1273],"}",["T_WHITESPACE","\n      ",1274],"}",["T_WHITESPACE","\n\n      ",1275],["T_COMMENT","\/\/ Execute the query if we have values to insert.\n",1277],["T_WHITESPACE","      ",1278],["T_IF","if",1278],["T_WHITESPACE"," ",1278],"(",["T_VARIABLE","$do_insert",1278],")",["T_WHITESPACE"," ",1278],"{",["T_WHITESPACE","\n        ",1278],["T_COMMENT","\/\/ Only overwrite the field's base table if saving the default revision\n",1279],["T_WHITESPACE","        ",1280],["T_COMMENT","\/\/ of an entity.\n",1280],["T_WHITESPACE","        ",1281],["T_IF","if",1281],["T_WHITESPACE"," ",1281],"(",["T_VARIABLE","$entity",1281],["T_OBJECT_OPERATOR","->",1281],["T_STRING","isDefaultRevision",1281],"(",")",")",["T_WHITESPACE"," ",1281],"{",["T_WHITESPACE","\n          ",1281],["T_VARIABLE","$query",1282],["T_OBJECT_OPERATOR","->",1282],["T_STRING","execute",1282],"(",")",";",["T_WHITESPACE","\n        ",1282],"}",["T_WHITESPACE","\n        ",1283],["T_IF","if",1284],["T_WHITESPACE"," ",1284],"(",["T_VARIABLE","$this",1284],["T_OBJECT_OPERATOR","->",1284],["T_STRING","entityType",1284],["T_OBJECT_OPERATOR","->",1284],["T_STRING","isRevisionable",1284],"(",")",")",["T_WHITESPACE"," ",1284],"{",["T_WHITESPACE","\n          ",1284],["T_VARIABLE","$revision_query",1285],["T_OBJECT_OPERATOR","->",1285],["T_STRING","execute",1285],"(",")",";",["T_WHITESPACE","\n        ",1285],"}",["T_WHITESPACE","\n      ",1286],"}",["T_WHITESPACE","\n    ",1287],"}",["T_WHITESPACE","\n  ",1288],"}",["T_WHITESPACE","\n\n  ",1289],["T_DOC_COMMENT","\/**\n   * Deletes values of fields in dedicated tables for all revisions.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity.\n   *\/",1291],["T_WHITESPACE","\n  ",1296],["T_PROTECTED","protected",1297],["T_WHITESPACE"," ",1297],["T_FUNCTION","function",1297],["T_WHITESPACE"," ",1297],["T_STRING","deleteFromDedicatedTables",1297],"(",["T_STRING","ContentEntityInterface",1297],["T_WHITESPACE"," ",1297],["T_VARIABLE","$entity",1297],")",["T_WHITESPACE"," ",1297],"{",["T_WHITESPACE","\n    ",1297],["T_VARIABLE","$table_mapping",1298],["T_WHITESPACE"," ",1298],"=",["T_WHITESPACE"," ",1298],["T_VARIABLE","$this",1298],["T_OBJECT_OPERATOR","->",1298],["T_STRING","getTableMapping",1298],"(",")",";",["T_WHITESPACE","\n    ",1298],["T_FOREACH","foreach",1299],["T_WHITESPACE"," ",1299],"(",["T_VARIABLE","$this",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","entityManager",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","getFieldDefinitions",1299],"(",["T_VARIABLE","$entity",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","getEntityTypeId",1299],"(",")",",",["T_WHITESPACE"," ",1299],["T_VARIABLE","$entity",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","bundle",1299],"(",")",")",["T_WHITESPACE"," ",1299],["T_AS","as",1299],["T_WHITESPACE"," ",1299],["T_VARIABLE","$field_definition",1299],")",["T_WHITESPACE"," ",1299],"{",["T_WHITESPACE","\n      ",1299],["T_VARIABLE","$storage_definition",1300],["T_WHITESPACE"," ",1300],"=",["T_WHITESPACE"," ",1300],["T_VARIABLE","$field_definition",1300],["T_OBJECT_OPERATOR","->",1300],["T_STRING","getFieldStorageDefinition",1300],"(",")",";",["T_WHITESPACE","\n      ",1300],["T_IF","if",1301],["T_WHITESPACE"," ",1301],"(","!",["T_VARIABLE","$table_mapping",1301],["T_OBJECT_OPERATOR","->",1301],["T_STRING","requiresDedicatedTableStorage",1301],"(",["T_VARIABLE","$storage_definition",1301],")",")",["T_WHITESPACE"," ",1301],"{",["T_WHITESPACE","\n        ",1301],["T_CONTINUE","continue",1302],";",["T_WHITESPACE","\n      ",1302],"}",["T_WHITESPACE","\n      ",1303],["T_VARIABLE","$table_name",1304],["T_WHITESPACE"," ",1304],"=",["T_WHITESPACE"," ",1304],["T_VARIABLE","$table_mapping",1304],["T_OBJECT_OPERATOR","->",1304],["T_STRING","getDedicatedDataTableName",1304],"(",["T_VARIABLE","$storage_definition",1304],")",";",["T_WHITESPACE","\n      ",1304],["T_VARIABLE","$revision_name",1305],["T_WHITESPACE"," ",1305],"=",["T_WHITESPACE"," ",1305],["T_VARIABLE","$table_mapping",1305],["T_OBJECT_OPERATOR","->",1305],["T_STRING","getDedicatedRevisionTableName",1305],"(",["T_VARIABLE","$storage_definition",1305],")",";",["T_WHITESPACE","\n      ",1305],["T_VARIABLE","$this",1306],["T_OBJECT_OPERATOR","->",1306],["T_STRING","database",1306],["T_OBJECT_OPERATOR","->",1306],["T_STRING","delete",1306],"(",["T_VARIABLE","$table_name",1306],")",["T_WHITESPACE","\n        ",1306],["T_OBJECT_OPERATOR","->",1307],["T_STRING","condition",1307],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1307],",",["T_WHITESPACE"," ",1307],["T_VARIABLE","$entity",1307],["T_OBJECT_OPERATOR","->",1307],["T_STRING","id",1307],"(",")",")",["T_WHITESPACE","\n        ",1307],["T_OBJECT_OPERATOR","->",1308],["T_STRING","execute",1308],"(",")",";",["T_WHITESPACE","\n      ",1308],["T_IF","if",1309],["T_WHITESPACE"," ",1309],"(",["T_VARIABLE","$this",1309],["T_OBJECT_OPERATOR","->",1309],["T_STRING","entityType",1309],["T_OBJECT_OPERATOR","->",1309],["T_STRING","isRevisionable",1309],"(",")",")",["T_WHITESPACE"," ",1309],"{",["T_WHITESPACE","\n        ",1309],["T_VARIABLE","$this",1310],["T_OBJECT_OPERATOR","->",1310],["T_STRING","database",1310],["T_OBJECT_OPERATOR","->",1310],["T_STRING","delete",1310],"(",["T_VARIABLE","$revision_name",1310],")",["T_WHITESPACE","\n          ",1310],["T_OBJECT_OPERATOR","->",1311],["T_STRING","condition",1311],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1311],",",["T_WHITESPACE"," ",1311],["T_VARIABLE","$entity",1311],["T_OBJECT_OPERATOR","->",1311],["T_STRING","id",1311],"(",")",")",["T_WHITESPACE","\n          ",1311],["T_OBJECT_OPERATOR","->",1312],["T_STRING","execute",1312],"(",")",";",["T_WHITESPACE","\n      ",1312],"}",["T_WHITESPACE","\n    ",1313],"}",["T_WHITESPACE","\n  ",1314],"}",["T_WHITESPACE","\n\n  ",1315],["T_DOC_COMMENT","\/**\n   * Deletes values of fields in dedicated tables for all revisions.\n   *\n   * @param \\Drupal\\Core\\Entity\\ContentEntityInterface $entity\n   *   The entity. It must have a revision ID.\n   *\/",1317],["T_WHITESPACE","\n  ",1322],["T_PROTECTED","protected",1323],["T_WHITESPACE"," ",1323],["T_FUNCTION","function",1323],["T_WHITESPACE"," ",1323],["T_STRING","deleteRevisionFromDedicatedTables",1323],"(",["T_STRING","ContentEntityInterface",1323],["T_WHITESPACE"," ",1323],["T_VARIABLE","$entity",1323],")",["T_WHITESPACE"," ",1323],"{",["T_WHITESPACE","\n    ",1323],["T_VARIABLE","$vid",1324],["T_WHITESPACE"," ",1324],"=",["T_WHITESPACE"," ",1324],["T_VARIABLE","$entity",1324],["T_OBJECT_OPERATOR","->",1324],["T_STRING","getRevisionId",1324],"(",")",";",["T_WHITESPACE","\n    ",1324],["T_IF","if",1325],["T_WHITESPACE"," ",1325],"(",["T_ISSET","isset",1325],"(",["T_VARIABLE","$vid",1325],")",")",["T_WHITESPACE"," ",1325],"{",["T_WHITESPACE","\n      ",1325],["T_VARIABLE","$table_mapping",1326],["T_WHITESPACE"," ",1326],"=",["T_WHITESPACE"," ",1326],["T_VARIABLE","$this",1326],["T_OBJECT_OPERATOR","->",1326],["T_STRING","getTableMapping",1326],"(",")",";",["T_WHITESPACE","\n      ",1326],["T_FOREACH","foreach",1327],["T_WHITESPACE"," ",1327],"(",["T_VARIABLE","$this",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","entityManager",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","getFieldDefinitions",1327],"(",["T_VARIABLE","$entity",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","getEntityTypeId",1327],"(",")",",",["T_WHITESPACE"," ",1327],["T_VARIABLE","$entity",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","bundle",1327],"(",")",")",["T_WHITESPACE"," ",1327],["T_AS","as",1327],["T_WHITESPACE"," ",1327],["T_VARIABLE","$field_definition",1327],")",["T_WHITESPACE"," ",1327],"{",["T_WHITESPACE","\n        ",1327],["T_VARIABLE","$storage_definition",1328],["T_WHITESPACE"," ",1328],"=",["T_WHITESPACE"," ",1328],["T_VARIABLE","$field_definition",1328],["T_OBJECT_OPERATOR","->",1328],["T_STRING","getFieldStorageDefinition",1328],"(",")",";",["T_WHITESPACE","\n        ",1328],["T_IF","if",1329],["T_WHITESPACE"," ",1329],"(","!",["T_VARIABLE","$table_mapping",1329],["T_OBJECT_OPERATOR","->",1329],["T_STRING","requiresDedicatedTableStorage",1329],"(",["T_VARIABLE","$storage_definition",1329],")",")",["T_WHITESPACE"," ",1329],"{",["T_WHITESPACE","\n          ",1329],["T_CONTINUE","continue",1330],";",["T_WHITESPACE","\n        ",1330],"}",["T_WHITESPACE","\n        ",1331],["T_VARIABLE","$revision_name",1332],["T_WHITESPACE"," ",1332],"=",["T_WHITESPACE"," ",1332],["T_VARIABLE","$table_mapping",1332],["T_OBJECT_OPERATOR","->",1332],["T_STRING","getDedicatedRevisionTableName",1332],"(",["T_VARIABLE","$storage_definition",1332],")",";",["T_WHITESPACE","\n        ",1332],["T_VARIABLE","$this",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","database",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","delete",1333],"(",["T_VARIABLE","$revision_name",1333],")",["T_WHITESPACE","\n          ",1333],["T_OBJECT_OPERATOR","->",1334],["T_STRING","condition",1334],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1334],",",["T_WHITESPACE"," ",1334],["T_VARIABLE","$entity",1334],["T_OBJECT_OPERATOR","->",1334],["T_STRING","id",1334],"(",")",")",["T_WHITESPACE","\n          ",1334],["T_OBJECT_OPERATOR","->",1335],["T_STRING","condition",1335],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1335],",",["T_WHITESPACE"," ",1335],["T_VARIABLE","$vid",1335],")",["T_WHITESPACE","\n          ",1335],["T_OBJECT_OPERATOR","->",1336],["T_STRING","execute",1336],"(",")",";",["T_WHITESPACE","\n      ",1336],"}",["T_WHITESPACE","\n    ",1337],"}",["T_WHITESPACE","\n  ",1338],"}",["T_WHITESPACE","\n\n  ",1339],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1341],["T_WHITESPACE","\n  ",1343],["T_PUBLIC","public",1344],["T_WHITESPACE"," ",1344],["T_FUNCTION","function",1344],["T_WHITESPACE"," ",1344],["T_STRING","requiresEntityStorageSchemaChanges",1344],"(",["T_STRING","EntityTypeInterface",1344],["T_WHITESPACE"," ",1344],["T_VARIABLE","$entity_type",1344],",",["T_WHITESPACE"," ",1344],["T_STRING","EntityTypeInterface",1344],["T_WHITESPACE"," ",1344],["T_VARIABLE","$original",1344],")",["T_WHITESPACE"," ",1344],"{",["T_WHITESPACE","\n    ",1344],["T_RETURN","return",1345],["T_WHITESPACE"," ",1345],["T_VARIABLE","$this",1345],["T_OBJECT_OPERATOR","->",1345],["T_STRING","getStorageSchema",1345],"(",")",["T_OBJECT_OPERATOR","->",1345],["T_STRING","requiresEntityStorageSchemaChanges",1345],"(",["T_VARIABLE","$entity_type",1345],",",["T_WHITESPACE"," ",1345],["T_VARIABLE","$original",1345],")",";",["T_WHITESPACE","\n  ",1345],"}",["T_WHITESPACE","\n\n  ",1346],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1348],["T_WHITESPACE","\n  ",1350],["T_PUBLIC","public",1351],["T_WHITESPACE"," ",1351],["T_FUNCTION","function",1351],["T_WHITESPACE"," ",1351],["T_STRING","requiresFieldStorageSchemaChanges",1351],"(",["T_STRING","FieldStorageDefinitionInterface",1351],["T_WHITESPACE"," ",1351],["T_VARIABLE","$storage_definition",1351],",",["T_WHITESPACE"," ",1351],["T_STRING","FieldStorageDefinitionInterface",1351],["T_WHITESPACE"," ",1351],["T_VARIABLE","$original",1351],")",["T_WHITESPACE"," ",1351],"{",["T_WHITESPACE","\n    ",1351],["T_RETURN","return",1352],["T_WHITESPACE"," ",1352],["T_VARIABLE","$this",1352],["T_OBJECT_OPERATOR","->",1352],["T_STRING","getStorageSchema",1352],"(",")",["T_OBJECT_OPERATOR","->",1352],["T_STRING","requiresFieldStorageSchemaChanges",1352],"(",["T_VARIABLE","$storage_definition",1352],",",["T_WHITESPACE"," ",1352],["T_VARIABLE","$original",1352],")",";",["T_WHITESPACE","\n  ",1352],"}",["T_WHITESPACE","\n\n  ",1353],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1355],["T_WHITESPACE","\n  ",1357],["T_PUBLIC","public",1358],["T_WHITESPACE"," ",1358],["T_FUNCTION","function",1358],["T_WHITESPACE"," ",1358],["T_STRING","requiresEntityDataMigration",1358],"(",["T_STRING","EntityTypeInterface",1358],["T_WHITESPACE"," ",1358],["T_VARIABLE","$entity_type",1358],",",["T_WHITESPACE"," ",1358],["T_STRING","EntityTypeInterface",1358],["T_WHITESPACE"," ",1358],["T_VARIABLE","$original",1358],")",["T_WHITESPACE"," ",1358],"{",["T_WHITESPACE","\n    ",1358],["T_RETURN","return",1359],["T_WHITESPACE"," ",1359],["T_VARIABLE","$this",1359],["T_OBJECT_OPERATOR","->",1359],["T_STRING","getStorageSchema",1359],"(",")",["T_OBJECT_OPERATOR","->",1359],["T_STRING","requiresEntityDataMigration",1359],"(",["T_VARIABLE","$entity_type",1359],",",["T_WHITESPACE"," ",1359],["T_VARIABLE","$original",1359],")",";",["T_WHITESPACE","\n  ",1359],"}",["T_WHITESPACE","\n\n  ",1360],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1362],["T_WHITESPACE","\n  ",1364],["T_PUBLIC","public",1365],["T_WHITESPACE"," ",1365],["T_FUNCTION","function",1365],["T_WHITESPACE"," ",1365],["T_STRING","requiresFieldDataMigration",1365],"(",["T_STRING","FieldStorageDefinitionInterface",1365],["T_WHITESPACE"," ",1365],["T_VARIABLE","$storage_definition",1365],",",["T_WHITESPACE"," ",1365],["T_STRING","FieldStorageDefinitionInterface",1365],["T_WHITESPACE"," ",1365],["T_VARIABLE","$original",1365],")",["T_WHITESPACE"," ",1365],"{",["T_WHITESPACE","\n    ",1365],["T_RETURN","return",1366],["T_WHITESPACE"," ",1366],["T_VARIABLE","$this",1366],["T_OBJECT_OPERATOR","->",1366],["T_STRING","getStorageSchema",1366],"(",")",["T_OBJECT_OPERATOR","->",1366],["T_STRING","requiresFieldDataMigration",1366],"(",["T_VARIABLE","$storage_definition",1366],",",["T_WHITESPACE"," ",1366],["T_VARIABLE","$original",1366],")",";",["T_WHITESPACE","\n  ",1366],"}",["T_WHITESPACE","\n\n  ",1367],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1369],["T_WHITESPACE","\n  ",1371],["T_PUBLIC","public",1372],["T_WHITESPACE"," ",1372],["T_FUNCTION","function",1372],["T_WHITESPACE"," ",1372],["T_STRING","onEntityTypeCreate",1372],"(",["T_STRING","EntityTypeInterface",1372],["T_WHITESPACE"," ",1372],["T_VARIABLE","$entity_type",1372],")",["T_WHITESPACE"," ",1372],"{",["T_WHITESPACE","\n    ",1372],["T_VARIABLE","$this",1373],["T_OBJECT_OPERATOR","->",1373],["T_STRING","wrapSchemaException",1373],"(",["T_FUNCTION","function",1373],["T_WHITESPACE"," ",1373],"(",")",["T_WHITESPACE"," ",1373],["T_USE","use",1373],["T_WHITESPACE"," ",1373],"(",["T_VARIABLE","$entity_type",1373],")",["T_WHITESPACE"," ",1373],"{",["T_WHITESPACE","\n      ",1373],["T_VARIABLE","$this",1374],["T_OBJECT_OPERATOR","->",1374],["T_STRING","getStorageSchema",1374],"(",")",["T_OBJECT_OPERATOR","->",1374],["T_STRING","onEntityTypeCreate",1374],"(",["T_VARIABLE","$entity_type",1374],")",";",["T_WHITESPACE","\n    ",1374],"}",")",";",["T_WHITESPACE","\n  ",1375],"}",["T_WHITESPACE","\n\n  ",1376],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1378],["T_WHITESPACE","\n  ",1380],["T_PUBLIC","public",1381],["T_WHITESPACE"," ",1381],["T_FUNCTION","function",1381],["T_WHITESPACE"," ",1381],["T_STRING","onEntityTypeUpdate",1381],"(",["T_STRING","EntityTypeInterface",1381],["T_WHITESPACE"," ",1381],["T_VARIABLE","$entity_type",1381],",",["T_WHITESPACE"," ",1381],["T_STRING","EntityTypeInterface",1381],["T_WHITESPACE"," ",1381],["T_VARIABLE","$original",1381],")",["T_WHITESPACE"," ",1381],"{",["T_WHITESPACE","\n    ",1381],["T_COMMENT","\/\/ Ensure we have an updated entity type definition.\n",1382],["T_WHITESPACE","    ",1383],["T_VARIABLE","$this",1383],["T_OBJECT_OPERATOR","->",1383],["T_STRING","entityType",1383],["T_WHITESPACE"," ",1383],"=",["T_WHITESPACE"," ",1383],["T_VARIABLE","$entity_type",1383],";",["T_WHITESPACE","\n    ",1383],["T_COMMENT","\/\/ The table layout may have changed depending on the new entity type\n",1384],["T_WHITESPACE","    ",1385],["T_COMMENT","\/\/ definition.\n",1385],["T_WHITESPACE","    ",1386],["T_VARIABLE","$this",1386],["T_OBJECT_OPERATOR","->",1386],["T_STRING","initTableLayout",1386],"(",")",";",["T_WHITESPACE","\n    ",1386],["T_COMMENT","\/\/ Let the schema handler adapt to possible table layout changes.\n",1387],["T_WHITESPACE","    ",1388],["T_VARIABLE","$this",1388],["T_OBJECT_OPERATOR","->",1388],["T_STRING","wrapSchemaException",1388],"(",["T_FUNCTION","function",1388],["T_WHITESPACE"," ",1388],"(",")",["T_WHITESPACE"," ",1388],["T_USE","use",1388],["T_WHITESPACE"," ",1388],"(",["T_VARIABLE","$entity_type",1388],",",["T_WHITESPACE"," ",1388],["T_VARIABLE","$original",1388],")",["T_WHITESPACE"," ",1388],"{",["T_WHITESPACE","\n      ",1388],["T_VARIABLE","$this",1389],["T_OBJECT_OPERATOR","->",1389],["T_STRING","getStorageSchema",1389],"(",")",["T_OBJECT_OPERATOR","->",1389],["T_STRING","onEntityTypeUpdate",1389],"(",["T_VARIABLE","$entity_type",1389],",",["T_WHITESPACE"," ",1389],["T_VARIABLE","$original",1389],")",";",["T_WHITESPACE","\n    ",1389],"}",")",";",["T_WHITESPACE","\n  ",1390],"}",["T_WHITESPACE","\n\n  ",1391],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1393],["T_WHITESPACE","\n  ",1395],["T_PUBLIC","public",1396],["T_WHITESPACE"," ",1396],["T_FUNCTION","function",1396],["T_WHITESPACE"," ",1396],["T_STRING","onEntityTypeDelete",1396],"(",["T_STRING","EntityTypeInterface",1396],["T_WHITESPACE"," ",1396],["T_VARIABLE","$entity_type",1396],")",["T_WHITESPACE"," ",1396],"{",["T_WHITESPACE","\n    ",1396],["T_VARIABLE","$this",1397],["T_OBJECT_OPERATOR","->",1397],["T_STRING","wrapSchemaException",1397],"(",["T_FUNCTION","function",1397],["T_WHITESPACE"," ",1397],"(",")",["T_WHITESPACE"," ",1397],["T_USE","use",1397],["T_WHITESPACE"," ",1397],"(",["T_VARIABLE","$entity_type",1397],")",["T_WHITESPACE"," ",1397],"{",["T_WHITESPACE","\n      ",1397],["T_VARIABLE","$this",1398],["T_OBJECT_OPERATOR","->",1398],["T_STRING","getStorageSchema",1398],"(",")",["T_OBJECT_OPERATOR","->",1398],["T_STRING","onEntityTypeDelete",1398],"(",["T_VARIABLE","$entity_type",1398],")",";",["T_WHITESPACE","\n    ",1398],"}",")",";",["T_WHITESPACE","\n  ",1399],"}",["T_WHITESPACE","\n\n  ",1400],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1402],["T_WHITESPACE","\n  ",1404],["T_PUBLIC","public",1405],["T_WHITESPACE"," ",1405],["T_FUNCTION","function",1405],["T_WHITESPACE"," ",1405],["T_STRING","onFieldStorageDefinitionCreate",1405],"(",["T_STRING","FieldStorageDefinitionInterface",1405],["T_WHITESPACE"," ",1405],["T_VARIABLE","$storage_definition",1405],")",["T_WHITESPACE"," ",1405],"{",["T_WHITESPACE","\n    ",1405],["T_COMMENT","\/\/ If we are adding a field stored in a shared table we need to recompute\n",1406],["T_WHITESPACE","    ",1407],["T_COMMENT","\/\/ the table mapping.\n",1407],["T_WHITESPACE","    ",1408],["T_COMMENT","\/\/ @todo This does not belong here. Remove it once we are able to generate a\n",1408],["T_WHITESPACE","    ",1409],["T_COMMENT","\/\/   fresh table mapping in the schema handler. See\n",1409],["T_WHITESPACE","    ",1410],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2274017.\n",1410],["T_WHITESPACE","    ",1411],["T_IF","if",1411],["T_WHITESPACE"," ",1411],"(",["T_VARIABLE","$this",1411],["T_OBJECT_OPERATOR","->",1411],["T_STRING","getTableMapping",1411],"(",")",["T_OBJECT_OPERATOR","->",1411],["T_STRING","allowsSharedTableStorage",1411],"(",["T_VARIABLE","$storage_definition",1411],")",")",["T_WHITESPACE"," ",1411],"{",["T_WHITESPACE","\n      ",1411],["T_VARIABLE","$this",1412],["T_OBJECT_OPERATOR","->",1412],["T_STRING","tableMapping",1412],["T_WHITESPACE"," ",1412],"=",["T_WHITESPACE"," ",1412],["T_STRING","NULL",1412],";",["T_WHITESPACE","\n    ",1412],"}",["T_WHITESPACE","\n    ",1413],["T_VARIABLE","$this",1414],["T_OBJECT_OPERATOR","->",1414],["T_STRING","wrapSchemaException",1414],"(",["T_FUNCTION","function",1414],["T_WHITESPACE"," ",1414],"(",")",["T_WHITESPACE"," ",1414],["T_USE","use",1414],["T_WHITESPACE"," ",1414],"(",["T_VARIABLE","$storage_definition",1414],")",["T_WHITESPACE"," ",1414],"{",["T_WHITESPACE","\n      ",1414],["T_VARIABLE","$this",1415],["T_OBJECT_OPERATOR","->",1415],["T_STRING","getStorageSchema",1415],"(",")",["T_OBJECT_OPERATOR","->",1415],["T_STRING","onFieldStorageDefinitionCreate",1415],"(",["T_VARIABLE","$storage_definition",1415],")",";",["T_WHITESPACE","\n    ",1415],"}",")",";",["T_WHITESPACE","\n  ",1416],"}",["T_WHITESPACE","\n\n  ",1417],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1419],["T_WHITESPACE","\n  ",1421],["T_PUBLIC","public",1422],["T_WHITESPACE"," ",1422],["T_FUNCTION","function",1422],["T_WHITESPACE"," ",1422],["T_STRING","onFieldStorageDefinitionUpdate",1422],"(",["T_STRING","FieldStorageDefinitionInterface",1422],["T_WHITESPACE"," ",1422],["T_VARIABLE","$storage_definition",1422],",",["T_WHITESPACE"," ",1422],["T_STRING","FieldStorageDefinitionInterface",1422],["T_WHITESPACE"," ",1422],["T_VARIABLE","$original",1422],")",["T_WHITESPACE"," ",1422],"{",["T_WHITESPACE","\n    ",1422],["T_VARIABLE","$this",1423],["T_OBJECT_OPERATOR","->",1423],["T_STRING","wrapSchemaException",1423],"(",["T_FUNCTION","function",1423],["T_WHITESPACE"," ",1423],"(",")",["T_WHITESPACE"," ",1423],["T_USE","use",1423],["T_WHITESPACE"," ",1423],"(",["T_VARIABLE","$storage_definition",1423],",",["T_WHITESPACE"," ",1423],["T_VARIABLE","$original",1423],")",["T_WHITESPACE"," ",1423],"{",["T_WHITESPACE","\n      ",1423],["T_VARIABLE","$this",1424],["T_OBJECT_OPERATOR","->",1424],["T_STRING","getStorageSchema",1424],"(",")",["T_OBJECT_OPERATOR","->",1424],["T_STRING","onFieldStorageDefinitionUpdate",1424],"(",["T_VARIABLE","$storage_definition",1424],",",["T_WHITESPACE"," ",1424],["T_VARIABLE","$original",1424],")",";",["T_WHITESPACE","\n    ",1424],"}",")",";",["T_WHITESPACE","\n  ",1425],"}",["T_WHITESPACE","\n\n  ",1426],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1428],["T_WHITESPACE","\n  ",1430],["T_PUBLIC","public",1431],["T_WHITESPACE"," ",1431],["T_FUNCTION","function",1431],["T_WHITESPACE"," ",1431],["T_STRING","onFieldStorageDefinitionDelete",1431],"(",["T_STRING","FieldStorageDefinitionInterface",1431],["T_WHITESPACE"," ",1431],["T_VARIABLE","$storage_definition",1431],")",["T_WHITESPACE"," ",1431],"{",["T_WHITESPACE","\n    ",1431],["T_VARIABLE","$table_mapping",1432],["T_WHITESPACE"," ",1432],"=",["T_WHITESPACE"," ",1432],["T_VARIABLE","$this",1432],["T_OBJECT_OPERATOR","->",1432],["T_STRING","getTableMapping",1432],"(",["T_WHITESPACE","\n      ",1432],["T_VARIABLE","$this",1433],["T_OBJECT_OPERATOR","->",1433],["T_STRING","entityManager",1433],["T_OBJECT_OPERATOR","->",1433],["T_STRING","getLastInstalledFieldStorageDefinitions",1433],"(",["T_VARIABLE","$this",1433],["T_OBJECT_OPERATOR","->",1433],["T_STRING","entityType",1433],["T_OBJECT_OPERATOR","->",1433],["T_STRING","id",1433],"(",")",")",["T_WHITESPACE","\n    ",1433],")",";",["T_WHITESPACE","\n\n    ",1434],["T_COMMENT","\/\/ @todo Remove the FieldStorageConfigInterface check when non-configurable\n",1436],["T_WHITESPACE","    ",1437],["T_COMMENT","\/\/   fields support purging: https:\/\/www.drupal.org\/node\/2282119.\n",1437],["T_WHITESPACE","    ",1438],["T_IF","if",1438],["T_WHITESPACE"," ",1438],"(",["T_VARIABLE","$storage_definition",1438],["T_WHITESPACE"," ",1438],["T_INSTANCEOF","instanceof",1438],["T_WHITESPACE"," ",1438],["T_STRING","FieldStorageConfigInterface",1438],["T_WHITESPACE"," ",1438],["T_BOOLEAN_AND","&&",1438],["T_WHITESPACE"," ",1438],["T_VARIABLE","$table_mapping",1438],["T_OBJECT_OPERATOR","->",1438],["T_STRING","requiresDedicatedTableStorage",1438],"(",["T_VARIABLE","$storage_definition",1438],")",")",["T_WHITESPACE"," ",1438],"{",["T_WHITESPACE","\n      ",1438],["T_COMMENT","\/\/ Mark all data associated with the field for deletion.\n",1439],["T_WHITESPACE","      ",1440],["T_VARIABLE","$table",1440],["T_WHITESPACE"," ",1440],"=",["T_WHITESPACE"," ",1440],["T_VARIABLE","$table_mapping",1440],["T_OBJECT_OPERATOR","->",1440],["T_STRING","getDedicatedDataTableName",1440],"(",["T_VARIABLE","$storage_definition",1440],")",";",["T_WHITESPACE","\n      ",1440],["T_VARIABLE","$revision_table",1441],["T_WHITESPACE"," ",1441],"=",["T_WHITESPACE"," ",1441],["T_VARIABLE","$table_mapping",1441],["T_OBJECT_OPERATOR","->",1441],["T_STRING","getDedicatedRevisionTableName",1441],"(",["T_VARIABLE","$storage_definition",1441],")",";",["T_WHITESPACE","\n      ",1441],["T_VARIABLE","$this",1442],["T_OBJECT_OPERATOR","->",1442],["T_STRING","database",1442],["T_OBJECT_OPERATOR","->",1442],["T_STRING","update",1442],"(",["T_VARIABLE","$table",1442],")",["T_WHITESPACE","\n        ",1442],["T_OBJECT_OPERATOR","->",1443],["T_STRING","fields",1443],"(",["T_ARRAY","array",1443],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1443],["T_WHITESPACE"," ",1443],["T_DOUBLE_ARROW","=>",1443],["T_WHITESPACE"," ",1443],["T_LNUMBER","1",1443],")",")",["T_WHITESPACE","\n        ",1443],["T_OBJECT_OPERATOR","->",1444],["T_STRING","execute",1444],"(",")",";",["T_WHITESPACE","\n      ",1444],["T_IF","if",1445],["T_WHITESPACE"," ",1445],"(",["T_VARIABLE","$this",1445],["T_OBJECT_OPERATOR","->",1445],["T_STRING","entityType",1445],["T_OBJECT_OPERATOR","->",1445],["T_STRING","isRevisionable",1445],"(",")",")",["T_WHITESPACE"," ",1445],"{",["T_WHITESPACE","\n        ",1445],["T_VARIABLE","$this",1446],["T_OBJECT_OPERATOR","->",1446],["T_STRING","database",1446],["T_OBJECT_OPERATOR","->",1446],["T_STRING","update",1446],"(",["T_VARIABLE","$revision_table",1446],")",["T_WHITESPACE","\n          ",1446],["T_OBJECT_OPERATOR","->",1447],["T_STRING","fields",1447],"(",["T_ARRAY","array",1447],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1447],["T_WHITESPACE"," ",1447],["T_DOUBLE_ARROW","=>",1447],["T_WHITESPACE"," ",1447],["T_LNUMBER","1",1447],")",")",["T_WHITESPACE","\n          ",1447],["T_OBJECT_OPERATOR","->",1448],["T_STRING","execute",1448],"(",")",";",["T_WHITESPACE","\n      ",1448],"}",["T_WHITESPACE","\n    ",1449],"}",["T_WHITESPACE","\n\n    ",1450],["T_COMMENT","\/\/ Update the field schema.\n",1452],["T_WHITESPACE","    ",1453],["T_VARIABLE","$this",1453],["T_OBJECT_OPERATOR","->",1453],["T_STRING","wrapSchemaException",1453],"(",["T_FUNCTION","function",1453],["T_WHITESPACE"," ",1453],"(",")",["T_WHITESPACE"," ",1453],["T_USE","use",1453],["T_WHITESPACE"," ",1453],"(",["T_VARIABLE","$storage_definition",1453],")",["T_WHITESPACE"," ",1453],"{",["T_WHITESPACE","\n      ",1453],["T_VARIABLE","$this",1454],["T_OBJECT_OPERATOR","->",1454],["T_STRING","getStorageSchema",1454],"(",")",["T_OBJECT_OPERATOR","->",1454],["T_STRING","onFieldStorageDefinitionDelete",1454],"(",["T_VARIABLE","$storage_definition",1454],")",";",["T_WHITESPACE","\n    ",1454],"}",")",";",["T_WHITESPACE","\n  ",1455],"}",["T_WHITESPACE","\n\n  ",1456],["T_DOC_COMMENT","\/**\n   * Wraps a database schema exception into an entity storage exception.\n   *\n   * @param callable $callback\n   *   The callback to be executed.\n   *\n   * @throws \\Drupal\\Core\\Entity\\EntityStorageException\n   *   When a database schema exception is thrown.\n   *\/",1458],["T_WHITESPACE","\n  ",1466],["T_PROTECTED","protected",1467],["T_WHITESPACE"," ",1467],["T_FUNCTION","function",1467],["T_WHITESPACE"," ",1467],["T_STRING","wrapSchemaException",1467],"(",["T_CALLABLE","callable",1467],["T_WHITESPACE"," ",1467],["T_VARIABLE","$callback",1467],")",["T_WHITESPACE"," ",1467],"{",["T_WHITESPACE","\n    ",1467],["T_VARIABLE","$message",1468],["T_WHITESPACE"," ",1468],"=",["T_WHITESPACE"," ",1468],["T_CONSTANT_ENCAPSED_STRING","'Exception thrown while performing a schema update.'",1468],";",["T_WHITESPACE","\n    ",1468],["T_TRY","try",1469],["T_WHITESPACE"," ",1469],"{",["T_WHITESPACE","\n      ",1469],["T_VARIABLE","$callback",1470],"(",")",";",["T_WHITESPACE","\n    ",1470],"}",["T_WHITESPACE","\n    ",1471],["T_CATCH","catch",1472],["T_WHITESPACE"," ",1472],"(",["T_STRING","SchemaException",1472],["T_WHITESPACE"," ",1472],["T_VARIABLE","$e",1472],")",["T_WHITESPACE"," ",1472],"{",["T_WHITESPACE","\n      ",1472],["T_VARIABLE","$message",1473],["T_WHITESPACE"," ",1473],["T_CONCAT_EQUAL",".=",1473],["T_WHITESPACE"," ",1473],["T_CONSTANT_ENCAPSED_STRING","' '",1473],["T_WHITESPACE"," ",1473],".",["T_WHITESPACE"," ",1473],["T_VARIABLE","$e",1473],["T_OBJECT_OPERATOR","->",1473],["T_STRING","getMessage",1473],"(",")",";",["T_WHITESPACE","\n      ",1473],["T_THROW","throw",1474],["T_WHITESPACE"," ",1474],["T_NEW","new",1474],["T_WHITESPACE"," ",1474],["T_STRING","EntityStorageException",1474],"(",["T_VARIABLE","$message",1474],",",["T_WHITESPACE"," ",1474],["T_LNUMBER","0",1474],",",["T_WHITESPACE"," ",1474],["T_VARIABLE","$e",1474],")",";",["T_WHITESPACE","\n    ",1474],"}",["T_WHITESPACE","\n    ",1475],["T_CATCH","catch",1476],["T_WHITESPACE"," ",1476],"(",["T_STRING","DatabaseExceptionWrapper",1476],["T_WHITESPACE"," ",1476],["T_VARIABLE","$e",1476],")",["T_WHITESPACE"," ",1476],"{",["T_WHITESPACE","\n      ",1476],["T_VARIABLE","$message",1477],["T_WHITESPACE"," ",1477],["T_CONCAT_EQUAL",".=",1477],["T_WHITESPACE"," ",1477],["T_CONSTANT_ENCAPSED_STRING","' '",1477],["T_WHITESPACE"," ",1477],".",["T_WHITESPACE"," ",1477],["T_VARIABLE","$e",1477],["T_OBJECT_OPERATOR","->",1477],["T_STRING","getMessage",1477],"(",")",";",["T_WHITESPACE","\n      ",1477],["T_THROW","throw",1478],["T_WHITESPACE"," ",1478],["T_NEW","new",1478],["T_WHITESPACE"," ",1478],["T_STRING","EntityStorageException",1478],"(",["T_VARIABLE","$message",1478],",",["T_WHITESPACE"," ",1478],["T_LNUMBER","0",1478],",",["T_WHITESPACE"," ",1478],["T_VARIABLE","$e",1478],")",";",["T_WHITESPACE","\n    ",1478],"}",["T_WHITESPACE","\n  ",1479],"}",["T_WHITESPACE","\n\n  ",1480],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1482],["T_WHITESPACE","\n  ",1484],["T_PUBLIC","public",1485],["T_WHITESPACE"," ",1485],["T_FUNCTION","function",1485],["T_WHITESPACE"," ",1485],["T_STRING","onFieldDefinitionDelete",1485],"(",["T_STRING","FieldDefinitionInterface",1485],["T_WHITESPACE"," ",1485],["T_VARIABLE","$field_definition",1485],")",["T_WHITESPACE"," ",1485],"{",["T_WHITESPACE","\n    ",1485],["T_VARIABLE","$table_mapping",1486],["T_WHITESPACE"," ",1486],"=",["T_WHITESPACE"," ",1486],["T_VARIABLE","$this",1486],["T_OBJECT_OPERATOR","->",1486],["T_STRING","getTableMapping",1486],"(",")",";",["T_WHITESPACE","\n    ",1486],["T_VARIABLE","$storage_definition",1487],["T_WHITESPACE"," ",1487],"=",["T_WHITESPACE"," ",1487],["T_VARIABLE","$field_definition",1487],["T_OBJECT_OPERATOR","->",1487],["T_STRING","getFieldStorageDefinition",1487],"(",")",";",["T_WHITESPACE","\n    ",1487],["T_COMMENT","\/\/ Mark field data as deleted.\n",1488],["T_WHITESPACE","    ",1489],["T_IF","if",1489],["T_WHITESPACE"," ",1489],"(",["T_VARIABLE","$table_mapping",1489],["T_OBJECT_OPERATOR","->",1489],["T_STRING","requiresDedicatedTableStorage",1489],"(",["T_VARIABLE","$storage_definition",1489],")",")",["T_WHITESPACE"," ",1489],"{",["T_WHITESPACE","\n      ",1489],["T_VARIABLE","$table_name",1490],["T_WHITESPACE"," ",1490],"=",["T_WHITESPACE"," ",1490],["T_VARIABLE","$table_mapping",1490],["T_OBJECT_OPERATOR","->",1490],["T_STRING","getDedicatedDataTableName",1490],"(",["T_VARIABLE","$storage_definition",1490],")",";",["T_WHITESPACE","\n      ",1490],["T_VARIABLE","$revision_name",1491],["T_WHITESPACE"," ",1491],"=",["T_WHITESPACE"," ",1491],["T_VARIABLE","$table_mapping",1491],["T_OBJECT_OPERATOR","->",1491],["T_STRING","getDedicatedRevisionTableName",1491],"(",["T_VARIABLE","$storage_definition",1491],")",";",["T_WHITESPACE","\n      ",1491],["T_VARIABLE","$this",1492],["T_OBJECT_OPERATOR","->",1492],["T_STRING","database",1492],["T_OBJECT_OPERATOR","->",1492],["T_STRING","update",1492],"(",["T_VARIABLE","$table_name",1492],")",["T_WHITESPACE","\n        ",1492],["T_OBJECT_OPERATOR","->",1493],["T_STRING","fields",1493],"(",["T_ARRAY","array",1493],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1493],["T_WHITESPACE"," ",1493],["T_DOUBLE_ARROW","=>",1493],["T_WHITESPACE"," ",1493],["T_LNUMBER","1",1493],")",")",["T_WHITESPACE","\n        ",1493],["T_OBJECT_OPERATOR","->",1494],["T_STRING","condition",1494],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",1494],",",["T_WHITESPACE"," ",1494],["T_VARIABLE","$field_definition",1494],["T_OBJECT_OPERATOR","->",1494],["T_STRING","getTargetBundle",1494],"(",")",")",["T_WHITESPACE","\n        ",1494],["T_OBJECT_OPERATOR","->",1495],["T_STRING","execute",1495],"(",")",";",["T_WHITESPACE","\n      ",1495],["T_IF","if",1496],["T_WHITESPACE"," ",1496],"(",["T_VARIABLE","$this",1496],["T_OBJECT_OPERATOR","->",1496],["T_STRING","entityType",1496],["T_OBJECT_OPERATOR","->",1496],["T_STRING","isRevisionable",1496],"(",")",")",["T_WHITESPACE"," ",1496],"{",["T_WHITESPACE","\n        ",1496],["T_VARIABLE","$this",1497],["T_OBJECT_OPERATOR","->",1497],["T_STRING","database",1497],["T_OBJECT_OPERATOR","->",1497],["T_STRING","update",1497],"(",["T_VARIABLE","$revision_name",1497],")",["T_WHITESPACE","\n          ",1497],["T_OBJECT_OPERATOR","->",1498],["T_STRING","fields",1498],"(",["T_ARRAY","array",1498],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1498],["T_WHITESPACE"," ",1498],["T_DOUBLE_ARROW","=>",1498],["T_WHITESPACE"," ",1498],["T_LNUMBER","1",1498],")",")",["T_WHITESPACE","\n          ",1498],["T_OBJECT_OPERATOR","->",1499],["T_STRING","condition",1499],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",1499],",",["T_WHITESPACE"," ",1499],["T_VARIABLE","$field_definition",1499],["T_OBJECT_OPERATOR","->",1499],["T_STRING","getTargetBundle",1499],"(",")",")",["T_WHITESPACE","\n          ",1499],["T_OBJECT_OPERATOR","->",1500],["T_STRING","execute",1500],"(",")",";",["T_WHITESPACE","\n      ",1500],"}",["T_WHITESPACE","\n    ",1501],"}",["T_WHITESPACE","\n  ",1502],"}",["T_WHITESPACE","\n\n  ",1503],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1505],["T_WHITESPACE","\n  ",1507],["T_PUBLIC","public",1508],["T_WHITESPACE"," ",1508],["T_FUNCTION","function",1508],["T_WHITESPACE"," ",1508],["T_STRING","onBundleCreate",1508],"(",["T_VARIABLE","$bundle",1508],",",["T_WHITESPACE"," ",1508],["T_VARIABLE","$entity_type_id",1508],")",["T_WHITESPACE"," ",1508],"{",["T_WHITESPACE"," ",1508],"}",["T_WHITESPACE","\n\n  ",1508],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1510],["T_WHITESPACE","\n  ",1512],["T_PUBLIC","public",1513],["T_WHITESPACE"," ",1513],["T_FUNCTION","function",1513],["T_WHITESPACE"," ",1513],["T_STRING","onBundleDelete",1513],"(",["T_VARIABLE","$bundle",1513],",",["T_WHITESPACE"," ",1513],["T_VARIABLE","$entity_type_id",1513],")",["T_WHITESPACE"," ",1513],"{",["T_WHITESPACE"," ",1513],"}",["T_WHITESPACE","\n\n  ",1513],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1515],["T_WHITESPACE","\n  ",1517],["T_PROTECTED","protected",1518],["T_WHITESPACE"," ",1518],["T_FUNCTION","function",1518],["T_WHITESPACE"," ",1518],["T_STRING","readFieldItemsToPurge",1518],"(",["T_STRING","FieldDefinitionInterface",1518],["T_WHITESPACE"," ",1518],["T_VARIABLE","$field_definition",1518],",",["T_WHITESPACE"," ",1518],["T_VARIABLE","$batch_size",1518],")",["T_WHITESPACE"," ",1518],"{",["T_WHITESPACE","\n    ",1518],["T_COMMENT","\/\/ Check whether the whole field storage definition is gone, or just some\n",1519],["T_WHITESPACE","    ",1520],["T_COMMENT","\/\/ bundle fields.\n",1520],["T_WHITESPACE","    ",1521],["T_VARIABLE","$storage_definition",1521],["T_WHITESPACE"," ",1521],"=",["T_WHITESPACE"," ",1521],["T_VARIABLE","$field_definition",1521],["T_OBJECT_OPERATOR","->",1521],["T_STRING","getFieldStorageDefinition",1521],"(",")",";",["T_WHITESPACE","\n    ",1521],["T_VARIABLE","$is_deleted",1522],["T_WHITESPACE"," ",1522],"=",["T_WHITESPACE"," ",1522],["T_VARIABLE","$this",1522],["T_OBJECT_OPERATOR","->",1522],["T_STRING","storageDefinitionIsDeleted",1522],"(",["T_VARIABLE","$storage_definition",1522],")",";",["T_WHITESPACE","\n    ",1522],["T_VARIABLE","$table_mapping",1523],["T_WHITESPACE"," ",1523],"=",["T_WHITESPACE"," ",1523],["T_VARIABLE","$this",1523],["T_OBJECT_OPERATOR","->",1523],["T_STRING","getTableMapping",1523],"(",")",";",["T_WHITESPACE","\n    ",1523],["T_VARIABLE","$table_name",1524],["T_WHITESPACE"," ",1524],"=",["T_WHITESPACE"," ",1524],["T_VARIABLE","$table_mapping",1524],["T_OBJECT_OPERATOR","->",1524],["T_STRING","getDedicatedDataTableName",1524],"(",["T_VARIABLE","$storage_definition",1524],",",["T_WHITESPACE"," ",1524],["T_VARIABLE","$is_deleted",1524],")",";",["T_WHITESPACE","\n\n    ",1524],["T_COMMENT","\/\/ Get the entities which we want to purge first.\n",1526],["T_WHITESPACE","    ",1527],["T_VARIABLE","$entity_query",1527],["T_WHITESPACE"," ",1527],"=",["T_WHITESPACE"," ",1527],["T_VARIABLE","$this",1527],["T_OBJECT_OPERATOR","->",1527],["T_STRING","database",1527],["T_OBJECT_OPERATOR","->",1527],["T_STRING","select",1527],"(",["T_VARIABLE","$table_name",1527],",",["T_WHITESPACE"," ",1527],["T_CONSTANT_ENCAPSED_STRING","'t'",1527],",",["T_WHITESPACE"," ",1527],["T_ARRAY","array",1527],"(",["T_CONSTANT_ENCAPSED_STRING","'fetch'",1527],["T_WHITESPACE"," ",1527],["T_DOUBLE_ARROW","=>",1527],["T_WHITESPACE"," ",1527],["T_NS_SEPARATOR","\\",1527],["T_STRING","PDO",1527],["T_DOUBLE_COLON","::",1527],["T_STRING","FETCH_ASSOC",1527],")",")",";",["T_WHITESPACE","\n    ",1527],["T_VARIABLE","$or",1528],["T_WHITESPACE"," ",1528],"=",["T_WHITESPACE"," ",1528],["T_VARIABLE","$entity_query",1528],["T_OBJECT_OPERATOR","->",1528],["T_STRING","orConditionGroup",1528],"(",")",";",["T_WHITESPACE","\n    ",1528],["T_FOREACH","foreach",1529],["T_WHITESPACE"," ",1529],"(",["T_VARIABLE","$storage_definition",1529],["T_OBJECT_OPERATOR","->",1529],["T_STRING","getColumns",1529],"(",")",["T_WHITESPACE"," ",1529],["T_AS","as",1529],["T_WHITESPACE"," ",1529],["T_VARIABLE","$column_name",1529],["T_WHITESPACE"," ",1529],["T_DOUBLE_ARROW","=>",1529],["T_WHITESPACE"," ",1529],["T_VARIABLE","$data",1529],")",["T_WHITESPACE"," ",1529],"{",["T_WHITESPACE","\n      ",1529],["T_VARIABLE","$or",1530],["T_OBJECT_OPERATOR","->",1530],["T_STRING","isNotNull",1530],"(",["T_VARIABLE","$table_mapping",1530],["T_OBJECT_OPERATOR","->",1530],["T_STRING","getFieldColumnName",1530],"(",["T_VARIABLE","$storage_definition",1530],",",["T_WHITESPACE"," ",1530],["T_VARIABLE","$column_name",1530],")",")",";",["T_WHITESPACE","\n    ",1530],"}",["T_WHITESPACE","\n    ",1531],["T_VARIABLE","$entity_query",1532],["T_WHITESPACE","\n      ",1532],["T_OBJECT_OPERATOR","->",1533],["T_STRING","distinct",1533],"(",["T_STRING","TRUE",1533],")",["T_WHITESPACE","\n      ",1533],["T_OBJECT_OPERATOR","->",1534],["T_STRING","fields",1534],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1534],",",["T_WHITESPACE"," ",1534],["T_ARRAY","array",1534],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1534],")",")",["T_WHITESPACE","\n      ",1534],["T_OBJECT_OPERATOR","->",1535],["T_STRING","condition",1535],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",1535],",",["T_WHITESPACE"," ",1535],["T_VARIABLE","$field_definition",1535],["T_OBJECT_OPERATOR","->",1535],["T_STRING","getTargetBundle",1535],"(",")",")",["T_WHITESPACE","\n      ",1535],["T_OBJECT_OPERATOR","->",1536],["T_STRING","range",1536],"(",["T_LNUMBER","0",1536],",",["T_WHITESPACE"," ",1536],["T_VARIABLE","$batch_size",1536],")",";",["T_WHITESPACE","\n\n    ",1536],["T_COMMENT","\/\/ Create a map of field data table column names to field column names.\n",1538],["T_WHITESPACE","    ",1539],["T_VARIABLE","$column_map",1539],["T_WHITESPACE"," ",1539],"=",["T_WHITESPACE"," ",1539],["T_ARRAY","array",1539],"(",")",";",["T_WHITESPACE","\n    ",1539],["T_FOREACH","foreach",1540],["T_WHITESPACE"," ",1540],"(",["T_VARIABLE","$storage_definition",1540],["T_OBJECT_OPERATOR","->",1540],["T_STRING","getColumns",1540],"(",")",["T_WHITESPACE"," ",1540],["T_AS","as",1540],["T_WHITESPACE"," ",1540],["T_VARIABLE","$column_name",1540],["T_WHITESPACE"," ",1540],["T_DOUBLE_ARROW","=>",1540],["T_WHITESPACE"," ",1540],["T_VARIABLE","$data",1540],")",["T_WHITESPACE"," ",1540],"{",["T_WHITESPACE","\n      ",1540],["T_VARIABLE","$column_map",1541],"[",["T_VARIABLE","$table_mapping",1541],["T_OBJECT_OPERATOR","->",1541],["T_STRING","getFieldColumnName",1541],"(",["T_VARIABLE","$storage_definition",1541],",",["T_WHITESPACE"," ",1541],["T_VARIABLE","$column_name",1541],")","]",["T_WHITESPACE"," ",1541],"=",["T_WHITESPACE"," ",1541],["T_VARIABLE","$column_name",1541],";",["T_WHITESPACE","\n    ",1541],"}",["T_WHITESPACE","\n\n    ",1542],["T_VARIABLE","$entities",1544],["T_WHITESPACE"," ",1544],"=",["T_WHITESPACE"," ",1544],["T_ARRAY","array",1544],"(",")",";",["T_WHITESPACE","\n    ",1544],["T_VARIABLE","$items_by_entity",1545],["T_WHITESPACE"," ",1545],"=",["T_WHITESPACE"," ",1545],["T_ARRAY","array",1545],"(",")",";",["T_WHITESPACE","\n    ",1545],["T_FOREACH","foreach",1546],["T_WHITESPACE"," ",1546],"(",["T_VARIABLE","$entity_query",1546],["T_OBJECT_OPERATOR","->",1546],["T_STRING","execute",1546],"(",")",["T_WHITESPACE"," ",1546],["T_AS","as",1546],["T_WHITESPACE"," ",1546],["T_VARIABLE","$row",1546],")",["T_WHITESPACE"," ",1546],"{",["T_WHITESPACE","\n      ",1546],["T_VARIABLE","$item_query",1547],["T_WHITESPACE"," ",1547],"=",["T_WHITESPACE"," ",1547],["T_VARIABLE","$this",1547],["T_OBJECT_OPERATOR","->",1547],["T_STRING","database",1547],["T_OBJECT_OPERATOR","->",1547],["T_STRING","select",1547],"(",["T_VARIABLE","$table_name",1547],",",["T_WHITESPACE"," ",1547],["T_CONSTANT_ENCAPSED_STRING","'t'",1547],",",["T_WHITESPACE"," ",1547],["T_ARRAY","array",1547],"(",["T_CONSTANT_ENCAPSED_STRING","'fetch'",1547],["T_WHITESPACE"," ",1547],["T_DOUBLE_ARROW","=>",1547],["T_WHITESPACE"," ",1547],["T_NS_SEPARATOR","\\",1547],["T_STRING","PDO",1547],["T_DOUBLE_COLON","::",1547],["T_STRING","FETCH_ASSOC",1547],")",")",["T_WHITESPACE","\n        ",1547],["T_OBJECT_OPERATOR","->",1548],["T_STRING","fields",1548],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1548],")",["T_WHITESPACE","\n        ",1548],["T_OBJECT_OPERATOR","->",1549],["T_STRING","condition",1549],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1549],",",["T_WHITESPACE"," ",1549],["T_VARIABLE","$row",1549],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1549],"]",")",["T_WHITESPACE","\n        ",1549],["T_OBJECT_OPERATOR","->",1550],["T_STRING","condition",1550],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1550],",",["T_WHITESPACE"," ",1550],["T_LNUMBER","1",1550],")",["T_WHITESPACE","\n        ",1550],["T_OBJECT_OPERATOR","->",1551],["T_STRING","orderBy",1551],"(",["T_CONSTANT_ENCAPSED_STRING","'delta'",1551],")",";",["T_WHITESPACE","\n\n      ",1551],["T_FOREACH","foreach",1553],["T_WHITESPACE"," ",1553],"(",["T_VARIABLE","$item_query",1553],["T_OBJECT_OPERATOR","->",1553],["T_STRING","execute",1553],"(",")",["T_WHITESPACE"," ",1553],["T_AS","as",1553],["T_WHITESPACE"," ",1553],["T_VARIABLE","$item_row",1553],")",["T_WHITESPACE"," ",1553],"{",["T_WHITESPACE","\n        ",1553],["T_IF","if",1554],["T_WHITESPACE"," ",1554],"(","!",["T_ISSET","isset",1554],"(",["T_VARIABLE","$entities",1554],"[",["T_VARIABLE","$item_row",1554],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1554],"]","]",")",")",["T_WHITESPACE"," ",1554],"{",["T_WHITESPACE","\n          ",1554],["T_COMMENT","\/\/ Create entity with the right revision id and entity id combination.\n",1555],["T_WHITESPACE","          ",1556],["T_VARIABLE","$item_row",1556],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",1556],"]",["T_WHITESPACE"," ",1556],"=",["T_WHITESPACE"," ",1556],["T_VARIABLE","$this",1556],["T_OBJECT_OPERATOR","->",1556],["T_STRING","entityTypeId",1556],";",["T_WHITESPACE","\n          ",1556],["T_COMMENT","\/\/ @todo: Replace this by an entity object created via an entity\n",1557],["T_WHITESPACE","          ",1558],["T_COMMENT","\/\/ factory, see https:\/\/www.drupal.org\/node\/1867228.\n",1558],["T_WHITESPACE","          ",1559],["T_VARIABLE","$entities",1559],"[",["T_VARIABLE","$item_row",1559],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1559],"]","]",["T_WHITESPACE"," ",1559],"=",["T_WHITESPACE"," ",1559],["T_STRING","_field_create_entity_from_ids",1559],"(",["T_OBJECT_CAST","(object)",1559],["T_WHITESPACE"," ",1559],["T_VARIABLE","$item_row",1559],")",";",["T_WHITESPACE","\n        ",1559],"}",["T_WHITESPACE","\n        ",1560],["T_VARIABLE","$item",1561],["T_WHITESPACE"," ",1561],"=",["T_WHITESPACE"," ",1561],["T_ARRAY","array",1561],"(",")",";",["T_WHITESPACE","\n        ",1561],["T_FOREACH","foreach",1562],["T_WHITESPACE"," ",1562],"(",["T_VARIABLE","$column_map",1562],["T_WHITESPACE"," ",1562],["T_AS","as",1562],["T_WHITESPACE"," ",1562],["T_VARIABLE","$db_column",1562],["T_WHITESPACE"," ",1562],["T_DOUBLE_ARROW","=>",1562],["T_WHITESPACE"," ",1562],["T_VARIABLE","$field_column",1562],")",["T_WHITESPACE"," ",1562],"{",["T_WHITESPACE","\n          ",1562],["T_VARIABLE","$item",1563],"[",["T_VARIABLE","$field_column",1563],"]",["T_WHITESPACE"," ",1563],"=",["T_WHITESPACE"," ",1563],["T_VARIABLE","$item_row",1563],"[",["T_VARIABLE","$db_column",1563],"]",";",["T_WHITESPACE","\n        ",1563],"}",["T_WHITESPACE","\n        ",1564],["T_VARIABLE","$items_by_entity",1565],"[",["T_VARIABLE","$item_row",1565],"[",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1565],"]","]","[","]",["T_WHITESPACE"," ",1565],"=",["T_WHITESPACE"," ",1565],["T_VARIABLE","$item",1565],";",["T_WHITESPACE","\n      ",1565],"}",["T_WHITESPACE","\n    ",1566],"}",["T_WHITESPACE","\n\n    ",1567],["T_COMMENT","\/\/ Create field item objects and return.\n",1569],["T_WHITESPACE","    ",1570],["T_FOREACH","foreach",1570],["T_WHITESPACE"," ",1570],"(",["T_VARIABLE","$items_by_entity",1570],["T_WHITESPACE"," ",1570],["T_AS","as",1570],["T_WHITESPACE"," ",1570],["T_VARIABLE","$revision_id",1570],["T_WHITESPACE"," ",1570],["T_DOUBLE_ARROW","=>",1570],["T_WHITESPACE"," ",1570],["T_VARIABLE","$values",1570],")",["T_WHITESPACE"," ",1570],"{",["T_WHITESPACE","\n      ",1570],["T_VARIABLE","$entity_adapter",1571],["T_WHITESPACE"," ",1571],"=",["T_WHITESPACE"," ",1571],["T_VARIABLE","$entities",1571],"[",["T_VARIABLE","$revision_id",1571],"]",["T_OBJECT_OPERATOR","->",1571],["T_STRING","getTypedData",1571],"(",")",";",["T_WHITESPACE","\n      ",1571],["T_VARIABLE","$items_by_entity",1572],"[",["T_VARIABLE","$revision_id",1572],"]",["T_WHITESPACE"," ",1572],"=",["T_WHITESPACE"," ",1572],["T_NS_SEPARATOR","\\",1572],["T_STRING","Drupal",1572],["T_DOUBLE_COLON","::",1572],["T_STRING","typedDataManager",1572],"(",")",["T_OBJECT_OPERATOR","->",1572],["T_STRING","create",1572],"(",["T_VARIABLE","$field_definition",1572],",",["T_WHITESPACE"," ",1572],["T_VARIABLE","$values",1572],",",["T_WHITESPACE"," ",1572],["T_VARIABLE","$field_definition",1572],["T_OBJECT_OPERATOR","->",1572],["T_STRING","getName",1572],"(",")",",",["T_WHITESPACE"," ",1572],["T_VARIABLE","$entity_adapter",1572],")",";",["T_WHITESPACE","\n    ",1572],"}",["T_WHITESPACE","\n    ",1573],["T_RETURN","return",1574],["T_WHITESPACE"," ",1574],["T_VARIABLE","$items_by_entity",1574],";",["T_WHITESPACE","\n  ",1574],"}",["T_WHITESPACE","\n\n  ",1575],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1577],["T_WHITESPACE","\n  ",1579],["T_PROTECTED","protected",1580],["T_WHITESPACE"," ",1580],["T_FUNCTION","function",1580],["T_WHITESPACE"," ",1580],["T_STRING","purgeFieldItems",1580],"(",["T_STRING","ContentEntityInterface",1580],["T_WHITESPACE"," ",1580],["T_VARIABLE","$entity",1580],",",["T_WHITESPACE"," ",1580],["T_STRING","FieldDefinitionInterface",1580],["T_WHITESPACE"," ",1580],["T_VARIABLE","$field_definition",1580],")",["T_WHITESPACE"," ",1580],"{",["T_WHITESPACE","\n    ",1580],["T_VARIABLE","$storage_definition",1581],["T_WHITESPACE"," ",1581],"=",["T_WHITESPACE"," ",1581],["T_VARIABLE","$field_definition",1581],["T_OBJECT_OPERATOR","->",1581],["T_STRING","getFieldStorageDefinition",1581],"(",")",";",["T_WHITESPACE","\n    ",1581],["T_VARIABLE","$is_deleted",1582],["T_WHITESPACE"," ",1582],"=",["T_WHITESPACE"," ",1582],["T_VARIABLE","$this",1582],["T_OBJECT_OPERATOR","->",1582],["T_STRING","storageDefinitionIsDeleted",1582],"(",["T_VARIABLE","$storage_definition",1582],")",";",["T_WHITESPACE","\n    ",1582],["T_VARIABLE","$table_mapping",1583],["T_WHITESPACE"," ",1583],"=",["T_WHITESPACE"," ",1583],["T_VARIABLE","$this",1583],["T_OBJECT_OPERATOR","->",1583],["T_STRING","getTableMapping",1583],"(",")",";",["T_WHITESPACE","\n    ",1583],["T_VARIABLE","$table_name",1584],["T_WHITESPACE"," ",1584],"=",["T_WHITESPACE"," ",1584],["T_VARIABLE","$table_mapping",1584],["T_OBJECT_OPERATOR","->",1584],["T_STRING","getDedicatedDataTableName",1584],"(",["T_VARIABLE","$storage_definition",1584],",",["T_WHITESPACE"," ",1584],["T_VARIABLE","$is_deleted",1584],")",";",["T_WHITESPACE","\n    ",1584],["T_VARIABLE","$revision_name",1585],["T_WHITESPACE"," ",1585],"=",["T_WHITESPACE"," ",1585],["T_VARIABLE","$table_mapping",1585],["T_OBJECT_OPERATOR","->",1585],["T_STRING","getDedicatedRevisionTableName",1585],"(",["T_VARIABLE","$storage_definition",1585],",",["T_WHITESPACE"," ",1585],["T_VARIABLE","$is_deleted",1585],")",";",["T_WHITESPACE","\n    ",1585],["T_VARIABLE","$revision_id",1586],["T_WHITESPACE"," ",1586],"=",["T_WHITESPACE"," ",1586],["T_VARIABLE","$this",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","entityType",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","isRevisionable",1586],"(",")",["T_WHITESPACE"," ",1586],"?",["T_WHITESPACE"," ",1586],["T_VARIABLE","$entity",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","getRevisionId",1586],"(",")",["T_WHITESPACE"," ",1586],":",["T_WHITESPACE"," ",1586],["T_VARIABLE","$entity",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","id",1586],"(",")",";",["T_WHITESPACE","\n    ",1586],["T_VARIABLE","$this",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","database",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","delete",1587],"(",["T_VARIABLE","$table_name",1587],")",["T_WHITESPACE","\n      ",1587],["T_OBJECT_OPERATOR","->",1588],["T_STRING","condition",1588],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1588],",",["T_WHITESPACE"," ",1588],["T_VARIABLE","$revision_id",1588],")",["T_WHITESPACE","\n      ",1588],["T_OBJECT_OPERATOR","->",1589],["T_STRING","condition",1589],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1589],",",["T_WHITESPACE"," ",1589],["T_LNUMBER","1",1589],")",["T_WHITESPACE","\n      ",1589],["T_OBJECT_OPERATOR","->",1590],["T_STRING","execute",1590],"(",")",";",["T_WHITESPACE","\n    ",1590],["T_IF","if",1591],["T_WHITESPACE"," ",1591],"(",["T_VARIABLE","$this",1591],["T_OBJECT_OPERATOR","->",1591],["T_STRING","entityType",1591],["T_OBJECT_OPERATOR","->",1591],["T_STRING","isRevisionable",1591],"(",")",")",["T_WHITESPACE"," ",1591],"{",["T_WHITESPACE","\n      ",1591],["T_VARIABLE","$this",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","database",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","delete",1592],"(",["T_VARIABLE","$revision_name",1592],")",["T_WHITESPACE","\n        ",1592],["T_OBJECT_OPERATOR","->",1593],["T_STRING","condition",1593],"(",["T_CONSTANT_ENCAPSED_STRING","'revision_id'",1593],",",["T_WHITESPACE"," ",1593],["T_VARIABLE","$revision_id",1593],")",["T_WHITESPACE","\n        ",1593],["T_OBJECT_OPERATOR","->",1594],["T_STRING","condition",1594],"(",["T_CONSTANT_ENCAPSED_STRING","'deleted'",1594],",",["T_WHITESPACE"," ",1594],["T_LNUMBER","1",1594],")",["T_WHITESPACE","\n        ",1594],["T_OBJECT_OPERATOR","->",1595],["T_STRING","execute",1595],"(",")",";",["T_WHITESPACE","\n    ",1595],"}",["T_WHITESPACE","\n  ",1596],"}",["T_WHITESPACE","\n\n  ",1597],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1599],["T_WHITESPACE","\n  ",1601],["T_PUBLIC","public",1602],["T_WHITESPACE"," ",1602],["T_FUNCTION","function",1602],["T_WHITESPACE"," ",1602],["T_STRING","finalizePurge",1602],"(",["T_STRING","FieldStorageDefinitionInterface",1602],["T_WHITESPACE"," ",1602],["T_VARIABLE","$storage_definition",1602],")",["T_WHITESPACE"," ",1602],"{",["T_WHITESPACE","\n    ",1602],["T_VARIABLE","$this",1603],["T_OBJECT_OPERATOR","->",1603],["T_STRING","getStorageSchema",1603],"(",")",["T_OBJECT_OPERATOR","->",1603],["T_STRING","finalizePurge",1603],"(",["T_VARIABLE","$storage_definition",1603],")",";",["T_WHITESPACE","\n  ",1603],"}",["T_WHITESPACE","\n\n  ",1604],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",1606],["T_WHITESPACE","\n  ",1608],["T_PUBLIC","public",1609],["T_WHITESPACE"," ",1609],["T_FUNCTION","function",1609],["T_WHITESPACE"," ",1609],["T_STRING","countFieldData",1609],"(",["T_VARIABLE","$storage_definition",1609],",",["T_WHITESPACE"," ",1609],["T_VARIABLE","$as_bool",1609],["T_WHITESPACE"," ",1609],"=",["T_WHITESPACE"," ",1609],["T_STRING","FALSE",1609],")",["T_WHITESPACE"," ",1609],"{",["T_WHITESPACE","\n    ",1609],["T_COMMENT","\/\/ The table mapping contains stale data during a request when a field\n",1610],["T_WHITESPACE","    ",1611],["T_COMMENT","\/\/ storage definition is added, so bypass the internal storage definitions\n",1611],["T_WHITESPACE","    ",1612],["T_COMMENT","\/\/ and fetch the table mapping using the passed in storage definition.\n",1612],["T_WHITESPACE","    ",1613],["T_COMMENT","\/\/ @todo Fix this in https:\/\/www.drupal.org\/node\/2705205.\n",1613],["T_WHITESPACE","    ",1614],["T_VARIABLE","$storage_definitions",1614],["T_WHITESPACE"," ",1614],"=",["T_WHITESPACE"," ",1614],["T_VARIABLE","$this",1614],["T_OBJECT_OPERATOR","->",1614],["T_STRING","entityManager",1614],["T_OBJECT_OPERATOR","->",1614],["T_STRING","getFieldStorageDefinitions",1614],"(",["T_VARIABLE","$this",1614],["T_OBJECT_OPERATOR","->",1614],["T_STRING","entityTypeId",1614],")",";",["T_WHITESPACE","\n    ",1614],["T_VARIABLE","$storage_definitions",1615],"[",["T_VARIABLE","$storage_definition",1615],["T_OBJECT_OPERATOR","->",1615],["T_STRING","getName",1615],"(",")","]",["T_WHITESPACE"," ",1615],"=",["T_WHITESPACE"," ",1615],["T_VARIABLE","$storage_definition",1615],";",["T_WHITESPACE","\n    ",1615],["T_VARIABLE","$table_mapping",1616],["T_WHITESPACE"," ",1616],"=",["T_WHITESPACE"," ",1616],["T_VARIABLE","$this",1616],["T_OBJECT_OPERATOR","->",1616],["T_STRING","getTableMapping",1616],"(",["T_VARIABLE","$storage_definitions",1616],")",";",["T_WHITESPACE","\n\n    ",1616],["T_IF","if",1618],["T_WHITESPACE"," ",1618],"(",["T_VARIABLE","$table_mapping",1618],["T_OBJECT_OPERATOR","->",1618],["T_STRING","requiresDedicatedTableStorage",1618],"(",["T_VARIABLE","$storage_definition",1618],")",")",["T_WHITESPACE"," ",1618],"{",["T_WHITESPACE","\n      ",1618],["T_VARIABLE","$is_deleted",1619],["T_WHITESPACE"," ",1619],"=",["T_WHITESPACE"," ",1619],["T_VARIABLE","$this",1619],["T_OBJECT_OPERATOR","->",1619],["T_STRING","storageDefinitionIsDeleted",1619],"(",["T_VARIABLE","$storage_definition",1619],")",";",["T_WHITESPACE","\n      ",1619],["T_IF","if",1620],["T_WHITESPACE"," ",1620],"(",["T_VARIABLE","$this",1620],["T_OBJECT_OPERATOR","->",1620],["T_STRING","entityType",1620],["T_OBJECT_OPERATOR","->",1620],["T_STRING","isRevisionable",1620],"(",")",")",["T_WHITESPACE"," ",1620],"{",["T_WHITESPACE","\n        ",1620],["T_VARIABLE","$table_name",1621],["T_WHITESPACE"," ",1621],"=",["T_WHITESPACE"," ",1621],["T_VARIABLE","$table_mapping",1621],["T_OBJECT_OPERATOR","->",1621],["T_STRING","getDedicatedRevisionTableName",1621],"(",["T_VARIABLE","$storage_definition",1621],",",["T_WHITESPACE"," ",1621],["T_VARIABLE","$is_deleted",1621],")",";",["T_WHITESPACE","\n      ",1621],"}",["T_WHITESPACE","\n      ",1622],["T_ELSE","else",1623],["T_WHITESPACE"," ",1623],"{",["T_WHITESPACE","\n        ",1623],["T_VARIABLE","$table_name",1624],["T_WHITESPACE"," ",1624],"=",["T_WHITESPACE"," ",1624],["T_VARIABLE","$table_mapping",1624],["T_OBJECT_OPERATOR","->",1624],["T_STRING","getDedicatedDataTableName",1624],"(",["T_VARIABLE","$storage_definition",1624],",",["T_WHITESPACE"," ",1624],["T_VARIABLE","$is_deleted",1624],")",";",["T_WHITESPACE","\n      ",1624],"}",["T_WHITESPACE","\n      ",1625],["T_VARIABLE","$query",1626],["T_WHITESPACE"," ",1626],"=",["T_WHITESPACE"," ",1626],["T_VARIABLE","$this",1626],["T_OBJECT_OPERATOR","->",1626],["T_STRING","database",1626],["T_OBJECT_OPERATOR","->",1626],["T_STRING","select",1626],"(",["T_VARIABLE","$table_name",1626],",",["T_WHITESPACE"," ",1626],["T_CONSTANT_ENCAPSED_STRING","'t'",1626],")",";",["T_WHITESPACE","\n      ",1626],["T_VARIABLE","$or",1627],["T_WHITESPACE"," ",1627],"=",["T_WHITESPACE"," ",1627],["T_VARIABLE","$query",1627],["T_OBJECT_OPERATOR","->",1627],["T_STRING","orConditionGroup",1627],"(",")",";",["T_WHITESPACE","\n      ",1627],["T_FOREACH","foreach",1628],["T_WHITESPACE"," ",1628],"(",["T_VARIABLE","$storage_definition",1628],["T_OBJECT_OPERATOR","->",1628],["T_STRING","getColumns",1628],"(",")",["T_WHITESPACE"," ",1628],["T_AS","as",1628],["T_WHITESPACE"," ",1628],["T_VARIABLE","$column_name",1628],["T_WHITESPACE"," ",1628],["T_DOUBLE_ARROW","=>",1628],["T_WHITESPACE"," ",1628],["T_VARIABLE","$data",1628],")",["T_WHITESPACE"," ",1628],"{",["T_WHITESPACE","\n        ",1628],["T_VARIABLE","$or",1629],["T_OBJECT_OPERATOR","->",1629],["T_STRING","isNotNull",1629],"(",["T_VARIABLE","$table_mapping",1629],["T_OBJECT_OPERATOR","->",1629],["T_STRING","getFieldColumnName",1629],"(",["T_VARIABLE","$storage_definition",1629],",",["T_WHITESPACE"," ",1629],["T_VARIABLE","$column_name",1629],")",")",";",["T_WHITESPACE","\n      ",1629],"}",["T_WHITESPACE","\n      ",1630],["T_VARIABLE","$query",1631],["T_OBJECT_OPERATOR","->",1631],["T_STRING","condition",1631],"(",["T_VARIABLE","$or",1631],")",";",["T_WHITESPACE","\n      ",1631],["T_IF","if",1632],["T_WHITESPACE"," ",1632],"(","!",["T_VARIABLE","$as_bool",1632],")",["T_WHITESPACE"," ",1632],"{",["T_WHITESPACE","\n        ",1632],["T_VARIABLE","$query",1633],["T_WHITESPACE","\n          ",1633],["T_OBJECT_OPERATOR","->",1634],["T_STRING","fields",1634],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1634],",",["T_WHITESPACE"," ",1634],["T_ARRAY","array",1634],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1634],")",")",["T_WHITESPACE","\n          ",1634],["T_OBJECT_OPERATOR","->",1635],["T_STRING","distinct",1635],"(",["T_STRING","TRUE",1635],")",";",["T_WHITESPACE","\n      ",1635],"}",["T_WHITESPACE","\n    ",1636],"}",["T_WHITESPACE","\n    ",1637],["T_ELSEIF","elseif",1638],["T_WHITESPACE"," ",1638],"(",["T_VARIABLE","$table_mapping",1638],["T_OBJECT_OPERATOR","->",1638],["T_STRING","allowsSharedTableStorage",1638],"(",["T_VARIABLE","$storage_definition",1638],")",")",["T_WHITESPACE"," ",1638],"{",["T_WHITESPACE","\n      ",1638],["T_COMMENT","\/\/ Ascertain the table this field is mapped too.\n",1639],["T_WHITESPACE","      ",1640],["T_VARIABLE","$field_name",1640],["T_WHITESPACE"," ",1640],"=",["T_WHITESPACE"," ",1640],["T_VARIABLE","$storage_definition",1640],["T_OBJECT_OPERATOR","->",1640],["T_STRING","getName",1640],"(",")",";",["T_WHITESPACE","\n      ",1640],["T_TRY","try",1641],["T_WHITESPACE"," ",1641],"{",["T_WHITESPACE","\n        ",1641],["T_VARIABLE","$table_name",1642],["T_WHITESPACE"," ",1642],"=",["T_WHITESPACE"," ",1642],["T_VARIABLE","$table_mapping",1642],["T_OBJECT_OPERATOR","->",1642],["T_STRING","getFieldTableName",1642],"(",["T_VARIABLE","$field_name",1642],")",";",["T_WHITESPACE","\n      ",1642],"}",["T_WHITESPACE","\n      ",1643],["T_CATCH","catch",1644],["T_WHITESPACE"," ",1644],"(",["T_STRING","SqlContentEntityStorageException",1644],["T_WHITESPACE"," ",1644],["T_VARIABLE","$e",1644],")",["T_WHITESPACE"," ",1644],"{",["T_WHITESPACE","\n        ",1644],["T_COMMENT","\/\/ This may happen when changing field storage schema, since we are not\n",1645],["T_WHITESPACE","        ",1646],["T_COMMENT","\/\/ able to use a table mapping matching the passed storage definition.\n",1646],["T_WHITESPACE","        ",1647],["T_COMMENT","\/\/ @todo Revisit this once we are able to instantiate the table mapping\n",1647],["T_WHITESPACE","        ",1648],["T_COMMENT","\/\/   properly. See https:\/\/www.drupal.org\/node\/2274017.\n",1648],["T_WHITESPACE","        ",1649],["T_VARIABLE","$table_name",1649],["T_WHITESPACE"," ",1649],"=",["T_WHITESPACE"," ",1649],["T_VARIABLE","$this",1649],["T_OBJECT_OPERATOR","->",1649],["T_STRING","dataTable",1649],["T_WHITESPACE"," ",1649],"?",":",["T_WHITESPACE"," ",1649],["T_VARIABLE","$this",1649],["T_OBJECT_OPERATOR","->",1649],["T_STRING","baseTable",1649],";",["T_WHITESPACE","\n      ",1649],"}",["T_WHITESPACE","\n      ",1650],["T_VARIABLE","$query",1651],["T_WHITESPACE"," ",1651],"=",["T_WHITESPACE"," ",1651],["T_VARIABLE","$this",1651],["T_OBJECT_OPERATOR","->",1651],["T_STRING","database",1651],["T_OBJECT_OPERATOR","->",1651],["T_STRING","select",1651],"(",["T_VARIABLE","$table_name",1651],",",["T_WHITESPACE"," ",1651],["T_CONSTANT_ENCAPSED_STRING","'t'",1651],")",";",["T_WHITESPACE","\n      ",1651],["T_VARIABLE","$or",1652],["T_WHITESPACE"," ",1652],"=",["T_WHITESPACE"," ",1652],["T_VARIABLE","$query",1652],["T_OBJECT_OPERATOR","->",1652],["T_STRING","orConditionGroup",1652],"(",")",";",["T_WHITESPACE","\n      ",1652],["T_FOREACH","foreach",1653],["T_WHITESPACE"," ",1653],"(",["T_STRING","array_keys",1653],"(",["T_VARIABLE","$storage_definition",1653],["T_OBJECT_OPERATOR","->",1653],["T_STRING","getColumns",1653],"(",")",")",["T_WHITESPACE"," ",1653],["T_AS","as",1653],["T_WHITESPACE"," ",1653],["T_VARIABLE","$property_name",1653],")",["T_WHITESPACE"," ",1653],"{",["T_WHITESPACE","\n        ",1653],["T_VARIABLE","$or",1654],["T_OBJECT_OPERATOR","->",1654],["T_STRING","isNotNull",1654],"(",["T_VARIABLE","$table_mapping",1654],["T_OBJECT_OPERATOR","->",1654],["T_STRING","getFieldColumnName",1654],"(",["T_VARIABLE","$storage_definition",1654],",",["T_WHITESPACE"," ",1654],["T_VARIABLE","$property_name",1654],")",")",";",["T_WHITESPACE","\n      ",1654],"}",["T_WHITESPACE","\n      ",1655],["T_VARIABLE","$query",1656],["T_OBJECT_OPERATOR","->",1656],["T_STRING","condition",1656],"(",["T_VARIABLE","$or",1656],")",";",["T_WHITESPACE","\n      ",1656],["T_IF","if",1657],["T_WHITESPACE"," ",1657],"(","!",["T_VARIABLE","$as_bool",1657],")",["T_WHITESPACE"," ",1657],"{",["T_WHITESPACE","\n        ",1657],["T_VARIABLE","$query",1658],["T_WHITESPACE","\n          ",1658],["T_OBJECT_OPERATOR","->",1659],["T_STRING","fields",1659],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",1659],",",["T_WHITESPACE"," ",1659],["T_ARRAY","array",1659],"(",["T_VARIABLE","$this",1659],["T_OBJECT_OPERATOR","->",1659],["T_STRING","idKey",1659],")",")",["T_WHITESPACE","\n          ",1659],["T_OBJECT_OPERATOR","->",1660],["T_STRING","distinct",1660],"(",["T_STRING","TRUE",1660],")",";",["T_WHITESPACE","\n      ",1660],"}",["T_WHITESPACE","\n    ",1661],"}",["T_WHITESPACE","\n\n    ",1662],["T_COMMENT","\/\/ @todo Find a way to count field data also for fields having custom\n",1664],["T_WHITESPACE","    ",1665],["T_COMMENT","\/\/   storage. See https:\/\/www.drupal.org\/node\/2337753.\n",1665],["T_WHITESPACE","    ",1666],["T_VARIABLE","$count",1666],["T_WHITESPACE"," ",1666],"=",["T_WHITESPACE"," ",1666],["T_LNUMBER","0",1666],";",["T_WHITESPACE","\n    ",1666],["T_IF","if",1667],["T_WHITESPACE"," ",1667],"(",["T_ISSET","isset",1667],"(",["T_VARIABLE","$query",1667],")",")",["T_WHITESPACE"," ",1667],"{",["T_WHITESPACE","\n      ",1667],["T_COMMENT","\/\/ If we are performing the query just to check if the field has data\n",1668],["T_WHITESPACE","      ",1669],["T_COMMENT","\/\/ limit the number of rows.\n",1669],["T_WHITESPACE","      ",1670],["T_IF","if",1670],["T_WHITESPACE"," ",1670],"(",["T_VARIABLE","$as_bool",1670],")",["T_WHITESPACE"," ",1670],"{",["T_WHITESPACE","\n        ",1670],["T_VARIABLE","$query",1671],["T_WHITESPACE","\n          ",1671],["T_OBJECT_OPERATOR","->",1672],["T_STRING","range",1672],"(",["T_LNUMBER","0",1672],",",["T_WHITESPACE"," ",1672],["T_LNUMBER","1",1672],")",["T_WHITESPACE","\n          ",1672],["T_OBJECT_OPERATOR","->",1673],["T_STRING","addExpression",1673],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",1673],")",";",["T_WHITESPACE","\n      ",1673],"}",["T_WHITESPACE","\n      ",1674],["T_ELSE","else",1675],["T_WHITESPACE"," ",1675],"{",["T_WHITESPACE","\n        ",1675],["T_COMMENT","\/\/ Otherwise count the number of rows.\n",1676],["T_WHITESPACE","        ",1677],["T_VARIABLE","$query",1677],["T_WHITESPACE"," ",1677],"=",["T_WHITESPACE"," ",1677],["T_VARIABLE","$query",1677],["T_OBJECT_OPERATOR","->",1677],["T_STRING","countQuery",1677],"(",")",";",["T_WHITESPACE","\n      ",1677],"}",["T_WHITESPACE","\n      ",1678],["T_VARIABLE","$count",1679],["T_WHITESPACE"," ",1679],"=",["T_WHITESPACE"," ",1679],["T_VARIABLE","$query",1679],["T_OBJECT_OPERATOR","->",1679],["T_STRING","execute",1679],"(",")",["T_OBJECT_OPERATOR","->",1679],["T_STRING","fetchField",1679],"(",")",";",["T_WHITESPACE","\n    ",1679],"}",["T_WHITESPACE","\n    ",1680],["T_RETURN","return",1681],["T_WHITESPACE"," ",1681],["T_VARIABLE","$as_bool",1681],["T_WHITESPACE"," ",1681],"?",["T_WHITESPACE"," ",1681],["T_BOOL_CAST","(bool)",1681],["T_WHITESPACE"," ",1681],["T_VARIABLE","$count",1681],["T_WHITESPACE"," ",1681],":",["T_WHITESPACE"," ",1681],["T_INT_CAST","(int)",1681],["T_WHITESPACE"," ",1681],["T_VARIABLE","$count",1681],";",["T_WHITESPACE","\n  ",1681],"}",["T_WHITESPACE","\n\n  ",1682],["T_DOC_COMMENT","\/**\n   * Determines whether the passed field has been already deleted.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The field storage definition.\n   *\n   * @return bool\n   *   Whether the field has been already deleted.\n   *\/",1684],["T_WHITESPACE","\n  ",1692],["T_PROTECTED","protected",1693],["T_WHITESPACE"," ",1693],["T_FUNCTION","function",1693],["T_WHITESPACE"," ",1693],["T_STRING","storageDefinitionIsDeleted",1693],"(",["T_STRING","FieldStorageDefinitionInterface",1693],["T_WHITESPACE"," ",1693],["T_VARIABLE","$storage_definition",1693],")",["T_WHITESPACE"," ",1693],"{",["T_WHITESPACE","\n    ",1693],["T_COMMENT","\/\/ Configurable fields are marked for deletion.\n",1694],["T_WHITESPACE","    ",1695],["T_IF","if",1695],["T_WHITESPACE"," ",1695],"(",["T_VARIABLE","$storage_definition",1695],["T_WHITESPACE"," ",1695],["T_INSTANCEOF","instanceOf",1695],["T_WHITESPACE"," ",1695],["T_STRING","FieldStorageConfigInterface",1695],")",["T_WHITESPACE"," ",1695],"{",["T_WHITESPACE","\n      ",1695],["T_RETURN","return",1696],["T_WHITESPACE"," ",1696],["T_VARIABLE","$storage_definition",1696],["T_OBJECT_OPERATOR","->",1696],["T_STRING","isDeleted",1696],"(",")",";",["T_WHITESPACE","\n    ",1696],"}",["T_WHITESPACE","\n    ",1697],["T_COMMENT","\/\/ For non configurable fields check whether they are still in the last\n",1698],["T_WHITESPACE","    ",1699],["T_COMMENT","\/\/ installed schema repository.\n",1699],["T_WHITESPACE","    ",1700],["T_RETURN","return",1700],["T_WHITESPACE"," ",1700],"!",["T_STRING","array_key_exists",1700],"(",["T_VARIABLE","$storage_definition",1700],["T_OBJECT_OPERATOR","->",1700],["T_STRING","getName",1700],"(",")",",",["T_WHITESPACE"," ",1700],["T_VARIABLE","$this",1700],["T_OBJECT_OPERATOR","->",1700],["T_STRING","entityManager",1700],["T_OBJECT_OPERATOR","->",1700],["T_STRING","getLastInstalledFieldStorageDefinitions",1700],"(",["T_VARIABLE","$this",1700],["T_OBJECT_OPERATOR","->",1700],["T_STRING","entityTypeId",1700],")",")",";",["T_WHITESPACE","\n  ",1700],"}",["T_WHITESPACE","\n\n",1701],"}",["T_WHITESPACE","\n",1703]]