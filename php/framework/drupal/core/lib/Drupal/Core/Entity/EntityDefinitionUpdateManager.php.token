[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Entity",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Schema",5],["T_NS_SEPARATOR","\\",5],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Entity",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Schema",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EntityStorageSchemaInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Field",7],["T_NS_SEPARATOR","\\",7],["T_STRING","BaseFieldDefinition",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Field",8],["T_NS_SEPARATOR","\\",8],["T_STRING","FieldStorageDefinitionInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","StringTranslation",9],["T_NS_SEPARATOR","\\",9],["T_STRING","StringTranslationTrait",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Manages entity definition updates.\n *\/",11],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","EntityDefinitionUpdateManager",14],["T_WHITESPACE"," ",14],["T_IMPLEMENTS","implements",14],["T_WHITESPACE"," ",14],["T_STRING","EntityDefinitionUpdateManagerInterface",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n  ",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","StringTranslationTrait",15],";",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * The entity manager service.\n   *\n   * @var \\Drupal\\Core\\Entity\\EntityManagerInterface\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$entityManager",22],";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * Constructs a new EntityDefinitionUpdateManager.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityManagerInterface $entity_manager\n   *   The entity manager.\n   *\/",24],["T_WHITESPACE","\n  ",29],["T_PUBLIC","public",30],["T_WHITESPACE"," ",30],["T_FUNCTION","function",30],["T_WHITESPACE"," ",30],["T_STRING","__construct",30],"(",["T_STRING","EntityManagerInterface",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$entity_manager",30],")",["T_WHITESPACE"," ",30],"{",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","entityManager",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$entity_manager",31],";",["T_WHITESPACE","\n  ",31],"}",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",34],["T_WHITESPACE","\n  ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","needsUpdates",37],"(",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_RETURN","return",38],["T_WHITESPACE"," ",38],["T_BOOL_CAST","(bool)",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getChangeList",38],"(",")",";",["T_WHITESPACE","\n  ",38],"}",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",41],["T_WHITESPACE","\n  ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","getChangeSummary",44],"(",")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n    ",44],["T_VARIABLE","$summary",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n\n    ",45],["T_FOREACH","foreach",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getChangeList",47],"(",")",["T_WHITESPACE"," ",47],["T_AS","as",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$entity_type_id",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$change_list",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n      ",47],["T_COMMENT","\/\/ Process entity type definition changes.\n",48],["T_WHITESPACE","      ",49],["T_IF","if",49],["T_WHITESPACE"," ",49],"(","!",["T_EMPTY","empty",49],"(",["T_VARIABLE","$change_list",49],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",49],"]",")",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$entity_type",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","entityManager",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getDefinition",50],"(",["T_VARIABLE","$entity_type_id",50],")",";",["T_WHITESPACE","\n\n        ",50],["T_SWITCH","switch",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$change_list",52],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",52],"]",")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n          ",52],["T_CASE","case",53],["T_WHITESPACE"," ",53],["T_STATIC","static",53],["T_DOUBLE_COLON","::",53],["T_STRING","DEFINITION_CREATED",53],":",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$summary",54],"[",["T_VARIABLE","$entity_type_id",54],"]","[","]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","t",54],"(",["T_CONSTANT_ENCAPSED_STRING","'The %entity_type entity type needs to be installed.'",54],",",["T_WHITESPACE"," ",54],"[",["T_CONSTANT_ENCAPSED_STRING","'%entity_type'",54],["T_WHITESPACE"," ",54],["T_DOUBLE_ARROW","=>",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$entity_type",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getLabel",54],"(",")","]",")",";",["T_WHITESPACE","\n            ",54],["T_BREAK","break",55],";",["T_WHITESPACE","\n\n          ",55],["T_CASE","case",57],["T_WHITESPACE"," ",57],["T_STATIC","static",57],["T_DOUBLE_COLON","::",57],["T_STRING","DEFINITION_UPDATED",57],":",["T_WHITESPACE","\n            ",57],["T_VARIABLE","$summary",58],"[",["T_VARIABLE","$entity_type_id",58],"]","[","]",["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","t",58],"(",["T_CONSTANT_ENCAPSED_STRING","'The %entity_type entity type needs to be updated.'",58],",",["T_WHITESPACE"," ",58],"[",["T_CONSTANT_ENCAPSED_STRING","'%entity_type'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$entity_type",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getLabel",58],"(",")","]",")",";",["T_WHITESPACE","\n            ",58],["T_BREAK","break",59],";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n      ",60],"}",["T_WHITESPACE","\n\n      ",61],["T_COMMENT","\/\/ Process field storage definition changes.\n",63],["T_WHITESPACE","      ",64],["T_IF","if",64],["T_WHITESPACE"," ",64],"(","!",["T_EMPTY","empty",64],"(",["T_VARIABLE","$change_list",64],"[",["T_CONSTANT_ENCAPSED_STRING","'field_storage_definitions'",64],"]",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$storage_definitions",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","entityManager",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getFieldStorageDefinitions",65],"(",["T_VARIABLE","$entity_type_id",65],")",";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$original_storage_definitions",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","entityManager",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getLastInstalledFieldStorageDefinitions",66],"(",["T_VARIABLE","$entity_type_id",66],")",";",["T_WHITESPACE","\n\n        ",66],["T_FOREACH","foreach",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$change_list",68],"[",["T_CONSTANT_ENCAPSED_STRING","'field_storage_definitions'",68],"]",["T_WHITESPACE"," ",68],["T_AS","as",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$field_name",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$change",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n          ",68],["T_SWITCH","switch",69],["T_WHITESPACE"," ",69],"(",["T_VARIABLE","$change",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_CASE","case",70],["T_WHITESPACE"," ",70],["T_STATIC","static",70],["T_DOUBLE_COLON","::",70],["T_STRING","DEFINITION_CREATED",70],":",["T_WHITESPACE","\n              ",70],["T_VARIABLE","$summary",71],"[",["T_VARIABLE","$entity_type_id",71],"]","[","]",["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","t",71],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be installed.'",71],",",["T_WHITESPACE"," ",71],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$storage_definitions",71],"[",["T_VARIABLE","$field_name",71],"]",["T_OBJECT_OPERATOR","->",71],["T_STRING","getLabel",71],"(",")","]",")",";",["T_WHITESPACE","\n              ",71],["T_BREAK","break",72],";",["T_WHITESPACE","\n\n            ",72],["T_CASE","case",74],["T_WHITESPACE"," ",74],["T_STATIC","static",74],["T_DOUBLE_COLON","::",74],["T_STRING","DEFINITION_UPDATED",74],":",["T_WHITESPACE","\n              ",74],["T_VARIABLE","$summary",75],"[",["T_VARIABLE","$entity_type_id",75],"]","[","]",["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","t",75],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be updated.'",75],",",["T_WHITESPACE"," ",75],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$storage_definitions",75],"[",["T_VARIABLE","$field_name",75],"]",["T_OBJECT_OPERATOR","->",75],["T_STRING","getLabel",75],"(",")","]",")",";",["T_WHITESPACE","\n              ",75],["T_BREAK","break",76],";",["T_WHITESPACE","\n\n            ",76],["T_CASE","case",78],["T_WHITESPACE"," ",78],["T_STATIC","static",78],["T_DOUBLE_COLON","::",78],["T_STRING","DEFINITION_DELETED",78],":",["T_WHITESPACE","\n              ",78],["T_VARIABLE","$summary",79],"[",["T_VARIABLE","$entity_type_id",79],"]","[","]",["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","t",79],"(",["T_CONSTANT_ENCAPSED_STRING","'The %field_name field needs to be uninstalled.'",79],",",["T_WHITESPACE"," ",79],"[",["T_CONSTANT_ENCAPSED_STRING","'%field_name'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$original_storage_definitions",79],"[",["T_VARIABLE","$field_name",79],"]",["T_OBJECT_OPERATOR","->",79],["T_STRING","getLabel",79],"(",")","]",")",";",["T_WHITESPACE","\n              ",79],["T_BREAK","break",80],";",["T_WHITESPACE","\n          ",80],"}",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n      ",82],"}",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$summary",86],";",["T_WHITESPACE","\n  ",86],"}",["T_WHITESPACE","\n\n  ",87],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",89],["T_WHITESPACE","\n  ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","applyUpdates",92],"(",")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$complete_change_list",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getChangeList",93],"(",")",";",["T_WHITESPACE","\n    ",93],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$complete_change_list",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n      ",94],["T_COMMENT","\/\/ self::getChangeList() only disables the cache and does not invalidate.\n",95],["T_WHITESPACE","      ",96],["T_COMMENT","\/\/ In case there are changes, explicitly invalidate caches.\n",96],["T_WHITESPACE","      ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","entityManager",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","clearCachedDefinitions",97],"(",")",";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n    ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$complete_change_list",99],["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$entity_type_id",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$change_list",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_COMMENT","\/\/ Process entity type definition changes before storage definitions ones\n",100],["T_WHITESPACE","      ",101],["T_COMMENT","\/\/ this is necessary when you change an entity type from non-revisionable\n",101],["T_WHITESPACE","      ",102],["T_COMMENT","\/\/ to revisionable and at the same time add revisionable fields to the\n",102],["T_WHITESPACE","      ",103],["T_COMMENT","\/\/ entity type.\n",103],["T_WHITESPACE","      ",104],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_EMPTY","empty",104],"(",["T_VARIABLE","$change_list",104],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",104],"]",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","doEntityUpdate",105],"(",["T_VARIABLE","$change_list",105],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",105],"]",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$entity_type_id",105],")",";",["T_WHITESPACE","\n      ",105],"}",["T_WHITESPACE","\n\n      ",106],["T_COMMENT","\/\/ Process field storage definition changes.\n",108],["T_WHITESPACE","      ",109],["T_IF","if",109],["T_WHITESPACE"," ",109],"(","!",["T_EMPTY","empty",109],"(",["T_VARIABLE","$change_list",109],"[",["T_CONSTANT_ENCAPSED_STRING","'field_storage_definitions'",109],"]",")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$storage_definitions",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","entityManager",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getFieldStorageDefinitions",110],"(",["T_VARIABLE","$entity_type_id",110],")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$original_storage_definitions",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","entityManager",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getLastInstalledFieldStorageDefinitions",111],"(",["T_VARIABLE","$entity_type_id",111],")",";",["T_WHITESPACE","\n\n        ",111],["T_FOREACH","foreach",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$change_list",113],"[",["T_CONSTANT_ENCAPSED_STRING","'field_storage_definitions'",113],"]",["T_WHITESPACE"," ",113],["T_AS","as",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$field_name",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$change",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n          ",113],["T_VARIABLE","$storage_definition",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_ISSET","isset",114],"(",["T_VARIABLE","$storage_definitions",114],"[",["T_VARIABLE","$field_name",114],"]",")",["T_WHITESPACE"," ",114],"?",["T_WHITESPACE"," ",114],["T_VARIABLE","$storage_definitions",114],"[",["T_VARIABLE","$field_name",114],"]",["T_WHITESPACE"," ",114],":",["T_WHITESPACE"," ",114],["T_STRING","NULL",114],";",["T_WHITESPACE","\n          ",114],["T_VARIABLE","$original_storage_definition",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_ISSET","isset",115],"(",["T_VARIABLE","$original_storage_definitions",115],"[",["T_VARIABLE","$field_name",115],"]",")",["T_WHITESPACE"," ",115],"?",["T_WHITESPACE"," ",115],["T_VARIABLE","$original_storage_definitions",115],"[",["T_VARIABLE","$field_name",115],"]",["T_WHITESPACE"," ",115],":",["T_WHITESPACE"," ",115],["T_STRING","NULL",115],";",["T_WHITESPACE","\n          ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","doFieldUpdate",116],"(",["T_VARIABLE","$change",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$storage_definition",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$original_storage_definition",116],")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n      ",117],"}",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n  ",119],"}",["T_WHITESPACE","\n\n  ",120],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",122],["T_WHITESPACE","\n  ",124],["T_PUBLIC","public",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","getEntityType",125],"(",["T_VARIABLE","$entity_type_id",125],")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$entity_type",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","entityManager",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getLastInstalledDefinition",126],"(",["T_VARIABLE","$entity_type_id",126],")",";",["T_WHITESPACE","\n    ",126],["T_RETURN","return",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$entity_type",127],["T_WHITESPACE"," ",127],"?",["T_WHITESPACE"," ",127],["T_CLONE","clone",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$entity_type",127],["T_WHITESPACE"," ",127],":",["T_WHITESPACE"," ",127],["T_STRING","NULL",127],";",["T_WHITESPACE","\n  ",127],"}",["T_WHITESPACE","\n\n  ",128],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",130],["T_WHITESPACE","\n  ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","installEntityType",133],"(",["T_STRING","EntityTypeInterface",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$entity_type",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n    ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","entityManager",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","clearCachedDefinitions",134],"(",")",";",["T_WHITESPACE","\n    ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","entityManager",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","onEntityTypeCreate",135],"(",["T_VARIABLE","$entity_type",135],")",";",["T_WHITESPACE","\n  ",135],"}",["T_WHITESPACE","\n\n  ",136],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",138],["T_WHITESPACE","\n  ",140],["T_PUBLIC","public",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","updateEntityType",141],"(",["T_STRING","EntityTypeInterface",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$entity_type",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n    ",141],["T_VARIABLE","$original",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getEntityType",142],"(",["T_VARIABLE","$entity_type",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","id",142],"(",")",")",";",["T_WHITESPACE","\n    ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","entityManager",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","clearCachedDefinitions",143],"(",")",";",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","entityManager",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","onEntityTypeUpdate",144],"(",["T_VARIABLE","$entity_type",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$original",144],")",";",["T_WHITESPACE","\n  ",144],"}",["T_WHITESPACE","\n\n  ",145],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",147],["T_WHITESPACE","\n  ",149],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","uninstallEntityType",150],"(",["T_STRING","EntityTypeInterface",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$entity_type",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n    ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","entityManager",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","clearCachedDefinitions",151],"(",")",";",["T_WHITESPACE","\n    ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","entityManager",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","onEntityTypeDelete",152],"(",["T_VARIABLE","$entity_type",152],")",";",["T_WHITESPACE","\n  ",152],"}",["T_WHITESPACE","\n\n  ",153],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",155],["T_WHITESPACE","\n  ",157],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","installFieldStorageDefinition",158],"(",["T_VARIABLE","$name",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$entity_type_id",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$provider",158],",",["T_WHITESPACE"," ",158],["T_STRING","FieldStorageDefinitionInterface",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$storage_definition",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n    ",158],["T_COMMENT","\/\/ @todo Pass a mutable field definition interface when we have one. See\n",159],["T_WHITESPACE","    ",160],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2346329.\n",160],["T_WHITESPACE","    ",161],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$storage_definition",161],["T_WHITESPACE"," ",161],["T_INSTANCEOF","instanceof",161],["T_WHITESPACE"," ",161],["T_STRING","BaseFieldDefinition",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n      ",161],["T_VARIABLE","$storage_definition",162],["T_WHITESPACE","\n        ",162],["T_OBJECT_OPERATOR","->",163],["T_STRING","setName",163],"(",["T_VARIABLE","$name",163],")",["T_WHITESPACE","\n        ",163],["T_OBJECT_OPERATOR","->",164],["T_STRING","setTargetEntityTypeId",164],"(",["T_VARIABLE","$entity_type_id",164],")",["T_WHITESPACE","\n        ",164],["T_OBJECT_OPERATOR","->",165],["T_STRING","setProvider",165],"(",["T_VARIABLE","$provider",165],")",["T_WHITESPACE","\n        ",165],["T_OBJECT_OPERATOR","->",166],["T_STRING","setTargetBundle",166],"(",["T_STRING","NULL",166],")",";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n    ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","entityManager",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","clearCachedDefinitions",168],"(",")",";",["T_WHITESPACE","\n    ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","entityManager",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","onFieldStorageDefinitionCreate",169],"(",["T_VARIABLE","$storage_definition",169],")",";",["T_WHITESPACE","\n  ",169],"}",["T_WHITESPACE","\n\n  ",170],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",172],["T_WHITESPACE","\n  ",174],["T_PUBLIC","public",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","getFieldStorageDefinition",175],"(",["T_VARIABLE","$name",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$entity_type_id",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$storage_definitions",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","entityManager",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getLastInstalledFieldStorageDefinitions",176],"(",["T_VARIABLE","$entity_type_id",176],")",";",["T_WHITESPACE","\n    ",176],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_ISSET","isset",177],"(",["T_VARIABLE","$storage_definitions",177],"[",["T_VARIABLE","$name",177],"]",")",["T_WHITESPACE"," ",177],"?",["T_WHITESPACE"," ",177],["T_CLONE","clone",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$storage_definitions",177],"[",["T_VARIABLE","$name",177],"]",["T_WHITESPACE"," ",177],":",["T_WHITESPACE"," ",177],["T_STRING","NULL",177],";",["T_WHITESPACE","\n  ",177],"}",["T_WHITESPACE","\n\n  ",178],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",180],["T_WHITESPACE","\n  ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","updateFieldStorageDefinition",183],"(",["T_STRING","FieldStorageDefinitionInterface",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$storage_definition",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n    ",183],["T_VARIABLE","$original",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getFieldStorageDefinition",184],"(",["T_VARIABLE","$storage_definition",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getName",184],"(",")",",",["T_WHITESPACE"," ",184],["T_VARIABLE","$storage_definition",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getTargetEntityTypeId",184],"(",")",")",";",["T_WHITESPACE","\n    ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","entityManager",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","clearCachedDefinitions",185],"(",")",";",["T_WHITESPACE","\n    ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","entityManager",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","onFieldStorageDefinitionUpdate",186],"(",["T_VARIABLE","$storage_definition",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$original",186],")",";",["T_WHITESPACE","\n  ",186],"}",["T_WHITESPACE","\n\n  ",187],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",189],["T_WHITESPACE","\n  ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","uninstallFieldStorageDefinition",192],"(",["T_STRING","FieldStorageDefinitionInterface",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$storage_definition",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n    ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","entityManager",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","clearCachedDefinitions",193],"(",")",";",["T_WHITESPACE","\n    ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","entityManager",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","onFieldStorageDefinitionDelete",194],"(",["T_VARIABLE","$storage_definition",194],")",";",["T_WHITESPACE","\n  ",194],"}",["T_WHITESPACE","\n\n  ",195],["T_DOC_COMMENT","\/**\n   * Performs an entity type definition update.\n   *\n   * @param string $op\n   *   The operation to perform, either static::DEFINITION_CREATED or\n   *   static::DEFINITION_UPDATED.\n   * @param string $entity_type_id\n   *   The entity type ID.\n   *\/",197],["T_WHITESPACE","\n  ",205],["T_PROTECTED","protected",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","doEntityUpdate",206],"(",["T_VARIABLE","$op",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$entity_type_id",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n    ",206],["T_VARIABLE","$entity_type",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","entityManager",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getDefinition",207],"(",["T_VARIABLE","$entity_type_id",207],")",";",["T_WHITESPACE","\n    ",207],["T_SWITCH","switch",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$op",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n      ",208],["T_CASE","case",209],["T_WHITESPACE"," ",209],["T_STATIC","static",209],["T_DOUBLE_COLON","::",209],["T_STRING","DEFINITION_CREATED",209],":",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","entityManager",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","onEntityTypeCreate",210],"(",["T_VARIABLE","$entity_type",210],")",";",["T_WHITESPACE","\n        ",210],["T_BREAK","break",211],";",["T_WHITESPACE","\n\n      ",211],["T_CASE","case",213],["T_WHITESPACE"," ",213],["T_STATIC","static",213],["T_DOUBLE_COLON","::",213],["T_STRING","DEFINITION_UPDATED",213],":",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$original",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","entityManager",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getLastInstalledDefinition",214],"(",["T_VARIABLE","$entity_type_id",214],")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","entityManager",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","onEntityTypeUpdate",215],"(",["T_VARIABLE","$entity_type",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$original",215],")",";",["T_WHITESPACE","\n        ",215],["T_BREAK","break",216],";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n  ",217],"}",["T_WHITESPACE","\n\n  ",218],["T_DOC_COMMENT","\/**\n   * Performs a field storage definition update.\n   *\n   * @param string $op\n   *   The operation to perform, possible values are static::DEFINITION_CREATED,\n   *   static::DEFINITION_UPDATED or static::DEFINITION_DELETED.\n   * @param array|null $storage_definition\n   *   The new field storage definition.\n   * @param array|null $original_storage_definition\n   *   The original field storage definition.\n   *\/",220],["T_WHITESPACE","\n  ",230],["T_PROTECTED","protected",231],["T_WHITESPACE"," ",231],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","doFieldUpdate",231],"(",["T_VARIABLE","$op",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$storage_definition",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","NULL",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$original_storage_definition",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","NULL",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n    ",231],["T_SWITCH","switch",232],["T_WHITESPACE"," ",232],"(",["T_VARIABLE","$op",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n      ",232],["T_CASE","case",233],["T_WHITESPACE"," ",233],["T_STATIC","static",233],["T_DOUBLE_COLON","::",233],["T_STRING","DEFINITION_CREATED",233],":",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","entityManager",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","onFieldStorageDefinitionCreate",234],"(",["T_VARIABLE","$storage_definition",234],")",";",["T_WHITESPACE","\n        ",234],["T_BREAK","break",235],";",["T_WHITESPACE","\n\n      ",235],["T_CASE","case",237],["T_WHITESPACE"," ",237],["T_STATIC","static",237],["T_DOUBLE_COLON","::",237],["T_STRING","DEFINITION_UPDATED",237],":",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","entityManager",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","onFieldStorageDefinitionUpdate",238],"(",["T_VARIABLE","$storage_definition",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$original_storage_definition",238],")",";",["T_WHITESPACE","\n        ",238],["T_BREAK","break",239],";",["T_WHITESPACE","\n\n      ",239],["T_CASE","case",241],["T_WHITESPACE"," ",241],["T_STATIC","static",241],["T_DOUBLE_COLON","::",241],["T_STRING","DEFINITION_DELETED",241],":",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","entityManager",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","onFieldStorageDefinitionDelete",242],"(",["T_VARIABLE","$original_storage_definition",242],")",";",["T_WHITESPACE","\n        ",242],["T_BREAK","break",243],";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n  ",244],"}",["T_WHITESPACE","\n\n  ",245],["T_DOC_COMMENT","\/**\n   * Gets a list of changes to entity type and field storage definitions.\n   *\n   * @return array\n   *   An associative array keyed by entity type id of change descriptors. Every\n   *   entry is an associative array with the following optional keys:\n   *   - entity_type: a scalar having only the DEFINITION_UPDATED value.\n   *   - field_storage_definitions: an associative array keyed by field name of\n   *     scalars having one value among:\n   *     - DEFINITION_CREATED\n   *     - DEFINITION_UPDATED\n   *     - DEFINITION_DELETED\n   *\/",247],["T_WHITESPACE","\n  ",259],["T_PROTECTED","protected",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","getChangeList",260],"(",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n    ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","entityManager",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","useCaches",261],"(",["T_STRING","FALSE",261],")",";",["T_WHITESPACE","\n    ",261],["T_VARIABLE","$change_list",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_ARRAY","array",262],"(",")",";",["T_WHITESPACE","\n\n    ",262],["T_FOREACH","foreach",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","entityManager",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getDefinitions",264],"(",")",["T_WHITESPACE"," ",264],["T_AS","as",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$entity_type_id",264],["T_WHITESPACE"," ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$entity_type",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n      ",264],["T_VARIABLE","$original",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","entityManager",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getLastInstalledDefinition",265],"(",["T_VARIABLE","$entity_type_id",265],")",";",["T_WHITESPACE","\n\n      ",265],["T_COMMENT","\/\/ @todo Support non-storage-schema-changing definition updates too:\n",267],["T_WHITESPACE","      ",268],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2336895.\n",268],["T_WHITESPACE","      ",269],["T_IF","if",269],["T_WHITESPACE"," ",269],"(","!",["T_VARIABLE","$original",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$change_list",270],"[",["T_VARIABLE","$entity_type_id",270],"]","[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",270],"]",["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STATIC","static",270],["T_DOUBLE_COLON","::",270],["T_STRING","DEFINITION_CREATED",270],";",["T_WHITESPACE","\n      ",270],"}",["T_WHITESPACE","\n      ",271],["T_ELSE","else",272],["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n        ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","requiresEntityStorageSchemaChanges",273],"(",["T_VARIABLE","$entity_type",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$original",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n          ",273],["T_VARIABLE","$change_list",274],"[",["T_VARIABLE","$entity_type_id",274],"]","[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",274],"]",["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_STATIC","static",274],["T_DOUBLE_COLON","::",274],["T_STRING","DEFINITION_UPDATED",274],";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_IF","if",277],["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","entityManager",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getStorage",277],"(",["T_VARIABLE","$entity_type_id",277],")",["T_WHITESPACE"," ",277],["T_INSTANCEOF","instanceof",277],["T_WHITESPACE"," ",277],["T_STRING","DynamicallyFieldableEntityStorageInterface",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n          ",277],["T_VARIABLE","$field_changes",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_ARRAY","array",278],"(",")",";",["T_WHITESPACE","\n          ",278],["T_VARIABLE","$storage_definitions",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","entityManager",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getFieldStorageDefinitions",279],"(",["T_VARIABLE","$entity_type_id",279],")",";",["T_WHITESPACE","\n          ",279],["T_VARIABLE","$original_storage_definitions",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","entityManager",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getLastInstalledFieldStorageDefinitions",280],"(",["T_VARIABLE","$entity_type_id",280],")",";",["T_WHITESPACE","\n\n          ",280],["T_COMMENT","\/\/ Detect created field storage definitions.\n",282],["T_WHITESPACE","          ",283],["T_FOREACH","foreach",283],["T_WHITESPACE"," ",283],"(",["T_STRING","array_diff_key",283],"(",["T_VARIABLE","$storage_definitions",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$original_storage_definitions",283],")",["T_WHITESPACE"," ",283],["T_AS","as",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$field_name",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$storage_definition",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$field_changes",284],"[",["T_VARIABLE","$field_name",284],"]",["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_STATIC","static",284],["T_DOUBLE_COLON","::",284],["T_STRING","DEFINITION_CREATED",284],";",["T_WHITESPACE","\n          ",284],"}",["T_WHITESPACE","\n\n          ",285],["T_COMMENT","\/\/ Detect deleted field storage definitions.\n",287],["T_WHITESPACE","          ",288],["T_FOREACH","foreach",288],["T_WHITESPACE"," ",288],"(",["T_STRING","array_diff_key",288],"(",["T_VARIABLE","$original_storage_definitions",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$storage_definitions",288],")",["T_WHITESPACE"," ",288],["T_AS","as",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$field_name",288],["T_WHITESPACE"," ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$original_storage_definition",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$field_changes",289],"[",["T_VARIABLE","$field_name",289],"]",["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STATIC","static",289],["T_DOUBLE_COLON","::",289],["T_STRING","DEFINITION_DELETED",289],";",["T_WHITESPACE","\n          ",289],"}",["T_WHITESPACE","\n\n          ",290],["T_COMMENT","\/\/ Detect updated field storage definitions.\n",292],["T_WHITESPACE","          ",293],["T_FOREACH","foreach",293],["T_WHITESPACE"," ",293],"(",["T_STRING","array_intersect_key",293],"(",["T_VARIABLE","$storage_definitions",293],",",["T_WHITESPACE"," ",293],["T_VARIABLE","$original_storage_definitions",293],")",["T_WHITESPACE"," ",293],["T_AS","as",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$field_name",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$storage_definition",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n            ",293],["T_COMMENT","\/\/ @todo Support non-storage-schema-changing definition updates too:\n",294],["T_WHITESPACE","            ",295],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2336895. So long as we're checking\n",295],["T_WHITESPACE","            ",296],["T_COMMENT","\/\/   based on schema change requirements rather than definition\n",296],["T_WHITESPACE","            ",297],["T_COMMENT","\/\/   equality, skip the check if the entity type itself needs to be\n",297],["T_WHITESPACE","            ",298],["T_COMMENT","\/\/   updated, since that can affect the schema of all fields, so we\n",298],["T_WHITESPACE","            ",299],["T_COMMENT","\/\/   want to process that update first without reporting false\n",299],["T_WHITESPACE","            ",300],["T_COMMENT","\/\/   positives here.\n",300],["T_WHITESPACE","            ",301],["T_IF","if",301],["T_WHITESPACE"," ",301],"(","!",["T_ISSET","isset",301],"(",["T_VARIABLE","$change_list",301],"[",["T_VARIABLE","$entity_type_id",301],"]","[",["T_CONSTANT_ENCAPSED_STRING","'entity_type'",301],"]",")",["T_WHITESPACE"," ",301],["T_BOOLEAN_AND","&&",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","requiresFieldStorageSchemaChanges",301],"(",["T_VARIABLE","$storage_definition",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$original_storage_definitions",301],"[",["T_VARIABLE","$field_name",301],"]",")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n              ",301],["T_VARIABLE","$field_changes",302],"[",["T_VARIABLE","$field_name",302],"]",["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_STATIC","static",302],["T_DOUBLE_COLON","::",302],["T_STRING","DEFINITION_UPDATED",302],";",["T_WHITESPACE","\n            ",302],"}",["T_WHITESPACE","\n          ",303],"}",["T_WHITESPACE","\n\n          ",304],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$field_changes",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$change_list",307],"[",["T_VARIABLE","$entity_type_id",307],"]","[",["T_CONSTANT_ENCAPSED_STRING","'field_storage_definitions'",307],"]",["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$field_changes",307],";",["T_WHITESPACE","\n          ",307],"}",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n      ",309],"}",["T_WHITESPACE","\n    ",310],"}",["T_WHITESPACE","\n\n    ",311],["T_COMMENT","\/\/ @todo Support deleting entity definitions when we support base field\n",313],["T_WHITESPACE","    ",314],["T_COMMENT","\/\/   purging. See https:\/\/www.drupal.org\/node\/2282119.\n",314],["T_WHITESPACE","\n    ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","entityManager",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","useCaches",316],"(",["T_STRING","TRUE",316],")",";",["T_WHITESPACE","\n\n    ",316],["T_RETURN","return",318],["T_WHITESPACE"," ",318],["T_STRING","array_filter",318],"(",["T_VARIABLE","$change_list",318],")",";",["T_WHITESPACE","\n  ",318],"}",["T_WHITESPACE","\n\n  ",319],["T_DOC_COMMENT","\/**\n   * Checks if the changes to the entity type requires storage schema changes.\n   *\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $entity_type\n   *   The updated entity type definition.\n   * @param \\Drupal\\Core\\Entity\\EntityTypeInterface $original\n   *   The original entity type definition.\n   *\n   * @return bool\n   *   TRUE if storage schema changes are required, FALSE otherwise.\n   *\/",321],["T_WHITESPACE","\n  ",331],["T_PROTECTED","protected",332],["T_WHITESPACE"," ",332],["T_FUNCTION","function",332],["T_WHITESPACE"," ",332],["T_STRING","requiresEntityStorageSchemaChanges",332],"(",["T_STRING","EntityTypeInterface",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$entity_type",332],",",["T_WHITESPACE"," ",332],["T_STRING","EntityTypeInterface",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$original",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n    ",332],["T_VARIABLE","$storage",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","entityManager",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getStorage",333],"(",["T_VARIABLE","$entity_type",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","id",333],"(",")",")",";",["T_WHITESPACE","\n    ",333],["T_RETURN","return",334],["T_WHITESPACE"," ",334],"(",["T_VARIABLE","$storage",334],["T_WHITESPACE"," ",334],["T_INSTANCEOF","instanceof",334],["T_WHITESPACE"," ",334],["T_STRING","EntityStorageSchemaInterface",334],")",["T_WHITESPACE"," ",334],["T_BOOLEAN_AND","&&",334],["T_WHITESPACE"," ",334],["T_VARIABLE","$storage",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","requiresEntityStorageSchemaChanges",334],"(",["T_VARIABLE","$entity_type",334],",",["T_WHITESPACE"," ",334],["T_VARIABLE","$original",334],")",";",["T_WHITESPACE","\n  ",334],"}",["T_WHITESPACE","\n\n  ",335],["T_DOC_COMMENT","\/**\n   * Checks if the changes to the storage definition requires schema changes.\n   *\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $storage_definition\n   *   The updated field storage definition.\n   * @param \\Drupal\\Core\\Field\\FieldStorageDefinitionInterface $original\n   *   The original field storage definition.\n   *\n   * @return bool\n   *   TRUE if storage schema changes are required, FALSE otherwise.\n   *\/",337],["T_WHITESPACE","\n  ",347],["T_PROTECTED","protected",348],["T_WHITESPACE"," ",348],["T_FUNCTION","function",348],["T_WHITESPACE"," ",348],["T_STRING","requiresFieldStorageSchemaChanges",348],"(",["T_STRING","FieldStorageDefinitionInterface",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$storage_definition",348],",",["T_WHITESPACE"," ",348],["T_STRING","FieldStorageDefinitionInterface",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$original",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n    ",348],["T_VARIABLE","$storage",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","entityManager",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getStorage",349],"(",["T_VARIABLE","$storage_definition",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getTargetEntityTypeId",349],"(",")",")",";",["T_WHITESPACE","\n    ",349],["T_RETURN","return",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$storage",350],["T_WHITESPACE"," ",350],["T_INSTANCEOF","instanceof",350],["T_WHITESPACE"," ",350],["T_STRING","DynamicallyFieldableEntityStorageSchemaInterface",350],")",["T_WHITESPACE"," ",350],["T_BOOLEAN_AND","&&",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$storage",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","requiresFieldStorageSchemaChanges",350],"(",["T_VARIABLE","$storage_definition",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$original",350],")",";",["T_WHITESPACE","\n  ",350],"}",["T_WHITESPACE","\n\n",351],"}",["T_WHITESPACE","\n",353]]