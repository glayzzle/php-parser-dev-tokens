[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Entity",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Plugin",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Validation",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Constraint",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Symfony",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Validator",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Constraint",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Symfony",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Validator",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ConstraintValidator",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Checks if the current user has access to newly referenced entities.\n *\/",8],["T_WHITESPACE","\n",10],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","ReferenceAccessConstraintValidator",11],["T_WHITESPACE"," ",11],["T_EXTENDS","extends",11],["T_WHITESPACE"," ",11],["T_STRING","ConstraintValidator",11],["T_WHITESPACE"," ",11],"{",["T_WHITESPACE","\n\n  ",11],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",13],["T_WHITESPACE","\n  ",15],["T_PUBLIC","public",16],["T_WHITESPACE"," ",16],["T_FUNCTION","function",16],["T_WHITESPACE"," ",16],["T_STRING","validate",16],"(",["T_VARIABLE","$value",16],",",["T_WHITESPACE"," ",16],["T_STRING","Constraint",16],["T_WHITESPACE"," ",16],["T_VARIABLE","$constraint",16],")",["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n    ",16],["T_COMMENT","\/* @var \\Drupal\\Core\\Field\\FieldItemInterface $value *\/",17],["T_WHITESPACE","\n    ",17],["T_IF","if",18],["T_WHITESPACE"," ",18],"(","!",["T_ISSET","isset",18],"(",["T_VARIABLE","$value",18],")",")",["T_WHITESPACE"," ",18],"{",["T_WHITESPACE","\n      ",18],["T_RETURN","return",19],";",["T_WHITESPACE","\n    ",19],"}",["T_WHITESPACE","\n    ",20],["T_VARIABLE","$id",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_VARIABLE","$value",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","target_id",21],";",["T_WHITESPACE","\n    ",21],["T_COMMENT","\/\/ '0' or NULL are considered valid empty references.\n",22],["T_WHITESPACE","    ",23],["T_IF","if",23],["T_WHITESPACE"," ",23],"(",["T_EMPTY","empty",23],"(",["T_VARIABLE","$id",23],")",")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n      ",23],["T_RETURN","return",24],";",["T_WHITESPACE","\n    ",24],"}",["T_WHITESPACE","\n    ",25],["T_COMMENT","\/* @var \\Drupal\\Core\\Entity\\FieldableEntityInterface $referenced_entity *\/",26],["T_WHITESPACE","\n    ",26],["T_VARIABLE","$referenced_entity",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_VARIABLE","$value",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","entity",27],";",["T_WHITESPACE","\n    ",27],["T_IF","if",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$referenced_entity",28],")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n      ",28],["T_VARIABLE","$entity",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$value",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getEntity",29],"(",")",";",["T_WHITESPACE","\n      ",29],["T_VARIABLE","$check_permission",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_STRING","TRUE",30],";",["T_WHITESPACE","\n      ",30],["T_IF","if",31],["T_WHITESPACE"," ",31],"(","!",["T_VARIABLE","$entity",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","isNew",31],"(",")",")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n        ",31],["T_VARIABLE","$existing_entity",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Drupal",32],["T_DOUBLE_COLON","::",32],["T_STRING","entityManager",32],"(",")",["T_OBJECT_OPERATOR","->",32],["T_STRING","getStorage",32],"(",["T_VARIABLE","$entity",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getEntityTypeId",32],"(",")",")",["T_OBJECT_OPERATOR","->",32],["T_STRING","loadUnchanged",32],"(",["T_VARIABLE","$entity",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","id",32],"(",")",")",";",["T_WHITESPACE","\n        ",32],["T_VARIABLE","$referenced_entities",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$existing_entity",33],["T_OBJECT_OPERATOR","->",33],"{",["T_VARIABLE","$value",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getFieldDefinition",33],"(",")",["T_OBJECT_OPERATOR","->",33],["T_STRING","getName",33],"(",")","}",["T_OBJECT_OPERATOR","->",33],["T_STRING","referencedEntities",33],"(",")",";",["T_WHITESPACE","\n        ",33],["T_COMMENT","\/\/ Check permission if we are not already referencing the entity.\n",34],["T_WHITESPACE","        ",35],["T_FOREACH","foreach",35],["T_WHITESPACE"," ",35],"(",["T_VARIABLE","$referenced_entities",35],["T_WHITESPACE"," ",35],["T_AS","as",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$ref",35],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n          ",35],["T_IF","if",36],["T_WHITESPACE"," ",36],"(",["T_ISSET","isset",36],"(",["T_VARIABLE","$referenced_entities",36],"[",["T_VARIABLE","$ref",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","id",36],"(",")","]",")",")",["T_WHITESPACE"," ",36],"{",["T_WHITESPACE","\n            ",36],["T_VARIABLE","$check_permission",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","FALSE",37],";",["T_WHITESPACE","\n            ",37],["T_BREAK","break",38],";",["T_WHITESPACE","\n          ",38],"}",["T_WHITESPACE","\n        ",39],"}",["T_WHITESPACE","\n      ",40],"}",["T_WHITESPACE","\n      ",41],["T_COMMENT","\/\/ We check that the current user had access to view any newly added\n",42],["T_WHITESPACE","      ",43],["T_COMMENT","\/\/ referenced entity.\n",43],["T_WHITESPACE","      ",44],["T_IF","if",44],["T_WHITESPACE"," ",44],"(",["T_VARIABLE","$check_permission",44],["T_WHITESPACE"," ",44],["T_BOOLEAN_AND","&&",44],["T_WHITESPACE"," ",44],"!",["T_VARIABLE","$referenced_entity",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","access",44],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",44],")",")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$type",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$value",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getFieldDefinition",45],"(",")",["T_OBJECT_OPERATOR","->",45],["T_STRING","getSetting",45],"(",["T_CONSTANT_ENCAPSED_STRING","'target_type'",45],")",";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","context",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","addViolation",46],"(",["T_VARIABLE","$constraint",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","message",46],",",["T_WHITESPACE"," ",46],["T_ARRAY","array",46],"(",["T_CONSTANT_ENCAPSED_STRING","'%type'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$type",46],",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'%id'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$id",46],")",")",";",["T_WHITESPACE","\n      ",46],"}",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n  ",48],"}",["T_WHITESPACE","\n\n",49],"}",["T_WHITESPACE","\n",51]]