[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Lock",3],";",["T_WHITESPACE","\n\n",3],["T_DOC_COMMENT","\/**\n * Non backend related common methods implementation for lock backends.\n *\n * @ingroup lock\n *\/",5],["T_WHITESPACE","\n",9],["T_ABSTRACT","abstract",10],["T_WHITESPACE"," ",10],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","LockBackendAbstract",10],["T_WHITESPACE"," ",10],["T_IMPLEMENTS","implements",10],["T_WHITESPACE"," ",10],["T_STRING","LockBackendInterface",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * Current page lock token identifier.\n   *\n   * @var string\n   *\/",12],["T_WHITESPACE","\n  ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$lockId",17],";",["T_WHITESPACE","\n\n  ",17],["T_DOC_COMMENT","\/**\n   * Existing locks for this page.\n   *\n   * @var array\n   *\/",19],["T_WHITESPACE","\n  ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$locks",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_ARRAY","array",24],"(",")",";",["T_WHITESPACE","\n\n  ",24],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",26],["T_WHITESPACE","\n  ",28],["T_PUBLIC","public",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","wait",29],"(",["T_VARIABLE","$name",29],",",["T_WHITESPACE"," ",29],["T_VARIABLE","$delay",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_LNUMBER","30",29],")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n    ",29],["T_COMMENT","\/\/ Pause the process for short periods between calling\n",30],["T_WHITESPACE","    ",31],["T_COMMENT","\/\/ lock_may_be_available(). This prevents hitting the database with constant\n",31],["T_WHITESPACE","    ",32],["T_COMMENT","\/\/ database queries while waiting, which could lead to performance issues.\n",32],["T_WHITESPACE","    ",33],["T_COMMENT","\/\/ However, if the wait period is too long, there is the potential for a\n",33],["T_WHITESPACE","    ",34],["T_COMMENT","\/\/ large number of processes to be blocked waiting for a lock, especially\n",34],["T_WHITESPACE","    ",35],["T_COMMENT","\/\/ if the item being rebuilt is commonly requested. To address both of these\n",35],["T_WHITESPACE","    ",36],["T_COMMENT","\/\/ concerns, begin waiting for 25ms, then add 25ms to the wait period each\n",36],["T_WHITESPACE","    ",37],["T_COMMENT","\/\/ time until it reaches 500ms. After this point polling will continue every\n",37],["T_WHITESPACE","    ",38],["T_COMMENT","\/\/ 500ms until $delay is reached.\n",38],["T_WHITESPACE","\n    ",39],["T_COMMENT","\/\/ $delay is passed in seconds, but we will be using usleep(), which takes\n",40],["T_WHITESPACE","    ",41],["T_COMMENT","\/\/ microseconds as a parameter. Multiply it by 1 million so that all\n",41],["T_WHITESPACE","    ",42],["T_COMMENT","\/\/ further numbers are equivalent.\n",42],["T_WHITESPACE","    ",43],["T_VARIABLE","$delay",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_INT_CAST","(int)",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$delay",43],["T_WHITESPACE"," ",43],"*",["T_WHITESPACE"," ",43],["T_LNUMBER","1000000",43],";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/\/ Begin sleeping at 25ms.\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$sleep",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_LNUMBER","25000",46],";",["T_WHITESPACE","\n    ",46],["T_WHILE","while",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$delay",47],["T_WHITESPACE"," ",47],">",["T_WHITESPACE"," ",47],["T_LNUMBER","0",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n      ",47],["T_COMMENT","\/\/ This function should only be called by a request that failed to get a\n",48],["T_WHITESPACE","      ",49],["T_COMMENT","\/\/ lock, so we sleep first to give the parallel request a chance to finish\n",49],["T_WHITESPACE","      ",50],["T_COMMENT","\/\/ and release the lock.\n",50],["T_WHITESPACE","      ",51],["T_STRING","usleep",51],"(",["T_VARIABLE","$sleep",51],")",";",["T_WHITESPACE","\n      ",51],["T_COMMENT","\/\/ After each sleep, increase the value of $sleep until it reaches\n",52],["T_WHITESPACE","      ",53],["T_COMMENT","\/\/ 500ms, to reduce the potential for a lock stampede.\n",53],["T_WHITESPACE","      ",54],["T_VARIABLE","$delay",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$delay",54],["T_WHITESPACE"," ",54],"-",["T_WHITESPACE"," ",54],["T_VARIABLE","$sleep",54],";",["T_WHITESPACE","\n      ",54],["T_VARIABLE","$sleep",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","min",55],"(",["T_LNUMBER","500000",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$sleep",55],["T_WHITESPACE"," ",55],"+",["T_WHITESPACE"," ",55],["T_LNUMBER","25000",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$delay",55],")",";",["T_WHITESPACE","\n      ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","lockMayBeAvailable",56],"(",["T_VARIABLE","$name",56],")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n        ",56],["T_COMMENT","\/\/ No longer need to wait.\n",57],["T_WHITESPACE","        ",58],["T_RETURN","return",58],["T_WHITESPACE"," ",58],["T_STRING","FALSE",58],";",["T_WHITESPACE","\n      ",58],"}",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n    ",60],["T_COMMENT","\/\/ The caller must still wait longer to get the lock.\n",61],["T_WHITESPACE","    ",62],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_STRING","TRUE",62],";",["T_WHITESPACE","\n  ",62],"}",["T_WHITESPACE","\n\n  ",63],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",65],["T_WHITESPACE","\n  ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","getLockId",68],"(",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n    ",68],["T_IF","if",69],["T_WHITESPACE"," ",69],"(","!",["T_ISSET","isset",69],"(",["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","lockId",69],")",")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n      ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","lockId",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_STRING","uniqid",70],"(",["T_STRING","mt_rand",70],"(",")",",",["T_WHITESPACE"," ",70],["T_STRING","TRUE",70],")",";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n    ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","lockId",72],";",["T_WHITESPACE","\n  ",72],"}",["T_WHITESPACE","\n\n",73],"}",["T_WHITESPACE","\n",75]]