[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Update",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Extension",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Extension",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Extension",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ExtensionDiscovery",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","KeyValueStore",7],["T_NS_SEPARATOR","\\",7],["T_STRING","KeyValueStoreInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Provides all and missing update implementations.\n *\n * Note: This registry is specific to a type of updates, like 'post_update' as\n * example.\n *\n * It therefore scans for functions named like the type of updates, so it looks\n * like MODULE_UPDATETYPE_NAME() with NAME being a machine name.\n *\/",9],["T_WHITESPACE","\n",17],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","UpdateRegistry",18],["T_WHITESPACE"," ",18],"{",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * The used update name.\n   *\n   * @var string\n   *\/",20],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$updateType",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'post_update'",25],";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * The app root.\n   *\n   * @var string\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$root",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * The filename of the log file.\n   *\n   * @var string\n   *\/",34],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$logFilename",39],";",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * @var string[]\n   *\/",41],["T_WHITESPACE","\n  ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$enabledModules",44],";",["T_WHITESPACE","\n\n  ",44],["T_DOC_COMMENT","\/**\n   * The key value storage.\n   *\n   * @var \\Drupal\\Core\\KeyValueStore\\KeyValueStoreInterface\n   *\/",46],["T_WHITESPACE","\n  ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$keyValue",51],";",["T_WHITESPACE","\n\n  ",51],["T_DOC_COMMENT","\/**\n   * Should we respect update functions in tests.\n   *\n   * @var bool|null\n   *\/",53],["T_WHITESPACE","\n  ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$includeTests",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","NULL",58],";",["T_WHITESPACE","\n\n  ",58],["T_DOC_COMMENT","\/**\n   * The site path.\n   *\n   * @var string\n   *\/",60],["T_WHITESPACE","\n  ",64],["T_PROTECTED","protected",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$sitePath",65],";",["T_WHITESPACE","\n\n  ",65],["T_DOC_COMMENT","\/**\n   * Constructs a new UpdateRegistry.\n   *\n   * @param string $root\n   *   The app root.\n   * @param string $site_path\n   *   The site path.\n   * @param string[] $enabled_modules\n   *   A list of enabled modules.\n   * @param \\Drupal\\Core\\KeyValueStore\\KeyValueStoreInterface $key_value\n   *   The key value store.\n   * @param bool|null $include_tests\n   *   (optional) A flag whether to include tests in the scanning of modules.\n   *\/",67],["T_WHITESPACE","\n  ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","__construct",81],"(",["T_VARIABLE","$root",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$site_path",81],",",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$enabled_modules",81],",",["T_WHITESPACE"," ",81],["T_STRING","KeyValueStoreInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$key_value",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$include_tests",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","NULL",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","root",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$root",82],";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","sitePath",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$site_path",83],";",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","enabledModules",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$enabled_modules",84],";",["T_WHITESPACE","\n    ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","keyValue",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$key_value",85],";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","includeTests",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$include_tests",86],";",["T_WHITESPACE","\n  ",86],"}",["T_WHITESPACE","\n\n  ",87],["T_DOC_COMMENT","\/**\n   * Gets all available update functions.\n   *\n   * @return callable[]\n   *   A list of update functions.\n   *\/",89],["T_WHITESPACE","\n  ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","getAvailableUpdateFunctions",95],"(",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$regexp",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'\/^(?<module>.+)_'",96],["T_WHITESPACE"," ",96],".",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","updateType",96],["T_WHITESPACE"," ",96],".",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'_(?<name>.+)$\/'",96],";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$functions",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","get_defined_functions",97],"(",")",";",["T_WHITESPACE","\n\n    ",97],["T_VARIABLE","$updates",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],"[","]",";",["T_WHITESPACE","\n    ",99],["T_FOREACH","foreach",100],["T_WHITESPACE"," ",100],"(",["T_STRING","preg_grep",100],"(",["T_CONSTANT_ENCAPSED_STRING","'\/_'",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","updateType",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'_\/'",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$functions",100],"[",["T_CONSTANT_ENCAPSED_STRING","'user'",100],"]",")",["T_WHITESPACE"," ",100],["T_AS","as",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$function",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n      ",100],["T_COMMENT","\/\/ If this function is a module update function, add it to the list of\n",101],["T_WHITESPACE","      ",102],["T_COMMENT","\/\/ module updates.\n",102],["T_WHITESPACE","      ",103],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_STRING","preg_match",103],"(",["T_VARIABLE","$regexp",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$function",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$matches",103],")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_STRING","in_array",104],"(",["T_VARIABLE","$matches",104],"[",["T_CONSTANT_ENCAPSED_STRING","'module'",104],"]",",",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","enabledModules",104],")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n          ",104],["T_VARIABLE","$updates",105],"[","]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$matches",105],"[",["T_CONSTANT_ENCAPSED_STRING","'module'",105],"]",["T_WHITESPACE"," ",105],".",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'_'",105],["T_WHITESPACE"," ",105],".",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","updateType",105],["T_WHITESPACE"," ",105],".",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'_'",105],["T_WHITESPACE"," ",105],".",["T_WHITESPACE"," ",105],["T_VARIABLE","$matches",105],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",105],"]",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n      ",106],"}",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_COMMENT","\/\/ Ensure that the update order is deterministic.\n",110],["T_WHITESPACE","    ",111],["T_STRING","sort",111],"(",["T_VARIABLE","$updates",111],")",";",["T_WHITESPACE","\n    ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$updates",112],";",["T_WHITESPACE","\n  ",112],"}",["T_WHITESPACE","\n\n  ",113],["T_DOC_COMMENT","\/**\n   * Find all update functions that haven't been executed.\n   *\n   * @return callable[]\n   *   A list of update functions.\n   *\/",115],["T_WHITESPACE","\n  ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","getPendingUpdateFunctions",121],"(",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n    ",121],["T_COMMENT","\/\/ We need a) the list of active modules (we get that from the config\n",122],["T_WHITESPACE","    ",123],["T_COMMENT","\/\/ bootstrap factory) and b) the path to the modules, we use the extension\n",123],["T_WHITESPACE","    ",124],["T_COMMENT","\/\/ discovery for that.\n",124],["T_WHITESPACE","\n    ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","scanExtensionsAndLoadUpdateFiles",126],"(",")",";",["T_WHITESPACE","\n\n    ",126],["T_COMMENT","\/\/ First figure out which hook_{$this->updateType}_NAME got executed\n",128],["T_WHITESPACE","    ",129],["T_COMMENT","\/\/ already.\n",129],["T_WHITESPACE","    ",130],["T_VARIABLE","$existing_update_functions",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","keyValue",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","get",130],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_updates'",130],",",["T_WHITESPACE"," ",130],"[","]",")",";",["T_WHITESPACE","\n\n    ",130],["T_VARIABLE","$available_update_functions",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getAvailableUpdateFunctions",132],"(",")",";",["T_WHITESPACE","\n    ",132],["T_VARIABLE","$not_executed_update_functions",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","array_diff",133],"(",["T_VARIABLE","$available_update_functions",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$existing_update_functions",133],")",";",["T_WHITESPACE","\n\n    ",133],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$not_executed_update_functions",135],";",["T_WHITESPACE","\n  ",135],"}",["T_WHITESPACE","\n\n  ",136],["T_DOC_COMMENT","\/**\n   * Loads all update files for a given list of extension.\n   *\n   * @param \\Drupal\\Core\\Extension\\Extension[] $module_extensions\n   *   The extensions used for loading.\n   *\/",138],["T_WHITESPACE","\n  ",143],["T_PROTECTED","protected",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","loadUpdateFiles",144],"(",["T_ARRAY","array",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$module_extensions",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n    ",144],["T_COMMENT","\/\/ Load all the {$this->updateType}.php files.\n",145],["T_WHITESPACE","    ",146],["T_FOREACH","foreach",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","enabledModules",146],["T_WHITESPACE"," ",146],["T_AS","as",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$module",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n      ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_ISSET","isset",147],"(",["T_VARIABLE","$module_extensions",147],"[",["T_VARIABLE","$module",147],"]",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","loadUpdateFile",148],"(",["T_VARIABLE","$module_extensions",148],"[",["T_VARIABLE","$module",148],"]",")",";",["T_WHITESPACE","\n      ",148],"}",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n  ",150],"}",["T_WHITESPACE","\n\n  ",151],["T_DOC_COMMENT","\/**\n   * Loads the {$this->updateType}.php file for a given extension.\n   *\n   * @param \\Drupal\\Core\\Extension\\Extension $module\n   *   The extension of the module to load its file.\n   *\/",153],["T_WHITESPACE","\n  ",158],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","loadUpdateFile",159],"(",["T_STRING","Extension",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$module",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n    ",159],["T_VARIABLE","$filename",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","root",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'\/'",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_VARIABLE","$module",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getPath",160],"(",")",["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'\/'",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_VARIABLE","$module",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getName",160],"(",")",["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],"\"",["T_ENCAPSED_AND_WHITESPACE",".",160],["T_CURLY_OPEN","{",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","updateType",160],"}",["T_ENCAPSED_AND_WHITESPACE",".php",160],"\"",";",["T_WHITESPACE","\n    ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_STRING","file_exists",161],"(",["T_VARIABLE","$filename",161],")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n      ",161],["T_INCLUDE_ONCE","include_once",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$filename",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n  ",163],"}",["T_WHITESPACE","\n\n  ",164],["T_DOC_COMMENT","\/**\n   * Returns a list of all the pending updates.\n   *\n   * @return array[]\n   *   An associative array keyed by module name which contains all information\n   *   about database updates that need to be run, and any updates that are not\n   *   going to proceed due to missing requirements.\n   *\n   *   The subarray for each module can contain the following keys:\n   *   - start: The starting update that is to be processed. If this does not\n   *       exist then do not process any updates for this module as there are\n   *       other requirements that need to be resolved.\n   *   - pending: An array of all the pending updates for the module including\n   *       the description from source code comment for each update function.\n   *       This array is keyed by the update name.\n   *\/",166],["T_WHITESPACE","\n  ",181],["T_PUBLIC","public",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","getPendingUpdateInformation",182],"(",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n    ",182],["T_VARIABLE","$functions",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getPendingUpdateFunctions",183],"(",")",";",["T_WHITESPACE","\n\n    ",183],["T_VARIABLE","$ret",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],"[","]",";",["T_WHITESPACE","\n    ",185],["T_FOREACH","foreach",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$functions",186],["T_WHITESPACE"," ",186],["T_AS","as",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$function",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n      ",186],["T_LIST","list",187],"(",["T_VARIABLE","$module",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$update",187],")",["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_STRING","explode",187],"(","\"",["T_ENCAPSED_AND_WHITESPACE","_",187],["T_CURLY_OPEN","{",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","updateType",187],"}",["T_ENCAPSED_AND_WHITESPACE","_",187],"\"",",",["T_WHITESPACE"," ",187],["T_VARIABLE","$function",187],")",";",["T_WHITESPACE","\n      ",187],["T_COMMENT","\/\/ The description for an update comes from its Doxygen.\n",188],["T_WHITESPACE","      ",189],["T_VARIABLE","$func",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_NEW","new",189],["T_WHITESPACE"," ",189],["T_NS_SEPARATOR","\\",189],["T_STRING","ReflectionFunction",189],"(",["T_VARIABLE","$function",189],")",";",["T_WHITESPACE","\n      ",189],["T_VARIABLE","$description",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","trim",190],"(",["T_STRING","str_replace",190],"(",["T_ARRAY","array",190],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",190],",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","'*'",190],",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","'\/'",190],")",",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","''",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$func",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getDocComment",190],"(",")",")",",",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","' '",190],")",";",["T_WHITESPACE","\n      ",190],["T_VARIABLE","$ret",191],"[",["T_VARIABLE","$module",191],"]","[",["T_CONSTANT_ENCAPSED_STRING","'pending'",191],"]","[",["T_VARIABLE","$update",191],"]",["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$description",191],";",["T_WHITESPACE","\n      ",191],["T_IF","if",192],["T_WHITESPACE"," ",192],"(","!",["T_ISSET","isset",192],"(",["T_VARIABLE","$ret",192],"[",["T_VARIABLE","$module",192],"]","[",["T_CONSTANT_ENCAPSED_STRING","'start'",192],"]",")",")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$ret",193],"[",["T_VARIABLE","$module",193],"]","[",["T_CONSTANT_ENCAPSED_STRING","'start'",193],"]",["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$update",193],";",["T_WHITESPACE","\n      ",193],"}",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n    ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$ret",196],";",["T_WHITESPACE","\n  ",196],"}",["T_WHITESPACE","\n\n  ",197],["T_DOC_COMMENT","\/**\n   * Registers that update fucntions got executed.\n   *\n   * @param string[] $function_names\n   *   The executed update functions.\n   *\n   * @return $this\n   *\/",199],["T_WHITESPACE","\n  ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","registerInvokedUpdates",207],"(",["T_ARRAY","array",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$function_names",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n    ",207],["T_VARIABLE","$executed_updates",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","keyValue",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","get",208],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_updates'",208],",",["T_WHITESPACE"," ",208],"[","]",")",";",["T_WHITESPACE","\n    ",208],["T_VARIABLE","$executed_updates",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_STRING","array_merge",209],"(",["T_VARIABLE","$executed_updates",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$function_names",209],")",";",["T_WHITESPACE","\n    ",209],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","keyValue",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","set",210],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_updates'",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$executed_updates",210],")",";",["T_WHITESPACE","\n\n    ",210],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n  ",212],"}",["T_WHITESPACE","\n\n  ",213],["T_DOC_COMMENT","\/**\n   * Returns all available updates for a given module.\n   *\n   * @param string $module_name\n   *   The module name.\n   *\n   * @return callable[]\n   *   A list of update functions.\n   *\/",215],["T_WHITESPACE","\n  ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","getModuleUpdateFunctions",224],"(",["T_VARIABLE","$module_name",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n    ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","scanExtensionsAndLoadUpdateFiles",225],"(",")",";",["T_WHITESPACE","\n    ",225],["T_VARIABLE","$all_functions",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getAvailableUpdateFunctions",226],"(",")",";",["T_WHITESPACE","\n\n    ",226],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_STRING","array_filter",228],"(",["T_VARIABLE","$all_functions",228],",",["T_WHITESPACE"," ",228],["T_FUNCTION","function",228],"(",["T_VARIABLE","$function_name",228],")",["T_WHITESPACE"," ",228],["T_USE","use",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$module_name",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n      ",228],["T_LIST","list",229],"(",["T_VARIABLE","$function_module_name",229],",",["T_WHITESPACE"," ",229],")",["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","explode",229],"(","\"",["T_ENCAPSED_AND_WHITESPACE","_",229],["T_CURLY_OPEN","{",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","updateType",229],"}",["T_ENCAPSED_AND_WHITESPACE","_",229],"\"",",",["T_WHITESPACE"," ",229],["T_VARIABLE","$function_name",229],")",";",["T_WHITESPACE","\n      ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$function_module_name",230],["T_WHITESPACE"," ",230],["T_IS_IDENTICAL","===",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$module_name",230],";",["T_WHITESPACE","\n    ",230],"}",")",";",["T_WHITESPACE","\n  ",231],"}",["T_WHITESPACE","\n\n  ",232],["T_DOC_COMMENT","\/**\n   * Scans all module + profile extensions and load the update files.\n   *\/",234],["T_WHITESPACE","\n  ",236],["T_PROTECTED","protected",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","scanExtensionsAndLoadUpdateFiles",237],"(",")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n    ",237],["T_COMMENT","\/\/ Scan the module list.\n",238],["T_WHITESPACE","    ",239],["T_VARIABLE","$extension_discovery",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_NEW","new",239],["T_WHITESPACE"," ",239],["T_STRING","ExtensionDiscovery",239],"(",["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","root",239],",",["T_WHITESPACE"," ",239],["T_STRING","FALSE",239],",",["T_WHITESPACE"," ",239],"[","]",",",["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","sitePath",239],")",";",["T_WHITESPACE","\n    ",239],["T_VARIABLE","$module_extensions",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$extension_discovery",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","scan",240],"(",["T_CONSTANT_ENCAPSED_STRING","'module'",240],")",";",["T_WHITESPACE","\n\n    ",240],["T_VARIABLE","$profile_extensions",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$extension_discovery",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","scan",242],"(",["T_CONSTANT_ENCAPSED_STRING","'profile'",242],")",";",["T_WHITESPACE","\n    ",242],["T_VARIABLE","$extensions",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_STRING","array_merge",243],"(",["T_VARIABLE","$module_extensions",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$profile_extensions",243],")",";",["T_WHITESPACE","\n\n    ",243],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","loadUpdateFiles",245],"(",["T_VARIABLE","$extensions",245],")",";",["T_WHITESPACE","\n  ",245],"}",["T_WHITESPACE","\n\n  ",246],["T_DOC_COMMENT","\/**\n   * Filters out already executed update functions by module.\n   *\n   * @param string $module\n   *   The module name.\n   *\/",248],["T_WHITESPACE","\n  ",253],["T_PUBLIC","public",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","filterOutInvokedUpdatesByModule",254],"(",["T_VARIABLE","$module",254],")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n    ",254],["T_VARIABLE","$existing_update_functions",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","keyValue",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","get",255],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_updates'",255],",",["T_WHITESPACE"," ",255],"[","]",")",";",["T_WHITESPACE","\n\n    ",255],["T_VARIABLE","$remaining_update_functions",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","array_filter",257],"(",["T_VARIABLE","$existing_update_functions",257],",",["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],"(",["T_VARIABLE","$function_name",257],")",["T_WHITESPACE"," ",257],["T_USE","use",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$module",257],")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n      ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_STRING","strpos",258],"(",["T_VARIABLE","$function_name",258],",",["T_WHITESPACE"," ",258],"\"",["T_CURLY_OPEN","{",258],["T_VARIABLE","$module",258],"}",["T_ENCAPSED_AND_WHITESPACE","_",258],["T_CURLY_OPEN","{",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","updateType",258],"}",["T_ENCAPSED_AND_WHITESPACE","_",258],"\"",")",["T_WHITESPACE"," ",258],["T_IS_NOT_IDENTICAL","!==",258],["T_WHITESPACE"," ",258],["T_LNUMBER","0",258],";",["T_WHITESPACE","\n    ",258],"}",")",";",["T_WHITESPACE","\n\n    ",259],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","keyValue",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","set",261],"(",["T_CONSTANT_ENCAPSED_STRING","'existing_updates'",261],",",["T_WHITESPACE"," ",261],["T_STRING","array_values",261],"(",["T_VARIABLE","$remaining_update_functions",261],")",")",";",["T_WHITESPACE","\n  ",261],"}",["T_WHITESPACE","\n\n",262],"}",["T_WHITESPACE","\n",264]]