[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","EventSubscriber",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Symfony",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","HttpKernel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelEvents",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Symfony",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","HttpKernel",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Event",7],["T_NS_SEPARATOR","\\",7],["T_STRING","GetResponseEvent",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Symfony",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Component",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EventDispatcher",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EventSubscriberInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * System subscriber for controller requests.\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","ReplicaDatabaseIgnoreSubscriber",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_STRING","EventSubscriberInterface",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * Checks and disables the replica database server if appropriate.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\GetResponseEvent $event\n   *   The Event to process.\n   *\/",15],["T_WHITESPACE","\n  ",20],["T_PUBLIC","public",21],["T_WHITESPACE"," ",21],["T_FUNCTION","function",21],["T_WHITESPACE"," ",21],["T_STRING","checkReplicaServer",21],"(",["T_STRING","GetResponseEvent",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$event",21],")",["T_WHITESPACE"," ",21],"{",["T_WHITESPACE","\n    ",21],["T_COMMENT","\/\/ Ignore replica database servers for this request.\n",22],["T_WHITESPACE","    ",23],["T_COMMENT","\/\/\n",23],["T_WHITESPACE","    ",24],["T_COMMENT","\/\/ In Drupal's distributed database structure, new data is written to the\n",24],["T_WHITESPACE","    ",25],["T_COMMENT","\/\/ master and then propagated to the replica servers.  This means there is a\n",25],["T_WHITESPACE","    ",26],["T_COMMENT","\/\/ lag between when data is written to the master and when it is available\n",26],["T_WHITESPACE","    ",27],["T_COMMENT","\/\/ on the replica. At these times, we will want to avoid using a replica server\n",27],["T_WHITESPACE","    ",28],["T_COMMENT","\/\/ temporarily. For example, if a user posts a new node then we want to\n",28],["T_WHITESPACE","    ",29],["T_COMMENT","\/\/ disable the replica server for that user temporarily to allow the replica\n",29],["T_WHITESPACE","    ",30],["T_COMMENT","\/\/ server to catch up.\n",30],["T_WHITESPACE","    ",31],["T_COMMENT","\/\/ That way, that user will see their changes immediately while for other\n",31],["T_WHITESPACE","    ",32],["T_COMMENT","\/\/ users we still get the benefits of having a replica server, just with\n",32],["T_WHITESPACE","    ",33],["T_COMMENT","\/\/ slightly stale data.  Code that wants to disable the replica server should\n",33],["T_WHITESPACE","    ",34],["T_COMMENT","\/\/ use the db_set_ignore_replica() function to set\n",34],["T_WHITESPACE","    ",35],["T_COMMENT","\/\/ $_SESSION['ignore_replica_server'] to the timestamp after which the replica\n",35],["T_WHITESPACE","    ",36],["T_COMMENT","\/\/ can be re-enabled.\n",36],["T_WHITESPACE","    ",37],["T_IF","if",37],["T_WHITESPACE"," ",37],"(",["T_ISSET","isset",37],"(",["T_VARIABLE","$_SESSION",37],"[",["T_CONSTANT_ENCAPSED_STRING","'ignore_replica_server'",37],"]",")",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n      ",37],["T_IF","if",38],["T_WHITESPACE"," ",38],"(",["T_VARIABLE","$_SESSION",38],"[",["T_CONSTANT_ENCAPSED_STRING","'ignore_replica_server'",38],"]",["T_WHITESPACE"," ",38],["T_IS_GREATER_OR_EQUAL",">=",38],["T_WHITESPACE"," ",38],["T_STRING","REQUEST_TIME",38],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n        ",38],["T_STRING","Database",39],["T_DOUBLE_COLON","::",39],["T_STRING","ignoreTarget",39],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'replica'",39],")",";",["T_WHITESPACE","\n      ",39],"}",["T_WHITESPACE","\n      ",40],["T_ELSE","else",41],["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_UNSET","unset",42],"(",["T_VARIABLE","$_SESSION",42],"[",["T_CONSTANT_ENCAPSED_STRING","'ignore_replica_server'",42],"]",")",";",["T_WHITESPACE","\n      ",42],"}",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n  ",44],"}",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",47],["T_WHITESPACE","\n  ",49],["T_STATIC","static",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","getSubscribedEvents",50],"(",")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$events",51],"[",["T_STRING","KernelEvents",51],["T_DOUBLE_COLON","::",51],["T_STRING","REQUEST",51],"]","[","]",["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],"(",["T_CONSTANT_ENCAPSED_STRING","'checkReplicaServer'",51],")",";",["T_WHITESPACE","\n    ",51],["T_RETURN","return",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$events",52],";",["T_WHITESPACE","\n  ",52],"}",["T_WHITESPACE","\n\n",53],"}",["T_WHITESPACE","\n",55]]