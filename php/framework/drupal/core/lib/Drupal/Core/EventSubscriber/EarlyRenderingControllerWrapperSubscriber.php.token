[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","EventSubscriber",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Ajax",5],["T_NS_SEPARATOR","\\",5],["T_STRING","AjaxResponse",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Cache",6],["T_NS_SEPARATOR","\\",6],["T_STRING","CacheableDependencyInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Cache",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CacheableResponseInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Controller",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ControllerResolverInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Drupal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Core",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Render",9],["T_NS_SEPARATOR","\\",9],["T_STRING","AttachmentsInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Drupal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Core",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Render",10],["T_NS_SEPARATOR","\\",10],["T_STRING","BubbleableMetadata",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Drupal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Core",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Render",11],["T_NS_SEPARATOR","\\",11],["T_STRING","RenderContext",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Drupal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Core",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Render",12],["T_NS_SEPARATOR","\\",12],["T_STRING","RendererInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Symfony",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Component",13],["T_NS_SEPARATOR","\\",13],["T_STRING","EventDispatcher",13],["T_NS_SEPARATOR","\\",13],["T_STRING","EventSubscriberInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","HttpKernel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Event",14],["T_NS_SEPARATOR","\\",14],["T_STRING","FilterControllerEvent",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpKernel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","KernelEvents",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Subscriber that wraps controllers, to handle early rendering.\n *\n * When controllers call drupal_render() (RendererInterface::render()) outside\n * of a render context, we call that \"early rendering\". Controllers should\n * return only render arrays, but we cannot prevent controllers from doing early\n * rendering. The problem with early rendering is that the bubbleable metadata\n * (cacheability & attachments) are lost.\n *\n * This can lead to broken pages (missing assets), stale pages (missing cache\n * tags causing a page not to be invalidated) or even security problems (missing\n * cache contexts causing a cached page not to be varied sufficiently).\n *\n * This event subscriber wraps all controller executions in a closure that sets\n * up a render context. Consequently, any early rendering will have their\n * bubbleable metadata (assets & cacheability) stored on that render context.\n *\n * If the render context is empty, then the controller either did not do any\n * rendering at all, or used the RendererInterface::renderRoot() or\n * ::renderPlain() methods. In that case, no bubbleable metadata is lost.\n *\n * If the render context is not empty, then the controller did use\n * drupal_render(), and bubbleable metadata was collected. This bubbleable\n * metadata is then merged onto the render array.\n *\n * In other words: this just exists to ease the transition to Drupal 8: it\n * allows controllers that return render arrays (the majority) and\n * \\Drupal\\Core\\Ajax\\AjaxResponse\\AjaxResponse objects (a sizable minority that\n * often involve a fair amount of rendering) to still do early rendering. But\n * controllers that return any other kind of response are already expected to\n * do the right thing, so if early rendering is detected in such a case, an\n * exception is thrown.\n *\n * @see \\Drupal\\Core\\Render\\RendererInterface\n * @see \\Drupal\\Core\\Render\\Renderer\n *\n * @todo Remove in Drupal 9.0.0, by disallowing early rendering.\n *\/",17],["T_WHITESPACE","\n",54],["T_CLASS","class",55],["T_WHITESPACE"," ",55],["T_STRING","EarlyRenderingControllerWrapperSubscriber",55],["T_WHITESPACE"," ",55],["T_IMPLEMENTS","implements",55],["T_WHITESPACE"," ",55],["T_STRING","EventSubscriberInterface",55],["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * The controller resolver.\n   *\n   * @var \\Drupal\\Core\\Controller\\ControllerResolverInterface\n   *\/",57],["T_WHITESPACE","\n  ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$controllerResolver",62],";",["T_WHITESPACE","\n\n  ",62],["T_DOC_COMMENT","\/**\n   * The renderer.\n   *\n   * @var \\Drupal\\Core\\Render\\RendererInterface\n   *\/",64],["T_WHITESPACE","\n  ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$renderer",69],";",["T_WHITESPACE","\n\n  ",69],["T_DOC_COMMENT","\/**\n   * Constructs a new EarlyRenderingControllerWrapperSubscriber instance.\n   *\n   * @param \\Drupal\\Core\\Controller\\ControllerResolverInterface $controller_resolver\n   *   The controller resolver.\n   * @param \\Drupal\\Core\\Render\\RendererInterface $renderer\n   *   The renderer.\n   *\/",71],["T_WHITESPACE","\n  ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","__construct",79],"(",["T_STRING","ControllerResolverInterface",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$controller_resolver",79],",",["T_WHITESPACE"," ",79],["T_STRING","RendererInterface",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$renderer",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","controllerResolver",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$controller_resolver",80],";",["T_WHITESPACE","\n    ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","renderer",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$renderer",81],";",["T_WHITESPACE","\n  ",81],"}",["T_WHITESPACE","\n\n  ",82],["T_DOC_COMMENT","\/**\n   * Ensures bubbleable metadata from early rendering is not lost.\n   *\n   * @param \\Symfony\\Component\\HttpKernel\\Event\\FilterControllerEvent $event\n   *   The controller event.\n   *\/",84],["T_WHITESPACE","\n  ",89],["T_PUBLIC","public",90],["T_WHITESPACE"," ",90],["T_FUNCTION","function",90],["T_WHITESPACE"," ",90],["T_STRING","onController",90],"(",["T_STRING","FilterControllerEvent",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$event",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$controller",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$event",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getController",91],"(",")",";",["T_WHITESPACE","\n\n    ",91],["T_COMMENT","\/\/ See \\Symfony\\Component\\HttpKernel\\HttpKernel::handleRaw().\n",93],["T_WHITESPACE","    ",94],["T_VARIABLE","$arguments",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","controllerResolver",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getArguments",94],"(",["T_VARIABLE","$event",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getRequest",94],"(",")",",",["T_WHITESPACE"," ",94],["T_VARIABLE","$controller",94],")",";",["T_WHITESPACE","\n\n    ",94],["T_VARIABLE","$event",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","setController",96],"(",["T_FUNCTION","function",96],"(",")",["T_WHITESPACE"," ",96],["T_USE","use",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$controller",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$arguments",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n      ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","wrapControllerExecutionInRenderContext",97],"(",["T_VARIABLE","$controller",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$arguments",97],")",";",["T_WHITESPACE","\n    ",97],"}",")",";",["T_WHITESPACE","\n  ",98],"}",["T_WHITESPACE","\n\n  ",99],["T_DOC_COMMENT","\/**\n   * Wraps a controller execution in a render context.\n   *\n   * @param callable $controller\n   *   The controller to execute.\n   * @param array $arguments\n   *   The arguments to pass to the controller.\n   *\n   * @return mixed\n   *   The return value of the controller.\n   *\n   * @throws \\LogicException\n   *   When early rendering has occurred in a controller that returned a\n   *   Response or domain object that cares about attachments or cacheability.\n   *\n   * @see \\Symfony\\Component\\HttpKernel\\HttpKernel::handleRaw()\n   *\/",101],["T_WHITESPACE","\n  ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","wrapControllerExecutionInRenderContext",118],"(",["T_VARIABLE","$controller",118],",",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$arguments",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n    ",118],["T_VARIABLE","$context",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_NEW","new",119],["T_WHITESPACE"," ",119],["T_STRING","RenderContext",119],"(",")",";",["T_WHITESPACE","\n\n    ",119],["T_VARIABLE","$response",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","renderer",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","executeInRenderContext",121],"(",["T_VARIABLE","$context",121],",",["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],"(",")",["T_WHITESPACE"," ",121],["T_USE","use",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$controller",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$arguments",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n      ",121],["T_COMMENT","\/\/ Now call the actual controller, just like HttpKernel does.\n",122],["T_WHITESPACE","      ",123],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_STRING","call_user_func_array",123],"(",["T_VARIABLE","$controller",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$arguments",123],")",";",["T_WHITESPACE","\n    ",123],"}",")",";",["T_WHITESPACE","\n\n    ",124],["T_COMMENT","\/\/ If early rendering happened, i.e. if code in the controller called\n",126],["T_WHITESPACE","    ",127],["T_COMMENT","\/\/ drupal_render() outside of a render context, then the bubbleable metadata\n",127],["T_WHITESPACE","    ",128],["T_COMMENT","\/\/ for that is stored in the current render context.\n",128],["T_WHITESPACE","    ",129],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","!",["T_VARIABLE","$context",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","isEmpty",129],"(",")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n      ",129],["T_DOC_COMMENT","\/** @var \\Drupal\\Core\\Render\\BubbleableMetadata $early_rendering_bubbleable_metadata *\/",130],["T_WHITESPACE","\n      ",130],["T_VARIABLE","$early_rendering_bubbleable_metadata",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$context",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","pop",131],"(",")",";",["T_WHITESPACE","\n\n      ",131],["T_COMMENT","\/\/ If a render array or AjaxResponse is returned by the controller, merge\n",133],["T_WHITESPACE","      ",134],["T_COMMENT","\/\/ the \"lost\" bubbleable metadata.\n",134],["T_WHITESPACE","      ",135],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_STRING","is_array",135],"(",["T_VARIABLE","$response",135],")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n        ",135],["T_STRING","BubbleableMetadata",136],["T_DOUBLE_COLON","::",136],["T_STRING","createFromRenderArray",136],"(",["T_VARIABLE","$response",136],")",["T_WHITESPACE","\n          ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","merge",137],"(",["T_VARIABLE","$early_rendering_bubbleable_metadata",137],")",["T_WHITESPACE","\n          ",137],["T_OBJECT_OPERATOR","->",138],["T_STRING","applyTo",138],"(",["T_VARIABLE","$response",138],")",";",["T_WHITESPACE","\n      ",138],"}",["T_WHITESPACE","\n      ",139],["T_ELSEIF","elseif",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$response",140],["T_WHITESPACE"," ",140],["T_INSTANCEOF","instanceof",140],["T_WHITESPACE"," ",140],["T_STRING","AjaxResponse",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$response",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","addAttachments",141],"(",["T_VARIABLE","$early_rendering_bubbleable_metadata",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getAttachments",141],"(",")",")",";",["T_WHITESPACE","\n        ",141],["T_COMMENT","\/\/ @todo Make AjaxResponse cacheable in\n",142],["T_WHITESPACE","        ",143],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/956186. Meanwhile, allow contrib\n",143],["T_WHITESPACE","        ",144],["T_COMMENT","\/\/   subclasses to be.\n",144],["T_WHITESPACE","        ",145],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$response",145],["T_WHITESPACE"," ",145],["T_INSTANCEOF","instanceof",145],["T_WHITESPACE"," ",145],["T_STRING","CacheableResponseInterface",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n          ",145],["T_VARIABLE","$response",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","addCacheableDependency",146],"(",["T_VARIABLE","$early_rendering_bubbleable_metadata",146],")",";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n      ",147],"}",["T_WHITESPACE","\n      ",148],["T_COMMENT","\/\/ If a non-Ajax Response or domain object is returned and it cares about\n",149],["T_WHITESPACE","      ",150],["T_COMMENT","\/\/ attachments or cacheability, then throw an exception: early rendering\n",150],["T_WHITESPACE","      ",151],["T_COMMENT","\/\/ is not permitted in that case. It is the developer's responsibility\n",151],["T_WHITESPACE","      ",152],["T_COMMENT","\/\/ to not use early rendering.\n",152],["T_WHITESPACE","      ",153],["T_ELSEIF","elseif",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$response",153],["T_WHITESPACE"," ",153],["T_INSTANCEOF","instanceof",153],["T_WHITESPACE"," ",153],["T_STRING","AttachmentsInterface",153],["T_WHITESPACE"," ",153],["T_BOOLEAN_OR","||",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$response",153],["T_WHITESPACE"," ",153],["T_INSTANCEOF","instanceof",153],["T_WHITESPACE"," ",153],["T_STRING","CacheableResponseInterface",153],["T_WHITESPACE"," ",153],["T_BOOLEAN_OR","||",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$response",153],["T_WHITESPACE"," ",153],["T_INSTANCEOF","instanceof",153],["T_WHITESPACE"," ",153],["T_STRING","CacheableDependencyInterface",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n        ",153],["T_THROW","throw",154],["T_WHITESPACE"," ",154],["T_NEW","new",154],["T_WHITESPACE"," ",154],["T_NS_SEPARATOR","\\",154],["T_STRING","LogicException",154],"(",["T_STRING","sprintf",154],"(",["T_CONSTANT_ENCAPSED_STRING","'The controller result claims to be providing relevant cache metadata, but leaked metadata was detected. Please ensure you are not rendering content too early. Returned object class: %s.'",154],",",["T_WHITESPACE"," ",154],["T_STRING","get_class",154],"(",["T_VARIABLE","$response",154],")",")",")",";",["T_WHITESPACE","\n      ",154],"}",["T_WHITESPACE","\n      ",155],["T_ELSE","else",156],["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n        ",156],["T_COMMENT","\/\/ A Response or domain object is returned that does not care about\n",157],["T_WHITESPACE","        ",158],["T_COMMENT","\/\/ attachments nor cacheability; for instance, a RedirectResponse. It is\n",158],["T_WHITESPACE","        ",159],["T_COMMENT","\/\/ safe to discard any early rendering metadata.\n",159],["T_WHITESPACE","      ",160],"}",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$response",163],";",["T_WHITESPACE","\n  ",163],"}",["T_WHITESPACE","\n\n  ",164],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",166],["T_WHITESPACE","\n  ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_STATIC","static",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","getSubscribedEvents",169],"(",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n    ",169],["T_VARIABLE","$events",170],"[",["T_STRING","KernelEvents",170],["T_DOUBLE_COLON","::",170],["T_STRING","CONTROLLER",170],"]","[","]",["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],"[",["T_CONSTANT_ENCAPSED_STRING","'onController'",170],"]",";",["T_WHITESPACE","\n\n    ",170],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$events",172],";",["T_WHITESPACE","\n  ",172],"}",["T_WHITESPACE","\n\n",173],"}",["T_WHITESPACE","\n",175]]