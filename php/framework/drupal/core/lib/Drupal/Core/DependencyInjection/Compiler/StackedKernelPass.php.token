[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","DependencyInjection",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Compiler",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Symfony",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","DependencyInjection",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Compiler",5],["T_NS_SEPARATOR","\\",5],["T_STRING","CompilerPassInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Symfony",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Component",6],["T_NS_SEPARATOR","\\",6],["T_STRING","DependencyInjection",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ContainerBuilder",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Symfony",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DependencyInjection",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Reference",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Provides a compiler pass for stacked HTTP kernels.\n *\n * Builds the HTTP kernel by collecting all services tagged 'http_middleware'\n * and assembling them into a StackedKernel. The middleware with the lowest\n * priority ends up as the outermost while the highest priority middleware\n * wraps the actual HTTP kernel defined by the http_kernel.basic service.\n *\n * The 'http_middleware' service tag additionally accepts a 'responder'\n * parameter. It should be set to TRUE if many or most requests will be handled\n * directly by the middleware. Any underlying middleware and the HTTP kernel are\n * then flagged as 'lazy'. As a result those low priority services and their\n * dependencies are only initialized if the 'responder' middleware fails to\n * generate a response and the request is delegated to the underlying kernel.\n *\n * In general middlewares should not have heavy dependencies. This is especially\n * important for high-priority services which need to run before the internal\n * page cache.\n *\n * An example of a high priority middleware.\n * @code\n * http_middleware.reverse_proxy:\n *   class: Drupal\\Core\\StackMiddleware\\ReverseProxyMiddleware\n *   arguments: ['@settings']\n *   tags:\n *     - { name: http_middleware, priority: 300 }\n * @endcode\n *\n * An example of a responder middleware:\n * @code\n * http_middleware.page_cache:\n *   class: Drupal\\page_cache\\StackMiddleware\\PageCache\n *   arguments: ['@cache.render', '@page_cache_request_policy', '@page_cache_response_policy']\n *   tags:\n *     - { name: http_middleware, priority: 200, responder: true }\n * @endcode\n *\n * @see \\Stack\\Builder\n *\/",9],["T_WHITESPACE","\n",47],["T_CLASS","class",48],["T_WHITESPACE"," ",48],["T_STRING","StackedKernelPass",48],["T_WHITESPACE"," ",48],["T_IMPLEMENTS","implements",48],["T_WHITESPACE"," ",48],["T_STRING","CompilerPassInterface",48],["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n\n  ",48],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",50],["T_WHITESPACE","\n  ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","process",53],"(",["T_STRING","ContainerBuilder",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$container",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n\n    ",53],["T_IF","if",55],["T_WHITESPACE"," ",55],"(","!",["T_VARIABLE","$container",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","hasDefinition",55],"(",["T_CONSTANT_ENCAPSED_STRING","'http_kernel'",55],")",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n      ",55],["T_RETURN","return",56],";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_VARIABLE","$stacked_kernel",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$container",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getDefinition",59],"(",["T_CONSTANT_ENCAPSED_STRING","'http_kernel'",59],")",";",["T_WHITESPACE","\n\n    ",59],["T_COMMENT","\/\/ Return now if this is not a stacked kernel.\n",61],["T_WHITESPACE","    ",62],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$stacked_kernel",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getClass",62],"(",")",["T_WHITESPACE"," ",62],["T_IS_NOT_IDENTICAL","!==",62],["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'Stack\\StackedHttpKernel'",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n      ",62],["T_RETURN","return",63],";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n    ",64],["T_VARIABLE","$middlewares",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],"[","]",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$priorities",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],"[","]",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$responders",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],"[","]",";",["T_WHITESPACE","\n\n    ",68],["T_FOREACH","foreach",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$container",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","findTaggedServiceIds",70],"(",["T_CONSTANT_ENCAPSED_STRING","'http_middleware'",70],")",["T_WHITESPACE"," ",70],["T_AS","as",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$id",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$attributes",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n      ",70],["T_VARIABLE","$priorities",71],"[",["T_VARIABLE","$id",71],"]",["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_ISSET","isset",71],"(",["T_VARIABLE","$attributes",71],"[",["T_LNUMBER","0",71],"]","[",["T_CONSTANT_ENCAPSED_STRING","'priority'",71],"]",")",["T_WHITESPACE"," ",71],"?",["T_WHITESPACE"," ",71],["T_VARIABLE","$attributes",71],"[",["T_LNUMBER","0",71],"]","[",["T_CONSTANT_ENCAPSED_STRING","'priority'",71],"]",["T_WHITESPACE"," ",71],":",["T_WHITESPACE"," ",71],["T_LNUMBER","0",71],";",["T_WHITESPACE","\n      ",71],["T_VARIABLE","$middlewares",72],"[",["T_VARIABLE","$id",72],"]",["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$container",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getDefinition",72],"(",["T_VARIABLE","$id",72],")",";",["T_WHITESPACE","\n      ",72],["T_VARIABLE","$responders",73],"[",["T_VARIABLE","$id",73],"]",["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],"!",["T_EMPTY","empty",73],"(",["T_VARIABLE","$attributes",73],"[",["T_LNUMBER","0",73],"]","[",["T_CONSTANT_ENCAPSED_STRING","'responder'",73],"]",")",";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_STRING","array_multisort",76],"(",["T_VARIABLE","$priorities",76],",",["T_WHITESPACE"," ",76],["T_STRING","SORT_ASC",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$middlewares",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$responders",76],")",";",["T_WHITESPACE","\n\n    ",76],["T_VARIABLE","$decorated_id",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'http_kernel.basic'",78],";",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$middlewares_param",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],"[",["T_NEW","new",79],["T_WHITESPACE"," ",79],["T_STRING","Reference",79],"(",["T_VARIABLE","$decorated_id",79],")","]",";",["T_WHITESPACE","\n\n    ",79],["T_VARIABLE","$first_responder",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","array_search",81],"(",["T_STRING","TRUE",81],",",["T_WHITESPACE"," ",81],["T_STRING","array_reverse",81],"(",["T_VARIABLE","$responders",81],",",["T_WHITESPACE"," ",81],["T_STRING","TRUE",81],")",",",["T_WHITESPACE"," ",81],["T_STRING","TRUE",81],")",";",["T_WHITESPACE","\n    ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$first_responder",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n      ",82],["T_VARIABLE","$container",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getDefinition",83],"(",["T_VARIABLE","$decorated_id",83],")",["T_OBJECT_OPERATOR","->",83],["T_STRING","setLazy",83],"(",["T_STRING","TRUE",83],")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_FOREACH","foreach",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$middlewares",86],["T_WHITESPACE"," ",86],["T_AS","as",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$id",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$decorator",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n      ",86],["T_COMMENT","\/\/ Prepend a reference to the middlewares container parameter.\n",87],["T_WHITESPACE","      ",88],["T_STRING","array_unshift",88],"(",["T_VARIABLE","$middlewares_param",88],",",["T_WHITESPACE"," ",88],["T_NEW","new",88],["T_WHITESPACE"," ",88],["T_STRING","Reference",88],"(",["T_VARIABLE","$id",88],")",")",";",["T_WHITESPACE","\n\n      ",88],["T_COMMENT","\/\/ Prepend the inner kernel as first constructor argument.\n",90],["T_WHITESPACE","      ",91],["T_VARIABLE","$arguments",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$decorator",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getArguments",91],"(",")",";",["T_WHITESPACE","\n      ",91],["T_STRING","array_unshift",92],"(",["T_VARIABLE","$arguments",92],",",["T_WHITESPACE"," ",92],["T_NEW","new",92],["T_WHITESPACE"," ",92],["T_STRING","Reference",92],"(",["T_VARIABLE","$decorated_id",92],")",")",";",["T_WHITESPACE","\n      ",92],["T_VARIABLE","$decorator",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","setArguments",93],"(",["T_VARIABLE","$arguments",93],")",";",["T_WHITESPACE","\n\n      ",93],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$first_responder",95],["T_WHITESPACE"," ",95],["T_IS_IDENTICAL","===",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$id",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$first_responder",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","FALSE",96],";",["T_WHITESPACE","\n      ",96],"}",["T_WHITESPACE","\n      ",97],["T_ELSEIF","elseif",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$first_responder",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$decorator",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setLazy",99],"(",["T_STRING","TRUE",99],")",";",["T_WHITESPACE","\n      ",99],"}",["T_WHITESPACE","\n\n      ",100],["T_VARIABLE","$decorated_id",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$id",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_VARIABLE","$arguments",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],"[",["T_VARIABLE","$middlewares_param",105],"[",["T_LNUMBER","0",105],"]",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$middlewares_param",105],"]",";",["T_WHITESPACE","\n    ",105],["T_VARIABLE","$stacked_kernel",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","setArguments",106],"(",["T_VARIABLE","$arguments",106],")",";",["T_WHITESPACE","\n  ",106],"}",["T_WHITESPACE","\n\n",107],"}",["T_WHITESPACE","\n",109]]