[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Theme",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Access",5],["T_NS_SEPARATOR","\\",5],["T_STRING","CsrfTokenGenerator",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Config",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ConfigFactoryInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Routing",7],["T_NS_SEPARATOR","\\",7],["T_STRING","RouteMatchInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Symfony",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Component",8],["T_NS_SEPARATOR","\\",8],["T_STRING","HttpFoundation",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RequestStack",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Defines a theme negotiator that deals with the active theme on ajax requests.\n *\n * Many different pages can invoke an Ajax request to a generic Ajax path. It is\n * almost always desired for an Ajax response to be rendered using the same\n * theme as the base page, because most themes are built with the assumption\n * that they control the entire page, so if the CSS for two themes are both\n * loaded for a given page, they may conflict with each other. For example,\n * Bartik is Drupal's default theme, and Seven is Drupal's default\n * administration theme. Depending on whether the \"Use the administration theme\n * when editing or creating content\" checkbox is checked, the node edit form may\n * be displayed in either theme, but the Ajax response to the Field module's\n * \"Add another item\" button should be rendered using the same theme as the rest\n * of the page.\n *\/",10],["T_WHITESPACE","\n",24],["T_CLASS","class",25],["T_WHITESPACE"," ",25],["T_STRING","AjaxBasePageNegotiator",25],["T_WHITESPACE"," ",25],["T_IMPLEMENTS","implements",25],["T_WHITESPACE"," ",25],["T_STRING","ThemeNegotiatorInterface",25],["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * The CSRF token generator.\n   *\n   * @var \\Drupal\\Core\\Access\\CsrfTokenGenerator\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$csrfGenerator",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * The config factory.\n   *\n   * @var \\Drupal\\Core\\Config\\ConfigFactoryInterface\n   *\/",34],["T_WHITESPACE","\n  ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$configFactory",39],";",["T_WHITESPACE","\n\n  ",39],["T_DOC_COMMENT","\/**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   *\/",41],["T_WHITESPACE","\n  ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$requestStack",46],";",["T_WHITESPACE","\n\n  ",46],["T_DOC_COMMENT","\/**\n   * Constructs a new AjaxBasePageNegotiator.\n   *\n   * @param \\Drupal\\Core\\Access\\CsrfTokenGenerator $token_generator\n   *   The CSRF token generator.\n   * @param \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory\n   *   The config factory.\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack used to retrieve the current request.\n   *\/",48],["T_WHITESPACE","\n  ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","__construct",58],"(",["T_STRING","CsrfTokenGenerator",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$token_generator",58],",",["T_WHITESPACE"," ",58],["T_STRING","ConfigFactoryInterface",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$config_factory",58],",",["T_WHITESPACE"," ",58],["T_STRING","RequestStack",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$request_stack",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","csrfGenerator",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$token_generator",59],";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","configFactory",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$config_factory",60],";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","requestStack",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$request_stack",61],";",["T_WHITESPACE","\n  ",61],"}",["T_WHITESPACE","\n\n  ",62],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",64],["T_WHITESPACE","\n  ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","applies",67],"(",["T_STRING","RouteMatchInterface",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$route_match",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$ajax_page_state",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","requestStack",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getCurrentRequest",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","request",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","get",68],"(",["T_CONSTANT_ENCAPSED_STRING","'ajax_page_state'",68],")",";",["T_WHITESPACE","\n    ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],"!",["T_EMPTY","empty",69],"(",["T_VARIABLE","$ajax_page_state",69],"[",["T_CONSTANT_ENCAPSED_STRING","'theme'",69],"]",")",["T_WHITESPACE"," ",69],["T_BOOLEAN_AND","&&",69],["T_WHITESPACE"," ",69],["T_ISSET","isset",69],"(",["T_VARIABLE","$ajax_page_state",69],"[",["T_CONSTANT_ENCAPSED_STRING","'theme_token'",69],"]",")",";",["T_WHITESPACE","\n  ",69],"}",["T_WHITESPACE","\n\n  ",70],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",72],["T_WHITESPACE","\n  ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","determineActiveTheme",75],"(",["T_STRING","RouteMatchInterface",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$route_match",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$ajax_page_state",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","requestStack",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getCurrentRequest",76],"(",")",["T_OBJECT_OPERATOR","->",76],["T_STRING","request",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","get",76],"(",["T_CONSTANT_ENCAPSED_STRING","'ajax_page_state'",76],")",";",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$theme",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$ajax_page_state",77],"[",["T_CONSTANT_ENCAPSED_STRING","'theme'",77],"]",";",["T_WHITESPACE","\n    ",77],["T_VARIABLE","$token",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$ajax_page_state",78],"[",["T_CONSTANT_ENCAPSED_STRING","'theme_token'",78],"]",";",["T_WHITESPACE","\n\n    ",78],["T_COMMENT","\/\/ Prevent a request forgery from giving a person access to a theme they\n",80],["T_WHITESPACE","    ",81],["T_COMMENT","\/\/ shouldn't be otherwise allowed to see. However, since everyone is\n",81],["T_WHITESPACE","    ",82],["T_COMMENT","\/\/ allowed to see the default theme, token validation isn't required for\n",82],["T_WHITESPACE","    ",83],["T_COMMENT","\/\/ that, and bypassing it allows most use-cases to work even when accessed\n",83],["T_WHITESPACE","    ",84],["T_COMMENT","\/\/ from the page cache.\n",84],["T_WHITESPACE","    ",85],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$theme",85],["T_WHITESPACE"," ",85],["T_IS_IDENTICAL","===",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","configFactory",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","get",85],"(",["T_CONSTANT_ENCAPSED_STRING","'system.theme'",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","get",85],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",85],")",["T_WHITESPACE"," ",85],["T_BOOLEAN_OR","||",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","csrfGenerator",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","validate",85],"(",["T_VARIABLE","$token",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$theme",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n      ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$theme",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n  ",87],"}",["T_WHITESPACE","\n\n",88],"}",["T_WHITESPACE","\n",90]]