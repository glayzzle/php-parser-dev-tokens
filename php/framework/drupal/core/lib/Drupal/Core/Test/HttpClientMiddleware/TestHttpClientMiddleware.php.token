[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Test",3],["T_NS_SEPARATOR","\\",3],["T_STRING","HttpClientMiddleware",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Error",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Psr",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Http",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Message",6],["T_NS_SEPARATOR","\\",6],["T_STRING","RequestInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Psr",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Http",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Message",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ResponseInterface",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Overrides the User-Agent HTTP header for outbound HTTP requests.\n *\/",9],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","TestHttpClientMiddleware",12],["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\n  ",12],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\n   * HTTP middleware that replaces the user agent for simpletest requests.\n   *\/",14],["T_WHITESPACE","\n  ",18],["T_PUBLIC","public",19],["T_WHITESPACE"," ",19],["T_FUNCTION","function",19],["T_WHITESPACE"," ",19],["T_STRING","__invoke",19],"(",")",["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n    ",19],["T_COMMENT","\/\/ If the database prefix is being used by SimpleTest to run the tests in a copied\n",20],["T_WHITESPACE","    ",21],["T_COMMENT","\/\/ database then set the user-agent header to the database prefix so that any\n",21],["T_WHITESPACE","    ",22],["T_COMMENT","\/\/ calls to other Drupal pages will run the SimpleTest prefixed database. The\n",22],["T_WHITESPACE","    ",23],["T_COMMENT","\/\/ user-agent is used to ensure that multiple testing sessions running at the\n",23],["T_WHITESPACE","    ",24],["T_COMMENT","\/\/ same time won't interfere with each other as they would if the database\n",24],["T_WHITESPACE","    ",25],["T_COMMENT","\/\/ prefix were stored statically in a file or database variable.\n",25],["T_WHITESPACE","    ",26],["T_RETURN","return",26],["T_WHITESPACE"," ",26],["T_FUNCTION","function",26],["T_WHITESPACE"," ",26],"(",["T_VARIABLE","$handler",26],")",["T_WHITESPACE"," ",26],"{",["T_WHITESPACE","\n      ",26],["T_RETURN","return",27],["T_WHITESPACE"," ",27],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],"(",["T_STRING","RequestInterface",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$request",27],",",["T_WHITESPACE"," ",27],["T_ARRAY","array",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$options",27],")",["T_WHITESPACE"," ",27],["T_USE","use",27],["T_WHITESPACE"," ",27],"(",["T_VARIABLE","$handler",27],")",["T_WHITESPACE"," ",27],"{",["T_WHITESPACE","\n        ",27],["T_IF","if",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$test_prefix",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_STRING","drupal_valid_test_ua",28],"(",")",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n          ",28],["T_VARIABLE","$request",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$request",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","withHeader",29],"(",["T_CONSTANT_ENCAPSED_STRING","'User-Agent'",29],",",["T_WHITESPACE"," ",29],["T_STRING","drupal_generate_test_ua",29],"(",["T_VARIABLE","$test_prefix",29],")",")",";",["T_WHITESPACE","\n        ",29],"}",["T_WHITESPACE","\n        ",30],["T_RETURN","return",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$handler",31],"(",["T_VARIABLE","$request",31],",",["T_WHITESPACE"," ",31],["T_VARIABLE","$options",31],")",["T_WHITESPACE","\n          ",31],["T_OBJECT_OPERATOR","->",32],["T_STRING","then",32],"(",["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],"(",["T_STRING","ResponseInterface",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$response",32],")",["T_WHITESPACE"," ",32],["T_USE","use",32],["T_WHITESPACE"," ",32],"(",["T_VARIABLE","$request",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n            ",32],["T_IF","if",33],["T_WHITESPACE"," ",33],"(","!",["T_STRING","drupal_valid_test_ua",33],"(",")",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n              ",33],["T_RETURN","return",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$response",34],";",["T_WHITESPACE","\n            ",34],"}",["T_WHITESPACE","\n            ",35],["T_VARIABLE","$headers",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$response",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getHeaders",36],"(",")",";",["T_WHITESPACE","\n            ",36],["T_FOREACH","foreach",37],["T_WHITESPACE"," ",37],"(",["T_VARIABLE","$headers",37],["T_WHITESPACE"," ",37],["T_AS","as",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$header_name",37],["T_WHITESPACE"," ",37],["T_DOUBLE_ARROW","=>",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$header_values",37],")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n              ",37],["T_IF","if",38],["T_WHITESPACE"," ",38],"(",["T_STRING","preg_match",38],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^X-Drupal-Assertion-[0-9]+$\/'",38],",",["T_WHITESPACE"," ",38],["T_VARIABLE","$header_name",38],",",["T_WHITESPACE"," ",38],["T_VARIABLE","$matches",38],")",")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n                ",38],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$header_values",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$header_value",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n                  ",39],["T_COMMENT","\/\/ Call \\Drupal\\simpletest\\WebTestBase::error() with the parameters from\n",40],["T_WHITESPACE","                  ",41],["T_COMMENT","\/\/ the header.\n",41],["T_WHITESPACE","                  ",42],["T_VARIABLE","$parameters",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","unserialize",42],"(",["T_STRING","urldecode",42],"(",["T_VARIABLE","$header_value",42],")",")",";",["T_WHITESPACE","\n                  ",42],["T_IF","if",43],["T_WHITESPACE"," ",43],"(",["T_STRING","count",43],"(",["T_VARIABLE","$parameters",43],")",["T_WHITESPACE"," ",43],["T_IS_IDENTICAL","===",43],["T_WHITESPACE"," ",43],["T_LNUMBER","3",43],")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n                    ",43],["T_THROW","throw",44],["T_WHITESPACE"," ",44],["T_NEW","new",44],["T_WHITESPACE"," ",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Exception",44],"(",["T_VARIABLE","$parameters",44],"[",["T_LNUMBER","1",44],"]",["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","': '",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_VARIABLE","$parameters",44],"[",["T_LNUMBER","0",44],"]",["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_STRING","Error",44],["T_DOUBLE_COLON","::",44],["T_STRING","formatBacktrace",44],"(","[",["T_VARIABLE","$parameters",44],"[",["T_LNUMBER","2",44],"]","]",")",")",";",["T_WHITESPACE","\n                  ",44],"}",["T_WHITESPACE","\n                  ",45],["T_ELSE","else",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n                    ",46],["T_THROW","throw",47],["T_WHITESPACE"," ",47],["T_NEW","new",47],["T_WHITESPACE"," ",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Exception",47],"(",["T_CONSTANT_ENCAPSED_STRING","'Error thrown with the wrong amount of parameters.'",47],")",";",["T_WHITESPACE","\n                  ",47],"}",["T_WHITESPACE","\n                ",48],"}",["T_WHITESPACE","\n              ",49],"}",["T_WHITESPACE","\n            ",50],"}",["T_WHITESPACE","\n            ",51],["T_RETURN","return",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$response",52],";",["T_WHITESPACE","\n          ",52],"}",")",";",["T_WHITESPACE","\n      ",53],"}",";",["T_WHITESPACE","\n    ",54],"}",";",["T_WHITESPACE","\n  ",55],"}",["T_WHITESPACE","\n\n",56],"}",["T_WHITESPACE","\n",58]]