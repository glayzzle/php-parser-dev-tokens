[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Batch",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Connection",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SchemaObjectExistsException",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Symfony",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","HttpFoundation",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Session",7],["T_NS_SEPARATOR","\\",7],["T_STRING","SessionInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Access",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CsrfTokenGenerator",8],";",["T_WHITESPACE","\n\n",8],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","BatchStorage",10],["T_WHITESPACE"," ",10],["T_IMPLEMENTS","implements",10],["T_WHITESPACE"," ",10],["T_STRING","BatchStorageInterface",10],["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\n  ",10],["T_DOC_COMMENT","\/**\n   * The table name.\n   *\/",12],["T_WHITESPACE","\n  ",14],["T_CONST","const",15],["T_WHITESPACE"," ",15],["T_STRING","TABLE_NAME",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],["T_CONSTANT_ENCAPSED_STRING","'batch'",15],";",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * The database connection.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$connection",22],";",["T_WHITESPACE","\n\n  ",22],["T_DOC_COMMENT","\/**\n   * The session.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\Session\\SessionInterface\n   *\/",24],["T_WHITESPACE","\n  ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$session",29],";",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * The CSRF token generator.\n   *\n   * @var \\Drupal\\Core\\Access\\CsrfTokenGenerator\n   *\/",31],["T_WHITESPACE","\n  ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$csrfToken",36],";",["T_WHITESPACE","\n\n  ",36],["T_DOC_COMMENT","\/**\n   * Constructs the database batch storage service.\n   *\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection.\n   * @param \\Symfony\\Component\\HttpFoundation\\Session\\SessionInterface $session\n   *   The session.\n   * @param \\Drupal\\Core\\Access\\CsrfTokenGenerator $csrf_token\n   *   The CSRF token generator.\n   *\/",38],["T_WHITESPACE","\n  ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","__construct",48],"(",["T_STRING","Connection",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$connection",48],",",["T_WHITESPACE"," ",48],["T_STRING","SessionInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$session",48],",",["T_WHITESPACE"," ",48],["T_STRING","CsrfTokenGenerator",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$csrf_token",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","connection",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$connection",49],";",["T_WHITESPACE","\n    ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","session",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$session",50],";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","csrfToken",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$csrf_token",51],";",["T_WHITESPACE","\n  ",51],"}",["T_WHITESPACE","\n\n  ",52],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",54],["T_WHITESPACE","\n  ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","load",57],"(",["T_VARIABLE","$id",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n    ",57],["T_COMMENT","\/\/ Ensure that a session is started before using the CSRF token generator.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","session",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","start",59],"(",")",";",["T_WHITESPACE","\n    ",59],["T_TRY","try",60],["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n      ",60],["T_VARIABLE","$batch",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","connection",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","query",61],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT batch FROM {batch} WHERE bid = :bid AND token = :token\"",61],",",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",["T_WHITESPACE","\n        ",61],["T_CONSTANT_ENCAPSED_STRING","':bid'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$id",62],",",["T_WHITESPACE","\n        ",62],["T_CONSTANT_ENCAPSED_STRING","':token'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","csrfToken",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","get",63],"(",["T_VARIABLE","$id",63],")",",",["T_WHITESPACE","\n      ",63],")",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","fetchField",64],"(",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n    ",65],["T_CATCH","catch",66],["T_WHITESPACE"," ",66],"(",["T_NS_SEPARATOR","\\",66],["T_STRING","Exception",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$e",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n      ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","catchException",67],"(",["T_VARIABLE","$e",67],")",";",["T_WHITESPACE","\n      ",67],["T_VARIABLE","$batch",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","FALSE",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n    ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$batch",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n      ",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_STRING","unserialize",71],"(",["T_VARIABLE","$batch",71],")",";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n    ",72],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_STRING","FALSE",73],";",["T_WHITESPACE","\n  ",73],"}",["T_WHITESPACE","\n\n  ",74],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",76],["T_WHITESPACE","\n  ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","delete",79],"(",["T_VARIABLE","$id",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n    ",79],["T_TRY","try",80],["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n      ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","connection",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","delete",81],"(",["T_CONSTANT_ENCAPSED_STRING","'batch'",81],")",["T_WHITESPACE","\n        ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","condition",82],"(",["T_CONSTANT_ENCAPSED_STRING","'bid'",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$id",82],")",["T_WHITESPACE","\n        ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","execute",83],"(",")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n    ",84],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_NS_SEPARATOR","\\",85],["T_STRING","Exception",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n      ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","catchException",86],"(",["T_VARIABLE","$e",86],")",";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n  ",87],"}",["T_WHITESPACE","\n\n  ",88],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",90],["T_WHITESPACE","\n  ",92],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","update",93],"(",["T_ARRAY","array",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$batch",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n    ",93],["T_TRY","try",94],["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n      ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","connection",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","update",95],"(",["T_CONSTANT_ENCAPSED_STRING","'batch'",95],")",["T_WHITESPACE","\n        ",95],["T_OBJECT_OPERATOR","->",96],["T_STRING","fields",96],"(",["T_ARRAY","array",96],"(",["T_CONSTANT_ENCAPSED_STRING","'batch'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_STRING","serialize",96],"(",["T_VARIABLE","$batch",96],")",")",")",["T_WHITESPACE","\n        ",96],["T_OBJECT_OPERATOR","->",97],["T_STRING","condition",97],"(",["T_CONSTANT_ENCAPSED_STRING","'bid'",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$batch",97],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",97],"]",")",["T_WHITESPACE","\n        ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","execute",98],"(",")",";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n    ",99],["T_CATCH","catch",100],["T_WHITESPACE"," ",100],"(",["T_NS_SEPARATOR","\\",100],["T_STRING","Exception",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$e",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n      ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","catchException",101],"(",["T_VARIABLE","$e",101],")",";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n  ",102],"}",["T_WHITESPACE","\n\n  ",103],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",105],["T_WHITESPACE","\n  ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","cleanup",108],"(",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n    ",108],["T_TRY","try",109],["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n      ",109],["T_COMMENT","\/\/ Cleanup the batch table and the queue for failed batches.\n",110],["T_WHITESPACE","      ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","connection",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","delete",111],"(",["T_CONSTANT_ENCAPSED_STRING","'batch'",111],")",["T_WHITESPACE","\n        ",111],["T_OBJECT_OPERATOR","->",112],["T_STRING","condition",112],"(",["T_CONSTANT_ENCAPSED_STRING","'timestamp'",112],",",["T_WHITESPACE"," ",112],["T_STRING","REQUEST_TIME",112],["T_WHITESPACE"," ",112],"-",["T_WHITESPACE"," ",112],["T_LNUMBER","864000",112],",",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'<'",112],")",["T_WHITESPACE","\n        ",112],["T_OBJECT_OPERATOR","->",113],["T_STRING","execute",113],"(",")",";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n    ",114],["T_CATCH","catch",115],["T_WHITESPACE"," ",115],"(",["T_NS_SEPARATOR","\\",115],["T_STRING","Exception",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$e",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n      ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","catchException",116],"(",["T_VARIABLE","$e",116],")",";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n  ",117],"}",["T_WHITESPACE","\n\n  ",118],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",120],["T_WHITESPACE","\n  ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","create",123],"(",["T_ARRAY","array",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$batch",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n    ",123],["T_COMMENT","\/\/ Ensure that a session is started before using the CSRF token generator.\n",124],["T_WHITESPACE","    ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","session",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","start",125],"(",")",";",["T_WHITESPACE","\n    ",125],["T_VARIABLE","$try_again",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","FALSE",126],";",["T_WHITESPACE","\n    ",126],["T_TRY","try",127],["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n      ",127],["T_COMMENT","\/\/ The batch table might not yet exist.\n",128],["T_WHITESPACE","      ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","doCreate",129],"(",["T_VARIABLE","$batch",129],")",";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n    ",130],["T_CATCH","catch",131],["T_WHITESPACE"," ",131],"(",["T_NS_SEPARATOR","\\",131],["T_STRING","Exception",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$e",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n      ",131],["T_COMMENT","\/\/ If there was an exception, try to create the table.\n",132],["T_WHITESPACE","      ",133],["T_IF","if",133],["T_WHITESPACE"," ",133],"(","!",["T_VARIABLE","$try_again",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","ensureTableExists",133],"(",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n        ",133],["T_COMMENT","\/\/ If the exception happened for other reason than the missing table,\n",134],["T_WHITESPACE","        ",135],["T_COMMENT","\/\/ propagate the exception.\n",135],["T_WHITESPACE","        ",136],["T_THROW","throw",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$e",136],";",["T_WHITESPACE","\n      ",136],"}",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n    ",138],["T_COMMENT","\/\/ Now that the table has been created, try again if necessary.\n",139],["T_WHITESPACE","    ",140],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$try_again",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n      ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","doCreate",141],"(",["T_VARIABLE","$batch",141],")",";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n  ",142],"}",["T_WHITESPACE","\n\n  ",143],["T_DOC_COMMENT","\/**\n   * Saves a batch.\n   *\n   * @param array $batch\n   *   The array representing the batch to create.\n   *\/",145],["T_WHITESPACE","\n  ",150],["T_PROTECTED","protected",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","doCreate",151],"(",["T_ARRAY","array",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$batch",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n    ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","connection",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","insert",152],"(",["T_CONSTANT_ENCAPSED_STRING","'batch'",152],")",["T_WHITESPACE","\n      ",152],["T_OBJECT_OPERATOR","->",153],["T_STRING","fields",153],"(",["T_ARRAY","array",153],"(",["T_WHITESPACE","\n        ",153],["T_CONSTANT_ENCAPSED_STRING","'bid'",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$batch",154],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",154],"]",",",["T_WHITESPACE","\n        ",154],["T_CONSTANT_ENCAPSED_STRING","'timestamp'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_STRING","REQUEST_TIME",155],",",["T_WHITESPACE","\n        ",155],["T_CONSTANT_ENCAPSED_STRING","'token'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","csrfToken",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","get",156],"(",["T_VARIABLE","$batch",156],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",156],"]",")",",",["T_WHITESPACE","\n        ",156],["T_CONSTANT_ENCAPSED_STRING","'batch'",157],["T_WHITESPACE"," ",157],["T_DOUBLE_ARROW","=>",157],["T_WHITESPACE"," ",157],["T_STRING","serialize",157],"(",["T_VARIABLE","$batch",157],")",",",["T_WHITESPACE","\n      ",157],")",")",["T_WHITESPACE","\n      ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","execute",159],"(",")",";",["T_WHITESPACE","\n  ",159],"}",["T_WHITESPACE","\n\n  ",160],["T_DOC_COMMENT","\/**\n   * Check if the table exists and create it if not.\n   *\/",162],["T_WHITESPACE","\n  ",164],["T_PROTECTED","protected",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","ensureTableExists",165],"(",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n    ",165],["T_TRY","try",166],["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n      ",166],["T_VARIABLE","$database_schema",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","connection",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","schema",167],"(",")",";",["T_WHITESPACE","\n      ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(","!",["T_VARIABLE","$database_schema",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","tableExists",168],"(",["T_STATIC","static",168],["T_DOUBLE_COLON","::",168],["T_STRING","TABLE_NAME",168],")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$schema_definition",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","schemaDefinition",169],"(",")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$database_schema",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","createTable",170],"(",["T_STATIC","static",170],["T_DOUBLE_COLON","::",170],["T_STRING","TABLE_NAME",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$schema_definition",170],")",";",["T_WHITESPACE","\n        ",170],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_STRING","TRUE",171],";",["T_WHITESPACE","\n      ",171],"}",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n    ",173],["T_COMMENT","\/\/ If another process has already created the batch table, attempting to\n",174],["T_WHITESPACE","    ",175],["T_COMMENT","\/\/ recreate it will throw an exception. In this case just catch the\n",175],["T_WHITESPACE","    ",176],["T_COMMENT","\/\/ exception and do nothing.\n",176],["T_WHITESPACE","    ",177],["T_CATCH","catch",177],["T_WHITESPACE"," ",177],"(",["T_STRING","SchemaObjectExistsException",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$e",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n      ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_STRING","TRUE",178],";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n    ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_STRING","FALSE",180],";",["T_WHITESPACE","\n  ",180],"}",["T_WHITESPACE","\n\n  ",181],["T_DOC_COMMENT","\/**\n   * Act on an exception when batch might be stale.\n   *\n   * If the table does not yet exist, that's fine, but if the table exists and\n   * yet the query failed, then the batch is stale and the exception needs to\n   * propagate.\n   *\n   * @param $e\n   *   The exception.\n   *\n   * @throws \\Exception\n   *\/",183],["T_WHITESPACE","\n  ",194],["T_PROTECTED","protected",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","catchException",195],"(",["T_NS_SEPARATOR","\\",195],["T_STRING","Exception",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$e",195],")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n    ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","connection",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","schema",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","tableExists",196],"(",["T_STATIC","static",196],["T_DOUBLE_COLON","::",196],["T_STRING","TABLE_NAME",196],")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n      ",196],["T_THROW","throw",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$e",197],";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n  ",198],"}",["T_WHITESPACE","\n\n  ",199],["T_DOC_COMMENT","\/**\n   * Defines the schema for the batch table.\n   *\/",201],["T_WHITESPACE","\n  ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","schemaDefinition",204],"(",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n    ",204],["T_RETURN","return",205],["T_WHITESPACE"," ",205],"[",["T_WHITESPACE","\n      ",205],["T_CONSTANT_ENCAPSED_STRING","'description'",206],["T_WHITESPACE"," ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'Stores details about batches (processes that run in multiple HTTP requests).'",206],",",["T_WHITESPACE","\n      ",206],["T_CONSTANT_ENCAPSED_STRING","'fields'",207],["T_WHITESPACE"," ",207],["T_DOUBLE_ARROW","=>",207],["T_WHITESPACE"," ",207],"[",["T_WHITESPACE","\n        ",207],["T_CONSTANT_ENCAPSED_STRING","'bid'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],"[",["T_WHITESPACE","\n          ",208],["T_CONSTANT_ENCAPSED_STRING","'description'",209],["T_WHITESPACE"," ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'Primary Key: Unique batch ID.'",209],",",["T_WHITESPACE","\n          ",209],["T_COMMENT","\/\/ This is not a serial column, to allow both progressive and\n",210],["T_WHITESPACE","          ",211],["T_COMMENT","\/\/ non-progressive batches. See batch_process().\n",211],["T_WHITESPACE","          ",212],["T_CONSTANT_ENCAPSED_STRING","'type'",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_CONSTANT_ENCAPSED_STRING","'int'",212],",",["T_WHITESPACE","\n          ",212],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_STRING","TRUE",213],",",["T_WHITESPACE","\n          ",213],["T_CONSTANT_ENCAPSED_STRING","'not null'",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_STRING","TRUE",214],",",["T_WHITESPACE","\n        ",214],"]",",",["T_WHITESPACE","\n        ",215],["T_CONSTANT_ENCAPSED_STRING","'token'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],"[",["T_WHITESPACE","\n          ",216],["T_CONSTANT_ENCAPSED_STRING","'description'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","\"A string token generated against the current user's session id and the batch id, used to ensure that only the user who submitted the batch can effectively access it.\"",217],",",["T_WHITESPACE","\n          ",217],["T_CONSTANT_ENCAPSED_STRING","'type'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'varchar_ascii'",218],",",["T_WHITESPACE","\n          ",218],["T_CONSTANT_ENCAPSED_STRING","'length'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_LNUMBER","64",219],",",["T_WHITESPACE","\n          ",219],["T_CONSTANT_ENCAPSED_STRING","'not null'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_STRING","TRUE",220],",",["T_WHITESPACE","\n        ",220],"]",",",["T_WHITESPACE","\n        ",221],["T_CONSTANT_ENCAPSED_STRING","'timestamp'",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],"[",["T_WHITESPACE","\n          ",222],["T_CONSTANT_ENCAPSED_STRING","'description'",223],["T_WHITESPACE"," ",223],["T_DOUBLE_ARROW","=>",223],["T_WHITESPACE"," ",223],["T_CONSTANT_ENCAPSED_STRING","'A Unix timestamp indicating when this batch was submitted for processing. Stale batches are purged at cron time.'",223],",",["T_WHITESPACE","\n          ",223],["T_CONSTANT_ENCAPSED_STRING","'type'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'int'",224],",",["T_WHITESPACE","\n          ",224],["T_CONSTANT_ENCAPSED_STRING","'not null'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_STRING","TRUE",225],",",["T_WHITESPACE","\n        ",225],"]",",",["T_WHITESPACE","\n        ",226],["T_CONSTANT_ENCAPSED_STRING","'batch'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],"[",["T_WHITESPACE","\n          ",227],["T_CONSTANT_ENCAPSED_STRING","'description'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'A serialized array containing the processing data for the batch.'",228],",",["T_WHITESPACE","\n          ",228],["T_CONSTANT_ENCAPSED_STRING","'type'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_CONSTANT_ENCAPSED_STRING","'blob'",229],",",["T_WHITESPACE","\n          ",229],["T_CONSTANT_ENCAPSED_STRING","'not null'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_STRING","FALSE",230],",",["T_WHITESPACE","\n          ",230],["T_CONSTANT_ENCAPSED_STRING","'size'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_CONSTANT_ENCAPSED_STRING","'big'",231],",",["T_WHITESPACE","\n        ",231],"]",",",["T_WHITESPACE","\n      ",232],"]",",",["T_WHITESPACE","\n      ",233],["T_CONSTANT_ENCAPSED_STRING","'primary key'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],"[",["T_CONSTANT_ENCAPSED_STRING","'bid'",234],"]",",",["T_WHITESPACE","\n      ",234],["T_CONSTANT_ENCAPSED_STRING","'indexes'",235],["T_WHITESPACE"," ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],"[",["T_WHITESPACE","\n        ",235],["T_CONSTANT_ENCAPSED_STRING","'token'",236],["T_WHITESPACE"," ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",236],"]",",",["T_WHITESPACE","\n      ",236],"]",",",["T_WHITESPACE","\n    ",237],"]",";",["T_WHITESPACE","\n  ",238],"}",["T_WHITESPACE","\n\n",239],"}",["T_WHITESPACE","\n",241]]