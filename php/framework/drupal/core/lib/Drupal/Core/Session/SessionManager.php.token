[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Crypt",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Connection",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DependencyInjection",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DependencySerializationTrait",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Symfony",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Component",8],["T_NS_SEPARATOR","\\",8],["T_STRING","HttpFoundation",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RequestStack",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Symfony",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Component",9],["T_NS_SEPARATOR","\\",9],["T_STRING","HttpFoundation",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Session",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Storage",9],["T_NS_SEPARATOR","\\",9],["T_STRING","NativeSessionStorage",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Manages user sessions.\n *\n * This class implements the custom session management code inherited from\n * Drupal 7 on top of the corresponding Symfony component. Regrettably the name\n * NativeSessionStorage is not quite accurate. In fact the responsibility for\n * storing and retrieving session data has been extracted from it in Symfony 2.1\n * but the class name was not changed.\n *\n * @todo\n *   In fact the NativeSessionStorage class already implements all of the\n *   functionality required by a typical Symfony application. Normally it is not\n *   necessary to subclass it at all. In order to reach the point where Drupal\n *   can use the Symfony session management unmodified, the code implemented\n *   here needs to be extracted either into a dedicated session handler proxy\n *   (e.g. sid-hashing) or relocated to the authentication subsystem.\n *\/",11],["T_WHITESPACE","\n",27],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","SessionManager",28],["T_WHITESPACE"," ",28],["T_EXTENDS","extends",28],["T_WHITESPACE"," ",28],["T_STRING","NativeSessionStorage",28],["T_WHITESPACE"," ",28],["T_IMPLEMENTS","implements",28],["T_WHITESPACE"," ",28],["T_STRING","SessionManagerInterface",28],["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n\n  ",28],["T_USE","use",30],["T_WHITESPACE"," ",30],["T_STRING","DependencySerializationTrait",30],";",["T_WHITESPACE","\n\n  ",30],["T_DOC_COMMENT","\/**\n   * The request stack.\n   *\n   * @var \\Symfony\\Component\\HttpFoundation\\RequestStack\n   *\/",32],["T_WHITESPACE","\n  ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$requestStack",37],";",["T_WHITESPACE","\n\n  ",37],["T_DOC_COMMENT","\/**\n   * The database connection to use.\n   *\n   * @var \\Drupal\\Core\\Database\\Connection\n   *\/",39],["T_WHITESPACE","\n  ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$connection",44],";",["T_WHITESPACE","\n\n  ",44],["T_DOC_COMMENT","\/**\n   * The session configuration.\n   *\n   * @var \\Drupal\\Core\\Session\\SessionConfigurationInterface\n   *\/",46],["T_WHITESPACE","\n  ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$sessionConfiguration",51],";",["T_WHITESPACE","\n\n  ",51],["T_DOC_COMMENT","\/**\n   * Whether a lazy session has been started.\n   *\n   * @var bool\n   *\/",53],["T_WHITESPACE","\n  ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$startedLazy",58],";",["T_WHITESPACE","\n\n  ",58],["T_DOC_COMMENT","\/**\n   * The write safe session handler.\n   *\n   * @todo: This reference should be removed once all database queries\n   *   are removed from the session manager class.\n   *\n   * @var \\Drupal\\Core\\Session\\WriteSafeSessionHandlerInterface\n   *\/",60],["T_WHITESPACE","\n  ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$writeSafeHandler",68],";",["T_WHITESPACE","\n\n  ",68],["T_DOC_COMMENT","\/**\n   * Constructs a new session manager instance.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\RequestStack $request_stack\n   *   The request stack.\n   * @param \\Drupal\\Core\\Database\\Connection $connection\n   *   The database connection.\n   * @param \\Drupal\\Core\\Session\\MetadataBag $metadata_bag\n   *   The session metadata bag.\n   * @param \\Drupal\\Core\\Session\\SessionConfigurationInterface $session_configuration\n   *   The session configuration interface.\n   * @param \\Symfony\\Component\\HttpFoundation\\Session\\Storage\\Proxy\\AbstractProxy|Symfony\\Component\\HttpFoundation\\Session\\Storage\\Handler\\NativeSessionHandler|\\SessionHandlerInterface|null $handler\n   *   The object to register as a PHP session handler.\n   *   @see \\Symfony\\Component\\HttpFoundation\\Session\\Storage\\NativeSessionStorage::setSaveHandler()\n   *\/",70],["T_WHITESPACE","\n  ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","__construct",85],"(",["T_STRING","RequestStack",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$request_stack",85],",",["T_WHITESPACE"," ",85],["T_STRING","Connection",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$connection",85],",",["T_WHITESPACE"," ",85],["T_STRING","MetadataBag",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$metadata_bag",85],",",["T_WHITESPACE"," ",85],["T_STRING","SessionConfigurationInterface",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$session_configuration",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$handler",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","NULL",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$options",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_ARRAY","array",86],"(",")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","sessionConfiguration",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$session_configuration",87],";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","requestStack",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$request_stack",88],";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","connection",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$connection",89],";",["T_WHITESPACE","\n\n    ",89],["T_STRING","parent",91],["T_DOUBLE_COLON","::",91],["T_STRING","__construct",91],"(",["T_VARIABLE","$options",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$handler",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$metadata_bag",91],")",";",["T_WHITESPACE","\n\n    ",91],["T_COMMENT","\/\/ @todo When not using the Symfony Session object, the list of bags in the\n",93],["T_WHITESPACE","    ",94],["T_COMMENT","\/\/   NativeSessionStorage will remain uninitialized. This will lead to\n",94],["T_WHITESPACE","    ",95],["T_COMMENT","\/\/   errors in NativeSessionHandler::loadSession. Remove this after\n",95],["T_WHITESPACE","    ",96],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2229145, when we will be using the Symfony\n",96],["T_WHITESPACE","    ",97],["T_COMMENT","\/\/   session object (which registers an attribute bag with the\n",97],["T_WHITESPACE","    ",98],["T_COMMENT","\/\/   manager upon instantiation).\n",98],["T_WHITESPACE","    ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","bags",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",")",";",["T_WHITESPACE","\n  ",99],"}",["T_WHITESPACE","\n\n  ",100],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",102],["T_WHITESPACE","\n  ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","start",105],"(",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n    ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","(",["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","started",106],["T_WHITESPACE"," ",106],["T_BOOLEAN_OR","||",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","startedLazy",106],")",["T_WHITESPACE"," ",106],["T_BOOLEAN_AND","&&",106],["T_WHITESPACE"," ",106],"!",["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","closed",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n      ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","started",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_VARIABLE","$request",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","requestStack",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getCurrentRequest",110],"(",")",";",["T_WHITESPACE","\n    ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setOptions",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","sessionConfiguration",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getOptions",111],"(",["T_VARIABLE","$request",111],")",")",";",["T_WHITESPACE","\n\n    ",111],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","sessionConfiguration",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","hasSession",113],"(",["T_VARIABLE","$request",113],")",")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n      ",113],["T_COMMENT","\/\/ If a session cookie exists, initialize the session. Otherwise the\n",114],["T_WHITESPACE","      ",115],["T_COMMENT","\/\/ session is only started on demand in save(), making\n",115],["T_WHITESPACE","      ",116],["T_COMMENT","\/\/ anonymous users not use a session cookie unless something is stored in\n",116],["T_WHITESPACE","      ",117],["T_COMMENT","\/\/ $_SESSION. This allows HTTP proxies to cache anonymous pageviews.\n",117],["T_WHITESPACE","      ",118],["T_VARIABLE","$result",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","startNow",118],"(",")",";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_EMPTY","empty",121],"(",["T_VARIABLE","$result",121],")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n      ",121],["T_COMMENT","\/\/ Randomly generate a session identifier for this request. This is\n",122],["T_WHITESPACE","      ",123],["T_COMMENT","\/\/ necessary because \\Drupal\\user\\SharedTempStoreFactory::get() wants to\n",123],["T_WHITESPACE","      ",124],["T_COMMENT","\/\/ know the future session ID of a lazily started session in advance.\n",124],["T_WHITESPACE","      ",125],["T_COMMENT","\/\/\n",125],["T_WHITESPACE","      ",126],["T_COMMENT","\/\/ @todo: With current versions of PHP there is little reason to generate\n",126],["T_WHITESPACE","      ",127],["T_COMMENT","\/\/   the session id from within application code. Consider using the\n",127],["T_WHITESPACE","      ",128],["T_COMMENT","\/\/   default php session id instead of generating a custom one:\n",128],["T_WHITESPACE","      ",129],["T_COMMENT","\/\/   https:\/\/www.drupal.org\/node\/2238561\n",129],["T_WHITESPACE","      ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setId",130],"(",["T_STRING","Crypt",130],["T_DOUBLE_COLON","::",130],["T_STRING","randomBytesBase64",130],"(",")",")",";",["T_WHITESPACE","\n\n      ",130],["T_COMMENT","\/\/ Initialize the session global and attach the Symfony session bags.\n",132],["T_WHITESPACE","      ",133],["T_VARIABLE","$_SESSION",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",")",";",["T_WHITESPACE","\n      ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","loadSession",134],"(",")",";",["T_WHITESPACE","\n\n      ",134],["T_COMMENT","\/\/ NativeSessionStorage::loadSession() sets started to TRUE, reset it to\n",136],["T_WHITESPACE","      ",137],["T_COMMENT","\/\/ FALSE here.\n",137],["T_WHITESPACE","      ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","started",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_STRING","FALSE",138],";",["T_WHITESPACE","\n      ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","startedLazy",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","TRUE",139],";",["T_WHITESPACE","\n\n      ",139],["T_VARIABLE","$result",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","FALSE",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$result",144],";",["T_WHITESPACE","\n  ",144],"}",["T_WHITESPACE","\n\n  ",145],["T_DOC_COMMENT","\/**\n   * Forcibly start a PHP session.\n   *\n   * @return bool\n   *   TRUE if the session is started.\n   *\/",147],["T_WHITESPACE","\n  ",152],["T_PROTECTED","protected",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","startNow",153],"(",")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n    ",153],["T_IF","if",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","isCli",154],"(",")",")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n      ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_STRING","FALSE",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","startedLazy",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n      ",158],["T_COMMENT","\/\/ Save current session data before starting it, as PHP will destroy it.\n",159],["T_WHITESPACE","      ",160],["T_VARIABLE","$session_data",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$_SESSION",160],";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_VARIABLE","$result",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_STRING","parent",163],["T_DOUBLE_COLON","::",163],["T_STRING","start",163],"(",")",";",["T_WHITESPACE","\n\n    ",163],["T_COMMENT","\/\/ Restore session data.\n",165],["T_WHITESPACE","    ",166],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","startedLazy",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n      ",166],["T_VARIABLE","$_SESSION",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$session_data",167],";",["T_WHITESPACE","\n      ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","loadSession",168],"(",")",";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$result",171],";",["T_WHITESPACE","\n  ",171],"}",["T_WHITESPACE","\n\n  ",172],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",174],["T_WHITESPACE","\n  ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","save",177],"(",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n    ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","isCli",178],"(",")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n      ",178],["T_COMMENT","\/\/ We don't have anything to do if we are not allowed to save the session.\n",179],["T_WHITESPACE","      ",180],["T_RETURN","return",180],";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","isSessionObsolete",183],"(",")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n      ",183],["T_COMMENT","\/\/ There is no session data to store, destroy the session if it was\n",184],["T_WHITESPACE","      ",185],["T_COMMENT","\/\/ previously started.\n",185],["T_WHITESPACE","      ",186],["T_IF","if",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getSaveHandler",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","isActive",186],"(",")",")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","destroy",187],"(",")",";",["T_WHITESPACE","\n      ",187],"}",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n    ",189],["T_ELSE","else",190],["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n      ",190],["T_COMMENT","\/\/ There is session data to store. Start the session if it is not already\n",191],["T_WHITESPACE","      ",192],["T_COMMENT","\/\/ started.\n",192],["T_WHITESPACE","      ",193],["T_IF","if",193],["T_WHITESPACE"," ",193],"(","!",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getSaveHandler",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","isActive",193],"(",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","startNow",194],"(",")",";",["T_WHITESPACE","\n      ",194],"}",["T_WHITESPACE","\n      ",195],["T_COMMENT","\/\/ Write the session data.\n",196],["T_WHITESPACE","      ",197],["T_STRING","parent",197],["T_DOUBLE_COLON","::",197],["T_STRING","save",197],"(",")",";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","startedLazy",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","FALSE",200],";",["T_WHITESPACE","\n  ",200],"}",["T_WHITESPACE","\n\n  ",201],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",203],["T_WHITESPACE","\n  ",205],["T_PUBLIC","public",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","regenerate",206],"(",["T_VARIABLE","$destroy",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","FALSE",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$lifetime",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","NULL",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n    ",206],["T_COMMENT","\/\/ Nothing to do if we are not allowed to change the session.\n",207],["T_WHITESPACE","    ",208],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","isCli",208],"(",")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n      ",208],["T_RETURN","return",209],";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_COMMENT","\/\/ We do not support the optional $destroy and $lifetime parameters as long\n",212],["T_WHITESPACE","    ",213],["T_COMMENT","\/\/ as #2238561 remains open.\n",213],["T_WHITESPACE","    ",214],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$destroy",214],["T_WHITESPACE"," ",214],["T_BOOLEAN_OR","||",214],["T_WHITESPACE"," ",214],["T_ISSET","isset",214],"(",["T_VARIABLE","$lifetime",214],")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n      ",214],["T_THROW","throw",215],["T_WHITESPACE"," ",215],["T_NEW","new",215],["T_WHITESPACE"," ",215],["T_NS_SEPARATOR","\\",215],["T_STRING","InvalidArgumentException",215],"(",["T_CONSTANT_ENCAPSED_STRING","'The optional parameters $destroy and $lifetime of SessionManager::regenerate() are not supported currently'",215],")",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","isStarted",218],"(",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n      ",218],["T_VARIABLE","$old_session_id",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getId",219],"(",")",";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n    ",220],["T_STRING","session_id",221],"(",["T_STRING","Crypt",221],["T_DOUBLE_COLON","::",221],["T_STRING","randomBytesBase64",221],"(",")",")",";",["T_WHITESPACE","\n\n    ",221],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getMetadataBag",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","clearCsrfTokenSeed",223],"(",")",";",["T_WHITESPACE","\n\n    ",223],["T_IF","if",225],["T_WHITESPACE"," ",225],"(",["T_ISSET","isset",225],"(",["T_VARIABLE","$old_session_id",225],")",")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n      ",225],["T_VARIABLE","$params",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","session_get_cookie_params",226],"(",")",";",["T_WHITESPACE","\n      ",226],["T_VARIABLE","$expire",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$params",227],"[",["T_CONSTANT_ENCAPSED_STRING","'lifetime'",227],"]",["T_WHITESPACE"," ",227],"?",["T_WHITESPACE"," ",227],["T_STRING","REQUEST_TIME",227],["T_WHITESPACE"," ",227],"+",["T_WHITESPACE"," ",227],["T_VARIABLE","$params",227],"[",["T_CONSTANT_ENCAPSED_STRING","'lifetime'",227],"]",["T_WHITESPACE"," ",227],":",["T_WHITESPACE"," ",227],["T_LNUMBER","0",227],";",["T_WHITESPACE","\n      ",227],["T_STRING","setcookie",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getName",228],"(",")",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getId",228],"(",")",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$expire",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$params",228],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",228],"]",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$params",228],"[",["T_CONSTANT_ENCAPSED_STRING","'domain'",228],"]",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$params",228],"[",["T_CONSTANT_ENCAPSED_STRING","'secure'",228],"]",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$params",228],"[",["T_CONSTANT_ENCAPSED_STRING","'httponly'",228],"]",")",";",["T_WHITESPACE","\n      ",228],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","migrateStoredSession",229],"(",["T_VARIABLE","$old_session_id",229],")",";",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_IF","if",232],["T_WHITESPACE"," ",232],"(","!",["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","isStarted",232],"(",")",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n      ",232],["T_COMMENT","\/\/ Start the session when it doesn't exist yet.\n",233],["T_WHITESPACE","      ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","startNow",234],"(",")",";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n  ",235],"}",["T_WHITESPACE","\n\n  ",236],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",238],["T_WHITESPACE","\n  ",240],["T_PUBLIC","public",241],["T_WHITESPACE"," ",241],["T_FUNCTION","function",241],["T_WHITESPACE"," ",241],["T_STRING","delete",241],"(",["T_VARIABLE","$uid",241],")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n    ",241],["T_COMMENT","\/\/ Nothing to do if we are not allowed to change the session.\n",242],["T_WHITESPACE","    ",243],["T_IF","if",243],["T_WHITESPACE"," ",243],"(","!",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","writeSafeHandler",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","isSessionWritable",243],"(",")",["T_WHITESPACE"," ",243],["T_BOOLEAN_OR","||",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","isCli",243],"(",")",")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n      ",243],["T_RETURN","return",244],";",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n    ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","connection",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","delete",246],"(",["T_CONSTANT_ENCAPSED_STRING","'sessions'",246],")",["T_WHITESPACE","\n      ",246],["T_OBJECT_OPERATOR","->",247],["T_STRING","condition",247],"(",["T_CONSTANT_ENCAPSED_STRING","'uid'",247],",",["T_WHITESPACE"," ",247],["T_VARIABLE","$uid",247],")",["T_WHITESPACE","\n      ",247],["T_OBJECT_OPERATOR","->",248],["T_STRING","execute",248],"(",")",";",["T_WHITESPACE","\n  ",248],"}",["T_WHITESPACE","\n\n  ",249],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",251],["T_WHITESPACE","\n  ",253],["T_PUBLIC","public",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","destroy",254],"(",")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n    ",254],["T_STRING","session_destroy",255],"(",")",";",["T_WHITESPACE","\n\n    ",255],["T_COMMENT","\/\/ Unset the session cookies.\n",257],["T_WHITESPACE","    ",258],["T_VARIABLE","$session_name",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getName",258],"(",")",";",["T_WHITESPACE","\n    ",258],["T_VARIABLE","$cookies",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","requestStack",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getCurrentRequest",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","cookies",259],";",["T_WHITESPACE","\n    ",259],["T_COMMENT","\/\/ setcookie() can only be called when headers are not yet sent.\n",260],["T_WHITESPACE","    ",261],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_VARIABLE","$cookies",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","has",261],"(",["T_VARIABLE","$session_name",261],")",["T_WHITESPACE"," ",261],["T_BOOLEAN_AND","&&",261],["T_WHITESPACE"," ",261],"!",["T_STRING","headers_sent",261],"(",")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n      ",261],["T_VARIABLE","$params",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","session_get_cookie_params",262],"(",")",";",["T_WHITESPACE","\n      ",262],["T_STRING","setcookie",263],"(",["T_VARIABLE","$session_name",263],",",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","''",263],",",["T_WHITESPACE"," ",263],["T_STRING","REQUEST_TIME",263],["T_WHITESPACE"," ",263],"-",["T_WHITESPACE"," ",263],["T_LNUMBER","3600",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$params",263],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",263],"]",",",["T_WHITESPACE"," ",263],["T_VARIABLE","$params",263],"[",["T_CONSTANT_ENCAPSED_STRING","'domain'",263],"]",",",["T_WHITESPACE"," ",263],["T_VARIABLE","$params",263],"[",["T_CONSTANT_ENCAPSED_STRING","'secure'",263],"]",",",["T_WHITESPACE"," ",263],["T_VARIABLE","$params",263],"[",["T_CONSTANT_ENCAPSED_STRING","'httponly'",263],"]",")",";",["T_WHITESPACE","\n      ",263],["T_VARIABLE","$cookies",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","remove",264],"(",["T_VARIABLE","$session_name",264],")",";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n  ",265],"}",["T_WHITESPACE","\n\n  ",266],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",268],["T_WHITESPACE","\n  ",270],["T_PUBLIC","public",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","setWriteSafeHandler",271],"(",["T_STRING","WriteSafeSessionHandlerInterface",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$handler",271],")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n    ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","writeSafeHandler",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$handler",272],";",["T_WHITESPACE","\n  ",272],"}",["T_WHITESPACE","\n\n  ",273],["T_DOC_COMMENT","\/**\n   * Returns whether the current PHP process runs on CLI.\n   *\n   * Command line clients do not support cookies nor sessions.\n   *\n   * @return bool\n   *\/",275],["T_WHITESPACE","\n  ",281],["T_PROTECTED","protected",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","isCli",282],"(",")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n    ",282],["T_RETURN","return",283],["T_WHITESPACE"," ",283],["T_STRING","PHP_SAPI",283],["T_WHITESPACE"," ",283],["T_IS_IDENTICAL","===",283],["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'cli'",283],";",["T_WHITESPACE","\n  ",283],"}",["T_WHITESPACE","\n\n  ",284],["T_DOC_COMMENT","\/**\n   * Determines whether the session contains user data.\n   *\n   * @return bool\n   *   TRUE when the session does not contain any values and therefore can be\n   *   destroyed.\n   *\/",286],["T_WHITESPACE","\n  ",292],["T_PROTECTED","protected",293],["T_WHITESPACE"," ",293],["T_FUNCTION","function",293],["T_WHITESPACE"," ",293],["T_STRING","isSessionObsolete",293],"(",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n    ",293],["T_VARIABLE","$used_session_keys",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_STRING","array_filter",294],"(",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getSessionDataMask",294],"(",")",")",";",["T_WHITESPACE","\n    ",294],["T_RETURN","return",295],["T_WHITESPACE"," ",295],["T_EMPTY","empty",295],"(",["T_VARIABLE","$used_session_keys",295],")",";",["T_WHITESPACE","\n  ",295],"}",["T_WHITESPACE","\n\n  ",296],["T_DOC_COMMENT","\/**\n   * Returns a map specifying which session key is containing user data.\n   *\n   * @return array\n   *   An array where keys correspond to the session keys and the values are\n   *   booleans specifying whether the corresponding session key contains any\n   *   user data.\n   *\/",298],["T_WHITESPACE","\n  ",305],["T_PROTECTED","protected",306],["T_WHITESPACE"," ",306],["T_FUNCTION","function",306],["T_WHITESPACE"," ",306],["T_STRING","getSessionDataMask",306],"(",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n    ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_EMPTY","empty",307],"(",["T_VARIABLE","$_SESSION",307],")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n      ",307],["T_RETURN","return",308],["T_WHITESPACE"," ",308],["T_ARRAY","array",308],"(",")",";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n\n    ",309],["T_COMMENT","\/\/ Start out with a completely filled mask.\n",311],["T_WHITESPACE","    ",312],["T_VARIABLE","$mask",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_STRING","array_fill_keys",312],"(",["T_STRING","array_keys",312],"(",["T_VARIABLE","$_SESSION",312],")",",",["T_WHITESPACE"," ",312],["T_STRING","TRUE",312],")",";",["T_WHITESPACE","\n\n    ",312],["T_COMMENT","\/\/ Ignore the metadata bag, it does not contain any user data.\n",314],["T_WHITESPACE","    ",315],["T_VARIABLE","$mask",315],"[",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","metadataBag",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getStorageKey",315],"(",")","]",["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","FALSE",315],";",["T_WHITESPACE","\n\n    ",315],["T_COMMENT","\/\/ Ignore attribute bags when they do not contain any data.\n",317],["T_WHITESPACE","    ",318],["T_FOREACH","foreach",318],["T_WHITESPACE"," ",318],"(",["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","bags",318],["T_WHITESPACE"," ",318],["T_AS","as",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$bag",318],")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n      ",318],["T_VARIABLE","$key",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$bag",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getStorageKey",319],"(",")",";",["T_WHITESPACE","\n      ",319],["T_VARIABLE","$mask",320],"[",["T_VARIABLE","$key",320],"]",["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],"!",["T_EMPTY","empty",320],"(",["T_VARIABLE","$_SESSION",320],"[",["T_VARIABLE","$key",320],"]",")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_RETURN","return",323],["T_WHITESPACE"," ",323],["T_STRING","array_intersect_key",323],"(",["T_VARIABLE","$mask",323],",",["T_WHITESPACE"," ",323],["T_VARIABLE","$_SESSION",323],")",";",["T_WHITESPACE","\n  ",323],"}",["T_WHITESPACE","\n\n  ",324],["T_DOC_COMMENT","\/**\n   * Migrates the current session to a new session id.\n   *\n   * @param string $old_session_id\n   *   The old session ID. The new session ID is $this->getId().\n   *\/",326],["T_WHITESPACE","\n  ",331],["T_PROTECTED","protected",332],["T_WHITESPACE"," ",332],["T_FUNCTION","function",332],["T_WHITESPACE"," ",332],["T_STRING","migrateStoredSession",332],"(",["T_VARIABLE","$old_session_id",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n    ",332],["T_VARIABLE","$fields",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_ARRAY","array",333],"(",["T_CONSTANT_ENCAPSED_STRING","'sid'",333],["T_WHITESPACE"," ",333],["T_DOUBLE_ARROW","=>",333],["T_WHITESPACE"," ",333],["T_STRING","Crypt",333],["T_DOUBLE_COLON","::",333],["T_STRING","hashBase64",333],"(",["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getId",333],"(",")",")",")",";",["T_WHITESPACE","\n    ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","connection",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","update",334],"(",["T_CONSTANT_ENCAPSED_STRING","'sessions'",334],")",["T_WHITESPACE","\n      ",334],["T_OBJECT_OPERATOR","->",335],["T_STRING","fields",335],"(",["T_VARIABLE","$fields",335],")",["T_WHITESPACE","\n      ",335],["T_OBJECT_OPERATOR","->",336],["T_STRING","condition",336],"(",["T_CONSTANT_ENCAPSED_STRING","'sid'",336],",",["T_WHITESPACE"," ",336],["T_STRING","Crypt",336],["T_DOUBLE_COLON","::",336],["T_STRING","hashBase64",336],"(",["T_VARIABLE","$old_session_id",336],")",")",["T_WHITESPACE","\n      ",336],["T_OBJECT_OPERATOR","->",337],["T_STRING","execute",337],"(",")",";",["T_WHITESPACE","\n  ",337],"}",["T_WHITESPACE","\n\n",338],"}",["T_WHITESPACE","\n",340]]