[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","PrivateKey",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Cache",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Cache",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Cache",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CacheBackendInterface",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Site",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Settings",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Generates and caches the permissions hash for a user.\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","PermissionsHashGenerator",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_STRING","PermissionsHashGeneratorInterface",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * The private key service.\n   *\n   * @var \\Drupal\\Core\\PrivateKey\n   *\/",15],["T_WHITESPACE","\n  ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$privateKey",20],";",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * The cache backend interface to use for the persistent cache.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$cache",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * The cache backend interface to use for the static cache.\n   *\n   * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n   *\/",29],["T_WHITESPACE","\n  ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$static",34],";",["T_WHITESPACE","\n\n  ",34],["T_DOC_COMMENT","\/**\n   * Constructs a PermissionsHashGenerator object.\n   *\n   * @param \\Drupal\\Core\\PrivateKey $private_key\n   *   The private key service.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $cache\n   *   The cache backend interface to use for the persistent cache.\n   * @param \\Drupal\\Core\\Cache\\CacheBackendInterface $static\n   *   The cache backend interface to use for the static cache.\n   *\/",36],["T_WHITESPACE","\n  ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","__construct",46],"(",["T_STRING","PrivateKey",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$private_key",46],",",["T_WHITESPACE"," ",46],["T_STRING","CacheBackendInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$cache",46],",",["T_WHITESPACE"," ",46],["T_STRING","CacheBackendInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$static",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","privateKey",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$private_key",47],";",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","cache",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$cache",48],";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","static",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$static",49],";",["T_WHITESPACE","\n  ",49],"}",["T_WHITESPACE","\n\n  ",50],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\n   * Cached by role, invalidated whenever permissions change.\n   *\/",52],["T_WHITESPACE","\n  ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","generate",57],"(",["T_STRING","AccountInterface",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$account",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n    ",57],["T_COMMENT","\/\/ User 1 is the super user, and can always access all permissions. Use a\n",58],["T_WHITESPACE","    ",59],["T_COMMENT","\/\/ different, unique identifier for the hash.\n",59],["T_WHITESPACE","    ",60],["T_IF","if",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$account",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","id",60],"(",")",["T_WHITESPACE"," ",60],["T_IS_EQUAL","==",60],["T_WHITESPACE"," ",60],["T_LNUMBER","1",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n      ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","hash",61],"(",["T_CONSTANT_ENCAPSED_STRING","'is-super-user'",61],")",";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_VARIABLE","$sorted_roles",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$account",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getRoles",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_STRING","sort",65],"(",["T_VARIABLE","$sorted_roles",65],")",";",["T_WHITESPACE","\n    ",65],["T_VARIABLE","$role_list",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","implode",66],"(",["T_CONSTANT_ENCAPSED_STRING","','",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$sorted_roles",66],")",";",["T_WHITESPACE","\n    ",66],["T_VARIABLE","$cid",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],"\"",["T_ENCAPSED_AND_WHITESPACE","user_permissions_hash:",67],["T_VARIABLE","$role_list",67],"\"",";",["T_WHITESPACE","\n    ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$static_cache",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","static",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","get",68],"(",["T_VARIABLE","$cid",68],")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n      ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$static_cache",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","data",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n    ",70],["T_ELSE","else",71],["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n      ",71],["T_VARIABLE","$tags",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","Cache",72],["T_DOUBLE_COLON","::",72],["T_STRING","buildTags",72],"(",["T_CONSTANT_ENCAPSED_STRING","'config:user.role'",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$sorted_roles",72],",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'.'",72],")",";",["T_WHITESPACE","\n      ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$cache",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","cache",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","get",73],"(",["T_VARIABLE","$cid",73],")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$permissions_hash",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$cache",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","data",74],";",["T_WHITESPACE","\n      ",74],"}",["T_WHITESPACE","\n      ",75],["T_ELSE","else",76],["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$permissions_hash",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","doGenerate",77],"(",["T_VARIABLE","$sorted_roles",77],")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","cache",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","set",78],"(",["T_VARIABLE","$cid",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$permissions_hash",78],",",["T_WHITESPACE"," ",78],["T_STRING","Cache",78],["T_DOUBLE_COLON","::",78],["T_STRING","PERMANENT",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$tags",78],")",";",["T_WHITESPACE","\n      ",78],"}",["T_WHITESPACE","\n      ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","static",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","set",80],"(",["T_VARIABLE","$cid",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$permissions_hash",80],",",["T_WHITESPACE"," ",80],["T_STRING","Cache",80],["T_DOUBLE_COLON","::",80],["T_STRING","PERMANENT",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$tags",80],")",";",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n\n    ",81],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$permissions_hash",83],";",["T_WHITESPACE","\n  ",83],"}",["T_WHITESPACE","\n\n  ",84],["T_DOC_COMMENT","\/**\n   * Generates a hash that uniquely identifies the user's permissions.\n   *\n   * @param string[] $roles\n   *   The user's roles.\n   *\n   * @return string\n   *   The permissions hash.\n   *\/",86],["T_WHITESPACE","\n  ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","doGenerate",95],"(",["T_ARRAY","array",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$roles",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n    ",95],["T_COMMENT","\/\/ @todo Once Drupal gets rid of user_role_permissions(), we should be able\n",96],["T_WHITESPACE","    ",97],["T_COMMENT","\/\/ to inject the user role controller and call a method on that instead.\n",97],["T_WHITESPACE","    ",98],["T_VARIABLE","$permissions_by_role",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","user_role_permissions",98],"(",["T_VARIABLE","$roles",98],")",";",["T_WHITESPACE","\n    ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$permissions_by_role",99],["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$role",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$permissions",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_STRING","sort",100],"(",["T_VARIABLE","$permissions",100],")",";",["T_WHITESPACE","\n      ",100],["T_COMMENT","\/\/ Note that for admin roles (\\Drupal\\user\\RoleInterface::isAdmin()), the\n",101],["T_WHITESPACE","      ",102],["T_COMMENT","\/\/ permissions returned will be empty ($permissions = []). Therefore the\n",102],["T_WHITESPACE","      ",103],["T_COMMENT","\/\/ presence of the role ID as a key in $permissions_by_role is essential\n",103],["T_WHITESPACE","      ",104],["T_COMMENT","\/\/ to ensure that the hash correctly recognizes admin roles. (If the hash\n",104],["T_WHITESPACE","      ",105],["T_COMMENT","\/\/ was based solely on the union of $permissions, the admin roles would\n",105],["T_WHITESPACE","      ",106],["T_COMMENT","\/\/ effectively be no-ops, allowing for hash collisions.)\n",106],["T_WHITESPACE","      ",107],["T_VARIABLE","$permissions_by_role",107],"[",["T_VARIABLE","$role",107],"]",["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$permissions",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n    ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","hash",109],"(",["T_STRING","serialize",109],"(",["T_VARIABLE","$permissions_by_role",109],")",")",";",["T_WHITESPACE","\n  ",109],"}",["T_WHITESPACE","\n\n  ",110],["T_DOC_COMMENT","\/**\n   * Hashes the given string.\n   *\n   * @param string $identifier\n   *   The string to be hashed.\n   *\n   * @return string\n   *   The hash.\n   *\/",112],["T_WHITESPACE","\n  ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","hash",121],"(",["T_VARIABLE","$identifier",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n    ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_STRING","hash",122],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","privateKey",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","get",122],"(",")",["T_WHITESPACE"," ",122],".",["T_WHITESPACE"," ",122],["T_STRING","Settings",122],["T_DOUBLE_COLON","::",122],["T_STRING","getHashSalt",122],"(",")",["T_WHITESPACE"," ",122],".",["T_WHITESPACE"," ",122],["T_VARIABLE","$identifier",122],")",";",["T_WHITESPACE","\n  ",122],"}",["T_WHITESPACE","\n\n",123],"}",["T_WHITESPACE","\n",125]]