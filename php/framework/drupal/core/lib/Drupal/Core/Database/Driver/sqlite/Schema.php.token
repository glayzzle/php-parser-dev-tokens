[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Database",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Driver",3],["T_NS_SEPARATOR","\\",3],["T_STRING","sqlite",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Utility",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Unicode",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SchemaObjectExistsException",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","SchemaObjectDoesNotExistException",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Core",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Database",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Schema",8],["T_WHITESPACE"," ",8],["T_AS","as",8],["T_WHITESPACE"," ",8],["T_STRING","DatabaseSchema",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * @ingroup schemaapi\n * @{\n *\/",10],["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * SQLite implementation of \\Drupal\\Core\\Database\\Schema.\n *\/",15],["T_WHITESPACE","\n",17],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","Schema",18],["T_WHITESPACE"," ",18],["T_EXTENDS","extends",18],["T_WHITESPACE"," ",18],["T_STRING","DatabaseSchema",18],["T_WHITESPACE"," ",18],"{",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * Override DatabaseSchema::$defaultSchema\n   *\/",20],["T_WHITESPACE","\n  ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$defaultSchema",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'main'",23],";",["T_WHITESPACE","\n\n  ",23],["T_PUBLIC","public",25],["T_WHITESPACE"," ",25],["T_FUNCTION","function",25],["T_WHITESPACE"," ",25],["T_STRING","tableExists",25],"(",["T_VARIABLE","$table",25],")",["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n    ",25],["T_VARIABLE","$info",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","getPrefixInfo",26],"(",["T_VARIABLE","$table",26],")",";",["T_WHITESPACE","\n\n    ",26],["T_COMMENT","\/\/ Don't use {} around sqlite_master table.\n",28],["T_WHITESPACE","    ",29],["T_RETURN","return",29],["T_WHITESPACE"," ",29],["T_BOOL_CAST","(bool)",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","connection",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","query",29],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT 1 FROM '",29],["T_WHITESPACE"," ",29],".",["T_WHITESPACE"," ",29],["T_VARIABLE","$info",29],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",29],"]",["T_WHITESPACE"," ",29],".",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'.sqlite_master WHERE type = :type AND name = :name'",29],",",["T_WHITESPACE"," ",29],["T_ARRAY","array",29],"(",["T_CONSTANT_ENCAPSED_STRING","':type'",29],["T_WHITESPACE"," ",29],["T_DOUBLE_ARROW","=>",29],["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'table'",29],",",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","':name'",29],["T_WHITESPACE"," ",29],["T_DOUBLE_ARROW","=>",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$info",29],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",29],"]",")",")",["T_OBJECT_OPERATOR","->",29],["T_STRING","fetchField",29],"(",")",";",["T_WHITESPACE","\n  ",29],"}",["T_WHITESPACE","\n\n  ",30],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","fieldExists",32],"(",["T_VARIABLE","$table",32],",",["T_WHITESPACE"," ",32],["T_VARIABLE","$column",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$schema",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","introspectSchema",33],"(",["T_VARIABLE","$table",33],")",";",["T_WHITESPACE","\n    ",33],["T_RETURN","return",34],["T_WHITESPACE"," ",34],"!",["T_EMPTY","empty",34],"(",["T_VARIABLE","$schema",34],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",34],"]","[",["T_VARIABLE","$column",34],"]",")",";",["T_WHITESPACE","\n  ",34],"}",["T_WHITESPACE","\n\n  ",35],["T_DOC_COMMENT","\/**\n   * Generate SQL to create a new table from a Drupal schema definition.\n   *\n   * @param $name\n   *   The name of the table to create.\n   * @param $table\n   *   A Schema API table definition array.\n   * @return\n   *   An array of SQL statements to create the table.\n   *\/",37],["T_WHITESPACE","\n  ",46],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","createTableSql",47],"(",["T_VARIABLE","$name",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$table",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n    ",47],["T_VARIABLE","$sql",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_ARRAY","array",48],"(",")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$sql",49],"[","]",["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","\"CREATE TABLE {\"",49],["T_WHITESPACE"," ",49],".",["T_WHITESPACE"," ",49],["T_VARIABLE","$name",49],["T_WHITESPACE"," ",49],".",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","\"} (\\n\"",49],["T_WHITESPACE"," ",49],".",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","createColumnsSql",49],"(",["T_VARIABLE","$name",49],",",["T_WHITESPACE"," ",49],["T_VARIABLE","$table",49],")",["T_WHITESPACE"," ",49],".",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","\"\\n)\\n\"",49],";",["T_WHITESPACE","\n    ",49],["T_RETURN","return",50],["T_WHITESPACE"," ",50],["T_STRING","array_merge",50],"(",["T_VARIABLE","$sql",50],",",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","createIndexSql",50],"(",["T_VARIABLE","$name",50],",",["T_WHITESPACE"," ",50],["T_VARIABLE","$table",50],")",")",";",["T_WHITESPACE","\n  ",50],"}",["T_WHITESPACE","\n\n  ",51],["T_DOC_COMMENT","\/**\n   * Build the SQL expression for indexes.\n   *\/",53],["T_WHITESPACE","\n  ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","createIndexSql",56],"(",["T_VARIABLE","$tablename",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$schema",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$sql",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$info",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getPrefixInfo",58],"(",["T_VARIABLE","$tablename",58],")",";",["T_WHITESPACE","\n    ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(","!",["T_EMPTY","empty",59],"(",["T_VARIABLE","$schema",59],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",59],"]",")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n      ",59],["T_FOREACH","foreach",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$schema",60],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",60],"]",["T_WHITESPACE"," ",60],["T_AS","as",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$key",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$fields",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$sql",61],"[","]",["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'CREATE UNIQUE INDEX '",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$info",61],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",61],"]",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'.'",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$info",61],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",61],"]",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'_'",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$key",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","' ON '",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$info",61],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",61],"]",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","' ('",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","createKeySql",61],"(",["T_VARIABLE","$fields",61],")",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","\")\\n\"",61],";",["T_WHITESPACE","\n      ",61],"}",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n    ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(","!",["T_EMPTY","empty",64],"(",["T_VARIABLE","$schema",64],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",64],"]",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n      ",64],["T_FOREACH","foreach",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$schema",65],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",65],"]",["T_WHITESPACE"," ",65],["T_AS","as",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$key",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$fields",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$sql",66],"[","]",["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'CREATE INDEX '",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$info",66],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",66],"]",["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'.'",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$info",66],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",66],"]",["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'_'",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$key",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","' ON '",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$info",66],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",66],"]",["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","' ('",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","createKeySql",66],"(",["T_VARIABLE","$fields",66],")",["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","\")\\n\"",66],";",["T_WHITESPACE","\n      ",66],"}",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n    ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$sql",69],";",["T_WHITESPACE","\n  ",69],"}",["T_WHITESPACE","\n\n  ",70],["T_DOC_COMMENT","\/**\n   * Build the SQL expression for creating columns.\n   *\/",72],["T_WHITESPACE","\n  ",74],["T_PROTECTED","protected",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","createColumnsSql",75],"(",["T_VARIABLE","$tablename",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$schema",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n    ",75],["T_VARIABLE","$sql_array",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",")",";",["T_WHITESPACE","\n\n    ",76],["T_COMMENT","\/\/ Add the SQL statement for each field.\n",78],["T_WHITESPACE","    ",79],["T_FOREACH","foreach",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$schema",79],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",79],"]",["T_WHITESPACE"," ",79],["T_AS","as",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$name",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$field",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n      ",79],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_ISSET","isset",80],"(",["T_VARIABLE","$field",80],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",80],"]",")",["T_WHITESPACE"," ",80],["T_BOOLEAN_AND","&&",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$field",80],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",80],"]",["T_WHITESPACE"," ",80],["T_IS_EQUAL","==",80],["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'serial'",80],")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_ISSET","isset",81],"(",["T_VARIABLE","$schema",81],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",81],"]",")",["T_WHITESPACE"," ",81],["T_BOOLEAN_AND","&&",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$key",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","array_search",81],"(",["T_VARIABLE","$name",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$schema",81],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",81],"]",")",")",["T_WHITESPACE"," ",81],["T_IS_NOT_IDENTICAL","!==",81],["T_WHITESPACE"," ",81],["T_STRING","FALSE",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n          ",81],["T_UNSET","unset",82],"(",["T_VARIABLE","$schema",82],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",82],"]","[",["T_VARIABLE","$key",82],"]",")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n      ",83],"}",["T_WHITESPACE","\n      ",84],["T_VARIABLE","$sql_array",85],"[","]",["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","createFieldSql",85],"(",["T_VARIABLE","$name",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","processField",85],"(",["T_VARIABLE","$field",85],")",")",";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_COMMENT","\/\/ Process keys.\n",88],["T_WHITESPACE","    ",89],["T_IF","if",89],["T_WHITESPACE"," ",89],"(","!",["T_EMPTY","empty",89],"(",["T_VARIABLE","$schema",89],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",89],"]",")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n      ",89],["T_VARIABLE","$sql_array",90],"[","]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\" PRIMARY KEY (\"",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","createKeySql",90],"(",["T_VARIABLE","$schema",90],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",90],"]",")",["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\")\"",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_STRING","implode",93],"(",["T_CONSTANT_ENCAPSED_STRING","\", \\n\"",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$sql_array",93],")",";",["T_WHITESPACE","\n  ",93],"}",["T_WHITESPACE","\n\n  ",94],["T_DOC_COMMENT","\/**\n   * Build the SQL expression for keys.\n   *\/",96],["T_WHITESPACE","\n  ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","createKeySql",99],"(",["T_VARIABLE","$fields",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n    ",99],["T_VARIABLE","$return",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",")",";",["T_WHITESPACE","\n    ",100],["T_FOREACH","foreach",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$fields",101],["T_WHITESPACE"," ",101],["T_AS","as",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$field",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n      ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_STRING","is_array",102],"(",["T_VARIABLE","$field",102],")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$return",103],"[","]",["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$field",103],"[",["T_LNUMBER","0",103],"]",";",["T_WHITESPACE","\n      ",103],"}",["T_WHITESPACE","\n      ",104],["T_ELSE","else",105],["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$return",106],"[","]",["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$field",106],";",["T_WHITESPACE","\n      ",106],"}",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n    ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_STRING","implode",109],"(",["T_CONSTANT_ENCAPSED_STRING","', '",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$return",109],")",";",["T_WHITESPACE","\n  ",109],"}",["T_WHITESPACE","\n\n  ",110],["T_DOC_COMMENT","\/**\n   * Set database-engine specific properties for a field.\n   *\n   * @param $field\n   *   A field description array, as specified in the schema documentation.\n   *\/",112],["T_WHITESPACE","\n  ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","processField",118],"(",["T_VARIABLE","$field",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n    ",118],["T_IF","if",119],["T_WHITESPACE"," ",119],"(","!",["T_ISSET","isset",119],"(",["T_VARIABLE","$field",119],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",119],"]",")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n      ",119],["T_VARIABLE","$field",120],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",120],"]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'normal'",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_COMMENT","\/\/ Set the correct database-engine specific datatype.\n",123],["T_WHITESPACE","    ",124],["T_COMMENT","\/\/ In case one is already provided, force it to uppercase.\n",124],["T_WHITESPACE","    ",125],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_ISSET","isset",125],"(",["T_VARIABLE","$field",125],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",125],"]",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n      ",125],["T_VARIABLE","$field",126],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Unicode",126],["T_DOUBLE_COLON","::",126],["T_STRING","strtoupper",126],"(",["T_VARIABLE","$field",126],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",126],"]",")",";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n    ",127],["T_ELSE","else",128],["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n      ",128],["T_VARIABLE","$map",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getFieldTypeMap",129],"(",")",";",["T_WHITESPACE","\n      ",129],["T_VARIABLE","$field",130],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$map",130],"[",["T_VARIABLE","$field",130],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",130],"]",["T_WHITESPACE"," ",130],".",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","':'",130],["T_WHITESPACE"," ",130],".",["T_WHITESPACE"," ",130],["T_VARIABLE","$field",130],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",130],"]","]",";",["T_WHITESPACE","\n\n      ",130],["T_COMMENT","\/\/ Numeric fields with a specified scale have to be stored as floats.\n",132],["T_WHITESPACE","      ",133],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$field",133],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",133],"]",["T_WHITESPACE"," ",133],["T_IS_IDENTICAL","===",133],["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'NUMERIC'",133],["T_WHITESPACE"," ",133],["T_BOOLEAN_AND","&&",133],["T_WHITESPACE"," ",133],["T_ISSET","isset",133],"(",["T_VARIABLE","$field",133],"[",["T_CONSTANT_ENCAPSED_STRING","'scale'",133],"]",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$field",134],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",134],"]",["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",134],";",["T_WHITESPACE","\n      ",134],"}",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_ISSET","isset",138],"(",["T_VARIABLE","$field",138],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",138],"]",")",["T_WHITESPACE"," ",138],["T_BOOLEAN_AND","&&",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$field",138],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",138],"]",["T_WHITESPACE"," ",138],["T_IS_EQUAL","==",138],["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'serial'",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n      ",138],["T_VARIABLE","$field",139],"[",["T_CONSTANT_ENCAPSED_STRING","'auto_increment'",139],"]",["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","TRUE",139],";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$field",142],";",["T_WHITESPACE","\n  ",142],"}",["T_WHITESPACE","\n\n  ",143],["T_DOC_COMMENT","\/**\n   * Create an SQL string for a field to be used in table creation or alteration.\n   *\n   * Before passing a field out of a schema definition into this function it has\n   * to be processed by db_processField().\n   *\n   * @param $name\n   *    Name of the field.\n   * @param $spec\n   *    The field specification, as per the schema data structure format.\n   *\/",145],["T_WHITESPACE","\n  ",155],["T_PROTECTED","protected",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","createFieldSql",156],"(",["T_VARIABLE","$name",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$spec",156],")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n    ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(","!",["T_EMPTY","empty",157],"(",["T_VARIABLE","$spec",157],"[",["T_CONSTANT_ENCAPSED_STRING","'auto_increment'",157],"]",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n      ",157],["T_VARIABLE","$sql",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$name",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","\" INTEGER PRIMARY KEY AUTOINCREMENT\"",158],";",["T_WHITESPACE","\n      ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(","!",["T_EMPTY","empty",159],"(",["T_VARIABLE","$spec",159],"[",["T_CONSTANT_ENCAPSED_STRING","'unsigned'",159],"]",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$sql",160],["T_WHITESPACE"," ",160],["T_CONCAT_EQUAL",".=",160],["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","' CHECK ('",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_VARIABLE","$name",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'>= 0)'",160],";",["T_WHITESPACE","\n      ",160],"}",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n    ",162],["T_ELSE","else",163],["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n      ",163],["T_VARIABLE","$sql",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$name",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","' '",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_VARIABLE","$spec",164],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",164],"]",";",["T_WHITESPACE","\n\n      ",164],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_STRING","in_array",166],"(",["T_VARIABLE","$spec",166],"[",["T_CONSTANT_ENCAPSED_STRING","'sqlite_type'",166],"]",",",["T_WHITESPACE"," ",166],["T_ARRAY","array",166],"(",["T_CONSTANT_ENCAPSED_STRING","'VARCHAR'",166],",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",166],")",")",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n        ",166],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_ISSET","isset",167],"(",["T_VARIABLE","$spec",167],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",167],"]",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n          ",167],["T_VARIABLE","$sql",168],["T_WHITESPACE"," ",168],["T_CONCAT_EQUAL",".=",168],["T_WHITESPACE"," ",168],["T_CONSTANT_ENCAPSED_STRING","'('",168],["T_WHITESPACE"," ",168],".",["T_WHITESPACE"," ",168],["T_VARIABLE","$spec",168],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",168],"]",["T_WHITESPACE"," ",168],".",["T_WHITESPACE"," ",168],["T_CONSTANT_ENCAPSED_STRING","')'",168],";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_ISSET","isset",171],"(",["T_VARIABLE","$spec",171],"[",["T_CONSTANT_ENCAPSED_STRING","'binary'",171],"]",")",["T_WHITESPACE"," ",171],["T_BOOLEAN_AND","&&",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$spec",171],"[",["T_CONSTANT_ENCAPSED_STRING","'binary'",171],"]",["T_WHITESPACE"," ",171],["T_IS_IDENTICAL","===",171],["T_WHITESPACE"," ",171],["T_STRING","FALSE",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n          ",171],["T_VARIABLE","$sql",172],["T_WHITESPACE"," ",172],["T_CONCAT_EQUAL",".=",172],["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","' COLLATE NOCASE_UTF8'",172],";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n      ",173],"}",["T_WHITESPACE","\n\n      ",174],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_ISSET","isset",176],"(",["T_VARIABLE","$spec",176],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",176],"]",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n        ",176],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$spec",177],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",177],"]",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n          ",177],["T_VARIABLE","$sql",178],["T_WHITESPACE"," ",178],["T_CONCAT_EQUAL",".=",178],["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","' NOT NULL'",178],";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n        ",179],["T_ELSE","else",180],["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n          ",180],["T_VARIABLE","$sql",181],["T_WHITESPACE"," ",181],["T_CONCAT_EQUAL",".=",181],["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","' NULL'",181],";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n      ",182],"}",["T_WHITESPACE","\n\n      ",183],["T_IF","if",185],["T_WHITESPACE"," ",185],"(","!",["T_EMPTY","empty",185],"(",["T_VARIABLE","$spec",185],"[",["T_CONSTANT_ENCAPSED_STRING","'unsigned'",185],"]",")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$sql",186],["T_WHITESPACE"," ",186],["T_CONCAT_EQUAL",".=",186],["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","' CHECK ('",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_VARIABLE","$name",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'>= 0)'",186],";",["T_WHITESPACE","\n      ",186],"}",["T_WHITESPACE","\n\n      ",187],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_ISSET","isset",189],"(",["T_VARIABLE","$spec",189],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",189],"]",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_STRING","is_string",190],"(",["T_VARIABLE","$spec",190],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",190],"]",")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n          ",190],["T_VARIABLE","$spec",191],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",191],"]",["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","connection",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","quote",191],"(",["T_VARIABLE","$spec",191],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",191],"]",")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$sql",193],["T_WHITESPACE"," ",193],["T_CONCAT_EQUAL",".=",193],["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","' DEFAULT '",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_VARIABLE","$spec",193],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",193],"]",";",["T_WHITESPACE","\n      ",193],"}",["T_WHITESPACE","\n\n      ",194],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_EMPTY","empty",196],"(",["T_VARIABLE","$spec",196],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",196],"]",")",["T_WHITESPACE"," ",196],["T_BOOLEAN_AND","&&",196],["T_WHITESPACE"," ",196],"!",["T_ISSET","isset",196],"(",["T_VARIABLE","$spec",196],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",196],"]",")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$sql",197],["T_WHITESPACE"," ",197],["T_CONCAT_EQUAL",".=",197],["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","' DEFAULT NULL'",197],";",["T_WHITESPACE","\n      ",197],"}",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n    ",199],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$sql",200],";",["T_WHITESPACE","\n  ",200],"}",["T_WHITESPACE","\n\n  ",201],["T_DOC_COMMENT","\/**\n   * This maps a generic data type in combination with its data size\n   * to the engine-specific data type.\n   *\/",203],["T_WHITESPACE","\n  ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","getFieldTypeMap",207],"(",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n    ",207],["T_COMMENT","\/\/ Put :normal last so it gets preserved by array_flip. This makes\n",208],["T_WHITESPACE","    ",209],["T_COMMENT","\/\/ it much easier for modules (such as schema.module) to map\n",209],["T_WHITESPACE","    ",210],["T_COMMENT","\/\/ database types back into schema types.\n",210],["T_WHITESPACE","    ",211],["T_COMMENT","\/\/ $map does not use drupal_static as its value never changes.\n",211],["T_WHITESPACE","    ",212],["T_STATIC","static",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$map",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",["T_WHITESPACE","\n      ",212],["T_CONSTANT_ENCAPSED_STRING","'varchar_ascii:normal'",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","'VARCHAR'",213],",",["T_WHITESPACE","\n\n      ",213],["T_CONSTANT_ENCAPSED_STRING","'varchar:normal'",215],["T_WHITESPACE","  ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_CONSTANT_ENCAPSED_STRING","'VARCHAR'",215],",",["T_WHITESPACE","\n      ",215],["T_CONSTANT_ENCAPSED_STRING","'char:normal'",216],["T_WHITESPACE","     ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'CHAR'",216],",",["T_WHITESPACE","\n\n      ",216],["T_CONSTANT_ENCAPSED_STRING","'text:tiny'",218],["T_WHITESPACE","       ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",218],",",["T_WHITESPACE","\n      ",218],["T_CONSTANT_ENCAPSED_STRING","'text:small'",219],["T_WHITESPACE","      ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",219],",",["T_WHITESPACE","\n      ",219],["T_CONSTANT_ENCAPSED_STRING","'text:medium'",220],["T_WHITESPACE","     ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",220],",",["T_WHITESPACE","\n      ",220],["T_CONSTANT_ENCAPSED_STRING","'text:big'",221],["T_WHITESPACE","        ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",221],",",["T_WHITESPACE","\n      ",221],["T_CONSTANT_ENCAPSED_STRING","'text:normal'",222],["T_WHITESPACE","     ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_CONSTANT_ENCAPSED_STRING","'TEXT'",222],",",["T_WHITESPACE","\n\n      ",222],["T_CONSTANT_ENCAPSED_STRING","'serial:tiny'",224],["T_WHITESPACE","     ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",224],",",["T_WHITESPACE","\n      ",224],["T_CONSTANT_ENCAPSED_STRING","'serial:small'",225],["T_WHITESPACE","    ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",225],",",["T_WHITESPACE","\n      ",225],["T_CONSTANT_ENCAPSED_STRING","'serial:medium'",226],["T_WHITESPACE","   ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",226],",",["T_WHITESPACE","\n      ",226],["T_CONSTANT_ENCAPSED_STRING","'serial:big'",227],["T_WHITESPACE","      ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",227],",",["T_WHITESPACE","\n      ",227],["T_CONSTANT_ENCAPSED_STRING","'serial:normal'",228],["T_WHITESPACE","   ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",228],",",["T_WHITESPACE","\n\n      ",228],["T_CONSTANT_ENCAPSED_STRING","'int:tiny'",230],["T_WHITESPACE","        ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",230],",",["T_WHITESPACE","\n      ",230],["T_CONSTANT_ENCAPSED_STRING","'int:small'",231],["T_WHITESPACE","       ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",231],",",["T_WHITESPACE","\n      ",231],["T_CONSTANT_ENCAPSED_STRING","'int:medium'",232],["T_WHITESPACE","      ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",232],",",["T_WHITESPACE","\n      ",232],["T_CONSTANT_ENCAPSED_STRING","'int:big'",233],["T_WHITESPACE","         ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",233],",",["T_WHITESPACE","\n      ",233],["T_CONSTANT_ENCAPSED_STRING","'int:normal'",234],["T_WHITESPACE","      ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'INTEGER'",234],",",["T_WHITESPACE","\n\n      ",234],["T_CONSTANT_ENCAPSED_STRING","'float:tiny'",236],["T_WHITESPACE","      ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",236],",",["T_WHITESPACE","\n      ",236],["T_CONSTANT_ENCAPSED_STRING","'float:small'",237],["T_WHITESPACE","     ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",237],",",["T_WHITESPACE","\n      ",237],["T_CONSTANT_ENCAPSED_STRING","'float:medium'",238],["T_WHITESPACE","    ",238],["T_DOUBLE_ARROW","=>",238],["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",238],",",["T_WHITESPACE","\n      ",238],["T_CONSTANT_ENCAPSED_STRING","'float:big'",239],["T_WHITESPACE","       ",239],["T_DOUBLE_ARROW","=>",239],["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",239],",",["T_WHITESPACE","\n      ",239],["T_CONSTANT_ENCAPSED_STRING","'float:normal'",240],["T_WHITESPACE","    ",240],["T_DOUBLE_ARROW","=>",240],["T_WHITESPACE"," ",240],["T_CONSTANT_ENCAPSED_STRING","'FLOAT'",240],",",["T_WHITESPACE","\n\n      ",240],["T_CONSTANT_ENCAPSED_STRING","'numeric:normal'",242],["T_WHITESPACE","  ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","'NUMERIC'",242],",",["T_WHITESPACE","\n\n      ",242],["T_CONSTANT_ENCAPSED_STRING","'blob:big'",244],["T_WHITESPACE","        ",244],["T_DOUBLE_ARROW","=>",244],["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'BLOB'",244],",",["T_WHITESPACE","\n      ",244],["T_CONSTANT_ENCAPSED_STRING","'blob:normal'",245],["T_WHITESPACE","     ",245],["T_DOUBLE_ARROW","=>",245],["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'BLOB'",245],",",["T_WHITESPACE","\n    ",245],")",";",["T_WHITESPACE","\n    ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$map",247],";",["T_WHITESPACE","\n  ",247],"}",["T_WHITESPACE","\n\n  ",248],["T_PUBLIC","public",250],["T_WHITESPACE"," ",250],["T_FUNCTION","function",250],["T_WHITESPACE"," ",250],["T_STRING","renameTable",250],"(",["T_VARIABLE","$table",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$new_name",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n    ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(","!",["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","tableExists",251],"(",["T_VARIABLE","$table",251],")",")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n      ",251],["T_THROW","throw",252],["T_WHITESPACE"," ",252],["T_NEW","new",252],["T_WHITESPACE"," ",252],["T_STRING","SchemaObjectDoesNotExistException",252],"(",["T_STRING","t",252],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot rename @table to @table_new: table @table doesn't exist.\"",252],",",["T_WHITESPACE"," ",252],["T_ARRAY","array",252],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$table",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'@table_new'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$new_name",252],")",")",")",";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n    ",253],["T_IF","if",254],["T_WHITESPACE"," ",254],"(",["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","tableExists",254],"(",["T_VARIABLE","$new_name",254],")",")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n      ",254],["T_THROW","throw",255],["T_WHITESPACE"," ",255],["T_NEW","new",255],["T_WHITESPACE"," ",255],["T_STRING","SchemaObjectExistsException",255],"(",["T_STRING","t",255],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot rename @table to @table_new: table @table_new already exists.\"",255],",",["T_WHITESPACE"," ",255],["T_ARRAY","array",255],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",255],["T_WHITESPACE"," ",255],["T_DOUBLE_ARROW","=>",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$table",255],",",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'@table_new'",255],["T_WHITESPACE"," ",255],["T_DOUBLE_ARROW","=>",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$new_name",255],")",")",")",";",["T_WHITESPACE","\n    ",255],"}",["T_WHITESPACE","\n\n    ",256],["T_VARIABLE","$schema",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","introspectSchema",258],"(",["T_VARIABLE","$table",258],")",";",["T_WHITESPACE","\n\n    ",258],["T_COMMENT","\/\/ SQLite doesn't allow you to rename tables outside of the current\n",260],["T_WHITESPACE","    ",261],["T_COMMENT","\/\/ database. So the syntax '... RENAME TO database.table' would fail.\n",261],["T_WHITESPACE","    ",262],["T_COMMENT","\/\/ So we must determine the full table name here rather than surrounding\n",262],["T_WHITESPACE","    ",263],["T_COMMENT","\/\/ the table with curly braces in case the db_prefix contains a reference\n",263],["T_WHITESPACE","    ",264],["T_COMMENT","\/\/ to a database outside of our existing database.\n",264],["T_WHITESPACE","    ",265],["T_VARIABLE","$info",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getPrefixInfo",265],"(",["T_VARIABLE","$new_name",265],")",";",["T_WHITESPACE","\n    ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","connection",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","query",266],"(",["T_CONSTANT_ENCAPSED_STRING","'ALTER TABLE {'",266],["T_WHITESPACE"," ",266],".",["T_WHITESPACE"," ",266],["T_VARIABLE","$table",266],["T_WHITESPACE"," ",266],".",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","'} RENAME TO '",266],["T_WHITESPACE"," ",266],".",["T_WHITESPACE"," ",266],["T_VARIABLE","$info",266],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",266],"]",")",";",["T_WHITESPACE","\n\n    ",266],["T_COMMENT","\/\/ Drop the indexes, there is no RENAME INDEX command in SQLite.\n",268],["T_WHITESPACE","    ",269],["T_IF","if",269],["T_WHITESPACE"," ",269],"(","!",["T_EMPTY","empty",269],"(",["T_VARIABLE","$schema",269],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",269],"]",")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n      ",269],["T_FOREACH","foreach",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$schema",270],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",270],"]",["T_WHITESPACE"," ",270],["T_AS","as",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$key",270],["T_WHITESPACE"," ",270],["T_DOUBLE_ARROW","=>",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$fields",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","dropIndex",271],"(",["T_VARIABLE","$table",271],",",["T_WHITESPACE"," ",271],["T_VARIABLE","$key",271],")",";",["T_WHITESPACE","\n      ",271],"}",["T_WHITESPACE","\n    ",272],"}",["T_WHITESPACE","\n    ",273],["T_IF","if",274],["T_WHITESPACE"," ",274],"(","!",["T_EMPTY","empty",274],"(",["T_VARIABLE","$schema",274],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",274],"]",")",")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n      ",274],["T_FOREACH","foreach",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$schema",275],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",275],"]",["T_WHITESPACE"," ",275],["T_AS","as",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$index",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$fields",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","dropIndex",276],"(",["T_VARIABLE","$table",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$index",276],")",";",["T_WHITESPACE","\n      ",276],"}",["T_WHITESPACE","\n    ",277],"}",["T_WHITESPACE","\n\n    ",278],["T_COMMENT","\/\/ Recreate the indexes.\n",280],["T_WHITESPACE","    ",281],["T_VARIABLE","$statements",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","createIndexSql",281],"(",["T_VARIABLE","$new_name",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$schema",281],")",";",["T_WHITESPACE","\n    ",281],["T_FOREACH","foreach",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$statements",282],["T_WHITESPACE"," ",282],["T_AS","as",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$statement",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n      ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","connection",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","query",283],"(",["T_VARIABLE","$statement",283],")",";",["T_WHITESPACE","\n    ",283],"}",["T_WHITESPACE","\n  ",284],"}",["T_WHITESPACE","\n\n  ",285],["T_PUBLIC","public",287],["T_WHITESPACE"," ",287],["T_FUNCTION","function",287],["T_WHITESPACE"," ",287],["T_STRING","dropTable",287],"(",["T_VARIABLE","$table",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n    ",287],["T_IF","if",288],["T_WHITESPACE"," ",288],"(","!",["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","tableExists",288],"(",["T_VARIABLE","$table",288],")",")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n      ",288],["T_RETURN","return",289],["T_WHITESPACE"," ",289],["T_STRING","FALSE",289],";",["T_WHITESPACE","\n    ",289],"}",["T_WHITESPACE","\n    ",290],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","connection",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","tableDropped",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_STRING","TRUE",291],";",["T_WHITESPACE","\n    ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","connection",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","query",292],"(",["T_CONSTANT_ENCAPSED_STRING","'DROP TABLE {'",292],["T_WHITESPACE"," ",292],".",["T_WHITESPACE"," ",292],["T_VARIABLE","$table",292],["T_WHITESPACE"," ",292],".",["T_WHITESPACE"," ",292],["T_CONSTANT_ENCAPSED_STRING","'}'",292],")",";",["T_WHITESPACE","\n    ",292],["T_RETURN","return",293],["T_WHITESPACE"," ",293],["T_STRING","TRUE",293],";",["T_WHITESPACE","\n  ",293],"}",["T_WHITESPACE","\n\n  ",294],["T_PUBLIC","public",296],["T_WHITESPACE"," ",296],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","addField",296],"(",["T_VARIABLE","$table",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$field",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$specification",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$keys_new",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_ARRAY","array",296],"(",")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n    ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(","!",["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","tableExists",297],"(",["T_VARIABLE","$table",297],")",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n      ",297],["T_THROW","throw",298],["T_WHITESPACE"," ",298],["T_NEW","new",298],["T_WHITESPACE"," ",298],["T_STRING","SchemaObjectDoesNotExistException",298],"(",["T_STRING","t",298],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add field @table.@field: table doesn't exist.\"",298],",",["T_WHITESPACE"," ",298],["T_ARRAY","array",298],"(",["T_CONSTANT_ENCAPSED_STRING","'@field'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$field",298],",",["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'@table'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$table",298],")",")",")",";",["T_WHITESPACE","\n    ",298],"}",["T_WHITESPACE","\n    ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","fieldExists",300],"(",["T_VARIABLE","$table",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$field",300],")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n      ",300],["T_THROW","throw",301],["T_WHITESPACE"," ",301],["T_NEW","new",301],["T_WHITESPACE"," ",301],["T_STRING","SchemaObjectExistsException",301],"(",["T_STRING","t",301],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add field @table.@field: field already exists.\"",301],",",["T_WHITESPACE"," ",301],["T_ARRAY","array",301],"(",["T_CONSTANT_ENCAPSED_STRING","'@field'",301],["T_WHITESPACE"," ",301],["T_DOUBLE_ARROW","=>",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$field",301],",",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'@table'",301],["T_WHITESPACE"," ",301],["T_DOUBLE_ARROW","=>",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$table",301],")",")",")",";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n\n    ",302],["T_COMMENT","\/\/ SQLite doesn't have a full-featured ALTER TABLE statement. It only\n",304],["T_WHITESPACE","    ",305],["T_COMMENT","\/\/ supports adding new fields to a table, in some simple cases. In most\n",305],["T_WHITESPACE","    ",306],["T_COMMENT","\/\/ cases, we have to create a new table and copy the data over.\n",306],["T_WHITESPACE","    ",307],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_EMPTY","empty",307],"(",["T_VARIABLE","$keys_new",307],")",["T_WHITESPACE"," ",307],["T_BOOLEAN_AND","&&",307],["T_WHITESPACE"," ",307],"(",["T_EMPTY","empty",307],"(",["T_VARIABLE","$specification",307],"[",["T_CONSTANT_ENCAPSED_STRING","'not null'",307],"]",")",["T_WHITESPACE"," ",307],["T_BOOLEAN_OR","||",307],["T_WHITESPACE"," ",307],["T_ISSET","isset",307],"(",["T_VARIABLE","$specification",307],"[",["T_CONSTANT_ENCAPSED_STRING","'default'",307],"]",")",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n      ",307],["T_COMMENT","\/\/ When we don't have to create new keys and we are not creating a\n",308],["T_WHITESPACE","      ",309],["T_COMMENT","\/\/ NOT NULL column without a default value, we can use the quicker version.\n",309],["T_WHITESPACE","      ",310],["T_VARIABLE","$query",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_CONSTANT_ENCAPSED_STRING","'ALTER TABLE {'",310],["T_WHITESPACE"," ",310],".",["T_WHITESPACE"," ",310],["T_VARIABLE","$table",310],["T_WHITESPACE"," ",310],".",["T_WHITESPACE"," ",310],["T_CONSTANT_ENCAPSED_STRING","'} ADD '",310],["T_WHITESPACE"," ",310],".",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","createFieldSql",310],"(",["T_VARIABLE","$field",310],",",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","processField",310],"(",["T_VARIABLE","$specification",310],")",")",";",["T_WHITESPACE","\n      ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","connection",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","query",311],"(",["T_VARIABLE","$query",311],")",";",["T_WHITESPACE","\n\n      ",311],["T_COMMENT","\/\/ Apply the initial value if set.\n",313],["T_WHITESPACE","      ",314],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_ISSET","isset",314],"(",["T_VARIABLE","$specification",314],"[",["T_CONSTANT_ENCAPSED_STRING","'initial'",314],"]",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","connection",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","update",315],"(",["T_VARIABLE","$table",315],")",["T_WHITESPACE","\n          ",315],["T_OBJECT_OPERATOR","->",316],["T_STRING","fields",316],"(",["T_ARRAY","array",316],"(",["T_VARIABLE","$field",316],["T_WHITESPACE"," ",316],["T_DOUBLE_ARROW","=>",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$specification",316],"[",["T_CONSTANT_ENCAPSED_STRING","'initial'",316],"]",")",")",["T_WHITESPACE","\n          ",316],["T_OBJECT_OPERATOR","->",317],["T_STRING","execute",317],"(",")",";",["T_WHITESPACE","\n      ",317],"}",["T_WHITESPACE","\n      ",318],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_ISSET","isset",319],"(",["T_VARIABLE","$specification",319],"[",["T_CONSTANT_ENCAPSED_STRING","'initial_from_field'",319],"]",")",")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n        ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","connection",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","update",320],"(",["T_VARIABLE","$table",320],")",["T_WHITESPACE","\n          ",320],["T_OBJECT_OPERATOR","->",321],["T_STRING","expression",321],"(",["T_VARIABLE","$field",321],",",["T_WHITESPACE"," ",321],["T_VARIABLE","$specification",321],"[",["T_CONSTANT_ENCAPSED_STRING","'initial_from_field'",321],"]",")",["T_WHITESPACE","\n          ",321],["T_OBJECT_OPERATOR","->",322],["T_STRING","execute",322],"(",")",";",["T_WHITESPACE","\n      ",322],"}",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n    ",324],["T_ELSE","else",325],["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n      ",325],["T_COMMENT","\/\/ We cannot add the field directly. Use the slower table alteration\n",326],["T_WHITESPACE","      ",327],["T_COMMENT","\/\/ method, starting from the old schema.\n",327],["T_WHITESPACE","      ",328],["T_VARIABLE","$old_schema",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","introspectSchema",328],"(",["T_VARIABLE","$table",328],")",";",["T_WHITESPACE","\n      ",328],["T_VARIABLE","$new_schema",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$old_schema",329],";",["T_WHITESPACE","\n\n      ",329],["T_COMMENT","\/\/ Add the new field.\n",331],["T_WHITESPACE","      ",332],["T_VARIABLE","$new_schema",332],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",332],"]","[",["T_VARIABLE","$field",332],"]",["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$specification",332],";",["T_WHITESPACE","\n\n      ",332],["T_COMMENT","\/\/ Build the mapping between the old fields and the new fields.\n",334],["T_WHITESPACE","      ",335],["T_VARIABLE","$mapping",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_ARRAY","array",335],"(",")",";",["T_WHITESPACE","\n      ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_ISSET","isset",336],"(",["T_VARIABLE","$specification",336],"[",["T_CONSTANT_ENCAPSED_STRING","'initial'",336],"]",")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n        ",336],["T_COMMENT","\/\/ If we have a initial value, copy it over.\n",337],["T_WHITESPACE","        ",338],["T_VARIABLE","$mapping",338],"[",["T_VARIABLE","$field",338],"]",["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_ARRAY","array",338],"(",["T_WHITESPACE","\n          ",338],["T_CONSTANT_ENCAPSED_STRING","'expression'",339],["T_WHITESPACE"," ",339],["T_DOUBLE_ARROW","=>",339],["T_WHITESPACE"," ",339],["T_CONSTANT_ENCAPSED_STRING","':newfieldinitial'",339],",",["T_WHITESPACE","\n          ",339],["T_CONSTANT_ENCAPSED_STRING","'arguments'",340],["T_WHITESPACE"," ",340],["T_DOUBLE_ARROW","=>",340],["T_WHITESPACE"," ",340],["T_ARRAY","array",340],"(",["T_CONSTANT_ENCAPSED_STRING","':newfieldinitial'",340],["T_WHITESPACE"," ",340],["T_DOUBLE_ARROW","=>",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$specification",340],"[",["T_CONSTANT_ENCAPSED_STRING","'initial'",340],"]",")",",",["T_WHITESPACE","\n        ",340],")",";",["T_WHITESPACE","\n      ",341],"}",["T_WHITESPACE","\n      ",342],["T_ELSEIF","elseif",343],["T_WHITESPACE"," ",343],"(",["T_ISSET","isset",343],"(",["T_VARIABLE","$specification",343],"[",["T_CONSTANT_ENCAPSED_STRING","'initial_from_field'",343],"]",")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n        ",343],["T_COMMENT","\/\/ If we have a initial value, copy it over.\n",344],["T_WHITESPACE","        ",345],["T_VARIABLE","$mapping",345],"[",["T_VARIABLE","$field",345],"]",["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_ARRAY","array",345],"(",["T_WHITESPACE","\n          ",345],["T_CONSTANT_ENCAPSED_STRING","'expression'",346],["T_WHITESPACE"," ",346],["T_DOUBLE_ARROW","=>",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$specification",346],"[",["T_CONSTANT_ENCAPSED_STRING","'initial_from_field'",346],"]",",",["T_WHITESPACE","\n          ",346],["T_CONSTANT_ENCAPSED_STRING","'arguments'",347],["T_WHITESPACE"," ",347],["T_DOUBLE_ARROW","=>",347],["T_WHITESPACE"," ",347],"[","]",",",["T_WHITESPACE","\n        ",347],")",";",["T_WHITESPACE","\n      ",348],"}",["T_WHITESPACE","\n      ",349],["T_ELSE","else",350],["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n        ",350],["T_COMMENT","\/\/ Else use the default of the field.\n",351],["T_WHITESPACE","        ",352],["T_VARIABLE","$mapping",352],"[",["T_VARIABLE","$field",352],"]",["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_STRING","NULL",352],";",["T_WHITESPACE","\n      ",352],"}",["T_WHITESPACE","\n\n      ",353],["T_COMMENT","\/\/ Add the new indexes.\n",355],["T_WHITESPACE","      ",356],["T_VARIABLE","$new_schema",356],["T_WHITESPACE"," ",356],["T_PLUS_EQUAL","+=",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$keys_new",356],";",["T_WHITESPACE","\n\n      ",356],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","alterTable",358],"(",["T_VARIABLE","$table",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$old_schema",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$new_schema",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$mapping",358],")",";",["T_WHITESPACE","\n    ",358],"}",["T_WHITESPACE","\n  ",359],"}",["T_WHITESPACE","\n\n  ",360],["T_DOC_COMMENT","\/**\n   * Create a table with a new schema containing the old content.\n   *\n   * As SQLite does not support ALTER TABLE (with a few exceptions) it is\n   * necessary to create a new table and copy over the old content.\n   *\n   * @param $table\n   *   Name of the table to be altered.\n   * @param $old_schema\n   *   The old schema array for the table.\n   * @param $new_schema\n   *   The new schema array for the table.\n   * @param $mapping\n   *   An optional mapping between the fields of the old specification and the\n   *   fields of the new specification. An associative array, whose keys are\n   *   the fields of the new table, and values can take two possible forms:\n   *     - a simple string, which is interpreted as the name of a field of the\n   *       old table,\n   *     - an associative array with two keys 'expression' and 'arguments',\n   *       that will be used as an expression field.\n   *\/",362],["T_WHITESPACE","\n  ",382],["T_PROTECTED","protected",383],["T_WHITESPACE"," ",383],["T_FUNCTION","function",383],["T_WHITESPACE"," ",383],["T_STRING","alterTable",383],"(",["T_VARIABLE","$table",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$old_schema",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$new_schema",383],",",["T_WHITESPACE"," ",383],["T_ARRAY","array",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$mapping",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_ARRAY","array",383],"(",")",")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n    ",383],["T_VARIABLE","$i",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_LNUMBER","0",384],";",["T_WHITESPACE","\n    ",384],["T_DO","do",385],["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n      ",385],["T_VARIABLE","$new_table",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_VARIABLE","$table",386],["T_WHITESPACE"," ",386],".",["T_WHITESPACE"," ",386],["T_CONSTANT_ENCAPSED_STRING","'_'",386],["T_WHITESPACE"," ",386],".",["T_WHITESPACE"," ",386],["T_VARIABLE","$i",386],["T_INC","++",386],";",["T_WHITESPACE","\n    ",386],"}",["T_WHITESPACE"," ",387],["T_WHILE","while",387],["T_WHITESPACE"," ",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","tableExists",387],"(",["T_VARIABLE","$new_table",387],")",")",";",["T_WHITESPACE","\n\n    ",387],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","createTable",389],"(",["T_VARIABLE","$new_table",389],",",["T_WHITESPACE"," ",389],["T_VARIABLE","$new_schema",389],")",";",["T_WHITESPACE","\n\n    ",389],["T_COMMENT","\/\/ Build a SQL query to migrate the data from the old table to the new.\n",391],["T_WHITESPACE","    ",392],["T_VARIABLE","$select",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","connection",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","select",392],"(",["T_VARIABLE","$table",392],")",";",["T_WHITESPACE","\n\n    ",392],["T_COMMENT","\/\/ Complete the mapping.\n",394],["T_WHITESPACE","    ",395],["T_VARIABLE","$possible_keys",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_STRING","array_keys",395],"(",["T_VARIABLE","$new_schema",395],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",395],"]",")",";",["T_WHITESPACE","\n    ",395],["T_VARIABLE","$mapping",396],["T_WHITESPACE"," ",396],["T_PLUS_EQUAL","+=",396],["T_WHITESPACE"," ",396],["T_STRING","array_combine",396],"(",["T_VARIABLE","$possible_keys",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$possible_keys",396],")",";",["T_WHITESPACE","\n\n    ",396],["T_COMMENT","\/\/ Now add the fields.\n",398],["T_WHITESPACE","    ",399],["T_FOREACH","foreach",399],["T_WHITESPACE"," ",399],"(",["T_VARIABLE","$mapping",399],["T_WHITESPACE"," ",399],["T_AS","as",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$field_alias",399],["T_WHITESPACE"," ",399],["T_DOUBLE_ARROW","=>",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$field_source",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n      ",399],["T_COMMENT","\/\/ Just ignore this field (ie. use it's default value).\n",400],["T_WHITESPACE","      ",401],["T_IF","if",401],["T_WHITESPACE"," ",401],"(","!",["T_ISSET","isset",401],"(",["T_VARIABLE","$field_source",401],")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n        ",401],["T_CONTINUE","continue",402],";",["T_WHITESPACE","\n      ",402],"}",["T_WHITESPACE","\n\n      ",403],["T_IF","if",405],["T_WHITESPACE"," ",405],"(",["T_STRING","is_array",405],"(",["T_VARIABLE","$field_source",405],")",")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$select",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","addExpression",406],"(",["T_VARIABLE","$field_source",406],"[",["T_CONSTANT_ENCAPSED_STRING","'expression'",406],"]",",",["T_WHITESPACE"," ",406],["T_VARIABLE","$field_alias",406],",",["T_WHITESPACE"," ",406],["T_VARIABLE","$field_source",406],"[",["T_CONSTANT_ENCAPSED_STRING","'arguments'",406],"]",")",";",["T_WHITESPACE","\n      ",406],"}",["T_WHITESPACE","\n      ",407],["T_ELSE","else",408],["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$select",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","addField",409],"(",["T_VARIABLE","$table",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$field_source",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$field_alias",409],")",";",["T_WHITESPACE","\n      ",409],"}",["T_WHITESPACE","\n    ",410],"}",["T_WHITESPACE","\n\n    ",411],["T_COMMENT","\/\/ Execute the data migration query.\n",413],["T_WHITESPACE","    ",414],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","connection",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","insert",414],"(",["T_VARIABLE","$new_table",414],")",["T_WHITESPACE","\n      ",414],["T_OBJECT_OPERATOR","->",415],["T_STRING","from",415],"(",["T_VARIABLE","$select",415],")",["T_WHITESPACE","\n      ",415],["T_OBJECT_OPERATOR","->",416],["T_STRING","execute",416],"(",")",";",["T_WHITESPACE","\n\n    ",416],["T_VARIABLE","$old_count",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","connection",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","query",418],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {'",418],["T_WHITESPACE"," ",418],".",["T_WHITESPACE"," ",418],["T_VARIABLE","$table",418],["T_WHITESPACE"," ",418],".",["T_WHITESPACE"," ",418],["T_CONSTANT_ENCAPSED_STRING","'}'",418],")",["T_OBJECT_OPERATOR","->",418],["T_STRING","fetchField",418],"(",")",";",["T_WHITESPACE","\n    ",418],["T_VARIABLE","$new_count",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","connection",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","query",419],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT COUNT(*) FROM {'",419],["T_WHITESPACE"," ",419],".",["T_WHITESPACE"," ",419],["T_VARIABLE","$new_table",419],["T_WHITESPACE"," ",419],".",["T_WHITESPACE"," ",419],["T_CONSTANT_ENCAPSED_STRING","'}'",419],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","fetchField",419],"(",")",";",["T_WHITESPACE","\n    ",419],["T_IF","if",420],["T_WHITESPACE"," ",420],"(",["T_VARIABLE","$old_count",420],["T_WHITESPACE"," ",420],["T_IS_EQUAL","==",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$new_count",420],")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n      ",420],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","dropTable",421],"(",["T_VARIABLE","$table",421],")",";",["T_WHITESPACE","\n      ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","renameTable",422],"(",["T_VARIABLE","$new_table",422],",",["T_WHITESPACE"," ",422],["T_VARIABLE","$table",422],")",";",["T_WHITESPACE","\n    ",422],"}",["T_WHITESPACE","\n  ",423],"}",["T_WHITESPACE","\n\n  ",424],["T_DOC_COMMENT","\/**\n   * Find out the schema of a table.\n   *\n   * This function uses introspection methods provided by the database to\n   * create a schema array. This is useful, for example, during update when\n   * the old schema is not available.\n   *\n   * @param $table\n   *   Name of the table.\n   *\n   * @return\n   *   An array representing the schema, from drupal_get_schema().\n   *\n   * @throws \\Exception\n   *   If a column of the table could not be parsed.\n   *\/",426],["T_WHITESPACE","\n  ",441],["T_PROTECTED","protected",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","introspectSchema",442],"(",["T_VARIABLE","$table",442],")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n    ",442],["T_VARIABLE","$mapped_fields",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_STRING","array_flip",443],"(",["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getFieldTypeMap",443],"(",")",")",";",["T_WHITESPACE","\n    ",443],["T_VARIABLE","$schema",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_ARRAY","array",444],"(",["T_WHITESPACE","\n      ",444],["T_CONSTANT_ENCAPSED_STRING","'fields'",445],["T_WHITESPACE"," ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_ARRAY","array",445],"(",")",",",["T_WHITESPACE","\n      ",445],["T_CONSTANT_ENCAPSED_STRING","'primary key'",446],["T_WHITESPACE"," ",446],["T_DOUBLE_ARROW","=>",446],["T_WHITESPACE"," ",446],["T_ARRAY","array",446],"(",")",",",["T_WHITESPACE","\n      ",446],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",447],["T_WHITESPACE"," ",447],["T_DOUBLE_ARROW","=>",447],["T_WHITESPACE"," ",447],["T_ARRAY","array",447],"(",")",",",["T_WHITESPACE","\n      ",447],["T_CONSTANT_ENCAPSED_STRING","'indexes'",448],["T_WHITESPACE"," ",448],["T_DOUBLE_ARROW","=>",448],["T_WHITESPACE"," ",448],["T_ARRAY","array",448],"(",")",",",["T_WHITESPACE","\n    ",448],")",";",["T_WHITESPACE","\n\n    ",449],["T_VARIABLE","$info",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getPrefixInfo",451],"(",["T_VARIABLE","$table",451],")",";",["T_WHITESPACE","\n    ",451],["T_VARIABLE","$result",452],["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","connection",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","query",452],"(",["T_CONSTANT_ENCAPSED_STRING","'PRAGMA '",452],["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_VARIABLE","$info",452],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",452],"]",["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'.table_info('",452],["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_VARIABLE","$info",452],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",452],"]",["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","')'",452],")",";",["T_WHITESPACE","\n    ",452],["T_FOREACH","foreach",453],["T_WHITESPACE"," ",453],"(",["T_VARIABLE","$result",453],["T_WHITESPACE"," ",453],["T_AS","as",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$row",453],")",["T_WHITESPACE"," ",453],"{",["T_WHITESPACE","\n      ",453],["T_IF","if",454],["T_WHITESPACE"," ",454],"(",["T_STRING","preg_match",454],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^([^(]+)\\((.*)\\)$\/'",454],",",["T_WHITESPACE"," ",454],["T_VARIABLE","$row",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","type",454],",",["T_WHITESPACE"," ",454],["T_VARIABLE","$matches",454],")",")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n        ",454],["T_VARIABLE","$type",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$matches",455],"[",["T_LNUMBER","1",455],"]",";",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$length",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_VARIABLE","$matches",456],"[",["T_LNUMBER","2",456],"]",";",["T_WHITESPACE","\n      ",456],"}",["T_WHITESPACE","\n      ",457],["T_ELSE","else",458],["T_WHITESPACE"," ",458],"{",["T_WHITESPACE","\n        ",458],["T_VARIABLE","$type",459],["T_WHITESPACE"," ",459],"=",["T_WHITESPACE"," ",459],["T_VARIABLE","$row",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","type",459],";",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$length",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_STRING","NULL",460],";",["T_WHITESPACE","\n      ",460],"}",["T_WHITESPACE","\n      ",461],["T_IF","if",462],["T_WHITESPACE"," ",462],"(",["T_ISSET","isset",462],"(",["T_VARIABLE","$mapped_fields",462],"[",["T_VARIABLE","$type",462],"]",")",")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n        ",462],["T_LIST","list",463],"(",["T_VARIABLE","$type",463],",",["T_WHITESPACE"," ",463],["T_VARIABLE","$size",463],")",["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_STRING","explode",463],"(",["T_CONSTANT_ENCAPSED_STRING","':'",463],",",["T_WHITESPACE"," ",463],["T_VARIABLE","$mapped_fields",463],"[",["T_VARIABLE","$type",463],"]",")",";",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$schema",464],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",464],"]","[",["T_VARIABLE","$row",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","name",464],"]",["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_ARRAY","array",464],"(",["T_WHITESPACE","\n          ",464],["T_CONSTANT_ENCAPSED_STRING","'type'",465],["T_WHITESPACE"," ",465],["T_DOUBLE_ARROW","=>",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$type",465],",",["T_WHITESPACE","\n          ",465],["T_CONSTANT_ENCAPSED_STRING","'size'",466],["T_WHITESPACE"," ",466],["T_DOUBLE_ARROW","=>",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$size",466],",",["T_WHITESPACE","\n          ",466],["T_CONSTANT_ENCAPSED_STRING","'not null'",467],["T_WHITESPACE"," ",467],["T_DOUBLE_ARROW","=>",467],["T_WHITESPACE"," ",467],"!",["T_EMPTY","empty",467],"(",["T_VARIABLE","$row",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","notnull",467],")",",",["T_WHITESPACE","\n          ",467],["T_CONSTANT_ENCAPSED_STRING","'default'",468],["T_WHITESPACE"," ",468],["T_DOUBLE_ARROW","=>",468],["T_WHITESPACE"," ",468],["T_STRING","trim",468],"(",["T_VARIABLE","$row",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","dflt_value",468],",",["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","\"'\"",468],")",",",["T_WHITESPACE","\n        ",468],")",";",["T_WHITESPACE","\n        ",469],["T_IF","if",470],["T_WHITESPACE"," ",470],"(",["T_VARIABLE","$length",470],")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n          ",470],["T_VARIABLE","$schema",471],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",471],"]","[",["T_VARIABLE","$row",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","name",471],"]","[",["T_CONSTANT_ENCAPSED_STRING","'length'",471],"]",["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_VARIABLE","$length",471],";",["T_WHITESPACE","\n        ",471],"}",["T_WHITESPACE","\n        ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(",["T_VARIABLE","$row",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","pk",473],")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n          ",473],["T_VARIABLE","$schema",474],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",474],"]","[","]",["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_VARIABLE","$row",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","name",474],";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE","\n      ",475],"}",["T_WHITESPACE","\n      ",476],["T_ELSE","else",477],["T_WHITESPACE"," ",477],"{",["T_WHITESPACE","\n        ",477],["T_THROW","throw",478],["T_WHITESPACE"," ",478],["T_NEW","new",478],["T_WHITESPACE"," ",478],["T_NS_SEPARATOR","\\",478],["T_STRING","Exception",478],"(",["T_CONSTANT_ENCAPSED_STRING","\"Unable to parse the column type \"",478],["T_WHITESPACE"," ",478],".",["T_WHITESPACE"," ",478],["T_VARIABLE","$row",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","type",478],")",";",["T_WHITESPACE","\n      ",478],"}",["T_WHITESPACE","\n    ",479],"}",["T_WHITESPACE","\n    ",480],["T_VARIABLE","$indexes",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_ARRAY","array",481],"(",")",";",["T_WHITESPACE","\n    ",481],["T_VARIABLE","$result",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","connection",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","query",482],"(",["T_CONSTANT_ENCAPSED_STRING","'PRAGMA '",482],["T_WHITESPACE"," ",482],".",["T_WHITESPACE"," ",482],["T_VARIABLE","$info",482],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",482],"]",["T_WHITESPACE"," ",482],".",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'.index_list('",482],["T_WHITESPACE"," ",482],".",["T_WHITESPACE"," ",482],["T_VARIABLE","$info",482],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",482],"]",["T_WHITESPACE"," ",482],".",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","')'",482],")",";",["T_WHITESPACE","\n    ",482],["T_FOREACH","foreach",483],["T_WHITESPACE"," ",483],"(",["T_VARIABLE","$result",483],["T_WHITESPACE"," ",483],["T_AS","as",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$row",483],")",["T_WHITESPACE"," ",483],"{",["T_WHITESPACE","\n      ",483],["T_IF","if",484],["T_WHITESPACE"," ",484],"(",["T_STRING","strpos",484],"(",["T_VARIABLE","$row",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","name",484],",",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","'sqlite_autoindex_'",484],")",["T_WHITESPACE"," ",484],["T_IS_NOT_IDENTICAL","!==",484],["T_WHITESPACE"," ",484],["T_LNUMBER","0",484],")",["T_WHITESPACE"," ",484],"{",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$indexes",485],"[","]",["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_ARRAY","array",485],"(",["T_WHITESPACE","\n          ",485],["T_CONSTANT_ENCAPSED_STRING","'schema_key'",486],["T_WHITESPACE"," ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$row",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","unique",486],["T_WHITESPACE"," ",486],"?",["T_WHITESPACE"," ",486],["T_CONSTANT_ENCAPSED_STRING","'unique keys'",486],["T_WHITESPACE"," ",486],":",["T_WHITESPACE"," ",486],["T_CONSTANT_ENCAPSED_STRING","'indexes'",486],",",["T_WHITESPACE","\n          ",486],["T_CONSTANT_ENCAPSED_STRING","'name'",487],["T_WHITESPACE"," ",487],["T_DOUBLE_ARROW","=>",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$row",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","name",487],",",["T_WHITESPACE","\n        ",487],")",";",["T_WHITESPACE","\n      ",488],"}",["T_WHITESPACE","\n    ",489],"}",["T_WHITESPACE","\n    ",490],["T_FOREACH","foreach",491],["T_WHITESPACE"," ",491],"(",["T_VARIABLE","$indexes",491],["T_WHITESPACE"," ",491],["T_AS","as",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$index",491],")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n      ",491],["T_VARIABLE","$name",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$index",492],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",492],"]",";",["T_WHITESPACE","\n      ",492],["T_COMMENT","\/\/ Get index name without prefix.\n",493],["T_WHITESPACE","      ",494],["T_VARIABLE","$index_name",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_STRING","substr",494],"(",["T_VARIABLE","$name",494],",",["T_WHITESPACE"," ",494],["T_STRING","strlen",494],"(",["T_VARIABLE","$info",494],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",494],"]",")",["T_WHITESPACE"," ",494],"+",["T_WHITESPACE"," ",494],["T_LNUMBER","1",494],")",";",["T_WHITESPACE","\n      ",494],["T_VARIABLE","$result",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","connection",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","query",495],"(",["T_CONSTANT_ENCAPSED_STRING","'PRAGMA '",495],["T_WHITESPACE"," ",495],".",["T_WHITESPACE"," ",495],["T_VARIABLE","$info",495],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",495],"]",["T_WHITESPACE"," ",495],".",["T_WHITESPACE"," ",495],["T_CONSTANT_ENCAPSED_STRING","'.index_info('",495],["T_WHITESPACE"," ",495],".",["T_WHITESPACE"," ",495],["T_VARIABLE","$name",495],["T_WHITESPACE"," ",495],".",["T_WHITESPACE"," ",495],["T_CONSTANT_ENCAPSED_STRING","')'",495],")",";",["T_WHITESPACE","\n      ",495],["T_FOREACH","foreach",496],["T_WHITESPACE"," ",496],"(",["T_VARIABLE","$result",496],["T_WHITESPACE"," ",496],["T_AS","as",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$row",496],")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n        ",496],["T_VARIABLE","$schema",497],"[",["T_VARIABLE","$index",497],"[",["T_CONSTANT_ENCAPSED_STRING","'schema_key'",497],"]","]","[",["T_VARIABLE","$index_name",497],"]","[","]",["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$row",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","name",497],";",["T_WHITESPACE","\n      ",497],"}",["T_WHITESPACE","\n    ",498],"}",["T_WHITESPACE","\n    ",499],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$schema",500],";",["T_WHITESPACE","\n  ",500],"}",["T_WHITESPACE","\n\n  ",501],["T_PUBLIC","public",503],["T_WHITESPACE"," ",503],["T_FUNCTION","function",503],["T_WHITESPACE"," ",503],["T_STRING","dropField",503],"(",["T_VARIABLE","$table",503],",",["T_WHITESPACE"," ",503],["T_VARIABLE","$field",503],")",["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n    ",503],["T_IF","if",504],["T_WHITESPACE"," ",504],"(","!",["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","fieldExists",504],"(",["T_VARIABLE","$table",504],",",["T_WHITESPACE"," ",504],["T_VARIABLE","$field",504],")",")",["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n      ",504],["T_RETURN","return",505],["T_WHITESPACE"," ",505],["T_STRING","FALSE",505],";",["T_WHITESPACE","\n    ",505],"}",["T_WHITESPACE","\n\n    ",506],["T_VARIABLE","$old_schema",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","introspectSchema",508],"(",["T_VARIABLE","$table",508],")",";",["T_WHITESPACE","\n    ",508],["T_VARIABLE","$new_schema",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$old_schema",509],";",["T_WHITESPACE","\n\n    ",509],["T_UNSET","unset",511],"(",["T_VARIABLE","$new_schema",511],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",511],"]","[",["T_VARIABLE","$field",511],"]",")",";",["T_WHITESPACE","\n\n    ",511],["T_COMMENT","\/\/ Handle possible primary key changes.\n",513],["T_WHITESPACE","    ",514],["T_IF","if",514],["T_WHITESPACE"," ",514],"(",["T_ISSET","isset",514],"(",["T_VARIABLE","$new_schema",514],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",514],"]",")",["T_WHITESPACE"," ",514],["T_BOOLEAN_AND","&&",514],["T_WHITESPACE"," ",514],"(",["T_VARIABLE","$key",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_STRING","array_search",514],"(",["T_VARIABLE","$field",514],",",["T_WHITESPACE"," ",514],["T_VARIABLE","$new_schema",514],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",514],"]",")",")",["T_WHITESPACE"," ",514],["T_IS_NOT_IDENTICAL","!==",514],["T_WHITESPACE"," ",514],["T_STRING","FALSE",514],")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n      ",514],["T_UNSET","unset",515],"(",["T_VARIABLE","$new_schema",515],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",515],"]","[",["T_VARIABLE","$key",515],"]",")",";",["T_WHITESPACE","\n    ",515],"}",["T_WHITESPACE","\n\n    ",516],["T_COMMENT","\/\/ Handle possible index changes.\n",518],["T_WHITESPACE","    ",519],["T_FOREACH","foreach",519],["T_WHITESPACE"," ",519],"(",["T_VARIABLE","$new_schema",519],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",519],"]",["T_WHITESPACE"," ",519],["T_AS","as",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$index",519],["T_WHITESPACE"," ",519],["T_DOUBLE_ARROW","=>",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$fields",519],")",["T_WHITESPACE"," ",519],"{",["T_WHITESPACE","\n      ",519],["T_FOREACH","foreach",520],["T_WHITESPACE"," ",520],"(",["T_VARIABLE","$fields",520],["T_WHITESPACE"," ",520],["T_AS","as",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$key",520],["T_WHITESPACE"," ",520],["T_DOUBLE_ARROW","=>",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$field_name",520],")",["T_WHITESPACE"," ",520],"{",["T_WHITESPACE","\n        ",520],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$field_name",521],["T_WHITESPACE"," ",521],["T_IS_EQUAL","==",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$field",521],")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n          ",521],["T_UNSET","unset",522],"(",["T_VARIABLE","$new_schema",522],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",522],"]","[",["T_VARIABLE","$index",522],"]","[",["T_VARIABLE","$key",522],"]",")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE","\n      ",523],"}",["T_WHITESPACE","\n      ",524],["T_COMMENT","\/\/ If this index has no more fields then remove it.\n",525],["T_WHITESPACE","      ",526],["T_IF","if",526],["T_WHITESPACE"," ",526],"(",["T_EMPTY","empty",526],"(",["T_VARIABLE","$new_schema",526],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",526],"]","[",["T_VARIABLE","$index",526],"]",")",")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n        ",526],["T_UNSET","unset",527],"(",["T_VARIABLE","$new_schema",527],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",527],"]","[",["T_VARIABLE","$index",527],"]",")",";",["T_WHITESPACE","\n      ",527],"}",["T_WHITESPACE","\n    ",528],"}",["T_WHITESPACE","\n    ",529],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","alterTable",530],"(",["T_VARIABLE","$table",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$old_schema",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$new_schema",530],")",";",["T_WHITESPACE","\n    ",530],["T_RETURN","return",531],["T_WHITESPACE"," ",531],["T_STRING","TRUE",531],";",["T_WHITESPACE","\n  ",531],"}",["T_WHITESPACE","\n\n  ",532],["T_PUBLIC","public",534],["T_WHITESPACE"," ",534],["T_FUNCTION","function",534],["T_WHITESPACE"," ",534],["T_STRING","changeField",534],"(",["T_VARIABLE","$table",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$field",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$field_new",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$spec",534],",",["T_WHITESPACE"," ",534],["T_VARIABLE","$keys_new",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_ARRAY","array",534],"(",")",")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n    ",534],["T_IF","if",535],["T_WHITESPACE"," ",535],"(","!",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","fieldExists",535],"(",["T_VARIABLE","$table",535],",",["T_WHITESPACE"," ",535],["T_VARIABLE","$field",535],")",")",["T_WHITESPACE"," ",535],"{",["T_WHITESPACE","\n      ",535],["T_THROW","throw",536],["T_WHITESPACE"," ",536],["T_NEW","new",536],["T_WHITESPACE"," ",536],["T_STRING","SchemaObjectDoesNotExistException",536],"(",["T_STRING","t",536],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot change the definition of field @table.@name: field doesn't exist.\"",536],",",["T_WHITESPACE"," ",536],["T_ARRAY","array",536],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",536],["T_WHITESPACE"," ",536],["T_DOUBLE_ARROW","=>",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$table",536],",",["T_WHITESPACE"," ",536],["T_CONSTANT_ENCAPSED_STRING","'@name'",536],["T_WHITESPACE"," ",536],["T_DOUBLE_ARROW","=>",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$field",536],")",")",")",";",["T_WHITESPACE","\n    ",536],"}",["T_WHITESPACE","\n    ",537],["T_IF","if",538],["T_WHITESPACE"," ",538],"(","(",["T_VARIABLE","$field",538],["T_WHITESPACE"," ",538],["T_IS_NOT_EQUAL","!=",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$field_new",538],")",["T_WHITESPACE"," ",538],["T_BOOLEAN_AND","&&",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","fieldExists",538],"(",["T_VARIABLE","$table",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$field_new",538],")",")",["T_WHITESPACE"," ",538],"{",["T_WHITESPACE","\n      ",538],["T_THROW","throw",539],["T_WHITESPACE"," ",539],["T_NEW","new",539],["T_WHITESPACE"," ",539],["T_STRING","SchemaObjectExistsException",539],"(",["T_STRING","t",539],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot rename field @table.@name to @name_new: target field already exists.\"",539],",",["T_WHITESPACE"," ",539],["T_ARRAY","array",539],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$table",539],",",["T_WHITESPACE"," ",539],["T_CONSTANT_ENCAPSED_STRING","'@name'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$field",539],",",["T_WHITESPACE"," ",539],["T_CONSTANT_ENCAPSED_STRING","'@name_new'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$field_new",539],")",")",")",";",["T_WHITESPACE","\n    ",539],"}",["T_WHITESPACE","\n\n    ",540],["T_VARIABLE","$old_schema",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","introspectSchema",542],"(",["T_VARIABLE","$table",542],")",";",["T_WHITESPACE","\n    ",542],["T_VARIABLE","$new_schema",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$old_schema",543],";",["T_WHITESPACE","\n\n    ",543],["T_COMMENT","\/\/ Map the old field to the new field.\n",545],["T_WHITESPACE","    ",546],["T_IF","if",546],["T_WHITESPACE"," ",546],"(",["T_VARIABLE","$field",546],["T_WHITESPACE"," ",546],["T_IS_NOT_EQUAL","!=",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$field_new",546],")",["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n      ",546],["T_VARIABLE","$mapping",547],"[",["T_VARIABLE","$field_new",547],"]",["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_VARIABLE","$field",547],";",["T_WHITESPACE","\n    ",547],"}",["T_WHITESPACE","\n    ",548],["T_ELSE","else",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n      ",549],["T_VARIABLE","$mapping",550],["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_ARRAY","array",550],"(",")",";",["T_WHITESPACE","\n    ",550],"}",["T_WHITESPACE","\n\n    ",551],["T_COMMENT","\/\/ Remove the previous definition and swap in the new one.\n",553],["T_WHITESPACE","    ",554],["T_UNSET","unset",554],"(",["T_VARIABLE","$new_schema",554],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",554],"]","[",["T_VARIABLE","$field",554],"]",")",";",["T_WHITESPACE","\n    ",554],["T_VARIABLE","$new_schema",555],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",555],"]","[",["T_VARIABLE","$field_new",555],"]",["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_VARIABLE","$spec",555],";",["T_WHITESPACE","\n\n    ",555],["T_COMMENT","\/\/ Map the former indexes to the new column name.\n",557],["T_WHITESPACE","    ",558],["T_VARIABLE","$new_schema",558],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",558],"]",["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","mapKeyDefinition",558],"(",["T_VARIABLE","$new_schema",558],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",558],"]",",",["T_WHITESPACE"," ",558],["T_VARIABLE","$mapping",558],")",";",["T_WHITESPACE","\n    ",558],["T_FOREACH","foreach",559],["T_WHITESPACE"," ",559],"(",["T_ARRAY","array",559],"(",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",559],",",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","'indexes'",559],")",["T_WHITESPACE"," ",559],["T_AS","as",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$k",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n      ",559],["T_FOREACH","foreach",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$new_schema",560],"[",["T_VARIABLE","$k",560],"]",["T_WHITESPACE"," ",560],["T_AS","as",560],["T_WHITESPACE"," ",560],"&",["T_VARIABLE","$key_definition",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n        ",560],["T_VARIABLE","$key_definition",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_VARIABLE","$this",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","mapKeyDefinition",561],"(",["T_VARIABLE","$key_definition",561],",",["T_WHITESPACE"," ",561],["T_VARIABLE","$mapping",561],")",";",["T_WHITESPACE","\n      ",561],"}",["T_WHITESPACE","\n    ",562],"}",["T_WHITESPACE","\n\n    ",563],["T_COMMENT","\/\/ Add in the keys from $keys_new.\n",565],["T_WHITESPACE","    ",566],["T_IF","if",566],["T_WHITESPACE"," ",566],"(",["T_ISSET","isset",566],"(",["T_VARIABLE","$keys_new",566],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",566],"]",")",")",["T_WHITESPACE"," ",566],"{",["T_WHITESPACE","\n      ",566],["T_VARIABLE","$new_schema",567],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",567],"]",["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$keys_new",567],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",567],"]",";",["T_WHITESPACE","\n    ",567],"}",["T_WHITESPACE","\n    ",568],["T_FOREACH","foreach",569],["T_WHITESPACE"," ",569],"(",["T_ARRAY","array",569],"(",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",569],",",["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'indexes'",569],")",["T_WHITESPACE"," ",569],["T_AS","as",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$k",569],")",["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n      ",569],["T_IF","if",570],["T_WHITESPACE"," ",570],"(","!",["T_EMPTY","empty",570],"(",["T_VARIABLE","$keys_new",570],"[",["T_VARIABLE","$k",570],"]",")",")",["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n        ",570],["T_VARIABLE","$new_schema",571],"[",["T_VARIABLE","$k",571],"]",["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$keys_new",571],"[",["T_VARIABLE","$k",571],"]",["T_WHITESPACE"," ",571],"+",["T_WHITESPACE"," ",571],["T_VARIABLE","$new_schema",571],"[",["T_VARIABLE","$k",571],"]",";",["T_WHITESPACE","\n      ",571],"}",["T_WHITESPACE","\n    ",572],"}",["T_WHITESPACE","\n\n    ",573],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","alterTable",575],"(",["T_VARIABLE","$table",575],",",["T_WHITESPACE"," ",575],["T_VARIABLE","$old_schema",575],",",["T_WHITESPACE"," ",575],["T_VARIABLE","$new_schema",575],",",["T_WHITESPACE"," ",575],["T_VARIABLE","$mapping",575],")",";",["T_WHITESPACE","\n  ",575],"}",["T_WHITESPACE","\n\n  ",576],["T_DOC_COMMENT","\/**\n   * Utility method: rename columns in an index definition according to a new mapping.\n   *\n   * @param $key_definition\n   *   The key definition.\n   * @param $mapping\n   *   The new mapping.\n   *\/",578],["T_WHITESPACE","\n  ",585],["T_PROTECTED","protected",586],["T_WHITESPACE"," ",586],["T_FUNCTION","function",586],["T_WHITESPACE"," ",586],["T_STRING","mapKeyDefinition",586],"(",["T_ARRAY","array",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$key_definition",586],",",["T_WHITESPACE"," ",586],["T_ARRAY","array",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$mapping",586],")",["T_WHITESPACE"," ",586],"{",["T_WHITESPACE","\n    ",586],["T_FOREACH","foreach",587],["T_WHITESPACE"," ",587],"(",["T_VARIABLE","$key_definition",587],["T_WHITESPACE"," ",587],["T_AS","as",587],["T_WHITESPACE"," ",587],"&",["T_VARIABLE","$field",587],")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n      ",587],["T_COMMENT","\/\/ The key definition can be an array($field, $length).\n",588],["T_WHITESPACE","      ",589],["T_IF","if",589],["T_WHITESPACE"," ",589],"(",["T_STRING","is_array",589],"(",["T_VARIABLE","$field",589],")",")",["T_WHITESPACE"," ",589],"{",["T_WHITESPACE","\n        ",589],["T_VARIABLE","$field",590],["T_WHITESPACE"," ",590],"=",["T_WHITESPACE"," ",590],"&",["T_VARIABLE","$field",590],"[",["T_LNUMBER","0",590],"]",";",["T_WHITESPACE","\n      ",590],"}",["T_WHITESPACE","\n      ",591],["T_IF","if",592],["T_WHITESPACE"," ",592],"(",["T_ISSET","isset",592],"(",["T_VARIABLE","$mapping",592],"[",["T_VARIABLE","$field",592],"]",")",")",["T_WHITESPACE"," ",592],"{",["T_WHITESPACE","\n        ",592],["T_VARIABLE","$field",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_VARIABLE","$mapping",593],"[",["T_VARIABLE","$field",593],"]",";",["T_WHITESPACE","\n      ",593],"}",["T_WHITESPACE","\n    ",594],"}",["T_WHITESPACE","\n    ",595],["T_RETURN","return",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$key_definition",596],";",["T_WHITESPACE","\n  ",596],"}",["T_WHITESPACE","\n\n  ",597],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",599],["T_WHITESPACE","\n  ",601],["T_PUBLIC","public",602],["T_WHITESPACE"," ",602],["T_FUNCTION","function",602],["T_WHITESPACE"," ",602],["T_STRING","addIndex",602],"(",["T_VARIABLE","$table",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$name",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$fields",602],",",["T_WHITESPACE"," ",602],["T_ARRAY","array",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$spec",602],")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n    ",602],["T_IF","if",603],["T_WHITESPACE"," ",603],"(","!",["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","tableExists",603],"(",["T_VARIABLE","$table",603],")",")",["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n      ",603],["T_THROW","throw",604],["T_WHITESPACE"," ",604],["T_NEW","new",604],["T_WHITESPACE"," ",604],["T_STRING","SchemaObjectDoesNotExistException",604],"(",["T_STRING","t",604],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add index @name to table @table: table doesn't exist.\"",604],",",["T_WHITESPACE"," ",604],["T_ARRAY","array",604],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",604],["T_WHITESPACE"," ",604],["T_DOUBLE_ARROW","=>",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$table",604],",",["T_WHITESPACE"," ",604],["T_CONSTANT_ENCAPSED_STRING","'@name'",604],["T_WHITESPACE"," ",604],["T_DOUBLE_ARROW","=>",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$name",604],")",")",")",";",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n    ",605],["T_IF","if",606],["T_WHITESPACE"," ",606],"(",["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","indexExists",606],"(",["T_VARIABLE","$table",606],",",["T_WHITESPACE"," ",606],["T_VARIABLE","$name",606],")",")",["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n      ",606],["T_THROW","throw",607],["T_WHITESPACE"," ",607],["T_NEW","new",607],["T_WHITESPACE"," ",607],["T_STRING","SchemaObjectExistsException",607],"(",["T_STRING","t",607],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add index @name to table @table: index already exists.\"",607],",",["T_WHITESPACE"," ",607],["T_ARRAY","array",607],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",607],["T_WHITESPACE"," ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$table",607],",",["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'@name'",607],["T_WHITESPACE"," ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$name",607],")",")",")",";",["T_WHITESPACE","\n    ",607],"}",["T_WHITESPACE","\n\n    ",608],["T_VARIABLE","$schema",610],"[",["T_CONSTANT_ENCAPSED_STRING","'indexes'",610],"]","[",["T_VARIABLE","$name",610],"]",["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],["T_VARIABLE","$fields",610],";",["T_WHITESPACE","\n    ",610],["T_VARIABLE","$statements",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","createIndexSql",611],"(",["T_VARIABLE","$table",611],",",["T_WHITESPACE"," ",611],["T_VARIABLE","$schema",611],")",";",["T_WHITESPACE","\n    ",611],["T_FOREACH","foreach",612],["T_WHITESPACE"," ",612],"(",["T_VARIABLE","$statements",612],["T_WHITESPACE"," ",612],["T_AS","as",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$statement",612],")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n      ",612],["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","connection",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","query",613],"(",["T_VARIABLE","$statement",613],")",";",["T_WHITESPACE","\n    ",613],"}",["T_WHITESPACE","\n  ",614],"}",["T_WHITESPACE","\n\n  ",615],["T_PUBLIC","public",617],["T_WHITESPACE"," ",617],["T_FUNCTION","function",617],["T_WHITESPACE"," ",617],["T_STRING","indexExists",617],"(",["T_VARIABLE","$table",617],",",["T_WHITESPACE"," ",617],["T_VARIABLE","$name",617],")",["T_WHITESPACE"," ",617],"{",["T_WHITESPACE","\n    ",617],["T_VARIABLE","$info",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getPrefixInfo",618],"(",["T_VARIABLE","$table",618],")",";",["T_WHITESPACE","\n\n    ",618],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","connection",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","query",620],"(",["T_CONSTANT_ENCAPSED_STRING","'PRAGMA '",620],["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_VARIABLE","$info",620],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",620],"]",["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","'.index_info('",620],["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_VARIABLE","$info",620],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",620],"]",["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","'_'",620],["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_VARIABLE","$name",620],["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","')'",620],")",["T_OBJECT_OPERATOR","->",620],["T_STRING","fetchField",620],"(",")",["T_WHITESPACE"," ",620],["T_IS_NOT_EQUAL","!=",620],["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","''",620],";",["T_WHITESPACE","\n  ",620],"}",["T_WHITESPACE","\n\n  ",621],["T_PUBLIC","public",623],["T_WHITESPACE"," ",623],["T_FUNCTION","function",623],["T_WHITESPACE"," ",623],["T_STRING","dropIndex",623],"(",["T_VARIABLE","$table",623],",",["T_WHITESPACE"," ",623],["T_VARIABLE","$name",623],")",["T_WHITESPACE"," ",623],"{",["T_WHITESPACE","\n    ",623],["T_IF","if",624],["T_WHITESPACE"," ",624],"(","!",["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","indexExists",624],"(",["T_VARIABLE","$table",624],",",["T_WHITESPACE"," ",624],["T_VARIABLE","$name",624],")",")",["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n      ",624],["T_RETURN","return",625],["T_WHITESPACE"," ",625],["T_STRING","FALSE",625],";",["T_WHITESPACE","\n    ",625],"}",["T_WHITESPACE","\n\n    ",626],["T_VARIABLE","$info",628],["T_WHITESPACE"," ",628],"=",["T_WHITESPACE"," ",628],["T_VARIABLE","$this",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getPrefixInfo",628],"(",["T_VARIABLE","$table",628],")",";",["T_WHITESPACE","\n\n    ",628],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","connection",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","query",630],"(",["T_CONSTANT_ENCAPSED_STRING","'DROP INDEX '",630],["T_WHITESPACE"," ",630],".",["T_WHITESPACE"," ",630],["T_VARIABLE","$info",630],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",630],"]",["T_WHITESPACE"," ",630],".",["T_WHITESPACE"," ",630],["T_CONSTANT_ENCAPSED_STRING","'.'",630],["T_WHITESPACE"," ",630],".",["T_WHITESPACE"," ",630],["T_VARIABLE","$info",630],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",630],"]",["T_WHITESPACE"," ",630],".",["T_WHITESPACE"," ",630],["T_CONSTANT_ENCAPSED_STRING","'_'",630],["T_WHITESPACE"," ",630],".",["T_WHITESPACE"," ",630],["T_VARIABLE","$name",630],")",";",["T_WHITESPACE","\n    ",630],["T_RETURN","return",631],["T_WHITESPACE"," ",631],["T_STRING","TRUE",631],";",["T_WHITESPACE","\n  ",631],"}",["T_WHITESPACE","\n\n  ",632],["T_PUBLIC","public",634],["T_WHITESPACE"," ",634],["T_FUNCTION","function",634],["T_WHITESPACE"," ",634],["T_STRING","addUniqueKey",634],"(",["T_VARIABLE","$table",634],",",["T_WHITESPACE"," ",634],["T_VARIABLE","$name",634],",",["T_WHITESPACE"," ",634],["T_VARIABLE","$fields",634],")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n    ",634],["T_IF","if",635],["T_WHITESPACE"," ",635],"(","!",["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","tableExists",635],"(",["T_VARIABLE","$table",635],")",")",["T_WHITESPACE"," ",635],"{",["T_WHITESPACE","\n      ",635],["T_THROW","throw",636],["T_WHITESPACE"," ",636],["T_NEW","new",636],["T_WHITESPACE"," ",636],["T_STRING","SchemaObjectDoesNotExistException",636],"(",["T_STRING","t",636],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add unique key @name to table @table: table doesn't exist.\"",636],",",["T_WHITESPACE"," ",636],["T_ARRAY","array",636],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",636],["T_WHITESPACE"," ",636],["T_DOUBLE_ARROW","=>",636],["T_WHITESPACE"," ",636],["T_VARIABLE","$table",636],",",["T_WHITESPACE"," ",636],["T_CONSTANT_ENCAPSED_STRING","'@name'",636],["T_WHITESPACE"," ",636],["T_DOUBLE_ARROW","=>",636],["T_WHITESPACE"," ",636],["T_VARIABLE","$name",636],")",")",")",";",["T_WHITESPACE","\n    ",636],"}",["T_WHITESPACE","\n    ",637],["T_IF","if",638],["T_WHITESPACE"," ",638],"(",["T_VARIABLE","$this",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","indexExists",638],"(",["T_VARIABLE","$table",638],",",["T_WHITESPACE"," ",638],["T_VARIABLE","$name",638],")",")",["T_WHITESPACE"," ",638],"{",["T_WHITESPACE","\n      ",638],["T_THROW","throw",639],["T_WHITESPACE"," ",639],["T_NEW","new",639],["T_WHITESPACE"," ",639],["T_STRING","SchemaObjectExistsException",639],"(",["T_STRING","t",639],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add unique key @name to table @table: unique key already exists.\"",639],",",["T_WHITESPACE"," ",639],["T_ARRAY","array",639],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",639],["T_WHITESPACE"," ",639],["T_DOUBLE_ARROW","=>",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$table",639],",",["T_WHITESPACE"," ",639],["T_CONSTANT_ENCAPSED_STRING","'@name'",639],["T_WHITESPACE"," ",639],["T_DOUBLE_ARROW","=>",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$name",639],")",")",")",";",["T_WHITESPACE","\n    ",639],"}",["T_WHITESPACE","\n\n    ",640],["T_VARIABLE","$schema",642],"[",["T_CONSTANT_ENCAPSED_STRING","'unique keys'",642],"]","[",["T_VARIABLE","$name",642],"]",["T_WHITESPACE"," ",642],"=",["T_WHITESPACE"," ",642],["T_VARIABLE","$fields",642],";",["T_WHITESPACE","\n    ",642],["T_VARIABLE","$statements",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","createIndexSql",643],"(",["T_VARIABLE","$table",643],",",["T_WHITESPACE"," ",643],["T_VARIABLE","$schema",643],")",";",["T_WHITESPACE","\n    ",643],["T_FOREACH","foreach",644],["T_WHITESPACE"," ",644],"(",["T_VARIABLE","$statements",644],["T_WHITESPACE"," ",644],["T_AS","as",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$statement",644],")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n      ",644],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","connection",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","query",645],"(",["T_VARIABLE","$statement",645],")",";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n  ",646],"}",["T_WHITESPACE","\n\n  ",647],["T_PUBLIC","public",649],["T_WHITESPACE"," ",649],["T_FUNCTION","function",649],["T_WHITESPACE"," ",649],["T_STRING","dropUniqueKey",649],"(",["T_VARIABLE","$table",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$name",649],")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n    ",649],["T_IF","if",650],["T_WHITESPACE"," ",650],"(","!",["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","indexExists",650],"(",["T_VARIABLE","$table",650],",",["T_WHITESPACE"," ",650],["T_VARIABLE","$name",650],")",")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n      ",650],["T_RETURN","return",651],["T_WHITESPACE"," ",651],["T_STRING","FALSE",651],";",["T_WHITESPACE","\n    ",651],"}",["T_WHITESPACE","\n\n    ",652],["T_VARIABLE","$info",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getPrefixInfo",654],"(",["T_VARIABLE","$table",654],")",";",["T_WHITESPACE","\n\n    ",654],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","connection",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","query",656],"(",["T_CONSTANT_ENCAPSED_STRING","'DROP INDEX '",656],["T_WHITESPACE"," ",656],".",["T_WHITESPACE"," ",656],["T_VARIABLE","$info",656],"[",["T_CONSTANT_ENCAPSED_STRING","'schema'",656],"]",["T_WHITESPACE"," ",656],".",["T_WHITESPACE"," ",656],["T_CONSTANT_ENCAPSED_STRING","'.'",656],["T_WHITESPACE"," ",656],".",["T_WHITESPACE"," ",656],["T_VARIABLE","$info",656],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",656],"]",["T_WHITESPACE"," ",656],".",["T_WHITESPACE"," ",656],["T_CONSTANT_ENCAPSED_STRING","'_'",656],["T_WHITESPACE"," ",656],".",["T_WHITESPACE"," ",656],["T_VARIABLE","$name",656],")",";",["T_WHITESPACE","\n    ",656],["T_RETURN","return",657],["T_WHITESPACE"," ",657],["T_STRING","TRUE",657],";",["T_WHITESPACE","\n  ",657],"}",["T_WHITESPACE","\n\n  ",658],["T_PUBLIC","public",660],["T_WHITESPACE"," ",660],["T_FUNCTION","function",660],["T_WHITESPACE"," ",660],["T_STRING","addPrimaryKey",660],"(",["T_VARIABLE","$table",660],",",["T_WHITESPACE"," ",660],["T_VARIABLE","$fields",660],")",["T_WHITESPACE"," ",660],"{",["T_WHITESPACE","\n    ",660],["T_IF","if",661],["T_WHITESPACE"," ",661],"(","!",["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","tableExists",661],"(",["T_VARIABLE","$table",661],")",")",["T_WHITESPACE"," ",661],"{",["T_WHITESPACE","\n      ",661],["T_THROW","throw",662],["T_WHITESPACE"," ",662],["T_NEW","new",662],["T_WHITESPACE"," ",662],["T_STRING","SchemaObjectDoesNotExistException",662],"(",["T_STRING","t",662],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add primary key to table @table: table doesn't exist.\"",662],",",["T_WHITESPACE"," ",662],["T_ARRAY","array",662],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",662],["T_WHITESPACE"," ",662],["T_DOUBLE_ARROW","=>",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$table",662],")",")",")",";",["T_WHITESPACE","\n    ",662],"}",["T_WHITESPACE","\n\n    ",663],["T_VARIABLE","$old_schema",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","introspectSchema",665],"(",["T_VARIABLE","$table",665],")",";",["T_WHITESPACE","\n    ",665],["T_VARIABLE","$new_schema",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_VARIABLE","$old_schema",666],";",["T_WHITESPACE","\n\n    ",666],["T_IF","if",668],["T_WHITESPACE"," ",668],"(","!",["T_EMPTY","empty",668],"(",["T_VARIABLE","$new_schema",668],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",668],"]",")",")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n      ",668],["T_THROW","throw",669],["T_WHITESPACE"," ",669],["T_NEW","new",669],["T_WHITESPACE"," ",669],["T_STRING","SchemaObjectExistsException",669],"(",["T_STRING","t",669],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot add primary key to table @table: primary key already exists.\"",669],",",["T_WHITESPACE"," ",669],["T_ARRAY","array",669],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",669],["T_WHITESPACE"," ",669],["T_DOUBLE_ARROW","=>",669],["T_WHITESPACE"," ",669],["T_VARIABLE","$table",669],")",")",")",";",["T_WHITESPACE","\n    ",669],"}",["T_WHITESPACE","\n\n    ",670],["T_VARIABLE","$new_schema",672],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",672],"]",["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_VARIABLE","$fields",672],";",["T_WHITESPACE","\n    ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","alterTable",673],"(",["T_VARIABLE","$table",673],",",["T_WHITESPACE"," ",673],["T_VARIABLE","$old_schema",673],",",["T_WHITESPACE"," ",673],["T_VARIABLE","$new_schema",673],")",";",["T_WHITESPACE","\n  ",673],"}",["T_WHITESPACE","\n\n  ",674],["T_PUBLIC","public",676],["T_WHITESPACE"," ",676],["T_FUNCTION","function",676],["T_WHITESPACE"," ",676],["T_STRING","dropPrimaryKey",676],"(",["T_VARIABLE","$table",676],")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n    ",676],["T_VARIABLE","$old_schema",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","introspectSchema",677],"(",["T_VARIABLE","$table",677],")",";",["T_WHITESPACE","\n    ",677],["T_VARIABLE","$new_schema",678],["T_WHITESPACE"," ",678],"=",["T_WHITESPACE"," ",678],["T_VARIABLE","$old_schema",678],";",["T_WHITESPACE","\n\n    ",678],["T_IF","if",680],["T_WHITESPACE"," ",680],"(",["T_EMPTY","empty",680],"(",["T_VARIABLE","$new_schema",680],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",680],"]",")",")",["T_WHITESPACE"," ",680],"{",["T_WHITESPACE","\n      ",680],["T_RETURN","return",681],["T_WHITESPACE"," ",681],["T_STRING","FALSE",681],";",["T_WHITESPACE","\n    ",681],"}",["T_WHITESPACE","\n\n    ",682],["T_UNSET","unset",684],"(",["T_VARIABLE","$new_schema",684],"[",["T_CONSTANT_ENCAPSED_STRING","'primary key'",684],"]",")",";",["T_WHITESPACE","\n    ",684],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","alterTable",685],"(",["T_VARIABLE","$table",685],",",["T_WHITESPACE"," ",685],["T_VARIABLE","$old_schema",685],",",["T_WHITESPACE"," ",685],["T_VARIABLE","$new_schema",685],")",";",["T_WHITESPACE","\n    ",685],["T_RETURN","return",686],["T_WHITESPACE"," ",686],["T_STRING","TRUE",686],";",["T_WHITESPACE","\n  ",686],"}",["T_WHITESPACE","\n\n  ",687],["T_PUBLIC","public",689],["T_WHITESPACE"," ",689],["T_FUNCTION","function",689],["T_WHITESPACE"," ",689],["T_STRING","fieldSetDefault",689],"(",["T_VARIABLE","$table",689],",",["T_WHITESPACE"," ",689],["T_VARIABLE","$field",689],",",["T_WHITESPACE"," ",689],["T_VARIABLE","$default",689],")",["T_WHITESPACE"," ",689],"{",["T_WHITESPACE","\n    ",689],["T_IF","if",690],["T_WHITESPACE"," ",690],"(","!",["T_VARIABLE","$this",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","fieldExists",690],"(",["T_VARIABLE","$table",690],",",["T_WHITESPACE"," ",690],["T_VARIABLE","$field",690],")",")",["T_WHITESPACE"," ",690],"{",["T_WHITESPACE","\n      ",690],["T_THROW","throw",691],["T_WHITESPACE"," ",691],["T_NEW","new",691],["T_WHITESPACE"," ",691],["T_STRING","SchemaObjectDoesNotExistException",691],"(",["T_STRING","t",691],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot set default value of field @table.@field: field doesn't exist.\"",691],",",["T_WHITESPACE"," ",691],["T_ARRAY","array",691],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",691],["T_WHITESPACE"," ",691],["T_DOUBLE_ARROW","=>",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$table",691],",",["T_WHITESPACE"," ",691],["T_CONSTANT_ENCAPSED_STRING","'@field'",691],["T_WHITESPACE"," ",691],["T_DOUBLE_ARROW","=>",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$field",691],")",")",")",";",["T_WHITESPACE","\n    ",691],"}",["T_WHITESPACE","\n\n    ",692],["T_VARIABLE","$old_schema",694],["T_WHITESPACE"," ",694],"=",["T_WHITESPACE"," ",694],["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","introspectSchema",694],"(",["T_VARIABLE","$table",694],")",";",["T_WHITESPACE","\n    ",694],["T_VARIABLE","$new_schema",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_VARIABLE","$old_schema",695],";",["T_WHITESPACE","\n\n    ",695],["T_VARIABLE","$new_schema",697],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",697],"]","[",["T_VARIABLE","$field",697],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default'",697],"]",["T_WHITESPACE"," ",697],"=",["T_WHITESPACE"," ",697],["T_VARIABLE","$default",697],";",["T_WHITESPACE","\n    ",697],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","alterTable",698],"(",["T_VARIABLE","$table",698],",",["T_WHITESPACE"," ",698],["T_VARIABLE","$old_schema",698],",",["T_WHITESPACE"," ",698],["T_VARIABLE","$new_schema",698],")",";",["T_WHITESPACE","\n  ",698],"}",["T_WHITESPACE","\n\n  ",699],["T_PUBLIC","public",701],["T_WHITESPACE"," ",701],["T_FUNCTION","function",701],["T_WHITESPACE"," ",701],["T_STRING","fieldSetNoDefault",701],"(",["T_VARIABLE","$table",701],",",["T_WHITESPACE"," ",701],["T_VARIABLE","$field",701],")",["T_WHITESPACE"," ",701],"{",["T_WHITESPACE","\n    ",701],["T_IF","if",702],["T_WHITESPACE"," ",702],"(","!",["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","fieldExists",702],"(",["T_VARIABLE","$table",702],",",["T_WHITESPACE"," ",702],["T_VARIABLE","$field",702],")",")",["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n      ",702],["T_THROW","throw",703],["T_WHITESPACE"," ",703],["T_NEW","new",703],["T_WHITESPACE"," ",703],["T_STRING","SchemaObjectDoesNotExistException",703],"(",["T_STRING","t",703],"(",["T_CONSTANT_ENCAPSED_STRING","\"Cannot remove default value of field @table.@field: field doesn't exist.\"",703],",",["T_WHITESPACE"," ",703],["T_ARRAY","array",703],"(",["T_CONSTANT_ENCAPSED_STRING","'@table'",703],["T_WHITESPACE"," ",703],["T_DOUBLE_ARROW","=>",703],["T_WHITESPACE"," ",703],["T_VARIABLE","$table",703],",",["T_WHITESPACE"," ",703],["T_CONSTANT_ENCAPSED_STRING","'@field'",703],["T_WHITESPACE"," ",703],["T_DOUBLE_ARROW","=>",703],["T_WHITESPACE"," ",703],["T_VARIABLE","$field",703],")",")",")",";",["T_WHITESPACE","\n    ",703],"}",["T_WHITESPACE","\n\n    ",704],["T_VARIABLE","$old_schema",706],["T_WHITESPACE"," ",706],"=",["T_WHITESPACE"," ",706],["T_VARIABLE","$this",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","introspectSchema",706],"(",["T_VARIABLE","$table",706],")",";",["T_WHITESPACE","\n    ",706],["T_VARIABLE","$new_schema",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_VARIABLE","$old_schema",707],";",["T_WHITESPACE","\n\n    ",707],["T_UNSET","unset",709],"(",["T_VARIABLE","$new_schema",709],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",709],"]","[",["T_VARIABLE","$field",709],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default'",709],"]",")",";",["T_WHITESPACE","\n    ",709],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","alterTable",710],"(",["T_VARIABLE","$table",710],",",["T_WHITESPACE"," ",710],["T_VARIABLE","$old_schema",710],",",["T_WHITESPACE"," ",710],["T_VARIABLE","$new_schema",710],")",";",["T_WHITESPACE","\n  ",710],"}",["T_WHITESPACE","\n\n  ",711],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",713],["T_WHITESPACE","\n  ",715],["T_PUBLIC","public",716],["T_WHITESPACE"," ",716],["T_FUNCTION","function",716],["T_WHITESPACE"," ",716],["T_STRING","findTables",716],"(",["T_VARIABLE","$table_expression",716],")",["T_WHITESPACE"," ",716],"{",["T_WHITESPACE","\n    ",716],["T_VARIABLE","$tables",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],"[","]",";",["T_WHITESPACE","\n\n    ",717],["T_COMMENT","\/\/ The SQLite implementation doesn't need to use the same filtering strategy\n",719],["T_WHITESPACE","    ",720],["T_COMMENT","\/\/ as the parent one because individually prefixed tables live in their own\n",720],["T_WHITESPACE","    ",721],["T_COMMENT","\/\/ schema (database), which means that neither the main database nor any\n",721],["T_WHITESPACE","    ",722],["T_COMMENT","\/\/ attached one will contain a prefixed table name, so we just need to loop\n",722],["T_WHITESPACE","    ",723],["T_COMMENT","\/\/ over all known schemas and filter by the user-supplied table expression.\n",723],["T_WHITESPACE","    ",724],["T_VARIABLE","$attached_dbs",724],["T_WHITESPACE"," ",724],"=",["T_WHITESPACE"," ",724],["T_VARIABLE","$this",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","connection",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","getAttachedDatabases",724],"(",")",";",["T_WHITESPACE","\n    ",724],["T_FOREACH","foreach",725],["T_WHITESPACE"," ",725],"(",["T_VARIABLE","$attached_dbs",725],["T_WHITESPACE"," ",725],["T_AS","as",725],["T_WHITESPACE"," ",725],["T_VARIABLE","$schema",725],")",["T_WHITESPACE"," ",725],"{",["T_WHITESPACE","\n      ",725],["T_COMMENT","\/\/ Can't use query placeholders for the schema because the query would\n",726],["T_WHITESPACE","      ",727],["T_COMMENT","\/\/ have to be :prefixsqlite_master, which does not work. We also need to\n",727],["T_WHITESPACE","      ",728],["T_COMMENT","\/\/ ignore the internal SQLite tables.\n",728],["T_WHITESPACE","      ",729],["T_VARIABLE","$result",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","connection",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","query",729],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT name FROM \"",729],["T_WHITESPACE"," ",729],".",["T_WHITESPACE"," ",729],["T_VARIABLE","$schema",729],["T_WHITESPACE"," ",729],".",["T_WHITESPACE"," ",729],["T_CONSTANT_ENCAPSED_STRING","\".sqlite_master WHERE type = :type AND name LIKE :table_name AND name NOT LIKE :pattern\"",729],",",["T_WHITESPACE"," ",729],["T_ARRAY","array",729],"(",["T_WHITESPACE","\n        ",729],["T_CONSTANT_ENCAPSED_STRING","':type'",730],["T_WHITESPACE"," ",730],["T_DOUBLE_ARROW","=>",730],["T_WHITESPACE"," ",730],["T_CONSTANT_ENCAPSED_STRING","'table'",730],",",["T_WHITESPACE","\n        ",730],["T_CONSTANT_ENCAPSED_STRING","':table_name'",731],["T_WHITESPACE"," ",731],["T_DOUBLE_ARROW","=>",731],["T_WHITESPACE"," ",731],["T_VARIABLE","$table_expression",731],",",["T_WHITESPACE","\n        ",731],["T_CONSTANT_ENCAPSED_STRING","':pattern'",732],["T_WHITESPACE"," ",732],["T_DOUBLE_ARROW","=>",732],["T_WHITESPACE"," ",732],["T_CONSTANT_ENCAPSED_STRING","'sqlite_%'",732],",",["T_WHITESPACE","\n      ",732],")",")",";",["T_WHITESPACE","\n      ",733],["T_VARIABLE","$tables",734],["T_WHITESPACE"," ",734],["T_PLUS_EQUAL","+=",734],["T_WHITESPACE"," ",734],["T_VARIABLE","$result",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","fetchAllKeyed",734],"(",["T_LNUMBER","0",734],",",["T_WHITESPACE"," ",734],["T_LNUMBER","0",734],")",";",["T_WHITESPACE","\n    ",734],"}",["T_WHITESPACE","\n\n    ",735],["T_RETURN","return",737],["T_WHITESPACE"," ",737],["T_VARIABLE","$tables",737],";",["T_WHITESPACE","\n  ",737],"}",["T_WHITESPACE","\n\n",738],"}",["T_WHITESPACE","\n",740]]