[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Access",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Session",5],["T_NS_SEPARATOR","\\",5],["T_STRING","AccountInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Session",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SessionConfigurationInterface",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Symfony",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Component",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Routing",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Route",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Symfony",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Component",8],["T_NS_SEPARATOR","\\",8],["T_STRING","HttpFoundation",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Request",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Access protection against CSRF attacks.\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","CsrfRequestHeaderAccessCheck",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_STRING","AccessCheckInterface",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * A string key that will used to designate the token used by this class.\n   *\/",15],["T_WHITESPACE","\n  ",17],["T_CONST","const",18],["T_WHITESPACE"," ",18],["T_STRING","TOKEN_KEY",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token request header'",18],";",["T_WHITESPACE","\n\n  ",18],["T_DOC_COMMENT","\/**\n   * The session configuration.\n   *\n   * @var \\Drupal\\Core\\Session\\SessionConfigurationInterface\n   *\/",20],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$sessionConfiguration",25],";",["T_WHITESPACE","\n\n  ",25],["T_DOC_COMMENT","\/**\n   * The token generator.\n   *\n   * @var \\Drupal\\Core\\Access\\CsrfTokenGenerator\n   *\/",27],["T_WHITESPACE","\n  ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$csrfToken",32],";",["T_WHITESPACE","\n\n  ",32],["T_DOC_COMMENT","\/**\n   * Constructs a new rest CSRF access check.\n   *\n   * @param \\Drupal\\Core\\Session\\SessionConfigurationInterface $session_configuration\n   *   The session configuration.\n   * @param \\Drupal\\Core\\Access\\CsrfTokenGenerator $csrf_token\n   *   The token generator.\n   *\/",34],["T_WHITESPACE","\n  ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","__construct",42],"(",["T_STRING","SessionConfigurationInterface",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$session_configuration",42],",",["T_WHITESPACE"," ",42],["T_STRING","CsrfTokenGenerator",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$csrf_token",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","sessionConfiguration",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$session_configuration",43],";",["T_WHITESPACE","\n    ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","csrfToken",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$csrf_token",44],";",["T_WHITESPACE","\n  ",44],"}",["T_WHITESPACE","\n\n  ",45],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",47],["T_WHITESPACE","\n  ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","applies",50],"(",["T_STRING","Route",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$route",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$requirements",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$route",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getRequirements",51],"(",")",";",["T_WHITESPACE","\n    ",51],["T_COMMENT","\/\/ Check for current requirement _csrf_request_header_token and deprecated\n",52],["T_WHITESPACE","    ",53],["T_COMMENT","\/\/ REST requirement.\n",53],["T_WHITESPACE","    ",54],["T_VARIABLE","$applicable_requirements",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],"[",["T_WHITESPACE","\n      ",54],["T_CONSTANT_ENCAPSED_STRING","'_csrf_request_header_token'",55],",",["T_WHITESPACE","\n      ",55],["T_COMMENT","\/\/ @todo Remove _access_rest_csrf in Drupal 9.0.0.\n",56],["T_WHITESPACE","      ",57],["T_CONSTANT_ENCAPSED_STRING","'_access_rest_csrf'",57],",",["T_WHITESPACE","\n    ",57],"]",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$requirement_keys",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","array_keys",59],"(",["T_VARIABLE","$requirements",59],")",";",["T_WHITESPACE","\n\n    ",59],["T_IF","if",61],["T_WHITESPACE"," ",61],"(",["T_STRING","array_intersect",61],"(",["T_VARIABLE","$applicable_requirements",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$requirement_keys",61],")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n      ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_ISSET","isset",62],"(",["T_VARIABLE","$requirements",62],"[",["T_CONSTANT_ENCAPSED_STRING","'_method'",62],"]",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n        ",62],["T_COMMENT","\/\/ There could be more than one method requirement separated with '|'.\n",63],["T_WHITESPACE","        ",64],["T_VARIABLE","$methods",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","explode",64],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$requirements",64],"[",["T_CONSTANT_ENCAPSED_STRING","'_method'",64],"]",")",";",["T_WHITESPACE","\n        ",64],["T_COMMENT","\/\/ CSRF protection only applies to write operations, so we can filter\n",65],["T_WHITESPACE","        ",66],["T_COMMENT","\/\/ out any routes that require reading methods only.\n",66],["T_WHITESPACE","        ",67],["T_VARIABLE","$write_methods",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","array_diff",67],"(",["T_VARIABLE","$methods",67],",",["T_WHITESPACE"," ",67],["T_ARRAY","array",67],"(",["T_CONSTANT_ENCAPSED_STRING","'GET'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'HEAD'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'OPTIONS'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'TRACE'",67],")",")",";",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_EMPTY","empty",68],"(",["T_VARIABLE","$write_methods",68],")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n          ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_STRING","FALSE",69],";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n      ",70],"}",["T_WHITESPACE","\n      ",71],["T_COMMENT","\/\/ No method requirement given, so we run this access check to be on the\n",72],["T_WHITESPACE","      ",73],["T_COMMENT","\/\/ safe side.\n",73],["T_WHITESPACE","      ",74],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_STRING","TRUE",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n  ",75],"}",["T_WHITESPACE","\n\n  ",76],["T_DOC_COMMENT","\/**\n   * Checks access.\n   *\n   * @param \\Symfony\\Component\\HttpFoundation\\Request $request\n   *   The request object.\n   * @param \\Drupal\\Core\\Session\\AccountInterface $account\n   *   The currently logged in account.\n   *\n   * @return \\Drupal\\Core\\Access\\AccessResultInterface\n   *   The access result.\n   *\/",78],["T_WHITESPACE","\n  ",88],["T_PUBLIC","public",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","access",89],"(",["T_STRING","Request",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$request",89],",",["T_WHITESPACE"," ",89],["T_STRING","AccountInterface",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$account",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$method",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$request",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getMethod",90],"(",")",";",["T_WHITESPACE","\n\n    ",90],["T_COMMENT","\/\/ This check only applies if\n",92],["T_WHITESPACE","    ",93],["T_COMMENT","\/\/ 1. this is a write operation\n",93],["T_WHITESPACE","    ",94],["T_COMMENT","\/\/ 2. the user was successfully authenticated and\n",94],["T_WHITESPACE","    ",95],["T_COMMENT","\/\/ 3. the request comes with a session cookie.\n",95],["T_WHITESPACE","    ",96],["T_IF","if",96],["T_WHITESPACE"," ",96],"(","!",["T_STRING","in_array",96],"(",["T_VARIABLE","$method",96],",",["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",["T_CONSTANT_ENCAPSED_STRING","'GET'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'HEAD'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'OPTIONS'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'TRACE'",96],")",")",["T_WHITESPACE","\n      ",96],["T_BOOLEAN_AND","&&",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$account",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","isAuthenticated",97],"(",")",["T_WHITESPACE","\n      ",97],["T_BOOLEAN_AND","&&",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","sessionConfiguration",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","hasSession",98],"(",["T_VARIABLE","$request",98],")",["T_WHITESPACE","\n    ",98],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n      ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_VARIABLE","$request",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","headers",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","has",100],"(",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",100],")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n        ",100],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_STRING","AccessResult",101],["T_DOUBLE_COLON","::",101],["T_STRING","forbidden",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","setReason",101],"(",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token request header is missing'",101],")",["T_OBJECT_OPERATOR","->",101],["T_STRING","setCacheMaxAge",101],"(",["T_LNUMBER","0",101],")",";",["T_WHITESPACE","\n      ",101],"}",["T_WHITESPACE","\n      ",102],["T_VARIABLE","$csrf_token",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$request",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","headers",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","get",103],"(",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",103],")",";",["T_WHITESPACE","\n      ",103],["T_COMMENT","\/\/ @todo Remove validate call using 'rest' in 8.3.\n",104],["T_WHITESPACE","      ",105],["T_COMMENT","\/\/   Kept here for sessions active during update.\n",105],["T_WHITESPACE","      ",106],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","csrfToken",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","validate",106],"(",["T_VARIABLE","$csrf_token",106],",",["T_WHITESPACE"," ",106],["T_STRING","self",106],["T_DOUBLE_COLON","::",106],["T_STRING","TOKEN_KEY",106],")",["T_WHITESPACE","\n        ",106],["T_BOOLEAN_AND","&&",107],["T_WHITESPACE"," ",107],"!",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","csrfToken",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","validate",107],"(",["T_VARIABLE","$csrf_token",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'rest'",107],")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_STRING","AccessResult",108],["T_DOUBLE_COLON","::",108],["T_STRING","forbidden",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","setReason",108],"(",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token request header is invalid'",108],")",["T_OBJECT_OPERATOR","->",108],["T_STRING","setCacheMaxAge",108],"(",["T_LNUMBER","0",108],")",";",["T_WHITESPACE","\n      ",108],"}",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n    ",110],["T_COMMENT","\/\/ Let other access checkers decide if the request is legit.\n",111],["T_WHITESPACE","    ",112],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_STRING","AccessResult",112],["T_DOUBLE_COLON","::",112],["T_STRING","allowed",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","setCacheMaxAge",112],"(",["T_LNUMBER","0",112],")",";",["T_WHITESPACE","\n  ",112],"}",["T_WHITESPACE","\n\n",113],"}",["T_WHITESPACE","\n",115]]