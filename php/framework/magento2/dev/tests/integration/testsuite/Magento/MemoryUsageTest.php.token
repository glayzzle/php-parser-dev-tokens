[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],";",["T_WHITESPACE","\n\n",6],["T_CLASS","class",8],["T_WHITESPACE"," ",8],["T_STRING","MemoryUsageTest",8],["T_WHITESPACE"," ",8],["T_EXTENDS","extends",8],["T_WHITESPACE"," ",8],["T_NS_SEPARATOR","\\",8],["T_STRING","PHPUnit_Framework_TestCase",8],["T_WHITESPACE","\n",8],"{",["T_WHITESPACE","\n    ",9],["T_DOC_COMMENT","\/**\n     * Number of application reinitialization iterations to be conducted by tests\n     *\/",10],["T_WHITESPACE","\n    ",12],["T_CONST","const",13],["T_WHITESPACE"," ",13],["T_STRING","APP_REINITIALIZATION_LOOPS",13],["T_WHITESPACE"," ",13],"=",["T_WHITESPACE"," ",13],["T_LNUMBER","20",13],";",["T_WHITESPACE","\n\n    ",13],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\TestFramework\\Helper\\Memory\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$_helper",18],";",["T_WHITESPACE","\n\n    ",18],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_FUNCTION","function",20],["T_WHITESPACE"," ",20],["T_STRING","setUp",20],"(",")",["T_WHITESPACE","\n    ",20],"{",["T_WHITESPACE","\n        ",21],["T_IF","if",22],["T_WHITESPACE"," ",22],"(",["T_STRING","defined",22],"(",["T_CONSTANT_ENCAPSED_STRING","'HHVM_VERSION'",22],")",")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n            ",22],["T_VARIABLE","$this",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","markTestSkipped",23],"(",["T_CONSTANT_ENCAPSED_STRING","\"Test not relevant because no gc in HHVM.\"",23],")",";",["T_WHITESPACE","\n        ",23],"}",["T_WHITESPACE","\n        ",24],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","_helper",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_NEW","new",25],["T_WHITESPACE"," ",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Magento",25],["T_NS_SEPARATOR","\\",25],["T_STRING","TestFramework",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Helper",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Memory",25],"(",["T_WHITESPACE","\n            ",25],["T_NEW","new",26],["T_WHITESPACE"," ",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Magento",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Framework",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Shell",26],"(",["T_NEW","new",26],["T_WHITESPACE"," ",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Magento",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Framework",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Shell",26],["T_NS_SEPARATOR","\\",26],["T_STRING","CommandRenderer",26],"(",")",")",["T_WHITESPACE","\n        ",26],")",";",["T_WHITESPACE","\n    ",27],"}",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Test that application reinitialization produces no memory leaks\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","testAppReinitializationNoMemoryLeak",33],"(",")",["T_WHITESPACE","\n    ",33],"{",["T_WHITESPACE","\n        ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","markTestSkipped",35],"(",["T_CONSTANT_ENCAPSED_STRING","'Test fails at Travis. Skipped until MAGETWO-47111'",35],")",";",["T_WHITESPACE","\n\n        ",35],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","_deallocateUnusedMemory",37],"(",")",";",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$actualMemoryUsage",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_helper",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getRealMemoryUsage",38],"(",")",";",["T_WHITESPACE","\n        ",38],["T_FOR","for",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$i",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_LNUMBER","0",39],";",["T_WHITESPACE"," ",39],["T_VARIABLE","$i",39],["T_WHITESPACE"," ",39],"<",["T_WHITESPACE"," ",39],["T_STRING","self",39],["T_DOUBLE_COLON","::",39],["T_STRING","APP_REINITIALIZATION_LOOPS",39],";",["T_WHITESPACE"," ",39],["T_VARIABLE","$i",39],["T_INC","++",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n            ",39],["T_NS_SEPARATOR","\\",40],["T_STRING","Magento",40],["T_NS_SEPARATOR","\\",40],["T_STRING","TestFramework",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Helper",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Bootstrap",40],["T_DOUBLE_COLON","::",40],["T_STRING","getInstance",40],"(",")",["T_OBJECT_OPERATOR","->",40],["T_STRING","reinitialize",40],"(",")",";",["T_WHITESPACE","\n            ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","_deallocateUnusedMemory",41],"(",")",";",["T_WHITESPACE","\n        ",41],"}",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$actualMemoryUsage",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_helper",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getRealMemoryUsage",43],"(",")",["T_WHITESPACE"," ",43],"-",["T_WHITESPACE"," ",43],["T_VARIABLE","$actualMemoryUsage",43],";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","assertLessThanOrEqual",44],"(",["T_WHITESPACE","\n            ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_getAllowedMemoryUsage",45],"(",")",",",["T_WHITESPACE","\n            ",45],["T_VARIABLE","$actualMemoryUsage",46],",",["T_WHITESPACE","\n            ",46],["T_STRING","sprintf",47],"(",["T_WHITESPACE","\n                ",47],["T_CONSTANT_ENCAPSED_STRING","\"Application reinitialization causes the memory leak of %u bytes per %u iterations.\"",48],",",["T_WHITESPACE","\n                ",48],["T_VARIABLE","$actualMemoryUsage",49],",",["T_WHITESPACE","\n                ",49],["T_STRING","self",50],["T_DOUBLE_COLON","::",50],["T_STRING","APP_REINITIALIZATION_LOOPS",50],["T_WHITESPACE","\n            ",50],")",["T_WHITESPACE","\n        ",51],")",";",["T_WHITESPACE","\n    ",52],"}",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * Force to deallocate no longer used memory\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","_deallocateUnusedMemory",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_STRING","gc_collect_cycles",60],"(",")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Retrieve the allowed memory usage in bytes, depending on the environment\n     *\n     * @return int\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","_getAllowedMemoryUsage",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_COMMENT","\/\/ Memory usage limits should not be further increased, corresponding memory leaks have to be fixed instead!\n",70],["T_WHITESPACE","        ",71],["T_COMMENT","\/\/ @todo fix memory leak and decrease limit to 1 M (in scope of MAGETWO-47693 limit was temporary increased)\n",71],["T_WHITESPACE","        ",72],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Magento",72],["T_NS_SEPARATOR","\\",72],["T_STRING","TestFramework",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Helper",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Memory",72],["T_DOUBLE_COLON","::",72],["T_STRING","convertToBytes",72],"(",["T_CONSTANT_ENCAPSED_STRING","'2M'",72],")",";",["T_WHITESPACE","\n    ",72],"}",["T_WHITESPACE","\n",73],"}",["T_WHITESPACE","\n",74]]