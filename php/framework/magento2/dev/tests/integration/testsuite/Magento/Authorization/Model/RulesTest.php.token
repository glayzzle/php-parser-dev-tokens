[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Authorization",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * @magentoAppArea adminhtml\n *\/",8],["T_WHITESPACE","\n",10],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","RulesTest",11],["T_WHITESPACE"," ",11],["T_EXTENDS","extends",11],["T_WHITESPACE"," ",11],["T_NS_SEPARATOR","\\",11],["T_STRING","PHPUnit_Framework_TestCase",11],["T_WHITESPACE","\n",11],"{",["T_WHITESPACE","\n    ",12],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Authorization\\Model\\Rules\n     *\/",13],["T_WHITESPACE","\n    ",15],["T_PROTECTED","protected",16],["T_WHITESPACE"," ",16],["T_VARIABLE","$_model",16],";",["T_WHITESPACE","\n\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\User\\Model\\User\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$user",21],";",["T_WHITESPACE","\n\n    ",21],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","setUp",23],"(",")",["T_WHITESPACE","\n    ",23],"{",["T_WHITESPACE","\n        ",24],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","_model",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Magento",25],["T_NS_SEPARATOR","\\",25],["T_STRING","TestFramework",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Helper",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Bootstrap",25],["T_DOUBLE_COLON","::",25],["T_STRING","getObjectManager",25],"(",")",["T_OBJECT_OPERATOR","->",25],["T_STRING","create",25],"(",["T_WHITESPACE","\n            ",25],["T_NS_SEPARATOR","\\",26],["T_STRING","Magento",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Authorization",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Model",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Rules",26],["T_DOUBLE_COLON","::",26],["T_CLASS","class",26],["T_WHITESPACE","\n        ",26],")",";",["T_WHITESPACE","\n        ",27],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","user",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Magento",28],["T_NS_SEPARATOR","\\",28],["T_STRING","TestFramework",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Helper",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Bootstrap",28],["T_DOUBLE_COLON","::",28],["T_STRING","getObjectManager",28],"(",")",["T_OBJECT_OPERATOR","->",28],["T_STRING","create",28],"(",["T_WHITESPACE","\n            ",28],["T_NS_SEPARATOR","\\",29],["T_STRING","Magento",29],["T_NS_SEPARATOR","\\",29],["T_STRING","User",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Model",29],["T_NS_SEPARATOR","\\",29],["T_STRING","User",29],["T_DOUBLE_COLON","::",29],["T_CLASS","class",29],["T_WHITESPACE","\n        ",29],")",";",["T_WHITESPACE","\n    ",30],"}",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @magentoDbIsolation enabled\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","testCRUD",36],"(",")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_model",38],["T_WHITESPACE","\n            ",38],["T_OBJECT_OPERATOR","->",39],["T_STRING","setRoleType",39],"(",["T_CONSTANT_ENCAPSED_STRING","'G'",39],")",["T_WHITESPACE","\n            ",39],["T_OBJECT_OPERATOR","->",40],["T_STRING","setResourceId",40],"(",["T_CONSTANT_ENCAPSED_STRING","'Magento_Backend::all'",40],")",["T_WHITESPACE","\n            ",40],["T_OBJECT_OPERATOR","->",41],["T_STRING","setPrivileges",41],"(",["T_CONSTANT_ENCAPSED_STRING","\"\"",41],")",["T_WHITESPACE","\n            ",41],["T_OBJECT_OPERATOR","->",42],["T_STRING","setAssertId",42],"(",["T_LNUMBER","0",42],")",["T_WHITESPACE","\n            ",42],["T_OBJECT_OPERATOR","->",43],["T_STRING","setRoleId",43],"(",["T_LNUMBER","1",43],")",["T_WHITESPACE","\n            ",43],["T_OBJECT_OPERATOR","->",44],["T_STRING","setPermission",44],"(",["T_CONSTANT_ENCAPSED_STRING","'allow'",44],")",";",["T_WHITESPACE","\n\n        ",44],["T_VARIABLE","$crud",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_NEW","new",46],["T_WHITESPACE"," ",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Magento",46],["T_NS_SEPARATOR","\\",46],["T_STRING","TestFramework",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Entity",46],"(",["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","_model",46],",",["T_WHITESPACE"," ",46],"[",["T_CONSTANT_ENCAPSED_STRING","'permission'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'deny'",46],"]",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$crud",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","testCrud",47],"(",")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * @magentoDbIsolation enabled\n     *\/",50],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","testInitialUserPermissions",53],"(",")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$expectedDefaultPermissions",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],"[",["T_CONSTANT_ENCAPSED_STRING","'Magento_Backend::all'",55],"]",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_checkExistingPermissions",56],"(",["T_VARIABLE","$expectedDefaultPermissions",56],")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * @covers \\Magento\\Authorization\\Model\\Rules::saveRel\n     * @magentoDbIsolation enabled\n     *\/",59],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","testSetAllowForAllResources",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$resources",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],"[",["T_CONSTANT_ENCAPSED_STRING","'Magento_Backend::all'",65],"]",";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","user",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","loadByUsername",66],"(",["T_NS_SEPARATOR","\\",66],["T_STRING","Magento",66],["T_NS_SEPARATOR","\\",66],["T_STRING","TestFramework",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Bootstrap",66],["T_DOUBLE_COLON","::",66],["T_STRING","ADMIN_NAME",66],")",";",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$roleId",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","user",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getRole",67],"(",")",["T_OBJECT_OPERATOR","->",67],["T_STRING","getRoleId",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_model",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","setRoleId",68],"(",["T_VARIABLE","$roleId",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","setResources",68],"(",["T_VARIABLE","$resources",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","saveRel",68],"(",")",";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$expectedPermissions",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],"[",["T_CONSTANT_ENCAPSED_STRING","'Magento_Backend::all'",69],"]",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_checkExistingPermissions",70],"(",["T_VARIABLE","$expectedPermissions",70],")",";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * Ensure that only expected permissions are set.\n     *\/",73],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","_checkExistingPermissions",76],"(",["T_VARIABLE","$expectedDefaultPermissions",76],")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$connection",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_model",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getResource",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","getConnection",78],"(",")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","user",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","loadByUsername",79],"(",["T_NS_SEPARATOR","\\",79],["T_STRING","Magento",79],["T_NS_SEPARATOR","\\",79],["T_STRING","TestFramework",79],["T_NS_SEPARATOR","\\",79],["T_STRING","Bootstrap",79],["T_DOUBLE_COLON","::",79],["T_STRING","ADMIN_NAME",79],")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$roleId",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","user",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getRole",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","getRoleId",80],"(",")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$ruleSelect",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$connection",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","select",81],"(",")",["T_WHITESPACE","\n            ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","from",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_model",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getResource",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getMainTable",82],"(",")",")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","where",83],"(",["T_CONSTANT_ENCAPSED_STRING","'role_id = ?'",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$roleId",83],")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$rules",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$ruleSelect",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","query",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","fetchAll",85],"(",")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$actualPermissions",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],"[","]",";",["T_WHITESPACE","\n        ",86],["T_FOREACH","foreach",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$rules",87],["T_WHITESPACE"," ",87],["T_AS","as",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$rule",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$actualPermissions",88],"[","]",["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$rule",88],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_id'",88],"]",";",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","assertEquals",89],"(",["T_WHITESPACE","\n                ",89],["T_CONSTANT_ENCAPSED_STRING","'allow'",90],",",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$rule",91],"[",["T_CONSTANT_ENCAPSED_STRING","'permission'",91],"]",",",["T_WHITESPACE","\n                ",91],"\"",["T_ENCAPSED_AND_WHITESPACE","Permission for '",92],["T_CURLY_OPEN","{",92],["T_VARIABLE","$rule",92],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_id'",92],"]","}",["T_ENCAPSED_AND_WHITESPACE","' resource should be 'allow'",92],"\"",["T_WHITESPACE","\n            ",92],")",";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","assertEquals",95],"(",["T_VARIABLE","$expectedDefaultPermissions",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$actualPermissions",95],",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'Default permissions are invalid'",95],")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n",96],"}",["T_WHITESPACE","\n",97]]