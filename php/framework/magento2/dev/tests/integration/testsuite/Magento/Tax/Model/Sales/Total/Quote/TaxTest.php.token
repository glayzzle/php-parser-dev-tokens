[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tax",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Total",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Tax",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Calculation",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","TestFramework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Helper",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Bootstrap",9],";",["T_WHITESPACE","\n\n",9],["T_REQUIRE_ONCE","require_once",11],["T_WHITESPACE"," ",11],["T_DIR","__DIR__",11],["T_WHITESPACE"," ",11],".",["T_WHITESPACE"," ",11],["T_CONSTANT_ENCAPSED_STRING","'\/SetupUtil.php'",11],";",["T_WHITESPACE","\n",11],["T_REQUIRE_ONCE","require_once",12],["T_WHITESPACE"," ",12],["T_DIR","__DIR__",12],["T_WHITESPACE"," ",12],".",["T_WHITESPACE"," ",12],["T_CONSTANT_ENCAPSED_STRING","'\/..\/..\/..\/..\/_files\/tax_calculation_data_aggregated.php'",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * Class TaxTest\n *\/",14],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","TaxTest",17],["T_WHITESPACE"," ",17],["T_EXTENDS","extends",17],["T_WHITESPACE"," ",17],["T_NS_SEPARATOR","\\",17],["T_STRING","PHPUnit_Framework_TestCase",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_DOC_COMMENT","\/**\n     * Utility object for setting up tax rates, tax classes and tax rules\n     *\n     * @var SetupUtil\n     *\/",19],["T_WHITESPACE","\n    ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$setupUtil",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_STRING","null",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * Test taxes collection for quote.\n     *\n     * Quote has customer and product.\n     * Product tax class and customer group tax class along with billing address have corresponding tax rule.\n     *\n     * @magentoDataFixture Magento\/Customer\/_files\/customer.php\n     * @magentoDataFixture Magento\/Customer\/_files\/customer_address.php\n     * @magentoDataFixture Magento\/Catalog\/_files\/products.php\n     * @magentoDataFixture Magento\/Tax\/_files\/tax_classes.php\n     * @magentoDataFixture Magento\/Customer\/_files\/customer_group.php\n     * @magentoDbIsolation enabled\n     * @magentoAppIsolation enabled\n     *\/",26],["T_WHITESPACE","\n    ",39],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","testCollect",40],"(",")",["T_WHITESPACE","\n    ",40],"{",["T_WHITESPACE","\n        ",41],["T_DOC_COMMENT","\/** Preconditions *\/",42],["T_WHITESPACE","\n        ",42],["T_VARIABLE","$objectManager",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","Bootstrap",43],["T_DOUBLE_COLON","::",43],["T_STRING","getObjectManager",43],"(",")",";",["T_WHITESPACE","\n        ",43],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Model\\ClassModel $customerTaxClass *\/",44],["T_WHITESPACE","\n        ",44],["T_VARIABLE","$customerTaxClass",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$objectManager",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","create",45],"(",["T_NS_SEPARATOR","\\",45],["T_STRING","Magento",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Tax",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Model",45],["T_NS_SEPARATOR","\\",45],["T_STRING","ClassModel",45],["T_DOUBLE_COLON","::",45],["T_CLASS","class",45],")",";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$fixtureCustomerTaxClass",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'CustomerTaxClass2'",46],";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$customerTaxClass",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","load",47],"(",["T_VARIABLE","$fixtureCustomerTaxClass",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'class_name'",47],")",";",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$fixtureCustomerId",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_LNUMBER","1",48],";",["T_WHITESPACE","\n        ",48],["T_DOC_COMMENT","\/** @var \\Magento\\Customer\\Model\\Customer $customer *\/",49],["T_WHITESPACE","\n        ",49],["T_VARIABLE","$customer",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$objectManager",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","create",50],"(",["T_NS_SEPARATOR","\\",50],["T_STRING","Magento",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Customer",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Model",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Customer",50],["T_DOUBLE_COLON","::",50],["T_CLASS","class",50],")",["T_OBJECT_OPERATOR","->",50],["T_STRING","load",50],"(",["T_VARIABLE","$fixtureCustomerId",50],")",";",["T_WHITESPACE","\n        ",50],["T_DOC_COMMENT","\/** @var \\Magento\\Customer\\Model\\Group $customerGroup *\/",51],["T_WHITESPACE","\n        ",51],["T_VARIABLE","$customerGroup",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$objectManager",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","create",52],"(",["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Customer",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Model",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Group",52],["T_DOUBLE_COLON","::",52],["T_CLASS","class",52],")",["T_WHITESPACE","\n            ",52],["T_OBJECT_OPERATOR","->",53],["T_STRING","load",53],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_group'",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'customer_group_code'",53],")",";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$customerGroup",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","setTaxClassId",54],"(",["T_VARIABLE","$customerTaxClass",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getId",54],"(",")",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","save",54],"(",")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$customer",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","setGroupId",55],"(",["T_VARIABLE","$customerGroup",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getId",55],"(",")",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","save",55],"(",")",";",["T_WHITESPACE","\n\n        ",55],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Model\\ClassModel $productTaxClass *\/",57],["T_WHITESPACE","\n        ",57],["T_VARIABLE","$productTaxClass",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$objectManager",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","create",58],"(",["T_NS_SEPARATOR","\\",58],["T_STRING","Magento",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Tax",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Model",58],["T_NS_SEPARATOR","\\",58],["T_STRING","ClassModel",58],["T_DOUBLE_COLON","::",58],["T_CLASS","class",58],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$fixtureProductTaxClass",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'ProductTaxClass1'",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$productTaxClass",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","load",60],"(",["T_VARIABLE","$fixtureProductTaxClass",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'class_name'",60],")",";",["T_WHITESPACE","\n        ",60],["T_DOC_COMMENT","\/** @var \\Magento\\Catalog\\Model\\Product $product *\/",61],["T_WHITESPACE","\n        ",61],["T_VARIABLE","$product",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$objectManager",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","create",62],"(",["T_NS_SEPARATOR","\\",62],["T_STRING","Magento",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Catalog",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Api",62],["T_NS_SEPARATOR","\\",62],["T_STRING","ProductRepositoryInterface",62],["T_DOUBLE_COLON","::",62],["T_CLASS","class",62],")",["T_OBJECT_OPERATOR","->",62],["T_STRING","get",62],"(",["T_CONSTANT_ENCAPSED_STRING","'simple'",62],")",";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$product",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","setTaxClassId",63],"(",["T_VARIABLE","$productTaxClass",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getId",63],"(",")",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","save",63],"(",")",";",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$fixtureCustomerAddressId",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_LNUMBER","1",65],";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$customerAddress",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$objectManager",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","create",66],"(",["T_NS_SEPARATOR","\\",66],["T_STRING","Magento",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Customer",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Model",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Address",66],["T_DOUBLE_COLON","::",66],["T_CLASS","class",66],")",["T_OBJECT_OPERATOR","->",66],["T_STRING","load",66],"(",["T_VARIABLE","$fixtureCustomerId",66],")",";",["T_WHITESPACE","\n        ",66],["T_DOC_COMMENT","\/** Set data which corresponds tax class fixture *\/",67],["T_WHITESPACE","\n        ",67],["T_VARIABLE","$customerAddress",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","setCountryId",68],"(",["T_CONSTANT_ENCAPSED_STRING","'US'",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","setRegionId",68],"(",["T_LNUMBER","12",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","save",68],"(",")",";",["T_WHITESPACE","\n        ",68],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote\\Address $quoteShippingAddress *\/",69],["T_WHITESPACE","\n        ",69],["T_VARIABLE","$quoteShippingAddress",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$objectManager",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","create",70],"(",["T_NS_SEPARATOR","\\",70],["T_STRING","Magento",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Quote",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Model",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Quote",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Address",70],["T_DOUBLE_COLON","::",70],["T_CLASS","class",70],")",";",["T_WHITESPACE","\n        ",70],["T_DOC_COMMENT","\/** @var \\Magento\\Customer\\Api\\AddressRepositoryInterface $addressRepository *\/",71],["T_WHITESPACE","\n        ",71],["T_VARIABLE","$addressRepository",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$objectManager",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","create",72],"(",["T_NS_SEPARATOR","\\",72],["T_STRING","Magento",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Customer",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Api",72],["T_NS_SEPARATOR","\\",72],["T_STRING","AddressRepositoryInterface",72],["T_DOUBLE_COLON","::",72],["T_CLASS","class",72],")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$quoteShippingAddress",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","importCustomerAddressData",73],"(",["T_VARIABLE","$addressRepository",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getById",73],"(",["T_VARIABLE","$fixtureCustomerAddressId",73],")",")",";",["T_WHITESPACE","\n\n        ",73],["T_DOC_COMMENT","\/** @var \\Magento\\Customer\\Api\\CustomerRepositoryInterface $customerRepository *\/",75],["T_WHITESPACE","\n        ",75],["T_VARIABLE","$customerRepository",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$objectManager",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","create",76],"(",["T_NS_SEPARATOR","\\",76],["T_STRING","Magento",76],["T_NS_SEPARATOR","\\",76],["T_STRING","Customer",76],["T_NS_SEPARATOR","\\",76],["T_STRING","Api",76],["T_NS_SEPARATOR","\\",76],["T_STRING","CustomerRepositoryInterface",76],["T_DOUBLE_COLON","::",76],["T_CLASS","class",76],")",";",["T_WHITESPACE","\n        ",76],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote $quote *\/",77],["T_WHITESPACE","\n        ",77],["T_VARIABLE","$quote",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$objectManager",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","create",78],"(",["T_NS_SEPARATOR","\\",78],["T_STRING","Magento",78],["T_NS_SEPARATOR","\\",78],["T_STRING","Quote",78],["T_NS_SEPARATOR","\\",78],["T_STRING","Model",78],["T_NS_SEPARATOR","\\",78],["T_STRING","Quote",78],["T_DOUBLE_COLON","::",78],["T_CLASS","class",78],")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$quote",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","setStoreId",79],"(",["T_LNUMBER","1",79],")",["T_WHITESPACE","\n            ",79],["T_OBJECT_OPERATOR","->",80],["T_STRING","setIsActive",80],"(",["T_STRING","true",80],")",["T_WHITESPACE","\n            ",80],["T_OBJECT_OPERATOR","->",81],["T_STRING","setIsMultiShipping",81],"(",["T_STRING","false",81],")",["T_WHITESPACE","\n            ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","assignCustomerWithAddressChange",82],"(",["T_VARIABLE","$customerRepository",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getById",82],"(",["T_VARIABLE","$customer",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getId",82],"(",")",")",")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","setShippingAddress",83],"(",["T_VARIABLE","$quoteShippingAddress",83],")",["T_WHITESPACE","\n            ",83],["T_OBJECT_OPERATOR","->",84],["T_STRING","setBillingAddress",84],"(",["T_VARIABLE","$quoteShippingAddress",84],")",["T_WHITESPACE","\n            ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","setCheckoutMethod",85],"(",["T_VARIABLE","$customer",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getMode",85],"(",")",")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setPasswordHash",86],"(",["T_VARIABLE","$customer",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","encryptPassword",86],"(",["T_VARIABLE","$customer",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getPassword",86],"(",")",")",")",["T_WHITESPACE","\n            ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","addProduct",87],"(",["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","load",87],"(",["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")",")",",",["T_WHITESPACE"," ",87],["T_LNUMBER","2",87],")",";",["T_WHITESPACE","\n\n        ",87],["T_DOC_COMMENT","\/**\n         * Execute SUT.\n         * \\Magento\\Tax\\Model\\Sales\\Total\\Quote\\Tax::collect cannot be called separately from\n         * \\Magento\\Tax\\Model\\Sales\\Total\\Quote\\Subtotal::collect because tax to zero amount will be applied.\n         * That is why it make sense to call collectTotals() instead, which will call SUT in its turn.\n         *\/",89],["T_WHITESPACE","\n        ",94],["T_VARIABLE","$quote",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","collectTotals",95],"(",")",";",["T_WHITESPACE","\n\n        ",95],["T_DOC_COMMENT","\/** Check results *\/",97],["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","assertEquals",98],"(",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$customerTaxClass",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getId",99],"(",")",",",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$quote",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCustomerTaxClassId",100],"(",")",",",["T_WHITESPACE","\n            ",100],["T_CONSTANT_ENCAPSED_STRING","'Customer tax class ID in quote is invalid.'",101],["T_WHITESPACE","\n        ",101],")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","assertEquals",103],"(",["T_WHITESPACE","\n            ",103],["T_DNUMBER","21.5",104],",",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$quote",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getGrandTotal",105],"(",")",",",["T_WHITESPACE","\n            ",105],["T_CONSTANT_ENCAPSED_STRING","'Customer tax was collected by \\Magento\\Tax\\Model\\Sales\\Total\\Quote\\Tax::collect incorrectly.'",106],["T_WHITESPACE","\n        ",106],")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Verify fields in quote item\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Item $item\n     * @param array $expectedItemData\n     * @return $this\n     *\/",110],["T_WHITESPACE","\n    ",116],["T_PROTECTED","protected",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","verifyItem",117],"(",["T_VARIABLE","$item",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$expectedItemData",117],")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_FOREACH","foreach",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$expectedItemData",119],["T_WHITESPACE"," ",119],["T_AS","as",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$key",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$value",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","assertEquals",120],"(",["T_VARIABLE","$value",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$item",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getData",120],"(",["T_VARIABLE","$key",120],")",",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'item '",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_VARIABLE","$key",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","' is incorrect'",120],")",";",["T_WHITESPACE","\n        ",120],"}",["T_WHITESPACE","\n\n        ",121],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Verify one tax rate in a tax row\n     *\n     * @param array $appliedTaxRate\n     * @param array $expectedAppliedTaxRate\n     * @return $this\n     *\/",126],["T_WHITESPACE","\n    ",132],["T_PROTECTED","protected",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","verifyAppliedTaxRate",133],"(",["T_VARIABLE","$appliedTaxRate",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$expectedAppliedTaxRate",133],")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$expectedAppliedTaxRate",135],["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$key",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$value",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","assertEquals",136],"(",["T_VARIABLE","$value",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$appliedTaxRate",136],"[",["T_VARIABLE","$key",136],"]",",",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'Applied tax rate '",136],["T_WHITESPACE"," ",136],".",["T_WHITESPACE"," ",136],["T_VARIABLE","$key",136],["T_WHITESPACE"," ",136],".",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","' is incorrect'",136],")",";",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n        ",137],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Verify one row in the applied taxes\n     *\n     * @param array $appliedTax\n     * @param array $expectedAppliedTax\n     * @return $this\n     *\/",141],["T_WHITESPACE","\n    ",147],["T_PROTECTED","protected",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","verifyAppliedTax",148],"(",["T_VARIABLE","$appliedTax",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$expectedAppliedTax",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_FOREACH","foreach",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$expectedAppliedTax",150],["T_WHITESPACE"," ",150],["T_AS","as",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$key",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$value",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$key",151],["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'rates'",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_FOREACH","foreach",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$value",152],["T_WHITESPACE"," ",152],["T_AS","as",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$index",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$taxRate",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","verifyAppliedTaxRate",153],"(",["T_VARIABLE","$appliedTax",153],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",153],"]","[",["T_VARIABLE","$index",153],"]",",",["T_WHITESPACE"," ",153],["T_VARIABLE","$taxRate",153],")",";",["T_WHITESPACE","\n                ",153],"}",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE"," ",155],["T_ELSE","else",155],["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","assertEquals",156],"(",["T_VARIABLE","$value",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$appliedTax",156],"[",["T_VARIABLE","$key",156],"]",",",["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","'Applied tax '",156],["T_WHITESPACE"," ",156],".",["T_WHITESPACE"," ",156],["T_VARIABLE","$key",156],["T_WHITESPACE"," ",156],".",["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","' is incorrect'",156],")",";",["T_WHITESPACE","\n            ",156],"}",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE","\n        ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n\n    ",160],["T_DOC_COMMENT","\/**\n     * Verify that applied taxes are correct\n     *\n     * @param array $appliedTaxes\n     * @param array $expectedAppliedTaxes\n     * @return $this\n     *\/",162],["T_WHITESPACE","\n    ",168],["T_PROTECTED","protected",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","verifyAppliedTaxes",169],"(",["T_VARIABLE","$appliedTaxes",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$expectedAppliedTaxes",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_FOREACH","foreach",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$expectedAppliedTaxes",171],["T_WHITESPACE"," ",171],["T_AS","as",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$taxRateKey",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$expectedTaxRate",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","assertTrue",172],"(",["T_ISSET","isset",172],"(",["T_VARIABLE","$appliedTaxes",172],"[",["T_VARIABLE","$taxRateKey",172],"]",")",",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'Missing tax rate '",172],["T_WHITESPACE"," ",172],".",["T_WHITESPACE"," ",172],["T_VARIABLE","$taxRateKey",172],")",";",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","verifyAppliedTax",173],"(",["T_VARIABLE","$appliedTaxes",173],"[",["T_VARIABLE","$taxRateKey",173],"]",",",["T_WHITESPACE"," ",173],["T_VARIABLE","$expectedTaxRate",173],")",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n        ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Verify fields in quote address\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Address $quoteAddress\n     * @param array $expectedAddressData\n     * @return $this\n     *\/",178],["T_WHITESPACE","\n    ",184],["T_PROTECTED","protected",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","verifyQuoteAddress",185],"(",["T_VARIABLE","$quoteAddress",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$expectedAddressData",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_FOREACH","foreach",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$expectedAddressData",187],["T_WHITESPACE"," ",187],["T_AS","as",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$key",187],["T_WHITESPACE"," ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$value",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_IF","if",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$key",188],["T_WHITESPACE"," ",188],["T_IS_EQUAL","==",188],["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'applied_taxes'",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","verifyAppliedTaxes",189],"(",["T_VARIABLE","$quoteAddress",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getAppliedTaxes",189],"(",")",",",["T_WHITESPACE"," ",189],["T_VARIABLE","$value",189],")",";",["T_WHITESPACE","\n            ",189],"}",["T_WHITESPACE"," ",190],["T_ELSE","else",190],["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","assertEquals",191],"(",["T_VARIABLE","$value",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$quoteAddress",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getData",191],"(",["T_VARIABLE","$key",191],")",",",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","'Quote address '",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_VARIABLE","$key",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","' is incorrect'",191],")",";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n\n        ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Verify fields in quote address and quote item are correct\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Address $quoteAddress\n     * @param array $expectedResults\n     * @return $this\n     *\/",198],["T_WHITESPACE","\n    ",204],["T_PROTECTED","protected",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","verifyResult",205],"(",["T_VARIABLE","$quoteAddress",205],",",["T_WHITESPACE"," ",205],["T_VARIABLE","$expectedResults",205],")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$addressData",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$expectedResults",207],"[",["T_CONSTANT_ENCAPSED_STRING","'address_data'",207],"]",";",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","verifyQuoteAddress",209],"(",["T_VARIABLE","$quoteAddress",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$addressData",209],")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$quoteItems",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$quoteAddress",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getAllItems",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_FOREACH","foreach",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$quoteItems",212],["T_WHITESPACE"," ",212],["T_AS","as",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$item",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_DOC_COMMENT","\/** @var  \\Magento\\Quote\\Model\\Quote\\Address\\Item $item *\/",213],["T_WHITESPACE","\n            ",213],["T_VARIABLE","$sku",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$item",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getProduct",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","getSku",214],"(",")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$expectedItemData",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$expectedResults",215],"[",["T_CONSTANT_ENCAPSED_STRING","'items_data'",215],"]","[",["T_VARIABLE","$sku",215],"]",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","verifyItem",216],"(",["T_VARIABLE","$item",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$expectedItemData",216],")",";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n\n        ",217],["T_RETURN","return",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Test tax calculation with various configuration and combination of items\n     * This method will test various collectors through $quoteAddress->collectTotals() method\n     *\n     * @param array $configData\n     * @param array $quoteData\n     * @param array $expectedResults\n     * @magentoDbIsolation enabled\n     * @magentoAppIsolation enabled\n     * @dataProvider taxDataProvider\n     * @return void\n     *\/",222],["T_WHITESPACE","\n    ",233],["T_PUBLIC","public",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","testTaxCalculation",234],"(",["T_VARIABLE","$configData",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$quoteData",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$expectedResults",234],")",["T_WHITESPACE","\n    ",234],"{",["T_WHITESPACE","\n        ",235],["T_DOC_COMMENT","\/** @var  \\Magento\\Framework\\ObjectManagerInterface $objectManager *\/",236],["T_WHITESPACE","\n        ",236],["T_VARIABLE","$objectManager",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_STRING","Bootstrap",237],["T_DOUBLE_COLON","::",237],["T_STRING","getObjectManager",237],"(",")",";",["T_WHITESPACE","\n        ",237],["T_DOC_COMMENT","\/** @var  \\Magento\\Quote\\Model\\Quote\\TotalsCollector $totalsCollector *\/",238],["T_WHITESPACE","\n        ",238],["T_VARIABLE","$totalsCollector",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$objectManager",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","create",239],"(",["T_NS_SEPARATOR","\\",239],["T_STRING","Magento",239],["T_NS_SEPARATOR","\\",239],["T_STRING","Quote",239],["T_NS_SEPARATOR","\\",239],["T_STRING","Model",239],["T_NS_SEPARATOR","\\",239],["T_STRING","Quote",239],["T_NS_SEPARATOR","\\",239],["T_STRING","TotalsCollector",239],["T_DOUBLE_COLON","::",239],["T_CLASS","class",239],")",";",["T_WHITESPACE","\n\n        ",239],["T_COMMENT","\/\/Setup tax configurations\n",241],["T_WHITESPACE","        ",242],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setupUtil",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_NEW","new",242],["T_WHITESPACE"," ",242],["T_STRING","SetupUtil",242],"(",["T_VARIABLE","$objectManager",242],")",";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","setupUtil",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","setupTax",243],"(",["T_VARIABLE","$configData",243],")",";",["T_WHITESPACE","\n\n        ",243],["T_VARIABLE","$quote",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","setupUtil",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","setupQuote",245],"(",["T_VARIABLE","$quoteData",245],")",";",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$quoteAddress",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$quote",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getShippingAddress",246],"(",")",";",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$totalsCollector",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","collectAddressTotals",247],"(",["T_VARIABLE","$quote",247],",",["T_WHITESPACE"," ",247],["T_VARIABLE","$quoteAddress",247],")",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","verifyResult",248],"(",["T_VARIABLE","$quoteAddress",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$expectedResults",248],")",";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Read the array defined in ..\/..\/..\/..\/_files\/tax_calculation_data_aggregated.php\n     * and feed it to testTaxCalculation\n     *\n     * @return array\n     *\/",251],["T_WHITESPACE","\n    ",256],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","taxDataProvider",257],"(",")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_GLOBAL","global",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$taxCalculationData",259],";",["T_WHITESPACE","\n        ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$taxCalculationData",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n",261],"}",["T_WHITESPACE","\n",262]]