[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Database transaction events manager\n *\/",7],["T_WHITESPACE","\n",9],["T_NAMESPACE","namespace",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","TestFramework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Event",10],";",["T_WHITESPACE","\n\n",10],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","Transaction",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\TestFramework\\EventManager\n     *\/",14],["T_WHITESPACE","\n    ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$_eventManager",17],";",["T_WHITESPACE","\n\n    ",17],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\TestFramework\\Event\\Param\\Transaction\n     *\/",19],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$_eventParam",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var bool\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_isTransactionActive",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_STRING","false",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param \\Magento\\TestFramework\\EventManager $eventManager\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","__construct",34],"(",["T_NS_SEPARATOR","\\",34],["T_STRING","Magento",34],["T_NS_SEPARATOR","\\",34],["T_STRING","TestFramework",34],["T_NS_SEPARATOR","\\",34],["T_STRING","EventManager",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$eventManager",34],")",["T_WHITESPACE","\n    ",34],"{",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","_eventManager",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$eventManager",36],";",["T_WHITESPACE","\n    ",36],"}",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Handler for 'startTest' event\n     *\n     * @param \\PHPUnit_Framework_TestCase $test\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","startTest",44],"(",["T_NS_SEPARATOR","\\",44],["T_STRING","PHPUnit_Framework_TestCase",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$test",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","_processTransactionRequests",46],"(",["T_CONSTANT_ENCAPSED_STRING","'startTest'",46],",",["T_WHITESPACE"," ",46],["T_VARIABLE","$test",46],")",";",["T_WHITESPACE","\n    ",46],"}",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Handler for 'endTest' event\n     *\n     * @param \\PHPUnit_Framework_TestCase $test\n     *\/",49],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","endTest",54],"(",["T_NS_SEPARATOR","\\",54],["T_STRING","PHPUnit_Framework_TestCase",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$test",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_processTransactionRequests",56],"(",["T_CONSTANT_ENCAPSED_STRING","'endTest'",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$test",56],")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Handler for 'endTestSuite' event\n     *\/",59],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","endTestSuite",62],"(",")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_rollbackTransaction",64],"(",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Query whether there are any requests for transaction operations and performs them\n     *\n     * @param string $eventName\n     * @param \\PHPUnit_Framework_TestCase $test\n     *\/",67],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","_processTransactionRequests",73],"(",["T_VARIABLE","$eventName",73],",",["T_WHITESPACE"," ",73],["T_NS_SEPARATOR","\\",73],["T_STRING","PHPUnit_Framework_TestCase",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$test",73],")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$param",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_getEventParam",75],"(",")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_eventManager",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","fireEvent",76],"(",["T_VARIABLE","$eventName",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'TransactionRequest'",76],",",["T_WHITESPACE"," ",76],"[",["T_VARIABLE","$test",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$param",76],"]",")",";",["T_WHITESPACE","\n        ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$param",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","isTransactionRollbackRequested",77],"(",")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_rollbackTransaction",78],"(",")",";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n        ",79],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_VARIABLE","$param",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","isTransactionStartRequested",80],"(",")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_startTransaction",81],"(",["T_VARIABLE","$test",81],")",";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Start transaction and fire 'startTransaction' event\n     *\n     * @param \\PHPUnit_Framework_TestCase $test\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_FUNCTION","function",90],["T_WHITESPACE"," ",90],["T_STRING","_startTransaction",90],"(",["T_NS_SEPARATOR","\\",90],["T_STRING","PHPUnit_Framework_TestCase",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$test",90],")",["T_WHITESPACE","\n    ",90],"{",["T_WHITESPACE","\n        ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(","!",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_isTransactionActive",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_getConnection",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","beginTransparentTransaction",93],"(",")",";",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_isTransactionActive",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","true",94],";",["T_WHITESPACE","\n            ",94],["T_TRY","try",95],["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n                ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_eventManager",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","fireEvent",96],"(",["T_CONSTANT_ENCAPSED_STRING","'startTransaction'",96],",",["T_WHITESPACE"," ",96],"[",["T_VARIABLE","$test",96],"]",")",";",["T_WHITESPACE","\n            ",96],"}",["T_WHITESPACE"," ",97],["T_CATCH","catch",97],["T_WHITESPACE"," ",97],"(",["T_NS_SEPARATOR","\\",97],["T_STRING","Exception",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$e",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n                ",97],["T_VARIABLE","$test",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getTestResultObject",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","addFailure",98],"(",["T_WHITESPACE","\n                    ",98],["T_VARIABLE","$test",99],",",["T_WHITESPACE","\n                    ",99],["T_NEW","new",100],["T_WHITESPACE"," ",100],["T_NS_SEPARATOR","\\",100],["T_STRING","PHPUnit_Framework_AssertionFailedError",100],"(",["T_STRING_CAST","(string)",100],["T_VARIABLE","$e",100],")",",",["T_WHITESPACE","\n                    ",100],["T_LNUMBER","0",101],["T_WHITESPACE","\n                ",101],")",";",["T_WHITESPACE","\n            ",102],"}",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Rollback transaction and fire 'rollbackTransaction' event\n     *\/",107],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","_rollbackTransaction",110],"(",")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_isTransactionActive",112],")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_getConnection",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","rollbackTransparentTransaction",113],"(",")",";",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_isTransactionActive",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","false",114],";",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_eventManager",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","fireEvent",115],"(",["T_CONSTANT_ENCAPSED_STRING","'rollbackTransaction'",115],")",";",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_getConnection",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","closeConnection",116],"(",")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * Retrieve database adapter instance\n     *\n     * @param string $connectionName\n     * @return \\Magento\\Framework\\DB\\Adapter\\AdapterInterface|\\Magento\\TestFramework\\Db\\Adapter\\TransactionInterface\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",120],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_getConnection",127],"(",["T_VARIABLE","$connectionName",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_NS_SEPARATOR","\\",127],["T_STRING","Magento",127],["T_NS_SEPARATOR","\\",127],["T_STRING","Framework",127],["T_NS_SEPARATOR","\\",127],["T_STRING","App",127],["T_NS_SEPARATOR","\\",127],["T_STRING","ResourceConnection",127],["T_DOUBLE_COLON","::",127],["T_STRING","DEFAULT_CONNECTION",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_DOC_COMMENT","\/** @var $resource \\Magento\\Framework\\App\\ResourceConnection *\/",129],["T_WHITESPACE","\n        ",129],["T_VARIABLE","$resource",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_NS_SEPARATOR","\\",130],["T_STRING","Magento",130],["T_NS_SEPARATOR","\\",130],["T_STRING","TestFramework",130],["T_NS_SEPARATOR","\\",130],["T_STRING","Helper",130],["T_NS_SEPARATOR","\\",130],["T_STRING","Bootstrap",130],["T_DOUBLE_COLON","::",130],["T_STRING","getObjectManager",130],"(",")",["T_WHITESPACE","\n            ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","get",131],"(",["T_NS_SEPARATOR","\\",131],["T_STRING","Magento",131],["T_NS_SEPARATOR","\\",131],["T_STRING","Framework",131],["T_NS_SEPARATOR","\\",131],["T_STRING","App",131],["T_NS_SEPARATOR","\\",131],["T_STRING","ResourceConnection",131],["T_DOUBLE_COLON","::",131],["T_CLASS","class",131],")",";",["T_WHITESPACE","\n        ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$resource",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getConnection",132],"(",["T_VARIABLE","$connectionName",132],")",";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Retrieve clean instance of transaction event parameter\n     *\n     * @return \\Magento\\TestFramework\\Event\\Param\\Transaction\n     *\/",135],["T_WHITESPACE","\n    ",139],["T_PROTECTED","protected",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","_getEventParam",140],"(",")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_COMMENT","\/* reset object state instead of instantiating new object over and over again *\/",142],["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(","!",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_eventParam",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_eventParam",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_NEW","new",144],["T_WHITESPACE"," ",144],["T_NS_SEPARATOR","\\",144],["T_STRING","Magento",144],["T_NS_SEPARATOR","\\",144],["T_STRING","TestFramework",144],["T_NS_SEPARATOR","\\",144],["T_STRING","Event",144],["T_NS_SEPARATOR","\\",144],["T_STRING","Param",144],["T_NS_SEPARATOR","\\",144],["T_STRING","Transaction",144],"(",")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE"," ",145],["T_ELSE","else",145],["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_eventParam",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","__construct",146],"(",")",";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_eventParam",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n",149],"}",["T_WHITESPACE","\n",150]]