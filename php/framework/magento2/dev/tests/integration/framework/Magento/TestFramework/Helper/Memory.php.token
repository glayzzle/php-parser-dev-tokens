[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Helper for determining system memory usage\n *\n * Uses OS tools to provide accurate information about factual memory consumption.\n * The PHP standard functions may return incorrect information because the process itself may have leaks.\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",10],["T_NAMESPACE","namespace",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","TestFramework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Helper",11],";",["T_WHITESPACE","\n\n",11],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Memory",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * Prefixes to specify unit of measure for memory amount\n     *\n     * Warning: it is important to maintain the exact order of letters in this literal,\n     * as it is used to convert string with units to bytes\n     *\/",15],["T_WHITESPACE","\n    ",20],["T_CONST","const",21],["T_WHITESPACE"," ",21],["T_STRING","MEMORY_UNITS",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'BKMGTPE'",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Shell\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$_shell",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Inject dependencies\n     *\n     * @param \\Magento\\Framework\\Shell $shell\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","__construct",33],"(",["T_NS_SEPARATOR","\\",33],["T_STRING","Magento",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Framework",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Shell",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$shell",33],")",["T_WHITESPACE","\n    ",33],"{",["T_WHITESPACE","\n        ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","_shell",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$shell",35],";",["T_WHITESPACE","\n    ",35],"}",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Retrieve the effective memory usage of the current process\n     *\n     * memory_get_usage() cannot be used because of the bug\n     * @link https:\/\/bugs.php.net\/bug.php?id=62467\n     *\n     * @return int Memory usage in bytes\n     *\/",38],["T_WHITESPACE","\n    ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","getRealMemoryUsage",46],"(",")",["T_WHITESPACE","\n    ",46],"{",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$pid",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","getmypid",48],"(",")",";",["T_WHITESPACE","\n        ",48],["T_TRY","try",49],["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n            ",49],["T_COMMENT","\/\/ try to use the Windows command line\n",50],["T_WHITESPACE","            ",51],["T_COMMENT","\/\/ some ports of Unix commands on Windows, such as MinGW, have limited capabilities and cannot be used\n",51],["T_WHITESPACE","            ",52],["T_VARIABLE","$result",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_getWinProcessMemoryUsage",52],"(",["T_VARIABLE","$pid",52],")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE"," ",53],["T_CATCH","catch",53],["T_WHITESPACE"," ",53],"(",["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Framework",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Exception",53],["T_NS_SEPARATOR","\\",53],["T_STRING","LocalizedException",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$e",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_COMMENT","\/\/ fall back to the Unix command line\n",54],["T_WHITESPACE","            ",55],["T_VARIABLE","$result",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_getUnixProcessMemoryUsage",55],"(",["T_VARIABLE","$pid",55],")",";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$result",57],";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Retrieve the current process' memory usage using Unix command line interface\n     *\n     * @link http:\/\/linux.die.net\/man\/1\/ps\n     * @param int $pid\n     * @return int Memory usage in bytes\n     *\/",60],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","_getUnixProcessMemoryUsage",67],"(",["T_VARIABLE","$pid",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_COMMENT","\/\/ RSS - resident set size, the non-swapped physical memory\n",69],["T_WHITESPACE","        ",70],["T_VARIABLE","$command",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'ps --pid %s --format rss --no-headers'",70],";",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","isMacOS",71],"(",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$command",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'ps -p %s -o rss='",72],";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$output",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_shell",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","execute",74],"(",["T_VARIABLE","$command",74],",",["T_WHITESPACE"," ",74],"[",["T_VARIABLE","$pid",74],"]",")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$result",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$output",75],["T_WHITESPACE"," ",75],".",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'k'",75],";",["T_WHITESPACE","\n        ",75],["T_COMMENT","\/\/ kilobytes\n",76],["T_WHITESPACE","        ",77],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","self",77],["T_DOUBLE_COLON","::",77],["T_STRING","convertToBytes",77],"(",["T_VARIABLE","$result",77],")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * Retrieve the current process' memory usage using Windows command line interface\n     *\n     * @link http:\/\/technet.microsoft.com\/en-us\/library\/bb491010.aspx\n     * @param int $pid\n     * @return int Memory usage in bytes\n     *\/",80],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_getWinProcessMemoryUsage",87],"(",["T_VARIABLE","$pid",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$output",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_shell",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","execute",89],"(",["T_CONSTANT_ENCAPSED_STRING","'tasklist.exe \/fi %s \/fo CSV \/nh'",89],",",["T_WHITESPACE"," ",89],"[","\"",["T_ENCAPSED_AND_WHITESPACE","PID eq ",89],["T_CURLY_OPEN","{",89],["T_VARIABLE","$pid",89],"}","\"","]",")",";",["T_WHITESPACE","\n\n        ",89],["T_VARIABLE","$arr",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","str_getcsv",91],"(",["T_VARIABLE","$output",91],")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$memory",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$arr",92],"[",["T_LNUMBER","4",92],"]",";",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_STRING","self",93],["T_DOUBLE_COLON","::",93],["T_STRING","convertToBytes",93],"(",["T_VARIABLE","$memory",93],")",";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Convert a number optionally followed by the unit symbol (B, K, M, G, etc.) to bytes\n     *\n     * @param string $number String representation of a number\n     * @return int\n     * @throws \\InvalidArgumentException\n     * @throws \\OutOfBoundsException\n     *\/",96],["T_WHITESPACE","\n    ",103],["T_PUBLIC","public",104],["T_WHITESPACE"," ",104],["T_STATIC","static",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","convertToBytes",104],"(",["T_VARIABLE","$number",104],")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_STRING","preg_match",106],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^(.*\\d)\\h*(\\D)$\/'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$number",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$matches",106],")",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_THROW","throw",107],["T_WHITESPACE"," ",107],["T_NEW","new",107],["T_WHITESPACE"," ",107],["T_NS_SEPARATOR","\\",107],["T_STRING","InvalidArgumentException",107],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Number format '",107],["T_CURLY_OPEN","{",107],["T_VARIABLE","$number",107],"}",["T_ENCAPSED_AND_WHITESPACE","' is not recognized.",107],"\"",")",";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$unitSymbol",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","strtoupper",109],"(",["T_VARIABLE","$matches",109],"[",["T_LNUMBER","2",109],"]",")",";",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_STRING","false",110],["T_WHITESPACE"," ",110],["T_IS_IDENTICAL","===",110],["T_WHITESPACE"," ",110],["T_STRING","strpos",110],"(",["T_STRING","self",110],["T_DOUBLE_COLON","::",110],["T_STRING","MEMORY_UNITS",110],",",["T_WHITESPACE"," ",110],["T_VARIABLE","$unitSymbol",110],")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_THROW","throw",111],["T_WHITESPACE"," ",111],["T_NEW","new",111],["T_WHITESPACE"," ",111],["T_NS_SEPARATOR","\\",111],["T_STRING","InvalidArgumentException",111],"(","\"",["T_ENCAPSED_AND_WHITESPACE","The number '",111],["T_CURLY_OPEN","{",111],["T_VARIABLE","$number",111],"}",["T_ENCAPSED_AND_WHITESPACE","' has an unrecognized unit: '",111],["T_CURLY_OPEN","{",111],["T_VARIABLE","$unitSymbol",111],"}",["T_ENCAPSED_AND_WHITESPACE","'.",111],"\"",")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$result",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","self",113],["T_DOUBLE_COLON","::",113],["T_STRING","_convertToNumber",113],"(",["T_VARIABLE","$matches",113],"[",["T_LNUMBER","1",113],"]",")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$pow",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$unitSymbol",114],["T_WHITESPACE"," ",114],"?",["T_WHITESPACE"," ",114],["T_STRING","strpos",114],"(",["T_STRING","self",114],["T_DOUBLE_COLON","::",114],["T_STRING","MEMORY_UNITS",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$unitSymbol",114],")",["T_WHITESPACE"," ",114],":",["T_WHITESPACE"," ",114],["T_LNUMBER","0",114],";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$is32Bit",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","PHP_INT_SIZE",115],["T_WHITESPACE"," ",115],["T_IS_EQUAL","==",115],["T_WHITESPACE"," ",115],["T_LNUMBER","4",115],";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$is32Bit",116],["T_WHITESPACE"," ",116],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$pow",116],["T_WHITESPACE"," ",116],["T_IS_GREATER_OR_EQUAL",">=",116],["T_WHITESPACE"," ",116],["T_LNUMBER","4",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_THROW","throw",117],["T_WHITESPACE"," ",117],["T_NEW","new",117],["T_WHITESPACE"," ",117],["T_NS_SEPARATOR","\\",117],["T_STRING","OutOfBoundsException",117],"(",["T_CONSTANT_ENCAPSED_STRING","\"A 32-bit system is unable to process such a number.\"",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_IF","if",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$unitSymbol",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$result",120],["T_WHITESPACE"," ",120],["T_MUL_EQUAL","*=",120],["T_WHITESPACE"," ",120],["T_STRING","pow",120],"(",["T_LNUMBER","1024",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$pow",120],")",";",["T_WHITESPACE","\n        ",120],"}",["T_WHITESPACE","\n        ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_INT_CAST","(int)",122],["T_VARIABLE","$result",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Remove non-numeric characters in the string to cast it to a numeric value\n     *\n     * Incoming number can be presented in arbitrary format that depends on locale. We don't possess locale information.\n     * So the best can be done is to treat number as an integer and eliminate delimiters.\n     * Method will not behave correctly with non-integer numbers for the following reason:\n     * - if value has more than one delimiter, such as in French notation: \"1 234,56\" -- then we can infer decimal part\n     * - but the value has only one delimiter, such as \"234,56\", then it is impossible to know whether it is decimal\n     *   separator or not. Only knowing the right format would allow this.\n     *\n     * @param $number\n     * @return string\n     * @throws \\InvalidArgumentException\n     *\/",125],["T_WHITESPACE","\n    ",138],["T_PROTECTED","protected",139],["T_WHITESPACE"," ",139],["T_STATIC","static",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","_convertToNumber",139],"(",["T_VARIABLE","$number",139],")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_STRING","preg_match_all",141],"(",["T_CONSTANT_ENCAPSED_STRING","'\/(\\D+)\/'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$number",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$matches",141],")",";",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(",["T_STRING","count",142],"(",["T_STRING","array_unique",142],"(",["T_VARIABLE","$matches",142],"[",["T_LNUMBER","0",142],"]",")",")",["T_WHITESPACE"," ",142],">",["T_WHITESPACE"," ",142],["T_LNUMBER","1",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_THROW","throw",143],["T_WHITESPACE"," ",143],["T_NEW","new",143],["T_WHITESPACE"," ",143],["T_NS_SEPARATOR","\\",143],["T_STRING","InvalidArgumentException",143],"(",["T_WHITESPACE","\n                ",143],"\"",["T_ENCAPSED_AND_WHITESPACE","The number '",144],["T_CURLY_OPEN","{",144],["T_VARIABLE","$number",144],"}",["T_ENCAPSED_AND_WHITESPACE","' seems to have decimal part. Only integer numbers are supported.",144],"\"",["T_WHITESPACE","\n            ",144],")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_STRING","preg_replace",147],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\D+\/'",147],",",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","''",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$number",147],")",";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Whether the operating system belongs to the Mac family\n     *\n     * @link http:\/\/php.net\/manual\/en\/function.php-uname.php\n     * @return boolean\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_STATIC","static",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","isMacOs",156],"(",")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_STRING","strtoupper",158],"(",["T_STRING","PHP_OS",158],")",["T_WHITESPACE"," ",158],["T_IS_IDENTICAL","===",158],["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'DARWIN'",158],";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n",159],"}",["T_WHITESPACE","\n",160]]