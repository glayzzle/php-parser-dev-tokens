[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Test",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Php",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","App",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Utility",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Files",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","TestFramework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Utility",10],["T_NS_SEPARATOR","\\",10],["T_STRING","XssOutputValidator",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Component",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ComponentRegistrar",11],";",["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Find not escaped output in phtml templates\n *\/",13],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","XssPhtmlTemplateTest",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_NS_SEPARATOR","\\",16],["T_STRING","PHPUnit_Framework_TestCase",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * @return void\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PUBLIC","public",21],["T_WHITESPACE"," ",21],["T_FUNCTION","function",21],["T_WHITESPACE"," ",21],["T_STRING","testXssSensitiveOutput",21],"(",")",["T_WHITESPACE","\n    ",21],"{",["T_WHITESPACE","\n        ",22],["T_VARIABLE","$invoker",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_NEW","new",23],["T_WHITESPACE"," ",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Magento",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Framework",23],["T_NS_SEPARATOR","\\",23],["T_STRING","App",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Utility",23],["T_NS_SEPARATOR","\\",23],["T_STRING","AggregateInvoker",23],"(",["T_VARIABLE","$this",23],")",";",["T_WHITESPACE","\n        ",23],["T_VARIABLE","$xssOutputValidator",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_NEW","new",24],["T_WHITESPACE"," ",24],["T_STRING","XssOutputValidator",24],"(",")",";",["T_WHITESPACE","\n        ",24],["T_VARIABLE","$invoker",25],"(",["T_WHITESPACE","\n            ",25],["T_DOC_COMMENT","\/**\n             * Static test will cover the following cases:\n             *\n             * 1. \/\\* @noEscape \\*\\\/ before output. Output doesn't require escaping. Test is green.\n             * 2. \/\\* @escapeNotVerified \\*\\\/ before output. Output escaping is not checked and\n             *    should be verified. Test is green.\n             * 3. Methods which contains \"html\" in their names (e.g. echo $object->{suffix}Html{postfix}() ).\n             *    Data is ready for the HTML output. Test is green.\n             * 4. AbstractBlock methods escapeHtml, escapeUrl, escapeQuote, escapeXssInUrl are allowed. Test is green.\n             * 5. Type casting and php function count() are allowed\n             *    (e.g. echo (int)$var, echo (float)$var, echo (bool)$var, echo count($var)). Test is green.\n             * 6. Output in single quotes (e.g. echo 'some text'). Test is green.\n             * 7. Output in double quotes without variables (e.g. echo \"some text\"). Test is green.\n             * 8. Other of p.1-7. Output is not escaped. Test is red.\n             *\n             * @param string $file\n             *\/",26],["T_WHITESPACE","\n            ",42],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],"(",["T_VARIABLE","$file",43],")",["T_WHITESPACE"," ",43],["T_USE","use",43],["T_WHITESPACE"," ",43],"(",["T_VARIABLE","$xssOutputValidator",43],")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n                ",43],["T_VARIABLE","$lines",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$xssOutputValidator",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getLinesWithXssSensitiveOutput",44],"(",["T_VARIABLE","$file",44],")",";",["T_WHITESPACE","\n                ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","assertEmpty",45],"(",["T_WHITESPACE","\n                    ",45],["T_VARIABLE","$lines",46],",",["T_WHITESPACE","\n                    ",46],["T_CONSTANT_ENCAPSED_STRING","\"Potentially XSS vulnerability. \"",47],["T_WHITESPACE"," ",47],".",["T_WHITESPACE","\n                    ",47],["T_CONSTANT_ENCAPSED_STRING","\"Please verify that output is escaped at lines \"",48],["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_VARIABLE","$lines",48],["T_WHITESPACE","\n                ",48],")",";",["T_WHITESPACE","\n            ",49],"}",",",["T_WHITESPACE","\n            ",50],["T_STRING","Files",51],["T_DOUBLE_COLON","::",51],["T_STRING","init",51],"(",")",["T_OBJECT_OPERATOR","->",51],["T_STRING","getPhtmlFiles",51],"(",")",["T_WHITESPACE","\n        ",51],")",";",["T_WHITESPACE","\n    ",52],"}",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * @return void\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","testAbsenceOfEscapeNotVerifiedAnnotationInRefinedModules",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$componentRegistrar",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_NEW","new",60],["T_WHITESPACE"," ",60],["T_STRING","ComponentRegistrar",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$exemptModules",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],"[","]",";",["T_WHITESPACE","\n        ",61],["T_FOREACH","foreach",62],["T_WHITESPACE"," ",62],"(",["T_STRING","array_diff",62],"(",["T_STRING","scandir",62],"(",["T_DIR","__DIR__",62],["T_WHITESPACE"," ",62],".",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'\/_files\/whitelist\/exempt_modules'",62],")",",",["T_WHITESPACE"," ",62],"[",["T_CONSTANT_ENCAPSED_STRING","'..'",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'.'",62],"]",")",["T_WHITESPACE"," ",62],["T_AS","as",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$file",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$exemptModules",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","array_merge",63],"(",["T_WHITESPACE","\n                ",63],["T_VARIABLE","$exemptModules",64],",",["T_WHITESPACE","\n                ",64],["T_INCLUDE","include",65],"(",["T_DIR","__DIR__",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'\/_files\/whitelist\/exempt_modules\/'",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_VARIABLE","$file",65],")",["T_WHITESPACE","\n            ",65],")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n\n        ",67],["T_VARIABLE","$result",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"\"",69],";",["T_WHITESPACE","\n        ",69],["T_FOREACH","foreach",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$componentRegistrar",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getPaths",70],"(",["T_STRING","ComponentRegistrar",70],["T_DOUBLE_COLON","::",70],["T_STRING","MODULE",70],")",["T_WHITESPACE"," ",70],["T_AS","as",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$moduleName",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$modulePath",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_STRING","in_array",71],"(",["T_VARIABLE","$moduleName",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$exemptModules",71],")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                ",71],["T_CONTINUE","continue",72],";",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE","\n            ",73],["T_FOREACH","foreach",74],["T_WHITESPACE"," ",74],"(",["T_STRING","Files",74],["T_DOUBLE_COLON","::",74],["T_STRING","init",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","getFiles",74],"(","[",["T_VARIABLE","$modulePath",74],"]",",",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'*.phtml'",74],")",["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$file",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$fileContents",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","file_get_contents",75],"(",["T_VARIABLE","$file",75],")",";",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$pattern",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","\"\/\\\\\/* @escapeNotVerified \\\\*\\\\\/ echo (?!__).+\/\"",76],";",["T_WHITESPACE","\n                ",76],["T_VARIABLE","$instances",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","preg_grep",77],"(",["T_VARIABLE","$pattern",77],",",["T_WHITESPACE"," ",77],["T_STRING","explode",77],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$fileContents",77],")",")",";",["T_WHITESPACE","\n                ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(","!",["T_EMPTY","empty",78],"(",["T_VARIABLE","$instances",78],")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n                    ",78],["T_FOREACH","foreach",79],["T_WHITESPACE"," ",79],"(",["T_STRING","array_keys",79],"(",["T_VARIABLE","$instances",79],")",["T_WHITESPACE"," ",79],["T_AS","as",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$line",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                        ",79],["T_VARIABLE","$result",80],["T_WHITESPACE"," ",80],["T_CONCAT_EQUAL",".=",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$file",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","':'",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],"(",["T_VARIABLE","$line",80],["T_WHITESPACE"," ",80],"+",["T_WHITESPACE"," ",80],["T_LNUMBER","1",80],")",["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",80],";",["T_WHITESPACE","\n                    ",80],"}",["T_WHITESPACE","\n                ",81],"}",["T_WHITESPACE","\n            ",82],"}",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","assertEmpty",85],"(",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$result",86],",",["T_WHITESPACE","\n            ",86],["T_CONSTANT_ENCAPSED_STRING","\"@escapeNotVerified annotation detected.\\n\"",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE","\n            ",87],["T_CONSTANT_ENCAPSED_STRING","\"Please use the correct escape strategy and remove annotation at:\\n\"",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_VARIABLE","$result",88],["T_WHITESPACE","\n        ",88],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n",90],"}",["T_WHITESPACE","\n",91]]