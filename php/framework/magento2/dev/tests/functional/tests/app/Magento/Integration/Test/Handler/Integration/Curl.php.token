[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Integration",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Test",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Handler",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Integration",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Integration",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Test",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Fixture",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Integration",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Mtf",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Fixture",10],["T_NS_SEPARATOR","\\",10],["T_STRING","FixtureInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Mtf",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Handler",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Curl",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","AbstractCurl",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Mtf",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Util",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Protocol",12],["T_NS_SEPARATOR","\\",12],["T_STRING","CurlInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Mtf",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Util",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Protocol",13],["T_NS_SEPARATOR","\\",13],["T_STRING","CurlTransport",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Mtf",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Util",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Protocol",14],["T_NS_SEPARATOR","\\",14],["T_STRING","CurlTransport",14],["T_NS_SEPARATOR","\\",14],["T_STRING","BackendDecorator",14],";",["T_WHITESPACE","\n\n",14],["T_DOC_COMMENT","\/**\n * Curl handler for creating Integration.\n *\/",16],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","Curl",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_STRING","AbstractCurl",19],["T_WHITESPACE"," ",19],["T_IMPLEMENTS","implements",19],["T_WHITESPACE"," ",19],["T_STRING","IntegrationInterface",19],["T_WHITESPACE","\n",19],"{",["T_WHITESPACE","\n    ",20],["T_DOC_COMMENT","\/**\n     * Pattern for to get field value.\n     *\n     * @var string\n     *\/",21],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$patternField",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/<input[^>]+name=\"%s\"[^>]+value=\"([^\"]+)\"[^>]+\\\/>\/'",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * List fields of activation data for getting from page.\n     *\n     * @var array\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$fields",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],"[",["T_WHITESPACE","\n        ",33],["T_CONSTANT_ENCAPSED_STRING","'consumer_key'",34],",",["T_WHITESPACE","\n        ",34],["T_CONSTANT_ENCAPSED_STRING","'consumer_secret'",35],",",["T_WHITESPACE","\n        ",35],["T_CONSTANT_ENCAPSED_STRING","'token'",36],",",["T_WHITESPACE","\n        ",36],["T_CONSTANT_ENCAPSED_STRING","'token_secret'",37],",",["T_WHITESPACE","\n    ",37],"]",";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Create integration using cURL client.\n     *\n     * @param FixtureInterface $fixture\n     * @throws \\Exception\n     * @return array\n     *\/",40],["T_WHITESPACE","\n    ",46],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","persist",47],"(",["T_STRING","FixtureInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$fixture",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","null",47],")",["T_WHITESPACE","\n    ",47],"{",["T_WHITESPACE","\n        ",48],["T_DOC_COMMENT","\/** @var Integration $fixture *\/",49],["T_WHITESPACE","\n        ",49],["T_DOC_COMMENT","\/** Prepare data for the post to integration save URL *\/",50],["T_WHITESPACE","\n        ",50],["T_VARIABLE","$data",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$fixture",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getData",51],"(",")",";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$data",52],"[",["T_CONSTANT_ENCAPSED_STRING","'all_resources'",52],"]",["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$data",52],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_access'",52],"]",["T_WHITESPACE"," ",52],["T_IS_IDENTICAL","===",52],["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'All'",52],")",["T_WHITESPACE"," ",52],"?",["T_WHITESPACE"," ",52],["T_LNUMBER","1",52],["T_WHITESPACE"," ",52],":",["T_WHITESPACE"," ",52],["T_LNUMBER","0",52],";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$curl",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_NEW","new",53],["T_WHITESPACE"," ",53],["T_STRING","BackendDecorator",53],"(",["T_NEW","new",53],["T_WHITESPACE"," ",53],["T_STRING","CurlTransport",53],"(",")",",",["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_configuration",53],")",";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$result",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],"[","]",";",["T_WHITESPACE","\n\n        ",54],["T_DOC_COMMENT","\/** Create new integration via cURL *\/",56],["T_WHITESPACE","\n        ",56],["T_VARIABLE","$url",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$_ENV",57],"[",["T_CONSTANT_ENCAPSED_STRING","'app_backend_url'",57],"]",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'admin\/integration\/save'",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$curl",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","write",58],"(",["T_VARIABLE","$url",58],",",["T_WHITESPACE"," ",58],["T_VARIABLE","$data",58],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$response",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$curl",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","read",59],"(",")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$curl",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","close",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(","!",["T_STRING","strpos",61],"(",["T_VARIABLE","$response",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'data-ui-id=\"messages-message-success\"'",61],")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_THROW","throw",62],["T_WHITESPACE"," ",62],["T_NEW","new",62],["T_WHITESPACE"," ",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Exception",62],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Integration creation by curl handler was not successful! Response: ",62],["T_VARIABLE","$response",62],"\"",")",";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$result",64],"[",["T_CONSTANT_ENCAPSED_STRING","'integration_id'",64],"]",["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getIntegrationId",64],"(",["T_VARIABLE","$fixture",64],")",";",["T_WHITESPACE","\n\n        ",64],["T_IF","if",66],["T_WHITESPACE"," ",66],"(",["T_ISSET","isset",66],"(",["T_VARIABLE","$data",66],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",66],"]",")",["T_WHITESPACE"," ",66],["T_BOOLEAN_AND","&&",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Active'",66],["T_WHITESPACE"," ",66],["T_IS_EQUAL","==",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$data",66],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",66],"]",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$fields",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","activateIntegration",67],"(",["T_VARIABLE","$result",67],"[",["T_CONSTANT_ENCAPSED_STRING","'integration_id'",67],"]",")",";",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$result",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","array_merge",68],"(",["T_VARIABLE","$result",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$fields",68],")",";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE","\n\n        ",69],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$result",71],";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Get integration id.\n     *\n     * @param Integration $integration\n     * @return int|null\n     *\/",74],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","getIntegrationId",80],"(",["T_STRING","Integration",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$integration",80],")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$name",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$integration",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getName",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$filter",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","base64_encode",83],"(",["T_CONSTANT_ENCAPSED_STRING","'name='",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_VARIABLE","$integration",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getName",83],"(",")",")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$url",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$_ENV",84],"[",["T_CONSTANT_ENCAPSED_STRING","'app_backend_url'",84],"]",["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'admin\/integration\/grid\/filter\/'",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_VARIABLE","$filter",84],";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$curl",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_NEW","new",85],["T_WHITESPACE"," ",85],["T_STRING","BackendDecorator",85],"(",["T_NEW","new",85],["T_WHITESPACE"," ",85],["T_STRING","CurlTransport",85],"(",")",",",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_configuration",85],")",";",["T_WHITESPACE","\n\n        ",85],["T_VARIABLE","$curl",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","write",87],"(",["T_VARIABLE","$url",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$response",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$curl",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","read",88],"(",")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$curl",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","close",89],"(",")",";",["T_WHITESPACE","\n\n        ",89],["T_STRING","preg_match",91],"(",["T_CONSTANT_ENCAPSED_STRING","'~<td.*?>.*?'",91],["T_WHITESPACE"," ",91],".",["T_WHITESPACE"," ",91],["T_VARIABLE","$name",91],["T_WHITESPACE"," ",91],".",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'.*?\/integration\/edit\/id\/(\\d+)\/~siu'",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$response",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$matches",91],")",";",["T_WHITESPACE","\n        ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_ISSET","isset",92],"(",["T_VARIABLE","$matches",92],"[",["T_LNUMBER","1",92],"]",")",["T_WHITESPACE"," ",92],"?",["T_WHITESPACE"," ",92],["T_VARIABLE","$matches",92],"[",["T_LNUMBER","1",92],"]",["T_WHITESPACE"," ",92],":",["T_WHITESPACE"," ",92],["T_STRING","null",92],";",["T_WHITESPACE","\n    ",92],"}",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Activate integration.\n     *\n     * @param int $integrationId\n     * @return array\n     *\/",95],["T_WHITESPACE","\n    ",100],["T_PROTECTED","protected",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","activateIntegration",101],"(",["T_VARIABLE","$integrationId",101],")",["T_WHITESPACE","\n    ",101],"{",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$curl",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_NEW","new",103],["T_WHITESPACE"," ",103],["T_STRING","BackendDecorator",103],"(",["T_NEW","new",103],["T_WHITESPACE"," ",103],["T_STRING","CurlTransport",103],"(",")",",",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_configuration",103],")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$result",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],"[","]",";",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$url",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","'admin\/integration\/permissionsDialog\/id\/'",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_VARIABLE","$integrationId",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","'\/reauthorize\/0\/'",106],";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$curl",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","write",107],"(",["T_VARIABLE","$_ENV",107],"[",["T_CONSTANT_ENCAPSED_STRING","'app_backend_url'",107],"]",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$url",107],",",["T_WHITESPACE"," ",107],"[","]",",",["T_WHITESPACE"," ",107],["T_STRING","CurlInterface",107],["T_DOUBLE_COLON","::",107],["T_STRING","GET",107],")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$curl",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","read",108],"(",")",";",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$url",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'admin\/integration\/tokensDialog\/id\/'",110],["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_VARIABLE","$integrationId",110],["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'\/reauthorize\/0\/'",110],";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$curl",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","write",111],"(",["T_VARIABLE","$_ENV",111],"[",["T_CONSTANT_ENCAPSED_STRING","'app_backend_url'",111],"]",["T_WHITESPACE"," ",111],".",["T_WHITESPACE"," ",111],["T_VARIABLE","$url",111],",",["T_WHITESPACE"," ",111],"[","]",",",["T_WHITESPACE"," ",111],["T_STRING","CurlInterface",111],["T_DOUBLE_COLON","::",111],["T_STRING","GET",111],")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$response",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$curl",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","read",112],"(",")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$curl",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","close",113],"(",")",";",["T_WHITESPACE","\n\n        ",113],["T_FOREACH","foreach",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","fields",115],["T_WHITESPACE"," ",115],["T_AS","as",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$field",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$pattern",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","sprintf",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","patternField",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$field",116],")",";",["T_WHITESPACE","\n            ",116],["T_STRING","preg_match",117],"(",["T_VARIABLE","$pattern",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$response",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$matches",117],")",";",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$result",118],"[",["T_VARIABLE","$field",118],"]",["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_ISSET","isset",118],"(",["T_VARIABLE","$matches",118],"[",["T_LNUMBER","1",118],"]",")",["T_WHITESPACE"," ",118],"?",["T_WHITESPACE"," ",118],["T_VARIABLE","$matches",118],"[",["T_LNUMBER","1",118],"]",["T_WHITESPACE"," ",118],":",["T_WHITESPACE"," ",118],["T_STRING","null",118],";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n\n        ",119],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$result",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n",122],"}",["T_WHITESPACE","\n",123]]