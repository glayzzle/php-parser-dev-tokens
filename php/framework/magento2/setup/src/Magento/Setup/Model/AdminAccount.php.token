[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Setup",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Authorization",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Acl",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Role",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Group",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Authorization",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Acl",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Role",10],["T_NS_SEPARATOR","\\",10],["T_STRING","User",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Authorization",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","UserContextInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Encryption",12],["T_NS_SEPARATOR","\\",12],["T_STRING","EncryptorInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Setup",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Module",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Setup",13],";",["T_WHITESPACE","\n\n",13],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","AdminAccount",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_COMMENT","\/**#@+\n     * Data keys\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_CONST","const",20],["T_WHITESPACE"," ",20],["T_STRING","KEY_USER",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'admin-user'",20],";",["T_WHITESPACE","\n    ",20],["T_CONST","const",21],["T_WHITESPACE"," ",21],["T_STRING","KEY_PASSWORD",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'admin-password'",21],";",["T_WHITESPACE","\n    ",21],["T_CONST","const",22],["T_WHITESPACE"," ",22],["T_STRING","KEY_EMAIL",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'admin-email'",22],";",["T_WHITESPACE","\n    ",22],["T_CONST","const",23],["T_WHITESPACE"," ",23],["T_STRING","KEY_FIRST_NAME",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'admin-firstname'",23],";",["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","KEY_LAST_NAME",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'admin-lastname'",24],";",["T_WHITESPACE","\n    ",24],["T_COMMENT","\/**#@- *\/",25],["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * Setup\n     *\n     * @var Setup\n     *\/",27],["T_WHITESPACE","\n    ",31],["T_PRIVATE","private",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$setup",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * Configurations\n     *\n     * @var []\n     *\/",34],["T_WHITESPACE","\n    ",38],["T_PRIVATE","private",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$data",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * @var EncryptorInterface\n     *\/",41],["T_WHITESPACE","\n    ",43],["T_PRIVATE","private",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$encryptor",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Default Constructor\n     *\n     * @param Setup $setup\n     * @param EncryptorInterface $encryptor\n     * @param array $data\n     *\/",46],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","__construct",53],"(",["T_WHITESPACE","\n        ",53],["T_STRING","Setup",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$setup",54],",",["T_WHITESPACE","\n        ",54],["T_STRING","EncryptorInterface",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$encryptor",55],",",["T_WHITESPACE","\n        ",55],["T_ARRAY","array",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$data",56],["T_WHITESPACE","\n    ",56],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","setup",58],["T_WHITESPACE","  ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$setup",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","encryptor",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$encryptor",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","data",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$data",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Generate password string\n     *\n     * @return string\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","generatePassword",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","encryptor",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getHash",70],"(",["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","data",70],"[",["T_STRING","self",70],["T_DOUBLE_COLON","::",70],["T_STRING","KEY_PASSWORD",70],"]",",",["T_WHITESPACE"," ",70],["T_STRING","true",70],")",";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * Save administrator account and user role to DB.\n     *\n     * If the administrator account exists, update it.\n     *\n     * @return void\n     *\/",73],["T_WHITESPACE","\n    ",79],["T_PUBLIC","public",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","save",80],"(",")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$adminId",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","saveAdminUser",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","saveAdminUserRole",83],"(",["T_VARIABLE","$adminId",83],")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Uses the information in data[] to create the admin user.\n     *\n     * If the username already exists, it will update the record with information from data[]\n     * and set the is_active flag.\n     *\n     * @return int The admin user id\n     *\/",86],["T_WHITESPACE","\n    ",93],["T_PRIVATE","private",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","saveAdminUser",94],"(",")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$adminData",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],"[",["T_WHITESPACE","\n            ",96],["T_CONSTANT_ENCAPSED_STRING","'firstname'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","data",97],"[",["T_STRING","self",97],["T_DOUBLE_COLON","::",97],["T_STRING","KEY_FIRST_NAME",97],"]",",",["T_WHITESPACE","\n            ",97],["T_CONSTANT_ENCAPSED_STRING","'lastname'",98],["T_WHITESPACE","  ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","data",98],"[",["T_STRING","self",98],["T_DOUBLE_COLON","::",98],["T_STRING","KEY_LAST_NAME",98],"]",",",["T_WHITESPACE","\n            ",98],["T_CONSTANT_ENCAPSED_STRING","'password'",99],["T_WHITESPACE","  ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","generatePassword",99],"(",")",",",["T_WHITESPACE","\n            ",99],["T_CONSTANT_ENCAPSED_STRING","'is_active'",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_LNUMBER","1",100],",",["T_WHITESPACE","\n        ",100],"]",";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$result",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","setup",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getConnection",102],"(",")",["T_OBJECT_OPERATOR","->",102],["T_STRING","fetchRow",102],"(",["T_WHITESPACE","\n            ",102],["T_CONSTANT_ENCAPSED_STRING","'SELECT user_id, username, email FROM '",103],["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","setup",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getTable",103],"(",["T_CONSTANT_ENCAPSED_STRING","'admin_user'",103],")",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","' '",103],["T_WHITESPACE"," ",103],".",["T_WHITESPACE","\n            ",103],["T_CONSTANT_ENCAPSED_STRING","'WHERE username = :username OR email = :email'",104],",",["T_WHITESPACE","\n            ",104],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","data",105],"[",["T_STRING","self",105],["T_DOUBLE_COLON","::",105],["T_STRING","KEY_USER",105],"]",",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'email'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","data",105],"[",["T_STRING","self",105],["T_DOUBLE_COLON","::",105],["T_STRING","KEY_EMAIL",105],"]","]",["T_WHITESPACE","\n        ",105],")",";",["T_WHITESPACE","\n\n        ",106],["T_IF","if",108],["T_WHITESPACE"," ",108],"(","!",["T_EMPTY","empty",108],"(",["T_VARIABLE","$result",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_COMMENT","\/\/ User exists, update\n",109],["T_WHITESPACE","            ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","validateUserMatches",110],"(",["T_VARIABLE","$result",110],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",110],"]",",",["T_WHITESPACE"," ",110],["T_VARIABLE","$result",110],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",110],"]",")",";",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$adminId",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$result",111],"[",["T_CONSTANT_ENCAPSED_STRING","'user_id'",111],"]",";",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$adminData",112],"[",["T_CONSTANT_ENCAPSED_STRING","'modified'",112],"]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","date",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",112],")",";",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","setup",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getConnection",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","update",113],"(",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","setup",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getTable",114],"(",["T_CONSTANT_ENCAPSED_STRING","'admin_user'",114],")",",",["T_WHITESPACE","\n                ",114],["T_VARIABLE","$adminData",115],",",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setup",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getConnection",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","quoteInto",116],"(",["T_CONSTANT_ENCAPSED_STRING","'username = ?'",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","data",116],"[",["T_STRING","self",116],["T_DOUBLE_COLON","::",116],["T_STRING","KEY_USER",116],"]",")",["T_WHITESPACE","\n            ",116],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE"," ",118],["T_ELSE","else",118],["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_COMMENT","\/\/ User does not exist, create it\n",119],["T_WHITESPACE","            ",120],["T_VARIABLE","$adminData",120],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",120],"]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","data",120],"[",["T_STRING","self",120],["T_DOUBLE_COLON","::",120],["T_STRING","KEY_USER",120],"]",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$adminData",121],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",121],"]",["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","data",121],"[",["T_STRING","self",121],["T_DOUBLE_COLON","::",121],["T_STRING","KEY_EMAIL",121],"]",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$adminData",122],"[",["T_CONSTANT_ENCAPSED_STRING","'extra'",122],"]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","serialize",122],"(",["T_STRING","null",122],")",";",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","setup",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getConnection",123],"(",")",["T_OBJECT_OPERATOR","->",123],["T_STRING","insert",123],"(",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","setup",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getTable",124],"(",["T_CONSTANT_ENCAPSED_STRING","'admin_user'",124],")",",",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$adminData",125],["T_WHITESPACE","\n            ",125],")",";",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$adminId",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","setup",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getConnection",127],"(",")",["T_OBJECT_OPERATOR","->",127],["T_STRING","lastInsertId",127],"(",")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$adminId",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Validates that the username and email both match the user.\n     *\n     * @param string $username Existing user's username\n     * @param string $email Existing user's email\n     * @return void\n     * @throws \\Exception If the username and email do not both match data provided to install\n     *\/",132],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","validateUserMatches",140],"(",["T_VARIABLE","$username",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$email",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","(",["T_STRING","strcasecmp",142],"(",["T_VARIABLE","$email",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","data",142],"[",["T_STRING","self",142],["T_DOUBLE_COLON","::",142],["T_STRING","KEY_EMAIL",142],"]",")",["T_WHITESPACE"," ",142],["T_IS_EQUAL","==",142],["T_WHITESPACE"," ",142],["T_LNUMBER","0",142],")",["T_WHITESPACE"," ",142],["T_BOOLEAN_AND","&&",142],["T_WHITESPACE","\n            ",142],"(",["T_STRING","strcasecmp",143],"(",["T_VARIABLE","$username",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","data",143],"[",["T_STRING","self",143],["T_DOUBLE_COLON","::",143],["T_STRING","KEY_USER",143],"]",")",["T_WHITESPACE"," ",143],["T_IS_NOT_EQUAL","!=",143],["T_WHITESPACE"," ",143],["T_LNUMBER","0",143],")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_COMMENT","\/\/ email matched but username did not\n",144],["T_WHITESPACE","            ",145],["T_THROW","throw",145],["T_WHITESPACE"," ",145],["T_NEW","new",145],["T_WHITESPACE"," ",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Exception",145],"(",["T_WHITESPACE","\n                ",145],["T_CONSTANT_ENCAPSED_STRING","'An existing user has the given email but different username. '",146],["T_WHITESPACE","\n                ",146],".",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'Username and email both need to match an existing user or both be new.'",147],["T_WHITESPACE","\n            ",147],")",";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n        ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(","(",["T_STRING","strcasecmp",150],"(",["T_VARIABLE","$username",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","data",150],"[",["T_STRING","self",150],["T_DOUBLE_COLON","::",150],["T_STRING","KEY_USER",150],"]",")",["T_WHITESPACE"," ",150],["T_IS_EQUAL","==",150],["T_WHITESPACE"," ",150],["T_LNUMBER","0",150],")",["T_WHITESPACE"," ",150],["T_BOOLEAN_AND","&&",150],["T_WHITESPACE","\n            ",150],"(",["T_STRING","strcasecmp",151],"(",["T_VARIABLE","$email",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","data",151],"[",["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_STRING","KEY_EMAIL",151],"]",")",["T_WHITESPACE"," ",151],["T_IS_NOT_EQUAL","!=",151],["T_WHITESPACE"," ",151],["T_LNUMBER","0",151],")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n            ",151],["T_COMMENT","\/\/ username matched but email did not\n",152],["T_WHITESPACE","            ",153],["T_THROW","throw",153],["T_WHITESPACE"," ",153],["T_NEW","new",153],["T_WHITESPACE"," ",153],["T_NS_SEPARATOR","\\",153],["T_STRING","Exception",153],"(",["T_WHITESPACE","\n                ",153],["T_CONSTANT_ENCAPSED_STRING","'An existing user has the given username but different email. '",154],["T_WHITESPACE","\n                ",154],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'Username and email both need to match an existing user or both be new.'",155],["T_WHITESPACE","\n            ",155],")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Creates the admin user role if one does not exist.\n     *\n     * Do nothing if a role already exists for this user\n     *\n     * @param int $adminId User id of administrator to set role for\n     * @return void\n     *\/",160],["T_WHITESPACE","\n    ",167],["T_PRIVATE","private",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","saveAdminUserRole",168],"(",["T_VARIABLE","$adminId",168],")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$result",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","setup",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getConnection",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","fetchRow",170],"(",["T_WHITESPACE","\n            ",170],["T_CONSTANT_ENCAPSED_STRING","'SELECT * FROM '",171],["T_WHITESPACE"," ",171],".",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setup",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getTable",171],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization_role'",171],")",["T_WHITESPACE"," ",171],".",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","' '",171],["T_WHITESPACE"," ",171],".",["T_WHITESPACE","\n            ",171],["T_CONSTANT_ENCAPSED_STRING","'WHERE user_id = :user_id AND user_type = :user_type'",172],",",["T_WHITESPACE","\n            ",172],"[",["T_CONSTANT_ENCAPSED_STRING","'user_id'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$adminId",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'user_type'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_STRING","UserContextInterface",173],["T_DOUBLE_COLON","::",173],["T_STRING","USER_TYPE_ADMIN",173],"]",["T_WHITESPACE","\n        ",173],")",";",["T_WHITESPACE","\n        ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_EMPTY","empty",175],"(",["T_VARIABLE","$result",175],")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_COMMENT","\/\/ No user role exists for this user id, create it\n",176],["T_WHITESPACE","            ",177],["T_VARIABLE","$adminRoleData",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],"[",["T_WHITESPACE","\n                ",177],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",178],["T_WHITESPACE","  ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","retrieveAdministratorsRoleId",178],"(",")",",",["T_WHITESPACE","\n                ",178],["T_CONSTANT_ENCAPSED_STRING","'tree_level'",179],["T_WHITESPACE"," ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_LNUMBER","2",179],",",["T_WHITESPACE","\n                ",179],["T_CONSTANT_ENCAPSED_STRING","'role_type'",180],["T_WHITESPACE","  ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_STRING","User",180],["T_DOUBLE_COLON","::",180],["T_STRING","ROLE_TYPE",180],",",["T_WHITESPACE","\n                ",180],["T_CONSTANT_ENCAPSED_STRING","'user_id'",181],["T_WHITESPACE","    ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$adminId",181],",",["T_WHITESPACE","\n                ",181],["T_CONSTANT_ENCAPSED_STRING","'user_type'",182],["T_WHITESPACE","  ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_STRING","UserContextInterface",182],["T_DOUBLE_COLON","::",182],["T_STRING","USER_TYPE_ADMIN",182],",",["T_WHITESPACE","\n                ",182],["T_CONSTANT_ENCAPSED_STRING","'role_name'",183],["T_WHITESPACE","  ",183],["T_DOUBLE_ARROW","=>",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","data",183],"[",["T_STRING","self",183],["T_DOUBLE_COLON","::",183],["T_STRING","KEY_USER",183],"]",",",["T_WHITESPACE","\n            ",183],"]",";",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","setup",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getConnection",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","insert",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","setup",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getTable",185],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization_role'",185],")",",",["T_WHITESPACE"," ",185],["T_VARIABLE","$adminRoleData",185],")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Gets the \"Administrators\" role id, the special role created by data fixture in Authorization module.\n     *\n     * @return int The id of the Administrators role\n     * @throws \\Exception If Administrators role not found or problem connecting with database.\n     *\/",189],["T_WHITESPACE","\n    ",194],["T_PRIVATE","private",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","retrieveAdministratorsRoleId",195],"(",")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_COMMENT","\/\/ Get Administrators role id to use as parent_id\n",197],["T_WHITESPACE","        ",198],["T_VARIABLE","$administratorsRoleData",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],"[",["T_WHITESPACE","\n            ",198],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",199],["T_WHITESPACE","  ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_LNUMBER","0",199],",",["T_WHITESPACE","\n            ",199],["T_CONSTANT_ENCAPSED_STRING","'tree_level'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_LNUMBER","1",200],",",["T_WHITESPACE","\n            ",200],["T_CONSTANT_ENCAPSED_STRING","'role_type'",201],["T_WHITESPACE"," ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_STRING","Group",201],["T_DOUBLE_COLON","::",201],["T_STRING","ROLE_TYPE",201],",",["T_WHITESPACE","\n            ",201],["T_CONSTANT_ENCAPSED_STRING","'user_id'",202],["T_WHITESPACE"," ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_LNUMBER","0",202],",",["T_WHITESPACE","\n            ",202],["T_CONSTANT_ENCAPSED_STRING","'user_type'",203],["T_WHITESPACE"," ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_STRING","UserContextInterface",203],["T_DOUBLE_COLON","::",203],["T_STRING","USER_TYPE_ADMIN",203],",",["T_WHITESPACE","\n            ",203],["T_CONSTANT_ENCAPSED_STRING","'role_name'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'Administrators'",204],",",["T_WHITESPACE","\n        ",204],"]",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$result",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","setup",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getConnection",206],"(",")",["T_OBJECT_OPERATOR","->",206],["T_STRING","fetchRow",206],"(",["T_WHITESPACE","\n            ",206],["T_CONSTANT_ENCAPSED_STRING","'SELECT * FROM '",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","setup",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getTable",207],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization_role'",207],")",["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","' '",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE","\n            ",207],["T_CONSTANT_ENCAPSED_STRING","'WHERE parent_id = :parent_id AND tree_level = :tree_level AND role_type = :role_type AND '",208],["T_WHITESPACE"," ",208],".",["T_WHITESPACE","\n            ",208],["T_CONSTANT_ENCAPSED_STRING","'user_id = :user_id AND user_type = :user_type AND role_name = :role_name'",209],",",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$administratorsRoleData",210],["T_WHITESPACE","\n        ",210],")",";",["T_WHITESPACE","\n        ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(",["T_EMPTY","empty",212],"(",["T_VARIABLE","$result",212],")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_THROW","throw",213],["T_WHITESPACE"," ",213],["T_NEW","new",213],["T_WHITESPACE"," ",213],["T_NS_SEPARATOR","\\",213],["T_STRING","Exception",213],"(",["T_CONSTANT_ENCAPSED_STRING","'No Administrators role was found, data fixture needs to be run'",213],")",";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE"," ",214],["T_ELSE","else",214],["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_COMMENT","\/\/ Found at least one, use first\n",215],["T_WHITESPACE","            ",216],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$result",216],"[",["T_CONSTANT_ENCAPSED_STRING","'role_id'",216],"]",";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n",218],"}",["T_WHITESPACE","\n",219]]