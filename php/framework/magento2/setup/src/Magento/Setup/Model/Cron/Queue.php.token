[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Setup",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Cron",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Job Queue\n *\/",8],["T_WHITESPACE","\n",10],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","Queue",11],["T_WHITESPACE","\n",11],"{",["T_WHITESPACE","\n    ",12],["T_COMMENT","\/**#@+\n     * Key used in queue file.\n     *\/",13],["T_WHITESPACE","\n    ",15],["T_CONST","const",16],["T_WHITESPACE"," ",16],["T_STRING","KEY_JOBS",16],["T_WHITESPACE"," ",16],"=",["T_WHITESPACE"," ",16],["T_CONSTANT_ENCAPSED_STRING","'jobs'",16],";",["T_WHITESPACE","\n    ",16],["T_CONST","const",17],["T_WHITESPACE"," ",17],["T_STRING","KEY_JOB_NAME",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","'name'",17],";",["T_WHITESPACE","\n    ",17],["T_CONST","const",18],["T_WHITESPACE"," ",18],["T_STRING","KEY_JOB_PARAMS",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_CONSTANT_ENCAPSED_STRING","'params'",18],";",["T_WHITESPACE","\n    ",18],["T_COMMENT","\/**#@-*\/",19],["T_WHITESPACE","\n\n    ",19],["T_DOC_COMMENT","\/**\n     * @var Queue\\Reader\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$reader",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @var Queue\\Writer\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$writer",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * @var JobFactory\n     *\/",31],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$jobFactory",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Initialize dependencies.\n     *\n     * @param Queue\\Reader $reader\n     * @param Queue\\Writer $writer\n     * @param JobFactory $jobFactory\n     *\/",36],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","__construct",43],"(",["T_STRING","Queue",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Reader",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$reader",43],",",["T_WHITESPACE"," ",43],["T_STRING","Queue",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Writer",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$writer",43],",",["T_WHITESPACE"," ",43],["T_STRING","JobFactory",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$jobFactory",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","reader",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$reader",45],";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","jobFactory",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$jobFactory",46],";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","writer",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$writer",47],";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Peek at job queue\n     *\n     * @return array\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","peek",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$queue",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","json_decode",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","reader",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","read",57],"(",")",",",["T_WHITESPACE"," ",57],["T_STRING","true",57],")",";",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(","!",["T_STRING","is_array",58],"(",["T_VARIABLE","$queue",58],")",")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],"[","]",";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n        ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(",["T_ISSET","isset",61],"(",["T_VARIABLE","$queue",61],"[",["T_STRING","self",61],["T_DOUBLE_COLON","::",61],["T_STRING","KEY_JOBS",61],"]",")",["T_WHITESPACE"," ",61],["T_BOOLEAN_AND","&&",61],["T_WHITESPACE"," ",61],["T_STRING","is_array",61],"(",["T_VARIABLE","$queue",61],"[",["T_STRING","self",61],["T_DOUBLE_COLON","::",61],["T_STRING","KEY_JOBS",61],"]",")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","validateJobDeclaration",62],"(",["T_VARIABLE","$queue",62],"[",["T_STRING","self",62],["T_DOUBLE_COLON","::",62],["T_STRING","KEY_JOBS",62],"]","[",["T_LNUMBER","0",62],"]",")",";",["T_WHITESPACE","\n            ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$queue",63],"[",["T_STRING","self",63],["T_DOUBLE_COLON","::",63],["T_STRING","KEY_JOBS",63],"]","[",["T_LNUMBER","0",63],"]",";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE"," ",64],["T_ELSE","else",64],["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_THROW","throw",65],["T_WHITESPACE"," ",65],["T_NEW","new",65],["T_WHITESPACE"," ",65],["T_NS_SEPARATOR","\\",65],["T_STRING","RuntimeException",65],"(",["T_STRING","sprintf",65],"(",["T_CONSTANT_ENCAPSED_STRING","'\"%s\" field is missing or is not an array.'",65],",",["T_WHITESPACE"," ",65],["T_STRING","self",65],["T_DOUBLE_COLON","::",65],["T_STRING","KEY_JOBS",65],")",")",";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Pop job queue.\n     *\n     * @return AbstractJob|null\n     * @throws \\RuntimeException\n     *\/",69],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","popQueuedJob",75],"(",")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$job",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","null",77],";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$queue",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","json_decode",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","reader",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","read",78],"(",")",",",["T_WHITESPACE"," ",78],["T_STRING","true",78],")",";",["T_WHITESPACE","\n        ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_STRING","is_array",79],"(",["T_VARIABLE","$queue",79],")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_RETURN","return",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$job",80],";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n        ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_ISSET","isset",82],"(",["T_VARIABLE","$queue",82],"[",["T_STRING","self",82],["T_DOUBLE_COLON","::",82],["T_STRING","KEY_JOBS",82],"]",")",["T_WHITESPACE"," ",82],["T_BOOLEAN_AND","&&",82],["T_WHITESPACE"," ",82],["T_STRING","is_array",82],"(",["T_VARIABLE","$queue",82],"[",["T_STRING","self",82],["T_DOUBLE_COLON","::",82],["T_STRING","KEY_JOBS",82],"]",")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","validateJobDeclaration",83],"(",["T_VARIABLE","$queue",83],"[",["T_STRING","self",83],["T_DOUBLE_COLON","::",83],["T_STRING","KEY_JOBS",83],"]","[",["T_LNUMBER","0",83],"]",")",";",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$job",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","jobFactory",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","create",84],"(",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$queue",85],"[",["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_STRING","KEY_JOBS",85],"]","[",["T_LNUMBER","0",85],"]","[",["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_STRING","KEY_JOB_NAME",85],"]",",",["T_WHITESPACE","\n                ",85],["T_VARIABLE","$queue",86],"[",["T_STRING","self",86],["T_DOUBLE_COLON","::",86],["T_STRING","KEY_JOBS",86],"]","[",["T_LNUMBER","0",86],"]","[",["T_STRING","self",86],["T_DOUBLE_COLON","::",86],["T_STRING","KEY_JOB_PARAMS",86],"]",["T_WHITESPACE","\n            ",86],")",";",["T_WHITESPACE","\n            ",87],["T_STRING","array_shift",88],"(",["T_VARIABLE","$queue",88],"[",["T_STRING","self",88],["T_DOUBLE_COLON","::",88],["T_STRING","KEY_JOBS",88],"]",")",";",["T_WHITESPACE","\n            ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_EMPTY","empty",89],"(",["T_VARIABLE","$queue",89],"[",["T_STRING","self",89],["T_DOUBLE_COLON","::",89],["T_STRING","KEY_JOBS",89],"]",")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","writer",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","write",90],"(",["T_CONSTANT_ENCAPSED_STRING","''",90],")",";",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE"," ",91],["T_ELSE","else",91],["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","writer",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","write",92],"(",["T_STRING","json_encode",92],"(",["T_VARIABLE","$queue",92],",",["T_WHITESPACE"," ",92],["T_STRING","JSON_PRETTY_PRINT",92],["T_WHITESPACE"," ",92],"|",["T_WHITESPACE"," ",92],["T_STRING","JSON_UNESCAPED_SLASHES",92],")",")",";",["T_WHITESPACE","\n            ",92],"}",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE"," ",94],["T_ELSE","else",94],["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_THROW","throw",95],["T_WHITESPACE"," ",95],["T_NEW","new",95],["T_WHITESPACE"," ",95],["T_NS_SEPARATOR","\\",95],["T_STRING","RuntimeException",95],"(",["T_STRING","sprintf",95],"(",["T_CONSTANT_ENCAPSED_STRING","'\"%s\" field is missing or is not an array.'",95],",",["T_WHITESPACE"," ",95],["T_STRING","self",95],["T_DOUBLE_COLON","::",95],["T_STRING","KEY_JOBS",95],")",")",";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n        ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$job",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Returns if job queue is empty\n     *\n     * @return bool\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","isEmpty",105],"(",")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$queue",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","json_decode",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","reader",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","read",107],"(",")",",",["T_WHITESPACE"," ",107],["T_STRING","true",107],")",";",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_EMPTY","empty",108],"(",["T_VARIABLE","$queue",108],")",";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * @param array $jobs\n     * @return void\n     *\/",111],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","addJobs",115],"(",["T_ARRAY","array",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$jobs",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_FOREACH","foreach",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$jobs",117],["T_WHITESPACE"," ",117],["T_AS","as",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$job",117],")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","validateJobDeclaration",118],"(",["T_VARIABLE","$job",118],")",";",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$queue",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","json_decode",119],"(",["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","reader",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","read",119],"(",")",",",["T_WHITESPACE"," ",119],["T_STRING","true",119],")",";",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$queue",120],"[",["T_STRING","self",120],["T_DOUBLE_COLON","::",120],["T_STRING","KEY_JOBS",120],"]","[","]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$job",120],";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","writer",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","write",121],"(",["T_STRING","json_encode",121],"(",["T_VARIABLE","$queue",121],",",["T_WHITESPACE"," ",121],["T_STRING","JSON_PRETTY_PRINT",121],["T_WHITESPACE"," ",121],"|",["T_WHITESPACE"," ",121],["T_STRING","JSON_UNESCAPED_SLASHES",121],")",")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Make sure job declaration is correct.\n     *\n     * @param object $job\n     * @return void\n     * @throws \\RuntimeException\n     *\/",125],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","validateJobDeclaration",132],"(",["T_VARIABLE","$job",132],")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$requiredFields",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],"[",["T_STRING","self",134],["T_DOUBLE_COLON","::",134],["T_STRING","KEY_JOB_NAME",134],",",["T_WHITESPACE"," ",134],["T_STRING","self",134],["T_DOUBLE_COLON","::",134],["T_STRING","KEY_JOB_PARAMS",134],"]",";",["T_WHITESPACE","\n        ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$requiredFields",135],["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$field",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(","!",["T_ISSET","isset",136],"(",["T_VARIABLE","$job",136],"[",["T_VARIABLE","$field",136],"]",")",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_THROW","throw",137],["T_WHITESPACE"," ",137],["T_NEW","new",137],["T_WHITESPACE"," ",137],["T_NS_SEPARATOR","\\",137],["T_STRING","RuntimeException",137],"(",["T_STRING","sprintf",137],"(",["T_CONSTANT_ENCAPSED_STRING","'\"%s\" field is missing for one or more jobs.'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$field",137],")",")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n",140],"}",["T_WHITESPACE","\n",141]]