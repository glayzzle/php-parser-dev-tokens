[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * DB transaction model\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",7],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DB",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * @todo need collect connection by name\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Transaction",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * Objects which will be involved to transaction\n     *\n     * @var array\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$_objects",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],"[","]",";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * Transaction objects array with alias key\n     *\n     * @var array\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_objectsByAlias",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],"[","]",";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Callbacks array.\n     *\n     * @var array\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_beforeCommitCallbacks",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],"[","]",";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Begin transaction for all involved object resources\n     *\n     * @return $this\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_startTransaction",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_FOREACH","foreach",43],["T_WHITESPACE"," ",43],"(",["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_objects",43],["T_WHITESPACE"," ",43],["T_AS","as",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$object",43],")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n            ",43],["T_VARIABLE","$object",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getResource",44],"(",")",["T_OBJECT_OPERATOR","->",44],["T_STRING","beginTransaction",44],"(",")",";",["T_WHITESPACE","\n        ",44],"}",["T_WHITESPACE","\n        ",45],["T_RETURN","return",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],";",["T_WHITESPACE","\n    ",46],"}",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Commit transaction for all resources\n     *\n     * @return $this\n     *\/",49],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","_commitTransaction",54],"(",")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_FOREACH","foreach",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_objects",56],["T_WHITESPACE"," ",56],["T_AS","as",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$object",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$object",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getResource",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","commit",57],"(",")",";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n        ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Rollback transaction\n     *\n     * @return $this\n     *\/",62],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","_rollbackTransaction",67],"(",")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_FOREACH","foreach",69],["T_WHITESPACE"," ",69],"(",["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_objects",69],["T_WHITESPACE"," ",69],["T_AS","as",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$object",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$object",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getResource",70],"(",")",["T_OBJECT_OPERATOR","->",70],["T_STRING","rollBack",70],"(",")",";",["T_WHITESPACE","\n        ",70],"}",["T_WHITESPACE","\n        ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],";",["T_WHITESPACE","\n    ",72],"}",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Run all configured object callbacks\n     *\n     * @return $this\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","_runCallbacks",80],"(",")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_FOREACH","foreach",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_beforeCommitCallbacks",82],["T_WHITESPACE"," ",82],["T_AS","as",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$callback",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_STRING","call_user_func",83],"(",["T_VARIABLE","$callback",83],")",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Adding object for using in transaction\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @param string $alias\n     * @return $this\n     *\/",88],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","addObject",95],"(",["T_NS_SEPARATOR","\\",95],["T_STRING","Magento",95],["T_NS_SEPARATOR","\\",95],["T_STRING","Framework",95],["T_NS_SEPARATOR","\\",95],["T_STRING","Model",95],["T_NS_SEPARATOR","\\",95],["T_STRING","AbstractModel",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$object",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$alias",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","''",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_objects",97],"[","]",["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$object",97],";",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_EMPTY","empty",98],"(",["T_VARIABLE","$alias",98],")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_objectsByAlias",99],"[",["T_VARIABLE","$alias",99],"]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$object",99],";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n        ",100],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Add callback function which will be called before commit transactions\n     *\n     * @param callback $callback\n     * @return $this\n     *\/",104],["T_WHITESPACE","\n    ",109],["T_PUBLIC","public",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","addCommitCallback",110],"(",["T_VARIABLE","$callback",110],")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_beforeCommitCallbacks",112],"[","]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$callback",112],";",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Initialize objects save transaction\n     *\n     * @return $this\n     * @throws \\Exception\n     *\/",116],["T_WHITESPACE","\n    ",121],["T_PUBLIC","public",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","save",122],"(",")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_startTransaction",124],"(",")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$error",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","false",125],";",["T_WHITESPACE","\n\n        ",125],["T_TRY","try",127],["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_FOREACH","foreach",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_objects",128],["T_WHITESPACE"," ",128],["T_AS","as",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$object",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$object",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","save",129],"(",")",";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE"," ",131],["T_CATCH","catch",131],["T_WHITESPACE"," ",131],"(",["T_NS_SEPARATOR","\\",131],["T_STRING","Exception",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$e",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$error",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$e",132],";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n\n        ",133],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$error",135],["T_WHITESPACE"," ",135],["T_IS_IDENTICAL","===",135],["T_WHITESPACE"," ",135],["T_STRING","false",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_TRY","try",136],["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_runCallbacks",137],"(",")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE"," ",138],["T_CATCH","catch",138],["T_WHITESPACE"," ",138],"(",["T_NS_SEPARATOR","\\",138],["T_STRING","Exception",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$e",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n                ",138],["T_VARIABLE","$error",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$e",139],";",["T_WHITESPACE","\n            ",139],"}",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$error",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_rollbackTransaction",144],"(",")",";",["T_WHITESPACE","\n            ",144],["T_THROW","throw",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$error",145],";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE"," ",146],["T_ELSE","else",146],["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_commitTransaction",147],"(",")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n\n        ",148],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Initialize objects delete transaction\n     *\n     * @return $this\n     * @throws \\Exception\n     *\/",153],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","delete",159],"(",")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_startTransaction",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$error",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","false",162],";",["T_WHITESPACE","\n\n        ",162],["T_TRY","try",164],["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_FOREACH","foreach",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_objects",165],["T_WHITESPACE"," ",165],["T_AS","as",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$object",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","delete",166],"(",")",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE"," ",168],["T_CATCH","catch",168],["T_WHITESPACE"," ",168],"(",["T_NS_SEPARATOR","\\",168],["T_STRING","Exception",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$e",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$error",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$e",169],";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$error",172],["T_WHITESPACE"," ",172],["T_IS_IDENTICAL","===",172],["T_WHITESPACE"," ",172],["T_STRING","false",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_TRY","try",173],["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n                ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_runCallbacks",174],"(",")",";",["T_WHITESPACE","\n            ",174],"}",["T_WHITESPACE"," ",175],["T_CATCH","catch",175],["T_WHITESPACE"," ",175],"(",["T_NS_SEPARATOR","\\",175],["T_STRING","Exception",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$e",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$error",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$e",176],";",["T_WHITESPACE","\n            ",176],"}",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n\n        ",178],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$error",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_rollbackTransaction",181],"(",")",";",["T_WHITESPACE","\n            ",181],["T_THROW","throw",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$error",182],";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE"," ",183],["T_ELSE","else",183],["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_commitTransaction",184],"(",")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n",187],"}",["T_WHITESPACE","\n",188]]