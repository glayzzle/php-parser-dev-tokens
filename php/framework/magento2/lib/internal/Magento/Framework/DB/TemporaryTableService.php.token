[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Framework",6],["T_NS_SEPARATOR","\\",6],["T_STRING","DB",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DB",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Adapter",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AdapterInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","DB",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Select",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Class TemporaryTableService creates a temporary table in mysql from a Magento\\Framework\\DB\\Select.\n * Use this class to create an index with that that you want to query later for quick data access\n *\n * @api\n *\/",11],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","TemporaryTableService",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_CONST","const",19],["T_WHITESPACE"," ",19],["T_STRING","INDEX_METHOD_HASH",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'HASH'",19],";",["T_WHITESPACE","\n    ",19],["T_CONST","const",20],["T_WHITESPACE"," ",20],["T_STRING","DB_ENGINE_INNODB",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'INNODB'",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @var string[]\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PRIVATE","private",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$allowedIndexMethods",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var string[]\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PRIVATE","private",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$allowedEngines",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Math\\Random\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$random",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * @var AdapterInterface[]\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PRIVATE","private",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$createdTableAdapters",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],"[","]",";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Math\\Random $random\n     * @param string[] $allowedIndexMethods\n     * @param string[] $allowedEngines\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","__construct",47],"(",["T_WHITESPACE","\n        ",47],["T_NS_SEPARATOR","\\",48],["T_STRING","Magento",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Framework",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Math",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Random",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$random",48],",",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$allowedIndexMethods",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],"[","]",",",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$allowedEngines",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],"[","]",["T_WHITESPACE","\n    ",50],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","random",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$random",52],";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","allowedIndexMethods",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$allowedIndexMethods",53],";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","allowedEngines",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$allowedEngines",54],";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Creates a temporary table from select removing duplicate rows if you have a union in your select\n     * This method should always be paired with dropTable to ensure cleanup\n     * Make sure you index your data so you can query it fast\n     * You can choose from memory or file table and provide indexes to ensure fast data query\n     *\n     * Example: createFromSelect(\n     *           $selectObject,\n     *           $this->resourceConnection->getConnection(),\n     *           [\n     *              'PRIMARY' => ['primary_id'],\n     *              'some_single_field_index' => ['field'],\n     *              'UNQ_some_multiple_field_index' => ['field1', 'field2'],\n     *           ]\n     *          )\n     * Note that indexes names with UNQ_ prefix, will be created as unique\n     *\n     * @param Select $select\n     * @param AdapterInterface $adapter\n     * @param array $indexes\n     * @param string $indexMethod\n     * @param string $dbEngine\n     * @return string\n     * @throws \\InvalidArgumentException\n     *\/",57],["T_WHITESPACE","\n    ",81],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","createFromSelect",82],"(",["T_WHITESPACE","\n        ",82],["T_STRING","Select",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$select",83],",",["T_WHITESPACE","\n        ",83],["T_STRING","AdapterInterface",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$adapter",84],",",["T_WHITESPACE","\n        ",84],["T_ARRAY","array",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$indexes",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],"[","]",",",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$indexMethod",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","self",86],["T_DOUBLE_COLON","::",86],["T_STRING","INDEX_METHOD_HASH",86],",",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$dbEngine",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","self",87],["T_DOUBLE_COLON","::",87],["T_STRING","DB_ENGINE_INNODB",87],["T_WHITESPACE","\n    ",87],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(","!",["T_STRING","in_array",89],"(",["T_VARIABLE","$indexMethod",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","allowedIndexMethods",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_THROW","throw",90],["T_WHITESPACE"," ",90],["T_NEW","new",90],["T_WHITESPACE"," ",90],["T_NS_SEPARATOR","\\",90],["T_STRING","InvalidArgumentException",90],"(",["T_WHITESPACE","\n                ",90],["T_STRING","sprintf",91],"(",["T_CONSTANT_ENCAPSED_STRING","'indexMethod must be one of %s'",91],",",["T_WHITESPACE"," ",91],["T_STRING","implode",91],"(",["T_CONSTANT_ENCAPSED_STRING","','",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","allowedIndexMethods",91],")",")",["T_WHITESPACE","\n            ",91],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n\n        ",93],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_STRING","in_array",95],"(",["T_VARIABLE","$dbEngine",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","allowedEngines",95],")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_THROW","throw",96],["T_WHITESPACE"," ",96],["T_NEW","new",96],["T_WHITESPACE"," ",96],["T_NS_SEPARATOR","\\",96],["T_STRING","InvalidArgumentException",96],"(",["T_WHITESPACE","\n                ",96],["T_STRING","sprintf",97],"(",["T_CONSTANT_ENCAPSED_STRING","'dbEngine must be one of %s'",97],",",["T_WHITESPACE"," ",97],["T_STRING","implode",97],"(",["T_CONSTANT_ENCAPSED_STRING","','",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","allowedEngines",97],")",")",["T_WHITESPACE","\n            ",97],")",";",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE","\n\n        ",99],["T_VARIABLE","$name",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","random",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getUniqueHash",101],"(",["T_CONSTANT_ENCAPSED_STRING","'tmp_select_'",101],")",";",["T_WHITESPACE","\n\n        ",101],["T_VARIABLE","$indexStatements",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],"[","]",";",["T_WHITESPACE","\n        ",103],["T_FOREACH","foreach",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$indexes",104],["T_WHITESPACE"," ",104],["T_AS","as",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$indexName",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$columns",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$renderedColumns",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","implode",105],"(",["T_CONSTANT_ENCAPSED_STRING","','",105],",",["T_WHITESPACE"," ",105],["T_STRING","array_map",105],"(","[",["T_VARIABLE","$adapter",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'quoteIdentifier'",105],"]",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$columns",105],")",")",";",["T_WHITESPACE","\n\n            ",105],["T_VARIABLE","$indexType",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","sprintf",107],"(",["T_WHITESPACE","\n                ",107],["T_CONSTANT_ENCAPSED_STRING","'INDEX %s USING %s'",108],",",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$adapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","quoteIdentifier",109],"(",["T_VARIABLE","$indexName",109],")",",",["T_WHITESPACE","\n                ",109],["T_VARIABLE","$indexMethod",110],["T_WHITESPACE","\n            ",110],")",";",["T_WHITESPACE","\n\n            ",111],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$indexName",113],["T_WHITESPACE"," ",113],["T_IS_IDENTICAL","===",113],["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'PRIMARY'",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$indexType",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'PRIMARY KEY'",114],";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE"," ",115],["T_ELSEIF","elseif",115],["T_WHITESPACE"," ",115],"(",["T_STRING","strpos",115],"(",["T_VARIABLE","$indexName",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'UNQ_'",115],")",["T_WHITESPACE"," ",115],["T_IS_IDENTICAL","===",115],["T_WHITESPACE"," ",115],["T_LNUMBER","0",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$indexType",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","sprintf",116],"(",["T_CONSTANT_ENCAPSED_STRING","'UNIQUE %s'",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$adapter",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","quoteIdentifier",116],"(",["T_VARIABLE","$indexName",116],")",")",";",["T_WHITESPACE","\n            ",116],"}",["T_WHITESPACE","\n\n            ",117],["T_VARIABLE","$indexStatements",119],"[","]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","sprintf",119],"(",["T_CONSTANT_ENCAPSED_STRING","'%s(%s)'",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$indexType",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$renderedColumns",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$statement",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","sprintf",122],"(",["T_WHITESPACE","\n            ",122],["T_CONSTANT_ENCAPSED_STRING","'CREATE TEMPORARY TABLE %s %s ENGINE=%s IGNORE (%s)'",123],",",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$adapter",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","quoteIdentifier",124],"(",["T_VARIABLE","$name",124],")",",",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$indexStatements",125],["T_WHITESPACE"," ",125],"?",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'('",125],["T_WHITESPACE"," ",125],".",["T_WHITESPACE"," ",125],["T_STRING","implode",125],"(",["T_CONSTANT_ENCAPSED_STRING","','",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$indexStatements",125],")",["T_WHITESPACE"," ",125],".",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","')'",125],["T_WHITESPACE"," ",125],":",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","''",125],",",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$adapter",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","quoteIdentifier",126],"(",["T_VARIABLE","$dbEngine",126],")",",",["T_WHITESPACE","\n            ",126],"\"",["T_CURLY_OPEN","{",127],["T_VARIABLE","$select",127],"}","\"",["T_WHITESPACE","\n        ",127],")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$adapter",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","query",130],"(",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$statement",131],",",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$select",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getBind",132],"(",")",["T_WHITESPACE","\n        ",132],")",";",["T_WHITESPACE","\n\n        ",133],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","createdTableAdapters",135],"[",["T_VARIABLE","$name",135],"]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$adapter",135],";",["T_WHITESPACE","\n\n        ",135],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$name",137],";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Method used to drop a table by name\n     * This class will hold all temporary table names in createdTableAdapters array\n     * so we can dispose them once we're finished\n     *\n     * Example: dropTable($name)\n     * where $name is a variable that holds the name for a previously created temporary  table\n     * by using \"createFromSelect\" method\n     *\n     * @param string $name\n     * @return bool\n     *\/",140],["T_WHITESPACE","\n    ",151],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","dropTable",152],"(",["T_VARIABLE","$name",152],")",["T_WHITESPACE","\n    ",152],"{",["T_WHITESPACE","\n        ",153],["T_IF","if",154],["T_WHITESPACE"," ",154],"(","!",["T_EMPTY","empty",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","createdTableAdapters",154],")",")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_IF","if",155],["T_WHITESPACE"," ",155],"(",["T_ISSET","isset",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","createdTableAdapters",155],"[",["T_VARIABLE","$name",155],"]",")",["T_WHITESPACE"," ",155],["T_BOOLEAN_AND","&&",155],["T_WHITESPACE"," ",155],"!",["T_EMPTY","empty",155],"(",["T_VARIABLE","$name",155],")",")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                ",155],["T_VARIABLE","$adapter",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","createdTableAdapters",156],"[",["T_VARIABLE","$name",156],"]",";",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$adapter",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","dropTemporaryTable",157],"(",["T_VARIABLE","$name",157],")",";",["T_WHITESPACE","\n                ",157],["T_UNSET","unset",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","createdTableAdapters",158],"[",["T_VARIABLE","$name",158],"]",")",";",["T_WHITESPACE","\n                ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_STRING","true",159],";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n        ",161],["T_RETURN","return",162],["T_WHITESPACE"," ",162],["T_STRING","false",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n",163],"}",["T_WHITESPACE","\n",164]]