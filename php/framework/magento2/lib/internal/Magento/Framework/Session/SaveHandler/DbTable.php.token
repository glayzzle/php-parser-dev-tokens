[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Framework",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Session",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SaveHandler",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","App",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ResourceConnection",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Exception",9],["T_NS_SEPARATOR","\\",9],["T_STRING","SessionException",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Phrase",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Data base session save handler\n *\/",12],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","DbTable",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_NS_SEPARATOR","\\",15],["T_STRING","SessionHandler",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * Session data table name\n     *\n     * @var string\n     *\/",17],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$_sessionTable",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * Database write connection\n     *\n     * @var \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",24],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$connection",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param \\Magento\\Framework\\App\\ResourceConnection $resource\n     *\/",31],["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","__construct",36],"(",["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Framework",36],["T_NS_SEPARATOR","\\",36],["T_STRING","App",36],["T_NS_SEPARATOR","\\",36],["T_STRING","ResourceConnection",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$resource",36],")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_sessionTable",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$resource",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getTableName",38],"(",["T_CONSTANT_ENCAPSED_STRING","'session'",38],")",";",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","connection",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$resource",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","getConnection",39],"(",")",";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","checkConnection",40],"(",")",";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Check DB connection\n     *\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\SessionException\n     *\/",43],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_FUNCTION","function",49],["T_WHITESPACE"," ",49],["T_STRING","checkConnection",49],"(",")",["T_WHITESPACE","\n    ",49],"{",["T_WHITESPACE","\n        ",50],["T_IF","if",51],["T_WHITESPACE"," ",51],"(","!",["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","connection",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_THROW","throw",52],["T_WHITESPACE"," ",52],["T_NEW","new",52],["T_WHITESPACE"," ",52],["T_STRING","SessionException",52],"(",["T_NEW","new",52],["T_WHITESPACE"," ",52],["T_STRING","Phrase",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Write DB connection is not available'",52],")",")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","connection",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","isTableExists",54],"(",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_sessionTable",54],")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_THROW","throw",55],["T_WHITESPACE"," ",55],["T_NEW","new",55],["T_WHITESPACE"," ",55],["T_STRING","SessionException",55],"(",["T_NEW","new",55],["T_WHITESPACE"," ",55],["T_STRING","Phrase",55],"(",["T_CONSTANT_ENCAPSED_STRING","'DB storage table does not exist'",55],")",")",";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Open session\n     *\n     * @param string $savePath ignored\n     * @param string $sessionName ignored\n     * @return bool\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",59],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","open",67],"(",["T_VARIABLE","$savePath",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$sessionName",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_STRING","true",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Close session\n     *\n     * @return bool\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","close",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_STRING","true",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Fetch session data\n     *\n     * @param string $sessionId\n     * @return string\n     *\/",82],["T_WHITESPACE","\n    ",87],["T_PUBLIC","public",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","read",88],"(",["T_VARIABLE","$sessionId",88],")",["T_WHITESPACE","\n    ",88],"{",["T_WHITESPACE","\n        ",89],["T_COMMENT","\/\/ need to use write connection to get the most fresh DB sessions\n",90],["T_WHITESPACE","        ",91],["T_VARIABLE","$select",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","connection",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","select",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","from",91],"(",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_sessionTable",92],",",["T_WHITESPACE","\n            ",92],"[",["T_CONSTANT_ENCAPSED_STRING","'session_data'",93],"]",["T_WHITESPACE","\n        ",93],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","where",94],"(",["T_WHITESPACE","\n            ",94],["T_CONSTANT_ENCAPSED_STRING","'session_id = :session_id'",95],["T_WHITESPACE","\n        ",95],")",";",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$bind",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],"[",["T_CONSTANT_ENCAPSED_STRING","'session_id'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$sessionId",97],"]",";",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$data",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","connection",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","fetchOne",98],"(",["T_VARIABLE","$select",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$bind",98],")",";",["T_WHITESPACE","\n\n        ",98],["T_COMMENT","\/\/ check if session data is a base64 encoded string\n",100],["T_WHITESPACE","        ",101],["T_VARIABLE","$decodedData",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","base64_decode",101],"(",["T_VARIABLE","$data",101],",",["T_WHITESPACE"," ",101],["T_STRING","true",101],")",";",["T_WHITESPACE","\n        ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_VARIABLE","$decodedData",102],["T_WHITESPACE"," ",102],["T_IS_NOT_IDENTICAL","!==",102],["T_WHITESPACE"," ",102],["T_STRING","false",102],")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$data",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$decodedData",103],";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$data",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Update session\n     *\n     * @param string $sessionId\n     * @param string $sessionData\n     * @return bool\n     *\/",108],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","write",115],"(",["T_VARIABLE","$sessionId",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$sessionData",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_COMMENT","\/\/ need to use write connection to get the most fresh DB sessions\n",117],["T_WHITESPACE","        ",118],["T_VARIABLE","$bindValues",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],"[",["T_CONSTANT_ENCAPSED_STRING","'session_id'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$sessionId",118],"]",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$select",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","connection",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","select",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","from",119],"(",["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_sessionTable",119],")",["T_OBJECT_OPERATOR","->",119],["T_STRING","where",119],"(",["T_CONSTANT_ENCAPSED_STRING","'session_id = :session_id'",119],")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$exists",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","connection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","fetchOne",120],"(",["T_VARIABLE","$select",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$bindValues",120],")",";",["T_WHITESPACE","\n\n        ",120],["T_COMMENT","\/\/ encode session serialized data to prevent insertion of incorrect symbols\n",122],["T_WHITESPACE","        ",123],["T_VARIABLE","$sessionData",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","base64_encode",123],"(",["T_VARIABLE","$sessionData",123],")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$bind",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],"[",["T_CONSTANT_ENCAPSED_STRING","'session_expires'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_STRING","time",124],"(",")",",",["T_WHITESPACE"," ",124],["T_CONSTANT_ENCAPSED_STRING","'session_data'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$sessionData",124],"]",";",["T_WHITESPACE","\n\n        ",124],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$exists",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","connection",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","update",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_sessionTable",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$bind",127],",",["T_WHITESPACE"," ",127],"[",["T_CONSTANT_ENCAPSED_STRING","'session_id=?'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$sessionId",127],"]",")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE"," ",128],["T_ELSE","else",128],["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$bind",129],"[",["T_CONSTANT_ENCAPSED_STRING","'session_id'",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$sessionId",129],";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","connection",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","insert",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_sessionTable",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$bind",130],")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n        ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_STRING","true",132],";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Destroy session\n     *\n     * @param string $sessionId\n     * @return bool\n     *\/",135],["T_WHITESPACE","\n    ",140],["T_PUBLIC","public",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","destroy",141],"(",["T_VARIABLE","$sessionId",141],")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$where",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],"[",["T_CONSTANT_ENCAPSED_STRING","'session_id = ?'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$sessionId",143],"]",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","connection",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","delete",144],"(",["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_sessionTable",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$where",144],")",";",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_STRING","true",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Garbage collection\n     *\n     * @param int $maxLifeTime\n     * @return bool\n     * @SuppressWarnings(PHPMD.ShortMethodName)\n     *\/",148],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","gc",155],"(",["T_VARIABLE","$maxLifeTime",155],")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$where",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],"[",["T_CONSTANT_ENCAPSED_STRING","'session_expires < ?'",157],["T_WHITESPACE"," ",157],["T_DOUBLE_ARROW","=>",157],["T_WHITESPACE"," ",157],["T_STRING","time",157],"(",")",["T_WHITESPACE"," ",157],"-",["T_WHITESPACE"," ",157],["T_VARIABLE","$maxLifeTime",157],"]",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","connection",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","delete",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_sessionTable",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$where",158],")",";",["T_WHITESPACE","\n        ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_STRING","true",159],";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n",160],"}",["T_WHITESPACE","\n",161]]