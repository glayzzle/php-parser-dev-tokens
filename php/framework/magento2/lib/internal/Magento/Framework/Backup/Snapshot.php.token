[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Class to work with full filesystem and database backups\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Backup",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","App",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Filesystem",14],["T_NS_SEPARATOR","\\",14],["T_STRING","DirectoryList",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Filesystem",15],["T_WHITESPACE"," ",15],["T_AS","as",15],["T_WHITESPACE"," ",15],["T_STRING","AppFilesystem",15],";",["T_WHITESPACE","\n\n",15],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","Snapshot",17],["T_WHITESPACE"," ",17],["T_EXTENDS","extends",17],["T_WHITESPACE"," ",17],["T_STRING","Filesystem",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_DOC_COMMENT","\/**\n     * Database backup manager\n     *\n     * @var Db\n     *\/",19],["T_WHITESPACE","\n    ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$_dbBackupManager",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * Filesystem facade\n     *\n     * @var AppFilesystem\n     *\/",26],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$_filesystem",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var Factory\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_backupFactory",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @param AppFilesystem $filesystem\n     * @param Factory $backupFactory\n     *\/",38],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","__construct",42],"(",["T_STRING","AppFilesystem",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$filesystem",42],",",["T_WHITESPACE"," ",42],["T_STRING","Factory",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$backupFactory",42],")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","_filesystem",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$filesystem",44],";",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_backupFactory",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$backupFactory",45],";",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Implementation Rollback functionality for Snapshot\n     *\n     * @throws \\Exception\n     * @return bool\n     *\/",48],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","rollback",54],"(",")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$result",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","parent",56],["T_DOUBLE_COLON","::",56],["T_STRING","rollback",56],"(",")",";",["T_WHITESPACE","\n\n        ",56],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_lastOperationSucceed",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","false",58],";",["T_WHITESPACE","\n\n        ",58],["T_TRY","try",60],["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_getDbBackupManager",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","rollback",61],"(",")",";",["T_WHITESPACE","\n        ",61],"}",["T_WHITESPACE"," ",62],["T_CATCH","catch",62],["T_WHITESPACE"," ",62],"(",["T_NS_SEPARATOR","\\",62],["T_STRING","Exception",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$e",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","_removeDbBackup",63],"(",")",";",["T_WHITESPACE","\n            ",63],["T_THROW","throw",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$e",64],";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n\n        ",65],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_removeDbBackup",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_lastOperationSucceed",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","true",68],";",["T_WHITESPACE","\n\n        ",68],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$result",70],";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * Implementation Create Backup functionality for Snapshot\n     *\n     * @throws \\Exception\n     * @return bool\n     *\/",73],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","create",79],"(",")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_getDbBackupManager",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","create",81],"(",")",";",["T_WHITESPACE","\n\n        ",81],["T_TRY","try",83],["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$result",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","parent",84],["T_DOUBLE_COLON","::",84],["T_STRING","create",84],"(",")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE"," ",85],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_NS_SEPARATOR","\\",85],["T_STRING","Exception",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_removeDbBackup",86],"(",")",";",["T_WHITESPACE","\n            ",86],["T_THROW","throw",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$e",87],";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_lastOperationSucceed",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","false",90],";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_removeDbBackup",91],"(",")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_lastOperationSucceed",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","true",92],";",["T_WHITESPACE","\n\n        ",92],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$result",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Overlap getType\n     *\n     * @return string\n     * @see BackupInterface::getType()\n     *\/",97],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getType",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'snapshot'",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Create Db Instance\n     *\n     * @return BackupInterface\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","_createDbBackupInstance",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_backupFactory",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","create",115],"(",["T_STRING","Factory",115],["T_DOUBLE_COLON","::",115],["T_STRING","TYPE_DB",115],")",["T_WHITESPACE","\n            ",115],["T_OBJECT_OPERATOR","->",116],["T_STRING","setBackupExtension",116],"(",["T_CONSTANT_ENCAPSED_STRING","'sql'",116],")",["T_WHITESPACE","\n            ",116],["T_OBJECT_OPERATOR","->",117],["T_STRING","setTime",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getTime",117],"(",")",")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","setBackupsDir",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_filesystem",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getDirectoryWrite",118],"(",["T_STRING","DirectoryList",118],["T_DOUBLE_COLON","::",118],["T_STRING","VAR_DIR",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","getAbsolutePath",118],"(",")",")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","setResourceModel",119],"(",["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getResourceModel",119],"(",")",")",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Get database backup manager\n     *\n     * @return Db\n     *\/",122],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_getDbBackupManager",127],"(",")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_dbBackupManager",129],["T_WHITESPACE"," ",129],["T_IS_IDENTICAL","===",129],["T_WHITESPACE"," ",129],["T_STRING","null",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_dbBackupManager",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_createDbBackupInstance",130],"(",")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n\n        ",131],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_dbBackupManager",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Set Db backup manager\n     *\n     * @param AbstractBackup $manager\n     * @return $this\n     *\/",136],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","setDbBackupManager",142],"(",["T_STRING","AbstractBackup",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$manager",142],")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_dbBackupManager",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$manager",144],";",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Get Db Backup Filename\n     *\n     * @return string\n     *\/",148],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","getDbBackupFilename",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_getDbBackupManager",155],"(",")",["T_OBJECT_OPERATOR","->",155],["T_STRING","getBackupFilename",155],"(",")",";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Remove Db backup after added it to the snapshot\n     *\n     * @return $this\n     *\/",158],["T_WHITESPACE","\n    ",162],["T_PROTECTED","protected",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","_removeDbBackup",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],"@",["T_STRING","unlink",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_getDbBackupManager",165],"(",")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getBackupPath",165],"(",")",")",";",["T_WHITESPACE","\n        ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n",167],"}",["T_WHITESPACE","\n",168]]