[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Category",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Flat",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Action",6],";",["T_WHITESPACE","\n\n",6],["T_CLASS","class",8],["T_WHITESPACE"," ",8],["T_STRING","Full",8],["T_WHITESPACE"," ",8],["T_EXTENDS","extends",8],["T_WHITESPACE"," ",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Indexer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Category",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Flat",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractAction",8],["T_WHITESPACE","\n",8],"{",["T_WHITESPACE","\n    ",9],["T_DOC_COMMENT","\/**\n     * Suffix for table to show it is old\n     *\/",10],["T_WHITESPACE","\n    ",12],["T_CONST","const",13],["T_WHITESPACE"," ",13],["T_STRING","OLD_TABLE_SUFFIX",13],["T_WHITESPACE"," ",13],"=",["T_WHITESPACE"," ",13],["T_CONSTANT_ENCAPSED_STRING","'_old'",13],";",["T_WHITESPACE","\n\n    ",13],["T_DOC_COMMENT","\/**\n     * Whether table changes are allowed\n     *\n     * @var bool\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$allowTableChanges",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_STRING","true",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * Add suffix to table name to show it is old\n     *\n     * @param string $tableName\n     * @return string\n     *\/",22],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_FUNCTION","function",28],["T_WHITESPACE"," ",28],["T_STRING","addOldTableSuffix",28],"(",["T_VARIABLE","$tableName",28],")",["T_WHITESPACE","\n    ",28],"{",["T_WHITESPACE","\n        ",29],["T_RETURN","return",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$tableName",30],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_STRING","self",30],["T_DOUBLE_COLON","::",30],["T_STRING","OLD_TABLE_SUFFIX",30],";",["T_WHITESPACE","\n    ",30],"}",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * Populate category flat tables with data\n     *\n     * @param \\Magento\\Store\\Model\\Store[] $stores\n     * @return Full\n     *\/",33],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","populateFlatTables",39],"(",["T_ARRAY","array",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$stores",39],")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$rootId",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Magento",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Catalog",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Model",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Category",41],["T_DOUBLE_COLON","::",41],["T_STRING","TREE_ROOT_ID",41],";",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$categories",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],"[","]",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$categoriesIds",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],"[","]",";",["T_WHITESPACE","\n        ",43],["T_COMMENT","\/* @var $store \\Magento\\Store\\Model\\Store *\/",44],["T_WHITESPACE","\n        ",44],["T_FOREACH","foreach",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$stores",45],["T_WHITESPACE"," ",45],["T_AS","as",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$store",45],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n            ",45],["T_IF","if",46],["T_WHITESPACE"," ",46],"(","!",["T_ISSET","isset",46],"(",["T_VARIABLE","$categories",46],"[",["T_VARIABLE","$store",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getRootCategoryId",46],"(",")","]",")",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n                ",46],["T_VARIABLE","$select",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","connection",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","select",47],"(",")",["T_OBJECT_OPERATOR","->",47],["T_STRING","from",47],"(",["T_WHITESPACE","\n                    ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","connection",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getTableName",48],"(",["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getTableName",48],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_entity'",48],")",")",["T_WHITESPACE","\n                ",48],")",["T_OBJECT_OPERATOR","->",49],["T_STRING","where",49],"(",["T_WHITESPACE","\n                    ",49],["T_CONSTANT_ENCAPSED_STRING","'path = ?'",50],",",["T_WHITESPACE","\n                    ",50],["T_STRING_CAST","(string)",51],["T_VARIABLE","$rootId",51],["T_WHITESPACE","\n                ",51],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","orWhere",52],"(",["T_WHITESPACE","\n                    ",52],["T_CONSTANT_ENCAPSED_STRING","'path = ?'",53],",",["T_WHITESPACE","\n                    ",53],"\"",["T_CURLY_OPEN","{",54],["T_VARIABLE","$rootId",54],"}",["T_ENCAPSED_AND_WHITESPACE","\/",54],["T_CURLY_OPEN","{",54],["T_VARIABLE","$store",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getRootCategoryId",54],"(",")","}","\"",["T_WHITESPACE","\n                ",54],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","orWhere",55],"(",["T_WHITESPACE","\n                    ",55],["T_CONSTANT_ENCAPSED_STRING","'path LIKE ?'",56],",",["T_WHITESPACE","\n                    ",56],"\"",["T_CURLY_OPEN","{",57],["T_VARIABLE","$rootId",57],"}",["T_ENCAPSED_AND_WHITESPACE","\/",57],["T_CURLY_OPEN","{",57],["T_VARIABLE","$store",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getRootCategoryId",57],"(",")","}",["T_ENCAPSED_AND_WHITESPACE","\/%",57],"\"",["T_WHITESPACE","\n                ",57],")",";",["T_WHITESPACE","\n                ",58],["T_VARIABLE","$categories",59],"[",["T_VARIABLE","$store",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getRootCategoryId",59],"(",")","]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","connection",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","fetchAll",59],"(",["T_VARIABLE","$select",59],")",";",["T_WHITESPACE","\n                ",59],["T_VARIABLE","$categoriesIds",60],"[",["T_VARIABLE","$store",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getRootCategoryId",60],"(",")","]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],"[","]",";",["T_WHITESPACE","\n                ",60],["T_FOREACH","foreach",61],["T_WHITESPACE"," ",61],"(",["T_VARIABLE","$categories",61],"[",["T_VARIABLE","$store",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getRootCategoryId",61],"(",")","]",["T_WHITESPACE"," ",61],["T_AS","as",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$category",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n                    ",61],["T_VARIABLE","$categoriesIds",62],"[",["T_VARIABLE","$store",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getRootCategoryId",62],"(",")","]","[","]",["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$category",62],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",62],"]",";",["T_WHITESPACE","\n                ",62],"}",["T_WHITESPACE","\n            ",63],"}",["T_WHITESPACE","\n            ",64],["T_DOC_COMMENT","\/** @TODO Do something with chunks *\/",65],["T_WHITESPACE","\n            ",65],["T_VARIABLE","$categoriesIdsChunks",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","array_chunk",66],"(",["T_VARIABLE","$categoriesIds",66],"[",["T_VARIABLE","$store",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getRootCategoryId",66],"(",")","]",",",["T_WHITESPACE"," ",66],["T_LNUMBER","500",66],")",";",["T_WHITESPACE","\n            ",66],["T_FOREACH","foreach",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$categoriesIdsChunks",67],["T_WHITESPACE"," ",67],["T_AS","as",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$categoriesIdsChunk",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                ",67],["T_VARIABLE","$attributesData",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getAttributeValues",68],"(",["T_VARIABLE","$categoriesIdsChunk",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$store",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getId",68],"(",")",")",";",["T_WHITESPACE","\n                ",68],["T_VARIABLE","$data",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],"[","]",";",["T_WHITESPACE","\n                ",69],["T_FOREACH","foreach",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$categories",70],"[",["T_VARIABLE","$store",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getRootCategoryId",70],"(",")","]",["T_WHITESPACE"," ",70],["T_AS","as",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$category",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                    ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_ISSET","isset",71],"(",["T_VARIABLE","$attributesData",71],"[",["T_VARIABLE","$category",71],"[",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","categoryMetadata",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getLinkField",71],"(",")","]","]",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                        ",71],["T_CONTINUE","continue",72],";",["T_WHITESPACE","\n                    ",72],"}",["T_WHITESPACE","\n                    ",73],["T_VARIABLE","$category",74],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",74],"]",["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$store",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getId",74],"(",")",";",["T_WHITESPACE","\n                    ",74],["T_VARIABLE","$data",75],"[","]",["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","prepareValuesToInsert",75],"(",["T_WHITESPACE","\n                        ",75],["T_STRING","array_merge",76],"(",["T_VARIABLE","$category",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$attributesData",76],"[",["T_VARIABLE","$category",76],"[",["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","categoryMetadata",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getLinkField",76],"(",")","]","]",")",["T_WHITESPACE","\n                    ",76],")",";",["T_WHITESPACE","\n                ",77],"}",["T_WHITESPACE","\n                ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","connection",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","insertMultiple",79],"(",["T_WHITESPACE","\n                    ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","addTemporaryTableSuffix",80],"(",["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getMainStoreTable",80],"(",["T_VARIABLE","$store",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getId",80],"(",")",")",")",",",["T_WHITESPACE","\n                    ",80],["T_VARIABLE","$data",81],["T_WHITESPACE","\n                ",81],")",";",["T_WHITESPACE","\n            ",82],"}",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n\n        ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Create table and add attributes as fields for specified store.\n     * This routine assumes that DDL operations are allowed\n     *\n     * @param int $store\n     * @return Full\n     *\/",89],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","createTable",96],"(",["T_VARIABLE","$store",96],")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$temporaryTable",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","addTemporaryTableSuffix",98],"(",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getMainStoreTable",98],"(",["T_VARIABLE","$store",98],")",")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$table",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getFlatTableStructure",99],"(",["T_VARIABLE","$temporaryTable",99],")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","connection",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","dropTable",100],"(",["T_VARIABLE","$temporaryTable",100],")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","connection",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","createTable",101],"(",["T_VARIABLE","$table",101],")",";",["T_WHITESPACE","\n\n        ",101],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Create category flat tables and add attributes as fields.\n     * Tables are created only if DDL operations are allowed\n     *\n     * @param \\Magento\\Store\\Model\\Store[] $stores if empty, create tables for all stores of the application\n     * @return Full\n     *\/",106],["T_WHITESPACE","\n    ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","createTables",113],"(",["T_ARRAY","array",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$stores",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],"[","]",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","connection",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getTransactionLevel",115],"(",")",["T_WHITESPACE"," ",115],">",["T_WHITESPACE"," ",115],["T_LNUMBER","0",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_EMPTY","empty",118],"(",["T_VARIABLE","$stores",118],")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$stores",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","storeManager",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getStores",119],"(",")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_COMMENT","\/* @var $store \\Magento\\Store\\Model\\Store *\/",121],["T_WHITESPACE","\n        ",121],["T_FOREACH","foreach",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$stores",122],["T_WHITESPACE"," ",122],["T_AS","as",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$store",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","createTable",123],"(",["T_VARIABLE","$store",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getId",123],"(",")",")",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Switch table (temporary becomes active, old active will be dropped)\n     *\n     * @param \\Magento\\Store\\Model\\Store[] $stores\n     * @return Full\n     *\/",129],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","switchTables",135],"(",["T_ARRAY","array",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$stores",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],"[","]",")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_DOC_COMMENT","\/** @var $store \\Magento\\Store\\Model\\Store *\/",137],["T_WHITESPACE","\n        ",137],["T_FOREACH","foreach",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$stores",138],["T_WHITESPACE"," ",138],["T_AS","as",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$store",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$activeTableName",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getMainStoreTable",139],"(",["T_VARIABLE","$store",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getId",139],"(",")",")",";",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$temporaryTableName",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","addTemporaryTableSuffix",140],"(",["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getMainStoreTable",140],"(",["T_VARIABLE","$store",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getId",140],"(",")",")",")",";",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$oldTableName",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","addOldTableSuffix",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getMainStoreTable",141],"(",["T_VARIABLE","$store",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getId",141],"(",")",")",")",";",["T_WHITESPACE","\n\n            ",141],["T_COMMENT","\/\/switch tables\n",143],["T_WHITESPACE","            ",144],["T_VARIABLE","$tablesToRename",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],"[","]",";",["T_WHITESPACE","\n            ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","connection",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","isTableExists",145],"(",["T_VARIABLE","$activeTableName",145],")",")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$tablesToRename",146],"[","]",["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],"[",["T_CONSTANT_ENCAPSED_STRING","'oldName'",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$activeTableName",146],",",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'newName'",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$oldTableName",146],"]",";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n\n            ",147],["T_VARIABLE","$tablesToRename",149],"[","]",["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],"[",["T_CONSTANT_ENCAPSED_STRING","'oldName'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$temporaryTableName",149],",",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'newName'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$activeTableName",149],"]",";",["T_WHITESPACE","\n\n            ",149],["T_FOREACH","foreach",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$tablesToRename",151],["T_WHITESPACE"," ",151],["T_AS","as",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$tableToRename",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","connection",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","renameTable",152],"(",["T_VARIABLE","$tableToRename",152],"[",["T_CONSTANT_ENCAPSED_STRING","'oldName'",152],"]",",",["T_WHITESPACE"," ",152],["T_VARIABLE","$tableToRename",152],"[",["T_CONSTANT_ENCAPSED_STRING","'newName'",152],"]",")",";",["T_WHITESPACE","\n            ",152],"}",["T_WHITESPACE","\n\n            ",153],["T_COMMENT","\/\/delete inactive table\n",155],["T_WHITESPACE","            ",156],["T_VARIABLE","$tableToDelete",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$oldTableName",156],";",["T_WHITESPACE","\n\n            ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","connection",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","isTableExists",158],"(",["T_VARIABLE","$tableToDelete",158],")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","connection",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","dropTable",159],"(",["T_VARIABLE","$tableToDelete",159],")",";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n\n        ",161],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Transactional rebuild flat data from eav\n     *\n     * @return Full\n     *\/",166],["T_WHITESPACE","\n    ",170],["T_PUBLIC","public",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","reindexAll",171],"(",")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","createTables",173],"(",")",";",["T_WHITESPACE","\n\n        ",173],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","allowTableChanges",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","allowTableChanges",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_STRING","false",176],";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$stores",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","storeManager",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getStores",178],"(",")",";",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","populateFlatTables",179],"(",["T_VARIABLE","$stores",179],")",";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","switchTables",180],"(",["T_VARIABLE","$stores",180],")",";",["T_WHITESPACE","\n\n        ",180],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","allowTableChanges",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","true",182],";",["T_WHITESPACE","\n\n        ",182],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n",185],"}",["T_WHITESPACE","\n",186]]