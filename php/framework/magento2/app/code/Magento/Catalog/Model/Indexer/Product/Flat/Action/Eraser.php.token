[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Flat item ereaser. Used to clear items from flat table\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",7],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Indexer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Product",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Flat",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Action",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","App",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ResourceConnection",10],";",["T_WHITESPACE","\n\n",10],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","Eraser",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Helper\\Product\\Flat\\Indexer\n     *\/",14],["T_WHITESPACE","\n    ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$productIndexerHelper",17],";",["T_WHITESPACE","\n\n    ",17],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",19],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$connection",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$storeManager",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\App\\ResourceConnection $resource\n     * @param \\Magento\\Catalog\\Helper\\Product\\Flat\\Indexer $productHelper\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","__construct",34],"(",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Framework",35],["T_NS_SEPARATOR","\\",35],["T_STRING","App",35],["T_NS_SEPARATOR","\\",35],["T_STRING","ResourceConnection",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$resource",35],",",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Catalog",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Helper",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Product",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Flat",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Indexer",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$productHelper",36],",",["T_WHITESPACE","\n        ",36],["T_NS_SEPARATOR","\\",37],["T_STRING","Magento",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Store",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Model",37],["T_NS_SEPARATOR","\\",37],["T_STRING","StoreManagerInterface",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$storeManager",37],["T_WHITESPACE","\n    ",37],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","productIndexerHelper",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$productHelper",39],";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","connection",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$resource",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getConnection",40],"(",")",";",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","storeManager",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$storeManager",41],";",["T_WHITESPACE","\n    ",41],"}",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Remove products from flat that are not exist\n     *\n     * @param array $ids\n     * @param int $storeId\n     * @return void\n     *\/",44],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","removeDeletedProducts",51],"(",["T_ARRAY","array",51],["T_WHITESPACE"," ",51],"&",["T_VARIABLE","$ids",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$storeId",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$select",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","connection",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","select",53],"(",")",["T_OBJECT_OPERATOR","->",53],["T_STRING","from",53],"(",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","productIndexerHelper",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getTable",54],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",54],")",["T_WHITESPACE","\n        ",54],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","where",55],"(",["T_WHITESPACE","\n            ",55],["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",56],",",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$ids",57],["T_WHITESPACE","\n        ",57],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$result",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","connection",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","query",59],"(",["T_VARIABLE","$select",59],")",";",["T_WHITESPACE","\n\n        ",59],["T_VARIABLE","$existentProducts",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],"[","]",";",["T_WHITESPACE","\n        ",61],["T_FOREACH","foreach",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$result",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","fetchAll",62],"(",")",["T_WHITESPACE"," ",62],["T_AS","as",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$product",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$existentProducts",63],"[","]",["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$product",63],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",63],"]",";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE","\n\n        ",64],["T_VARIABLE","$productsToDelete",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","array_diff",66],"(",["T_VARIABLE","$ids",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$existentProducts",66],")",";",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$ids",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$existentProducts",67],";",["T_WHITESPACE","\n\n        ",67],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","deleteProductsFromStore",69],"(",["T_VARIABLE","$productsToDelete",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$storeId",69],")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Delete products from flat table(s)\n     *\n     * @param int|array $productId\n     * @param null|int $storeId\n     * @return void\n     *\/",72],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","deleteProductsFromStore",79],"(",["T_VARIABLE","$productId",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$storeId",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","null",79],")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(","!",["T_STRING","is_array",81],"(",["T_VARIABLE","$productId",81],")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$productId",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],"[",["T_VARIABLE","$productId",82],"]",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n        ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_STRING","null",84],["T_WHITESPACE"," ",84],["T_IS_IDENTICAL","===",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$storeId",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_FOREACH","foreach",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","storeManager",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getStores",85],"(",")",["T_WHITESPACE"," ",85],["T_AS","as",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$store",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","connection",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","delete",86],"(",["T_WHITESPACE","\n                    ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","productIndexerHelper",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getFlatTableName",87],"(",["T_VARIABLE","$store",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")",")",",",["T_WHITESPACE","\n                    ",87],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$productId",88],"]",["T_WHITESPACE","\n                ",88],")",";",["T_WHITESPACE","\n            ",89],"}",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE"," ",91],["T_ELSE","else",91],["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","connection",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","delete",92],"(",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","productIndexerHelper",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getFlatTableName",93],"(",["T_INT_CAST","(int)",93],["T_VARIABLE","$storeId",93],")",",",["T_WHITESPACE","\n                ",93],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$productId",94],"]",["T_WHITESPACE","\n            ",94],")",";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n",97],"}",["T_WHITESPACE","\n",98]]