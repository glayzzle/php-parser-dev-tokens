[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Price",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ResourceModel",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Product",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Indexer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractIndexer",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Default Product Type Price Indexer Resource model\n * For correctly work need define product type id\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",10],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","DefaultPrice",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","AbstractIndexer",16],["T_WHITESPACE"," ",16],["T_IMPLEMENTS","implements",16],["T_WHITESPACE"," ",16],["T_STRING","PriceInterface",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * Product type code\n     *\n     * @var string\n     *\/",18],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_typeId",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Product Type is composite flag\n     *\n     * @var bool\n     *\/",25],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$_isComposite",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_STRING","false",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Core data\n     *\n     * @var \\Magento\\Framework\\Module\\Manager\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$moduleManager",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Core event manager proxy\n     *\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_eventManager",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","null",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Indexer\\Table\\StrategyInterface $tableStrategy\n     * @param \\Magento\\Eav\\Model\\Config $eavConfig\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param \\Magento\\Framework\\Module\\Manager $moduleManager\n     * @param string $connectionName\n     *\/",46],["T_WHITESPACE","\n    ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","__construct",56],"(",["T_WHITESPACE","\n        ",56],["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Framework",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Model",57],["T_NS_SEPARATOR","\\",57],["T_STRING","ResourceModel",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Db",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Context",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$context",57],",",["T_WHITESPACE","\n        ",57],["T_NS_SEPARATOR","\\",58],["T_STRING","Magento",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Framework",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Indexer",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Table",58],["T_NS_SEPARATOR","\\",58],["T_STRING","StrategyInterface",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$tableStrategy",58],",",["T_WHITESPACE","\n        ",58],["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Eav",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Model",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Config",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$eavConfig",59],",",["T_WHITESPACE","\n        ",59],["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Framework",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Event",60],["T_NS_SEPARATOR","\\",60],["T_STRING","ManagerInterface",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$eventManager",60],",",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Magento",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Framework",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Module",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Manager",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$moduleManager",61],",",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$connectionName",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","null",62],["T_WHITESPACE","\n    ",62],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_eventManager",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$eventManager",64],";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","moduleManager",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$moduleManager",65],";",["T_WHITESPACE","\n        ",65],["T_STRING","parent",66],["T_DOUBLE_COLON","::",66],["T_STRING","__construct",66],"(",["T_VARIABLE","$context",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$tableStrategy",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$eavConfig",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$connectionName",66],")",";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Get Table strategy\n     *\n     * @return \\Magento\\Framework\\Indexer\\Table\\StrategyInterface\n     *\/",69],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","getTableStrategy",74],"(",")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","tableStrategy",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Define main price index table\n     *\n     * @return void\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","_construct",84],"(",")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_init",86],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",86],")",";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Set Product Type code\n     *\n     * @param string $typeCode\n     * @return $this\n     *\/",89],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","setTypeId",95],"(",["T_VARIABLE","$typeCode",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_typeId",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$typeCode",97],";",["T_WHITESPACE","\n        ",97],["T_RETURN","return",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * Retrieve Product Type Code\n     *\n     * @return string\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",101],["T_WHITESPACE","\n    ",106],["T_PUBLIC","public",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","getTypeId",107],"(",")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_typeId",109],["T_WHITESPACE"," ",109],["T_IS_IDENTICAL","===",109],["T_WHITESPACE"," ",109],["T_STRING","null",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_THROW","throw",110],["T_WHITESPACE"," ",110],["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Magento",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Framework",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Exception",110],["T_NS_SEPARATOR","\\",110],["T_STRING","LocalizedException",110],"(",["T_WHITESPACE","\n                ",110],["T_STRING","__",111],"(",["T_CONSTANT_ENCAPSED_STRING","'A product type is not defined for the indexer.'",111],")",["T_WHITESPACE","\n            ",111],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n        ",113],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_typeId",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Set Product Type Composite flag\n     *\n     * @param bool $flag\n     * @return $this\n     *\/",117],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","setIsComposite",123],"(",["T_VARIABLE","$flag",123],")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_isComposite",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_BOOL_CAST","(bool)",125],["T_VARIABLE","$flag",125],";",["T_WHITESPACE","\n        ",125],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Check product type is composite\n     *\n     * @return bool\n     * @SuppressWarnings(PHPMD.BooleanGetMethodName)\n     *\/",129],["T_WHITESPACE","\n    ",134],["T_PUBLIC","public",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","getIsComposite",135],"(",")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_isComposite",137],";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for all products\n     *\n     * @return $this\n     * @throws \\Exception\n     *\/",140],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","reindexAll",146],"(",")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","tableStrategy",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","setUseIdxTable",148],"(",["T_STRING","true",148],")",";",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","beginTransaction",149],"(",")",";",["T_WHITESPACE","\n        ",149],["T_TRY","try",150],["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","reindex",151],"(",")",";",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","commit",152],"(",")",";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE"," ",153],["T_CATCH","catch",153],["T_WHITESPACE"," ",153],"(",["T_NS_SEPARATOR","\\",153],["T_STRING","Exception",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$e",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","rollBack",154],"(",")",";",["T_WHITESPACE","\n            ",154],["T_THROW","throw",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$e",155],";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n        ",156],["T_RETURN","return",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],";",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Indexer\\Price\\DefaultPrice\n     *\/",160],["T_WHITESPACE","\n    ",165],["T_PUBLIC","public",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","reindexEntity",166],"(",["T_VARIABLE","$entityIds",166],")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","reindex",168],"(",["T_VARIABLE","$entityIds",168],")",";",["T_WHITESPACE","\n        ",168],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * @param null|int|array $entityIds\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Indexer\\Price\\DefaultPrice\n     *\/",172],["T_WHITESPACE","\n    ",175],["T_PROTECTED","protected",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","reindex",176],"(",["T_VARIABLE","$entityIds",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_STRING","null",176],")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","hasEntity",178],"(",")",["T_WHITESPACE"," ",178],["T_BOOLEAN_OR","||",178],["T_WHITESPACE"," ",178],"!",["T_EMPTY","empty",178],"(",["T_VARIABLE","$entityIds",178],")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_prepareFinalPriceData",179],"(",["T_VARIABLE","$entityIds",179],")",";",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_applyCustomOption",180],"(",")",";",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_movePriceDataToIndexTable",181],"(",")",";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n        ",182],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * Retrieve final price temporary index table name\n     *\n     * @see _prepareDefaultFinalPriceTable()\n     *\n     * @return string\n     *\/",186],["T_WHITESPACE","\n    ",192],["T_PROTECTED","protected",193],["T_WHITESPACE"," ",193],["T_FUNCTION","function",193],["T_WHITESPACE"," ",193],["T_STRING","_getDefaultFinalPriceTable",193],"(",")",["T_WHITESPACE","\n    ",193],"{",["T_WHITESPACE","\n        ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","tableStrategy",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getTableName",195],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_final'",195],")",";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Prepare final price temporary index table\n     *\n     * @return $this\n     *\/",198],["T_WHITESPACE","\n    ",202],["T_PROTECTED","protected",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","_prepareDefaultFinalPriceTable",203],"(",")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getConnection",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","delete",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_getDefaultFinalPriceTable",205],"(",")",")",";",["T_WHITESPACE","\n        ",205],["T_RETURN","return",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],";",["T_WHITESPACE","\n    ",206],"}",["T_WHITESPACE","\n\n    ",207],["T_DOC_COMMENT","\/**\n     * Retrieve website current dates table name\n     *\n     * @return string\n     *\/",209],["T_WHITESPACE","\n    ",213],["T_PROTECTED","protected",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","_getWebsiteDateTable",214],"(",")",["T_WHITESPACE","\n    ",214],"{",["T_WHITESPACE","\n        ",215],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getTable",216],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_website'",216],")",";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Prepare products default final price in temporary index table\n     *\n     * @param int|array $entityIds the entity ids limitation\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",219],["T_WHITESPACE","\n    ",225],["T_PROTECTED","protected",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","_prepareFinalPriceData",226],"(",["T_VARIABLE","$entityIds",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","null",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","prepareFinalPriceDataForType",228],"(",["T_VARIABLE","$entityIds",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getTypeId",228],"(",")",")",";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Prepare products default final price in temporary index table\n     *\n     * @param int|array $entityIds the entity ids limitation\n     * @param string|null $type product type, all if null\n     * @return $this\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",231],["T_WHITESPACE","\n    ",239],["T_PROTECTED","protected",240],["T_WHITESPACE"," ",240],["T_FUNCTION","function",240],["T_WHITESPACE"," ",240],["T_STRING","prepareFinalPriceDataForType",240],"(",["T_VARIABLE","$entityIds",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$type",240],")",["T_WHITESPACE","\n    ",240],"{",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","_prepareDefaultFinalPriceTable",242],"(",")",";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$metadata",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getMetadataPool",243],"(",")",["T_OBJECT_OPERATOR","->",243],["T_STRING","getMetadata",243],"(",["T_NS_SEPARATOR","\\",243],["T_STRING","Magento",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Catalog",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Api",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Data",243],["T_NS_SEPARATOR","\\",243],["T_STRING","ProductInterface",243],["T_DOUBLE_COLON","::",243],["T_CLASS","class",243],")",";",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$connection",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getConnection",244],"(",")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$select",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$connection",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","select",245],"(",")",["T_OBJECT_OPERATOR","->",245],["T_STRING","from",245],"(",["T_WHITESPACE","\n            ",245],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",246],["T_WHITESPACE"," ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getTable",246],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",246],")","]",",",["T_WHITESPACE","\n            ",246],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",247],"]",["T_WHITESPACE","\n        ",247],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","join",248],"(",["T_WHITESPACE","\n            ",248],"[",["T_CONSTANT_ENCAPSED_STRING","'cg'",249],["T_WHITESPACE"," ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getTable",249],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group'",249],")","]",",",["T_WHITESPACE","\n            ",249],["T_CONSTANT_ENCAPSED_STRING","''",250],",",["T_WHITESPACE","\n            ",250],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",251],"]",["T_WHITESPACE","\n        ",251],")",["T_OBJECT_OPERATOR","->",252],["T_STRING","join",252],"(",["T_WHITESPACE","\n            ",252],"[",["T_CONSTANT_ENCAPSED_STRING","'cw'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getTable",253],"(",["T_CONSTANT_ENCAPSED_STRING","'store_website'",253],")","]",",",["T_WHITESPACE","\n            ",253],["T_CONSTANT_ENCAPSED_STRING","''",254],",",["T_WHITESPACE","\n            ",254],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",255],"]",["T_WHITESPACE","\n        ",255],")",["T_OBJECT_OPERATOR","->",256],["T_STRING","join",256],"(",["T_WHITESPACE","\n            ",256],"[",["T_CONSTANT_ENCAPSED_STRING","'cwd'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_getWebsiteDateTable",257],"(",")","]",",",["T_WHITESPACE","\n            ",257],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",258],",",["T_WHITESPACE","\n            ",258],"[","]",["T_WHITESPACE","\n        ",259],")",["T_OBJECT_OPERATOR","->",260],["T_STRING","join",260],"(",["T_WHITESPACE","\n            ",260],"[",["T_CONSTANT_ENCAPSED_STRING","'csg'",261],["T_WHITESPACE"," ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getTable",261],"(",["T_CONSTANT_ENCAPSED_STRING","'store_group'",261],")","]",",",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'csg.website_id = cw.website_id AND cw.default_group_id = csg.group_id'",262],",",["T_WHITESPACE","\n            ",262],"[","]",["T_WHITESPACE","\n        ",263],")",["T_OBJECT_OPERATOR","->",264],["T_STRING","join",264],"(",["T_WHITESPACE","\n            ",264],"[",["T_CONSTANT_ENCAPSED_STRING","'cs'",265],["T_WHITESPACE"," ",265],["T_DOUBLE_ARROW","=>",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getTable",265],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",265],")","]",",",["T_WHITESPACE","\n            ",265],["T_CONSTANT_ENCAPSED_STRING","'csg.default_store_id = cs.store_id AND cs.store_id != 0'",266],",",["T_WHITESPACE","\n            ",266],"[","]",["T_WHITESPACE","\n        ",267],")",["T_OBJECT_OPERATOR","->",268],["T_STRING","join",268],"(",["T_WHITESPACE","\n            ",268],"[",["T_CONSTANT_ENCAPSED_STRING","'pw'",269],["T_WHITESPACE"," ",269],["T_DOUBLE_ARROW","=>",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getTable",269],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_website'",269],")","]",",",["T_WHITESPACE","\n            ",269],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id = e.entity_id AND pw.website_id = cw.website_id'",270],",",["T_WHITESPACE","\n            ",270],"[","]",["T_WHITESPACE","\n        ",271],")",["T_OBJECT_OPERATOR","->",272],["T_STRING","joinLeft",272],"(",["T_WHITESPACE","\n            ",272],"[",["T_CONSTANT_ENCAPSED_STRING","'tp'",273],["T_WHITESPACE"," ",273],["T_DOUBLE_ARROW","=>",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_getTierPriceIndexTable",273],"(",")","]",",",["T_WHITESPACE","\n            ",273],["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id = e.entity_id AND tp.website_id = cw.website_id'",274],["T_WHITESPACE"," ",274],".",["T_WHITESPACE","\n            ",274],["T_CONSTANT_ENCAPSED_STRING","' AND tp.customer_group_id = cg.customer_group_id'",275],",",["T_WHITESPACE","\n            ",275],"[","]",["T_WHITESPACE","\n        ",276],")",";",["T_WHITESPACE","\n\n        ",277],["T_IF","if",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$type",279],["T_WHITESPACE"," ",279],["T_IS_NOT_IDENTICAL","!==",279],["T_WHITESPACE"," ",279],["T_STRING","null",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$select",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","where",280],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id = ?'",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$type",280],")",";",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n\n        ",281],["T_COMMENT","\/\/ add enable products limitation\n",283],["T_WHITESPACE","        ",284],["T_VARIABLE","$statusCond",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$connection",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","quoteInto",284],"(",["T_WHITESPACE","\n            ",284],["T_CONSTANT_ENCAPSED_STRING","'=?'",285],",",["T_WHITESPACE","\n            ",285],["T_NS_SEPARATOR","\\",286],["T_STRING","Magento",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Catalog",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Model",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Product",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Attribute",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Source",286],["T_NS_SEPARATOR","\\",286],["T_STRING","Status",286],["T_DOUBLE_COLON","::",286],["T_STRING","STATUS_ENABLED",286],["T_WHITESPACE","\n        ",286],")",";",["T_WHITESPACE","\n        ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_addAttributeToSelect",288],"(",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$select",289],",",["T_WHITESPACE","\n            ",289],["T_CONSTANT_ENCAPSED_STRING","'status'",290],",",["T_WHITESPACE","\n            ",290],["T_CONSTANT_ENCAPSED_STRING","'e.'",291],["T_WHITESPACE"," ",291],".",["T_WHITESPACE"," ",291],["T_VARIABLE","$metadata",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getLinkField",291],"(",")",",",["T_WHITESPACE","\n            ",291],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",292],",",["T_WHITESPACE","\n            ",292],["T_VARIABLE","$statusCond",293],",",["T_WHITESPACE","\n            ",293],["T_STRING","true",294],["T_WHITESPACE","\n        ",294],")",";",["T_WHITESPACE","\n        ",295],["T_IF","if",296],["T_WHITESPACE"," ",296],"(",["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","moduleManager",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","isEnabled",296],"(",["T_CONSTANT_ENCAPSED_STRING","'Magento_Tax'",296],")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$taxClassId",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_addAttributeToSelect",297],"(",["T_WHITESPACE","\n                ",297],["T_VARIABLE","$select",298],",",["T_WHITESPACE","\n                ",298],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",299],",",["T_WHITESPACE","\n                ",299],["T_CONSTANT_ENCAPSED_STRING","'e.'",300],["T_WHITESPACE"," ",300],".",["T_WHITESPACE"," ",300],["T_VARIABLE","$metadata",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getLinkField",300],"(",")",",",["T_WHITESPACE","\n                ",300],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",301],["T_WHITESPACE","\n            ",301],")",";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE"," ",303],["T_ELSE","else",303],["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$taxClassId",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_NEW","new",304],["T_WHITESPACE"," ",304],["T_NS_SEPARATOR","\\",304],["T_STRING","Zend_Db_Expr",304],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",304],")",";",["T_WHITESPACE","\n        ",304],"}",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$select",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","columns",306],"(","[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",306],["T_WHITESPACE"," ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$taxClassId",306],"]",")",";",["T_WHITESPACE","\n\n        ",306],["T_VARIABLE","$price",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_addAttributeToSelect",308],"(",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$select",309],",",["T_WHITESPACE","\n            ",309],["T_CONSTANT_ENCAPSED_STRING","'price'",310],",",["T_WHITESPACE","\n            ",310],["T_CONSTANT_ENCAPSED_STRING","'e.'",311],["T_WHITESPACE"," ",311],".",["T_WHITESPACE"," ",311],["T_VARIABLE","$metadata",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getLinkField",311],"(",")",",",["T_WHITESPACE","\n            ",311],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",312],["T_WHITESPACE","\n        ",312],")",";",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$specialPrice",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_addAttributeToSelect",314],"(",["T_WHITESPACE","\n            ",314],["T_VARIABLE","$select",315],",",["T_WHITESPACE","\n            ",315],["T_CONSTANT_ENCAPSED_STRING","'special_price'",316],",",["T_WHITESPACE","\n            ",316],["T_CONSTANT_ENCAPSED_STRING","'e.'",317],["T_WHITESPACE"," ",317],".",["T_WHITESPACE"," ",317],["T_VARIABLE","$metadata",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getLinkField",317],"(",")",",",["T_WHITESPACE","\n            ",317],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",318],["T_WHITESPACE","\n        ",318],")",";",["T_WHITESPACE","\n        ",319],["T_VARIABLE","$specialFrom",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_addAttributeToSelect",320],"(",["T_WHITESPACE","\n            ",320],["T_VARIABLE","$select",321],",",["T_WHITESPACE","\n            ",321],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",322],",",["T_WHITESPACE","\n            ",322],["T_CONSTANT_ENCAPSED_STRING","'e.'",323],["T_WHITESPACE"," ",323],".",["T_WHITESPACE"," ",323],["T_VARIABLE","$metadata",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getLinkField",323],"(",")",",",["T_WHITESPACE","\n            ",323],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",324],["T_WHITESPACE","\n        ",324],")",";",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$specialTo",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_addAttributeToSelect",326],"(",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$select",327],",",["T_WHITESPACE","\n            ",327],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",328],",",["T_WHITESPACE","\n            ",328],["T_CONSTANT_ENCAPSED_STRING","'e.'",329],["T_WHITESPACE"," ",329],".",["T_WHITESPACE"," ",329],["T_VARIABLE","$metadata",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getLinkField",329],"(",")",",",["T_WHITESPACE","\n            ",329],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",330],["T_WHITESPACE","\n        ",330],")",";",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$currentDate",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$connection",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getDatePartSql",332],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd.website_date'",332],")",";",["T_WHITESPACE","\n\n        ",332],["T_VARIABLE","$specialFromDate",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$connection",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getDatePartSql",334],"(",["T_VARIABLE","$specialFrom",334],")",";",["T_WHITESPACE","\n        ",334],["T_VARIABLE","$specialToDate",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$connection",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getDatePartSql",335],"(",["T_VARIABLE","$specialTo",335],")",";",["T_WHITESPACE","\n\n        ",335],["T_VARIABLE","$specialFromUse",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$connection",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getCheckSql",337],"(","\"",["T_CURLY_OPEN","{",337],["T_VARIABLE","$specialFromDate",337],"}",["T_ENCAPSED_AND_WHITESPACE"," <= ",337],["T_CURLY_OPEN","{",337],["T_VARIABLE","$currentDate",337],"}","\"",",",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'1'",337],",",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'0'",337],")",";",["T_WHITESPACE","\n        ",337],["T_VARIABLE","$specialToUse",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$connection",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getCheckSql",338],"(","\"",["T_CURLY_OPEN","{",338],["T_VARIABLE","$specialToDate",338],"}",["T_ENCAPSED_AND_WHITESPACE"," >= ",338],["T_CURLY_OPEN","{",338],["T_VARIABLE","$currentDate",338],"}","\"",",",["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","'1'",338],",",["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","'0'",338],")",";",["T_WHITESPACE","\n        ",338],["T_VARIABLE","$specialFromHas",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$connection",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getCheckSql",339],"(","\"",["T_CURLY_OPEN","{",339],["T_VARIABLE","$specialFrom",339],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",339],"\"",",",["T_WHITESPACE"," ",339],["T_CONSTANT_ENCAPSED_STRING","'1'",339],",",["T_WHITESPACE"," ",339],"\"",["T_CURLY_OPEN","{",339],["T_VARIABLE","$specialFromUse",339],"}","\"",")",";",["T_WHITESPACE","\n        ",339],["T_VARIABLE","$specialToHas",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$connection",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getCheckSql",340],"(","\"",["T_CURLY_OPEN","{",340],["T_VARIABLE","$specialTo",340],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",340],"\"",",",["T_WHITESPACE"," ",340],["T_CONSTANT_ENCAPSED_STRING","'1'",340],",",["T_WHITESPACE"," ",340],"\"",["T_CURLY_OPEN","{",340],["T_VARIABLE","$specialToUse",340],"}","\"",")",";",["T_WHITESPACE","\n        ",340],["T_VARIABLE","$finalPrice",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_VARIABLE","$connection",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getCheckSql",341],"(",["T_WHITESPACE","\n            ",341],"\"",["T_CURLY_OPEN","{",342],["T_VARIABLE","$specialFromHas",342],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",342],["T_CURLY_OPEN","{",342],["T_VARIABLE","$specialToHas",342],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0",342],"\"",["T_WHITESPACE"," ",342],".",["T_WHITESPACE"," ",342],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",342],["T_CURLY_OPEN","{",342],["T_VARIABLE","$specialPrice",342],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",342],["T_CURLY_OPEN","{",342],["T_VARIABLE","$price",342],"}","\"",",",["T_WHITESPACE","\n            ",342],["T_VARIABLE","$specialPrice",343],",",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$price",344],["T_WHITESPACE","\n        ",344],")",";",["T_WHITESPACE","\n\n        ",345],["T_VARIABLE","$select",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","columns",347],"(",["T_WHITESPACE","\n            ",347],"[",["T_WHITESPACE","\n                ",348],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$connection",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getIfNullSql",349],"(",["T_VARIABLE","$price",349],",",["T_WHITESPACE"," ",349],["T_LNUMBER","0",349],")",",",["T_WHITESPACE","\n                ",349],["T_CONSTANT_ENCAPSED_STRING","'price'",350],["T_WHITESPACE"," ",350],["T_DOUBLE_ARROW","=>",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$connection",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getIfNullSql",350],"(",["T_VARIABLE","$finalPrice",350],",",["T_WHITESPACE"," ",350],["T_LNUMBER","0",350],")",",",["T_WHITESPACE","\n                ",350],["T_CONSTANT_ENCAPSED_STRING","'min_price'",351],["T_WHITESPACE"," ",351],["T_DOUBLE_ARROW","=>",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$connection",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getIfNullSql",351],"(",["T_VARIABLE","$finalPrice",351],",",["T_WHITESPACE"," ",351],["T_LNUMBER","0",351],")",",",["T_WHITESPACE","\n                ",351],["T_CONSTANT_ENCAPSED_STRING","'max_price'",352],["T_WHITESPACE"," ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$connection",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getIfNullSql",352],"(",["T_VARIABLE","$finalPrice",352],",",["T_WHITESPACE"," ",352],["T_LNUMBER","0",352],")",",",["T_WHITESPACE","\n                ",352],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",353],["T_WHITESPACE"," ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_NEW","new",353],["T_WHITESPACE"," ",353],["T_NS_SEPARATOR","\\",353],["T_STRING","Zend_Db_Expr",353],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.min_price'",353],")",",",["T_WHITESPACE","\n                ",353],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",354],["T_WHITESPACE"," ",354],["T_DOUBLE_ARROW","=>",354],["T_WHITESPACE"," ",354],["T_NEW","new",354],["T_WHITESPACE"," ",354],["T_NS_SEPARATOR","\\",354],["T_STRING","Zend_Db_Expr",354],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.min_price'",354],")",",",["T_WHITESPACE","\n            ",354],"]",["T_WHITESPACE","\n        ",355],")",";",["T_WHITESPACE","\n\n        ",356],["T_IF","if",358],["T_WHITESPACE"," ",358],"(",["T_VARIABLE","$entityIds",358],["T_WHITESPACE"," ",358],["T_IS_NOT_IDENTICAL","!==",358],["T_WHITESPACE"," ",358],["T_STRING","null",358],")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n            ",358],["T_VARIABLE","$select",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","where",359],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",359],",",["T_WHITESPACE"," ",359],["T_VARIABLE","$entityIds",359],")",";",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",362],["T_WHITESPACE","\n        ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_eventManager",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","dispatch",365],"(",["T_WHITESPACE","\n            ",365],["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_index_select'",366],",",["T_WHITESPACE","\n            ",366],"[",["T_WHITESPACE","\n                ",367],["T_CONSTANT_ENCAPSED_STRING","'select'",368],["T_WHITESPACE"," ",368],["T_DOUBLE_ARROW","=>",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$select",368],",",["T_WHITESPACE","\n                ",368],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",369],["T_WHITESPACE"," ",369],["T_DOUBLE_ARROW","=>",369],["T_WHITESPACE"," ",369],["T_NEW","new",369],["T_WHITESPACE"," ",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Zend_Db_Expr",369],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",369],")",",",["T_WHITESPACE","\n                ",369],["T_CONSTANT_ENCAPSED_STRING","'website_field'",370],["T_WHITESPACE"," ",370],["T_DOUBLE_ARROW","=>",370],["T_WHITESPACE"," ",370],["T_NEW","new",370],["T_WHITESPACE"," ",370],["T_NS_SEPARATOR","\\",370],["T_STRING","Zend_Db_Expr",370],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",370],")",",",["T_WHITESPACE","\n                ",370],["T_CONSTANT_ENCAPSED_STRING","'store_field'",371],["T_WHITESPACE"," ",371],["T_DOUBLE_ARROW","=>",371],["T_WHITESPACE"," ",371],["T_NEW","new",371],["T_WHITESPACE"," ",371],["T_NS_SEPARATOR","\\",371],["T_STRING","Zend_Db_Expr",371],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",371],")",",",["T_WHITESPACE","\n            ",371],"]",["T_WHITESPACE","\n        ",372],")",";",["T_WHITESPACE","\n\n        ",373],["T_VARIABLE","$query",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$select",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","insertFromSelect",375],"(",["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_getDefaultFinalPriceTable",375],"(",")",",",["T_WHITESPACE"," ",375],"[","]",",",["T_WHITESPACE"," ",375],["T_STRING","false",375],")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$connection",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","query",376],"(",["T_VARIABLE","$query",376],")",";",["T_WHITESPACE","\n        ",376],["T_RETURN","return",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],";",["T_WHITESPACE","\n    ",377],"}",["T_WHITESPACE","\n\n    ",378],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option temporary aggregation data\n     *\n     * @return string\n     *\/",380],["T_WHITESPACE","\n    ",384],["T_PROTECTED","protected",385],["T_WHITESPACE"," ",385],["T_FUNCTION","function",385],["T_WHITESPACE"," ",385],["T_STRING","_getCustomOptionAggregateTable",385],"(",")",["T_WHITESPACE","\n    ",385],"{",["T_WHITESPACE","\n        ",386],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","tableStrategy",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getTableName",387],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_opt_agr'",387],")",";",["T_WHITESPACE","\n    ",387],"}",["T_WHITESPACE","\n\n    ",388],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option prices data\n     *\n     * @return string\n     *\/",390],["T_WHITESPACE","\n    ",394],["T_PROTECTED","protected",395],["T_WHITESPACE"," ",395],["T_FUNCTION","function",395],["T_WHITESPACE"," ",395],["T_STRING","_getCustomOptionPriceTable",395],"(",")",["T_WHITESPACE","\n    ",395],"{",["T_WHITESPACE","\n        ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","tableStrategy",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getTableName",397],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_opt'",397],")",";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n\n    ",398],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option temporary aggregation data\n     *\n     * @return $this\n     *\/",400],["T_WHITESPACE","\n    ",404],["T_PROTECTED","protected",405],["T_WHITESPACE"," ",405],["T_FUNCTION","function",405],["T_WHITESPACE"," ",405],["T_STRING","_prepareCustomOptionAggregateTable",405],"(",")",["T_WHITESPACE","\n    ",405],"{",["T_WHITESPACE","\n        ",406],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getConnection",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","delete",407],"(",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_getCustomOptionAggregateTable",407],"(",")",")",";",["T_WHITESPACE","\n        ",407],["T_RETURN","return",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],";",["T_WHITESPACE","\n    ",408],"}",["T_WHITESPACE","\n\n    ",409],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option prices data\n     *\n     * @return $this\n     *\/",411],["T_WHITESPACE","\n    ",415],["T_PROTECTED","protected",416],["T_WHITESPACE"," ",416],["T_FUNCTION","function",416],["T_WHITESPACE"," ",416],["T_STRING","_prepareCustomOptionPriceTable",416],"(",")",["T_WHITESPACE","\n    ",416],"{",["T_WHITESPACE","\n        ",417],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getConnection",418],"(",")",["T_OBJECT_OPERATOR","->",418],["T_STRING","delete",418],"(",["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_getCustomOptionPriceTable",418],"(",")",")",";",["T_WHITESPACE","\n        ",418],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Apply custom option minimal and maximal price to temporary final price index table\n     *\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",422],["T_WHITESPACE","\n    ",427],["T_PROTECTED","protected",428],["T_WHITESPACE"," ",428],["T_FUNCTION","function",428],["T_WHITESPACE"," ",428],["T_STRING","_applyCustomOption",428],"(",")",["T_WHITESPACE","\n    ",428],"{",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$connection",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getConnection",430],"(",")",";",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$coaTable",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_getCustomOptionAggregateTable",431],"(",")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$copTable",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","_getCustomOptionPriceTable",432],"(",")",";",["T_WHITESPACE","\n\n        ",432],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","_prepareCustomOptionAggregateTable",434],"(",")",";",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","_prepareCustomOptionPriceTable",435],"(",")",";",["T_WHITESPACE","\n\n        ",435],["T_VARIABLE","$select",437],["T_WHITESPACE"," ",437],"=",["T_WHITESPACE"," ",437],["T_VARIABLE","$connection",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","select",437],"(",")",["T_OBJECT_OPERATOR","->",437],["T_STRING","from",437],"(",["T_WHITESPACE","\n            ",437],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",438],["T_WHITESPACE"," ",438],["T_DOUBLE_ARROW","=>",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","_getDefaultFinalPriceTable",438],"(",")","]",",",["T_WHITESPACE","\n            ",438],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",439],",",["T_WHITESPACE"," ",439],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",439],",",["T_WHITESPACE"," ",439],["T_CONSTANT_ENCAPSED_STRING","'website_id'",439],"]",["T_WHITESPACE","\n        ",439],")",["T_OBJECT_OPERATOR","->",440],["T_STRING","join",440],"(",["T_WHITESPACE","\n            ",440],"[",["T_CONSTANT_ENCAPSED_STRING","'cw'",441],["T_WHITESPACE"," ",441],["T_DOUBLE_ARROW","=>",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getTable",441],"(",["T_CONSTANT_ENCAPSED_STRING","'store_website'",441],")","]",",",["T_WHITESPACE","\n            ",441],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = i.website_id'",442],",",["T_WHITESPACE","\n            ",442],"[","]",["T_WHITESPACE","\n        ",443],")",["T_OBJECT_OPERATOR","->",444],["T_STRING","join",444],"(",["T_WHITESPACE","\n            ",444],"[",["T_CONSTANT_ENCAPSED_STRING","'csg'",445],["T_WHITESPACE"," ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getTable",445],"(",["T_CONSTANT_ENCAPSED_STRING","'store_group'",445],")","]",",",["T_WHITESPACE","\n            ",445],["T_CONSTANT_ENCAPSED_STRING","'csg.group_id = cw.default_group_id'",446],",",["T_WHITESPACE","\n            ",446],"[","]",["T_WHITESPACE","\n        ",447],")",["T_OBJECT_OPERATOR","->",448],["T_STRING","join",448],"(",["T_WHITESPACE","\n            ",448],"[",["T_CONSTANT_ENCAPSED_STRING","'cs'",449],["T_WHITESPACE"," ",449],["T_DOUBLE_ARROW","=>",449],["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getTable",449],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",449],")","]",",",["T_WHITESPACE","\n            ",449],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id = csg.default_store_id'",450],",",["T_WHITESPACE","\n            ",450],"[","]",["T_WHITESPACE","\n        ",451],")",["T_OBJECT_OPERATOR","->",452],["T_STRING","join",452],"(",["T_WHITESPACE","\n            ",452],"[",["T_CONSTANT_ENCAPSED_STRING","'o'",453],["T_WHITESPACE"," ",453],["T_DOUBLE_ARROW","=>",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getTable",453],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option'",453],")","]",",",["T_WHITESPACE","\n            ",453],["T_CONSTANT_ENCAPSED_STRING","'o.product_id = i.entity_id'",454],",",["T_WHITESPACE","\n            ",454],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",455],"]",["T_WHITESPACE","\n        ",455],")",["T_OBJECT_OPERATOR","->",456],["T_STRING","join",456],"(",["T_WHITESPACE","\n            ",456],"[",["T_CONSTANT_ENCAPSED_STRING","'ot'",457],["T_WHITESPACE"," ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getTable",457],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option_type_value'",457],")","]",",",["T_WHITESPACE","\n            ",457],["T_CONSTANT_ENCAPSED_STRING","'ot.option_id = o.option_id'",458],",",["T_WHITESPACE","\n            ",458],"[","]",["T_WHITESPACE","\n        ",459],")",["T_OBJECT_OPERATOR","->",460],["T_STRING","join",460],"(",["T_WHITESPACE","\n            ",460],"[",["T_CONSTANT_ENCAPSED_STRING","'otpd'",461],["T_WHITESPACE"," ",461],["T_DOUBLE_ARROW","=>",461],["T_WHITESPACE"," ",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getTable",461],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option_type_price'",461],")","]",",",["T_WHITESPACE","\n            ",461],["T_CONSTANT_ENCAPSED_STRING","'otpd.option_type_id = ot.option_type_id AND otpd.store_id = 0'",462],",",["T_WHITESPACE","\n            ",462],"[","]",["T_WHITESPACE","\n        ",463],")",["T_OBJECT_OPERATOR","->",464],["T_STRING","joinLeft",464],"(",["T_WHITESPACE","\n            ",464],"[",["T_CONSTANT_ENCAPSED_STRING","'otps'",465],["T_WHITESPACE"," ",465],["T_DOUBLE_ARROW","=>",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getTable",465],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option_type_price'",465],")","]",",",["T_WHITESPACE","\n            ",465],["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_id = otpd.option_type_id AND otpd.store_id = cs.store_id'",466],",",["T_WHITESPACE","\n            ",466],"[","]",["T_WHITESPACE","\n        ",467],")",["T_OBJECT_OPERATOR","->",468],["T_STRING","group",468],"(",["T_WHITESPACE","\n            ",468],"[",["T_CONSTANT_ENCAPSED_STRING","'i.entity_id'",469],",",["T_WHITESPACE"," ",469],["T_CONSTANT_ENCAPSED_STRING","'i.customer_group_id'",469],",",["T_WHITESPACE"," ",469],["T_CONSTANT_ENCAPSED_STRING","'i.website_id'",469],",",["T_WHITESPACE"," ",469],["T_CONSTANT_ENCAPSED_STRING","'o.option_id'",469],"]",["T_WHITESPACE","\n        ",469],")",";",["T_WHITESPACE","\n\n        ",470],["T_VARIABLE","$optPriceType",472],["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$connection",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getCheckSql",472],"(",["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_price_id > 0'",472],",",["T_WHITESPACE"," ",472],["T_CONSTANT_ENCAPSED_STRING","'otps.price_type'",472],",",["T_WHITESPACE"," ",472],["T_CONSTANT_ENCAPSED_STRING","'otpd.price_type'",472],")",";",["T_WHITESPACE","\n        ",472],["T_VARIABLE","$optPriceValue",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$connection",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getCheckSql",473],"(",["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_price_id > 0'",473],",",["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","'otps.price'",473],",",["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","'otpd.price'",473],")",";",["T_WHITESPACE","\n        ",473],["T_VARIABLE","$minPriceRound",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_NEW","new",474],["T_WHITESPACE"," ",474],["T_NS_SEPARATOR","\\",474],["T_STRING","Zend_Db_Expr",474],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",474],["T_CURLY_OPEN","{",474],["T_VARIABLE","$optPriceValue",474],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",474],"\"",")",";",["T_WHITESPACE","\n        ",474],["T_VARIABLE","$minPriceExpr",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_VARIABLE","$connection",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getCheckSql",475],"(","\"",["T_CURLY_OPEN","{",475],["T_VARIABLE","$optPriceType",475],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",475],"\"",",",["T_WHITESPACE"," ",475],["T_VARIABLE","$optPriceValue",475],",",["T_WHITESPACE"," ",475],["T_VARIABLE","$minPriceRound",475],")",";",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$minPriceMin",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_NEW","new",476],["T_WHITESPACE"," ",476],["T_NS_SEPARATOR","\\",476],["T_STRING","Zend_Db_Expr",476],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",476],["T_CURLY_OPEN","{",476],["T_VARIABLE","$minPriceExpr",476],"}",["T_ENCAPSED_AND_WHITESPACE",")",476],"\"",")",";",["T_WHITESPACE","\n        ",476],["T_VARIABLE","$minPrice",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$connection",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getCheckSql",477],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(o.is_require) = 1\"",477],",",["T_WHITESPACE"," ",477],["T_VARIABLE","$minPriceMin",477],",",["T_WHITESPACE"," ",477],["T_CONSTANT_ENCAPSED_STRING","'0'",477],")",";",["T_WHITESPACE","\n\n        ",477],["T_VARIABLE","$tierPriceRound",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_NEW","new",479],["T_WHITESPACE"," ",479],["T_NS_SEPARATOR","\\",479],["T_STRING","Zend_Db_Expr",479],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_tier * (",479],["T_CURLY_OPEN","{",479],["T_VARIABLE","$optPriceValue",479],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",479],"\"",")",";",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$tierPriceExpr",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$connection",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getCheckSql",480],"(","\"",["T_CURLY_OPEN","{",480],["T_VARIABLE","$optPriceType",480],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",480],"\"",",",["T_WHITESPACE"," ",480],["T_VARIABLE","$optPriceValue",480],",",["T_WHITESPACE"," ",480],["T_VARIABLE","$tierPriceRound",480],")",";",["T_WHITESPACE","\n        ",480],["T_VARIABLE","$tierPriceMin",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_NEW","new",481],["T_WHITESPACE"," ",481],["T_NS_SEPARATOR","\\",481],["T_STRING","Zend_Db_Expr",481],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",481],["T_CURLY_OPEN","{",481],["T_VARIABLE","$tierPriceExpr",481],"}",["T_ENCAPSED_AND_WHITESPACE",")",481],"\"",")",";",["T_WHITESPACE","\n        ",481],["T_VARIABLE","$tierPriceValue",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$connection",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getCheckSql",482],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(o.is_require) > 0\"",482],",",["T_WHITESPACE"," ",482],["T_VARIABLE","$tierPriceMin",482],",",["T_WHITESPACE"," ",482],["T_LNUMBER","0",482],")",";",["T_WHITESPACE","\n        ",482],["T_VARIABLE","$tierPrice",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$connection",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getCheckSql",483],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(i.base_tier) IS NOT NULL\"",483],",",["T_WHITESPACE"," ",483],["T_VARIABLE","$tierPriceValue",483],",",["T_WHITESPACE"," ",483],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",483],")",";",["T_WHITESPACE","\n\n        ",483],["T_VARIABLE","$maxPriceRound",485],["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_NEW","new",485],["T_WHITESPACE"," ",485],["T_NS_SEPARATOR","\\",485],["T_STRING","Zend_Db_Expr",485],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",485],["T_CURLY_OPEN","{",485],["T_VARIABLE","$optPriceValue",485],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",485],"\"",")",";",["T_WHITESPACE","\n        ",485],["T_VARIABLE","$maxPriceExpr",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$connection",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getCheckSql",486],"(","\"",["T_CURLY_OPEN","{",486],["T_VARIABLE","$optPriceType",486],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",486],"\"",",",["T_WHITESPACE"," ",486],["T_VARIABLE","$optPriceValue",486],",",["T_WHITESPACE"," ",486],["T_VARIABLE","$maxPriceRound",486],")",";",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$maxPrice",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$connection",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getCheckSql",487],"(",["T_WHITESPACE","\n            ",487],["T_CONSTANT_ENCAPSED_STRING","\"(MIN(o.type)='radio' OR MIN(o.type)='drop_down')\"",488],",",["T_WHITESPACE","\n            ",488],"\"",["T_ENCAPSED_AND_WHITESPACE","MAX(",489],["T_CURLY_OPEN","{",489],["T_VARIABLE","$maxPriceExpr",489],"}",["T_ENCAPSED_AND_WHITESPACE",")",489],"\"",",",["T_WHITESPACE","\n            ",489],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",490],["T_CURLY_OPEN","{",490],["T_VARIABLE","$maxPriceExpr",490],"}",["T_ENCAPSED_AND_WHITESPACE",")",490],"\"",["T_WHITESPACE","\n        ",490],")",";",["T_WHITESPACE","\n\n        ",491],["T_VARIABLE","$select",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","columns",493],"(",["T_WHITESPACE","\n            ",493],"[",["T_WHITESPACE","\n                ",494],["T_CONSTANT_ENCAPSED_STRING","'min_price'",495],["T_WHITESPACE"," ",495],["T_DOUBLE_ARROW","=>",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$minPrice",495],",",["T_WHITESPACE","\n                ",495],["T_CONSTANT_ENCAPSED_STRING","'max_price'",496],["T_WHITESPACE"," ",496],["T_DOUBLE_ARROW","=>",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$maxPrice",496],",",["T_WHITESPACE","\n                ",496],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",497],["T_WHITESPACE"," ",497],["T_DOUBLE_ARROW","=>",497],["T_WHITESPACE"," ",497],["T_VARIABLE","$tierPrice",497],",",["T_WHITESPACE","\n            ",497],"]",["T_WHITESPACE","\n        ",498],")",";",["T_WHITESPACE","\n\n        ",499],["T_VARIABLE","$query",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_VARIABLE","$select",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","insertFromSelect",501],"(",["T_VARIABLE","$coaTable",501],")",";",["T_WHITESPACE","\n        ",501],["T_VARIABLE","$connection",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","query",502],"(",["T_VARIABLE","$query",502],")",";",["T_WHITESPACE","\n\n        ",502],["T_VARIABLE","$select",504],["T_WHITESPACE"," ",504],"=",["T_WHITESPACE"," ",504],["T_VARIABLE","$connection",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","select",504],"(",")",["T_OBJECT_OPERATOR","->",504],["T_STRING","from",504],"(",["T_WHITESPACE","\n            ",504],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",505],["T_WHITESPACE"," ",505],["T_DOUBLE_ARROW","=>",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","_getDefaultFinalPriceTable",505],"(",")","]",",",["T_WHITESPACE","\n            ",505],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",506],",",["T_WHITESPACE"," ",506],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",506],",",["T_WHITESPACE"," ",506],["T_CONSTANT_ENCAPSED_STRING","'website_id'",506],"]",["T_WHITESPACE","\n        ",506],")",["T_OBJECT_OPERATOR","->",507],["T_STRING","join",507],"(",["T_WHITESPACE","\n            ",507],"[",["T_CONSTANT_ENCAPSED_STRING","'cw'",508],["T_WHITESPACE"," ",508],["T_DOUBLE_ARROW","=>",508],["T_WHITESPACE"," ",508],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","getTable",508],"(",["T_CONSTANT_ENCAPSED_STRING","'store_website'",508],")","]",",",["T_WHITESPACE","\n            ",508],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = i.website_id'",509],",",["T_WHITESPACE","\n            ",509],"[","]",["T_WHITESPACE","\n        ",510],")",["T_OBJECT_OPERATOR","->",511],["T_STRING","join",511],"(",["T_WHITESPACE","\n            ",511],"[",["T_CONSTANT_ENCAPSED_STRING","'csg'",512],["T_WHITESPACE"," ",512],["T_DOUBLE_ARROW","=>",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getTable",512],"(",["T_CONSTANT_ENCAPSED_STRING","'store_group'",512],")","]",",",["T_WHITESPACE","\n            ",512],["T_CONSTANT_ENCAPSED_STRING","'csg.group_id = cw.default_group_id'",513],",",["T_WHITESPACE","\n            ",513],"[","]",["T_WHITESPACE","\n        ",514],")",["T_OBJECT_OPERATOR","->",515],["T_STRING","join",515],"(",["T_WHITESPACE","\n            ",515],"[",["T_CONSTANT_ENCAPSED_STRING","'cs'",516],["T_WHITESPACE"," ",516],["T_DOUBLE_ARROW","=>",516],["T_WHITESPACE"," ",516],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getTable",516],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",516],")","]",",",["T_WHITESPACE","\n            ",516],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id = csg.default_store_id'",517],",",["T_WHITESPACE","\n            ",517],"[","]",["T_WHITESPACE","\n        ",518],")",["T_OBJECT_OPERATOR","->",519],["T_STRING","join",519],"(",["T_WHITESPACE","\n            ",519],"[",["T_CONSTANT_ENCAPSED_STRING","'o'",520],["T_WHITESPACE"," ",520],["T_DOUBLE_ARROW","=>",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getTable",520],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option'",520],")","]",",",["T_WHITESPACE","\n            ",520],["T_CONSTANT_ENCAPSED_STRING","'o.product_id = i.entity_id'",521],",",["T_WHITESPACE","\n            ",521],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",522],"]",["T_WHITESPACE","\n        ",522],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","join",523],"(",["T_WHITESPACE","\n            ",523],"[",["T_CONSTANT_ENCAPSED_STRING","'opd'",524],["T_WHITESPACE"," ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getTable",524],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option_price'",524],")","]",",",["T_WHITESPACE","\n            ",524],["T_CONSTANT_ENCAPSED_STRING","'opd.option_id = o.option_id AND opd.store_id = 0'",525],",",["T_WHITESPACE","\n            ",525],"[","]",["T_WHITESPACE","\n        ",526],")",["T_OBJECT_OPERATOR","->",527],["T_STRING","joinLeft",527],"(",["T_WHITESPACE","\n            ",527],"[",["T_CONSTANT_ENCAPSED_STRING","'ops'",528],["T_WHITESPACE"," ",528],["T_DOUBLE_ARROW","=>",528],["T_WHITESPACE"," ",528],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getTable",528],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_option_price'",528],")","]",",",["T_WHITESPACE","\n            ",528],["T_CONSTANT_ENCAPSED_STRING","'ops.option_id = opd.option_id AND ops.store_id = cs.store_id'",529],",",["T_WHITESPACE","\n            ",529],"[","]",["T_WHITESPACE","\n        ",530],")",";",["T_WHITESPACE","\n\n        ",531],["T_VARIABLE","$optPriceType",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$connection",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getCheckSql",533],"(",["T_CONSTANT_ENCAPSED_STRING","'ops.option_price_id > 0'",533],",",["T_WHITESPACE"," ",533],["T_CONSTANT_ENCAPSED_STRING","'ops.price_type'",533],",",["T_WHITESPACE"," ",533],["T_CONSTANT_ENCAPSED_STRING","'opd.price_type'",533],")",";",["T_WHITESPACE","\n        ",533],["T_VARIABLE","$optPriceValue",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_VARIABLE","$connection",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","getCheckSql",534],"(",["T_CONSTANT_ENCAPSED_STRING","'ops.option_price_id > 0'",534],",",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","'ops.price'",534],",",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","'opd.price'",534],")",";",["T_WHITESPACE","\n\n        ",534],["T_VARIABLE","$minPriceRound",536],["T_WHITESPACE"," ",536],"=",["T_WHITESPACE"," ",536],["T_NEW","new",536],["T_WHITESPACE"," ",536],["T_NS_SEPARATOR","\\",536],["T_STRING","Zend_Db_Expr",536],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",536],["T_CURLY_OPEN","{",536],["T_VARIABLE","$optPriceValue",536],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",536],"\"",")",";",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$priceExpr",537],["T_WHITESPACE"," ",537],"=",["T_WHITESPACE"," ",537],["T_VARIABLE","$connection",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getCheckSql",537],"(","\"",["T_CURLY_OPEN","{",537],["T_VARIABLE","$optPriceType",537],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",537],"\"",",",["T_WHITESPACE"," ",537],["T_VARIABLE","$optPriceValue",537],",",["T_WHITESPACE"," ",537],["T_VARIABLE","$minPriceRound",537],")",";",["T_WHITESPACE","\n        ",537],["T_VARIABLE","$minPrice",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_VARIABLE","$connection",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getCheckSql",538],"(","\"",["T_CURLY_OPEN","{",538],["T_VARIABLE","$priceExpr",538],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND o.is_require > 1",538],"\"",",",["T_WHITESPACE"," ",538],["T_VARIABLE","$priceExpr",538],",",["T_WHITESPACE"," ",538],["T_LNUMBER","0",538],")",";",["T_WHITESPACE","\n\n        ",538],["T_VARIABLE","$maxPrice",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_VARIABLE","$priceExpr",540],";",["T_WHITESPACE","\n\n        ",540],["T_VARIABLE","$tierPriceRound",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_NEW","new",542],["T_WHITESPACE"," ",542],["T_NS_SEPARATOR","\\",542],["T_STRING","Zend_Db_Expr",542],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_tier * (",542],["T_CURLY_OPEN","{",542],["T_VARIABLE","$optPriceValue",542],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",542],"\"",")",";",["T_WHITESPACE","\n        ",542],["T_VARIABLE","$tierPriceExpr",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$connection",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getCheckSql",543],"(","\"",["T_CURLY_OPEN","{",543],["T_VARIABLE","$optPriceType",543],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",543],"\"",",",["T_WHITESPACE"," ",543],["T_VARIABLE","$optPriceValue",543],",",["T_WHITESPACE"," ",543],["T_VARIABLE","$tierPriceRound",543],")",";",["T_WHITESPACE","\n        ",543],["T_VARIABLE","$tierPriceValue",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_VARIABLE","$connection",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getCheckSql",544],"(","\"",["T_CURLY_OPEN","{",544],["T_VARIABLE","$tierPriceExpr",544],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND o.is_require > 0",544],"\"",",",["T_WHITESPACE"," ",544],["T_VARIABLE","$tierPriceExpr",544],",",["T_WHITESPACE"," ",544],["T_LNUMBER","0",544],")",";",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$tierPrice",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$connection",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getCheckSql",545],"(",["T_CONSTANT_ENCAPSED_STRING","\"i.base_tier IS NOT NULL\"",545],",",["T_WHITESPACE"," ",545],["T_VARIABLE","$tierPriceValue",545],",",["T_WHITESPACE"," ",545],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",545],")",";",["T_WHITESPACE","\n\n        ",545],["T_VARIABLE","$select",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","columns",547],"(",["T_WHITESPACE","\n            ",547],"[",["T_WHITESPACE","\n                ",548],["T_CONSTANT_ENCAPSED_STRING","'min_price'",549],["T_WHITESPACE"," ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$minPrice",549],",",["T_WHITESPACE","\n                ",549],["T_CONSTANT_ENCAPSED_STRING","'max_price'",550],["T_WHITESPACE"," ",550],["T_DOUBLE_ARROW","=>",550],["T_WHITESPACE"," ",550],["T_VARIABLE","$maxPrice",550],",",["T_WHITESPACE","\n                ",550],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",551],["T_WHITESPACE"," ",551],["T_DOUBLE_ARROW","=>",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$tierPrice",551],",",["T_WHITESPACE","\n            ",551],"]",["T_WHITESPACE","\n        ",552],")",";",["T_WHITESPACE","\n\n        ",553],["T_VARIABLE","$query",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_VARIABLE","$select",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","insertFromSelect",555],"(",["T_VARIABLE","$coaTable",555],")",";",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$connection",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","query",556],"(",["T_VARIABLE","$query",556],")",";",["T_WHITESPACE","\n\n        ",556],["T_VARIABLE","$select",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$connection",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","select",558],"(",")",["T_OBJECT_OPERATOR","->",558],["T_STRING","from",558],"(",["T_WHITESPACE","\n            ",558],"[",["T_VARIABLE","$coaTable",559],"]",",",["T_WHITESPACE","\n            ",559],"[",["T_WHITESPACE","\n                ",560],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",561],",",["T_WHITESPACE","\n                ",561],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",562],",",["T_WHITESPACE","\n                ",562],["T_CONSTANT_ENCAPSED_STRING","'website_id'",563],",",["T_WHITESPACE","\n                ",563],["T_CONSTANT_ENCAPSED_STRING","'min_price'",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_CONSTANT_ENCAPSED_STRING","'SUM(min_price)'",564],",",["T_WHITESPACE","\n                ",564],["T_CONSTANT_ENCAPSED_STRING","'max_price'",565],["T_WHITESPACE"," ",565],["T_DOUBLE_ARROW","=>",565],["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'SUM(max_price)'",565],",",["T_WHITESPACE","\n                ",565],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",566],["T_WHITESPACE"," ",566],["T_DOUBLE_ARROW","=>",566],["T_WHITESPACE"," ",566],["T_CONSTANT_ENCAPSED_STRING","'SUM(tier_price)'",566],",",["T_WHITESPACE","\n            ",566],"]",["T_WHITESPACE","\n        ",567],")",["T_OBJECT_OPERATOR","->",568],["T_STRING","group",568],"(",["T_WHITESPACE","\n            ",568],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",569],",",["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",569],",",["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'website_id'",569],"]",["T_WHITESPACE","\n        ",569],")",";",["T_WHITESPACE","\n        ",570],["T_VARIABLE","$query",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$select",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","insertFromSelect",571],"(",["T_VARIABLE","$copTable",571],")",";",["T_WHITESPACE","\n        ",571],["T_VARIABLE","$connection",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","query",572],"(",["T_VARIABLE","$query",572],")",";",["T_WHITESPACE","\n\n        ",572],["T_VARIABLE","$table",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",574],["T_WHITESPACE"," ",574],["T_DOUBLE_ARROW","=>",574],["T_WHITESPACE"," ",574],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_getDefaultFinalPriceTable",574],"(",")","]",";",["T_WHITESPACE","\n        ",574],["T_VARIABLE","$select",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_VARIABLE","$connection",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","select",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","join",575],"(",["T_WHITESPACE","\n            ",575],"[",["T_CONSTANT_ENCAPSED_STRING","'io'",576],["T_WHITESPACE"," ",576],["T_DOUBLE_ARROW","=>",576],["T_WHITESPACE"," ",576],["T_VARIABLE","$copTable",576],"]",",",["T_WHITESPACE","\n            ",576],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id = io.entity_id AND i.customer_group_id = io.customer_group_id'",577],["T_WHITESPACE"," ",577],".",["T_WHITESPACE","\n            ",577],["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = io.website_id'",578],",",["T_WHITESPACE","\n            ",578],"[","]",["T_WHITESPACE","\n        ",579],")",";",["T_WHITESPACE","\n        ",580],["T_VARIABLE","$select",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","columns",581],"(",["T_WHITESPACE","\n            ",581],"[",["T_WHITESPACE","\n                ",582],["T_CONSTANT_ENCAPSED_STRING","'min_price'",583],["T_WHITESPACE"," ",583],["T_DOUBLE_ARROW","=>",583],["T_WHITESPACE"," ",583],["T_NEW","new",583],["T_WHITESPACE"," ",583],["T_NS_SEPARATOR","\\",583],["T_STRING","Zend_Db_Expr",583],"(",["T_CONSTANT_ENCAPSED_STRING","'i.min_price + io.min_price'",583],")",",",["T_WHITESPACE","\n                ",583],["T_CONSTANT_ENCAPSED_STRING","'max_price'",584],["T_WHITESPACE"," ",584],["T_DOUBLE_ARROW","=>",584],["T_WHITESPACE"," ",584],["T_NEW","new",584],["T_WHITESPACE"," ",584],["T_NS_SEPARATOR","\\",584],["T_STRING","Zend_Db_Expr",584],"(",["T_CONSTANT_ENCAPSED_STRING","'i.max_price + io.max_price'",584],")",",",["T_WHITESPACE","\n                ",584],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",585],["T_WHITESPACE"," ",585],["T_DOUBLE_ARROW","=>",585],["T_WHITESPACE"," ",585],["T_VARIABLE","$connection",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getCheckSql",585],"(",["T_WHITESPACE","\n                    ",585],["T_CONSTANT_ENCAPSED_STRING","'i.tier_price IS NOT NULL'",586],",",["T_WHITESPACE","\n                    ",586],["T_CONSTANT_ENCAPSED_STRING","'i.tier_price + io.tier_price'",587],",",["T_WHITESPACE","\n                    ",587],["T_CONSTANT_ENCAPSED_STRING","'NULL'",588],["T_WHITESPACE","\n                ",588],")",",",["T_WHITESPACE","\n            ",589],"]",["T_WHITESPACE","\n        ",590],")",";",["T_WHITESPACE","\n        ",591],["T_VARIABLE","$query",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_VARIABLE","$select",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","crossUpdateFromSelect",592],"(",["T_VARIABLE","$table",592],")",";",["T_WHITESPACE","\n        ",592],["T_VARIABLE","$connection",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","query",593],"(",["T_VARIABLE","$query",593],")",";",["T_WHITESPACE","\n\n        ",593],["T_VARIABLE","$connection",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","delete",595],"(",["T_VARIABLE","$coaTable",595],")",";",["T_WHITESPACE","\n        ",595],["T_VARIABLE","$connection",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","delete",596],"(",["T_VARIABLE","$copTable",596],")",";",["T_WHITESPACE","\n\n        ",596],["T_RETURN","return",598],["T_WHITESPACE"," ",598],["T_VARIABLE","$this",598],";",["T_WHITESPACE","\n    ",598],"}",["T_WHITESPACE","\n\n    ",599],["T_DOC_COMMENT","\/**\n     * Mode Final Prices index to primary temporary index table\n     *\n     * @param int[]|null $entityIds\n     * @return $this\n     *\/",601],["T_WHITESPACE","\n    ",606],["T_PROTECTED","protected",607],["T_WHITESPACE"," ",607],["T_FUNCTION","function",607],["T_WHITESPACE"," ",607],["T_STRING","_movePriceDataToIndexTable",607],"(",["T_VARIABLE","$entityIds",607],["T_WHITESPACE"," ",607],"=",["T_WHITESPACE"," ",607],["T_STRING","null",607],")",["T_WHITESPACE","\n    ",607],"{",["T_WHITESPACE","\n        ",608],["T_VARIABLE","$columns",609],["T_WHITESPACE"," ",609],"=",["T_WHITESPACE"," ",609],"[",["T_WHITESPACE","\n            ",609],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",610],["T_WHITESPACE"," ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",610],",",["T_WHITESPACE","\n            ",610],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",611],["T_WHITESPACE"," ",611],["T_DOUBLE_ARROW","=>",611],["T_WHITESPACE"," ",611],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",611],",",["T_WHITESPACE","\n            ",611],["T_CONSTANT_ENCAPSED_STRING","'website_id'",612],["T_WHITESPACE"," ",612],["T_DOUBLE_ARROW","=>",612],["T_WHITESPACE"," ",612],["T_CONSTANT_ENCAPSED_STRING","'website_id'",612],",",["T_WHITESPACE","\n            ",612],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",613],["T_WHITESPACE"," ",613],["T_DOUBLE_ARROW","=>",613],["T_WHITESPACE"," ",613],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",613],",",["T_WHITESPACE","\n            ",613],["T_CONSTANT_ENCAPSED_STRING","'price'",614],["T_WHITESPACE"," ",614],["T_DOUBLE_ARROW","=>",614],["T_WHITESPACE"," ",614],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",614],",",["T_WHITESPACE","\n            ",614],["T_CONSTANT_ENCAPSED_STRING","'final_price'",615],["T_WHITESPACE"," ",615],["T_DOUBLE_ARROW","=>",615],["T_WHITESPACE"," ",615],["T_CONSTANT_ENCAPSED_STRING","'price'",615],",",["T_WHITESPACE","\n            ",615],["T_CONSTANT_ENCAPSED_STRING","'min_price'",616],["T_WHITESPACE"," ",616],["T_DOUBLE_ARROW","=>",616],["T_WHITESPACE"," ",616],["T_CONSTANT_ENCAPSED_STRING","'min_price'",616],",",["T_WHITESPACE","\n            ",616],["T_CONSTANT_ENCAPSED_STRING","'max_price'",617],["T_WHITESPACE"," ",617],["T_DOUBLE_ARROW","=>",617],["T_WHITESPACE"," ",617],["T_CONSTANT_ENCAPSED_STRING","'max_price'",617],",",["T_WHITESPACE","\n            ",617],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",618],["T_WHITESPACE"," ",618],["T_DOUBLE_ARROW","=>",618],["T_WHITESPACE"," ",618],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",618],",",["T_WHITESPACE","\n        ",618],"]",";",["T_WHITESPACE","\n\n        ",619],["T_VARIABLE","$connection",621],["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","getConnection",621],"(",")",";",["T_WHITESPACE","\n        ",621],["T_VARIABLE","$table",622],["T_WHITESPACE"," ",622],"=",["T_WHITESPACE"," ",622],["T_VARIABLE","$this",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","_getDefaultFinalPriceTable",622],"(",")",";",["T_WHITESPACE","\n        ",622],["T_VARIABLE","$select",623],["T_WHITESPACE"," ",623],"=",["T_WHITESPACE"," ",623],["T_VARIABLE","$connection",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","select",623],"(",")",["T_OBJECT_OPERATOR","->",623],["T_STRING","from",623],"(",["T_VARIABLE","$table",623],",",["T_WHITESPACE"," ",623],["T_VARIABLE","$columns",623],")",";",["T_WHITESPACE","\n\n        ",623],["T_IF","if",625],["T_WHITESPACE"," ",625],"(",["T_VARIABLE","$entityIds",625],["T_WHITESPACE"," ",625],["T_IS_NOT_IDENTICAL","!==",625],["T_WHITESPACE"," ",625],["T_STRING","null",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n            ",625],["T_VARIABLE","$select",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","where",626],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id in (?)'",626],",",["T_WHITESPACE"," ",626],["T_STRING","count",626],"(",["T_VARIABLE","$entityIds",626],")",["T_WHITESPACE"," ",626],">",["T_WHITESPACE"," ",626],["T_LNUMBER","0",626],["T_WHITESPACE"," ",626],"?",["T_WHITESPACE"," ",626],["T_VARIABLE","$entityIds",626],["T_WHITESPACE"," ",626],":",["T_WHITESPACE"," ",626],["T_LNUMBER","0",626],")",";",["T_WHITESPACE","\n        ",626],"}",["T_WHITESPACE","\n\n        ",627],["T_VARIABLE","$query",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_VARIABLE","$select",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","insertFromSelect",629],"(",["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","getIdxTable",629],"(",")",",",["T_WHITESPACE"," ",629],"[","]",",",["T_WHITESPACE"," ",629],["T_STRING","false",629],")",";",["T_WHITESPACE","\n        ",629],["T_VARIABLE","$connection",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","query",630],"(",["T_VARIABLE","$query",630],")",";",["T_WHITESPACE","\n\n        ",630],["T_VARIABLE","$connection",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","delete",632],"(",["T_VARIABLE","$table",632],")",";",["T_WHITESPACE","\n\n        ",632],["T_RETURN","return",634],["T_WHITESPACE"," ",634],["T_VARIABLE","$this",634],";",["T_WHITESPACE","\n    ",634],"}",["T_WHITESPACE","\n\n    ",635],["T_DOC_COMMENT","\/**\n     * Retrieve table name for product tier price index\n     *\n     * @return string\n     *\/",637],["T_WHITESPACE","\n    ",641],["T_PROTECTED","protected",642],["T_WHITESPACE"," ",642],["T_FUNCTION","function",642],["T_WHITESPACE"," ",642],["T_STRING","_getTierPriceIndexTable",642],"(",")",["T_WHITESPACE","\n    ",642],"{",["T_WHITESPACE","\n        ",643],["T_RETURN","return",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getTable",644],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_tier_price'",644],")",";",["T_WHITESPACE","\n    ",644],"}",["T_WHITESPACE","\n\n    ",645],["T_DOC_COMMENT","\/**\n     * Retrieve temporary index table name\n     *\n     * @param string $table\n     * @return string\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",647],["T_WHITESPACE","\n    ",653],["T_PUBLIC","public",654],["T_WHITESPACE"," ",654],["T_FUNCTION","function",654],["T_WHITESPACE"," ",654],["T_STRING","getIdxTable",654],"(",["T_VARIABLE","$table",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_STRING","null",654],")",["T_WHITESPACE","\n    ",654],"{",["T_WHITESPACE","\n        ",655],["T_RETURN","return",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","tableStrategy",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getTableName",656],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price'",656],")",";",["T_WHITESPACE","\n    ",656],"}",["T_WHITESPACE","\n\n    ",657],["T_DOC_COMMENT","\/**\n     * @return bool\n     *\/",659],["T_WHITESPACE","\n    ",661],["T_PROTECTED","protected",662],["T_WHITESPACE"," ",662],["T_FUNCTION","function",662],["T_WHITESPACE"," ",662],["T_STRING","hasEntity",662],"(",")",["T_WHITESPACE","\n    ",662],"{",["T_WHITESPACE","\n        ",663],["T_VARIABLE","$reader",664],["T_WHITESPACE"," ",664],"=",["T_WHITESPACE"," ",664],["T_VARIABLE","$this",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","getConnection",664],"(",")",";",["T_WHITESPACE","\n\n        ",664],["T_VARIABLE","$select",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_VARIABLE","$reader",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","select",666],"(",")",["T_OBJECT_OPERATOR","->",666],["T_STRING","from",666],"(",["T_WHITESPACE","\n            ",666],"[",["T_VARIABLE","$this",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","getTable",667],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",667],")","]",",",["T_WHITESPACE","\n            ",667],"[",["T_CONSTANT_ENCAPSED_STRING","'count(entity_id)'",668],"]",["T_WHITESPACE","\n        ",668],")",["T_OBJECT_OPERATOR","->",669],["T_STRING","where",669],"(",["T_WHITESPACE","\n            ",669],["T_CONSTANT_ENCAPSED_STRING","'type_id=?'",670],",",["T_WHITESPACE","\n            ",670],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getTypeId",671],"(",")",["T_WHITESPACE","\n        ",671],")",";",["T_WHITESPACE","\n\n        ",672],["T_RETURN","return",674],["T_WHITESPACE"," ",674],["T_INT_CAST","(int)",674],["T_VARIABLE","$reader",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","fetchOne",674],"(",["T_VARIABLE","$select",674],")",["T_WHITESPACE"," ",674],">",["T_WHITESPACE"," ",674],["T_LNUMBER","0",674],";",["T_WHITESPACE","\n    ",674],"}",["T_WHITESPACE","\n",675],"}",["T_WHITESPACE","\n",676]]