[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Category",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Link",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CategoryLinkInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Catalog",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Indexer",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Product",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Category",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","EntityManager",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Operation",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ExtensionInterface",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Save handler for catalog product link.\n *\/",12],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","SaveHandler",15],["T_WHITESPACE"," ",15],["T_IMPLEMENTS","implements",15],["T_WHITESPACE"," ",15],["T_STRING","ExtensionInterface",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Product\\CategoryLink\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PRIVATE","private",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$productCategoryLink",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\EntityManager\\HydratorPool\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$hydratorPool",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * SaveHandler constructor.\n     *\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Product\\CategoryLink $productCategoryLink\n     * @param \\Magento\\Framework\\EntityManager\\HydratorPool $hydratorPool\n     *\/",28],["T_WHITESPACE","\n    ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","__construct",34],"(",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Catalog",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Model",35],["T_NS_SEPARATOR","\\",35],["T_STRING","ResourceModel",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Product",35],["T_NS_SEPARATOR","\\",35],["T_STRING","CategoryLink",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$productCategoryLink",35],",",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Framework",36],["T_NS_SEPARATOR","\\",36],["T_STRING","EntityManager",36],["T_NS_SEPARATOR","\\",36],["T_STRING","HydratorPool",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$hydratorPool",36],["T_WHITESPACE","\n    ",36],")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","productCategoryLink",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$productCategoryLink",38],";",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","hydratorPool",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$hydratorPool",39],";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @param object $entity\n     * @param array $arguments\n     * @return object\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",42],["T_WHITESPACE","\n    ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","execute",48],"(",["T_VARIABLE","$entity",48],",",["T_WHITESPACE"," ",48],["T_VARIABLE","$arguments",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],"[","]",")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$entity",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","setIsChangedCategories",50],"(",["T_STRING","false",50],")",";",["T_WHITESPACE","\n\n        ",50],["T_VARIABLE","$extensionAttributes",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$entity",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getExtensionAttributes",52],"(",")",";",["T_WHITESPACE","\n        ",52],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$extensionAttributes",53],["T_WHITESPACE"," ",53],["T_IS_IDENTICAL","===",53],["T_WHITESPACE"," ",53],["T_STRING","null",53],["T_WHITESPACE"," ",53],["T_BOOLEAN_AND","&&",53],["T_WHITESPACE"," ",53],"!",["T_VARIABLE","$entity",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","hasCategoryIds",53],"(",")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$entity",54],";",["T_WHITESPACE","\n        ",54],"}",["T_WHITESPACE","\n\n        ",55],["T_VARIABLE","$modelCategoryLinks",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getCategoryLinksPositions",57],"(",["T_VARIABLE","$entity",57],")",";",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$dtoCategoryLinks",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$extensionAttributes",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getCategoryLinks",59],"(",")",";",["T_WHITESPACE","\n        ",59],["T_IF","if",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$dtoCategoryLinks",60],["T_WHITESPACE"," ",60],["T_IS_NOT_IDENTICAL","!==",60],["T_WHITESPACE"," ",60],["T_STRING","null",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$hydrator",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","hydratorPool",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getHydrator",61],"(",["T_STRING","CategoryLinkInterface",61],["T_DOUBLE_COLON","::",61],["T_CLASS","class",61],")",";",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$dtoCategoryLinks",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","array_map",62],"(",["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$categoryLink",62],")",["T_WHITESPACE"," ",62],["T_USE","use",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$hydrator",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n                ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$hydrator",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","extract",63],"(",["T_VARIABLE","$categoryLink",63],")",["T_WHITESPACE"," ",63],";",["T_WHITESPACE","\n            ",63],"}",",",["T_WHITESPACE"," ",64],["T_VARIABLE","$dtoCategoryLinks",64],")",";",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$processLinks",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","mergeCategoryLinks",65],"(",["T_VARIABLE","$dtoCategoryLinks",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$modelCategoryLinks",65],")",";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE"," ",66],["T_ELSE","else",66],["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$processLinks",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$modelCategoryLinks",67],";",["T_WHITESPACE","\n        ",67],"}",["T_WHITESPACE","\n\n        ",68],["T_VARIABLE","$affectedCategoryIds",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","productCategoryLink",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","saveCategoryLinks",70],"(",["T_VARIABLE","$entity",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$processLinks",70],")",";",["T_WHITESPACE","\n\n        ",70],["T_IF","if",72],["T_WHITESPACE"," ",72],"(","!",["T_EMPTY","empty",72],"(",["T_VARIABLE","$affectedCategoryIds",72],")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$entity",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","setAffectedCategoryIds",73],"(",["T_VARIABLE","$affectedCategoryIds",73],")",";",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$entity",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","setIsChangedCategories",74],"(",["T_STRING","true",74],")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n\n        ",75],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$entity",77],";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * @param object $entity\n     * @return array\n     *\/",80],["T_WHITESPACE","\n    ",83],["T_PRIVATE","private",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","getCategoryLinksPositions",84],"(",["T_VARIABLE","$entity",84],")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$result",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],"[","]",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$currentCategoryLinks",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","productCategoryLink",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getCategoryLinks",87],"(",["T_VARIABLE","$entity",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$entity",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getCategoryIds",87],"(",")",")",";",["T_WHITESPACE","\n        ",87],["T_FOREACH","foreach",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$entity",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getCategoryIds",88],"(",")",["T_WHITESPACE"," ",88],["T_AS","as",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$categoryId",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$key",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","array_search",89],"(",["T_VARIABLE","$categoryId",89],",",["T_WHITESPACE"," ",89],["T_STRING","array_column",89],"(",["T_VARIABLE","$currentCategoryLinks",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'category_id'",89],")",")",";",["T_WHITESPACE","\n            ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$key",90],["T_WHITESPACE"," ",90],["T_IS_IDENTICAL","===",90],["T_WHITESPACE"," ",90],["T_STRING","false",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$result",91],"[","]",["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_INT_CAST","(int)",91],["T_VARIABLE","$categoryId",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'position'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_LNUMBER","0",91],"]",";",["T_WHITESPACE","\n            ",91],"}",["T_WHITESPACE"," ",92],["T_ELSE","else",92],["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$result",93],"[","]",["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$currentCategoryLinks",93],"[",["T_VARIABLE","$key",93],"]",";",["T_WHITESPACE","\n            ",93],"}",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$result",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Merge category links\n     *\n     * @param array $newCategoryPositions\n     * @param array $oldCategoryPositions\n     * @return array\n     *\/",100],["T_WHITESPACE","\n    ",106],["T_PRIVATE","private",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","mergeCategoryLinks",107],"(",["T_VARIABLE","$newCategoryPositions",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$oldCategoryPositions",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$result",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],"[","]",";",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_EMPTY","empty",110],"(",["T_VARIABLE","$newCategoryPositions",110],")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$result",111],";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_FOREACH","foreach",114],["T_WHITESPACE"," ",114],"(",["T_VARIABLE","$newCategoryPositions",114],["T_WHITESPACE"," ",114],["T_AS","as",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$newCategoryPosition",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$key",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","array_search",115],"(",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$newCategoryPosition",116],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",116],"]",",",["T_WHITESPACE","\n                ",116],["T_STRING","array_column",117],"(",["T_VARIABLE","$oldCategoryPositions",117],",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'category_id'",117],")",["T_WHITESPACE","\n            ",117],")",";",["T_WHITESPACE","\n\n            ",118],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$key",120],["T_WHITESPACE"," ",120],["T_IS_IDENTICAL","===",120],["T_WHITESPACE"," ",120],["T_STRING","false",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n                ",120],["T_VARIABLE","$result",121],"[","]",["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$newCategoryPosition",121],";",["T_WHITESPACE","\n            ",121],"}",["T_WHITESPACE"," ",122],["T_ELSEIF","elseif",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$oldCategoryPositions",122],"[",["T_VARIABLE","$key",122],"]","[",["T_CONSTANT_ENCAPSED_STRING","'position'",122],"]",["T_WHITESPACE"," ",122],["T_IS_NOT_EQUAL","!=",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$newCategoryPosition",122],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",122],"]",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$result",123],"[","]",["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$newCategoryPositions",123],"[",["T_VARIABLE","$key",123],"]",";",["T_WHITESPACE","\n                ",123],["T_UNSET","unset",124],"(",["T_VARIABLE","$oldCategoryPositions",124],"[",["T_VARIABLE","$key",124],"]",")",";",["T_WHITESPACE","\n            ",124],"}",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$result",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","array_merge",127],"(",["T_VARIABLE","$result",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$oldCategoryPositions",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$result",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n",130],"}",["T_WHITESPACE","\n",131]]