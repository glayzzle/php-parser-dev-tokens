[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Catalog",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Product",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Price",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Persists tier prices.\n *\/",9],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","TierPricePersistence",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_DOC_COMMENT","\/**\n     * Number or items per each operation.\n     *\n     * @var int\n     *\/",14],["T_WHITESPACE","\n    ",18],["T_PRIVATE","private",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$itemsPerOperation",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_LNUMBER","500",19],";",["T_WHITESPACE","\n\n    ",19],["T_DOC_COMMENT","\/**\n     * Tier price resource model.\n     *\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Attribute\\Backend\\Tierprice\n     *\/",21],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$tierpriceResource",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Metadata pool.\n     *\n     * @var \\Magento\\Framework\\EntityManager\\MetadataPool\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PRIVATE","private",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$metadataPool",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * TierPricePersister constructor.\n     *\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Attribute\\Backend\\Tierprice $tierpriceResource\n     * @param \\Magento\\Framework\\EntityManager\\MetadataPool $metadataPool\n     *\/",35],["T_WHITESPACE","\n    ",40],["T_PUBLIC","public",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","__construct",41],"(",["T_WHITESPACE","\n        ",41],["T_NS_SEPARATOR","\\",42],["T_STRING","Magento",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Catalog",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Model",42],["T_NS_SEPARATOR","\\",42],["T_STRING","ResourceModel",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Product",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Attribute",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Backend",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Tierprice",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$tierpriceResource",42],",",["T_WHITESPACE","\n        ",42],["T_NS_SEPARATOR","\\",43],["T_STRING","Magento",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Framework",43],["T_NS_SEPARATOR","\\",43],["T_STRING","EntityManager",43],["T_NS_SEPARATOR","\\",43],["T_STRING","MetadataPool",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$metadataPool",43],["T_WHITESPACE","\n    ",43],")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","tierpriceResource",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$tierpriceResource",45],";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","metadataPool",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$metadataPool",46],";",["T_WHITESPACE","\n    ",46],"}",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Get tier prices by product IDs.\n     *\n     * @param array $ids\n     * @return array\n     *\/",49],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","get",55],"(",["T_ARRAY","array",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$ids",55],")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$select",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","tierpriceResource",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getConnection",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","select",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","from",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","tierpriceResource",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getMainTable",57],"(",")",")",";",["T_WHITESPACE","\n        ",57],["T_RETURN","return",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","tierpriceResource",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getConnection",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","fetchAll",58],"(",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$select",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","where",59],"(",["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getEntityLinkField",59],"(",")",["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$ids",59],")",["T_WHITESPACE","\n        ",59],")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Update tier prices.\n     *\n     * @param array $prices\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\CouldNotSaveException\n     *\/",63],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","update",70],"(",["T_ARRAY","array",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$prices",70],")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$connection",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","tierpriceResource",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getConnection",72],"(",")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$connection",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","beginTransaction",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_TRY","try",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_FOREACH","foreach",75],["T_WHITESPACE"," ",75],"(",["T_STRING","array_chunk",75],"(",["T_VARIABLE","$prices",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","itemsPerOperation",75],")",["T_WHITESPACE"," ",75],["T_AS","as",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$pricesBunch",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","tierpriceResource",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getConnection",76],"(",")",["T_OBJECT_OPERATOR","->",76],["T_STRING","insertOnDuplicate",76],"(",["T_WHITESPACE","\n                    ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","tierpriceResource",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getMainTable",77],"(",")",",",["T_WHITESPACE","\n                    ",77],["T_VARIABLE","$pricesBunch",78],",",["T_WHITESPACE","\n                    ",78],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'percentage_value'",79],"]",["T_WHITESPACE","\n                ",79],")",";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$connection",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","commit",82],"(",")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE"," ",83],["T_CATCH","catch",83],["T_WHITESPACE"," ",83],"(",["T_NS_SEPARATOR","\\",83],["T_STRING","Exception",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$connection",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","rollBack",84],"(",")",";",["T_WHITESPACE","\n            ",84],["T_THROW","throw",85],["T_WHITESPACE"," ",85],["T_NEW","new",85],["T_WHITESPACE"," ",85],["T_NS_SEPARATOR","\\",85],["T_STRING","Magento",85],["T_NS_SEPARATOR","\\",85],["T_STRING","Framework",85],["T_NS_SEPARATOR","\\",85],["T_STRING","Exception",85],["T_NS_SEPARATOR","\\",85],["T_STRING","CouldNotSaveException",85],"(",["T_WHITESPACE","\n                ",85],["T_STRING","__",86],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not save Tier Prices'",86],")",",",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$e",87],["T_WHITESPACE","\n            ",87],")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Replace prices.\n     *\n     * @param array $prices\n     * @param array $ids\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\CouldNotSaveException\n     *\/",92],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","replace",100],"(",["T_ARRAY","array",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$prices",100],",",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$ids",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$connection",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","tierpriceResource",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getConnection",102],"(",")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$connection",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","beginTransaction",103],"(",")",";",["T_WHITESPACE","\n        ",103],["T_TRY","try",104],["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_FOREACH","foreach",105],["T_WHITESPACE"," ",105],"(",["T_STRING","array_chunk",105],"(",["T_VARIABLE","$ids",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","itemsPerOperation",105],")",["T_WHITESPACE"," ",105],["T_AS","as",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$idsBunch",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n                ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","tierpriceResource",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getConnection",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","delete",106],"(",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","tierpriceResource",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getMainTable",107],"(",")",",",["T_WHITESPACE","\n                    ",107],"[",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getEntityLinkField",108],"(",")",["T_WHITESPACE"," ",108],".",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$idsBunch",108],"]",["T_WHITESPACE","\n                ",108],")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE","\n\n            ",110],["T_FOREACH","foreach",112],["T_WHITESPACE"," ",112],"(",["T_STRING","array_chunk",112],"(",["T_VARIABLE","$prices",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","itemsPerOperation",112],")",["T_WHITESPACE"," ",112],["T_AS","as",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$pricesBunch",112],")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","tierpriceResource",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getConnection",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","insertMultiple",113],"(",["T_WHITESPACE","\n                    ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","tierpriceResource",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getMainTable",114],"(",")",",",["T_WHITESPACE","\n                    ",114],["T_VARIABLE","$pricesBunch",115],["T_WHITESPACE","\n                ",115],")",";",["T_WHITESPACE","\n            ",116],"}",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$connection",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","commit",118],"(",")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE"," ",119],["T_CATCH","catch",119],["T_WHITESPACE"," ",119],"(",["T_NS_SEPARATOR","\\",119],["T_STRING","Exception",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$e",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$connection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","rollBack",120],"(",")",";",["T_WHITESPACE","\n            ",120],["T_THROW","throw",121],["T_WHITESPACE"," ",121],["T_NEW","new",121],["T_WHITESPACE"," ",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Magento",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Framework",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Exception",121],["T_NS_SEPARATOR","\\",121],["T_STRING","CouldNotSaveException",121],"(",["T_WHITESPACE","\n                ",121],["T_STRING","__",122],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not replace Tier Prices'",122],")",",",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$e",123],["T_WHITESPACE","\n            ",123],")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Delete tier prices by IDs.\n     *\n     * @param array $ids\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\CouldNotDeleteException\n     *\/",128],["T_WHITESPACE","\n    ",134],["T_PUBLIC","public",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","delete",135],"(",["T_ARRAY","array",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$ids",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$connection",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","tierpriceResource",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getConnection",137],"(",")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$connection",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","beginTransaction",138],"(",")",";",["T_WHITESPACE","\n        ",138],["T_TRY","try",139],["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_FOREACH","foreach",140],["T_WHITESPACE"," ",140],"(",["T_STRING","array_chunk",140],"(",["T_VARIABLE","$ids",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","itemsPerOperation",140],")",["T_WHITESPACE"," ",140],["T_AS","as",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$idsBunch",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","tierpriceResource",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getConnection",141],"(",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","delete",141],"(",["T_WHITESPACE","\n                    ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","tierpriceResource",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getMainTable",142],"(",")",",",["T_WHITESPACE","\n                    ",142],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id IN (?)'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$idsBunch",143],"]",["T_WHITESPACE","\n                ",143],")",";",["T_WHITESPACE","\n            ",144],"}",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$connection",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","commit",146],"(",")",";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE"," ",147],["T_CATCH","catch",147],["T_WHITESPACE"," ",147],"(",["T_NS_SEPARATOR","\\",147],["T_STRING","Exception",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$e",147],")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$connection",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","rollBack",148],"(",")",";",["T_WHITESPACE","\n            ",148],["T_THROW","throw",149],["T_WHITESPACE"," ",149],["T_NEW","new",149],["T_WHITESPACE"," ",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Magento",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Framework",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Exception",149],["T_NS_SEPARATOR","\\",149],["T_STRING","CouldNotDeleteException",149],"(",["T_WHITESPACE","\n                ",149],["T_STRING","__",150],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not delete Tier Prices'",150],")",",",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$e",151],["T_WHITESPACE","\n            ",151],")",";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Get link field.\n     *\n     * @return string\n     *\/",156],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","getEntityLinkField",161],"(",")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","metadataPool",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getMetadata",163],"(",["T_NS_SEPARATOR","\\",163],["T_STRING","Magento",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Catalog",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Api",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Data",163],["T_NS_SEPARATOR","\\",163],["T_STRING","ProductInterface",163],["T_DOUBLE_COLON","::",163],["T_CLASS","class",163],")",["T_WHITESPACE","\n            ",163],["T_OBJECT_OPERATOR","->",164],["T_STRING","getLinkField",164],"(",")",";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n",165],"}",["T_WHITESPACE","\n",166]]