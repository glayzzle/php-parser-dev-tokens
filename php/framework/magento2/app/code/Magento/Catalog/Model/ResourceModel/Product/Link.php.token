[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Catalog product link resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Link",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceModel",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Db",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractDb",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * Product Link Attributes Table\n     *\n     * @var string\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$_attributesTable",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * Catalog product relation\n     *\n     * @var Relation\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_catalogProductRelation",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Link constructor.\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param Relation $catalogProductRelation\n     * @param string|null $connectionName\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",29],["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","__construct",36],"(",["T_WHITESPACE","\n        ",36],["T_NS_SEPARATOR","\\",37],["T_STRING","Magento",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Framework",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Model",37],["T_NS_SEPARATOR","\\",37],["T_STRING","ResourceModel",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Db",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Context",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$context",37],",",["T_WHITESPACE","\n        ",37],["T_STRING","Relation",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$catalogProductRelation",38],",",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$connectionName",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_STRING","null",39],["T_WHITESPACE","\n    ",39],")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n        ",40],["T_STRING","parent",41],["T_DOUBLE_COLON","::",41],["T_STRING","__construct",41],"(",["T_VARIABLE","$context",41],",",["T_WHITESPACE"," ",41],["T_VARIABLE","$connectionName",41],")",";",["T_WHITESPACE","\n    ",41],"}",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Define main table name and attributes table\n     *\n     * @return void\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_FUNCTION","function",49],["T_WHITESPACE"," ",49],["T_STRING","_construct",49],"(",")",["T_WHITESPACE","\n    ",49],"{",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_init",51],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_link'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'link_id'",51],")",";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_attributesTable",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getTable",52],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_link_attribute'",52],")",";",["T_WHITESPACE","\n    ",52],"}",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * Delete product link by link_id\n     *\n     * @param int $linkId\n     * @return int\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",55],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","deleteProductLink",62],"(",["T_VARIABLE","$linkId",62],")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getConnection",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","delete",64],"(",["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getMainTable",64],"(",")",",",["T_WHITESPACE"," ",64],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id = ?'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$linkId",64],"]",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Retrieve product link_id by link product id and type id\n     *\n     * @param int $parentId\n     * @param int $linkedProductId\n     * @param int $typeId\n     * @return string\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",67],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","getProductLinkId",76],"(",["T_VARIABLE","$parentId",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$linkedProductId",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$typeId",76],")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$connection",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getConnection",78],"(",")",";",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$bind",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],"[",["T_WHITESPACE","\n            ",80],["T_CONSTANT_ENCAPSED_STRING","':product_id'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_INT_CAST","(int)",81],["T_VARIABLE","$parentId",81],",",["T_WHITESPACE","\n            ",81],["T_CONSTANT_ENCAPSED_STRING","':link_type_id'",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_INT_CAST","(int)",82],["T_VARIABLE","$typeId",82],",",["T_WHITESPACE","\n            ",82],["T_CONSTANT_ENCAPSED_STRING","':linked_product_id'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_INT_CAST","(int)",83],["T_VARIABLE","$linkedProductId",83],["T_WHITESPACE","\n        ",83],"]",";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$select",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$connection",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","select",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","from",85],"(",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getMainTable",86],"(",")",",",["T_WHITESPACE","\n            ",86],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id'",87],"]",["T_WHITESPACE","\n        ",87],")",["T_OBJECT_OPERATOR","->",88],["T_STRING","where",88],"(",["T_WHITESPACE","\n            ",88],["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",89],["T_WHITESPACE","\n        ",89],")",["T_OBJECT_OPERATOR","->",90],["T_STRING","where",90],"(",["T_WHITESPACE","\n            ",90],["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",91],["T_WHITESPACE","\n        ",91],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","where",92],"(",["T_WHITESPACE","\n            ",92],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id = :linked_product_id'",93],["T_WHITESPACE","\n        ",93],")",";",["T_WHITESPACE","\n\n        ",94],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$connection",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","fetchOne",96],"(",["T_VARIABLE","$select",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$bind",96],")",";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Check if product has links.\n     *\n     * @param int $parentId ID of product\n     * @return bool\n     *\/",99],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","hasProductLinks",105],"(",["T_VARIABLE","$parentId",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$connection",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getConnection",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$select",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$connection",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","select",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","from",108],"(",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getMainTable",109],"(",")",",",["T_WHITESPACE","\n            ",109],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Zend_Db_Expr",110],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",110],")","]",["T_WHITESPACE","\n        ",110],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","where",111],"(",["T_WHITESPACE","\n            ",111],["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",112],["T_WHITESPACE","\n        ",112],")",["T_WHITESPACE"," ",113],";",["T_WHITESPACE","\n\n        ",113],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$connection",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","fetchOne",115],"(",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$select",116],",",["T_WHITESPACE","\n            ",116],"[",["T_WHITESPACE","\n                ",117],["T_CONSTANT_ENCAPSED_STRING","'product_id'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$parentId",118],["T_WHITESPACE","\n            ",118],"]",["T_WHITESPACE","\n        ",119],")",["T_WHITESPACE"," ",120],">",["T_WHITESPACE"," ",120],["T_LNUMBER","0",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Save Product Links process\n     *\n     * @param int $parentId\n     * @param array $data\n     * @param int $typeId\n     * @return $this\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",123],["T_WHITESPACE","\n    ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","saveProductLinks",133],"(",["T_VARIABLE","$parentId",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$data",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$typeId",133],")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(","!",["T_STRING","is_array",135],"(",["T_VARIABLE","$data",135],")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$data",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],"[","]",";",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$attributes",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getAttributesByType",139],"(",["T_VARIABLE","$typeId",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$connection",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getConnection",140],"(",")",";",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$bind",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],"[",["T_CONSTANT_ENCAPSED_STRING","':product_id'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_INT_CAST","(int)",142],["T_VARIABLE","$parentId",142],",",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","':link_type_id'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_INT_CAST","(int)",142],["T_VARIABLE","$typeId",142],"]",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$select",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$connection",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","select",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","from",143],"(",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getMainTable",144],"(",")",",",["T_WHITESPACE","\n            ",144],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'link_id'",145],"]",["T_WHITESPACE","\n        ",145],")",["T_OBJECT_OPERATOR","->",146],["T_STRING","where",146],"(",["T_WHITESPACE","\n            ",146],["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",147],["T_WHITESPACE","\n        ",147],")",["T_OBJECT_OPERATOR","->",148],["T_STRING","where",148],"(",["T_WHITESPACE","\n            ",148],["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",149],["T_WHITESPACE","\n        ",149],")",";",["T_WHITESPACE","\n\n        ",150],["T_VARIABLE","$links",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$connection",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","fetchPairs",152],"(",["T_VARIABLE","$select",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$bind",152],")",";",["T_WHITESPACE","\n\n        ",152],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$data",154],["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$linkedProductId",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$linkInfo",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$linkId",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_STRING","null",155],";",["T_WHITESPACE","\n            ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_ISSET","isset",156],"(",["T_VARIABLE","$links",156],"[",["T_VARIABLE","$linkedProductId",156],"]",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$linkId",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$links",157],"[",["T_VARIABLE","$linkedProductId",157],"]",";",["T_WHITESPACE","\n                ",157],["T_UNSET","unset",158],"(",["T_VARIABLE","$links",158],"[",["T_VARIABLE","$linkedProductId",158],"]",")",";",["T_WHITESPACE","\n            ",158],"}",["T_WHITESPACE"," ",159],["T_ELSE","else",159],["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                ",159],["T_VARIABLE","$bind",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],"[",["T_WHITESPACE","\n                    ",160],["T_CONSTANT_ENCAPSED_STRING","'product_id'",161],["T_WHITESPACE"," ",161],["T_DOUBLE_ARROW","=>",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$parentId",161],",",["T_WHITESPACE","\n                    ",161],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",162],["T_WHITESPACE"," ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$linkedProductId",162],",",["T_WHITESPACE","\n                    ",162],["T_CONSTANT_ENCAPSED_STRING","'link_type_id'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$typeId",163],",",["T_WHITESPACE","\n                ",163],"]",";",["T_WHITESPACE","\n                ",164],["T_VARIABLE","$connection",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","insert",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getMainTable",165],"(",")",",",["T_WHITESPACE"," ",165],["T_VARIABLE","$bind",165],")",";",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$linkId",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$connection",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","lastInsertId",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getMainTable",166],"(",")",")",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n\n            ",167],["T_FOREACH","foreach",169],["T_WHITESPACE"," ",169],"(",["T_VARIABLE","$attributes",169],["T_WHITESPACE"," ",169],["T_AS","as",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$attributeInfo",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                ",169],["T_VARIABLE","$attributeTable",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getAttributeTypeTable",170],"(",["T_VARIABLE","$attributeInfo",170],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",170],"]",")",";",["T_WHITESPACE","\n                ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$attributeTable",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                    ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_ISSET","isset",172],"(",["T_VARIABLE","$linkInfo",172],"[",["T_VARIABLE","$attributeInfo",172],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",172],"]","]",")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                        ",172],["T_VARIABLE","$value",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_prepareAttributeValue",173],"(",["T_WHITESPACE","\n                            ",173],["T_VARIABLE","$attributeInfo",174],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",174],"]",",",["T_WHITESPACE","\n                            ",174],["T_VARIABLE","$linkInfo",175],"[",["T_VARIABLE","$attributeInfo",175],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",175],"]","]",["T_WHITESPACE","\n                        ",175],")",";",["T_WHITESPACE","\n                        ",176],["T_VARIABLE","$bind",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],"[",["T_WHITESPACE","\n                            ",177],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id'",178],["T_WHITESPACE"," ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$attributeInfo",178],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",178],"]",",",["T_WHITESPACE","\n                            ",178],["T_CONSTANT_ENCAPSED_STRING","'link_id'",179],["T_WHITESPACE"," ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$linkId",179],",",["T_WHITESPACE","\n                            ",179],["T_CONSTANT_ENCAPSED_STRING","'value'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$value",180],",",["T_WHITESPACE","\n                        ",180],"]",";",["T_WHITESPACE","\n                        ",181],["T_VARIABLE","$connection",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","insertOnDuplicate",182],"(",["T_VARIABLE","$attributeTable",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$bind",182],",",["T_WHITESPACE"," ",182],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",182],"]",")",";",["T_WHITESPACE","\n                    ",182],"}",["T_WHITESPACE"," ",183],["T_ELSE","else",183],["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                        ",183],["T_VARIABLE","$connection",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","delete",184],"(",["T_WHITESPACE","\n                            ",184],["T_VARIABLE","$attributeTable",185],",",["T_WHITESPACE","\n                            ",185],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id = ?'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$linkId",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id = ?'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$attributeInfo",186],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",186],"]","]",["T_WHITESPACE","\n                        ",186],")",";",["T_WHITESPACE","\n                    ",187],"}",["T_WHITESPACE","\n                ",188],"}",["T_WHITESPACE","\n            ",189],"}",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE","\n\n        ",191],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Prepare link attribute value by attribute type\n     *\n     * @param string $type\n     * @param mixed $value\n     * @return mixed\n     *\/",196],["T_WHITESPACE","\n    ",202],["T_PROTECTED","protected",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","_prepareAttributeValue",203],"(",["T_VARIABLE","$type",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$value",203],")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$type",205],["T_WHITESPACE"," ",205],["T_IS_EQUAL","==",205],["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'int'",205],")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$value",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_INT_CAST","(int)",206],["T_VARIABLE","$value",206],";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE"," ",207],["T_ELSEIF","elseif",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$type",207],["T_WHITESPACE"," ",207],["T_IS_EQUAL","==",207],["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'decimal'",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$value",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_DOUBLE_CAST","(double)",208],["T_STRING","sprintf",208],"(",["T_CONSTANT_ENCAPSED_STRING","'%F'",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$value",208],")",";",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n        ",209],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$value",210],";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Retrieve product link attributes by link type\n     *\n     * @param int $typeId\n     * @return array\n     *\/",213],["T_WHITESPACE","\n    ",218],["T_PUBLIC","public",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","getAttributesByType",219],"(",["T_VARIABLE","$typeId",219],")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$connection",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getConnection",221],"(",")",";",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$select",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$connection",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","select",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","from",222],"(",["T_WHITESPACE","\n            ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_attributesTable",223],",",["T_WHITESPACE","\n            ",223],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id'",224],",",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'code'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_code'",224],",",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'type'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'data_type'",224],"]",["T_WHITESPACE","\n        ",224],")",["T_OBJECT_OPERATOR","->",225],["T_STRING","where",225],"(",["T_WHITESPACE","\n            ",225],["T_CONSTANT_ENCAPSED_STRING","'link_type_id = ?'",226],",",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$typeId",227],["T_WHITESPACE","\n        ",227],")",";",["T_WHITESPACE","\n        ",228],["T_RETURN","return",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$connection",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","fetchAll",229],"(",["T_VARIABLE","$select",229],")",";",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_DOC_COMMENT","\/**\n     * Returns table for link attribute by attribute type\n     *\n     * @param string $type\n     * @return string\n     *\/",232],["T_WHITESPACE","\n    ",237],["T_PUBLIC","public",238],["T_WHITESPACE"," ",238],["T_FUNCTION","function",238],["T_WHITESPACE"," ",238],["T_STRING","getAttributeTypeTable",238],"(",["T_VARIABLE","$type",238],")",["T_WHITESPACE","\n    ",238],"{",["T_WHITESPACE","\n        ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getTable",240],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_link_attribute_'",240],["T_WHITESPACE"," ",240],".",["T_WHITESPACE"," ",240],["T_VARIABLE","$type",240],")",";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Retrieve Required children ids\n     * Return grouped array, ex array(\n     *   group => array(ids)\n     * )\n     *\n     * @param int $parentId\n     * @param int $typeId\n     * @return array\n     *\/",243],["T_WHITESPACE","\n    ",252],["T_PUBLIC","public",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","getChildrenIds",253],"(",["T_VARIABLE","$parentId",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$typeId",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$connection",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getConnection",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$childrenIds",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],"[","]",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$bind",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],"[",["T_CONSTANT_ENCAPSED_STRING","':product_id'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_INT_CAST","(int)",257],["T_VARIABLE","$parentId",257],",",["T_WHITESPACE"," ",257],["T_CONSTANT_ENCAPSED_STRING","':link_type_id'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_INT_CAST","(int)",257],["T_VARIABLE","$typeId",257],"]",";",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$select",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$connection",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","select",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","from",258],"(",["T_WHITESPACE","\n            ",258],"[",["T_CONSTANT_ENCAPSED_STRING","'l'",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getMainTable",259],"(",")","]",",",["T_WHITESPACE","\n            ",259],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",260],"]",["T_WHITESPACE","\n        ",260],")",["T_OBJECT_OPERATOR","->",261],["T_STRING","where",261],"(",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",262],["T_WHITESPACE","\n        ",262],")",["T_OBJECT_OPERATOR","->",263],["T_STRING","where",263],"(",["T_WHITESPACE","\n            ",263],["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",264],["T_WHITESPACE","\n        ",264],")",";",["T_WHITESPACE","\n\n        ",265],["T_VARIABLE","$childrenIds",267],"[",["T_VARIABLE","$typeId",267],"]",["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],"[","]",";",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$result",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$connection",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","fetchAll",268],"(",["T_VARIABLE","$select",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$bind",268],")",";",["T_WHITESPACE","\n        ",268],["T_FOREACH","foreach",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$result",269],["T_WHITESPACE"," ",269],["T_AS","as",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$row",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$childrenIds",270],"[",["T_VARIABLE","$typeId",270],"]","[",["T_VARIABLE","$row",270],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",270],"]","]",["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$row",270],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",270],"]",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n\n        ",271],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$childrenIds",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Retrieve parent ids array by required child\n     *\n     * @param int|array $childId\n     * @param int $typeId\n     * @return string[]\n     *\/",276],["T_WHITESPACE","\n    ",282],["T_PUBLIC","public",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","getParentIdsByChild",283],"(",["T_VARIABLE","$childId",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$typeId",283],")",["T_WHITESPACE","\n    ",283],"{",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$parentIds",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],"[","]",";",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$connection",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getConnection",286],"(",")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$select",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$connection",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","select",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","from",287],"(",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getMainTable",288],"(",")",",",["T_WHITESPACE","\n            ",288],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",289],",",["T_WHITESPACE"," ",289],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",289],"]",["T_WHITESPACE","\n        ",289],")",["T_OBJECT_OPERATOR","->",290],["T_STRING","where",290],"(",["T_WHITESPACE","\n            ",290],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id IN(?)'",291],",",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$childId",292],["T_WHITESPACE","\n        ",292],")",["T_OBJECT_OPERATOR","->",293],["T_STRING","where",293],"(",["T_WHITESPACE","\n            ",293],["T_CONSTANT_ENCAPSED_STRING","'link_type_id = ?'",294],",",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$typeId",295],["T_WHITESPACE","\n        ",295],")",";",["T_WHITESPACE","\n\n        ",296],["T_VARIABLE","$result",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$connection",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","fetchAll",298],"(",["T_VARIABLE","$select",298],")",";",["T_WHITESPACE","\n        ",298],["T_FOREACH","foreach",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$result",299],["T_WHITESPACE"," ",299],["T_AS","as",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$row",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_VARIABLE","$parentIds",300],"[","]",["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$row",300],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",300],"]",";",["T_WHITESPACE","\n        ",300],"}",["T_WHITESPACE","\n\n        ",301],["T_RETURN","return",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$parentIds",303],";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n",304],"}",["T_WHITESPACE","\n",305]]