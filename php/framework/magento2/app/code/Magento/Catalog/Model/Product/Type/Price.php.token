[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Catalog",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Product",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Type",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Catalog",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Product",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Customer",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","GroupManagementInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Pricing",11],["T_NS_SEPARATOR","\\",11],["T_STRING","PriceCurrencyInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Store",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Store",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Catalog",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Data",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ProductTierPriceExtensionFactory",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * Product type price model\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",15],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","Price",19],["T_WHITESPACE","\n",19],"{",["T_WHITESPACE","\n    ",20],["T_DOC_COMMENT","\/**\n     * Product price cache tag\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","CACHE_TAG",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'PRODUCT_PRICE'",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_STATIC","static",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$attributeCache",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],"[","]",";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Core event manager proxy\n     *\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",31],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_eventManager",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Customer session\n     *\n     * @var \\Magento\\Customer\\Model\\Session\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_customerSession",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_localeDate",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Store manager\n     *\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_storeManager",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Rule factory\n     *\n     * @var \\Magento\\CatalogRule\\Model\\ResourceModel\\RuleFactory\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_ruleFactory",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * @var PriceCurrencyInterface\n     *\/",64],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$priceCurrency",67],";",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * @var GroupManagementInterface\n     *\/",69],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$_groupManagement",72],";",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Api\\Data\\ProductTierPriceInterfaceFactory\n     *\/",74],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$tierPriceFactory",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\Config\\ScopeConfigInterface\n     *\/",79],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$config",82],";",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * @var ProductTierPriceExtensionFactory\n     *\/",84],["T_WHITESPACE","\n    ",86],["T_PRIVATE","private",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$tierPriceExtensionFactory",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Price constructor.\n     * @param \\Magento\\CatalogRule\\Model\\ResourceModel\\RuleFactory $ruleFactory\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface $localeDate\n     * @param \\Magento\\Customer\\Model\\Session $customerSession\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param PriceCurrencyInterface $priceCurrency\n     * @param GroupManagementInterface $groupManagement\n     * @param \\Magento\\Catalog\\Api\\Data\\ProductTierPriceInterfaceFactory $tierPriceFactory\n     * @param \\Magento\\Framework\\App\\Config\\ScopeConfigInterface $config\n     *\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",89],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","__construct",103],"(",["T_WHITESPACE","\n        ",103],["T_NS_SEPARATOR","\\",104],["T_STRING","Magento",104],["T_NS_SEPARATOR","\\",104],["T_STRING","CatalogRule",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Model",104],["T_NS_SEPARATOR","\\",104],["T_STRING","ResourceModel",104],["T_NS_SEPARATOR","\\",104],["T_STRING","RuleFactory",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$ruleFactory",104],",",["T_WHITESPACE","\n        ",104],["T_NS_SEPARATOR","\\",105],["T_STRING","Magento",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Store",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Model",105],["T_NS_SEPARATOR","\\",105],["T_STRING","StoreManagerInterface",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$storeManager",105],",",["T_WHITESPACE","\n        ",105],["T_NS_SEPARATOR","\\",106],["T_STRING","Magento",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Framework",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Stdlib",106],["T_NS_SEPARATOR","\\",106],["T_STRING","DateTime",106],["T_NS_SEPARATOR","\\",106],["T_STRING","TimezoneInterface",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$localeDate",106],",",["T_WHITESPACE","\n        ",106],["T_NS_SEPARATOR","\\",107],["T_STRING","Magento",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Customer",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Model",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Session",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$customerSession",107],",",["T_WHITESPACE","\n        ",107],["T_NS_SEPARATOR","\\",108],["T_STRING","Magento",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Framework",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Event",108],["T_NS_SEPARATOR","\\",108],["T_STRING","ManagerInterface",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$eventManager",108],",",["T_WHITESPACE","\n        ",108],["T_STRING","PriceCurrencyInterface",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$priceCurrency",109],",",["T_WHITESPACE","\n        ",109],["T_STRING","GroupManagementInterface",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$groupManagement",110],",",["T_WHITESPACE","\n        ",110],["T_NS_SEPARATOR","\\",111],["T_STRING","Magento",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Catalog",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Api",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Data",111],["T_NS_SEPARATOR","\\",111],["T_STRING","ProductTierPriceInterfaceFactory",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$tierPriceFactory",111],",",["T_WHITESPACE","\n        ",111],["T_NS_SEPARATOR","\\",112],["T_STRING","Magento",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Framework",112],["T_NS_SEPARATOR","\\",112],["T_STRING","App",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Config",112],["T_NS_SEPARATOR","\\",112],["T_STRING","ScopeConfigInterface",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$config",112],["T_WHITESPACE","\n    ",112],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_ruleFactory",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$ruleFactory",114],";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_storeManager",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$storeManager",115],";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_localeDate",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$localeDate",116],";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_customerSession",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$customerSession",117],";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_eventManager",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$eventManager",118],";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","priceCurrency",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$priceCurrency",119],";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_groupManagement",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$groupManagement",120],";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","tierPriceFactory",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$tierPriceFactory",121],";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","config",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$config",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Default action to get price of product\n     *\n     * @param Product $product\n     * @return float\n     *\/",125],["T_WHITESPACE","\n    ",130],["T_PUBLIC","public",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","getPrice",131],"(",["T_VARIABLE","$product",131],")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$product",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getData",133],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",133],")",";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Get base price with apply Group, Tier, Special prises\n     *\n     * @param Product $product\n     * @param float|null $qty\n     *\n     * @return float\n     *\/",136],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","getBasePrice",144],"(",["T_VARIABLE","$product",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$qty",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","null",144],")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$price",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_DOUBLE_CAST","(float)",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$product",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getPrice",146],"(",")",";",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_STRING","min",147],"(",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_applyTierPrice",148],"(",["T_VARIABLE","$product",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$qty",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$price",148],")",",",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_applySpecialPrice",149],"(",["T_VARIABLE","$product",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$price",149],")",["T_WHITESPACE","\n        ",149],")",";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Retrieve product final price\n     *\n     * @param float|null $qty\n     * @param Product $product\n     * @return float\n     *\/",153],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","getFinalPrice",160],"(",["T_VARIABLE","$qty",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$product",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$qty",162],["T_WHITESPACE"," ",162],["T_IS_IDENTICAL","===",162],["T_WHITESPACE"," ",162],["T_STRING","null",162],["T_WHITESPACE"," ",162],["T_BOOLEAN_AND","&&",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$product",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getCalculatedFinalPrice",162],"(",")",["T_WHITESPACE"," ",162],["T_IS_NOT_IDENTICAL","!==",162],["T_WHITESPACE"," ",162],["T_STRING","null",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$product",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getCalculatedFinalPrice",163],"(",")",";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE","\n\n        ",164],["T_VARIABLE","$finalPrice",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getBasePrice",166],"(",["T_VARIABLE","$product",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$qty",166],")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$product",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","setFinalPrice",167],"(",["T_VARIABLE","$finalPrice",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_eventManager",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","dispatch",169],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_get_final_price'",169],",",["T_WHITESPACE"," ",169],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$product",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'qty'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$qty",169],"]",")",";",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$finalPrice",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$product",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getData",171],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",171],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$finalPrice",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_applyOptionsPrice",172],"(",["T_VARIABLE","$product",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$qty",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$finalPrice",172],")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$finalPrice",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","max",173],"(",["T_LNUMBER","0",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$finalPrice",173],")",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$product",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","setFinalPrice",174],"(",["T_VARIABLE","$finalPrice",174],")",";",["T_WHITESPACE","\n\n        ",174],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$finalPrice",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * @param Product $product\n     * @param float $productQty\n     * @param Product $childProduct\n     * @param float $childProductQty\n     * @return float\n     *\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",179],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","getChildFinalPrice",188],"(",["T_VARIABLE","$product",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$productQty",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$childProduct",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$childProductQty",188],")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_RETURN","return",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getFinalPrice",190],"(",["T_VARIABLE","$childProductQty",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$childProduct",190],")",";",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Gets the 'tear_price' array from the product\n     *\n     * @param Product $product\n     * @param string $key\n     * @param bool $returnRawData\n     * @return array\n     *\/",193],["T_WHITESPACE","\n    ",200],["T_PROTECTED","protected",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","getExistingPrices",201],"(",["T_VARIABLE","$product",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$key",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$returnRawData",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","false",201],")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$prices",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$product",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getData",203],"(",["T_VARIABLE","$key",203],")",";",["T_WHITESPACE","\n\n        ",203],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$prices",205],["T_WHITESPACE"," ",205],["T_IS_IDENTICAL","===",205],["T_WHITESPACE"," ",205],["T_STRING","null",205],")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$attribute",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getResource",206],"(",")",["T_OBJECT_OPERATOR","->",206],["T_STRING","getAttribute",206],"(",["T_VARIABLE","$key",206],")",";",["T_WHITESPACE","\n            ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$attribute",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$attribute",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getBackend",208],"(",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","afterLoad",208],"(",["T_VARIABLE","$product",208],")",";",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$prices",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$product",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getData",209],"(",["T_VARIABLE","$key",209],")",";",["T_WHITESPACE","\n            ",209],"}",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n\n        ",211],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$prices",213],["T_WHITESPACE"," ",213],["T_IS_IDENTICAL","===",213],["T_WHITESPACE"," ",213],["T_STRING","null",213],["T_WHITESPACE"," ",213],["T_BOOLEAN_OR","||",213],["T_WHITESPACE"," ",213],"!",["T_STRING","is_array",213],"(",["T_VARIABLE","$prices",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$returnRawData",214],["T_WHITESPACE"," ",214],"?",["T_WHITESPACE"," ",214],["T_VARIABLE","$prices",214],["T_WHITESPACE"," ",214],":",["T_WHITESPACE"," ",214],"[","]",")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$prices",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Returns the website to use for group or tier prices, based on the price scope setting\n     *\n     * @return int|mixed\n     *\/",220],["T_WHITESPACE","\n    ",224],["T_PROTECTED","protected",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","getWebsiteForPriceScope",225],"(",")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$websiteId",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_LNUMBER","0",227],";",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$value",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","config",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getValue",228],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/price\/scope'",228],",",["T_WHITESPACE"," ",228],["T_NS_SEPARATOR","\\",228],["T_STRING","Magento",228],["T_NS_SEPARATOR","\\",228],["T_STRING","Store",228],["T_NS_SEPARATOR","\\",228],["T_STRING","Model",228],["T_NS_SEPARATOR","\\",228],["T_STRING","ScopeInterface",228],["T_DOUBLE_COLON","::",228],["T_STRING","SCOPE_WEBSITE",228],")",";",["T_WHITESPACE","\n        ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$value",229],["T_WHITESPACE"," ",229],["T_IS_NOT_EQUAL","!=",229],["T_WHITESPACE"," ",229],["T_LNUMBER","0",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_COMMENT","\/\/ use the website associated with the current store\n",230],["T_WHITESPACE","            ",231],["T_VARIABLE","$websiteId",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_storeManager",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getWebsite",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","getId",231],"(",")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n        ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$websiteId",233],";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Apply tier price for product if not return price that was before\n     *\n     * @param   Product $product\n     * @param   float $qty\n     * @param   float $finalPrice\n     * @return  float\n     *\/",236],["T_WHITESPACE","\n    ",243],["T_PROTECTED","protected",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","_applyTierPrice",244],"(",["T_VARIABLE","$product",244],",",["T_WHITESPACE"," ",244],["T_VARIABLE","$qty",244],",",["T_WHITESPACE"," ",244],["T_VARIABLE","$finalPrice",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$qty",246],["T_WHITESPACE"," ",246],["T_IS_IDENTICAL","===",246],["T_WHITESPACE"," ",246],["T_STRING","null",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$finalPrice",247],";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE","\n\n        ",248],["T_VARIABLE","$tierPrice",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$product",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getTierPrice",250],"(",["T_VARIABLE","$qty",250],")",";",["T_WHITESPACE","\n        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_STRING","is_numeric",251],"(",["T_VARIABLE","$tierPrice",251],")",")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_VARIABLE","$finalPrice",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_STRING","min",252],"(",["T_VARIABLE","$finalPrice",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$tierPrice",252],")",";",["T_WHITESPACE","\n        ",252],"}",["T_WHITESPACE","\n        ",253],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$finalPrice",254],";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Get product tier price by qty\n     *\n     * @param   float $qty\n     * @param   Product $product\n     * @return  float|array\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",257],["T_WHITESPACE","\n    ",265],["T_PUBLIC","public",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","getTierPrice",266],"(",["T_VARIABLE","$qty",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$product",266],")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$allGroupsId",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getAllCustomerGroupsId",268],"(",")",";",["T_WHITESPACE","\n\n        ",268],["T_VARIABLE","$prices",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getExistingPrices",270],"(",["T_VARIABLE","$product",270],",",["T_WHITESPACE"," ",270],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",270],",",["T_WHITESPACE"," ",270],["T_STRING","true",270],")",";",["T_WHITESPACE","\n        ",270],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$prices",271],["T_WHITESPACE"," ",271],["T_IS_IDENTICAL","===",271],["T_WHITESPACE"," ",271],["T_STRING","null",271],["T_WHITESPACE"," ",271],["T_BOOLEAN_OR","||",271],["T_WHITESPACE"," ",271],"!",["T_STRING","is_array",271],"(",["T_VARIABLE","$prices",271],")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n            ",271],["T_IF","if",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$qty",272],["T_WHITESPACE"," ",272],["T_IS_NOT_IDENTICAL","!==",272],["T_WHITESPACE"," ",272],["T_STRING","null",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$product",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getPrice",273],"(",")",";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE"," ",274],["T_ELSE","else",274],["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                ",274],["T_RETURN","return",275],["T_WHITESPACE"," ",275],"[",["T_WHITESPACE","\n                    ",275],"[",["T_WHITESPACE","\n                        ",276],["T_CONSTANT_ENCAPSED_STRING","'price'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$product",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getPrice",277],"(",")",",",["T_WHITESPACE","\n                        ",277],["T_CONSTANT_ENCAPSED_STRING","'website_price'",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$product",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getPrice",278],"(",")",",",["T_WHITESPACE","\n                        ",278],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",279],["T_WHITESPACE"," ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_LNUMBER","1",279],",",["T_WHITESPACE","\n                        ",279],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$allGroupsId",280],",",["T_WHITESPACE","\n                    ",280],"]",["T_WHITESPACE","\n                ",281],"]",";",["T_WHITESPACE","\n            ",282],"}",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_VARIABLE","$custGroup",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_getCustomerGroupId",286],"(",["T_VARIABLE","$product",286],")",";",["T_WHITESPACE","\n        ",286],["T_IF","if",287],["T_WHITESPACE"," ",287],"(",["T_VARIABLE","$qty",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$prevQty",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_LNUMBER","1",288],";",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$prevPrice",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$product",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getPrice",289],"(",")",";",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$prevGroup",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$allGroupsId",290],";",["T_WHITESPACE","\n\n            ",290],["T_FOREACH","foreach",292],["T_WHITESPACE"," ",292],"(",["T_VARIABLE","$prices",292],["T_WHITESPACE"," ",292],["T_AS","as",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$price",292],")",["T_WHITESPACE"," ",292],"{",["T_WHITESPACE","\n                ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$price",293],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",293],"]",["T_WHITESPACE"," ",293],["T_IS_NOT_EQUAL","!=",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$custGroup",293],["T_WHITESPACE"," ",293],["T_BOOLEAN_AND","&&",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$price",293],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",293],"]",["T_WHITESPACE"," ",293],["T_IS_NOT_EQUAL","!=",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$allGroupsId",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                    ",293],["T_COMMENT","\/\/ tier not for current customer group nor is for all groups\n",294],["T_WHITESPACE","                    ",295],["T_CONTINUE","continue",295],";",["T_WHITESPACE","\n                ",295],"}",["T_WHITESPACE","\n                ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$qty",297],["T_WHITESPACE"," ",297],"<",["T_WHITESPACE"," ",297],["T_VARIABLE","$price",297],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",297],"]",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n                    ",297],["T_COMMENT","\/\/ tier is higher than product qty\n",298],["T_WHITESPACE","                    ",299],["T_CONTINUE","continue",299],";",["T_WHITESPACE","\n                ",299],"}",["T_WHITESPACE","\n                ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$price",301],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",301],"]",["T_WHITESPACE"," ",301],"<",["T_WHITESPACE"," ",301],["T_VARIABLE","$prevQty",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                    ",301],["T_COMMENT","\/\/ higher tier qty already found\n",302],["T_WHITESPACE","                    ",303],["T_CONTINUE","continue",303],";",["T_WHITESPACE","\n                ",303],"}",["T_WHITESPACE","\n                ",304],["T_IF","if",305],["T_WHITESPACE"," ",305],"(",["T_VARIABLE","$price",305],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",305],"]",["T_WHITESPACE"," ",305],["T_IS_EQUAL","==",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$prevQty",305],["T_WHITESPACE"," ",305],["T_BOOLEAN_AND","&&",305],["T_WHITESPACE","\n                    ",305],["T_VARIABLE","$prevGroup",306],["T_WHITESPACE"," ",306],["T_IS_NOT_EQUAL","!=",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$allGroupsId",306],["T_WHITESPACE"," ",306],["T_BOOLEAN_AND","&&",306],["T_WHITESPACE","\n                    ",306],["T_VARIABLE","$price",307],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",307],"]",["T_WHITESPACE"," ",307],["T_IS_EQUAL","==",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$allGroupsId",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                    ",307],["T_COMMENT","\/\/ found tier qty is same as current tier qty but current tier group is ALL_GROUPS\n",308],["T_WHITESPACE","                    ",309],["T_CONTINUE","continue",309],";",["T_WHITESPACE","\n                ",309],"}",["T_WHITESPACE","\n                ",310],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$price",311],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",311],"]",["T_WHITESPACE"," ",311],"<",["T_WHITESPACE"," ",311],["T_VARIABLE","$prevPrice",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n                    ",311],["T_VARIABLE","$prevPrice",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$price",312],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",312],"]",";",["T_WHITESPACE","\n                    ",312],["T_VARIABLE","$prevQty",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$price",313],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",313],"]",";",["T_WHITESPACE","\n                    ",313],["T_VARIABLE","$prevGroup",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_VARIABLE","$price",314],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",314],"]",";",["T_WHITESPACE","\n                ",314],"}",["T_WHITESPACE","\n            ",315],"}",["T_WHITESPACE","\n            ",316],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$prevPrice",317],";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE"," ",318],["T_ELSE","else",318],["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$qtyCache",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],"[","]",";",["T_WHITESPACE","\n            ",319],["T_FOREACH","foreach",320],["T_WHITESPACE"," ",320],"(",["T_VARIABLE","$prices",320],["T_WHITESPACE"," ",320],["T_AS","as",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$priceKey",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$price",320],")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n                ",320],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$price",321],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",321],"]",["T_WHITESPACE"," ",321],["T_IS_NOT_EQUAL","!=",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$custGroup",321],["T_WHITESPACE"," ",321],["T_BOOLEAN_AND","&&",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$price",321],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",321],"]",["T_WHITESPACE"," ",321],["T_IS_NOT_EQUAL","!=",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$allGroupsId",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n                    ",321],["T_UNSET","unset",322],"(",["T_VARIABLE","$prices",322],"[",["T_VARIABLE","$priceKey",322],"]",")",";",["T_WHITESPACE","\n                ",322],"}",["T_WHITESPACE"," ",323],["T_ELSEIF","elseif",323],["T_WHITESPACE"," ",323],"(",["T_ISSET","isset",323],"(",["T_VARIABLE","$qtyCache",323],"[",["T_VARIABLE","$price",323],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",323],"]","]",")",")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n                    ",323],["T_VARIABLE","$priceQty",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_VARIABLE","$qtyCache",324],"[",["T_VARIABLE","$price",324],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",324],"]","]",";",["T_WHITESPACE","\n                    ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$prices",325],"[",["T_VARIABLE","$priceQty",325],"]","[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",325],"]",["T_WHITESPACE"," ",325],">",["T_WHITESPACE"," ",325],["T_VARIABLE","$price",325],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",325],"]",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n                        ",325],["T_UNSET","unset",326],"(",["T_VARIABLE","$prices",326],"[",["T_VARIABLE","$priceQty",326],"]",")",";",["T_WHITESPACE","\n                        ",326],["T_VARIABLE","$qtyCache",327],"[",["T_VARIABLE","$price",327],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",327],"]","]",["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$priceKey",327],";",["T_WHITESPACE","\n                    ",327],"}",["T_WHITESPACE"," ",328],["T_ELSE","else",328],["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                        ",328],["T_UNSET","unset",329],"(",["T_VARIABLE","$prices",329],"[",["T_VARIABLE","$priceKey",329],"]",")",";",["T_WHITESPACE","\n                    ",329],"}",["T_WHITESPACE","\n                ",330],"}",["T_WHITESPACE"," ",331],["T_ELSE","else",331],["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n                    ",331],["T_VARIABLE","$qtyCache",332],"[",["T_VARIABLE","$price",332],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",332],"]","]",["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$priceKey",332],";",["T_WHITESPACE","\n                ",332],"}",["T_WHITESPACE","\n            ",333],"}",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n\n        ",335],["T_RETURN","return",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$prices",337],["T_WHITESPACE"," ",337],"?",["T_WHITESPACE"," ",337],["T_VARIABLE","$prices",337],["T_WHITESPACE"," ",337],":",["T_WHITESPACE"," ",337],"[","]",";",["T_WHITESPACE","\n    ",337],"}",["T_WHITESPACE","\n\n    ",338],["T_DOC_COMMENT","\/**\n     * Gets the CUST_GROUP_ALL id\n     *\n     * @return int\n     *\/",340],["T_WHITESPACE","\n    ",344],["T_PROTECTED","protected",345],["T_WHITESPACE"," ",345],["T_FUNCTION","function",345],["T_WHITESPACE"," ",345],["T_STRING","getAllCustomerGroupsId",345],"(",")",["T_WHITESPACE","\n    ",345],"{",["T_WHITESPACE","\n        ",346],["T_COMMENT","\/\/ ex: 32000\n",347],["T_WHITESPACE","        ",348],["T_RETURN","return",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_groupManagement",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getAllCustomersGroup",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getId",348],"(",")",";",["T_WHITESPACE","\n    ",348],"}",["T_WHITESPACE","\n\n    ",349],["T_DOC_COMMENT","\/**\n     * Gets list of product tier prices\n     *\n     * @param Product $product\n     * @return \\Magento\\Catalog\\Api\\Data\\ProductTierPriceInterface[]\n     *\/",351],["T_WHITESPACE","\n    ",356],["T_PUBLIC","public",357],["T_WHITESPACE"," ",357],["T_FUNCTION","function",357],["T_WHITESPACE"," ",357],["T_STRING","getTierPrices",357],"(",["T_VARIABLE","$product",357],")",["T_WHITESPACE","\n    ",357],"{",["T_WHITESPACE","\n        ",358],["T_VARIABLE","$prices",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],"[","]",";",["T_WHITESPACE","\n        ",359],["T_VARIABLE","$tierPrices",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getExistingPrices",360],"(",["T_VARIABLE","$product",360],",",["T_WHITESPACE"," ",360],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",360],")",";",["T_WHITESPACE","\n        ",360],["T_FOREACH","foreach",361],["T_WHITESPACE"," ",361],"(",["T_VARIABLE","$tierPrices",361],["T_WHITESPACE"," ",361],["T_AS","as",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$price",361],")",["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n            ",361],["T_DOC_COMMENT","\/** @var \\Magento\\Catalog\\Api\\Data\\ProductTierPriceInterface $tierPrice *\/",362],["T_WHITESPACE","\n            ",362],["T_VARIABLE","$tierPrice",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","tierPriceFactory",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","create",363],"(",")",["T_WHITESPACE","\n                ",363],["T_OBJECT_OPERATOR","->",364],["T_STRING","setExtensionAttributes",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getTierPriceExtensionAttributes",364],"(",")",")",";",["T_WHITESPACE","\n            ",364],["T_VARIABLE","$tierPrice",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","setCustomerGroupId",365],"(",["T_VARIABLE","$price",365],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",365],"]",")",";",["T_WHITESPACE","\n            ",365],["T_IF","if",366],["T_WHITESPACE"," ",366],"(",["T_STRING","array_key_exists",366],"(",["T_CONSTANT_ENCAPSED_STRING","'website_price'",366],",",["T_WHITESPACE"," ",366],["T_VARIABLE","$price",366],")",")",["T_WHITESPACE"," ",366],"{",["T_WHITESPACE","\n                ",366],["T_VARIABLE","$value",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$price",367],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",367],"]",";",["T_WHITESPACE","\n            ",367],"}",["T_WHITESPACE"," ",368],["T_ELSE","else",368],["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n                ",368],["T_VARIABLE","$value",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_VARIABLE","$price",369],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",369],"]",";",["T_WHITESPACE","\n            ",369],"}",["T_WHITESPACE","\n            ",370],["T_VARIABLE","$tierPrice",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setValue",371],"(",["T_VARIABLE","$value",371],")",";",["T_WHITESPACE","\n            ",371],["T_VARIABLE","$tierPrice",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","setQty",372],"(",["T_VARIABLE","$price",372],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",372],"]",")",";",["T_WHITESPACE","\n            ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(",["T_ISSET","isset",373],"(",["T_VARIABLE","$price",373],"[",["T_CONSTANT_ENCAPSED_STRING","'percentage_value'",373],"]",")",")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_VARIABLE","$tierPrice",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getExtensionAttributes",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","setPercentageValue",374],"(",["T_VARIABLE","$price",374],"[",["T_CONSTANT_ENCAPSED_STRING","'percentage_value'",374],"]",")",";",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$websiteId",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_ISSET","isset",376],"(",["T_VARIABLE","$price",376],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",376],"]",")",["T_WHITESPACE"," ",376],"?",["T_WHITESPACE"," ",376],["T_VARIABLE","$price",376],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",376],"]",["T_WHITESPACE"," ",376],":",["T_WHITESPACE"," ",376],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getWebsiteForPriceScope",376],"(",")",";",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$tierPrice",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getExtensionAttributes",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","setWebsiteId",377],"(",["T_VARIABLE","$websiteId",377],")",";",["T_WHITESPACE","\n            ",377],["T_VARIABLE","$prices",378],"[","]",["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$tierPrice",378],";",["T_WHITESPACE","\n        ",378],"}",["T_WHITESPACE","\n        ",379],["T_RETURN","return",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$prices",380],";",["T_WHITESPACE","\n    ",380],"}",["T_WHITESPACE","\n\n    ",381],["T_DOC_COMMENT","\/**\n     * @deprecated\n     * @return \\Magento\\Catalog\\Api\\Data\\ProductTierPriceExtensionInterface\n     *\/",383],["T_WHITESPACE","\n    ",386],["T_PRIVATE","private",387],["T_WHITESPACE"," ",387],["T_FUNCTION","function",387],["T_WHITESPACE"," ",387],["T_STRING","getTierPriceExtensionAttributes",387],"(",")",["T_WHITESPACE","\n    ",387],"{",["T_WHITESPACE","\n        ",388],["T_IF","if",389],["T_WHITESPACE"," ",389],"(","!",["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","tierPriceExtensionFactory",389],")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","tierPriceExtensionFactory",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_NS_SEPARATOR","\\",390],["T_STRING","Magento",390],["T_NS_SEPARATOR","\\",390],["T_STRING","Framework",390],["T_NS_SEPARATOR","\\",390],["T_STRING","App",390],["T_NS_SEPARATOR","\\",390],["T_STRING","ObjectManager",390],["T_DOUBLE_COLON","::",390],["T_STRING","getInstance",390],"(",")",["T_WHITESPACE","\n                ",390],["T_OBJECT_OPERATOR","->",391],["T_STRING","get",391],"(",["T_STRING","ProductTierPriceExtensionFactory",391],["T_DOUBLE_COLON","::",391],["T_CLASS","class",391],")",";",["T_WHITESPACE","\n        ",391],"}",["T_WHITESPACE","\n        ",392],["T_RETURN","return",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","tierPriceExtensionFactory",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","create",393],"(",")",";",["T_WHITESPACE","\n    ",393],"}",["T_WHITESPACE","\n\n    ",394],["T_DOC_COMMENT","\/**\n     * Sets list of product tier prices\n     *\n     * @param Product $product\n     * @param \\Magento\\Catalog\\Api\\Data\\ProductTierPriceInterface[] $tierPrices\n     * @return $this\n     *\/",396],["T_WHITESPACE","\n    ",402],["T_PUBLIC","public",403],["T_WHITESPACE"," ",403],["T_FUNCTION","function",403],["T_WHITESPACE"," ",403],["T_STRING","setTierPrices",403],"(",["T_VARIABLE","$product",403],",",["T_WHITESPACE"," ",403],["T_ARRAY","array",403],["T_WHITESPACE"," ",403],["T_VARIABLE","$tierPrices",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_STRING","null",403],")",["T_WHITESPACE","\n    ",403],"{",["T_WHITESPACE","\n        ",404],["T_COMMENT","\/\/ null array means leave everything as is\n",405],["T_WHITESPACE","        ",406],["T_IF","if",406],["T_WHITESPACE"," ",406],"(",["T_VARIABLE","$tierPrices",406],["T_WHITESPACE"," ",406],["T_IS_IDENTICAL","===",406],["T_WHITESPACE"," ",406],["T_STRING","null",406],")",["T_WHITESPACE"," ",406],"{",["T_WHITESPACE","\n            ",406],["T_RETURN","return",407],["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],";",["T_WHITESPACE","\n        ",407],"}",["T_WHITESPACE","\n\n        ",408],["T_VARIABLE","$allGroupsId",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getAllCustomerGroupsId",410],"(",")",";",["T_WHITESPACE","\n        ",410],["T_VARIABLE","$websiteId",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getWebsiteForPriceScope",411],"(",")",";",["T_WHITESPACE","\n\n        ",411],["T_COMMENT","\/\/ build the new array of tier prices\n",413],["T_WHITESPACE","        ",414],["T_VARIABLE","$prices",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],"[","]",";",["T_WHITESPACE","\n        ",414],["T_FOREACH","foreach",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$tierPrices",415],["T_WHITESPACE"," ",415],["T_AS","as",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$price",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_VARIABLE","$extensionAttributes",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$price",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getExtensionAttributes",416],"(",")",";",["T_WHITESPACE","\n            ",416],["T_VARIABLE","$priceWebsiteId",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$websiteId",417],";",["T_WHITESPACE","\n            ",417],["T_IF","if",418],["T_WHITESPACE"," ",418],"(",["T_ISSET","isset",418],"(",["T_VARIABLE","$extensionAttributes",418],")",["T_WHITESPACE"," ",418],["T_BOOLEAN_AND","&&",418],["T_WHITESPACE"," ",418],["T_STRING","is_numeric",418],"(",["T_VARIABLE","$extensionAttributes",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getWebsiteId",418],"(",")",")",")",["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n                ",418],["T_VARIABLE","$priceWebsiteId",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_STRING_CAST","(string)",419],["T_VARIABLE","$extensionAttributes",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getWebsiteId",419],"(",")",";",["T_WHITESPACE","\n            ",419],"}",["T_WHITESPACE","\n            ",420],["T_VARIABLE","$prices",421],"[","]",["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],"[",["T_WHITESPACE","\n                ",421],["T_CONSTANT_ENCAPSED_STRING","'website_id'",422],["T_WHITESPACE"," ",422],["T_DOUBLE_ARROW","=>",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$priceWebsiteId",422],",",["T_WHITESPACE","\n                ",422],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",423],["T_WHITESPACE"," ",423],["T_DOUBLE_ARROW","=>",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$price",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getCustomerGroupId",423],"(",")",",",["T_WHITESPACE","\n                ",423],["T_CONSTANT_ENCAPSED_STRING","'website_price'",424],["T_WHITESPACE"," ",424],["T_DOUBLE_ARROW","=>",424],["T_WHITESPACE"," ",424],["T_VARIABLE","$price",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getValue",424],"(",")",",",["T_WHITESPACE","\n                ",424],["T_CONSTANT_ENCAPSED_STRING","'price'",425],["T_WHITESPACE"," ",425],["T_DOUBLE_ARROW","=>",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$price",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getValue",425],"(",")",",",["T_WHITESPACE","\n                ",425],["T_CONSTANT_ENCAPSED_STRING","'all_groups'",426],["T_WHITESPACE"," ",426],["T_DOUBLE_ARROW","=>",426],["T_WHITESPACE"," ",426],"(",["T_VARIABLE","$price",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getCustomerGroupId",426],"(",")",["T_WHITESPACE"," ",426],["T_IS_EQUAL","==",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$allGroupsId",426],")",",",["T_WHITESPACE","\n                ",426],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",427],["T_WHITESPACE"," ",427],["T_DOUBLE_ARROW","=>",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$price",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getQty",427],"(",")",",",["T_WHITESPACE","\n                ",427],["T_CONSTANT_ENCAPSED_STRING","'percentage_value'",428],["T_WHITESPACE"," ",428],["T_DOUBLE_ARROW","=>",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$extensionAttributes",428],["T_WHITESPACE"," ",428],"?",["T_WHITESPACE"," ",428],["T_VARIABLE","$extensionAttributes",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getPercentageValue",428],"(",")",["T_WHITESPACE"," ",428],":",["T_WHITESPACE"," ",428],["T_STRING","null",428],["T_WHITESPACE","\n            ",428],"]",";",["T_WHITESPACE","\n        ",429],"}",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$product",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","setData",431],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",431],",",["T_WHITESPACE"," ",431],["T_VARIABLE","$prices",431],")",";",["T_WHITESPACE","\n\n        ",431],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * @param Product $product\n     * @return int\n     *\/",436],["T_WHITESPACE","\n    ",439],["T_PROTECTED","protected",440],["T_WHITESPACE"," ",440],["T_FUNCTION","function",440],["T_WHITESPACE"," ",440],["T_STRING","_getCustomerGroupId",440],"(",["T_VARIABLE","$product",440],")",["T_WHITESPACE","\n    ",440],"{",["T_WHITESPACE","\n        ",441],["T_IF","if",442],["T_WHITESPACE"," ",442],"(",["T_VARIABLE","$product",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getCustomerGroupId",442],"(",")",["T_WHITESPACE"," ",442],["T_IS_NOT_IDENTICAL","!==",442],["T_WHITESPACE"," ",442],["T_STRING","null",442],")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_RETURN","return",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$product",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getCustomerGroupId",443],"(",")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE","\n        ",444],["T_RETURN","return",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_customerSession",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getCustomerGroupId",445],"(",")",";",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * Apply special price for product if not return price that was before\n     *\n     * @param   Product $product\n     * @param   float $finalPrice\n     * @return  float\n     *\/",448],["T_WHITESPACE","\n    ",454],["T_PROTECTED","protected",455],["T_WHITESPACE"," ",455],["T_FUNCTION","function",455],["T_WHITESPACE"," ",455],["T_STRING","_applySpecialPrice",455],"(",["T_VARIABLE","$product",455],",",["T_WHITESPACE"," ",455],["T_VARIABLE","$finalPrice",455],")",["T_WHITESPACE","\n    ",455],"{",["T_WHITESPACE","\n        ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","calculateSpecialPrice",457],"(",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$finalPrice",458],",",["T_WHITESPACE","\n            ",458],["T_VARIABLE","$product",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getSpecialPrice",459],"(",")",",",["T_WHITESPACE","\n            ",459],["T_VARIABLE","$product",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getSpecialFromDate",460],"(",")",",",["T_WHITESPACE","\n            ",460],["T_VARIABLE","$product",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getSpecialToDate",461],"(",")",",",["T_WHITESPACE","\n            ",461],["T_VARIABLE","$product",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","getStore",462],"(",")",["T_WHITESPACE","\n        ",462],")",";",["T_WHITESPACE","\n    ",463],"}",["T_WHITESPACE","\n\n    ",464],["T_DOC_COMMENT","\/**\n     * Count how many tier prices we have for the product\n     *\n     * @param   Product $product\n     * @return  int\n     *\/",466],["T_WHITESPACE","\n    ",471],["T_PUBLIC","public",472],["T_WHITESPACE"," ",472],["T_FUNCTION","function",472],["T_WHITESPACE"," ",472],["T_STRING","getTierPriceCount",472],"(",["T_VARIABLE","$product",472],")",["T_WHITESPACE","\n    ",472],"{",["T_WHITESPACE","\n        ",473],["T_VARIABLE","$price",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_VARIABLE","$product",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getTierPrice",474],"(",")",";",["T_WHITESPACE","\n        ",474],["T_RETURN","return",475],["T_WHITESPACE"," ",475],["T_STRING","count",475],"(",["T_VARIABLE","$price",475],")",";",["T_WHITESPACE","\n    ",475],"}",["T_WHITESPACE","\n\n    ",476],["T_DOC_COMMENT","\/**\n     * Get formatted by currency tier price\n     *\n     * @param   float $qty\n     * @param   Product $product\n     * @return  array|float\n     *\/",478],["T_WHITESPACE","\n    ",484],["T_PUBLIC","public",485],["T_WHITESPACE"," ",485],["T_FUNCTION","function",485],["T_WHITESPACE"," ",485],["T_STRING","getFormatedTierPrice",485],"(",["T_VARIABLE","$qty",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$product",485],")",["T_WHITESPACE","\n    ",485],"{",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$price",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$product",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getTierPrice",487],"(",["T_VARIABLE","$qty",487],")",";",["T_WHITESPACE","\n        ",487],["T_IF","if",488],["T_WHITESPACE"," ",488],"(",["T_STRING","is_array",488],"(",["T_VARIABLE","$price",488],")",")",["T_WHITESPACE"," ",488],"{",["T_WHITESPACE","\n            ",488],["T_FOREACH","foreach",489],["T_WHITESPACE"," ",489],"(",["T_STRING","array_keys",489],"(",["T_VARIABLE","$price",489],")",["T_WHITESPACE"," ",489],["T_AS","as",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$index",489],")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n                ",489],["T_VARIABLE","$price",490],"[",["T_VARIABLE","$index",490],"]","[",["T_CONSTANT_ENCAPSED_STRING","'formated_price'",490],"]",["T_WHITESPACE"," ",490],"=",["T_WHITESPACE"," ",490],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","priceCurrency",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","convertAndFormat",490],"(",["T_WHITESPACE","\n                    ",490],["T_VARIABLE","$price",491],"[",["T_VARIABLE","$index",491],"]","[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",491],"]",["T_WHITESPACE","\n                ",491],")",";",["T_WHITESPACE","\n            ",492],"}",["T_WHITESPACE","\n        ",493],"}",["T_WHITESPACE"," ",494],["T_ELSE","else",494],["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_VARIABLE","$price",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","priceCurrency",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","format",495],"(",["T_VARIABLE","$price",495],")",";",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE","\n\n        ",496],["T_RETURN","return",498],["T_WHITESPACE"," ",498],["T_VARIABLE","$price",498],";",["T_WHITESPACE","\n    ",498],"}",["T_WHITESPACE","\n\n    ",499],["T_DOC_COMMENT","\/**\n     * Get formatted by currency product price\n     *\n     * @param   Product $product\n     * @return  array || float\n     *\/",501],["T_WHITESPACE","\n    ",506],["T_PUBLIC","public",507],["T_WHITESPACE"," ",507],["T_FUNCTION","function",507],["T_WHITESPACE"," ",507],["T_STRING","getFormatedPrice",507],"(",["T_VARIABLE","$product",507],")",["T_WHITESPACE","\n    ",507],"{",["T_WHITESPACE","\n        ",508],["T_RETURN","return",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","priceCurrency",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","format",509],"(",["T_VARIABLE","$product",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getFinalPrice",509],"(",")",")",";",["T_WHITESPACE","\n    ",509],"}",["T_WHITESPACE","\n\n    ",510],["T_DOC_COMMENT","\/**\n     * Apply options price\n     *\n     * @param Product $product\n     * @param int $qty\n     * @param float $finalPrice\n     * @return float\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",512],["T_WHITESPACE","\n    ",520],["T_PROTECTED","protected",521],["T_WHITESPACE"," ",521],["T_FUNCTION","function",521],["T_WHITESPACE"," ",521],["T_STRING","_applyOptionsPrice",521],"(",["T_VARIABLE","$product",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$qty",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$finalPrice",521],")",["T_WHITESPACE","\n    ",521],"{",["T_WHITESPACE","\n        ",522],["T_VARIABLE","$optionIds",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_VARIABLE","$product",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getCustomOption",523],"(",["T_CONSTANT_ENCAPSED_STRING","'option_ids'",523],")",";",["T_WHITESPACE","\n        ",523],["T_IF","if",524],["T_WHITESPACE"," ",524],"(",["T_VARIABLE","$optionIds",524],")",["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n            ",524],["T_VARIABLE","$basePrice",525],["T_WHITESPACE"," ",525],"=",["T_WHITESPACE"," ",525],["T_VARIABLE","$finalPrice",525],";",["T_WHITESPACE","\n            ",525],["T_FOREACH","foreach",526],["T_WHITESPACE"," ",526],"(",["T_STRING","explode",526],"(",["T_CONSTANT_ENCAPSED_STRING","','",526],",",["T_WHITESPACE"," ",526],["T_VARIABLE","$optionIds",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getValue",526],"(",")",")",["T_WHITESPACE"," ",526],["T_AS","as",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$optionId",526],")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n                ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(",["T_VARIABLE","$option",527],["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_VARIABLE","$product",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getOptionById",527],"(",["T_VARIABLE","$optionId",527],")",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n                    ",527],["T_VARIABLE","$confItemOption",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_VARIABLE","$product",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getCustomOption",528],"(",["T_CONSTANT_ENCAPSED_STRING","'option_'",528],["T_WHITESPACE"," ",528],".",["T_WHITESPACE"," ",528],["T_VARIABLE","$option",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getId",528],"(",")",")",";",["T_WHITESPACE","\n\n                    ",528],["T_VARIABLE","$group",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$option",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","groupFactory",530],"(",["T_VARIABLE","$option",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getType",530],"(",")",")",["T_WHITESPACE","\n                        ",530],["T_OBJECT_OPERATOR","->",531],["T_STRING","setOption",531],"(",["T_VARIABLE","$option",531],")",["T_WHITESPACE","\n                        ",531],["T_OBJECT_OPERATOR","->",532],["T_STRING","setConfigurationItemOption",532],"(",["T_VARIABLE","$confItemOption",532],")",";",["T_WHITESPACE","\n                    ",532],["T_VARIABLE","$finalPrice",533],["T_WHITESPACE"," ",533],["T_PLUS_EQUAL","+=",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$group",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getOptionPrice",533],"(",["T_VARIABLE","$confItemOption",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getValue",533],"(",")",",",["T_WHITESPACE"," ",533],["T_VARIABLE","$basePrice",533],")",";",["T_WHITESPACE","\n                ",533],"}",["T_WHITESPACE","\n            ",534],"}",["T_WHITESPACE","\n        ",535],"}",["T_WHITESPACE","\n\n        ",536],["T_RETURN","return",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$finalPrice",538],";",["T_WHITESPACE","\n    ",538],"}",["T_WHITESPACE","\n\n    ",539],["T_DOC_COMMENT","\/**\n     * Calculate product price based on special price data and price rules\n     *\n     * @param   float $basePrice\n     * @param   float $specialPrice\n     * @param   string $specialPriceFrom\n     * @param   string $specialPriceTo\n     * @param   bool|float|null $rulePrice\n     * @param   mixed|null $wId\n     * @param   integer|null $gId\n     * @param   int|null $productId\n     * @return  float\n     *\/",541],["T_WHITESPACE","\n    ",553],["T_PUBLIC","public",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","calculatePrice",554],"(",["T_WHITESPACE","\n        ",554],["T_VARIABLE","$basePrice",555],",",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$specialPrice",556],",",["T_WHITESPACE","\n        ",556],["T_VARIABLE","$specialPriceFrom",557],",",["T_WHITESPACE","\n        ",557],["T_VARIABLE","$specialPriceTo",558],",",["T_WHITESPACE","\n        ",558],["T_VARIABLE","$rulePrice",559],["T_WHITESPACE"," ",559],"=",["T_WHITESPACE"," ",559],["T_STRING","false",559],",",["T_WHITESPACE","\n        ",559],["T_VARIABLE","$wId",560],["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_STRING","null",560],",",["T_WHITESPACE","\n        ",560],["T_VARIABLE","$gId",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_STRING","null",561],",",["T_WHITESPACE","\n        ",561],["T_VARIABLE","$productId",562],["T_WHITESPACE"," ",562],"=",["T_WHITESPACE"," ",562],["T_STRING","null",562],["T_WHITESPACE","\n    ",562],")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n        ",563],["T_NS_SEPARATOR","\\",564],["T_STRING","Magento",564],["T_NS_SEPARATOR","\\",564],["T_STRING","Framework",564],["T_NS_SEPARATOR","\\",564],["T_STRING","Profiler",564],["T_DOUBLE_COLON","::",564],["T_STRING","start",564],"(",["T_CONSTANT_ENCAPSED_STRING","'__PRODUCT_CALCULATE_PRICE__'",564],")",";",["T_WHITESPACE","\n        ",564],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_VARIABLE","$wId",565],["T_WHITESPACE"," ",565],["T_INSTANCEOF","instanceof",565],["T_WHITESPACE"," ",565],["T_STRING","Store",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$sId",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_VARIABLE","$wId",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","getId",566],"(",")",";",["T_WHITESPACE","\n            ",566],["T_VARIABLE","$wId",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$wId",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getWebsiteId",567],"(",")",";",["T_WHITESPACE","\n        ",567],"}",["T_WHITESPACE"," ",568],["T_ELSE","else",568],["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n            ",568],["T_VARIABLE","$sId",569],["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_storeManager",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","getWebsite",569],"(",["T_VARIABLE","$wId",569],")",["T_OBJECT_OPERATOR","->",569],["T_STRING","getDefaultGroup",569],"(",")",["T_OBJECT_OPERATOR","->",569],["T_STRING","getDefaultStoreId",569],"(",")",";",["T_WHITESPACE","\n        ",569],"}",["T_WHITESPACE","\n\n        ",570],["T_VARIABLE","$finalPrice",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$basePrice",572],";",["T_WHITESPACE","\n\n        ",572],["T_VARIABLE","$finalPrice",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","calculateSpecialPrice",574],"(",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$finalPrice",575],",",["T_WHITESPACE","\n            ",575],["T_VARIABLE","$specialPrice",576],",",["T_WHITESPACE","\n            ",576],["T_VARIABLE","$specialPriceFrom",577],",",["T_WHITESPACE","\n            ",577],["T_VARIABLE","$specialPriceTo",578],",",["T_WHITESPACE","\n            ",578],["T_VARIABLE","$sId",579],["T_WHITESPACE","\n        ",579],")",";",["T_WHITESPACE","\n\n        ",580],["T_IF","if",582],["T_WHITESPACE"," ",582],"(",["T_VARIABLE","$rulePrice",582],["T_WHITESPACE"," ",582],["T_IS_IDENTICAL","===",582],["T_WHITESPACE"," ",582],["T_STRING","false",582],")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n            ",582],["T_VARIABLE","$date",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_localeDate",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","scopeDate",583],"(",["T_VARIABLE","$sId",583],")",";",["T_WHITESPACE","\n            ",583],["T_VARIABLE","$rulePrice",584],["T_WHITESPACE"," ",584],"=",["T_WHITESPACE"," ",584],["T_VARIABLE","$this",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","_ruleFactory",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","create",584],"(",")",["T_OBJECT_OPERATOR","->",584],["T_STRING","getRulePrice",584],"(",["T_VARIABLE","$date",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$wId",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$gId",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$productId",584],")",";",["T_WHITESPACE","\n        ",584],"}",["T_WHITESPACE","\n\n        ",585],["T_IF","if",587],["T_WHITESPACE"," ",587],"(",["T_VARIABLE","$rulePrice",587],["T_WHITESPACE"," ",587],["T_IS_NOT_IDENTICAL","!==",587],["T_WHITESPACE"," ",587],["T_STRING","null",587],["T_WHITESPACE"," ",587],["T_BOOLEAN_AND","&&",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$rulePrice",587],["T_WHITESPACE"," ",587],["T_IS_NOT_IDENTICAL","!==",587],["T_WHITESPACE"," ",587],["T_STRING","false",587],")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n            ",587],["T_VARIABLE","$finalPrice",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_STRING","min",588],"(",["T_VARIABLE","$finalPrice",588],",",["T_WHITESPACE"," ",588],["T_VARIABLE","$rulePrice",588],")",";",["T_WHITESPACE","\n        ",588],"}",["T_WHITESPACE","\n\n        ",589],["T_VARIABLE","$finalPrice",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_STRING","max",591],"(",["T_VARIABLE","$finalPrice",591],",",["T_WHITESPACE"," ",591],["T_LNUMBER","0",591],")",";",["T_WHITESPACE","\n        ",591],["T_NS_SEPARATOR","\\",592],["T_STRING","Magento",592],["T_NS_SEPARATOR","\\",592],["T_STRING","Framework",592],["T_NS_SEPARATOR","\\",592],["T_STRING","Profiler",592],["T_DOUBLE_COLON","::",592],["T_STRING","stop",592],"(",["T_CONSTANT_ENCAPSED_STRING","'__PRODUCT_CALCULATE_PRICE__'",592],")",";",["T_WHITESPACE","\n        ",592],["T_RETURN","return",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$finalPrice",593],";",["T_WHITESPACE","\n    ",593],"}",["T_WHITESPACE","\n\n    ",594],["T_DOC_COMMENT","\/**\n     * Calculate and apply special price\n     *\n     * @param float $finalPrice\n     * @param float $specialPrice\n     * @param string $specialPriceFrom\n     * @param string $specialPriceTo\n     * @param int|string|Store $store\n     * @return float\n     *\/",596],["T_WHITESPACE","\n    ",605],["T_PUBLIC","public",606],["T_WHITESPACE"," ",606],["T_FUNCTION","function",606],["T_WHITESPACE"," ",606],["T_STRING","calculateSpecialPrice",606],"(",["T_WHITESPACE","\n        ",606],["T_VARIABLE","$finalPrice",607],",",["T_WHITESPACE","\n        ",607],["T_VARIABLE","$specialPrice",608],",",["T_WHITESPACE","\n        ",608],["T_VARIABLE","$specialPriceFrom",609],",",["T_WHITESPACE","\n        ",609],["T_VARIABLE","$specialPriceTo",610],",",["T_WHITESPACE","\n        ",610],["T_VARIABLE","$store",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_STRING","null",611],["T_WHITESPACE","\n    ",611],")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n        ",612],["T_IF","if",613],["T_WHITESPACE"," ",613],"(",["T_VARIABLE","$specialPrice",613],["T_WHITESPACE"," ",613],["T_IS_NOT_IDENTICAL","!==",613],["T_WHITESPACE"," ",613],["T_STRING","null",613],["T_WHITESPACE"," ",613],["T_BOOLEAN_AND","&&",613],["T_WHITESPACE"," ",613],["T_VARIABLE","$specialPrice",613],["T_WHITESPACE"," ",613],["T_IS_NOT_EQUAL","!=",613],["T_WHITESPACE"," ",613],["T_STRING","false",613],")",["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n            ",613],["T_IF","if",614],["T_WHITESPACE"," ",614],"(",["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","_localeDate",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","isScopeDateInInterval",614],"(",["T_VARIABLE","$store",614],",",["T_WHITESPACE"," ",614],["T_VARIABLE","$specialPriceFrom",614],",",["T_WHITESPACE"," ",614],["T_VARIABLE","$specialPriceTo",614],")",")",["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n                ",614],["T_VARIABLE","$finalPrice",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_STRING","min",615],"(",["T_VARIABLE","$finalPrice",615],",",["T_WHITESPACE"," ",615],["T_VARIABLE","$specialPrice",615],")",";",["T_WHITESPACE","\n            ",615],"}",["T_WHITESPACE","\n        ",616],"}",["T_WHITESPACE","\n        ",617],["T_RETURN","return",618],["T_WHITESPACE"," ",618],["T_VARIABLE","$finalPrice",618],";",["T_WHITESPACE","\n    ",618],"}",["T_WHITESPACE","\n\n    ",619],["T_DOC_COMMENT","\/**\n     * Check is tier price value fixed or percent of original price\n     *\n     * @return bool\n     *\/",621],["T_WHITESPACE","\n    ",625],["T_PUBLIC","public",626],["T_WHITESPACE"," ",626],["T_FUNCTION","function",626],["T_WHITESPACE"," ",626],["T_STRING","isTierPriceFixed",626],"(",")",["T_WHITESPACE","\n    ",626],"{",["T_WHITESPACE","\n        ",627],["T_RETURN","return",628],["T_WHITESPACE"," ",628],["T_STRING","true",628],";",["T_WHITESPACE","\n    ",628],"}",["T_WHITESPACE","\n",629],"}",["T_WHITESPACE","\n",630]]