[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Flat",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Indexer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Product",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Flat",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Table",8],["T_NS_SEPARATOR","\\",8],["T_STRING","BuilderInterfaceFactory",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Class TableBuilder\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","TableBuilder",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Helper\\Product\\Flat\\Indexer\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$_productIndexerHelper",18],";",["T_WHITESPACE","\n\n    ",18],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_connection",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\EntityManager\\MetadataPool\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$metadataPool",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\ResourceConnection\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$resource",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * @var BuilderInterfaceFactory\n     *\/",35],["T_WHITESPACE","\n    ",37],["T_PRIVATE","private",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$tableBuilderFactory",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Check whether builder was executed\n     *\n     * @var bool\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_isExecuted",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","false",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Catalog\\Helper\\Product\\Flat\\Indexer $productIndexerHelper\n     * @param \\Magento\\Framework\\App\\ResourceConnection $resource\n     *\/",47],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","__construct",51],"(",["T_WHITESPACE","\n        ",51],["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Catalog",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Helper",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Product",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Flat",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Indexer",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$productIndexerHelper",52],",",["T_WHITESPACE","\n        ",52],["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Framework",53],["T_NS_SEPARATOR","\\",53],["T_STRING","App",53],["T_NS_SEPARATOR","\\",53],["T_STRING","ResourceConnection",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$resource",53],["T_WHITESPACE","\n    ",53],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_productIndexerHelper",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$productIndexerHelper",55],";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","resource",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$resource",56],";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_connection",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$resource",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getConnection",57],"(",")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Prepare temporary tables only for first call of reindex all\n     *\n     * @param int $storeId\n     * @param array $changedIds\n     * @param string $valueFieldSuffix\n     * @return void\n     *\/",60],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","build",68],"(",["T_VARIABLE","$storeId",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$changedIds",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$valueFieldSuffix",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_isExecuted",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$entityTableName",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_productIndexerHelper",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getTable",73],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",73],")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$attributes",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_productIndexerHelper",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getAttributes",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$eavAttributes",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_productIndexerHelper",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getTablesStructure",75],"(",["T_VARIABLE","$attributes",75],")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$entityTableColumns",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$eavAttributes",76],"[",["T_VARIABLE","$entityTableName",76],"]",";",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$temporaryEavAttributes",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$eavAttributes",78],";",["T_WHITESPACE","\n\n        ",78],["T_COMMENT","\/\/add status global value to the base table\n",80],["T_WHITESPACE","        ",81],["T_COMMENT","\/* @var $status \\Magento\\Eav\\Model\\Entity\\Attribute *\/",81],["T_WHITESPACE","\n        ",81],["T_VARIABLE","$status",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_productIndexerHelper",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getAttribute",82],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",82],")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$temporaryEavAttributes",83],"[",["T_VARIABLE","$status",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getBackendTable",83],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'status'",83],"]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$status",83],";",["T_WHITESPACE","\n        ",83],["T_COMMENT","\/\/Create list of temporary tables based on available attributes attributes\n",84],["T_WHITESPACE","        ",85],["T_VARIABLE","$valueTables",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],"[","]",";",["T_WHITESPACE","\n        ",85],["T_FOREACH","foreach",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$temporaryEavAttributes",86],["T_WHITESPACE"," ",86],["T_AS","as",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$tableName",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$columns",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$valueTables",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","array_merge",87],"(",["T_WHITESPACE","\n                ",87],["T_VARIABLE","$valueTables",88],",",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_createTemporaryTable",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_getTemporaryTableName",89],"(",["T_VARIABLE","$tableName",89],")",",",["T_WHITESPACE"," ",89],["T_VARIABLE","$columns",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$valueFieldSuffix",89],")",["T_WHITESPACE","\n            ",89],")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_COMMENT","\/\/Fill \"base\" table which contains all available products\n",93],["T_WHITESPACE","        ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_fillTemporaryEntityTable",94],"(",["T_VARIABLE","$entityTableName",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$entityTableColumns",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$changedIds",94],")",";",["T_WHITESPACE","\n\n        ",94],["T_COMMENT","\/\/Add primary key to \"base\" temporary table for increase speed of joins in future\n",96],["T_WHITESPACE","        ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_addPrimaryKeyToTable",97],"(",["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_getTemporaryTableName",97],"(",["T_VARIABLE","$entityTableName",97],")",")",";",["T_WHITESPACE","\n        ",97],["T_UNSET","unset",98],"(",["T_VARIABLE","$temporaryEavAttributes",98],"[",["T_VARIABLE","$entityTableName",98],"]",")",";",["T_WHITESPACE","\n\n        ",98],["T_FOREACH","foreach",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$temporaryEavAttributes",100],["T_WHITESPACE"," ",100],["T_AS","as",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$tableName",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$columns",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$temporaryTableName",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_getTemporaryTableName",101],"(",["T_VARIABLE","$tableName",101],")",";",["T_WHITESPACE","\n\n            ",101],["T_COMMENT","\/\/Add primary key to temporary table for increase speed of joins in future\n",103],["T_WHITESPACE","            ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_addPrimaryKeyToTable",104],"(",["T_VARIABLE","$temporaryTableName",104],")",";",["T_WHITESPACE","\n\n            ",104],["T_COMMENT","\/\/Create temporary table for composite attributes\n",106],["T_WHITESPACE","            ",107],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_ISSET","isset",107],"(",["T_VARIABLE","$valueTables",107],"[",["T_VARIABLE","$temporaryTableName",107],["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$valueFieldSuffix",107],"]",")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_addPrimaryKeyToTable",108],"(",["T_VARIABLE","$temporaryTableName",108],["T_WHITESPACE"," ",108],".",["T_WHITESPACE"," ",108],["T_VARIABLE","$valueFieldSuffix",108],")",";",["T_WHITESPACE","\n            ",108],"}",["T_WHITESPACE","\n\n            ",109],["T_COMMENT","\/\/Fill temporary tables with attributes grouped by it type\n",111],["T_WHITESPACE","            ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_fillTemporaryTable",112],"(",["T_VARIABLE","$tableName",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$columns",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$changedIds",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$valueFieldSuffix",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$storeId",112],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_isExecuted",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","true",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Create empty temporary table with given columns list\n     *\n     * @param string $tableName  Table name\n     * @param array $columns array('columnName' => \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute, ...)\n     * @param string $valueFieldSuffix\n     *\n     * @return array\n     *\/",117],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","_createTemporaryTable",126],"(",["T_VARIABLE","$tableName",126],",",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$columns",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$valueFieldSuffix",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$valueTables",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],"[","]",";",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","!",["T_EMPTY","empty",129],"(",["T_VARIABLE","$columns",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$valueTableName",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$tableName",130],["T_WHITESPACE"," ",130],".",["T_WHITESPACE"," ",130],["T_VARIABLE","$valueFieldSuffix",130],";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$temporaryTableBuilder",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getTableBuilderFactory",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","create",131],"(",["T_WHITESPACE","\n                ",131],"[",["T_WHITESPACE","\n                    ",132],["T_CONSTANT_ENCAPSED_STRING","'connection'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_connection",133],",",["T_WHITESPACE","\n                    ",133],["T_CONSTANT_ENCAPSED_STRING","'tableName'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$tableName",134],["T_WHITESPACE","\n                ",134],"]",["T_WHITESPACE","\n            ",135],")",";",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$valueTemporaryTableBuilder",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getTableBuilderFactory",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","create",137],"(",["T_WHITESPACE","\n                ",137],"[",["T_WHITESPACE","\n                    ",138],["T_CONSTANT_ENCAPSED_STRING","'connection'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_connection",139],",",["T_WHITESPACE","\n                    ",139],["T_CONSTANT_ENCAPSED_STRING","'tableName'",140],["T_WHITESPACE"," ",140],["T_DOUBLE_ARROW","=>",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$valueTableName",140],["T_WHITESPACE","\n                ",140],"]",["T_WHITESPACE","\n            ",141],")",";",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$flatColumns",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_productIndexerHelper",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getFlatColumns",143],"(",")",";",["T_WHITESPACE","\n\n            ",143],["T_VARIABLE","$temporaryTableBuilder",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","addColumn",145],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",145],",",["T_WHITESPACE"," ",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Magento",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Framework",145],["T_NS_SEPARATOR","\\",145],["T_STRING","DB",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Ddl",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Table",145],["T_DOUBLE_COLON","::",145],["T_STRING","TYPE_INTEGER",145],")",";",["T_WHITESPACE","\n\n            ",145],["T_VARIABLE","$temporaryTableBuilder",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","addColumn",147],"(",["T_CONSTANT_ENCAPSED_STRING","'type_id'",147],",",["T_WHITESPACE"," ",147],["T_NS_SEPARATOR","\\",147],["T_STRING","Magento",147],["T_NS_SEPARATOR","\\",147],["T_STRING","Framework",147],["T_NS_SEPARATOR","\\",147],["T_STRING","DB",147],["T_NS_SEPARATOR","\\",147],["T_STRING","Ddl",147],["T_NS_SEPARATOR","\\",147],["T_STRING","Table",147],["T_DOUBLE_COLON","::",147],["T_STRING","TYPE_TEXT",147],")",";",["T_WHITESPACE","\n\n            ",147],["T_VARIABLE","$temporaryTableBuilder",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","addColumn",149],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",149],",",["T_WHITESPACE"," ",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Magento",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Framework",149],["T_NS_SEPARATOR","\\",149],["T_STRING","DB",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Ddl",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Table",149],["T_DOUBLE_COLON","::",149],["T_STRING","TYPE_INTEGER",149],")",";",["T_WHITESPACE","\n\n            ",149],["T_VARIABLE","$valueTemporaryTableBuilder",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","addColumn",151],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",151],",",["T_WHITESPACE"," ",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Magento",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Framework",151],["T_NS_SEPARATOR","\\",151],["T_STRING","DB",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Ddl",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Table",151],["T_DOUBLE_COLON","::",151],["T_STRING","TYPE_INTEGER",151],")",";",["T_WHITESPACE","\n\n            ",151],["T_DOC_COMMENT","\/** @var $attribute \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute *\/",153],["T_WHITESPACE","\n            ",153],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$columns",154],["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$columnName",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$attribute",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n                ",154],["T_VARIABLE","$attributeCode",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$attribute",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getAttributeCode",155],"(",")",";",["T_WHITESPACE","\n                ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_ISSET","isset",156],"(",["T_VARIABLE","$flatColumns",156],"[",["T_VARIABLE","$attributeCode",156],"]",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                    ",156],["T_VARIABLE","$column",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$flatColumns",157],"[",["T_VARIABLE","$attributeCode",157],"]",";",["T_WHITESPACE","\n                ",157],"}",["T_WHITESPACE"," ",158],["T_ELSE","else",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                    ",158],["T_VARIABLE","$column",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$attribute",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_getFlatColumnsDdlDefinition",159],"(",")",";",["T_WHITESPACE","\n                    ",159],["T_VARIABLE","$column",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$column",160],"[",["T_VARIABLE","$attributeCode",160],"]",";",["T_WHITESPACE","\n                ",160],"}",["T_WHITESPACE","\n\n                ",161],["T_VARIABLE","$temporaryTableBuilder",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","addColumn",163],"(",["T_WHITESPACE","\n                    ",163],["T_VARIABLE","$columnName",164],",",["T_WHITESPACE","\n                    ",164],["T_VARIABLE","$column",165],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",165],"]",",",["T_WHITESPACE","\n                    ",165],["T_ISSET","isset",166],"(",["T_VARIABLE","$column",166],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",166],"]",")",["T_WHITESPACE"," ",166],"?",["T_WHITESPACE"," ",166],["T_VARIABLE","$column",166],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",166],"]",["T_WHITESPACE"," ",166],":",["T_WHITESPACE"," ",166],["T_STRING","null",166],["T_WHITESPACE","\n                ",166],")",";",["T_WHITESPACE","\n\n                ",167],["T_VARIABLE","$columnValueName",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$attributeCode",169],["T_WHITESPACE"," ",169],".",["T_WHITESPACE"," ",169],["T_VARIABLE","$valueFieldSuffix",169],";",["T_WHITESPACE","\n                ",169],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_ISSET","isset",170],"(",["T_VARIABLE","$flatColumns",170],"[",["T_VARIABLE","$columnValueName",170],"]",")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                    ",170],["T_VARIABLE","$columnValue",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$flatColumns",171],"[",["T_VARIABLE","$columnValueName",171],"]",";",["T_WHITESPACE","\n                    ",171],["T_VARIABLE","$valueTemporaryTableBuilder",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","addColumn",172],"(",["T_WHITESPACE","\n                        ",172],["T_VARIABLE","$columnValueName",173],",",["T_WHITESPACE","\n                        ",173],["T_VARIABLE","$columnValue",174],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",174],"]",",",["T_WHITESPACE","\n                        ",174],["T_ISSET","isset",175],"(",["T_VARIABLE","$columnValue",175],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",175],"]",")",["T_WHITESPACE"," ",175],"?",["T_WHITESPACE"," ",175],["T_VARIABLE","$columnValue",175],"[",["T_CONSTANT_ENCAPSED_STRING","'length'",175],"]",["T_WHITESPACE"," ",175],":",["T_WHITESPACE"," ",175],["T_STRING","null",175],["T_WHITESPACE","\n                    ",175],")",";",["T_WHITESPACE","\n                ",176],"}",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_connection",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","dropTemporaryTable",179],"(",["T_VARIABLE","$tableName",179],")",";",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_connection",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","createTemporaryTable",180],"(",["T_VARIABLE","$temporaryTableBuilder",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getTable",180],"(",")",")",";",["T_WHITESPACE","\n\n            ",180],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_STRING","count",182],"(",["T_VARIABLE","$valueTemporaryTableBuilder",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getTable",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","getColumns",182],"(",")",")",["T_WHITESPACE"," ",182],">",["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_connection",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","dropTemporaryTable",183],"(",["T_VARIABLE","$valueTableName",183],")",";",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_connection",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","createTemporaryTable",184],"(",["T_VARIABLE","$valueTemporaryTableBuilder",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getTable",184],"(",")",")",";",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$valueTables",185],"[",["T_VARIABLE","$valueTableName",185],"]",["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$valueTableName",185],";",["T_WHITESPACE","\n            ",185],"}",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n        ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$valueTables",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Retrieve temporary table name by regular table name\n     *\n     * @param string $tableName\n     * @return string\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PROTECTED","protected",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","_getTemporaryTableName",197],"(",["T_VARIABLE","$tableName",197],")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_STRING","sprintf",199],"(",["T_CONSTANT_ENCAPSED_STRING","'%s_tmp_indexer'",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$tableName",199],")",";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_DOC_COMMENT","\/**\n     * Fill temporary entity table\n     *\n     * @param string $tableName\n     * @param array  $columns\n     * @param array  $changedIds\n     * @return void\n     *\/",202],["T_WHITESPACE","\n    ",209],["T_PROTECTED","protected",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","_fillTemporaryEntityTable",210],"(",["T_VARIABLE","$tableName",210],",",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$columns",210],",",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$changedIds",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],"[","]",")",["T_WHITESPACE","\n    ",210],"{",["T_WHITESPACE","\n        ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(","!",["T_EMPTY","empty",212],"(",["T_VARIABLE","$columns",212],")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$select",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_connection",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","select",213],"(",")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$temporaryEntityTable",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_getTemporaryTableName",214],"(",["T_VARIABLE","$tableName",214],")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$metadata",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getMetadataPool",215],"(",")",["T_OBJECT_OPERATOR","->",215],["T_STRING","getMetadata",215],"(",["T_NS_SEPARATOR","\\",215],["T_STRING","Magento",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Catalog",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Api",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Data",215],["T_NS_SEPARATOR","\\",215],["T_STRING","ProductInterface",215],["T_DOUBLE_COLON","::",215],["T_CLASS","class",215],")",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$idsColumns",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_STRING","array_unique",216],"(","[",["T_VARIABLE","$metadata",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getLinkField",216],"(",")",",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",216],",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'type_id'",216],",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",216],"]",")",";",["T_WHITESPACE","\n\n            ",216],["T_VARIABLE","$columns",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","array_merge",218],"(",["T_VARIABLE","$idsColumns",218],",",["T_WHITESPACE"," ",218],["T_STRING","array_keys",218],"(",["T_VARIABLE","$columns",218],")",")",";",["T_WHITESPACE","\n\n            ",218],["T_VARIABLE","$select",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","from",220],"(","[",["T_CONSTANT_ENCAPSED_STRING","'e'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$tableName",220],"]",",",["T_WHITESPACE"," ",220],["T_VARIABLE","$columns",220],")",";",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$onDuplicate",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","false",221],";",["T_WHITESPACE","\n            ",221],["T_IF","if",222],["T_WHITESPACE"," ",222],"(","!",["T_EMPTY","empty",222],"(",["T_VARIABLE","$changedIds",222],")",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n                ",222],["T_VARIABLE","$select",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","where",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_connection",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","quoteInto",223],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN (?)'",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$changedIds",223],")",")",";",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$onDuplicate",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","true",224],";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$sql",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$select",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","insertFromSelect",226],"(",["T_VARIABLE","$temporaryEntityTable",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$columns",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$onDuplicate",226],")",";",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_connection",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","query",227],"(",["T_VARIABLE","$sql",227],")",";",["T_WHITESPACE","\n        ",227],"}",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Add primary key to table by it name\n     *\n     * @param string $tableName\n     * @param string $columnName\n     * @return void\n     *\/",231],["T_WHITESPACE","\n    ",237],["T_PROTECTED","protected",238],["T_WHITESPACE"," ",238],["T_FUNCTION","function",238],["T_WHITESPACE"," ",238],["T_STRING","_addPrimaryKeyToTable",238],"(",["T_VARIABLE","$tableName",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$columnName",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",238],")",["T_WHITESPACE","\n    ",238],"{",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_connection",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","addIndex",240],"(",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$tableName",241],",",["T_WHITESPACE","\n            ",241],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",242],",",["T_WHITESPACE","\n            ",242],"[",["T_VARIABLE","$columnName",243],"]",",",["T_WHITESPACE","\n            ",243],["T_NS_SEPARATOR","\\",244],["T_STRING","Magento",244],["T_NS_SEPARATOR","\\",244],["T_STRING","Framework",244],["T_NS_SEPARATOR","\\",244],["T_STRING","DB",244],["T_NS_SEPARATOR","\\",244],["T_STRING","Adapter",244],["T_NS_SEPARATOR","\\",244],["T_STRING","AdapterInterface",244],["T_DOUBLE_COLON","::",244],["T_STRING","INDEX_TYPE_PRIMARY",244],["T_WHITESPACE","\n        ",244],")",";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n\n    ",246],["T_DOC_COMMENT","\/**\n     * Fill temporary table by data from products EAV attributes by type\n     *\n     * @param string $tableName\n     * @param array  $tableColumns\n     * @param array  $changedIds\n     * @param string $valueFieldSuffix\n     * @param int $storeId\n     * @return void\n     *\/",248],["T_WHITESPACE","\n    ",257],["T_PROTECTED","protected",258],["T_WHITESPACE"," ",258],["T_FUNCTION","function",258],["T_WHITESPACE"," ",258],["T_STRING","_fillTemporaryTable",258],"(",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$tableName",259],",",["T_WHITESPACE","\n        ",259],["T_ARRAY","array",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$tableColumns",260],",",["T_WHITESPACE","\n        ",260],["T_ARRAY","array",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$changedIds",261],",",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$valueFieldSuffix",262],",",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$storeId",263],["T_WHITESPACE","\n    ",263],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$metadata",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getMetadataPool",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","getMetadata",265],"(",["T_NS_SEPARATOR","\\",265],["T_STRING","Magento",265],["T_NS_SEPARATOR","\\",265],["T_STRING","Catalog",265],["T_NS_SEPARATOR","\\",265],["T_STRING","Api",265],["T_NS_SEPARATOR","\\",265],["T_STRING","Data",265],["T_NS_SEPARATOR","\\",265],["T_STRING","ProductInterface",265],["T_DOUBLE_COLON","::",265],["T_CLASS","class",265],")",";",["T_WHITESPACE","\n        ",265],["T_IF","if",266],["T_WHITESPACE"," ",266],"(","!",["T_EMPTY","empty",266],"(",["T_VARIABLE","$tableColumns",266],")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$columnsChunks",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","array_chunk",267],"(",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$tableColumns",268],",",["T_WHITESPACE","\n                ",268],["T_STRING","Action",269],["T_NS_SEPARATOR","\\",269],["T_STRING","Indexer",269],["T_DOUBLE_COLON","::",269],["T_STRING","ATTRIBUTES_CHUNK_SIZE",269],",",["T_WHITESPACE","\n                ",269],["T_STRING","true",270],["T_WHITESPACE","\n            ",270],")",";",["T_WHITESPACE","\n            ",271],["T_FOREACH","foreach",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$columnsChunks",272],["T_WHITESPACE"," ",272],["T_AS","as",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$columnsList",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$select",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_connection",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","select",273],"(",")",";",["T_WHITESPACE","\n                ",273],["T_VARIABLE","$selectValue",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_connection",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","select",274],"(",")",";",["T_WHITESPACE","\n                ",274],["T_VARIABLE","$entityTableName",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_getTemporaryTableName",275],"(",["T_WHITESPACE","\n                    ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_productIndexerHelper",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getTable",276],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",276],")",["T_WHITESPACE","\n                ",276],")",";",["T_WHITESPACE","\n                ",277],["T_VARIABLE","$temporaryTableName",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_getTemporaryTableName",278],"(",["T_VARIABLE","$tableName",278],")",";",["T_WHITESPACE","\n                ",278],["T_VARIABLE","$temporaryValueTableName",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$temporaryTableName",279],["T_WHITESPACE"," ",279],".",["T_WHITESPACE"," ",279],["T_VARIABLE","$valueFieldSuffix",279],";",["T_WHITESPACE","\n                ",279],["T_VARIABLE","$keyColumn",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_STRING","array_unique",280],"(","[",["T_VARIABLE","$metadata",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getLinkField",280],"(",")",",",["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",280],"]",")",";",["T_WHITESPACE","\n                ",280],["T_VARIABLE","$columns",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","array_merge",281],"(",["T_VARIABLE","$keyColumn",281],",",["T_WHITESPACE"," ",281],["T_STRING","array_keys",281],"(",["T_VARIABLE","$columnsList",281],")",")",";",["T_WHITESPACE","\n                ",281],["T_VARIABLE","$valueColumns",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$keyColumn",282],";",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$flatColumns",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_productIndexerHelper",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getFlatColumns",283],"(",")",";",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$iterationNum",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_LNUMBER","1",284],";",["T_WHITESPACE","\n\n                ",284],["T_VARIABLE","$select",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","from",286],"(","[",["T_CONSTANT_ENCAPSED_STRING","'et'",286],["T_WHITESPACE"," ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$entityTableName",286],"]",",",["T_WHITESPACE"," ",286],["T_VARIABLE","$keyColumn",286],")",["T_WHITESPACE","\n                    ",286],["T_OBJECT_OPERATOR","->",287],["T_STRING","join",287],"(",["T_WHITESPACE","\n                        ",287],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",288],["T_WHITESPACE"," ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","resource",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getTableName",288],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",288],")","]",",",["T_WHITESPACE","\n                        ",288],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = et.entity_id'",289],",",["T_WHITESPACE","\n                        ",289],"[","]",["T_WHITESPACE","\n                    ",290],")",";",["T_WHITESPACE","\n\n                ",291],["T_VARIABLE","$selectValue",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","from",293],"(","[",["T_CONSTANT_ENCAPSED_STRING","'e'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$temporaryTableName",293],"]",",",["T_WHITESPACE"," ",293],["T_VARIABLE","$keyColumn",293],")",";",["T_WHITESPACE","\n\n                ",293],["T_DOC_COMMENT","\/** @var $attribute \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute *\/",295],["T_WHITESPACE","\n                ",295],["T_FOREACH","foreach",296],["T_WHITESPACE"," ",296],"(",["T_VARIABLE","$columnsList",296],["T_WHITESPACE"," ",296],["T_AS","as",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$columnName",296],["T_WHITESPACE"," ",296],["T_DOUBLE_ARROW","=>",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$attribute",296],")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n                    ",296],["T_VARIABLE","$countTableName",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","'t'",297],["T_WHITESPACE"," ",297],".",["T_WHITESPACE"," ",297],["T_VARIABLE","$iterationNum",297],["T_INC","++",297],";",["T_WHITESPACE","\n                    ",297],["T_VARIABLE","$joinCondition",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_STRING","sprintf",298],"(",["T_WHITESPACE","\n                        ",298],["T_CONSTANT_ENCAPSED_STRING","'e.%3$s = %1$s.%3$s AND %1$s.attribute_id = %2$d AND %1$s.store_id = 0'",299],",",["T_WHITESPACE","\n                        ",299],["T_VARIABLE","$countTableName",300],",",["T_WHITESPACE","\n                        ",300],["T_VARIABLE","$attribute",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getId",301],"(",")",",",["T_WHITESPACE","\n                        ",301],["T_VARIABLE","$metadata",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getLinkField",302],"(",")",["T_WHITESPACE","\n                    ",302],")",";",["T_WHITESPACE","\n\n                    ",303],["T_VARIABLE","$select",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","joinLeft",305],"(",["T_WHITESPACE","\n                        ",305],"[",["T_VARIABLE","$countTableName",306],["T_WHITESPACE"," ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$tableName",306],"]",",",["T_WHITESPACE","\n                        ",306],["T_VARIABLE","$joinCondition",307],",",["T_WHITESPACE","\n                        ",307],"[",["T_VARIABLE","$columnName",308],["T_WHITESPACE"," ",308],["T_DOUBLE_ARROW","=>",308],["T_WHITESPACE"," ",308],["T_CONSTANT_ENCAPSED_STRING","'value'",308],"]",["T_WHITESPACE","\n                    ",308],")",";",["T_WHITESPACE","\n\n                    ",309],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$attribute",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getFlatUpdateSelect",311],"(",["T_VARIABLE","$storeId",311],")",["T_WHITESPACE"," ",311],["T_INSTANCEOF","instanceof",311],["T_WHITESPACE"," ",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Magento",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Framework",311],["T_NS_SEPARATOR","\\",311],["T_STRING","DB",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Select",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n                        ",311],["T_VARIABLE","$attributeCode",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$attribute",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getAttributeCode",312],"(",")",";",["T_WHITESPACE","\n                        ",312],["T_VARIABLE","$columnValueName",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$attributeCode",313],["T_WHITESPACE"," ",313],".",["T_WHITESPACE"," ",313],["T_VARIABLE","$valueFieldSuffix",313],";",["T_WHITESPACE","\n                        ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_ISSET","isset",314],"(",["T_VARIABLE","$flatColumns",314],"[",["T_VARIABLE","$columnValueName",314],"]",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                            ",314],["T_VARIABLE","$valueJoinCondition",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","sprintf",315],"(",["T_WHITESPACE","\n                                ",315],["T_CONSTANT_ENCAPSED_STRING","'e.%1$s = %2$s.option_id AND %2$s.store_id = 0'",316],",",["T_WHITESPACE","\n                                ",316],["T_VARIABLE","$attributeCode",317],",",["T_WHITESPACE","\n                                ",317],["T_VARIABLE","$countTableName",318],["T_WHITESPACE","\n                            ",318],")",";",["T_WHITESPACE","\n                            ",319],["T_VARIABLE","$selectValue",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","joinLeft",320],"(",["T_WHITESPACE","\n                                ",320],"[",["T_WHITESPACE","\n                                    ",321],["T_VARIABLE","$countTableName",322],["T_WHITESPACE"," ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_productIndexerHelper",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getTable",322],"(",["T_WHITESPACE","\n                                        ",322],["T_CONSTANT_ENCAPSED_STRING","'eav_attribute_option_value'",323],["T_WHITESPACE","\n                                    ",323],")",",",["T_WHITESPACE","\n                                ",324],"]",",",["T_WHITESPACE","\n                                ",325],["T_VARIABLE","$valueJoinCondition",326],",",["T_WHITESPACE","\n                                ",326],"[",["T_VARIABLE","$columnValueName",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$countTableName",327],["T_WHITESPACE"," ",327],".",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'.value'",327],"]",["T_WHITESPACE","\n                            ",327],")",";",["T_WHITESPACE","\n                            ",328],["T_VARIABLE","$valueColumns",329],"[","]",["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$columnValueName",329],";",["T_WHITESPACE","\n                        ",329],"}",["T_WHITESPACE","\n                    ",330],"}",["T_WHITESPACE","\n                ",331],"}",["T_WHITESPACE","\n\n                ",332],["T_IF","if",334],["T_WHITESPACE"," ",334],"(","!",["T_EMPTY","empty",334],"(",["T_VARIABLE","$changedIds",334],")",")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n                    ",334],["T_VARIABLE","$select",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","where",335],"(",["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_connection",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","quoteInto",335],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN (?)'",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$changedIds",335],")",")",";",["T_WHITESPACE","\n                ",335],"}",["T_WHITESPACE","\n\n                ",336],["T_VARIABLE","$sql",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$select",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","insertFromSelect",338],"(",["T_VARIABLE","$temporaryTableName",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$columns",338],",",["T_WHITESPACE"," ",338],["T_STRING","true",338],")",";",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_connection",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","query",339],"(",["T_VARIABLE","$sql",339],")",";",["T_WHITESPACE","\n\n                ",339],["T_IF","if",341],["T_WHITESPACE"," ",341],"(",["T_STRING","count",341],"(",["T_VARIABLE","$valueColumns",341],")",["T_WHITESPACE"," ",341],">",["T_WHITESPACE"," ",341],["T_LNUMBER","1",341],")",["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n                    ",341],["T_IF","if",342],["T_WHITESPACE"," ",342],"(","!",["T_EMPTY","empty",342],"(",["T_VARIABLE","$changedIds",342],")",")",["T_WHITESPACE"," ",342],"{",["T_WHITESPACE","\n                        ",342],["T_VARIABLE","$selectValue",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","where",343],"(",["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_connection",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","quoteInto",343],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN (?)'",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$changedIds",343],")",")",";",["T_WHITESPACE","\n                    ",343],"}",["T_WHITESPACE","\n                    ",344],["T_VARIABLE","$sql",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$selectValue",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","insertFromSelect",345],"(",["T_VARIABLE","$temporaryValueTableName",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$valueColumns",345],",",["T_WHITESPACE"," ",345],["T_STRING","true",345],")",";",["T_WHITESPACE","\n                    ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_connection",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","query",346],"(",["T_VARIABLE","$sql",346],")",";",["T_WHITESPACE","\n                ",346],"}",["T_WHITESPACE","\n            ",347],"}",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE","\n    ",349],"}",["T_WHITESPACE","\n\n    ",350],["T_DOC_COMMENT","\/**\n     * @return BuilderInterfaceFactory\n     *\/",352],["T_WHITESPACE","\n    ",354],["T_PRIVATE","private",355],["T_WHITESPACE"," ",355],["T_FUNCTION","function",355],["T_WHITESPACE"," ",355],["T_STRING","getTableBuilderFactory",355],"(",")",["T_WHITESPACE","\n    ",355],"{",["T_WHITESPACE","\n        ",356],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_STRING","null",357],["T_WHITESPACE"," ",357],["T_IS_IDENTICAL","===",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","tableBuilderFactory",357],")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","tableBuilderFactory",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_NS_SEPARATOR","\\",358],["T_STRING","Magento",358],["T_NS_SEPARATOR","\\",358],["T_STRING","Framework",358],["T_NS_SEPARATOR","\\",358],["T_STRING","App",358],["T_NS_SEPARATOR","\\",358],["T_STRING","ObjectManager",358],["T_DOUBLE_COLON","::",358],["T_STRING","getInstance",358],"(",")",["T_WHITESPACE","\n                ",358],["T_OBJECT_OPERATOR","->",359],["T_STRING","get",359],"(",["T_STRING","BuilderInterfaceFactory",359],["T_DOUBLE_COLON","::",359],["T_CLASS","class",359],")",";",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_RETURN","return",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","tableBuilderFactory",362],";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n\n    ",363],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Framework\\EntityManager\\MetadataPool\n     *\/",365],["T_WHITESPACE","\n    ",367],["T_PRIVATE","private",368],["T_WHITESPACE"," ",368],["T_FUNCTION","function",368],["T_WHITESPACE"," ",368],["T_STRING","getMetadataPool",368],"(",")",["T_WHITESPACE","\n    ",368],"{",["T_WHITESPACE","\n        ",369],["T_IF","if",370],["T_WHITESPACE"," ",370],"(",["T_STRING","null",370],["T_WHITESPACE"," ",370],["T_IS_IDENTICAL","===",370],["T_WHITESPACE"," ",370],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","metadataPool",370],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n            ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","metadataPool",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_NS_SEPARATOR","\\",371],["T_STRING","Magento",371],["T_NS_SEPARATOR","\\",371],["T_STRING","Framework",371],["T_NS_SEPARATOR","\\",371],["T_STRING","App",371],["T_NS_SEPARATOR","\\",371],["T_STRING","ObjectManager",371],["T_DOUBLE_COLON","::",371],["T_STRING","getInstance",371],"(",")",["T_WHITESPACE","\n                ",371],["T_OBJECT_OPERATOR","->",372],["T_STRING","get",372],"(",["T_NS_SEPARATOR","\\",372],["T_STRING","Magento",372],["T_NS_SEPARATOR","\\",372],["T_STRING","Framework",372],["T_NS_SEPARATOR","\\",372],["T_STRING","EntityManager",372],["T_NS_SEPARATOR","\\",372],["T_STRING","MetadataPool",372],["T_DOUBLE_COLON","::",372],["T_CLASS","class",372],")",";",["T_WHITESPACE","\n        ",372],"}",["T_WHITESPACE","\n        ",373],["T_RETURN","return",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","metadataPool",374],";",["T_WHITESPACE","\n    ",374],"}",["T_WHITESPACE","\n",375],"}",["T_WHITESPACE","\n",376]]