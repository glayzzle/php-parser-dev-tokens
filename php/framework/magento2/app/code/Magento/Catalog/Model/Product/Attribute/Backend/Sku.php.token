[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_DOC_COMMENT","\/**\n * Catalog product SKU backend attribute model\n *\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",9],["T_WHITESPACE","\n",13],["T_NAMESPACE","namespace",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Catalog",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Product",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Attribute",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Backend",14],";",["T_WHITESPACE","\n\n",14],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Catalog",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Product",16],";",["T_WHITESPACE","\n\n",16],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","Sku",18],["T_WHITESPACE"," ",18],["T_EXTENDS","extends",18],["T_WHITESPACE"," ",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Magento",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Eav",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Model",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Entity",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Attribute",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Backend",18],["T_NS_SEPARATOR","\\",18],["T_STRING","AbstractBackend",18],["T_WHITESPACE","\n",18],"{",["T_WHITESPACE","\n    ",19],["T_DOC_COMMENT","\/**\n     * Maximum SKU string length\n     *\n     * @var string\n     *\/",20],["T_WHITESPACE","\n    ",24],["T_CONST","const",25],["T_WHITESPACE"," ",25],["T_STRING","SKU_MAX_LENGTH",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_LNUMBER","64",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * Magento string lib\n     *\n     * @var \\Magento\\Framework\\Stdlib\\StringUtils\n     *\/",27],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$string",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Stdlib\\StringUtils $string\n     *\/",34],["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","__construct",37],"(",["T_NS_SEPARATOR","\\",37],["T_STRING","Magento",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Framework",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Stdlib",37],["T_NS_SEPARATOR","\\",37],["T_STRING","StringUtils",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$string",37],")",["T_WHITESPACE","\n    ",37],"{",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","string",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$string",39],";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Validate SKU\n     *\n     * @param Product $object\n     * @return bool\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",42],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","validate",50],"(",["T_VARIABLE","$object",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$attrCode",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getAttribute",52],"(",")",["T_OBJECT_OPERATOR","->",52],["T_STRING","getAttributeCode",52],"(",")",";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$value",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$object",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getData",53],"(",["T_VARIABLE","$attrCode",53],")",";",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getAttribute",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","getIsRequired",54],"(",")",["T_WHITESPACE"," ",54],["T_BOOLEAN_AND","&&",54],["T_WHITESPACE"," ",54],["T_STRING","strlen",54],"(",["T_VARIABLE","$value",54],")",["T_WHITESPACE"," ",54],["T_IS_IDENTICAL","===",54],["T_WHITESPACE"," ",54],["T_LNUMBER","0",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_THROW","throw",55],["T_WHITESPACE"," ",55],["T_NEW","new",55],["T_WHITESPACE"," ",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Magento",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Framework",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Exception",55],["T_NS_SEPARATOR","\\",55],["T_STRING","LocalizedException",55],"(",["T_STRING","__",55],"(",["T_CONSTANT_ENCAPSED_STRING","'The value of attribute \"%1\" must be set'",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$attrCode",55],")",")",";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n\n        ",56],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","string",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","strlen",58],"(",["T_VARIABLE","$object",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getSku",58],"(",")",")",["T_WHITESPACE"," ",58],">",["T_WHITESPACE"," ",58],["T_STRING","self",58],["T_DOUBLE_COLON","::",58],["T_STRING","SKU_MAX_LENGTH",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_THROW","throw",59],["T_WHITESPACE"," ",59],["T_NEW","new",59],["T_WHITESPACE"," ",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Framework",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Exception",59],["T_NS_SEPARATOR","\\",59],["T_STRING","LocalizedException",59],"(",["T_WHITESPACE","\n                ",59],["T_STRING","__",60],"(",["T_CONSTANT_ENCAPSED_STRING","'SKU length should be %1 characters maximum.'",60],",",["T_WHITESPACE"," ",60],["T_STRING","self",60],["T_DOUBLE_COLON","::",60],["T_STRING","SKU_MAX_LENGTH",60],")",["T_WHITESPACE","\n            ",60],")",";",["T_WHITESPACE","\n        ",61],"}",["T_WHITESPACE","\n        ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_STRING","true",63],";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Generate and set unique SKU to product\n     *\n     * @param Product $object\n     * @return void\n     *\/",66],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","_generateUniqueSku",72],"(",["T_VARIABLE","$object",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$attribute",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getAttribute",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$entity",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$attribute",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getEntity",75],"(",")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$attributeValue",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$object",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getData",76],"(",["T_VARIABLE","$attribute",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getAttributeCode",76],"(",")",")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$increment",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","null",77],";",["T_WHITESPACE","\n        ",77],["T_WHILE","while",78],["T_WHITESPACE"," ",78],"(","!",["T_VARIABLE","$entity",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","checkAttributeUniqueValue",78],"(",["T_VARIABLE","$attribute",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$object",78],")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$increment",79],["T_WHITESPACE"," ",79],["T_IS_IDENTICAL","===",79],["T_WHITESPACE"," ",79],["T_STRING","null",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                ",79],["T_VARIABLE","$increment",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_getLastSimilarAttributeValueIncrement",80],"(",["T_VARIABLE","$attribute",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$object",80],")",";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$sku",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","trim",82],"(",["T_VARIABLE","$attributeValue",82],")",";",["T_WHITESPACE","\n            ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_STRING","strlen",83],"(",["T_VARIABLE","$sku",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'-'",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_INC","++",83],["T_VARIABLE","$increment",83],")",["T_WHITESPACE"," ",83],">",["T_WHITESPACE"," ",83],["T_STRING","self",83],["T_DOUBLE_COLON","::",83],["T_STRING","SKU_MAX_LENGTH",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$sku",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","substr",84],"(",["T_VARIABLE","$sku",84],",",["T_WHITESPACE"," ",84],["T_LNUMBER","0",84],",",["T_WHITESPACE"," ",84],"-",["T_STRING","strlen",84],"(",["T_VARIABLE","$increment",84],")",["T_WHITESPACE"," ",84],"-",["T_WHITESPACE"," ",84],["T_LNUMBER","1",84],")",";",["T_WHITESPACE","\n            ",84],"}",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$sku",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$sku",86],["T_WHITESPACE"," ",86],".",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'-'",86],["T_WHITESPACE"," ",86],".",["T_WHITESPACE"," ",86],["T_VARIABLE","$increment",86],";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$object",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setData",87],"(",["T_VARIABLE","$attribute",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getAttributeCode",87],"(",")",",",["T_WHITESPACE"," ",87],["T_VARIABLE","$sku",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Make SKU unique before save\n     *\n     * @param Product $object\n     * @return $this\n     *\/",91],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","beforeSave",97],"(",["T_VARIABLE","$object",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_generateUniqueSku",99],"(",["T_VARIABLE","$object",99],")",";",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","parent",100],["T_DOUBLE_COLON","::",100],["T_STRING","beforeSave",100],"(",["T_VARIABLE","$object",100],")",";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Return increment needed for SKU uniqueness\n     *\n     * @param \\Magento\\Eav\\Model\\Entity\\Attribute\\AbstractAttribute $attribute\n     * @param Product $object\n     * @return int\n     *\/",103],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","_getLastSimilarAttributeValueIncrement",110],"(",["T_VARIABLE","$attribute",110],",",["T_WHITESPACE"," ",110],["T_VARIABLE","$object",110],")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$connection",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getAttribute",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","getEntity",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","getConnection",112],"(",")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$select",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$connection",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","select",113],"(",")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$value",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$object",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getData",114],"(",["T_VARIABLE","$attribute",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getAttributeCode",114],"(",")",")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$bind",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_code'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_STRING","trim",115],"(",["T_VARIABLE","$value",115],")",["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'-%'",115],"]",";",["T_WHITESPACE","\n\n        ",115],["T_VARIABLE","$select",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","from",117],"(",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getTable",118],"(",")",",",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$attribute",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getAttributeCode",119],"(",")",["T_WHITESPACE","\n        ",119],")",["T_OBJECT_OPERATOR","->",120],["T_STRING","where",120],"(",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$attribute",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getAttributeCode",121],"(",")",["T_WHITESPACE"," ",121],".",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","' LIKE :attribute_code'",121],["T_WHITESPACE","\n        ",121],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","order",122],"(",["T_WHITESPACE","\n            ",122],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id DESC'",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$attribute",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getAttributeCode",123],"(",")",["T_WHITESPACE"," ",123],".",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","' ASC'",123],"]",["T_WHITESPACE","\n        ",123],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","limit",124],"(",["T_WHITESPACE","\n            ",124],["T_LNUMBER","1",125],["T_WHITESPACE","\n        ",125],")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$data",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$connection",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","fetchOne",127],"(",["T_VARIABLE","$select",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$bind",127],")",";",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_STRING","abs",128],"(",["T_INT_CAST","(int)",128],["T_STRING","str_replace",128],"(",["T_VARIABLE","$value",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","''",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$data",128],")",")",";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n",129],"}",["T_WHITESPACE","\n",130]]