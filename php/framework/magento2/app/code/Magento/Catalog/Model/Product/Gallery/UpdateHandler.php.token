[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Gallery",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EntityManager",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Operation",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ExtensionInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Update handler for catalog product gallery.\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","UpdateHandler",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Catalog",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Product",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Gallery",13],["T_NS_SEPARATOR","\\",13],["T_STRING","CreateHandler",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_FUNCTION","function",18],["T_WHITESPACE"," ",18],["T_STRING","processDeletedImages",18],"(",["T_VARIABLE","$product",18],",",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],["T_WHITESPACE"," ",18],"&",["T_VARIABLE","$images",18],")",["T_WHITESPACE","\n    ",18],"{",["T_WHITESPACE","\n        ",19],["T_VARIABLE","$filesToDelete",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],"[","]",";",["T_WHITESPACE","\n        ",20],["T_VARIABLE","$recordsToDelete",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],"[","]",";",["T_WHITESPACE","\n        ",21],["T_VARIABLE","$picturesInOtherStores",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],"[","]",";",["T_WHITESPACE","\n\n        ",22],["T_FOREACH","foreach",24],["T_WHITESPACE"," ",24],"(",["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","resourceModel",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","getProductImages",24],"(",["T_VARIABLE","$product",24],",",["T_WHITESPACE"," ",24],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","extractStoreIds",24],"(",["T_VARIABLE","$product",24],")",")",["T_WHITESPACE"," ",24],["T_AS","as",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$image",24],")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n            ",24],["T_VARIABLE","$picturesInOtherStores",25],"[",["T_VARIABLE","$image",25],"[",["T_CONSTANT_ENCAPSED_STRING","'filepath'",25],"]","]",["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_STRING","true",25],";",["T_WHITESPACE","\n        ",25],"}",["T_WHITESPACE","\n\n        ",26],["T_FOREACH","foreach",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$images",28],["T_WHITESPACE"," ",28],["T_AS","as",28],["T_WHITESPACE"," ",28],"&",["T_VARIABLE","$image",28],")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n            ",28],["T_IF","if",29],["T_WHITESPACE"," ",29],"(","!",["T_EMPTY","empty",29],"(",["T_VARIABLE","$image",29],"[",["T_CONSTANT_ENCAPSED_STRING","'removed'",29],"]",")",")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n                ",29],["T_IF","if",30],["T_WHITESPACE"," ",30],"(","!",["T_EMPTY","empty",30],"(",["T_VARIABLE","$image",30],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",30],"]",")",["T_WHITESPACE"," ",30],["T_BOOLEAN_AND","&&",30],["T_WHITESPACE"," ",30],"!",["T_ISSET","isset",30],"(",["T_VARIABLE","$picturesInOtherStores",30],"[",["T_VARIABLE","$image",30],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",30],"]","]",")",")",["T_WHITESPACE"," ",30],"{",["T_WHITESPACE","\n                    ",30],["T_VARIABLE","$recordsToDelete",31],"[","]",["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$image",31],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",31],"]",";",["T_WHITESPACE","\n                    ",31],["T_VARIABLE","$filesToDelete",32],"[","]",["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_STRING","ltrim",32],"(",["T_VARIABLE","$image",32],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",32],"]",",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'\/'",32],")",";",["T_WHITESPACE","\n                ",32],"}",["T_WHITESPACE","\n            ",33],"}",["T_WHITESPACE","\n        ",34],"}",["T_WHITESPACE","\n\n        ",35],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","resourceModel",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","deleteGallery",37],"(",["T_VARIABLE","$recordsToDelete",37],")",";",["T_WHITESPACE","\n\n        ",37],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","removeDeletedImages",39],"(",["T_VARIABLE","$filesToDelete",39],")",";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","processNewImage",45],"(",["T_VARIABLE","$product",45],",",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],["T_WHITESPACE"," ",45],"&",["T_VARIABLE","$image",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$data",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],"[","]",";",["T_WHITESPACE","\n\n        ",47],["T_IF","if",49],["T_WHITESPACE"," ",49],"(",["T_EMPTY","empty",49],"(",["T_VARIABLE","$image",49],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",49],"]",")",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$data",50],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",50],"]",["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$image",50],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",50],"]",";",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$data",51],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",51],"]",["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getAttribute",51],"(",")",["T_OBJECT_OPERATOR","->",51],["T_STRING","getAttributeId",51],"(",")",";",["T_WHITESPACE","\n\n            ",51],["T_IF","if",53],["T_WHITESPACE"," ",53],"(","!",["T_EMPTY","empty",53],"(",["T_VARIABLE","$image",53],"[",["T_CONSTANT_ENCAPSED_STRING","'media_type'",53],"]",")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n                ",53],["T_VARIABLE","$data",54],"[",["T_CONSTANT_ENCAPSED_STRING","'media_type'",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$image",54],"[",["T_CONSTANT_ENCAPSED_STRING","'media_type'",54],"]",";",["T_WHITESPACE","\n            ",54],"}",["T_WHITESPACE","\n\n            ",55],["T_VARIABLE","$image",57],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",57],"]",["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","resourceModel",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","insertGallery",57],"(",["T_VARIABLE","$data",57],")",";",["T_WHITESPACE","\n\n            ",57],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","resourceModel",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","bindValueToEntity",59],"(",["T_WHITESPACE","\n                ",59],["T_VARIABLE","$image",60],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",60],"]",",",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$product",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getData",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","metadata",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getLinkField",61],"(",")",")",["T_WHITESPACE","\n            ",61],")",";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n\n        ",63],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$data",65],";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Catalog\\Model\\Product $product\n     * @return array\n     *\/",68],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","extractStoreIds",72],"(",["T_VARIABLE","$product",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$storeIds",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$product",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getStoreIds",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$storeIds",75],"[","]",["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_NS_SEPARATOR","\\",75],["T_STRING","Magento",75],["T_NS_SEPARATOR","\\",75],["T_STRING","Store",75],["T_NS_SEPARATOR","\\",75],["T_STRING","Model",75],["T_NS_SEPARATOR","\\",75],["T_STRING","Store",75],["T_DOUBLE_COLON","::",75],["T_STRING","DEFAULT_STORE_ID",75],";",["T_WHITESPACE","\n\n        ",75],["T_COMMENT","\/\/ Removing current storeId.\n",77],["T_WHITESPACE","        ",78],["T_VARIABLE","$storeIds",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","array_flip",78],"(",["T_VARIABLE","$storeIds",78],")",";",["T_WHITESPACE","\n        ",78],["T_UNSET","unset",79],"(",["T_VARIABLE","$storeIds",79],"[",["T_VARIABLE","$product",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getStoreId",79],"(",")","]",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$storeIds",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","array_keys",80],"(",["T_VARIABLE","$storeIds",80],")",";",["T_WHITESPACE","\n\n        ",80],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$storeIds",82],";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * @param array $files\n     * @return null\n     *\/",85],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","removeDeletedImages",89],"(",["T_ARRAY","array",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$files",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$catalogPath",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","mediaConfig",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getBaseMediaPath",91],"(",")",";",["T_WHITESPACE","\n\n        ",91],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$files",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$filePath",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","mediaDirectory",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","delete",94],"(",["T_VARIABLE","$catalogPath",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'\/'",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_VARIABLE","$filePath",94],")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n",96],"}",["T_WHITESPACE","\n",97]]