[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Catalog category model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Catalog",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EntityManager",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EntityManager",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Catalog",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Api",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Data",15],["T_NS_SEPARATOR","\\",15],["T_STRING","CategoryInterface",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",17],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","Category",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","AbstractResource",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/**\n     * Category tree object\n     *\n     * @var \\Magento\\Framework\\Data\\Tree\\Db\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_tree",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Catalog products table name\n     *\n     * @var string\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_categoryProductTable",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * @var array[]\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PRIVATE","private",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$entitiesWhereAttributesIs",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Id of 'is_active' category attribute\n     *\n     * @var int\n     *\/",41],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_isActiveAttributeId",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","null",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Store id\n     *\n     * @var int\n     *\/",48],["T_WHITESPACE","\n    ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_storeId",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],";",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * Core event manager proxy\n     *\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",55],["T_WHITESPACE","\n    ",59],["T_PROTECTED","protected",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$_eventManager",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","null",60],";",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Category collection factory\n     *\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Category\\CollectionFactory\n     *\/",62],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$_categoryCollectionFactory",67],";",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Category tree factory\n     *\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Category\\TreeFactory\n     *\/",69],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$_categoryTreeFactory",74],";",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * @var EntityManager\n     *\/",76],["T_WHITESPACE","\n    ",78],["T_PROTECTED","protected",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$entityManager",79],";",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * @var Category\\AggregateCount\n     *\/",81],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$aggregateCount",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Category constructor.\n     * @param \\Magento\\Eav\\Model\\Entity\\Context $context\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Catalog\\Model\\Factory $modelFactory\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param Category\\TreeFactory $categoryTreeFactory\n     * @param Category\\CollectionFactory $categoryCollectionFactory\n     * @param array $data\n     *\/",86],["T_WHITESPACE","\n    ",95],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","__construct",96],"(",["T_WHITESPACE","\n        ",96],["T_NS_SEPARATOR","\\",97],["T_STRING","Magento",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Eav",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Model",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Entity",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Context",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$context",97],",",["T_WHITESPACE","\n        ",97],["T_NS_SEPARATOR","\\",98],["T_STRING","Magento",98],["T_NS_SEPARATOR","\\",98],["T_STRING","Store",98],["T_NS_SEPARATOR","\\",98],["T_STRING","Model",98],["T_NS_SEPARATOR","\\",98],["T_STRING","StoreManagerInterface",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$storeManager",98],",",["T_WHITESPACE","\n        ",98],["T_NS_SEPARATOR","\\",99],["T_STRING","Magento",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Catalog",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Model",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Factory",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$modelFactory",99],",",["T_WHITESPACE","\n        ",99],["T_NS_SEPARATOR","\\",100],["T_STRING","Magento",100],["T_NS_SEPARATOR","\\",100],["T_STRING","Framework",100],["T_NS_SEPARATOR","\\",100],["T_STRING","Event",100],["T_NS_SEPARATOR","\\",100],["T_STRING","ManagerInterface",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$eventManager",100],",",["T_WHITESPACE","\n        ",100],["T_NS_SEPARATOR","\\",101],["T_STRING","Magento",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Catalog",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Model",101],["T_NS_SEPARATOR","\\",101],["T_STRING","ResourceModel",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Category",101],["T_NS_SEPARATOR","\\",101],["T_STRING","TreeFactory",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$categoryTreeFactory",101],",",["T_WHITESPACE","\n        ",101],["T_NS_SEPARATOR","\\",102],["T_STRING","Magento",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Catalog",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Model",102],["T_NS_SEPARATOR","\\",102],["T_STRING","ResourceModel",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Category",102],["T_NS_SEPARATOR","\\",102],["T_STRING","CollectionFactory",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$categoryCollectionFactory",102],",",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$data",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],"[","]",["T_WHITESPACE","\n    ",103],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n        ",104],["T_STRING","parent",105],["T_DOUBLE_COLON","::",105],["T_STRING","__construct",105],"(",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$context",106],",",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$storeManager",107],",",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$modelFactory",108],",",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$data",109],["T_WHITESPACE","\n        ",109],")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_categoryTreeFactory",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$categoryTreeFactory",111],";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_categoryCollectionFactory",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$categoryCollectionFactory",112],";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_eventManager",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$eventManager",113],";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","connectionName",114],["T_WHITESPACE","  ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'catalog'",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Entity type getter and lazy loader\n     *\n     * @return \\Magento\\Eav\\Model\\Entity\\Type\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",117],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","getEntityType",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_EMPTY","empty",125],"(",["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_type",125],")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","setType",126],"(",["T_NS_SEPARATOR","\\",126],["T_STRING","Magento",126],["T_NS_SEPARATOR","\\",126],["T_STRING","Catalog",126],["T_NS_SEPARATOR","\\",126],["T_STRING","Model",126],["T_NS_SEPARATOR","\\",126],["T_STRING","Category",126],["T_DOUBLE_COLON","::",126],["T_STRING","ENTITY",126],")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_STRING","parent",128],["T_DOUBLE_COLON","::",128],["T_STRING","getEntityType",128],"(",")",";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Category product table name getter\n     *\n     * @return string\n     *\/",131],["T_WHITESPACE","\n    ",135],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","getCategoryProductTable",136],"(",")",["T_WHITESPACE","\n    ",136],"{",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_categoryProductTable",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_categoryProductTable",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getTable",139],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_product'",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_categoryProductTable",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Set store Id\n     *\n     * @param integer $storeId\n     * @return $this\n     *\/",144],["T_WHITESPACE","\n    ",149],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","setStoreId",150],"(",["T_VARIABLE","$storeId",150],")",["T_WHITESPACE","\n    ",150],"{",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_storeId",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$storeId",152],";",["T_WHITESPACE","\n        ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Return store id\n     *\n     * @return integer\n     *\/",156],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","getStoreId",161],"(",")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_storeId",163],["T_WHITESPACE"," ",163],["T_IS_IDENTICAL","===",163],["T_WHITESPACE"," ",163],["T_STRING","null",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_storeManager",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getStore",164],"(",")",["T_OBJECT_OPERATOR","->",164],["T_STRING","getId",164],"(",")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n        ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_storeId",166],";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n\n    ",167],["T_DOC_COMMENT","\/**\n     * Retrieve category tree object\n     *\n     * @return \\Magento\\Framework\\Data\\Tree\\Db\n     *\/",169],["T_WHITESPACE","\n    ",173],["T_PROTECTED","protected",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","_getTree",174],"(",")",["T_WHITESPACE","\n    ",174],"{",["T_WHITESPACE","\n        ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(","!",["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_tree",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_tree",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_categoryTreeFactory",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","create",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","load",177],"(",")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_tree",179],";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_DOC_COMMENT","\/**\n     * Process category data before delete\n     * update children count for parent category\n     * delete child categories\n     *\n     * @param \\Magento\\Framework\\DataObject $object\n     * @return $this\n     *\/",182],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","_beforeDelete",190],"(",["T_NS_SEPARATOR","\\",190],["T_STRING","Magento",190],["T_NS_SEPARATOR","\\",190],["T_STRING","Framework",190],["T_NS_SEPARATOR","\\",190],["T_STRING","DataObject",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$object",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_STRING","parent",192],["T_DOUBLE_COLON","::",192],["T_STRING","_beforeDelete",192],"(",["T_VARIABLE","$object",192],")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getAggregateCount",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","processDelete",193],"(",["T_VARIABLE","$object",193],")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","deleteChildren",194],"(",["T_VARIABLE","$object",194],")",";",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Delete children categories of specific category\n     *\n     * @param \\Magento\\Framework\\DataObject $object\n     * @return $this\n     *\/",197],["T_WHITESPACE","\n    ",202],["T_PUBLIC","public",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","deleteChildren",203],"(",["T_NS_SEPARATOR","\\",203],["T_STRING","Magento",203],["T_NS_SEPARATOR","\\",203],["T_STRING","Framework",203],["T_NS_SEPARATOR","\\",203],["T_STRING","DataObject",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$object",203],")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$object",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getSkipDeleteChildren",205],"(",")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_RETURN","return",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$categories",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_categoryCollectionFactory",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","create",209],"(",")",";",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$categories",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","addAttributeToFilter",210],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",210],",",["T_WHITESPACE"," ",210],"[",["T_CONSTANT_ENCAPSED_STRING","'like'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$object",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getPath",210],"(",")",["T_WHITESPACE"," ",210],".",["T_WHITESPACE"," ",210],["T_CONSTANT_ENCAPSED_STRING","'\/%'",210],"]",")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$childrenIds",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$categories",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getAllIds",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_FOREACH","foreach",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$categories",212],["T_WHITESPACE"," ",212],["T_AS","as",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$category",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$category",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","setSkipDeleteChildren",213],"(",["T_STRING","true",213],")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$category",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","delete",214],"(",")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_DOC_COMMENT","\/**\n         * Add deleted children ids to object\n         * This data can be used in after delete event\n         *\/",217],["T_WHITESPACE","\n        ",220],["T_VARIABLE","$object",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setDeletedChildrenIds",221],"(",["T_VARIABLE","$childrenIds",221],")",";",["T_WHITESPACE","\n        ",221],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],";",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n\n    ",223],["T_DOC_COMMENT","\/**\n     * Process category data before saving\n     * prepare path and increment children count for parent categories\n     *\n     * @param \\Magento\\Framework\\DataObject $object\n     * @return $this\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",225],["T_WHITESPACE","\n    ",233],["T_PROTECTED","protected",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","_beforeSave",234],"(",["T_NS_SEPARATOR","\\",234],["T_STRING","Magento",234],["T_NS_SEPARATOR","\\",234],["T_STRING","Framework",234],["T_NS_SEPARATOR","\\",234],["T_STRING","DataObject",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$object",234],")",["T_WHITESPACE","\n    ",234],"{",["T_WHITESPACE","\n        ",235],["T_STRING","parent",236],["T_DOUBLE_COLON","::",236],["T_STRING","_beforeSave",236],"(",["T_VARIABLE","$object",236],")",";",["T_WHITESPACE","\n\n        ",236],["T_IF","if",238],["T_WHITESPACE"," ",238],"(","!",["T_VARIABLE","$object",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getChildrenCount",238],"(",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$object",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setChildrenCount",239],"(",["T_LNUMBER","0",239],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$object",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setAttributeSetId",241],"(",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$object",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getAttributeSetId",242],"(",")",["T_WHITESPACE"," ",242],"?",":",["T_WHITESPACE"," ",242],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getEntityType",242],"(",")",["T_OBJECT_OPERATOR","->",242],["T_STRING","getDefaultAttributeSetId",242],"(",")",["T_WHITESPACE","\n        ",242],")",";",["T_WHITESPACE","\n        ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$object",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","isObjectNew",244],"(",")",")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n            ",244],["T_IF","if",245],["T_WHITESPACE"," ",245],"(",["T_VARIABLE","$object",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getPosition",245],"(",")",["T_WHITESPACE"," ",245],["T_IS_IDENTICAL","===",245],["T_WHITESPACE"," ",245],["T_STRING","null",245],")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n                ",245],["T_VARIABLE","$object",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setPosition",246],"(",["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_getMaxPosition",246],"(",["T_VARIABLE","$object",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getPath",246],"(",")",")",["T_WHITESPACE"," ",246],"+",["T_WHITESPACE"," ",246],["T_LNUMBER","1",246],")",";",["T_WHITESPACE","\n            ",246],"}",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$path",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","explode",248],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$object",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getPath",248],"(",")",")",";",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$level",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_STRING","count",249],"(",["T_VARIABLE","$path",249],")",["T_WHITESPACE","  ",249],"-",["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$object",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getId",249],"(",")",["T_WHITESPACE"," ",249],"?",["T_WHITESPACE"," ",249],["T_LNUMBER","1",249],["T_WHITESPACE"," ",249],":",["T_WHITESPACE"," ",249],["T_LNUMBER","0",249],")",";",["T_WHITESPACE","\n            ",249],["T_VARIABLE","$toUpdateChild",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_STRING","array_diff",250],"(",["T_VARIABLE","$path",250],",",["T_WHITESPACE"," ",250],"[",["T_VARIABLE","$object",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getId",250],"(",")","]",")",";",["T_WHITESPACE","\n\n            ",250],["T_IF","if",252],["T_WHITESPACE"," ",252],"(","!",["T_VARIABLE","$object",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","hasPosition",252],"(",")",")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n                ",252],["T_VARIABLE","$object",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","setPosition",253],"(",["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_getMaxPosition",253],"(",["T_STRING","implode",253],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$toUpdateChild",253],")",")",["T_WHITESPACE"," ",253],"+",["T_WHITESPACE"," ",253],["T_LNUMBER","1",253],")",";",["T_WHITESPACE","\n            ",253],"}",["T_WHITESPACE","\n            ",254],["T_IF","if",255],["T_WHITESPACE"," ",255],"(","!",["T_VARIABLE","$object",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","hasLevel",255],"(",")",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                ",255],["T_VARIABLE","$object",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","setLevel",256],"(",["T_VARIABLE","$level",256],")",";",["T_WHITESPACE","\n            ",256],"}",["T_WHITESPACE","\n            ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(","!",["T_VARIABLE","$object",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","hasParentId",258],"(",")",["T_WHITESPACE"," ",258],["T_BOOLEAN_AND","&&",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$level",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$object",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","setParentId",259],"(",["T_VARIABLE","$path",259],"[",["T_VARIABLE","$level",259],["T_WHITESPACE"," ",259],"-",["T_WHITESPACE"," ",259],["T_LNUMBER","1",259],"]",")",";",["T_WHITESPACE","\n            ",259],"}",["T_WHITESPACE","\n            ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(","!",["T_VARIABLE","$object",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getId",261],"(",")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n                ",261],["T_VARIABLE","$object",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","setPath",262],"(",["T_VARIABLE","$object",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getPath",262],"(",")",["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_CONSTANT_ENCAPSED_STRING","'\/'",262],")",";",["T_WHITESPACE","\n            ",262],"}",["T_WHITESPACE","\n\n            ",263],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getConnection",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","update",265],"(",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getEntityTable",266],"(",")",",",["T_WHITESPACE","\n                ",266],"[",["T_CONSTANT_ENCAPSED_STRING","'children_count'",267],["T_WHITESPACE"," ",267],["T_DOUBLE_ARROW","=>",267],["T_WHITESPACE"," ",267],["T_NEW","new",267],["T_WHITESPACE"," ",267],["T_NS_SEPARATOR","\\",267],["T_STRING","Zend_Db_Expr",267],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count+1'",267],")","]",",",["T_WHITESPACE","\n                ",267],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",268],["T_WHITESPACE"," ",268],["T_DOUBLE_ARROW","=>",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$toUpdateChild",268],"]",["T_WHITESPACE","\n            ",268],")",";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n        ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],";",["T_WHITESPACE","\n    ",271],"}",["T_WHITESPACE","\n\n    ",272],["T_DOC_COMMENT","\/**\n     * Process category data after save category object\n     * save related products ids and update path value\n     *\n     * @param \\Magento\\Framework\\DataObject $object\n     * @return $this\n     *\/",274],["T_WHITESPACE","\n    ",280],["T_PROTECTED","protected",281],["T_WHITESPACE"," ",281],["T_FUNCTION","function",281],["T_WHITESPACE"," ",281],["T_STRING","_afterSave",281],"(",["T_NS_SEPARATOR","\\",281],["T_STRING","Magento",281],["T_NS_SEPARATOR","\\",281],["T_STRING","Framework",281],["T_NS_SEPARATOR","\\",281],["T_STRING","DataObject",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$object",281],")",["T_WHITESPACE","\n    ",281],"{",["T_WHITESPACE","\n        ",282],["T_DOC_COMMENT","\/**\n         * Add identifier for new category\n         *\/",283],["T_WHITESPACE","\n        ",285],["T_IF","if",286],["T_WHITESPACE"," ",286],"(",["T_STRING","substr",286],"(",["T_VARIABLE","$object",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getPath",286],"(",")",",",["T_WHITESPACE"," ",286],"-",["T_LNUMBER","1",286],")",["T_WHITESPACE"," ",286],["T_IS_EQUAL","==",286],["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'\/'",286],")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$object",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","setPath",287],"(",["T_VARIABLE","$object",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getPath",287],"(",")",["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_VARIABLE","$object",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getId",287],"(",")",")",";",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_savePath",288],"(",["T_VARIABLE","$object",288],")",";",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_saveCategoryProducts",291],"(",["T_VARIABLE","$object",291],")",";",["T_WHITESPACE","\n        ",291],["T_RETURN","return",292],["T_WHITESPACE"," ",292],["T_STRING","parent",292],["T_DOUBLE_COLON","::",292],["T_STRING","_afterSave",292],"(",["T_VARIABLE","$object",292],")",";",["T_WHITESPACE","\n    ",292],"}",["T_WHITESPACE","\n\n    ",293],["T_DOC_COMMENT","\/**\n     * Update path field\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $object\n     * @return $this\n     *\/",295],["T_WHITESPACE","\n    ",300],["T_PROTECTED","protected",301],["T_WHITESPACE"," ",301],["T_FUNCTION","function",301],["T_WHITESPACE"," ",301],["T_STRING","_savePath",301],"(",["T_VARIABLE","$object",301],")",["T_WHITESPACE","\n    ",301],"{",["T_WHITESPACE","\n        ",302],["T_IF","if",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$object",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getId",303],"(",")",")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getConnection",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","update",304],"(",["T_WHITESPACE","\n                ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getEntityTable",305],"(",")",",",["T_WHITESPACE","\n                ",305],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",306],["T_WHITESPACE"," ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$object",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getPath",306],"(",")","]",",",["T_WHITESPACE","\n                ",306],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",307],["T_WHITESPACE"," ",307],["T_DOUBLE_ARROW","=>",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$object",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getId",307],"(",")","]",["T_WHITESPACE","\n            ",307],")",";",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$object",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","unsetData",309],"(",["T_CONSTANT_ENCAPSED_STRING","'path_ids'",309],")",";",["T_WHITESPACE","\n        ",309],"}",["T_WHITESPACE","\n        ",310],["T_RETURN","return",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],";",["T_WHITESPACE","\n    ",311],"}",["T_WHITESPACE","\n\n    ",312],["T_DOC_COMMENT","\/**\n     * Get maximum position of child categories by specific tree path\n     *\n     * @param string $path\n     * @return int\n     *\/",314],["T_WHITESPACE","\n    ",319],["T_PROTECTED","protected",320],["T_WHITESPACE"," ",320],["T_FUNCTION","function",320],["T_WHITESPACE"," ",320],["T_STRING","_getMaxPosition",320],"(",["T_VARIABLE","$path",320],")",["T_WHITESPACE","\n    ",320],"{",["T_WHITESPACE","\n        ",321],["T_VARIABLE","$connection",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getConnection",322],"(",")",";",["T_WHITESPACE","\n        ",322],["T_VARIABLE","$positionField",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$connection",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","quoteIdentifier",323],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",323],")",";",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$level",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_STRING","count",324],"(",["T_STRING","explode",324],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$path",324],")",")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$bind",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],"[",["T_CONSTANT_ENCAPSED_STRING","'c_level'",325],["T_WHITESPACE"," ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$level",325],",",["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","'c_path'",325],["T_WHITESPACE"," ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$path",325],["T_WHITESPACE"," ",325],".",["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","'\/%'",325],"]",";",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$select",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$connection",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","select",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","from",326],"(",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getTable",327],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_entity'",327],")",",",["T_WHITESPACE","\n            ",327],["T_CONSTANT_ENCAPSED_STRING","'MAX('",328],["T_WHITESPACE"," ",328],".",["T_WHITESPACE"," ",328],["T_VARIABLE","$positionField",328],["T_WHITESPACE"," ",328],".",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","')'",328],["T_WHITESPACE","\n        ",328],")",["T_OBJECT_OPERATOR","->",329],["T_STRING","where",329],"(",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$connection",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","quoteIdentifier",330],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",330],")",["T_WHITESPACE"," ",330],".",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","' LIKE :c_path'",330],["T_WHITESPACE","\n        ",330],")",["T_OBJECT_OPERATOR","->",331],["T_STRING","where",331],"(",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$connection",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","quoteIdentifier",332],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",332],")",["T_WHITESPACE"," ",332],".",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","' = :c_level'",332],["T_WHITESPACE","\n        ",332],")",";",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$position",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$connection",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","fetchOne",335],"(",["T_VARIABLE","$select",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$bind",335],")",";",["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(","!",["T_VARIABLE","$position",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$position",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_LNUMBER","0",337],";",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE","\n        ",338],["T_RETURN","return",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$position",339],";",["T_WHITESPACE","\n    ",339],"}",["T_WHITESPACE","\n\n    ",340],["T_DOC_COMMENT","\/**\n     * Save category products relation\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",342],["T_WHITESPACE","\n    ",349],["T_PROTECTED","protected",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","_saveCategoryProducts",350],"(",["T_VARIABLE","$category",350],")",["T_WHITESPACE","\n    ",350],"{",["T_WHITESPACE","\n        ",351],["T_VARIABLE","$category",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","setIsChangedProductList",352],"(",["T_STRING","false",352],")",";",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$id",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$category",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getId",353],"(",")",";",["T_WHITESPACE","\n        ",353],["T_DOC_COMMENT","\/**\n         * new category-product relationships\n         *\/",354],["T_WHITESPACE","\n        ",356],["T_VARIABLE","$products",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$category",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getPostedProducts",357],"(",")",";",["T_WHITESPACE","\n\n        ",357],["T_DOC_COMMENT","\/**\n         * Example re-save category\n         *\/",359],["T_WHITESPACE","\n        ",361],["T_IF","if",362],["T_WHITESPACE"," ",362],"(",["T_VARIABLE","$products",362],["T_WHITESPACE"," ",362],["T_IS_IDENTICAL","===",362],["T_WHITESPACE"," ",362],["T_STRING","null",362],")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n            ",362],["T_RETURN","return",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],";",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE","\n\n        ",364],["T_DOC_COMMENT","\/**\n         * old category-product relationships\n         *\/",366],["T_WHITESPACE","\n        ",368],["T_VARIABLE","$oldProducts",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_VARIABLE","$category",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getProductsPosition",369],"(",")",";",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$insert",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_STRING","array_diff_key",371],"(",["T_VARIABLE","$products",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$oldProducts",371],")",";",["T_WHITESPACE","\n        ",371],["T_VARIABLE","$delete",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","array_diff_key",372],"(",["T_VARIABLE","$oldProducts",372],",",["T_WHITESPACE"," ",372],["T_VARIABLE","$products",372],")",";",["T_WHITESPACE","\n\n        ",372],["T_DOC_COMMENT","\/**\n         * Find product ids which are presented in both arrays\n         * and saved before (check $oldProducts array)\n         *\/",374],["T_WHITESPACE","\n        ",377],["T_VARIABLE","$update",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_STRING","array_intersect_key",378],"(",["T_VARIABLE","$products",378],",",["T_WHITESPACE"," ",378],["T_VARIABLE","$oldProducts",378],")",";",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$update",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_STRING","array_diff_assoc",379],"(",["T_VARIABLE","$update",379],",",["T_WHITESPACE"," ",379],["T_VARIABLE","$oldProducts",379],")",";",["T_WHITESPACE","\n\n        ",379],["T_VARIABLE","$connection",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getConnection",381],"(",")",";",["T_WHITESPACE","\n\n        ",381],["T_DOC_COMMENT","\/**\n         * Delete products from category\n         *\/",383],["T_WHITESPACE","\n        ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(","!",["T_EMPTY","empty",386],"(",["T_VARIABLE","$delete",386],")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$cond",387],["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id IN(?)'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_STRING","array_keys",387],"(",["T_VARIABLE","$delete",387],")",",",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'category_id=?'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$id",387],"]",";",["T_WHITESPACE","\n            ",387],["T_VARIABLE","$connection",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","delete",388],"(",["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getCategoryProductTable",388],"(",")",",",["T_WHITESPACE"," ",388],["T_VARIABLE","$cond",388],")",";",["T_WHITESPACE","\n        ",388],"}",["T_WHITESPACE","\n\n        ",389],["T_DOC_COMMENT","\/**\n         * Add products to category\n         *\/",391],["T_WHITESPACE","\n        ",393],["T_IF","if",394],["T_WHITESPACE"," ",394],"(","!",["T_EMPTY","empty",394],"(",["T_VARIABLE","$insert",394],")",")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$data",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],"[","]",";",["T_WHITESPACE","\n            ",395],["T_FOREACH","foreach",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$insert",396],["T_WHITESPACE"," ",396],["T_AS","as",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$productId",396],["T_WHITESPACE"," ",396],["T_DOUBLE_ARROW","=>",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$position",396],")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n                ",396],["T_VARIABLE","$data",397],"[","]",["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],"[",["T_WHITESPACE","\n                    ",397],["T_CONSTANT_ENCAPSED_STRING","'category_id'",398],["T_WHITESPACE"," ",398],["T_DOUBLE_ARROW","=>",398],["T_WHITESPACE"," ",398],["T_INT_CAST","(int)",398],["T_VARIABLE","$id",398],",",["T_WHITESPACE","\n                    ",398],["T_CONSTANT_ENCAPSED_STRING","'product_id'",399],["T_WHITESPACE"," ",399],["T_DOUBLE_ARROW","=>",399],["T_WHITESPACE"," ",399],["T_INT_CAST","(int)",399],["T_VARIABLE","$productId",399],",",["T_WHITESPACE","\n                    ",399],["T_CONSTANT_ENCAPSED_STRING","'position'",400],["T_WHITESPACE"," ",400],["T_DOUBLE_ARROW","=>",400],["T_WHITESPACE"," ",400],["T_INT_CAST","(int)",400],["T_VARIABLE","$position",400],",",["T_WHITESPACE","\n                ",400],"]",";",["T_WHITESPACE","\n            ",401],"}",["T_WHITESPACE","\n            ",402],["T_VARIABLE","$connection",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","insertMultiple",403],"(",["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getCategoryProductTable",403],"(",")",",",["T_WHITESPACE"," ",403],["T_VARIABLE","$data",403],")",";",["T_WHITESPACE","\n        ",403],"}",["T_WHITESPACE","\n\n        ",404],["T_DOC_COMMENT","\/**\n         * Update product positions in category\n         *\/",406],["T_WHITESPACE","\n        ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(","!",["T_EMPTY","empty",409],"(",["T_VARIABLE","$update",409],")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_FOREACH","foreach",410],["T_WHITESPACE"," ",410],"(",["T_VARIABLE","$update",410],["T_WHITESPACE"," ",410],["T_AS","as",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$productId",410],["T_WHITESPACE"," ",410],["T_DOUBLE_ARROW","=>",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$position",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n                ",410],["T_VARIABLE","$where",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id = ?'",411],["T_WHITESPACE"," ",411],["T_DOUBLE_ARROW","=>",411],["T_WHITESPACE"," ",411],["T_INT_CAST","(int)",411],["T_VARIABLE","$id",411],",",["T_WHITESPACE"," ",411],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",411],["T_WHITESPACE"," ",411],["T_DOUBLE_ARROW","=>",411],["T_WHITESPACE"," ",411],["T_INT_CAST","(int)",411],["T_VARIABLE","$productId",411],"]",";",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$bind",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",412],["T_WHITESPACE"," ",412],["T_DOUBLE_ARROW","=>",412],["T_WHITESPACE"," ",412],["T_INT_CAST","(int)",412],["T_VARIABLE","$position",412],"]",";",["T_WHITESPACE","\n                ",412],["T_VARIABLE","$connection",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","update",413],"(",["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getCategoryProductTable",413],"(",")",",",["T_WHITESPACE"," ",413],["T_VARIABLE","$bind",413],",",["T_WHITESPACE"," ",413],["T_VARIABLE","$where",413],")",";",["T_WHITESPACE","\n            ",413],"}",["T_WHITESPACE","\n        ",414],"}",["T_WHITESPACE","\n\n        ",415],["T_IF","if",417],["T_WHITESPACE"," ",417],"(","!",["T_EMPTY","empty",417],"(",["T_VARIABLE","$insert",417],")",["T_WHITESPACE"," ",417],["T_BOOLEAN_OR","||",417],["T_WHITESPACE"," ",417],"!",["T_EMPTY","empty",417],"(",["T_VARIABLE","$delete",417],")",")",["T_WHITESPACE"," ",417],"{",["T_WHITESPACE","\n            ",417],["T_VARIABLE","$productIds",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_STRING","array_unique",418],"(",["T_STRING","array_merge",418],"(",["T_STRING","array_keys",418],"(",["T_VARIABLE","$insert",418],")",",",["T_WHITESPACE"," ",418],["T_STRING","array_keys",418],"(",["T_VARIABLE","$delete",418],")",")",")",";",["T_WHITESPACE","\n            ",418],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","_eventManager",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","dispatch",419],"(",["T_WHITESPACE","\n                ",419],["T_CONSTANT_ENCAPSED_STRING","'catalog_category_change_products'",420],",",["T_WHITESPACE","\n                ",420],"[",["T_CONSTANT_ENCAPSED_STRING","'category'",421],["T_WHITESPACE"," ",421],["T_DOUBLE_ARROW","=>",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$category",421],",",["T_WHITESPACE"," ",421],["T_CONSTANT_ENCAPSED_STRING","'product_ids'",421],["T_WHITESPACE"," ",421],["T_DOUBLE_ARROW","=>",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$productIds",421],"]",["T_WHITESPACE","\n            ",421],")",";",["T_WHITESPACE","\n        ",422],"}",["T_WHITESPACE","\n\n        ",423],["T_IF","if",425],["T_WHITESPACE"," ",425],"(","!",["T_EMPTY","empty",425],"(",["T_VARIABLE","$insert",425],")",["T_WHITESPACE"," ",425],["T_BOOLEAN_OR","||",425],["T_WHITESPACE"," ",425],"!",["T_EMPTY","empty",425],"(",["T_VARIABLE","$update",425],")",["T_WHITESPACE"," ",425],["T_BOOLEAN_OR","||",425],["T_WHITESPACE"," ",425],"!",["T_EMPTY","empty",425],"(",["T_VARIABLE","$delete",425],")",")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$category",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","setIsChangedProductList",426],"(",["T_STRING","true",426],")",";",["T_WHITESPACE","\n\n            ",426],["T_DOC_COMMENT","\/**\n             * Setting affected products to category for third party engine index refresh\n             *\/",428],["T_WHITESPACE","\n            ",430],["T_VARIABLE","$productIds",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_STRING","array_keys",431],"(",["T_VARIABLE","$insert",431],["T_WHITESPACE"," ",431],"+",["T_WHITESPACE"," ",431],["T_VARIABLE","$delete",431],["T_WHITESPACE"," ",431],"+",["T_WHITESPACE"," ",431],["T_VARIABLE","$update",431],")",";",["T_WHITESPACE","\n            ",431],["T_VARIABLE","$category",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","setAffectedProductIds",432],"(",["T_VARIABLE","$productIds",432],")",";",["T_WHITESPACE","\n        ",432],"}",["T_WHITESPACE","\n        ",433],["T_RETURN","return",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$this",434],";",["T_WHITESPACE","\n    ",434],"}",["T_WHITESPACE","\n\n    ",435],["T_DOC_COMMENT","\/**\n     * Get positions of associated to category products\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return array\n     *\/",437],["T_WHITESPACE","\n    ",442],["T_PUBLIC","public",443],["T_WHITESPACE"," ",443],["T_FUNCTION","function",443],["T_WHITESPACE"," ",443],["T_STRING","getProductsPosition",443],"(",["T_VARIABLE","$category",443],")",["T_WHITESPACE","\n    ",443],"{",["T_WHITESPACE","\n        ",444],["T_VARIABLE","$select",445],["T_WHITESPACE"," ",445],"=",["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getConnection",445],"(",")",["T_OBJECT_OPERATOR","->",445],["T_STRING","select",445],"(",")",["T_OBJECT_OPERATOR","->",445],["T_STRING","from",445],"(",["T_WHITESPACE","\n            ",445],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getCategoryProductTable",446],"(",")",",",["T_WHITESPACE","\n            ",446],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",447],",",["T_WHITESPACE"," ",447],["T_CONSTANT_ENCAPSED_STRING","'position'",447],"]",["T_WHITESPACE","\n        ",447],")",["T_OBJECT_OPERATOR","->",448],["T_STRING","where",448],"(",["T_WHITESPACE","\n            ",448],["T_CONSTANT_ENCAPSED_STRING","'category_id = :category_id'",449],["T_WHITESPACE","\n        ",449],")",";",["T_WHITESPACE","\n        ",450],["T_VARIABLE","$bind",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",451],["T_WHITESPACE"," ",451],["T_DOUBLE_ARROW","=>",451],["T_WHITESPACE"," ",451],["T_INT_CAST","(int)",451],["T_VARIABLE","$category",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getId",451],"(",")","]",";",["T_WHITESPACE","\n\n        ",451],["T_RETURN","return",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getConnection",453],"(",")",["T_OBJECT_OPERATOR","->",453],["T_STRING","fetchPairs",453],"(",["T_VARIABLE","$select",453],",",["T_WHITESPACE"," ",453],["T_VARIABLE","$bind",453],")",";",["T_WHITESPACE","\n    ",453],"}",["T_WHITESPACE","\n\n    ",454],["T_DOC_COMMENT","\/**\n     * Get chlden categories count\n     *\n     * @param int $categoryId\n     * @return int\n     *\/",456],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","getChildrenCount",462],"(",["T_VARIABLE","$categoryId",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$select",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getConnection",464],"(",")",["T_OBJECT_OPERATOR","->",464],["T_STRING","select",464],"(",")",["T_OBJECT_OPERATOR","->",464],["T_STRING","from",464],"(",["T_WHITESPACE","\n            ",464],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getEntityTable",465],"(",")",",",["T_WHITESPACE","\n            ",465],["T_CONSTANT_ENCAPSED_STRING","'children_count'",466],["T_WHITESPACE","\n        ",466],")",["T_OBJECT_OPERATOR","->",467],["T_STRING","where",467],"(",["T_WHITESPACE","\n            ",467],["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",468],["T_WHITESPACE","\n        ",468],")",";",["T_WHITESPACE","\n        ",469],["T_VARIABLE","$bind",470],["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",470],["T_WHITESPACE"," ",470],["T_DOUBLE_ARROW","=>",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$categoryId",470],"]",";",["T_WHITESPACE","\n\n        ",470],["T_RETURN","return",472],["T_WHITESPACE"," ",472],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getConnection",472],"(",")",["T_OBJECT_OPERATOR","->",472],["T_STRING","fetchOne",472],"(",["T_VARIABLE","$select",472],",",["T_WHITESPACE"," ",472],["T_VARIABLE","$bind",472],")",";",["T_WHITESPACE","\n    ",472],"}",["T_WHITESPACE","\n\n    ",473],["T_DOC_COMMENT","\/**\n     * Check if category id exist\n     *\n     * @param int $entityId\n     * @return bool\n     *\/",475],["T_WHITESPACE","\n    ",480],["T_PUBLIC","public",481],["T_WHITESPACE"," ",481],["T_FUNCTION","function",481],["T_WHITESPACE"," ",481],["T_STRING","checkId",481],"(",["T_VARIABLE","$entityId",481],")",["T_WHITESPACE","\n    ",481],"{",["T_WHITESPACE","\n        ",482],["T_VARIABLE","$select",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getConnection",483],"(",")",["T_OBJECT_OPERATOR","->",483],["T_STRING","select",483],"(",")",["T_OBJECT_OPERATOR","->",483],["T_STRING","from",483],"(",["T_WHITESPACE","\n            ",483],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getEntityTable",484],"(",")",",",["T_WHITESPACE","\n            ",484],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",485],["T_WHITESPACE","\n        ",485],")",["T_OBJECT_OPERATOR","->",486],["T_STRING","where",486],"(",["T_WHITESPACE","\n            ",486],["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",487],["T_WHITESPACE","\n        ",487],")",";",["T_WHITESPACE","\n        ",488],["T_VARIABLE","$bind",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",489],["T_WHITESPACE"," ",489],["T_DOUBLE_ARROW","=>",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$entityId",489],"]",";",["T_WHITESPACE","\n\n        ",489],["T_RETURN","return",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getConnection",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","fetchOne",491],"(",["T_VARIABLE","$select",491],",",["T_WHITESPACE"," ",491],["T_VARIABLE","$bind",491],")",";",["T_WHITESPACE","\n    ",491],"}",["T_WHITESPACE","\n\n    ",492],["T_DOC_COMMENT","\/**\n     * Check array of category identifiers\n     *\n     * @param array $ids\n     * @return array\n     *\/",494],["T_WHITESPACE","\n    ",499],["T_PUBLIC","public",500],["T_WHITESPACE"," ",500],["T_FUNCTION","function",500],["T_WHITESPACE"," ",500],["T_STRING","verifyIds",500],"(",["T_ARRAY","array",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$ids",500],")",["T_WHITESPACE","\n    ",500],"{",["T_WHITESPACE","\n        ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(",["T_EMPTY","empty",502],"(",["T_VARIABLE","$ids",502],")",")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n            ",502],["T_RETURN","return",503],["T_WHITESPACE"," ",503],"[","]",";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n\n        ",504],["T_VARIABLE","$select",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getConnection",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","select",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","from",506],"(",["T_WHITESPACE","\n            ",506],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getEntityTable",507],"(",")",",",["T_WHITESPACE","\n            ",507],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",508],["T_WHITESPACE","\n        ",508],")",["T_OBJECT_OPERATOR","->",509],["T_STRING","where",509],"(",["T_WHITESPACE","\n            ",509],["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",510],",",["T_WHITESPACE","\n            ",510],["T_VARIABLE","$ids",511],["T_WHITESPACE","\n        ",511],")",";",["T_WHITESPACE","\n\n        ",512],["T_RETURN","return",514],["T_WHITESPACE"," ",514],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getConnection",514],"(",")",["T_OBJECT_OPERATOR","->",514],["T_STRING","fetchCol",514],"(",["T_VARIABLE","$select",514],")",";",["T_WHITESPACE","\n    ",514],"}",["T_WHITESPACE","\n\n    ",515],["T_DOC_COMMENT","\/**\n     * Get count of active\/not active children categories\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @param bool $isActiveFlag\n     * @return int\n     *\/",517],["T_WHITESPACE","\n    ",523],["T_PUBLIC","public",524],["T_WHITESPACE"," ",524],["T_FUNCTION","function",524],["T_WHITESPACE"," ",524],["T_STRING","getChildrenAmount",524],"(",["T_VARIABLE","$category",524],",",["T_WHITESPACE"," ",524],["T_VARIABLE","$isActiveFlag",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_STRING","true",524],")",["T_WHITESPACE","\n    ",524],"{",["T_WHITESPACE","\n        ",525],["T_VARIABLE","$storeId",526],["T_WHITESPACE"," ",526],"=",["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_storeManager",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getStore",526],"(",")",["T_OBJECT_OPERATOR","->",526],["T_STRING","getId",526],"(",")",";",["T_WHITESPACE","\n        ",526],["T_VARIABLE","$attributeId",527],["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getIsActiveAttributeId",527],"(",")",";",["T_WHITESPACE","\n        ",527],["T_VARIABLE","$table",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getTable",528],"(","[",["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getEntityTablePrefix",528],"(",")",",",["T_WHITESPACE"," ",528],["T_CONSTANT_ENCAPSED_STRING","'int'",528],"]",")",";",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$connection",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getConnection",529],"(",")",";",["T_WHITESPACE","\n        ",529],["T_VARIABLE","$checkSql",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$connection",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getCheckSql",530],"(",["T_CONSTANT_ENCAPSED_STRING","'c.value_id > 0'",530],",",["T_WHITESPACE"," ",530],["T_CONSTANT_ENCAPSED_STRING","'c.value'",530],",",["T_WHITESPACE"," ",530],["T_CONSTANT_ENCAPSED_STRING","'d.value'",530],")",";",["T_WHITESPACE","\n        ",530],["T_VARIABLE","$linkField",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getLinkField",531],"(",")",";",["T_WHITESPACE","\n        ",531],["T_VARIABLE","$bind",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],"[",["T_WHITESPACE","\n            ",532],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",533],["T_WHITESPACE"," ",533],["T_DOUBLE_ARROW","=>",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$attributeId",533],",",["T_WHITESPACE","\n            ",533],["T_CONSTANT_ENCAPSED_STRING","'store_id'",534],["T_WHITESPACE"," ",534],["T_DOUBLE_ARROW","=>",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$storeId",534],",",["T_WHITESPACE","\n            ",534],["T_CONSTANT_ENCAPSED_STRING","'active_flag'",535],["T_WHITESPACE"," ",535],["T_DOUBLE_ARROW","=>",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$isActiveFlag",535],",",["T_WHITESPACE","\n            ",535],["T_CONSTANT_ENCAPSED_STRING","'c_path'",536],["T_WHITESPACE"," ",536],["T_DOUBLE_ARROW","=>",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$category",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","getPath",536],"(",")",["T_WHITESPACE"," ",536],".",["T_WHITESPACE"," ",536],["T_CONSTANT_ENCAPSED_STRING","'\/%'",536],",",["T_WHITESPACE","\n        ",536],"]",";",["T_WHITESPACE","\n        ",537],["T_VARIABLE","$select",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_VARIABLE","$connection",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","select",538],"(",")",["T_OBJECT_OPERATOR","->",538],["T_STRING","from",538],"(",["T_WHITESPACE","\n            ",538],"[",["T_CONSTANT_ENCAPSED_STRING","'m'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getEntityTable",539],"(",")","]",",",["T_WHITESPACE","\n            ",539],"[",["T_CONSTANT_ENCAPSED_STRING","'COUNT(m.entity_id)'",540],"]",["T_WHITESPACE","\n        ",540],")",["T_OBJECT_OPERATOR","->",541],["T_STRING","joinLeft",541],"(",["T_WHITESPACE","\n            ",541],"[",["T_CONSTANT_ENCAPSED_STRING","'d'",542],["T_WHITESPACE"," ",542],["T_DOUBLE_ARROW","=>",542],["T_WHITESPACE"," ",542],["T_VARIABLE","$table",542],"]",",",["T_WHITESPACE","\n            ",542],"\"",["T_ENCAPSED_AND_WHITESPACE","d.attribute_id = :attribute_id AND d.store_id = 0 AND d.",543],["T_CURLY_OPEN","{",543],["T_VARIABLE","$linkField",543],"}",["T_ENCAPSED_AND_WHITESPACE"," = m.",543],["T_CURLY_OPEN","{",543],["T_VARIABLE","$linkField",543],"}","\"",",",["T_WHITESPACE","\n            ",543],"[","]",["T_WHITESPACE","\n        ",544],")",["T_OBJECT_OPERATOR","->",545],["T_STRING","joinLeft",545],"(",["T_WHITESPACE","\n            ",545],"[",["T_CONSTANT_ENCAPSED_STRING","'c'",546],["T_WHITESPACE"," ",546],["T_DOUBLE_ARROW","=>",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$table",546],"]",",",["T_WHITESPACE","\n            ",546],"\"",["T_ENCAPSED_AND_WHITESPACE","c.attribute_id = :attribute_id AND c.store_id = :store_id AND c.",547],["T_CURLY_OPEN","{",547],["T_VARIABLE","$linkField",547],"}",["T_ENCAPSED_AND_WHITESPACE"," = m.",547],["T_CURLY_OPEN","{",547],["T_VARIABLE","$linkField",547],"}","\"",",",["T_WHITESPACE","\n            ",547],"[","]",["T_WHITESPACE","\n        ",548],")",["T_OBJECT_OPERATOR","->",549],["T_STRING","where",549],"(",["T_WHITESPACE","\n            ",549],["T_CONSTANT_ENCAPSED_STRING","'m.path LIKE :c_path'",550],["T_WHITESPACE","\n        ",550],")",["T_OBJECT_OPERATOR","->",551],["T_STRING","where",551],"(",["T_WHITESPACE","\n            ",551],["T_VARIABLE","$checkSql",552],["T_WHITESPACE"," ",552],".",["T_WHITESPACE"," ",552],["T_CONSTANT_ENCAPSED_STRING","' = :active_flag'",552],["T_WHITESPACE","\n        ",552],")",";",["T_WHITESPACE","\n\n        ",553],["T_RETURN","return",555],["T_WHITESPACE"," ",555],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getConnection",555],"(",")",["T_OBJECT_OPERATOR","->",555],["T_STRING","fetchOne",555],"(",["T_VARIABLE","$select",555],",",["T_WHITESPACE"," ",555],["T_VARIABLE","$bind",555],")",";",["T_WHITESPACE","\n    ",555],"}",["T_WHITESPACE","\n\n    ",556],["T_DOC_COMMENT","\/**\n     * Get \"is_active\" attribute identifier\n     *\n     * @return int\n     *\/",558],["T_WHITESPACE","\n    ",562],["T_PUBLIC","public",563],["T_WHITESPACE"," ",563],["T_FUNCTION","function",563],["T_WHITESPACE"," ",563],["T_STRING","getIsActiveAttributeId",563],"(",")",["T_WHITESPACE","\n    ",563],"{",["T_WHITESPACE","\n        ",564],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","_isActiveAttributeId",565],["T_WHITESPACE"," ",565],["T_IS_IDENTICAL","===",565],["T_WHITESPACE"," ",565],["T_STRING","null",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_isActiveAttributeId",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_INT_CAST","(int)",566],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_eavConfig",566],["T_WHITESPACE","\n                ",566],["T_OBJECT_OPERATOR","->",567],["T_STRING","getAttribute",567],"(",["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getEntityType",567],"(",")",",",["T_WHITESPACE"," ",567],["T_CONSTANT_ENCAPSED_STRING","'is_active'",567],")",["T_WHITESPACE","\n                ",567],["T_OBJECT_OPERATOR","->",568],["T_STRING","getAttributeId",568],"(",")",";",["T_WHITESPACE","\n        ",568],"}",["T_WHITESPACE","\n        ",569],["T_RETURN","return",570],["T_WHITESPACE"," ",570],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","_isActiveAttributeId",570],";",["T_WHITESPACE","\n    ",570],"}",["T_WHITESPACE","\n\n    ",571],["T_DOC_COMMENT","\/**\n     * Return entities where attribute value is\n     *\n     * @param array|int $entityIdsFilter\n     * @param \\Magento\\Eav\\Model\\Entity\\Attribute $attribute\n     * @param mixed $expectedValue\n     * @return array\n     *\/",573],["T_WHITESPACE","\n    ",580],["T_PUBLIC","public",581],["T_WHITESPACE"," ",581],["T_FUNCTION","function",581],["T_WHITESPACE"," ",581],["T_STRING","findWhereAttributeIs",581],"(",["T_VARIABLE","$entityIdsFilter",581],",",["T_WHITESPACE"," ",581],["T_VARIABLE","$attribute",581],",",["T_WHITESPACE"," ",581],["T_VARIABLE","$expectedValue",581],")",["T_WHITESPACE","\n    ",581],"{",["T_WHITESPACE","\n        ",582],["T_VARIABLE","$entityIdsFilterHash",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_STRING","md5",583],"(",["T_STRING","serialize",583],"(",["T_VARIABLE","$entityIdsFilter",583],")",")",";",["T_WHITESPACE","\n\n        ",583],["T_IF","if",585],["T_WHITESPACE"," ",585],"(","!",["T_ISSET","isset",585],"(",["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","entitiesWhereAttributesIs",585],"[",["T_VARIABLE","$entityIdsFilterHash",585],"]","[",["T_VARIABLE","$attribute",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getId",585],"(",")","]","[",["T_VARIABLE","$expectedValue",585],"]",")",")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n            ",585],["T_VARIABLE","$linkField",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getLinkField",586],"(",")",";",["T_WHITESPACE","\n            ",586],["T_VARIABLE","$bind",587],["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",587],["T_WHITESPACE"," ",587],["T_DOUBLE_ARROW","=>",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$attribute",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getId",587],"(",")",",",["T_WHITESPACE"," ",587],["T_CONSTANT_ENCAPSED_STRING","'value'",587],["T_WHITESPACE"," ",587],["T_DOUBLE_ARROW","=>",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$expectedValue",587],"]",";",["T_WHITESPACE","\n            ",587],["T_VARIABLE","$selectEntities",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getConnection",588],"(",")",["T_OBJECT_OPERATOR","->",588],["T_STRING","select",588],"(",")",["T_OBJECT_OPERATOR","->",588],["T_STRING","from",588],"(",["T_WHITESPACE","\n                ",588],"[",["T_CONSTANT_ENCAPSED_STRING","'ce'",589],["T_WHITESPACE"," ",589],["T_DOUBLE_ARROW","=>",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getTable",589],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_entity'",589],")","]",",",["T_WHITESPACE","\n                ",589],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",590],"]",["T_WHITESPACE","\n            ",590],")",["T_OBJECT_OPERATOR","->",591],["T_STRING","joinLeft",591],"(",["T_WHITESPACE","\n                ",591],"[",["T_CONSTANT_ENCAPSED_STRING","'ci'",592],["T_WHITESPACE"," ",592],["T_DOUBLE_ARROW","=>",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$attribute",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getBackend",592],"(",")",["T_OBJECT_OPERATOR","->",592],["T_STRING","getTable",592],"(",")","]",",",["T_WHITESPACE","\n                ",592],"\"",["T_ENCAPSED_AND_WHITESPACE","ci.",593],["T_CURLY_OPEN","{",593],["T_VARIABLE","$linkField",593],"}",["T_ENCAPSED_AND_WHITESPACE"," = ce.",593],["T_CURLY_OPEN","{",593],["T_VARIABLE","$linkField",593],"}",["T_ENCAPSED_AND_WHITESPACE"," AND attribute_id = :attribute_id",593],"\"",",",["T_WHITESPACE","\n                ",593],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",594],"]",["T_WHITESPACE","\n            ",594],")",["T_OBJECT_OPERATOR","->",595],["T_STRING","where",595],"(",["T_WHITESPACE","\n                ",595],["T_CONSTANT_ENCAPSED_STRING","'ci.value = :value'",596],["T_WHITESPACE","\n            ",596],")",["T_OBJECT_OPERATOR","->",597],["T_STRING","where",597],"(",["T_WHITESPACE","\n                ",597],["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id IN (?)'",598],",",["T_WHITESPACE","\n                ",598],["T_VARIABLE","$entityIdsFilter",599],["T_WHITESPACE","\n            ",599],")",";",["T_WHITESPACE","\n            ",600],["T_VARIABLE","$this",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","entitiesWhereAttributesIs",601],"[",["T_VARIABLE","$entityIdsFilterHash",601],"]","[",["T_VARIABLE","$attribute",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getId",601],"(",")","]","[",["T_VARIABLE","$expectedValue",601],"]",["T_WHITESPACE"," ",601],"=",["T_WHITESPACE","\n                ",601],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getConnection",602],"(",")",["T_OBJECT_OPERATOR","->",602],["T_STRING","fetchCol",602],"(",["T_VARIABLE","$selectEntities",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$bind",602],")",";",["T_WHITESPACE","\n        ",602],"}",["T_WHITESPACE","\n\n        ",603],["T_RETURN","return",605],["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","entitiesWhereAttributesIs",605],"[",["T_VARIABLE","$entityIdsFilterHash",605],"]","[",["T_VARIABLE","$attribute",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getId",605],"(",")","]","[",["T_VARIABLE","$expectedValue",605],"]",";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_DOC_COMMENT","\/**\n     * Get products count in category\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return int\n     *\/",608],["T_WHITESPACE","\n    ",613],["T_PUBLIC","public",614],["T_WHITESPACE"," ",614],["T_FUNCTION","function",614],["T_WHITESPACE"," ",614],["T_STRING","getProductCount",614],"(",["T_VARIABLE","$category",614],")",["T_WHITESPACE","\n    ",614],"{",["T_WHITESPACE","\n        ",615],["T_VARIABLE","$productTable",616],["T_WHITESPACE"," ",616],"=",["T_WHITESPACE"," ",616],["T_VARIABLE","$this",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","_resource",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","getTableName",616],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_product'",616],")",";",["T_WHITESPACE","\n\n        ",616],["T_VARIABLE","$select",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getConnection",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","select",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","from",618],"(",["T_WHITESPACE","\n            ",618],"[",["T_CONSTANT_ENCAPSED_STRING","'main_table'",619],["T_WHITESPACE"," ",619],["T_DOUBLE_ARROW","=>",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$productTable",619],"]",",",["T_WHITESPACE","\n            ",619],"[",["T_NEW","new",620],["T_WHITESPACE"," ",620],["T_NS_SEPARATOR","\\",620],["T_STRING","Zend_Db_Expr",620],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.product_id)'",620],")","]",["T_WHITESPACE","\n        ",620],")",["T_OBJECT_OPERATOR","->",621],["T_STRING","where",621],"(",["T_WHITESPACE","\n            ",621],["T_CONSTANT_ENCAPSED_STRING","'main_table.category_id = :category_id'",622],["T_WHITESPACE","\n        ",622],")",";",["T_WHITESPACE","\n\n        ",623],["T_VARIABLE","$bind",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",625],["T_WHITESPACE"," ",625],["T_DOUBLE_ARROW","=>",625],["T_WHITESPACE"," ",625],["T_INT_CAST","(int)",625],["T_VARIABLE","$category",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","getId",625],"(",")","]",";",["T_WHITESPACE","\n        ",625],["T_VARIABLE","$counts",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getConnection",626],"(",")",["T_OBJECT_OPERATOR","->",626],["T_STRING","fetchOne",626],"(",["T_VARIABLE","$select",626],",",["T_WHITESPACE"," ",626],["T_VARIABLE","$bind",626],")",";",["T_WHITESPACE","\n\n        ",626],["T_RETURN","return",628],["T_WHITESPACE"," ",628],["T_STRING","intval",628],"(",["T_VARIABLE","$counts",628],")",";",["T_WHITESPACE","\n    ",628],"}",["T_WHITESPACE","\n\n    ",629],["T_DOC_COMMENT","\/**\n     * Retrieve categories\n     *\n     * @param integer $parent\n     * @param integer $recursionLevel\n     * @param boolean|string $sorted\n     * @param boolean $asCollection\n     * @param boolean $toLoad\n     * @return \\Magento\\Framework\\Data\\Tree\\Node\\Collection|\\Magento\\Catalog\\Model\\ResourceModel\\Category\\Collection\n     *\/",631],["T_WHITESPACE","\n    ",640],["T_PUBLIC","public",641],["T_WHITESPACE"," ",641],["T_FUNCTION","function",641],["T_WHITESPACE"," ",641],["T_STRING","getCategories",641],"(",["T_VARIABLE","$parent",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$recursionLevel",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_LNUMBER","0",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$sorted",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_STRING","false",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$asCollection",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_STRING","false",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$toLoad",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_STRING","true",641],")",["T_WHITESPACE","\n    ",641],"{",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$tree",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_categoryTreeFactory",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","create",643],"(",")",";",["T_WHITESPACE","\n        ",643],["T_COMMENT","\/* @var $tree \\Magento\\Catalog\\Model\\ResourceModel\\Category\\Tree *\/",644],["T_WHITESPACE","\n        ",644],["T_VARIABLE","$nodes",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_VARIABLE","$tree",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","loadNode",645],"(",["T_VARIABLE","$parent",645],")",["T_OBJECT_OPERATOR","->",645],["T_STRING","loadChildren",645],"(",["T_VARIABLE","$recursionLevel",645],")",["T_OBJECT_OPERATOR","->",645],["T_STRING","getChildren",645],"(",")",";",["T_WHITESPACE","\n\n        ",645],["T_VARIABLE","$tree",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","addCollectionData",647],"(",["T_STRING","null",647],",",["T_WHITESPACE"," ",647],["T_VARIABLE","$sorted",647],",",["T_WHITESPACE"," ",647],["T_VARIABLE","$parent",647],",",["T_WHITESPACE"," ",647],["T_VARIABLE","$toLoad",647],",",["T_WHITESPACE"," ",647],["T_STRING","true",647],")",";",["T_WHITESPACE","\n\n        ",647],["T_IF","if",649],["T_WHITESPACE"," ",649],"(",["T_VARIABLE","$asCollection",649],")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n            ",649],["T_RETURN","return",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$tree",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getCollection",650],"(",")",";",["T_WHITESPACE","\n        ",650],"}",["T_WHITESPACE","\n        ",651],["T_RETURN","return",652],["T_WHITESPACE"," ",652],["T_VARIABLE","$nodes",652],";",["T_WHITESPACE","\n    ",652],"}",["T_WHITESPACE","\n\n    ",653],["T_DOC_COMMENT","\/**\n     * Return parent categories of category\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return \\Magento\\Framework\\DataObject[]\n     *\/",655],["T_WHITESPACE","\n    ",660],["T_PUBLIC","public",661],["T_WHITESPACE"," ",661],["T_FUNCTION","function",661],["T_WHITESPACE"," ",661],["T_STRING","getParentCategories",661],"(",["T_VARIABLE","$category",661],")",["T_WHITESPACE","\n    ",661],"{",["T_WHITESPACE","\n        ",662],["T_VARIABLE","$pathIds",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_STRING","array_reverse",663],"(",["T_STRING","explode",663],"(",["T_CONSTANT_ENCAPSED_STRING","','",663],",",["T_WHITESPACE"," ",663],["T_VARIABLE","$category",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","getPathInStore",663],"(",")",")",")",";",["T_WHITESPACE","\n        ",663],["T_DOC_COMMENT","\/** @var \\Magento\\Catalog\\Model\\ResourceModel\\Category\\Collection $categories *\/",664],["T_WHITESPACE","\n        ",664],["T_VARIABLE","$categories",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","_categoryCollectionFactory",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","create",665],"(",")",";",["T_WHITESPACE","\n        ",665],["T_RETURN","return",666],["T_WHITESPACE"," ",666],["T_VARIABLE","$categories",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","setStore",666],"(",["T_WHITESPACE","\n            ",666],["T_VARIABLE","$this",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","_storeManager",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","getStore",667],"(",")",["T_WHITESPACE","\n        ",667],")",["T_OBJECT_OPERATOR","->",668],["T_STRING","addAttributeToSelect",668],"(",["T_WHITESPACE","\n            ",668],["T_CONSTANT_ENCAPSED_STRING","'name'",669],["T_WHITESPACE","\n        ",669],")",["T_OBJECT_OPERATOR","->",670],["T_STRING","addAttributeToSelect",670],"(",["T_WHITESPACE","\n            ",670],["T_CONSTANT_ENCAPSED_STRING","'url_key'",671],["T_WHITESPACE","\n        ",671],")",["T_OBJECT_OPERATOR","->",672],["T_STRING","addFieldToFilter",672],"(",["T_WHITESPACE","\n            ",672],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",673],",",["T_WHITESPACE","\n            ",673],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",674],["T_WHITESPACE"," ",674],["T_DOUBLE_ARROW","=>",674],["T_WHITESPACE"," ",674],["T_VARIABLE","$pathIds",674],"]",["T_WHITESPACE","\n        ",674],")",["T_OBJECT_OPERATOR","->",675],["T_STRING","addFieldToFilter",675],"(",["T_WHITESPACE","\n            ",675],["T_CONSTANT_ENCAPSED_STRING","'is_active'",676],",",["T_WHITESPACE","\n            ",676],["T_LNUMBER","1",677],["T_WHITESPACE","\n        ",677],")",["T_OBJECT_OPERATOR","->",678],["T_STRING","load",678],"(",")",["T_OBJECT_OPERATOR","->",678],["T_STRING","getItems",678],"(",")",";",["T_WHITESPACE","\n    ",678],"}",["T_WHITESPACE","\n\n    ",679],["T_DOC_COMMENT","\/**\n     * Return parent category of current category with own custom design settings\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return \\Magento\\Catalog\\Model\\Category\n     *\/",681],["T_WHITESPACE","\n    ",686],["T_PUBLIC","public",687],["T_WHITESPACE"," ",687],["T_FUNCTION","function",687],["T_WHITESPACE"," ",687],["T_STRING","getParentDesignCategory",687],"(",["T_VARIABLE","$category",687],")",["T_WHITESPACE","\n    ",687],"{",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$pathIds",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_STRING","array_reverse",689],"(",["T_VARIABLE","$category",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","getPathIds",689],"(",")",")",";",["T_WHITESPACE","\n        ",689],["T_VARIABLE","$collection",690],["T_WHITESPACE"," ",690],"=",["T_WHITESPACE"," ",690],["T_VARIABLE","$category",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","getCollection",690],"(",")",["T_OBJECT_OPERATOR","->",690],["T_STRING","setStore",690],"(",["T_WHITESPACE","\n            ",690],["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","_storeManager",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","getStore",691],"(",")",["T_WHITESPACE","\n        ",691],")",["T_OBJECT_OPERATOR","->",692],["T_STRING","addAttributeToSelect",692],"(",["T_WHITESPACE","\n            ",692],["T_CONSTANT_ENCAPSED_STRING","'custom_design'",693],["T_WHITESPACE","\n        ",693],")",["T_OBJECT_OPERATOR","->",694],["T_STRING","addAttributeToSelect",694],"(",["T_WHITESPACE","\n            ",694],["T_CONSTANT_ENCAPSED_STRING","'custom_design_from'",695],["T_WHITESPACE","\n        ",695],")",["T_OBJECT_OPERATOR","->",696],["T_STRING","addAttributeToSelect",696],"(",["T_WHITESPACE","\n            ",696],["T_CONSTANT_ENCAPSED_STRING","'custom_design_to'",697],["T_WHITESPACE","\n        ",697],")",["T_OBJECT_OPERATOR","->",698],["T_STRING","addAttributeToSelect",698],"(",["T_WHITESPACE","\n            ",698],["T_CONSTANT_ENCAPSED_STRING","'page_layout'",699],["T_WHITESPACE","\n        ",699],")",["T_OBJECT_OPERATOR","->",700],["T_STRING","addAttributeToSelect",700],"(",["T_WHITESPACE","\n            ",700],["T_CONSTANT_ENCAPSED_STRING","'custom_layout_update'",701],["T_WHITESPACE","\n        ",701],")",["T_OBJECT_OPERATOR","->",702],["T_STRING","addAttributeToSelect",702],"(",["T_WHITESPACE","\n            ",702],["T_CONSTANT_ENCAPSED_STRING","'custom_apply_to_products'",703],["T_WHITESPACE","\n        ",703],")",["T_OBJECT_OPERATOR","->",704],["T_STRING","addFieldToFilter",704],"(",["T_WHITESPACE","\n            ",704],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",705],",",["T_WHITESPACE","\n            ",705],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",706],["T_WHITESPACE"," ",706],["T_DOUBLE_ARROW","=>",706],["T_WHITESPACE"," ",706],["T_VARIABLE","$pathIds",706],"]",["T_WHITESPACE","\n        ",706],")",["T_OBJECT_OPERATOR","->",707],["T_STRING","addAttributeToFilter",707],"(",["T_WHITESPACE","\n            ",707],["T_CONSTANT_ENCAPSED_STRING","'custom_use_parent_settings'",708],",",["T_WHITESPACE","\n            ",708],"[","[",["T_CONSTANT_ENCAPSED_STRING","'eq'",709],["T_WHITESPACE"," ",709],["T_DOUBLE_ARROW","=>",709],["T_WHITESPACE"," ",709],["T_LNUMBER","0",709],"]",",",["T_WHITESPACE"," ",709],"[",["T_CONSTANT_ENCAPSED_STRING","'null'",709],["T_WHITESPACE"," ",709],["T_DOUBLE_ARROW","=>",709],["T_WHITESPACE"," ",709],["T_LNUMBER","0",709],"]","]",",",["T_WHITESPACE","\n            ",709],["T_CONSTANT_ENCAPSED_STRING","'left'",710],["T_WHITESPACE","\n        ",710],")",["T_OBJECT_OPERATOR","->",711],["T_STRING","addFieldToFilter",711],"(",["T_WHITESPACE","\n            ",711],["T_CONSTANT_ENCAPSED_STRING","'level'",712],",",["T_WHITESPACE","\n            ",712],"[",["T_CONSTANT_ENCAPSED_STRING","'neq'",713],["T_WHITESPACE"," ",713],["T_DOUBLE_ARROW","=>",713],["T_WHITESPACE"," ",713],["T_LNUMBER","0",713],"]",["T_WHITESPACE","\n        ",713],")",["T_OBJECT_OPERATOR","->",714],["T_STRING","setOrder",714],"(",["T_WHITESPACE","\n            ",714],["T_CONSTANT_ENCAPSED_STRING","'level'",715],",",["T_WHITESPACE","\n            ",715],["T_CONSTANT_ENCAPSED_STRING","'DESC'",716],["T_WHITESPACE","\n        ",716],")",["T_OBJECT_OPERATOR","->",717],["T_STRING","load",717],"(",")",";",["T_WHITESPACE","\n        ",717],["T_RETURN","return",718],["T_WHITESPACE"," ",718],["T_VARIABLE","$collection",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getFirstItem",718],"(",")",";",["T_WHITESPACE","\n    ",718],"}",["T_WHITESPACE","\n\n    ",719],["T_DOC_COMMENT","\/**\n     * Return child categories\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Category\\Collection\n     *\/",721],["T_WHITESPACE","\n    ",726],["T_PUBLIC","public",727],["T_WHITESPACE"," ",727],["T_FUNCTION","function",727],["T_WHITESPACE"," ",727],["T_STRING","getChildrenCategories",727],"(",["T_VARIABLE","$category",727],")",["T_WHITESPACE","\n    ",727],"{",["T_WHITESPACE","\n        ",728],["T_VARIABLE","$collection",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_VARIABLE","$category",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","getCollection",729],"(",")",";",["T_WHITESPACE","\n        ",729],["T_COMMENT","\/* @var $collection \\Magento\\Catalog\\Model\\ResourceModel\\Category\\Collection *\/",730],["T_WHITESPACE","\n        ",730],["T_VARIABLE","$collection",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","addAttributeToSelect",731],"(",["T_WHITESPACE","\n            ",731],["T_CONSTANT_ENCAPSED_STRING","'url_key'",732],["T_WHITESPACE","\n        ",732],")",["T_OBJECT_OPERATOR","->",733],["T_STRING","addAttributeToSelect",733],"(",["T_WHITESPACE","\n            ",733],["T_CONSTANT_ENCAPSED_STRING","'name'",734],["T_WHITESPACE","\n        ",734],")",["T_OBJECT_OPERATOR","->",735],["T_STRING","addAttributeToSelect",735],"(",["T_WHITESPACE","\n            ",735],["T_CONSTANT_ENCAPSED_STRING","'all_children'",736],["T_WHITESPACE","\n        ",736],")",["T_OBJECT_OPERATOR","->",737],["T_STRING","addAttributeToSelect",737],"(",["T_WHITESPACE","\n            ",737],["T_CONSTANT_ENCAPSED_STRING","'is_anchor'",738],["T_WHITESPACE","\n        ",738],")",["T_OBJECT_OPERATOR","->",739],["T_STRING","addAttributeToFilter",739],"(",["T_WHITESPACE","\n            ",739],["T_CONSTANT_ENCAPSED_STRING","'is_active'",740],",",["T_WHITESPACE","\n            ",740],["T_LNUMBER","1",741],["T_WHITESPACE","\n        ",741],")",["T_OBJECT_OPERATOR","->",742],["T_STRING","addIdFilter",742],"(",["T_WHITESPACE","\n            ",742],["T_VARIABLE","$category",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","getChildren",743],"(",")",["T_WHITESPACE","\n        ",743],")",["T_OBJECT_OPERATOR","->",744],["T_STRING","setOrder",744],"(",["T_WHITESPACE","\n            ",744],["T_CONSTANT_ENCAPSED_STRING","'position'",745],",",["T_WHITESPACE","\n            ",745],["T_NS_SEPARATOR","\\",746],["T_STRING","Magento",746],["T_NS_SEPARATOR","\\",746],["T_STRING","Framework",746],["T_NS_SEPARATOR","\\",746],["T_STRING","DB",746],["T_NS_SEPARATOR","\\",746],["T_STRING","Select",746],["T_DOUBLE_COLON","::",746],["T_STRING","SQL_ASC",746],["T_WHITESPACE","\n        ",746],")",["T_OBJECT_OPERATOR","->",747],["T_STRING","joinUrlRewrite",747],"(",")",["T_OBJECT_OPERATOR","->",747],["T_STRING","load",747],"(",")",";",["T_WHITESPACE","\n\n        ",747],["T_RETURN","return",749],["T_WHITESPACE"," ",749],["T_VARIABLE","$collection",749],";",["T_WHITESPACE","\n    ",749],"}",["T_WHITESPACE","\n\n    ",750],["T_DOC_COMMENT","\/**\n     * Return children ids of category\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @param boolean $recursive\n     * @return array\n     *\/",752],["T_WHITESPACE","\n    ",758],["T_PUBLIC","public",759],["T_WHITESPACE"," ",759],["T_FUNCTION","function",759],["T_WHITESPACE"," ",759],["T_STRING","getChildren",759],"(",["T_VARIABLE","$category",759],",",["T_WHITESPACE"," ",759],["T_VARIABLE","$recursive",759],["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_STRING","true",759],")",["T_WHITESPACE","\n    ",759],"{",["T_WHITESPACE","\n        ",760],["T_VARIABLE","$linkField",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_VARIABLE","$this",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","getLinkField",761],"(",")",";",["T_WHITESPACE","\n        ",761],["T_VARIABLE","$attributeId",762],["T_WHITESPACE"," ",762],"=",["T_WHITESPACE"," ",762],["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","getIsActiveAttributeId",762],"(",")",";",["T_WHITESPACE","\n        ",762],["T_VARIABLE","$backendTable",763],["T_WHITESPACE"," ",763],"=",["T_WHITESPACE"," ",763],["T_VARIABLE","$this",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","getTable",763],"(","[",["T_VARIABLE","$this",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","getEntityTablePrefix",763],"(",")",",",["T_WHITESPACE"," ",763],["T_CONSTANT_ENCAPSED_STRING","'int'",763],"]",")",";",["T_WHITESPACE","\n        ",763],["T_VARIABLE","$connection",764],["T_WHITESPACE"," ",764],"=",["T_WHITESPACE"," ",764],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getConnection",764],"(",")",";",["T_WHITESPACE","\n        ",764],["T_VARIABLE","$checkSql",765],["T_WHITESPACE"," ",765],"=",["T_WHITESPACE"," ",765],["T_VARIABLE","$connection",765],["T_OBJECT_OPERATOR","->",765],["T_STRING","getCheckSql",765],"(",["T_CONSTANT_ENCAPSED_STRING","'c.value_id > 0'",765],",",["T_WHITESPACE"," ",765],["T_CONSTANT_ENCAPSED_STRING","'c.value'",765],",",["T_WHITESPACE"," ",765],["T_CONSTANT_ENCAPSED_STRING","'d.value'",765],")",";",["T_WHITESPACE","\n        ",765],["T_VARIABLE","$linkField",766],["T_WHITESPACE"," ",766],"=",["T_WHITESPACE"," ",766],["T_VARIABLE","$this",766],["T_OBJECT_OPERATOR","->",766],["T_STRING","getLinkField",766],"(",")",";",["T_WHITESPACE","\n        ",766],["T_VARIABLE","$bind",767],["T_WHITESPACE"," ",767],"=",["T_WHITESPACE"," ",767],"[",["T_WHITESPACE","\n            ",767],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",768],["T_WHITESPACE"," ",768],["T_DOUBLE_ARROW","=>",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$attributeId",768],",",["T_WHITESPACE","\n            ",768],["T_CONSTANT_ENCAPSED_STRING","'store_id'",769],["T_WHITESPACE"," ",769],["T_DOUBLE_ARROW","=>",769],["T_WHITESPACE"," ",769],["T_VARIABLE","$category",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","getStoreId",769],"(",")",",",["T_WHITESPACE","\n            ",769],["T_CONSTANT_ENCAPSED_STRING","'scope'",770],["T_WHITESPACE"," ",770],["T_DOUBLE_ARROW","=>",770],["T_WHITESPACE"," ",770],["T_LNUMBER","1",770],",",["T_WHITESPACE","\n            ",770],["T_CONSTANT_ENCAPSED_STRING","'c_path'",771],["T_WHITESPACE"," ",771],["T_DOUBLE_ARROW","=>",771],["T_WHITESPACE"," ",771],["T_VARIABLE","$category",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getPath",771],"(",")",["T_WHITESPACE"," ",771],".",["T_WHITESPACE"," ",771],["T_CONSTANT_ENCAPSED_STRING","'\/%'",771],",",["T_WHITESPACE","\n        ",771],"]",";",["T_WHITESPACE","\n        ",772],["T_VARIABLE","$select",773],["T_WHITESPACE"," ",773],"=",["T_WHITESPACE"," ",773],["T_VARIABLE","$this",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","getConnection",773],"(",")",["T_OBJECT_OPERATOR","->",773],["T_STRING","select",773],"(",")",["T_OBJECT_OPERATOR","->",773],["T_STRING","from",773],"(",["T_WHITESPACE","\n            ",773],"[",["T_CONSTANT_ENCAPSED_STRING","'m'",774],["T_WHITESPACE"," ",774],["T_DOUBLE_ARROW","=>",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$this",774],["T_OBJECT_OPERATOR","->",774],["T_STRING","getEntityTable",774],"(",")","]",",",["T_WHITESPACE","\n            ",774],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",775],["T_WHITESPACE","\n        ",775],")",["T_OBJECT_OPERATOR","->",776],["T_STRING","joinLeft",776],"(",["T_WHITESPACE","\n            ",776],"[",["T_CONSTANT_ENCAPSED_STRING","'d'",777],["T_WHITESPACE"," ",777],["T_DOUBLE_ARROW","=>",777],["T_WHITESPACE"," ",777],["T_VARIABLE","$backendTable",777],"]",",",["T_WHITESPACE","\n            ",777],"\"",["T_ENCAPSED_AND_WHITESPACE","d.attribute_id = :attribute_id AND d.store_id = 0 AND d.",778],["T_CURLY_OPEN","{",778],["T_VARIABLE","$linkField",778],"}",["T_ENCAPSED_AND_WHITESPACE"," = m.",778],["T_CURLY_OPEN","{",778],["T_VARIABLE","$linkField",778],"}","\"",",",["T_WHITESPACE","\n            ",778],"[","]",["T_WHITESPACE","\n        ",779],")",["T_OBJECT_OPERATOR","->",780],["T_STRING","joinLeft",780],"(",["T_WHITESPACE","\n            ",780],"[",["T_CONSTANT_ENCAPSED_STRING","'c'",781],["T_WHITESPACE"," ",781],["T_DOUBLE_ARROW","=>",781],["T_WHITESPACE"," ",781],["T_VARIABLE","$backendTable",781],"]",",",["T_WHITESPACE","\n            ",781],"\"",["T_ENCAPSED_AND_WHITESPACE","c.attribute_id = :attribute_id AND c.store_id = :store_id AND c.",782],["T_CURLY_OPEN","{",782],["T_VARIABLE","$linkField",782],"}",["T_ENCAPSED_AND_WHITESPACE"," = m.",782],["T_CURLY_OPEN","{",782],["T_VARIABLE","$linkField",782],"}","\"",",",["T_WHITESPACE","\n            ",782],"[","]",["T_WHITESPACE","\n        ",783],")",["T_OBJECT_OPERATOR","->",784],["T_STRING","where",784],"(",["T_WHITESPACE","\n            ",784],["T_VARIABLE","$checkSql",785],["T_WHITESPACE"," ",785],".",["T_WHITESPACE"," ",785],["T_CONSTANT_ENCAPSED_STRING","' = :scope'",785],["T_WHITESPACE","\n        ",785],")",["T_OBJECT_OPERATOR","->",786],["T_STRING","where",786],"(",["T_WHITESPACE","\n            ",786],["T_VARIABLE","$connection",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","quoteIdentifier",787],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",787],")",["T_WHITESPACE"," ",787],".",["T_WHITESPACE"," ",787],["T_CONSTANT_ENCAPSED_STRING","' LIKE :c_path'",787],["T_WHITESPACE","\n        ",787],")",";",["T_WHITESPACE","\n        ",788],["T_IF","if",789],["T_WHITESPACE"," ",789],"(","!",["T_VARIABLE","$recursive",789],")",["T_WHITESPACE"," ",789],"{",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$select",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","where",790],"(",["T_VARIABLE","$connection",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","quoteIdentifier",790],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",790],")",["T_WHITESPACE"," ",790],".",["T_WHITESPACE"," ",790],["T_CONSTANT_ENCAPSED_STRING","' <= :c_level'",790],")",";",["T_WHITESPACE","\n            ",790],["T_VARIABLE","$bind",791],"[",["T_CONSTANT_ENCAPSED_STRING","'c_level'",791],"]",["T_WHITESPACE"," ",791],"=",["T_WHITESPACE"," ",791],["T_VARIABLE","$category",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","getLevel",791],"(",")",["T_WHITESPACE"," ",791],"+",["T_WHITESPACE"," ",791],["T_LNUMBER","1",791],";",["T_WHITESPACE","\n        ",791],"}",["T_WHITESPACE","\n\n        ",792],["T_RETURN","return",794],["T_WHITESPACE"," ",794],["T_VARIABLE","$connection",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","fetchCol",794],"(",["T_VARIABLE","$select",794],",",["T_WHITESPACE"," ",794],["T_VARIABLE","$bind",794],")",";",["T_WHITESPACE","\n    ",794],"}",["T_WHITESPACE","\n\n    ",795],["T_DOC_COMMENT","\/**\n     * Return all children ids of category (with category id)\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return array\n     *\/",797],["T_WHITESPACE","\n    ",802],["T_PUBLIC","public",803],["T_WHITESPACE"," ",803],["T_FUNCTION","function",803],["T_WHITESPACE"," ",803],["T_STRING","getAllChildren",803],"(",["T_VARIABLE","$category",803],")",["T_WHITESPACE","\n    ",803],"{",["T_WHITESPACE","\n        ",804],["T_VARIABLE","$children",805],["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_VARIABLE","$this",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","getChildren",805],"(",["T_VARIABLE","$category",805],")",";",["T_WHITESPACE","\n        ",805],["T_VARIABLE","$myId",806],["T_WHITESPACE"," ",806],"=",["T_WHITESPACE"," ",806],"[",["T_VARIABLE","$category",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getId",806],"(",")","]",";",["T_WHITESPACE","\n        ",806],["T_VARIABLE","$children",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_STRING","array_merge",807],"(",["T_VARIABLE","$myId",807],",",["T_WHITESPACE"," ",807],["T_VARIABLE","$children",807],")",";",["T_WHITESPACE","\n\n        ",807],["T_RETURN","return",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$children",809],";",["T_WHITESPACE","\n    ",809],"}",["T_WHITESPACE","\n\n    ",810],["T_DOC_COMMENT","\/**\n     * Check is category in list of store categories\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @return boolean\n     *\/",812],["T_WHITESPACE","\n    ",817],["T_PUBLIC","public",818],["T_WHITESPACE"," ",818],["T_FUNCTION","function",818],["T_WHITESPACE"," ",818],["T_STRING","isInRootCategoryList",818],"(",["T_VARIABLE","$category",818],")",["T_WHITESPACE","\n    ",818],"{",["T_WHITESPACE","\n        ",819],["T_VARIABLE","$rootCategoryId",820],["T_WHITESPACE"," ",820],"=",["T_WHITESPACE"," ",820],["T_VARIABLE","$this",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","_storeManager",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","getStore",820],"(",")",["T_OBJECT_OPERATOR","->",820],["T_STRING","getRootCategoryId",820],"(",")",";",["T_WHITESPACE","\n\n        ",820],["T_RETURN","return",822],["T_WHITESPACE"," ",822],["T_STRING","in_array",822],"(",["T_VARIABLE","$rootCategoryId",822],",",["T_WHITESPACE"," ",822],["T_VARIABLE","$category",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","getParentIds",822],"(",")",")",";",["T_WHITESPACE","\n    ",822],"}",["T_WHITESPACE","\n\n    ",823],["T_DOC_COMMENT","\/**\n     * Check category is forbidden to delete.\n     * If category is root and assigned to store group return false\n     *\n     * @param integer $categoryId\n     * @return boolean\n     *\/",825],["T_WHITESPACE","\n    ",831],["T_PUBLIC","public",832],["T_WHITESPACE"," ",832],["T_FUNCTION","function",832],["T_WHITESPACE"," ",832],["T_STRING","isForbiddenToDelete",832],"(",["T_VARIABLE","$categoryId",832],")",["T_WHITESPACE","\n    ",832],"{",["T_WHITESPACE","\n        ",833],["T_VARIABLE","$select",834],["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_VARIABLE","$this",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","getConnection",834],"(",")",["T_OBJECT_OPERATOR","->",834],["T_STRING","select",834],"(",")",["T_OBJECT_OPERATOR","->",834],["T_STRING","from",834],"(",["T_WHITESPACE","\n            ",834],["T_VARIABLE","$this",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","getTable",835],"(",["T_CONSTANT_ENCAPSED_STRING","'store_group'",835],")",",",["T_WHITESPACE","\n            ",835],"[",["T_CONSTANT_ENCAPSED_STRING","'group_id'",836],"]",["T_WHITESPACE","\n        ",836],")",["T_OBJECT_OPERATOR","->",837],["T_STRING","where",837],"(",["T_WHITESPACE","\n            ",837],["T_CONSTANT_ENCAPSED_STRING","'root_category_id = :root_category_id'",838],["T_WHITESPACE","\n        ",838],")",";",["T_WHITESPACE","\n        ",839],["T_VARIABLE","$result",840],["T_WHITESPACE"," ",840],"=",["T_WHITESPACE"," ",840],["T_VARIABLE","$this",840],["T_OBJECT_OPERATOR","->",840],["T_STRING","getConnection",840],"(",")",["T_OBJECT_OPERATOR","->",840],["T_STRING","fetchOne",840],"(",["T_VARIABLE","$select",840],",",["T_WHITESPACE"," ",840],"[",["T_CONSTANT_ENCAPSED_STRING","'root_category_id'",840],["T_WHITESPACE"," ",840],["T_DOUBLE_ARROW","=>",840],["T_WHITESPACE"," ",840],["T_VARIABLE","$categoryId",840],"]",")",";",["T_WHITESPACE","\n\n        ",840],["T_IF","if",842],["T_WHITESPACE"," ",842],"(",["T_VARIABLE","$result",842],")",["T_WHITESPACE"," ",842],"{",["T_WHITESPACE","\n            ",842],["T_RETURN","return",843],["T_WHITESPACE"," ",843],["T_STRING","true",843],";",["T_WHITESPACE","\n        ",843],"}",["T_WHITESPACE","\n        ",844],["T_RETURN","return",845],["T_WHITESPACE"," ",845],["T_STRING","false",845],";",["T_WHITESPACE","\n    ",845],"}",["T_WHITESPACE","\n\n    ",846],["T_DOC_COMMENT","\/**\n     * Get category path value by its id\n     *\n     * @param int $categoryId\n     * @return string\n     *\/",848],["T_WHITESPACE","\n    ",853],["T_PUBLIC","public",854],["T_WHITESPACE"," ",854],["T_FUNCTION","function",854],["T_WHITESPACE"," ",854],["T_STRING","getCategoryPathById",854],"(",["T_VARIABLE","$categoryId",854],")",["T_WHITESPACE","\n    ",854],"{",["T_WHITESPACE","\n        ",855],["T_VARIABLE","$select",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_VARIABLE","$this",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","getConnection",856],"(",")",["T_OBJECT_OPERATOR","->",856],["T_STRING","select",856],"(",")",["T_OBJECT_OPERATOR","->",856],["T_STRING","from",856],"(",["T_WHITESPACE","\n            ",856],["T_VARIABLE","$this",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","getEntityTable",857],"(",")",",",["T_WHITESPACE","\n            ",857],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",858],"]",["T_WHITESPACE","\n        ",858],")",["T_OBJECT_OPERATOR","->",859],["T_STRING","where",859],"(",["T_WHITESPACE","\n            ",859],["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",860],["T_WHITESPACE","\n        ",860],")",";",["T_WHITESPACE","\n        ",861],["T_VARIABLE","$bind",862],["T_WHITESPACE"," ",862],"=",["T_WHITESPACE"," ",862],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",862],["T_WHITESPACE"," ",862],["T_DOUBLE_ARROW","=>",862],["T_WHITESPACE"," ",862],["T_INT_CAST","(int)",862],["T_VARIABLE","$categoryId",862],"]",";",["T_WHITESPACE","\n\n        ",862],["T_RETURN","return",864],["T_WHITESPACE"," ",864],["T_VARIABLE","$this",864],["T_OBJECT_OPERATOR","->",864],["T_STRING","getConnection",864],"(",")",["T_OBJECT_OPERATOR","->",864],["T_STRING","fetchOne",864],"(",["T_VARIABLE","$select",864],",",["T_WHITESPACE"," ",864],["T_VARIABLE","$bind",864],")",";",["T_WHITESPACE","\n    ",864],"}",["T_WHITESPACE","\n\n    ",865],["T_DOC_COMMENT","\/**\n     * Move category to another parent node\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @param \\Magento\\Catalog\\Model\\Category $newParent\n     * @param null|int $afterCategoryId\n     * @return $this\n     *\/",867],["T_WHITESPACE","\n    ",874],["T_PUBLIC","public",875],["T_WHITESPACE"," ",875],["T_FUNCTION","function",875],["T_WHITESPACE"," ",875],["T_STRING","changeParent",875],"(",["T_WHITESPACE","\n        ",875],["T_NS_SEPARATOR","\\",876],["T_STRING","Magento",876],["T_NS_SEPARATOR","\\",876],["T_STRING","Catalog",876],["T_NS_SEPARATOR","\\",876],["T_STRING","Model",876],["T_NS_SEPARATOR","\\",876],["T_STRING","Category",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$category",876],",",["T_WHITESPACE","\n        ",876],["T_NS_SEPARATOR","\\",877],["T_STRING","Magento",877],["T_NS_SEPARATOR","\\",877],["T_STRING","Catalog",877],["T_NS_SEPARATOR","\\",877],["T_STRING","Model",877],["T_NS_SEPARATOR","\\",877],["T_STRING","Category",877],["T_WHITESPACE"," ",877],["T_VARIABLE","$newParent",877],",",["T_WHITESPACE","\n        ",877],["T_VARIABLE","$afterCategoryId",878],["T_WHITESPACE"," ",878],"=",["T_WHITESPACE"," ",878],["T_STRING","null",878],["T_WHITESPACE","\n    ",878],")",["T_WHITESPACE"," ",879],"{",["T_WHITESPACE","\n        ",879],["T_VARIABLE","$childrenCount",880],["T_WHITESPACE"," ",880],"=",["T_WHITESPACE"," ",880],["T_VARIABLE","$this",880],["T_OBJECT_OPERATOR","->",880],["T_STRING","getChildrenCount",880],"(",["T_VARIABLE","$category",880],["T_OBJECT_OPERATOR","->",880],["T_STRING","getId",880],"(",")",")",["T_WHITESPACE"," ",880],"+",["T_WHITESPACE"," ",880],["T_LNUMBER","1",880],";",["T_WHITESPACE","\n        ",880],["T_VARIABLE","$table",881],["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_VARIABLE","$this",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getEntityTable",881],"(",")",";",["T_WHITESPACE","\n        ",881],["T_VARIABLE","$connection",882],["T_WHITESPACE"," ",882],"=",["T_WHITESPACE"," ",882],["T_VARIABLE","$this",882],["T_OBJECT_OPERATOR","->",882],["T_STRING","getConnection",882],"(",")",";",["T_WHITESPACE","\n        ",882],["T_VARIABLE","$levelFiled",883],["T_WHITESPACE"," ",883],"=",["T_WHITESPACE"," ",883],["T_VARIABLE","$connection",883],["T_OBJECT_OPERATOR","->",883],["T_STRING","quoteIdentifier",883],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",883],")",";",["T_WHITESPACE","\n        ",883],["T_VARIABLE","$pathField",884],["T_WHITESPACE"," ",884],"=",["T_WHITESPACE"," ",884],["T_VARIABLE","$connection",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","quoteIdentifier",884],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",884],")",";",["T_WHITESPACE","\n\n        ",884],["T_DOC_COMMENT","\/**\n         * Decrease children count for all old category parent categories\n         *\/",886],["T_WHITESPACE","\n        ",888],["T_VARIABLE","$connection",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","update",889],"(",["T_WHITESPACE","\n            ",889],["T_VARIABLE","$table",890],",",["T_WHITESPACE","\n            ",890],"[",["T_CONSTANT_ENCAPSED_STRING","'children_count'",891],["T_WHITESPACE"," ",891],["T_DOUBLE_ARROW","=>",891],["T_WHITESPACE"," ",891],["T_NEW","new",891],["T_WHITESPACE"," ",891],["T_NS_SEPARATOR","\\",891],["T_STRING","Zend_Db_Expr",891],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count - '",891],["T_WHITESPACE"," ",891],".",["T_WHITESPACE"," ",891],["T_VARIABLE","$childrenCount",891],")","]",",",["T_WHITESPACE","\n            ",891],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",892],["T_WHITESPACE"," ",892],["T_DOUBLE_ARROW","=>",892],["T_WHITESPACE"," ",892],["T_VARIABLE","$category",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","getParentIds",892],"(",")","]",["T_WHITESPACE","\n        ",892],")",";",["T_WHITESPACE","\n\n        ",893],["T_DOC_COMMENT","\/**\n         * Increase children count for new category parents\n         *\/",895],["T_WHITESPACE","\n        ",897],["T_VARIABLE","$connection",898],["T_OBJECT_OPERATOR","->",898],["T_STRING","update",898],"(",["T_WHITESPACE","\n            ",898],["T_VARIABLE","$table",899],",",["T_WHITESPACE","\n            ",899],"[",["T_CONSTANT_ENCAPSED_STRING","'children_count'",900],["T_WHITESPACE"," ",900],["T_DOUBLE_ARROW","=>",900],["T_WHITESPACE"," ",900],["T_NEW","new",900],["T_WHITESPACE"," ",900],["T_NS_SEPARATOR","\\",900],["T_STRING","Zend_Db_Expr",900],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count + '",900],["T_WHITESPACE"," ",900],".",["T_WHITESPACE"," ",900],["T_VARIABLE","$childrenCount",900],")","]",",",["T_WHITESPACE","\n            ",900],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",901],["T_WHITESPACE"," ",901],["T_DOUBLE_ARROW","=>",901],["T_WHITESPACE"," ",901],["T_VARIABLE","$newParent",901],["T_OBJECT_OPERATOR","->",901],["T_STRING","getPathIds",901],"(",")","]",["T_WHITESPACE","\n        ",901],")",";",["T_WHITESPACE","\n\n        ",902],["T_VARIABLE","$position",904],["T_WHITESPACE"," ",904],"=",["T_WHITESPACE"," ",904],["T_VARIABLE","$this",904],["T_OBJECT_OPERATOR","->",904],["T_STRING","_processPositions",904],"(",["T_VARIABLE","$category",904],",",["T_WHITESPACE"," ",904],["T_VARIABLE","$newParent",904],",",["T_WHITESPACE"," ",904],["T_VARIABLE","$afterCategoryId",904],")",";",["T_WHITESPACE","\n\n        ",904],["T_VARIABLE","$newPath",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_STRING","sprintf",906],"(",["T_CONSTANT_ENCAPSED_STRING","'%s\/%s'",906],",",["T_WHITESPACE"," ",906],["T_VARIABLE","$newParent",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","getPath",906],"(",")",",",["T_WHITESPACE"," ",906],["T_VARIABLE","$category",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","getId",906],"(",")",")",";",["T_WHITESPACE","\n        ",906],["T_VARIABLE","$newLevel",907],["T_WHITESPACE"," ",907],"=",["T_WHITESPACE"," ",907],["T_VARIABLE","$newParent",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","getLevel",907],"(",")",["T_WHITESPACE"," ",907],"+",["T_WHITESPACE"," ",907],["T_LNUMBER","1",907],";",["T_WHITESPACE","\n        ",907],["T_VARIABLE","$levelDisposition",908],["T_WHITESPACE"," ",908],"=",["T_WHITESPACE"," ",908],["T_VARIABLE","$newLevel",908],["T_WHITESPACE"," ",908],"-",["T_WHITESPACE"," ",908],["T_VARIABLE","$category",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getLevel",908],"(",")",";",["T_WHITESPACE","\n\n        ",908],["T_DOC_COMMENT","\/**\n         * Update children nodes path\n         *\/",910],["T_WHITESPACE","\n        ",912],["T_VARIABLE","$connection",913],["T_OBJECT_OPERATOR","->",913],["T_STRING","update",913],"(",["T_WHITESPACE","\n            ",913],["T_VARIABLE","$table",914],",",["T_WHITESPACE","\n            ",914],"[",["T_WHITESPACE","\n                ",915],["T_CONSTANT_ENCAPSED_STRING","'path'",916],["T_WHITESPACE"," ",916],["T_DOUBLE_ARROW","=>",916],["T_WHITESPACE"," ",916],["T_NEW","new",916],["T_WHITESPACE"," ",916],["T_NS_SEPARATOR","\\",916],["T_STRING","Zend_Db_Expr",916],"(",["T_WHITESPACE","\n                    ",916],["T_CONSTANT_ENCAPSED_STRING","'REPLACE('",917],["T_WHITESPACE"," ",917],".",["T_WHITESPACE"," ",917],["T_VARIABLE","$pathField",917],["T_WHITESPACE"," ",917],".",["T_WHITESPACE"," ",917],["T_CONSTANT_ENCAPSED_STRING","','",917],["T_WHITESPACE"," ",917],".",["T_WHITESPACE"," ",917],["T_VARIABLE","$connection",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","quote",917],"(",["T_WHITESPACE","\n                        ",917],["T_VARIABLE","$category",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","getPath",918],"(",")",["T_WHITESPACE"," ",918],".",["T_WHITESPACE"," ",918],["T_CONSTANT_ENCAPSED_STRING","'\/'",918],["T_WHITESPACE","\n                    ",918],")",["T_WHITESPACE"," ",919],".",["T_WHITESPACE"," ",919],["T_CONSTANT_ENCAPSED_STRING","', '",919],["T_WHITESPACE"," ",919],".",["T_WHITESPACE"," ",919],["T_VARIABLE","$connection",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","quote",919],"(",["T_WHITESPACE","\n                        ",919],["T_VARIABLE","$newPath",920],["T_WHITESPACE"," ",920],".",["T_WHITESPACE"," ",920],["T_CONSTANT_ENCAPSED_STRING","'\/'",920],["T_WHITESPACE","\n                    ",920],")",["T_WHITESPACE"," ",921],".",["T_WHITESPACE"," ",921],["T_CONSTANT_ENCAPSED_STRING","')'",921],["T_WHITESPACE","\n                ",921],")",",",["T_WHITESPACE","\n                ",922],["T_CONSTANT_ENCAPSED_STRING","'level'",923],["T_WHITESPACE"," ",923],["T_DOUBLE_ARROW","=>",923],["T_WHITESPACE"," ",923],["T_NEW","new",923],["T_WHITESPACE"," ",923],["T_NS_SEPARATOR","\\",923],["T_STRING","Zend_Db_Expr",923],"(",["T_VARIABLE","$levelFiled",923],["T_WHITESPACE"," ",923],".",["T_WHITESPACE"," ",923],["T_CONSTANT_ENCAPSED_STRING","' + '",923],["T_WHITESPACE"," ",923],".",["T_WHITESPACE"," ",923],["T_VARIABLE","$levelDisposition",923],")",["T_WHITESPACE","\n            ",923],"]",",",["T_WHITESPACE","\n            ",924],"[",["T_VARIABLE","$pathField",925],["T_WHITESPACE"," ",925],".",["T_WHITESPACE"," ",925],["T_CONSTANT_ENCAPSED_STRING","' LIKE ?'",925],["T_WHITESPACE"," ",925],["T_DOUBLE_ARROW","=>",925],["T_WHITESPACE"," ",925],["T_VARIABLE","$category",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","getPath",925],"(",")",["T_WHITESPACE"," ",925],".",["T_WHITESPACE"," ",925],["T_CONSTANT_ENCAPSED_STRING","'\/%'",925],"]",["T_WHITESPACE","\n        ",925],")",";",["T_WHITESPACE","\n        ",926],["T_DOC_COMMENT","\/**\n         * Update moved category data\n         *\/",927],["T_WHITESPACE","\n        ",929],["T_VARIABLE","$data",930],["T_WHITESPACE"," ",930],"=",["T_WHITESPACE"," ",930],"[",["T_WHITESPACE","\n            ",930],["T_CONSTANT_ENCAPSED_STRING","'path'",931],["T_WHITESPACE"," ",931],["T_DOUBLE_ARROW","=>",931],["T_WHITESPACE"," ",931],["T_VARIABLE","$newPath",931],",",["T_WHITESPACE","\n            ",931],["T_CONSTANT_ENCAPSED_STRING","'level'",932],["T_WHITESPACE"," ",932],["T_DOUBLE_ARROW","=>",932],["T_WHITESPACE"," ",932],["T_VARIABLE","$newLevel",932],",",["T_WHITESPACE","\n            ",932],["T_CONSTANT_ENCAPSED_STRING","'position'",933],["T_WHITESPACE"," ",933],["T_DOUBLE_ARROW","=>",933],["T_WHITESPACE"," ",933],["T_VARIABLE","$position",933],",",["T_WHITESPACE","\n            ",933],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",934],["T_WHITESPACE"," ",934],["T_DOUBLE_ARROW","=>",934],["T_WHITESPACE"," ",934],["T_VARIABLE","$newParent",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","getId",934],"(",")",",",["T_WHITESPACE","\n        ",934],"]",";",["T_WHITESPACE","\n        ",935],["T_VARIABLE","$connection",936],["T_OBJECT_OPERATOR","->",936],["T_STRING","update",936],"(",["T_VARIABLE","$table",936],",",["T_WHITESPACE"," ",936],["T_VARIABLE","$data",936],",",["T_WHITESPACE"," ",936],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",936],["T_WHITESPACE"," ",936],["T_DOUBLE_ARROW","=>",936],["T_WHITESPACE"," ",936],["T_VARIABLE","$category",936],["T_OBJECT_OPERATOR","->",936],["T_STRING","getId",936],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",936],["T_COMMENT","\/\/ Update category object to new data\n",938],["T_WHITESPACE","        ",939],["T_VARIABLE","$category",939],["T_OBJECT_OPERATOR","->",939],["T_STRING","addData",939],"(",["T_VARIABLE","$data",939],")",";",["T_WHITESPACE","\n        ",939],["T_VARIABLE","$category",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","unsetData",940],"(",["T_CONSTANT_ENCAPSED_STRING","'path_ids'",940],")",";",["T_WHITESPACE","\n\n        ",940],["T_RETURN","return",942],["T_WHITESPACE"," ",942],["T_VARIABLE","$this",942],";",["T_WHITESPACE","\n    ",942],"}",["T_WHITESPACE","\n\n    ",943],["T_DOC_COMMENT","\/**\n     * Process positions of old parent category children and new parent category children.\n     * Get position for moved category\n     *\n     * @param \\Magento\\Catalog\\Model\\Category $category\n     * @param \\Magento\\Catalog\\Model\\Category $newParent\n     * @param null|int $afterCategoryId\n     * @return int\n     *\/",945],["T_WHITESPACE","\n    ",953],["T_PROTECTED","protected",954],["T_WHITESPACE"," ",954],["T_FUNCTION","function",954],["T_WHITESPACE"," ",954],["T_STRING","_processPositions",954],"(",["T_VARIABLE","$category",954],",",["T_WHITESPACE"," ",954],["T_VARIABLE","$newParent",954],",",["T_WHITESPACE"," ",954],["T_VARIABLE","$afterCategoryId",954],")",["T_WHITESPACE","\n    ",954],"{",["T_WHITESPACE","\n        ",955],["T_VARIABLE","$table",956],["T_WHITESPACE"," ",956],"=",["T_WHITESPACE"," ",956],["T_VARIABLE","$this",956],["T_OBJECT_OPERATOR","->",956],["T_STRING","getEntityTable",956],"(",")",";",["T_WHITESPACE","\n        ",956],["T_VARIABLE","$connection",957],["T_WHITESPACE"," ",957],"=",["T_WHITESPACE"," ",957],["T_VARIABLE","$this",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getConnection",957],"(",")",";",["T_WHITESPACE","\n        ",957],["T_VARIABLE","$positionField",958],["T_WHITESPACE"," ",958],"=",["T_WHITESPACE"," ",958],["T_VARIABLE","$connection",958],["T_OBJECT_OPERATOR","->",958],["T_STRING","quoteIdentifier",958],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",958],")",";",["T_WHITESPACE","\n\n        ",958],["T_VARIABLE","$bind",960],["T_WHITESPACE"," ",960],"=",["T_WHITESPACE"," ",960],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",960],["T_WHITESPACE"," ",960],["T_DOUBLE_ARROW","=>",960],["T_WHITESPACE"," ",960],["T_NEW","new",960],["T_WHITESPACE"," ",960],["T_NS_SEPARATOR","\\",960],["T_STRING","Zend_Db_Expr",960],"(",["T_VARIABLE","$positionField",960],["T_WHITESPACE"," ",960],".",["T_WHITESPACE"," ",960],["T_CONSTANT_ENCAPSED_STRING","' - 1'",960],")","]",";",["T_WHITESPACE","\n        ",960],["T_VARIABLE","$where",961],["T_WHITESPACE"," ",961],"=",["T_WHITESPACE"," ",961],"[",["T_WHITESPACE","\n            ",961],["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",962],["T_WHITESPACE"," ",962],["T_DOUBLE_ARROW","=>",962],["T_WHITESPACE"," ",962],["T_VARIABLE","$category",962],["T_OBJECT_OPERATOR","->",962],["T_STRING","getParentId",962],"(",")",",",["T_WHITESPACE","\n            ",962],["T_VARIABLE","$positionField",963],["T_WHITESPACE"," ",963],".",["T_WHITESPACE"," ",963],["T_CONSTANT_ENCAPSED_STRING","' > ?'",963],["T_WHITESPACE"," ",963],["T_DOUBLE_ARROW","=>",963],["T_WHITESPACE"," ",963],["T_VARIABLE","$category",963],["T_OBJECT_OPERATOR","->",963],["T_STRING","getPosition",963],"(",")",",",["T_WHITESPACE","\n        ",963],"]",";",["T_WHITESPACE","\n        ",964],["T_VARIABLE","$connection",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","update",965],"(",["T_VARIABLE","$table",965],",",["T_WHITESPACE"," ",965],["T_VARIABLE","$bind",965],",",["T_WHITESPACE"," ",965],["T_VARIABLE","$where",965],")",";",["T_WHITESPACE","\n\n        ",965],["T_DOC_COMMENT","\/**\n         * Prepare position value\n         *\/",967],["T_WHITESPACE","\n        ",969],["T_IF","if",970],["T_WHITESPACE"," ",970],"(",["T_VARIABLE","$afterCategoryId",970],")",["T_WHITESPACE"," ",970],"{",["T_WHITESPACE","\n            ",970],["T_VARIABLE","$select",971],["T_WHITESPACE"," ",971],"=",["T_WHITESPACE"," ",971],["T_VARIABLE","$connection",971],["T_OBJECT_OPERATOR","->",971],["T_STRING","select",971],"(",")",["T_OBJECT_OPERATOR","->",971],["T_STRING","from",971],"(",["T_VARIABLE","$table",971],",",["T_WHITESPACE"," ",971],["T_CONSTANT_ENCAPSED_STRING","'position'",971],")",["T_OBJECT_OPERATOR","->",971],["T_STRING","where",971],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",971],")",";",["T_WHITESPACE","\n            ",971],["T_VARIABLE","$position",972],["T_WHITESPACE"," ",972],"=",["T_WHITESPACE"," ",972],["T_VARIABLE","$connection",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","fetchOne",972],"(",["T_VARIABLE","$select",972],",",["T_WHITESPACE"," ",972],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",972],["T_WHITESPACE"," ",972],["T_DOUBLE_ARROW","=>",972],["T_WHITESPACE"," ",972],["T_VARIABLE","$afterCategoryId",972],"]",")",";",["T_WHITESPACE","\n            ",972],["T_VARIABLE","$position",973],["T_WHITESPACE"," ",973],["T_PLUS_EQUAL","+=",973],["T_WHITESPACE"," ",973],["T_LNUMBER","1",973],";",["T_WHITESPACE","\n        ",973],"}",["T_WHITESPACE"," ",974],["T_ELSE","else",974],["T_WHITESPACE"," ",974],"{",["T_WHITESPACE","\n            ",974],["T_VARIABLE","$position",975],["T_WHITESPACE"," ",975],"=",["T_WHITESPACE"," ",975],["T_LNUMBER","1",975],";",["T_WHITESPACE","\n        ",975],"}",["T_WHITESPACE","\n\n        ",976],["T_VARIABLE","$bind",978],["T_WHITESPACE"," ",978],"=",["T_WHITESPACE"," ",978],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",978],["T_WHITESPACE"," ",978],["T_DOUBLE_ARROW","=>",978],["T_WHITESPACE"," ",978],["T_NEW","new",978],["T_WHITESPACE"," ",978],["T_NS_SEPARATOR","\\",978],["T_STRING","Zend_Db_Expr",978],"(",["T_VARIABLE","$positionField",978],["T_WHITESPACE"," ",978],".",["T_WHITESPACE"," ",978],["T_CONSTANT_ENCAPSED_STRING","' + 1'",978],")","]",";",["T_WHITESPACE","\n        ",978],["T_VARIABLE","$where",979],["T_WHITESPACE"," ",979],"=",["T_WHITESPACE"," ",979],"[",["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",979],["T_WHITESPACE"," ",979],["T_DOUBLE_ARROW","=>",979],["T_WHITESPACE"," ",979],["T_VARIABLE","$newParent",979],["T_OBJECT_OPERATOR","->",979],["T_STRING","getId",979],"(",")",",",["T_WHITESPACE"," ",979],["T_VARIABLE","$positionField",979],["T_WHITESPACE"," ",979],".",["T_WHITESPACE"," ",979],["T_CONSTANT_ENCAPSED_STRING","' >= ?'",979],["T_WHITESPACE"," ",979],["T_DOUBLE_ARROW","=>",979],["T_WHITESPACE"," ",979],["T_VARIABLE","$position",979],"]",";",["T_WHITESPACE","\n        ",979],["T_VARIABLE","$connection",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","update",980],"(",["T_VARIABLE","$table",980],",",["T_WHITESPACE"," ",980],["T_VARIABLE","$bind",980],",",["T_WHITESPACE"," ",980],["T_VARIABLE","$where",980],")",";",["T_WHITESPACE","\n\n        ",980],["T_RETURN","return",982],["T_WHITESPACE"," ",982],["T_VARIABLE","$position",982],";",["T_WHITESPACE","\n    ",982],"}",["T_WHITESPACE","\n\n    ",983],["T_DOC_COMMENT","\/**\n     * Get total number of persistent categories in the system, excluding the default category\n     *\n     * @return int\n     *\/",985],["T_WHITESPACE","\n    ",989],["T_PUBLIC","public",990],["T_WHITESPACE"," ",990],["T_FUNCTION","function",990],["T_WHITESPACE"," ",990],["T_STRING","countVisible",990],"(",")",["T_WHITESPACE","\n    ",990],"{",["T_WHITESPACE","\n        ",991],["T_VARIABLE","$connection",992],["T_WHITESPACE"," ",992],"=",["T_WHITESPACE"," ",992],["T_VARIABLE","$this",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","getConnection",992],"(",")",";",["T_WHITESPACE","\n        ",992],["T_VARIABLE","$select",993],["T_WHITESPACE"," ",993],"=",["T_WHITESPACE"," ",993],["T_VARIABLE","$connection",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","select",993],"(",")",";",["T_WHITESPACE","\n        ",993],["T_VARIABLE","$select",994],["T_OBJECT_OPERATOR","->",994],["T_STRING","from",994],"(",["T_VARIABLE","$this",994],["T_OBJECT_OPERATOR","->",994],["T_STRING","getEntityTable",994],"(",")",",",["T_WHITESPACE"," ",994],["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",994],")",["T_OBJECT_OPERATOR","->",994],["T_STRING","where",994],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id != ?'",994],",",["T_WHITESPACE"," ",994],["T_LNUMBER","0",994],")",";",["T_WHITESPACE","\n        ",994],["T_RETURN","return",995],["T_WHITESPACE"," ",995],["T_INT_CAST","(int)",995],["T_VARIABLE","$connection",995],["T_OBJECT_OPERATOR","->",995],["T_STRING","fetchOne",995],"(",["T_VARIABLE","$select",995],")",";",["T_WHITESPACE","\n    ",995],"}",["T_WHITESPACE","\n\n    ",996],["T_DOC_COMMENT","\/**\n     * Reset firstly loaded attributes\n     *\n     * @param \\Magento\\Framework\\DataObject $object\n     * @param integer $entityId\n     * @param array|null $attributes\n     * @return $this\n     *\/",998],["T_WHITESPACE","\n    ",1005],["T_PUBLIC","public",1006],["T_WHITESPACE"," ",1006],["T_FUNCTION","function",1006],["T_WHITESPACE"," ",1006],["T_STRING","load",1006],"(",["T_VARIABLE","$object",1006],",",["T_WHITESPACE"," ",1006],["T_VARIABLE","$entityId",1006],",",["T_WHITESPACE"," ",1006],["T_VARIABLE","$attributes",1006],["T_WHITESPACE"," ",1006],"=",["T_WHITESPACE"," ",1006],"[","]",")",["T_WHITESPACE","\n    ",1006],"{",["T_WHITESPACE","\n        ",1007],["T_VARIABLE","$this",1008],["T_OBJECT_OPERATOR","->",1008],["T_STRING","_attributes",1008],["T_WHITESPACE"," ",1008],"=",["T_WHITESPACE"," ",1008],"[","]",";",["T_WHITESPACE","\n        ",1008],["T_VARIABLE","$this",1009],["T_OBJECT_OPERATOR","->",1009],["T_STRING","loadAttributesMetadata",1009],"(",["T_VARIABLE","$attributes",1009],")",";",["T_WHITESPACE","\n        ",1009],["T_VARIABLE","$object",1010],["T_WHITESPACE"," ",1010],"=",["T_WHITESPACE"," ",1010],["T_VARIABLE","$this",1010],["T_OBJECT_OPERATOR","->",1010],["T_STRING","getEntityManager",1010],"(",")",["T_OBJECT_OPERATOR","->",1010],["T_STRING","load",1010],"(",["T_VARIABLE","$object",1010],",",["T_WHITESPACE"," ",1010],["T_VARIABLE","$entityId",1010],")",";",["T_WHITESPACE","\n        ",1010],["T_IF","if",1011],["T_WHITESPACE"," ",1011],"(","!",["T_VARIABLE","$this",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","getEntityManager",1011],"(",")",["T_OBJECT_OPERATOR","->",1011],["T_STRING","has",1011],"(",["T_VARIABLE","$object",1011],")",")",["T_WHITESPACE"," ",1011],"{",["T_WHITESPACE","\n            ",1011],["T_VARIABLE","$object",1012],["T_OBJECT_OPERATOR","->",1012],["T_STRING","isObjectNew",1012],"(",["T_STRING","true",1012],")",";",["T_WHITESPACE","\n        ",1012],"}",["T_WHITESPACE","\n        ",1013],["T_RETURN","return",1014],["T_WHITESPACE"," ",1014],["T_VARIABLE","$this",1014],";",["T_WHITESPACE","\n    ",1014],"}",["T_WHITESPACE","\n\n    ",1015],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",1017],["T_WHITESPACE","\n    ",1019],["T_PUBLIC","public",1020],["T_WHITESPACE"," ",1020],["T_FUNCTION","function",1020],["T_WHITESPACE"," ",1020],["T_STRING","delete",1020],"(",["T_VARIABLE","$object",1020],")",["T_WHITESPACE","\n    ",1020],"{",["T_WHITESPACE","\n        ",1021],["T_VARIABLE","$this",1022],["T_OBJECT_OPERATOR","->",1022],["T_STRING","getEntityManager",1022],"(",")",["T_OBJECT_OPERATOR","->",1022],["T_STRING","delete",1022],"(",["T_VARIABLE","$object",1022],")",";",["T_WHITESPACE","\n        ",1022],["T_VARIABLE","$this",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","_eventManager",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","dispatch",1023],"(",["T_WHITESPACE","\n            ",1023],["T_CONSTANT_ENCAPSED_STRING","'catalog_category_delete_after_done'",1024],",",["T_WHITESPACE","\n            ",1024],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",1025],["T_WHITESPACE"," ",1025],["T_DOUBLE_ARROW","=>",1025],["T_WHITESPACE"," ",1025],["T_VARIABLE","$object",1025],"]",["T_WHITESPACE","\n        ",1025],")",";",["T_WHITESPACE","\n        ",1026],["T_RETURN","return",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$this",1027],";",["T_WHITESPACE","\n    ",1027],"}",["T_WHITESPACE","\n\n    ",1028],["T_DOC_COMMENT","\/**\n     * Save entity's attributes into the object's resource\n     *\n     * @param  \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     * @throws \\Exception\n     *\/",1030],["T_WHITESPACE","\n    ",1036],["T_PUBLIC","public",1037],["T_WHITESPACE"," ",1037],["T_FUNCTION","function",1037],["T_WHITESPACE"," ",1037],["T_STRING","save",1037],"(",["T_NS_SEPARATOR","\\",1037],["T_STRING","Magento",1037],["T_NS_SEPARATOR","\\",1037],["T_STRING","Framework",1037],["T_NS_SEPARATOR","\\",1037],["T_STRING","Model",1037],["T_NS_SEPARATOR","\\",1037],["T_STRING","AbstractModel",1037],["T_WHITESPACE"," ",1037],["T_VARIABLE","$object",1037],")",["T_WHITESPACE","\n    ",1037],"{",["T_WHITESPACE","\n        ",1038],["T_VARIABLE","$this",1039],["T_OBJECT_OPERATOR","->",1039],["T_STRING","getEntityManager",1039],"(",")",["T_OBJECT_OPERATOR","->",1039],["T_STRING","save",1039],"(",["T_VARIABLE","$object",1039],")",";",["T_WHITESPACE","\n        ",1039],["T_RETURN","return",1040],["T_WHITESPACE"," ",1040],["T_VARIABLE","$this",1040],";",["T_WHITESPACE","\n    ",1040],"}",["T_WHITESPACE","\n\n    ",1041],["T_DOC_COMMENT","\/**\n     * @return EntityManager\n     *\/",1043],["T_WHITESPACE","\n    ",1045],["T_PRIVATE","private",1046],["T_WHITESPACE"," ",1046],["T_FUNCTION","function",1046],["T_WHITESPACE"," ",1046],["T_STRING","getEntityManager",1046],"(",")",["T_WHITESPACE","\n    ",1046],"{",["T_WHITESPACE","\n        ",1047],["T_IF","if",1048],["T_WHITESPACE"," ",1048],"(",["T_STRING","null",1048],["T_WHITESPACE"," ",1048],["T_IS_IDENTICAL","===",1048],["T_WHITESPACE"," ",1048],["T_VARIABLE","$this",1048],["T_OBJECT_OPERATOR","->",1048],["T_STRING","entityManager",1048],")",["T_WHITESPACE"," ",1048],"{",["T_WHITESPACE","\n            ",1048],["T_VARIABLE","$this",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","entityManager",1049],["T_WHITESPACE"," ",1049],"=",["T_WHITESPACE"," ",1049],["T_NS_SEPARATOR","\\",1049],["T_STRING","Magento",1049],["T_NS_SEPARATOR","\\",1049],["T_STRING","Framework",1049],["T_NS_SEPARATOR","\\",1049],["T_STRING","App",1049],["T_NS_SEPARATOR","\\",1049],["T_STRING","ObjectManager",1049],["T_DOUBLE_COLON","::",1049],["T_STRING","getInstance",1049],"(",")",["T_WHITESPACE","\n                ",1049],["T_OBJECT_OPERATOR","->",1050],["T_STRING","get",1050],"(",["T_NS_SEPARATOR","\\",1050],["T_STRING","Magento",1050],["T_NS_SEPARATOR","\\",1050],["T_STRING","Framework",1050],["T_NS_SEPARATOR","\\",1050],["T_STRING","EntityManager",1050],["T_NS_SEPARATOR","\\",1050],["T_STRING","EntityManager",1050],["T_DOUBLE_COLON","::",1050],["T_CLASS","class",1050],")",";",["T_WHITESPACE","\n        ",1050],"}",["T_WHITESPACE","\n        ",1051],["T_RETURN","return",1052],["T_WHITESPACE"," ",1052],["T_VARIABLE","$this",1052],["T_OBJECT_OPERATOR","->",1052],["T_STRING","entityManager",1052],";",["T_WHITESPACE","\n    ",1052],"}",["T_WHITESPACE","\n\n    ",1053],["T_DOC_COMMENT","\/**\n     * @return Category\\AggregateCount\n     *\/",1055],["T_WHITESPACE","\n    ",1057],["T_PRIVATE","private",1058],["T_WHITESPACE"," ",1058],["T_FUNCTION","function",1058],["T_WHITESPACE"," ",1058],["T_STRING","getAggregateCount",1058],"(",")",["T_WHITESPACE","\n    ",1058],"{",["T_WHITESPACE","\n        ",1059],["T_IF","if",1060],["T_WHITESPACE"," ",1060],"(",["T_STRING","null",1060],["T_WHITESPACE"," ",1060],["T_IS_IDENTICAL","===",1060],["T_WHITESPACE"," ",1060],["T_VARIABLE","$this",1060],["T_OBJECT_OPERATOR","->",1060],["T_STRING","aggregateCount",1060],")",["T_WHITESPACE"," ",1060],"{",["T_WHITESPACE","\n            ",1060],["T_VARIABLE","$this",1061],["T_OBJECT_OPERATOR","->",1061],["T_STRING","aggregateCount",1061],["T_WHITESPACE"," ",1061],"=",["T_WHITESPACE"," ",1061],["T_NS_SEPARATOR","\\",1061],["T_STRING","Magento",1061],["T_NS_SEPARATOR","\\",1061],["T_STRING","Framework",1061],["T_NS_SEPARATOR","\\",1061],["T_STRING","App",1061],["T_NS_SEPARATOR","\\",1061],["T_STRING","ObjectManager",1061],["T_DOUBLE_COLON","::",1061],["T_STRING","getInstance",1061],"(",")",["T_WHITESPACE","\n                ",1061],["T_OBJECT_OPERATOR","->",1062],["T_STRING","get",1062],"(",["T_NS_SEPARATOR","\\",1062],["T_STRING","Magento",1062],["T_NS_SEPARATOR","\\",1062],["T_STRING","Catalog",1062],["T_NS_SEPARATOR","\\",1062],["T_STRING","Model",1062],["T_NS_SEPARATOR","\\",1062],["T_STRING","ResourceModel",1062],["T_NS_SEPARATOR","\\",1062],["T_STRING","Category",1062],["T_NS_SEPARATOR","\\",1062],["T_STRING","AggregateCount",1062],["T_DOUBLE_COLON","::",1062],["T_CLASS","class",1062],")",";",["T_WHITESPACE","\n        ",1062],"}",["T_WHITESPACE","\n        ",1063],["T_RETURN","return",1064],["T_WHITESPACE"," ",1064],["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","aggregateCount",1064],";",["T_WHITESPACE","\n    ",1064],"}",["T_WHITESPACE","\n",1065],"}",["T_WHITESPACE","\n",1066]]