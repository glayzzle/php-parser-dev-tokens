[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Catalog",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Eav",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Product",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Attribute",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Source",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Status",8],["T_WHITESPACE"," ",8],["T_AS","as",8],["T_WHITESPACE"," ",8],["T_STRING","ProductStatus",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Catalog",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ProductInterface",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Catalog Product Eav Select and Multiply Select Attributes Indexer resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",11],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","Source",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","AbstractEav",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * Catalog resource helper\n     *\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Helper\n     *\/",18],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_resourceHelper",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Construct\n     *\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Indexer\\Table\\StrategyInterface $tableStrategy\n     * @param \\Magento\\Eav\\Model\\Config $eavConfig\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Helper $resourceHelper\n     * @param string $connectionName\n     *\/",25],["T_WHITESPACE","\n    ",34],["T_PUBLIC","public",35],["T_WHITESPACE"," ",35],["T_FUNCTION","function",35],["T_WHITESPACE"," ",35],["T_STRING","__construct",35],"(",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Framework",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","ResourceModel",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Db",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Context",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$context",36],",",["T_WHITESPACE","\n        ",36],["T_NS_SEPARATOR","\\",37],["T_STRING","Magento",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Framework",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Indexer",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Table",37],["T_NS_SEPARATOR","\\",37],["T_STRING","StrategyInterface",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$tableStrategy",37],",",["T_WHITESPACE","\n        ",37],["T_NS_SEPARATOR","\\",38],["T_STRING","Magento",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Eav",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Model",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Config",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$eavConfig",38],",",["T_WHITESPACE","\n        ",38],["T_NS_SEPARATOR","\\",39],["T_STRING","Magento",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Framework",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Event",39],["T_NS_SEPARATOR","\\",39],["T_STRING","ManagerInterface",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$eventManager",39],",",["T_WHITESPACE","\n        ",39],["T_NS_SEPARATOR","\\",40],["T_STRING","Magento",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Catalog",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Model",40],["T_NS_SEPARATOR","\\",40],["T_STRING","ResourceModel",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Helper",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$resourceHelper",40],",",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$connectionName",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","null",41],["T_WHITESPACE","\n    ",41],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_resourceHelper",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$resourceHelper",43],";",["T_WHITESPACE","\n        ",43],["T_STRING","parent",44],["T_DOUBLE_COLON","::",44],["T_STRING","__construct",44],"(",["T_VARIABLE","$context",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$tableStrategy",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$eavConfig",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$eventManager",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$connectionName",44],")",";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Initialize connection and define main index table\n     *\n     * @return void\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","_construct",52],"(",")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_init",54],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_eav'",54],",",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",54],")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Retrieve indexable eav attribute ids\n     *\n     * @param bool $multiSelect\n     * @return array\n     *\/",57],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","_getIndexableAttributes",63],"(",["T_VARIABLE","$multiSelect",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$select",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getConnection",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","select",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","from",65],"(",["T_WHITESPACE","\n            ",65],"[",["T_CONSTANT_ENCAPSED_STRING","'ca'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getTable",66],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_eav_attribute'",66],")","]",",",["T_WHITESPACE","\n            ",66],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",67],["T_WHITESPACE","\n        ",67],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","join",68],"(",["T_WHITESPACE","\n            ",68],"[",["T_CONSTANT_ENCAPSED_STRING","'ea'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getTable",69],"(",["T_CONSTANT_ENCAPSED_STRING","'eav_attribute'",69],")","]",",",["T_WHITESPACE","\n            ",69],["T_CONSTANT_ENCAPSED_STRING","'ca.attribute_id = ea.attribute_id'",70],",",["T_WHITESPACE","\n            ",70],"[","]",["T_WHITESPACE","\n        ",71],")",["T_OBJECT_OPERATOR","->",72],["T_STRING","where",72],"(",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getIndexableAttributesCondition",73],"(",")",["T_WHITESPACE","\n        ",73],")",";",["T_WHITESPACE","\n\n        ",74],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$multiSelect",76],["T_WHITESPACE"," ",76],["T_IS_EQUAL","==",76],["T_WHITESPACE"," ",76],["T_STRING","true",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$select",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","where",77],"(",["T_CONSTANT_ENCAPSED_STRING","'ea.backend_type = ?'",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'varchar'",77],")",["T_OBJECT_OPERATOR","->",77],["T_STRING","where",77],"(",["T_CONSTANT_ENCAPSED_STRING","'ea.frontend_input = ?'",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'multiselect'",77],")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE"," ",78],["T_ELSE","else",78],["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$select",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","where",79],"(",["T_CONSTANT_ENCAPSED_STRING","'ea.backend_type = ?'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'int'",79],")",["T_OBJECT_OPERATOR","->",79],["T_STRING","where",79],"(",["T_CONSTANT_ENCAPSED_STRING","'ea.frontend_input = ?'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'select'",79],")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n\n        ",80],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getConnection",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","fetchCol",82],"(",["T_VARIABLE","$select",82],")",";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Prepare data index for indexable attributes\n     *\n     * @param array $entityIds the entity ids limitation\n     * @param int $attributeId the attribute id limitation\n     * @return $this\n     *\/",85],["T_WHITESPACE","\n    ",91],["T_PROTECTED","protected",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","_prepareIndex",92],"(",["T_VARIABLE","$entityIds",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","null",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$attributeId",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","null",92],")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_prepareSelectIndex",94],"(",["T_VARIABLE","$entityIds",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$attributeId",94],")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_prepareMultiselectIndex",95],"(",["T_VARIABLE","$entityIds",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$attributeId",95],")",";",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Prepare data index for indexable select attributes\n     *\n     * @param array $entityIds the entity ids limitation\n     * @param int $attributeId the attribute id limitation\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",100],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","_prepareSelectIndex",108],"(",["T_VARIABLE","$entityIds",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","null",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$attributeId",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","null",108],")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$connection",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getConnection",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$idxTable",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getIdxTable",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_COMMENT","\/\/ prepare select attributes\n",112],["T_WHITESPACE","        ",113],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$attributeId",113],["T_WHITESPACE"," ",113],["T_IS_IDENTICAL","===",113],["T_WHITESPACE"," ",113],["T_STRING","null",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$attrIds",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_getIndexableAttributes",114],"(",["T_STRING","false",114],")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE"," ",115],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$attrIds",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],"[",["T_VARIABLE","$attributeId",116],"]",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n\n        ",117],["T_IF","if",119],["T_WHITESPACE"," ",119],"(","!",["T_VARIABLE","$attrIds",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n        ",120],"}",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$productIdField",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getMetadataPool",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getMetadata",122],"(",["T_STRING","ProductInterface",122],["T_DOUBLE_COLON","::",122],["T_CLASS","class",122],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getLinkField",122],"(",")",";",["T_WHITESPACE","\n\n        ",122],["T_COMMENT","\/**@var $subSelect \\Magento\\Framework\\DB\\Select*\/",124],["T_WHITESPACE","\n        ",124],["T_VARIABLE","$subSelect",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$connection",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","select",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","from",125],"(",["T_WHITESPACE","\n            ",125],"[",["T_CONSTANT_ENCAPSED_STRING","'s'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getTable",126],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",126],")","]",",",["T_WHITESPACE","\n            ",126],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'website_id'",127],"]",["T_WHITESPACE","\n        ",127],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","joinLeft",128],"(",["T_WHITESPACE","\n            ",128],"[",["T_CONSTANT_ENCAPSED_STRING","'dd'",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getTable",129],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_int'",129],")","]",",",["T_WHITESPACE","\n            ",129],["T_CONSTANT_ENCAPSED_STRING","'dd.store_id = 0'",130],",",["T_WHITESPACE","\n            ",130],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",131],"]",["T_WHITESPACE","\n        ",131],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","joinLeft",132],"(",["T_WHITESPACE","\n            ",132],"[",["T_CONSTANT_ENCAPSED_STRING","'ds'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getTable",133],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_int'",133],")","]",",",["T_WHITESPACE","\n            ",133],["T_CONSTANT_ENCAPSED_STRING","\"ds.store_id = s.store_id AND ds.attribute_id = dd.attribute_id AND \"",134],["T_WHITESPACE"," ",134],".",["T_WHITESPACE","\n            ",134],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.",135],["T_CURLY_OPEN","{",135],["T_VARIABLE","$productIdField",135],"}",["T_ENCAPSED_AND_WHITESPACE"," = dd.",135],["T_CURLY_OPEN","{",135],["T_VARIABLE","$productIdField",135],"}","\"",",",["T_WHITESPACE","\n            ",135],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE","  ",136],["T_NEW","new",136],["T_WHITESPACE"," ",136],["T_NS_SEPARATOR","\\",136],["T_STRING","Zend_Db_Expr",136],"(",["T_CONSTANT_ENCAPSED_STRING","'COALESCE(ds.value, dd.value)'",136],")","]",["T_WHITESPACE","\n        ",136],")",["T_OBJECT_OPERATOR","->",137],["T_STRING","joinLeft",137],"(",["T_WHITESPACE","\n            ",137],"[",["T_CONSTANT_ENCAPSED_STRING","'d2d'",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getTable",138],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_int'",138],")","]",",",["T_WHITESPACE","\n            ",138],["T_STRING","sprintf",139],"(",["T_WHITESPACE","\n                ",139],"\"",["T_ENCAPSED_AND_WHITESPACE","d2d.store_id = 0 AND d2d.",140],["T_CURLY_OPEN","{",140],["T_VARIABLE","$productIdField",140],"}",["T_ENCAPSED_AND_WHITESPACE"," = dd.",140],["T_CURLY_OPEN","{",140],["T_VARIABLE","$productIdField",140],"}",["T_ENCAPSED_AND_WHITESPACE"," AND d2d.attribute_id = %s",140],"\"",",",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_eavConfig",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getAttribute",141],"(",["T_NS_SEPARATOR","\\",141],["T_STRING","Magento",141],["T_NS_SEPARATOR","\\",141],["T_STRING","Catalog",141],["T_NS_SEPARATOR","\\",141],["T_STRING","Model",141],["T_NS_SEPARATOR","\\",141],["T_STRING","Product",141],["T_DOUBLE_COLON","::",141],["T_STRING","ENTITY",141],",",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'status'",141],")",["T_OBJECT_OPERATOR","->",141],["T_STRING","getId",141],"(",")",["T_WHITESPACE","\n            ",141],")",",",["T_WHITESPACE","\n            ",142],"[","]",["T_WHITESPACE","\n        ",143],")",["T_OBJECT_OPERATOR","->",144],["T_STRING","joinLeft",144],"(",["T_WHITESPACE","\n            ",144],"[",["T_CONSTANT_ENCAPSED_STRING","'d2s'",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getTable",145],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_int'",145],")","]",",",["T_WHITESPACE","\n            ",145],["T_CONSTANT_ENCAPSED_STRING","\"d2s.store_id = s.store_id AND d2s.attribute_id = d2d.attribute_id AND \"",146],["T_WHITESPACE"," ",146],".",["T_WHITESPACE","\n            ",146],"\"",["T_ENCAPSED_AND_WHITESPACE","d2s.",147],["T_CURLY_OPEN","{",147],["T_VARIABLE","$productIdField",147],"}",["T_ENCAPSED_AND_WHITESPACE"," = d2d.",147],["T_CURLY_OPEN","{",147],["T_VARIABLE","$productIdField",147],"}","\"",",",["T_WHITESPACE","\n            ",147],"[","]",["T_WHITESPACE","\n        ",148],")",["T_OBJECT_OPERATOR","->",149],["T_STRING","joinLeft",149],"(",["T_WHITESPACE","\n            ",149],"[",["T_CONSTANT_ENCAPSED_STRING","'cpe'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getTable",150],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",150],")","]",",",["T_WHITESPACE","\n            ",150],"\"",["T_ENCAPSED_AND_WHITESPACE","cpe.",151],["T_CURLY_OPEN","{",151],["T_VARIABLE","$productIdField",151],"}",["T_ENCAPSED_AND_WHITESPACE"," = dd.",151],["T_CURLY_OPEN","{",151],["T_VARIABLE","$productIdField",151],"}","\"",",",["T_WHITESPACE","\n            ",151],["T_STRING","array_unique",152],"(","[",["T_VARIABLE","$productIdField",152],",",["T_WHITESPACE"," ",152],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",152],"]",")",["T_WHITESPACE","\n        ",152],")",["T_OBJECT_OPERATOR","->",153],["T_STRING","where",153],"(",["T_WHITESPACE","\n            ",153],["T_CONSTANT_ENCAPSED_STRING","'s.store_id != 0'",154],["T_WHITESPACE","\n        ",154],")",["T_OBJECT_OPERATOR","->",155],["T_STRING","where",155],"(",["T_WHITESPACE","\n            ",155],["T_CONSTANT_ENCAPSED_STRING","'(ds.value IS NOT NULL OR dd.value IS NOT NULL)'",156],["T_WHITESPACE","\n        ",156],")",["T_OBJECT_OPERATOR","->",157],["T_STRING","where",157],"(",["T_WHITESPACE","\n            ",157],"(",["T_NEW","new",158],["T_WHITESPACE"," ",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Zend_Db_Expr",158],"(",["T_CONSTANT_ENCAPSED_STRING","'COALESCE(d2s.value, d2d.value)'",158],")",")",["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","' = '",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_STRING","ProductStatus",158],["T_DOUBLE_COLON","::",158],["T_STRING","STATUS_ENABLED",158],["T_WHITESPACE","\n        ",158],")",["T_OBJECT_OPERATOR","->",159],["T_STRING","distinct",159],"(",["T_STRING","true",159],")",";",["T_WHITESPACE","\n\n        ",159],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$entityIds",161],["T_WHITESPACE"," ",161],["T_IS_NOT_IDENTICAL","!==",161],["T_WHITESPACE"," ",161],["T_STRING","null",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$subSelect",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","where",162],"(",["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id IN(?)'",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$entityIds",162],")",";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n\n        ",163],["T_VARIABLE","$ifNullSql",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$connection",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getIfNullSql",165],"(",["T_CONSTANT_ENCAPSED_STRING","'pis.value'",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'pid.value'",165],")",";",["T_WHITESPACE","\n        ",165],["T_COMMENT","\/**@var $select \\Magento\\Framework\\DB\\Select*\/",166],["T_WHITESPACE","\n        ",166],["T_VARIABLE","$select",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$connection",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","select",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","distinct",167],"(",["T_STRING","true",167],")",["T_OBJECT_OPERATOR","->",167],["T_STRING","from",167],"(",["T_WHITESPACE","\n            ",167],"[",["T_CONSTANT_ENCAPSED_STRING","'pid'",168],["T_WHITESPACE"," ",168],["T_DOUBLE_ARROW","=>",168],["T_WHITESPACE"," ",168],["T_NEW","new",168],["T_WHITESPACE"," ",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Zend_Db_Expr",168],"(",["T_STRING","sprintf",168],"(",["T_CONSTANT_ENCAPSED_STRING","'(%s)'",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$subSelect",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","assemble",168],"(",")",")",")","]",",",["T_WHITESPACE","\n            ",168],"[","]",["T_WHITESPACE","\n        ",169],")",["T_OBJECT_OPERATOR","->",170],["T_STRING","joinLeft",170],"(",["T_WHITESPACE","\n            ",170],"[",["T_CONSTANT_ENCAPSED_STRING","'pis'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getTable",171],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_int'",171],")","]",",",["T_WHITESPACE","\n            ",171],"\"",["T_ENCAPSED_AND_WHITESPACE","pis.",172],["T_CURLY_OPEN","{",172],["T_VARIABLE","$productIdField",172],"}",["T_ENCAPSED_AND_WHITESPACE"," = pid.",172],["T_CURLY_OPEN","{",172],["T_VARIABLE","$productIdField",172],"}","\"",["T_WHITESPACE","\n            ",172],".",["T_CONSTANT_ENCAPSED_STRING","' AND pis.attribute_id = pid.attribute_id AND pis.store_id = pid.store_id'",173],",",["T_WHITESPACE","\n            ",173],"[","]",["T_WHITESPACE","\n        ",174],")",["T_OBJECT_OPERATOR","->",175],["T_STRING","columns",175],"(",["T_WHITESPACE","\n            ",175],"[",["T_WHITESPACE","\n                ",176],["T_CONSTANT_ENCAPSED_STRING","'pid.entity_id'",177],",",["T_WHITESPACE","\n                ",177],["T_CONSTANT_ENCAPSED_STRING","'pid.attribute_id'",178],",",["T_WHITESPACE","\n                ",178],["T_CONSTANT_ENCAPSED_STRING","'pid.store_id'",179],",",["T_WHITESPACE","\n                ",179],["T_CONSTANT_ENCAPSED_STRING","'value'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$ifNullSql",180],",",["T_WHITESPACE","\n                ",180],["T_CONSTANT_ENCAPSED_STRING","'pid.entity_id'",181],",",["T_WHITESPACE","\n            ",181],"]",["T_WHITESPACE","\n        ",182],")",["T_OBJECT_OPERATOR","->",183],["T_STRING","where",183],"(",["T_WHITESPACE","\n            ",183],["T_CONSTANT_ENCAPSED_STRING","'pid.attribute_id IN(?)'",184],",",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$attrIds",185],["T_WHITESPACE","\n        ",185],")",";",["T_WHITESPACE","\n\n        ",186],["T_VARIABLE","$select",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","where",188],"(",["T_VARIABLE","$ifNullSql",188],["T_WHITESPACE"," ",188],".",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_DOC_COMMENT","\/**\n         * Exclude attribute values that contains NULL\n         *\/",190],["T_WHITESPACE","\n        ",192],["T_VARIABLE","$select",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","where",193],"(",["T_CONSTANT_ENCAPSED_STRING","'NOT(pis.value IS NULL AND pis.value_id IS NOT NULL)'",193],")",";",["T_WHITESPACE","\n\n        ",193],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",195],["T_WHITESPACE","\n        ",197],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_eventManager",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","dispatch",198],"(",["T_WHITESPACE","\n            ",198],["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_index_select'",199],",",["T_WHITESPACE","\n            ",199],"[",["T_WHITESPACE","\n                ",200],["T_CONSTANT_ENCAPSED_STRING","'select'",201],["T_WHITESPACE"," ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$select",201],",",["T_WHITESPACE","\n                ",201],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",202],["T_WHITESPACE"," ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_NEW","new",202],["T_WHITESPACE"," ",202],["T_NS_SEPARATOR","\\",202],["T_STRING","Zend_Db_Expr",202],"(",["T_CONSTANT_ENCAPSED_STRING","'pid.entity_id'",202],")",",",["T_WHITESPACE","\n                ",202],["T_CONSTANT_ENCAPSED_STRING","'website_field'",203],["T_WHITESPACE"," ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_NEW","new",203],["T_WHITESPACE"," ",203],["T_NS_SEPARATOR","\\",203],["T_STRING","Zend_Db_Expr",203],"(",["T_CONSTANT_ENCAPSED_STRING","'pid.website_id'",203],")",",",["T_WHITESPACE","\n                ",203],["T_CONSTANT_ENCAPSED_STRING","'store_field'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_NEW","new",204],["T_WHITESPACE"," ",204],["T_NS_SEPARATOR","\\",204],["T_STRING","Zend_Db_Expr",204],"(",["T_CONSTANT_ENCAPSED_STRING","'pid.store_id'",204],")",",",["T_WHITESPACE","\n            ",204],"]",["T_WHITESPACE","\n        ",205],")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$query",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$select",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","insertFromSelect",207],"(",["T_VARIABLE","$idxTable",207],")",";",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$connection",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","query",208],"(",["T_VARIABLE","$query",208],")",";",["T_WHITESPACE","\n\n        ",208],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Prepare data index for indexable multiply select attributes\n     *\n     * @param array $entityIds the entity ids limitation\n     * @param int $attributeId the attribute id limitation\n     * @return $this\n     *\/",213],["T_WHITESPACE","\n    ",219],["T_PROTECTED","protected",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","_prepareMultiselectIndex",220],"(",["T_VARIABLE","$entityIds",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","null",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$attributeId",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","null",220],")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$connection",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getConnection",222],"(",")",";",["T_WHITESPACE","\n\n        ",222],["T_COMMENT","\/\/ prepare multiselect attributes\n",224],["T_WHITESPACE","        ",225],["T_VARIABLE","$attrIds",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$attributeId",225],["T_WHITESPACE"," ",225],["T_IS_IDENTICAL","===",225],["T_WHITESPACE"," ",225],["T_STRING","null",225],["T_WHITESPACE"," ",225],"?",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_getIndexableAttributes",225],"(",["T_STRING","true",225],")",["T_WHITESPACE"," ",225],":",["T_WHITESPACE"," ",225],"[",["T_VARIABLE","$attributeId",225],"]",";",["T_WHITESPACE","\n\n        ",225],["T_IF","if",227],["T_WHITESPACE"," ",227],"(","!",["T_VARIABLE","$attrIds",227],")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$productIdField",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getMetadataPool",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getMetadata",230],"(",["T_STRING","ProductInterface",230],["T_DOUBLE_COLON","::",230],["T_CLASS","class",230],")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getLinkField",230],"(",")",";",["T_WHITESPACE","\n\n        ",230],["T_COMMENT","\/\/ load attribute options\n",232],["T_WHITESPACE","        ",233],["T_VARIABLE","$options",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],"[","]",";",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$select",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$connection",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","select",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","from",234],"(",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getTable",235],"(",["T_CONSTANT_ENCAPSED_STRING","'eav_attribute_option'",235],")",",",["T_WHITESPACE","\n            ",235],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",236],",",["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'option_id'",236],"]",["T_WHITESPACE","\n        ",236],")",["T_OBJECT_OPERATOR","->",237],["T_STRING","where",237],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id IN(?)'",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$attrIds",237],")",";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$query",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$select",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","query",238],"(",")",";",["T_WHITESPACE","\n        ",238],["T_WHILE","while",239],["T_WHITESPACE"," ",239],"(",["T_VARIABLE","$row",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$query",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","fetch",239],"(",")",")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$options",240],"[",["T_VARIABLE","$row",240],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",240],"]","]","[",["T_VARIABLE","$row",240],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",240],"]","]",["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","true",240],";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_COMMENT","\/\/ prepare get multiselect values query\n",243],["T_WHITESPACE","        ",244],["T_VARIABLE","$productValueExpression",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$connection",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getCheckSql",244],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.value_id > 0'",244],",",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'pvs.value'",244],",",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'pvd.value'",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$select",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$connection",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","select",245],"(",")",["T_OBJECT_OPERATOR","->",245],["T_STRING","from",245],"(",["T_WHITESPACE","\n            ",245],"[",["T_CONSTANT_ENCAPSED_STRING","'pvd'",246],["T_WHITESPACE"," ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getTable",246],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_varchar'",246],")","]",",",["T_WHITESPACE","\n            ",246],"[","]",["T_WHITESPACE","\n        ",247],")",["T_OBJECT_OPERATOR","->",248],["T_STRING","join",248],"(",["T_WHITESPACE","\n            ",248],"[",["T_CONSTANT_ENCAPSED_STRING","'cs'",249],["T_WHITESPACE"," ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getTable",249],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",249],")","]",",",["T_WHITESPACE","\n            ",249],["T_CONSTANT_ENCAPSED_STRING","''",250],",",["T_WHITESPACE","\n            ",250],"[","]",["T_WHITESPACE","\n        ",251],")",["T_OBJECT_OPERATOR","->",252],["T_STRING","joinLeft",252],"(",["T_WHITESPACE","\n            ",252],"[",["T_CONSTANT_ENCAPSED_STRING","'pvs'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getTable",253],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_varchar'",253],")","]",",",["T_WHITESPACE","\n            ",253],"\"",["T_ENCAPSED_AND_WHITESPACE","pvs.",254],["T_CURLY_OPEN","{",254],["T_VARIABLE","$productIdField",254],"}",["T_ENCAPSED_AND_WHITESPACE"," = pvd.",254],["T_CURLY_OPEN","{",254],["T_VARIABLE","$productIdField",254],"}",["T_ENCAPSED_AND_WHITESPACE"," AND pvs.attribute_id = pvd.attribute_id",254],"\"",["T_WHITESPACE","\n            ",254],".",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","' AND pvs.store_id=cs.store_id'",255],",",["T_WHITESPACE","\n            ",255],"[","]",["T_WHITESPACE","\n        ",256],")",["T_OBJECT_OPERATOR","->",257],["T_STRING","joinLeft",257],"(",["T_WHITESPACE","\n            ",257],"[",["T_CONSTANT_ENCAPSED_STRING","'cpe'",258],["T_WHITESPACE"," ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getTable",258],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",258],")","]",",",["T_WHITESPACE","\n            ",258],"\"",["T_ENCAPSED_AND_WHITESPACE","cpe.",259],["T_CURLY_OPEN","{",259],["T_VARIABLE","$productIdField",259],"}",["T_ENCAPSED_AND_WHITESPACE"," = pvd.",259],["T_CURLY_OPEN","{",259],["T_VARIABLE","$productIdField",259],"}","\"",",",["T_WHITESPACE","\n            ",259],"[","]",["T_WHITESPACE","\n        ",260],")",["T_OBJECT_OPERATOR","->",261],["T_STRING","where",261],"(",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'pvd.store_id=?'",262],",",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$connection",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getIfNullSql",263],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.store_id'",263],",",["T_WHITESPACE"," ",263],["T_NS_SEPARATOR","\\",263],["T_STRING","Magento",263],["T_NS_SEPARATOR","\\",263],["T_STRING","Store",263],["T_NS_SEPARATOR","\\",263],["T_STRING","Model",263],["T_NS_SEPARATOR","\\",263],["T_STRING","Store",263],["T_DOUBLE_COLON","::",263],["T_STRING","DEFAULT_STORE_ID",263],")",["T_WHITESPACE","\n        ",263],")",["T_OBJECT_OPERATOR","->",264],["T_STRING","where",264],"(",["T_WHITESPACE","\n            ",264],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id!=?'",265],",",["T_WHITESPACE","\n            ",265],["T_NS_SEPARATOR","\\",266],["T_STRING","Magento",266],["T_NS_SEPARATOR","\\",266],["T_STRING","Store",266],["T_NS_SEPARATOR","\\",266],["T_STRING","Model",266],["T_NS_SEPARATOR","\\",266],["T_STRING","Store",266],["T_DOUBLE_COLON","::",266],["T_STRING","DEFAULT_STORE_ID",266],["T_WHITESPACE","\n        ",266],")",["T_OBJECT_OPERATOR","->",267],["T_STRING","where",267],"(",["T_WHITESPACE","\n            ",267],["T_CONSTANT_ENCAPSED_STRING","'pvd.attribute_id IN(?)'",268],",",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$attrIds",269],["T_WHITESPACE","\n        ",269],")",["T_OBJECT_OPERATOR","->",270],["T_STRING","where",270],"(",["T_WHITESPACE","\n            ",270],["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id IS NOT NULL'",271],["T_WHITESPACE","\n        ",271],")",["T_OBJECT_OPERATOR","->",272],["T_STRING","columns",272],"(",["T_WHITESPACE","\n            ",272],"[",["T_WHITESPACE","\n                ",273],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",274],["T_WHITESPACE"," ",274],["T_DOUBLE_ARROW","=>",274],["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id'",274],",",["T_WHITESPACE","\n                ",274],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",275],",",["T_WHITESPACE","\n                ",275],["T_CONSTANT_ENCAPSED_STRING","'store_id'",276],["T_WHITESPACE"," ",276],["T_DOUBLE_ARROW","=>",276],["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",276],",",["T_WHITESPACE","\n                ",276],["T_CONSTANT_ENCAPSED_STRING","'value'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$productValueExpression",277],",",["T_WHITESPACE","\n                ",277],["T_CONSTANT_ENCAPSED_STRING","'source_id'",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id'",278],",",["T_WHITESPACE","\n            ",278],"]",["T_WHITESPACE","\n        ",279],")",";",["T_WHITESPACE","\n\n        ",280],["T_VARIABLE","$statusCond",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$connection",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","quoteInto",282],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",282],",",["T_WHITESPACE"," ",282],["T_STRING","ProductStatus",282],["T_DOUBLE_COLON","::",282],["T_STRING","STATUS_ENABLED",282],")",";",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_addAttributeToSelect",283],"(",["T_VARIABLE","$select",283],",",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'status'",283],",",["T_WHITESPACE"," ",283],"\"",["T_ENCAPSED_AND_WHITESPACE","pvd.",283],["T_CURLY_OPEN","{",283],["T_VARIABLE","$productIdField",283],"}","\"",",",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$statusCond",283],")",";",["T_WHITESPACE","\n\n        ",283],["T_IF","if",285],["T_WHITESPACE"," ",285],"(",["T_VARIABLE","$entityIds",285],["T_WHITESPACE"," ",285],["T_IS_NOT_IDENTICAL","!==",285],["T_WHITESPACE"," ",285],["T_STRING","null",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n            ",285],["T_VARIABLE","$select",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","where",286],"(",["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id IN(?)'",286],",",["T_WHITESPACE"," ",286],["T_VARIABLE","$entityIds",286],")",";",["T_WHITESPACE","\n        ",286],"}",["T_WHITESPACE","\n        ",287],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",288],["T_WHITESPACE","\n        ",290],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_eventManager",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","dispatch",291],"(",["T_WHITESPACE","\n            ",291],["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_index_select'",292],",",["T_WHITESPACE","\n            ",292],"[",["T_WHITESPACE","\n                ",293],["T_CONSTANT_ENCAPSED_STRING","'select'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$select",294],",",["T_WHITESPACE","\n                ",294],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",295],["T_WHITESPACE"," ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_NEW","new",295],["T_WHITESPACE"," ",295],["T_NS_SEPARATOR","\\",295],["T_STRING","Zend_Db_Expr",295],"(",["T_CONSTANT_ENCAPSED_STRING","'cpe.entity_id'",295],")",",",["T_WHITESPACE","\n                ",295],["T_CONSTANT_ENCAPSED_STRING","'website_field'",296],["T_WHITESPACE"," ",296],["T_DOUBLE_ARROW","=>",296],["T_WHITESPACE"," ",296],["T_NEW","new",296],["T_WHITESPACE"," ",296],["T_NS_SEPARATOR","\\",296],["T_STRING","Zend_Db_Expr",296],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.website_id'",296],")",",",["T_WHITESPACE","\n                ",296],["T_CONSTANT_ENCAPSED_STRING","'store_field'",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_NEW","new",297],["T_WHITESPACE"," ",297],["T_NS_SEPARATOR","\\",297],["T_STRING","Zend_Db_Expr",297],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",297],")",",",["T_WHITESPACE","\n            ",297],"]",["T_WHITESPACE","\n        ",298],")",";",["T_WHITESPACE","\n\n        ",299],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","saveDataFromSelect",301],"(",["T_VARIABLE","$select",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$options",301],")",";",["T_WHITESPACE","\n\n        ",301],["T_RETURN","return",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n\n    ",304],["T_DOC_COMMENT","\/**\n     * Save a data to temporary source index table\n     *\n     * @param array $data\n     * @return $this\n     *\/",306],["T_WHITESPACE","\n    ",311],["T_PROTECTED","protected",312],["T_WHITESPACE"," ",312],["T_FUNCTION","function",312],["T_WHITESPACE"," ",312],["T_STRING","_saveIndexData",312],"(",["T_ARRAY","array",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$data",312],")",["T_WHITESPACE","\n    ",312],"{",["T_WHITESPACE","\n        ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(","!",["T_VARIABLE","$data",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_RETURN","return",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],";",["T_WHITESPACE","\n        ",315],"}",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$connection",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getConnection",317],"(",")",";",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$connection",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","insertArray",318],"(",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getIdxTable",319],"(",")",",",["T_WHITESPACE","\n            ",319],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",320],",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",320],",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'store_id'",320],",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'value'",320],",",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'source_id'",320],"]",",",["T_WHITESPACE","\n            ",320],["T_VARIABLE","$data",321],["T_WHITESPACE","\n        ",321],")",";",["T_WHITESPACE","\n        ",322],["T_RETURN","return",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],";",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n\n    ",324],["T_DOC_COMMENT","\/**\n     * Retrieve temporary source index table name\n     *\n     * @param string|null $table\n     * @return string\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",326],["T_WHITESPACE","\n    ",332],["T_PUBLIC","public",333],["T_WHITESPACE"," ",333],["T_FUNCTION","function",333],["T_WHITESPACE"," ",333],["T_STRING","getIdxTable",333],"(",["T_VARIABLE","$table",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_STRING","null",333],")",["T_WHITESPACE","\n    ",333],"{",["T_WHITESPACE","\n        ",334],["T_RETURN","return",335],["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","tableStrategy",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getTableName",335],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_eav'",335],")",";",["T_WHITESPACE","\n    ",335],"}",["T_WHITESPACE","\n\n    ",336],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\DB\\Select $select\n     * @param array $options\n     * @return void\n     *\/",338],["T_WHITESPACE","\n    ",342],["T_PRIVATE","private",343],["T_WHITESPACE"," ",343],["T_FUNCTION","function",343],["T_WHITESPACE"," ",343],["T_STRING","saveDataFromSelect",343],"(",["T_NS_SEPARATOR","\\",343],["T_STRING","Magento",343],["T_NS_SEPARATOR","\\",343],["T_STRING","Framework",343],["T_NS_SEPARATOR","\\",343],["T_STRING","DB",343],["T_NS_SEPARATOR","\\",343],["T_STRING","Select",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$select",343],",",["T_WHITESPACE"," ",343],["T_ARRAY","array",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$options",343],")",["T_WHITESPACE","\n    ",343],"{",["T_WHITESPACE","\n        ",344],["T_VARIABLE","$i",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_LNUMBER","0",345],";",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$data",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],"[","]",";",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$query",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$select",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","query",347],"(",")",";",["T_WHITESPACE","\n        ",347],["T_WHILE","while",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$row",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$query",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","fetch",348],"(",")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$values",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","explode",349],"(",["T_CONSTANT_ENCAPSED_STRING","','",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$row",349],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",349],"]",")",";",["T_WHITESPACE","\n            ",349],["T_FOREACH","foreach",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$values",350],["T_WHITESPACE"," ",350],["T_AS","as",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$valueId",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                ",350],["T_IF","if",351],["T_WHITESPACE"," ",351],"(",["T_ISSET","isset",351],"(",["T_VARIABLE","$options",351],"[",["T_VARIABLE","$row",351],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",351],"]","]","[",["T_VARIABLE","$valueId",351],"]",")",")",["T_WHITESPACE"," ",351],"{",["T_WHITESPACE","\n                    ",351],["T_VARIABLE","$data",352],"[","]",["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],"[",["T_VARIABLE","$row",352],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",352],"]",",",["T_WHITESPACE"," ",352],["T_VARIABLE","$row",352],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",352],"]",",",["T_WHITESPACE"," ",352],["T_VARIABLE","$row",352],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",352],"]",",",["T_WHITESPACE"," ",352],["T_VARIABLE","$valueId",352],",",["T_WHITESPACE"," ",352],["T_VARIABLE","$row",352],"[",["T_CONSTANT_ENCAPSED_STRING","'source_id'",352],"]","]",";",["T_WHITESPACE","\n                    ",352],["T_VARIABLE","$i",353],["T_INC","++",353],";",["T_WHITESPACE","\n                    ",353],["T_IF","if",354],["T_WHITESPACE"," ",354],"(",["T_VARIABLE","$i",354],["T_WHITESPACE"," ",354],"%",["T_WHITESPACE"," ",354],["T_LNUMBER","10000",354],["T_WHITESPACE"," ",354],["T_IS_EQUAL","==",354],["T_WHITESPACE"," ",354],["T_LNUMBER","0",354],")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n                        ",354],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_saveIndexData",355],"(",["T_VARIABLE","$data",355],")",";",["T_WHITESPACE","\n                        ",355],["T_VARIABLE","$data",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],"[","]",";",["T_WHITESPACE","\n                    ",356],"}",["T_WHITESPACE","\n                ",357],"}",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_saveIndexData",362],"(",["T_VARIABLE","$data",362],")",";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n",363],"}",["T_WHITESPACE","\n",364]]