[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SalesRule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Rule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Action",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Discount",6],";",["T_WHITESPACE","\n\n",6],["T_CLASS","class",8],["T_WHITESPACE"," ",8],["T_STRING","CartFixed",8],["T_WHITESPACE"," ",8],["T_EXTENDS","extends",8],["T_WHITESPACE"," ",8],["T_STRING","AbstractDiscount",8],["T_WHITESPACE","\n",8],"{",["T_WHITESPACE","\n    ",9],["T_DOC_COMMENT","\/**\n     * Store information about addresses which cart fixed rule applied for\n     *\n     * @var int[]\n     *\/",10],["T_WHITESPACE","\n    ",14],["T_PROTECTED","protected",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$_cartFixedRuleUsedForAddress",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],"[","]",";",["T_WHITESPACE","\n\n    ",15],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param float $qty\n     * @return \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data\n     *\/",17],["T_WHITESPACE","\n    ",22],["T_PUBLIC","public",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","calculate",23],"(",["T_VARIABLE","$rule",23],",",["T_WHITESPACE"," ",23],["T_VARIABLE","$item",23],",",["T_WHITESPACE"," ",23],["T_VARIABLE","$qty",23],")",["T_WHITESPACE","\n    ",23],"{",["T_WHITESPACE","\n        ",24],["T_DOC_COMMENT","\/** @var \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data $discountData *\/",25],["T_WHITESPACE","\n        ",25],["T_VARIABLE","$discountData",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","discountFactory",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","create",26],"(",")",";",["T_WHITESPACE","\n\n        ",26],["T_VARIABLE","$ruleTotals",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","validator",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","getRuleItemTotalsInfo",28],"(",["T_VARIABLE","$rule",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","getId",28],"(",")",")",";",["T_WHITESPACE","\n\n        ",28],["T_VARIABLE","$quote",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$item",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","getQuote",30],"(",")",";",["T_WHITESPACE","\n        ",30],["T_VARIABLE","$address",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$item",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","getAddress",31],"(",")",";",["T_WHITESPACE","\n\n        ",31],["T_VARIABLE","$itemPrice",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","validator",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getItemPrice",33],"(",["T_VARIABLE","$item",33],")",";",["T_WHITESPACE","\n        ",33],["T_VARIABLE","$baseItemPrice",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","validator",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","getItemBasePrice",34],"(",["T_VARIABLE","$item",34],")",";",["T_WHITESPACE","\n        ",34],["T_VARIABLE","$itemOriginalPrice",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","validator",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getItemOriginalPrice",35],"(",["T_VARIABLE","$item",35],")",";",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$baseItemOriginalPrice",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","validator",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getItemBaseOriginalPrice",36],"(",["T_VARIABLE","$item",36],")",";",["T_WHITESPACE","\n\n        ",36],["T_DOC_COMMENT","\/**\n         * prevent applying whole cart discount for every shipping order, but only for first order\n         *\/",38],["T_WHITESPACE","\n        ",40],["T_IF","if",41],["T_WHITESPACE"," ",41],"(",["T_VARIABLE","$quote",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getIsMultiShipping",41],"(",")",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n            ",41],["T_VARIABLE","$usedForAddressId",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","getCartFixedRuleUsedForAddress",42],"(",["T_VARIABLE","$rule",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","getId",42],"(",")",")",";",["T_WHITESPACE","\n            ",42],["T_IF","if",43],["T_WHITESPACE"," ",43],"(",["T_VARIABLE","$usedForAddressId",43],["T_WHITESPACE"," ",43],["T_BOOLEAN_AND","&&",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$usedForAddressId",43],["T_WHITESPACE"," ",43],["T_IS_NOT_EQUAL","!=",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$address",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getId",43],"(",")",")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n                ",43],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$discountData",44],";",["T_WHITESPACE","\n            ",44],"}",["T_WHITESPACE"," ",45],["T_ELSE","else",45],["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n                ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","setCartFixedRuleUsedForAddress",46],"(",["T_VARIABLE","$rule",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getId",46],"(",")",",",["T_WHITESPACE"," ",46],["T_VARIABLE","$address",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getId",46],"(",")",")",";",["T_WHITESPACE","\n            ",46],"}",["T_WHITESPACE","\n        ",47],"}",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$cartRules",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$address",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getCartFixedRules",49],"(",")",";",["T_WHITESPACE","\n        ",49],["T_IF","if",50],["T_WHITESPACE"," ",50],"(","!",["T_ISSET","isset",50],"(",["T_VARIABLE","$cartRules",50],"[",["T_VARIABLE","$rule",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getId",50],"(",")","]",")",")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$cartRules",51],"[",["T_VARIABLE","$rule",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getId",51],"(",")","]",["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$rule",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getDiscountAmount",51],"(",")",";",["T_WHITESPACE","\n        ",51],"}",["T_WHITESPACE","\n\n        ",52],["T_IF","if",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$cartRules",54],"[",["T_VARIABLE","$rule",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getId",54],"(",")","]",["T_WHITESPACE"," ",54],">",["T_WHITESPACE"," ",54],["T_LNUMBER","0",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_VARIABLE","$store",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$quote",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getStore",55],"(",")",";",["T_WHITESPACE","\n            ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$ruleTotals",56],"[",["T_CONSTANT_ENCAPSED_STRING","'items_count'",56],"]",["T_WHITESPACE"," ",56],["T_IS_SMALLER_OR_EQUAL","<=",56],["T_WHITESPACE"," ",56],["T_LNUMBER","1",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n                ",56],["T_VARIABLE","$quoteAmount",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","priceCurrency",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","convert",57],"(",["T_VARIABLE","$cartRules",57],"[",["T_VARIABLE","$rule",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getId",57],"(",")","]",",",["T_WHITESPACE"," ",57],["T_VARIABLE","$store",57],")",";",["T_WHITESPACE","\n                ",57],["T_VARIABLE","$baseDiscountAmount",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","min",58],"(",["T_VARIABLE","$baseItemPrice",58],["T_WHITESPACE"," ",58],"*",["T_WHITESPACE"," ",58],["T_VARIABLE","$qty",58],",",["T_WHITESPACE"," ",58],["T_VARIABLE","$cartRules",58],"[",["T_VARIABLE","$rule",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getId",58],"(",")","]",")",";",["T_WHITESPACE","\n            ",58],"}",["T_WHITESPACE"," ",59],["T_ELSE","else",59],["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n                ",59],["T_VARIABLE","$discountRate",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$baseItemPrice",60],["T_WHITESPACE"," ",60],"*",["T_WHITESPACE"," ",60],["T_VARIABLE","$qty",60],["T_WHITESPACE"," ",60],"\/",["T_WHITESPACE"," ",60],["T_VARIABLE","$ruleTotals",60],"[",["T_CONSTANT_ENCAPSED_STRING","'base_items_price'",60],"]",";",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$maximumItemDiscount",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$rule",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getDiscountAmount",61],"(",")",["T_WHITESPACE"," ",61],"*",["T_WHITESPACE"," ",61],["T_VARIABLE","$discountRate",61],";",["T_WHITESPACE","\n                ",61],["T_VARIABLE","$quoteAmount",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","priceCurrency",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","convert",62],"(",["T_VARIABLE","$maximumItemDiscount",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$store",62],")",";",["T_WHITESPACE","\n\n                ",62],["T_VARIABLE","$baseDiscountAmount",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","min",64],"(",["T_VARIABLE","$baseItemPrice",64],["T_WHITESPACE"," ",64],"*",["T_WHITESPACE"," ",64],["T_VARIABLE","$qty",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$maximumItemDiscount",64],")",";",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","validator",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","decrementRuleItemTotalsCount",65],"(",["T_VARIABLE","$rule",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getId",65],"(",")",")",";",["T_WHITESPACE","\n            ",65],"}",["T_WHITESPACE","\n\n            ",66],["T_VARIABLE","$baseDiscountAmount",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","priceCurrency",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","round",68],"(",["T_VARIABLE","$baseDiscountAmount",68],")",";",["T_WHITESPACE","\n\n            ",68],["T_VARIABLE","$cartRules",70],"[",["T_VARIABLE","$rule",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getId",70],"(",")","]",["T_WHITESPACE"," ",70],["T_MINUS_EQUAL","-=",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$baseDiscountAmount",70],";",["T_WHITESPACE","\n\n            ",70],["T_VARIABLE","$discountData",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","setAmount",72],"(",["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","priceCurrency",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","round",72],"(",["T_STRING","min",72],"(",["T_VARIABLE","$itemPrice",72],["T_WHITESPACE"," ",72],"*",["T_WHITESPACE"," ",72],["T_VARIABLE","$qty",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$quoteAmount",72],")",")",")",";",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$discountData",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","setBaseAmount",73],"(",["T_VARIABLE","$baseDiscountAmount",73],")",";",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$discountData",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","setOriginalAmount",74],"(",["T_STRING","min",74],"(",["T_VARIABLE","$itemOriginalPrice",74],["T_WHITESPACE"," ",74],"*",["T_WHITESPACE"," ",74],["T_VARIABLE","$qty",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$quoteAmount",74],")",")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$discountData",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","setBaseOriginalAmount",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","priceCurrency",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","round",75],"(",["T_VARIABLE","$baseItemOriginalPrice",75],")",")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$address",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","setCartFixedRules",77],"(",["T_VARIABLE","$cartRules",77],")",";",["T_WHITESPACE","\n\n        ",77],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$discountData",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Set information about usage cart fixed rule by quote address\n     *\n     * @param int $ruleId\n     * @param int $itemId\n     * @return void\n     *\/",82],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","setCartFixedRuleUsedForAddress",89],"(",["T_VARIABLE","$ruleId",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$itemId",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_cartFixedRuleUsedForAddress",91],"[",["T_VARIABLE","$ruleId",91],"]",["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$itemId",91],";",["T_WHITESPACE","\n    ",91],"}",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Retrieve information about usage cart fixed rule by quote address\n     *\n     * @param int $ruleId\n     * @return int|null\n     *\/",94],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","getCartFixedRuleUsedForAddress",100],"(",["T_VARIABLE","$ruleId",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_ISSET","isset",102],"(",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_cartFixedRuleUsedForAddress",102],"[",["T_VARIABLE","$ruleId",102],"]",")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_cartFixedRuleUsedForAddress",103],"[",["T_VARIABLE","$ruleId",103],"]",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","null",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n",106],"}",["T_WHITESPACE","\n",107]]