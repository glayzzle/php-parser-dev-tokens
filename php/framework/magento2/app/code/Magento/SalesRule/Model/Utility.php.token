[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","SalesRule",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Pricing",9],["T_NS_SEPARATOR","\\",9],["T_STRING","PriceCurrencyInterface",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Class Utility\n *\n * @package Magento\\SalesRule\\Model\n *\/",11],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","Utility",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$_roundingDeltas",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],"[","]",";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$_baseRoundingDeltas",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],"[","]",";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\ResourceModel\\Coupon\\UsageFactory\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$usageFactory",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\CouponFactory\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$couponFactory",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\Rule\\CustomerFactory\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$customerFactory",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\DataObjectFactory\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$objectFactory",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @var PriceCurrencyInterface\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$priceCurrency",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\SalesRule\\Model\\ResourceModel\\Coupon\\UsageFactory $usageFactory\n     * @param CouponFactory $couponFactory\n     * @param Rule\\CustomerFactory $customerFactory\n     * @param \\Magento\\Framework\\DataObjectFactory $objectFactory\n     * @param PriceCurrencyInterface $priceCurrency\n     *\/",53],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","__construct",60],"(",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Magento",61],["T_NS_SEPARATOR","\\",61],["T_STRING","SalesRule",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Model",61],["T_NS_SEPARATOR","\\",61],["T_STRING","ResourceModel",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Coupon",61],["T_NS_SEPARATOR","\\",61],["T_STRING","UsageFactory",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$usageFactory",61],",",["T_WHITESPACE","\n        ",61],["T_NS_SEPARATOR","\\",62],["T_STRING","Magento",62],["T_NS_SEPARATOR","\\",62],["T_STRING","SalesRule",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Model",62],["T_NS_SEPARATOR","\\",62],["T_STRING","CouponFactory",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$couponFactory",62],",",["T_WHITESPACE","\n        ",62],["T_NS_SEPARATOR","\\",63],["T_STRING","Magento",63],["T_NS_SEPARATOR","\\",63],["T_STRING","SalesRule",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Model",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Rule",63],["T_NS_SEPARATOR","\\",63],["T_STRING","CustomerFactory",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$customerFactory",63],",",["T_WHITESPACE","\n        ",63],["T_NS_SEPARATOR","\\",64],["T_STRING","Magento",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Framework",64],["T_NS_SEPARATOR","\\",64],["T_STRING","DataObjectFactory",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$objectFactory",64],",",["T_WHITESPACE","\n        ",64],["T_STRING","PriceCurrencyInterface",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$priceCurrency",65],["T_WHITESPACE","\n    ",65],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","couponFactory",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$couponFactory",67],";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","customerFactory",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$customerFactory",68],";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","usageFactory",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$usageFactory",69],";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","objectFactory",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$objectFactory",70],";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","priceCurrency",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$priceCurrency",71],";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Check if rule can be applied for specific address\/quote\/customer\n     *\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param \\Magento\\Quote\\Model\\Quote\\Address $address\n     * @return bool\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",74],["T_WHITESPACE","\n    ",82],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","canProcessRule",83],"(",["T_VARIABLE","$rule",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$address",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$rule",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","hasIsValidForAddress",85],"(",["T_VARIABLE","$address",85],")",["T_WHITESPACE"," ",85],["T_BOOLEAN_AND","&&",85],["T_WHITESPACE"," ",85],"!",["T_VARIABLE","$address",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","isObjectNew",85],"(",")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$rule",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getIsValidForAddress",86],"(",["T_VARIABLE","$address",86],")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_DOC_COMMENT","\/**\n         * check per coupon usage limit\n         *\/",89],["T_WHITESPACE","\n        ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$rule",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getCouponType",92],"(",")",["T_WHITESPACE"," ",92],["T_IS_NOT_EQUAL","!=",92],["T_WHITESPACE"," ",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Magento",92],["T_NS_SEPARATOR","\\",92],["T_STRING","SalesRule",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Model",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Rule",92],["T_DOUBLE_COLON","::",92],["T_STRING","COUPON_TYPE_NO_COUPON",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$couponCode",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$address",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getQuote",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","getCouponCode",93],"(",")",";",["T_WHITESPACE","\n            ",93],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_STRING","strlen",94],"(",["T_VARIABLE","$couponCode",94],")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                ",94],["T_DOC_COMMENT","\/** @var \\Magento\\SalesRule\\Model\\Coupon $coupon *\/",95],["T_WHITESPACE","\n                ",95],["T_VARIABLE","$coupon",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","couponFactory",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","create",96],"(",")",";",["T_WHITESPACE","\n                ",96],["T_VARIABLE","$coupon",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","load",97],"(",["T_VARIABLE","$couponCode",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'code'",97],")",";",["T_WHITESPACE","\n                ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$coupon",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getId",98],"(",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                    ",98],["T_COMMENT","\/\/ check entire usage limit\n",99],["T_WHITESPACE","                    ",100],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$coupon",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getUsageLimit",100],"(",")",["T_WHITESPACE"," ",100],["T_BOOLEAN_AND","&&",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$coupon",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getTimesUsed",100],"(",")",["T_WHITESPACE"," ",100],["T_IS_GREATER_OR_EQUAL",">=",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$coupon",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getUsageLimit",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                        ",100],["T_VARIABLE","$rule",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setIsValidForAddress",101],"(",["T_VARIABLE","$address",101],",",["T_WHITESPACE"," ",101],["T_STRING","false",101],")",";",["T_WHITESPACE","\n                        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_STRING","false",102],";",["T_WHITESPACE","\n                    ",102],"}",["T_WHITESPACE","\n                    ",103],["T_COMMENT","\/\/ check per customer usage limit\n",104],["T_WHITESPACE","                    ",105],["T_VARIABLE","$customerId",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$address",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getQuote",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getCustomerId",105],"(",")",";",["T_WHITESPACE","\n                    ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_VARIABLE","$customerId",106],["T_WHITESPACE"," ",106],["T_BOOLEAN_AND","&&",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$coupon",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getUsagePerCustomer",106],"(",")",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n                        ",106],["T_VARIABLE","$couponUsage",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","objectFactory",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","create",107],"(",")",";",["T_WHITESPACE","\n                        ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","usageFactory",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","create",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","loadByCustomerCoupon",108],"(",["T_WHITESPACE","\n                            ",108],["T_VARIABLE","$couponUsage",109],",",["T_WHITESPACE","\n                            ",109],["T_VARIABLE","$customerId",110],",",["T_WHITESPACE","\n                            ",110],["T_VARIABLE","$coupon",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getId",111],"(",")",["T_WHITESPACE","\n                        ",111],")",";",["T_WHITESPACE","\n                        ",112],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$couponUsage",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getCouponId",113],"(",")",["T_WHITESPACE"," ",113],["T_BOOLEAN_AND","&&",113],["T_WHITESPACE","\n                            ",113],["T_VARIABLE","$couponUsage",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getTimesUsed",114],"(",")",["T_WHITESPACE"," ",114],["T_IS_GREATER_OR_EQUAL",">=",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$coupon",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getUsagePerCustomer",114],"(",")",["T_WHITESPACE","\n                        ",114],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                            ",115],["T_VARIABLE","$rule",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setIsValidForAddress",116],"(",["T_VARIABLE","$address",116],",",["T_WHITESPACE"," ",116],["T_STRING","false",116],")",";",["T_WHITESPACE","\n                            ",116],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_STRING","false",117],";",["T_WHITESPACE","\n                        ",117],"}",["T_WHITESPACE","\n                    ",118],"}",["T_WHITESPACE","\n                ",119],"}",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n\n        ",122],["T_DOC_COMMENT","\/**\n         * check per rule usage limit\n         *\/",124],["T_WHITESPACE","\n        ",126],["T_VARIABLE","$ruleId",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$rule",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getId",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$ruleId",128],["T_WHITESPACE"," ",128],["T_BOOLEAN_AND","&&",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$rule",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getUsesPerCustomer",128],"(",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$customerId",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$address",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getQuote",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getCustomerId",129],"(",")",";",["T_WHITESPACE","\n            ",129],["T_DOC_COMMENT","\/** @var \\Magento\\SalesRule\\Model\\Rule\\Customer $ruleCustomer *\/",130],["T_WHITESPACE","\n            ",130],["T_VARIABLE","$ruleCustomer",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","customerFactory",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","create",131],"(",")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$ruleCustomer",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","loadByCustomerRule",132],"(",["T_VARIABLE","$customerId",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$ruleId",132],")",";",["T_WHITESPACE","\n            ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$ruleCustomer",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getId",133],"(",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n                ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$ruleCustomer",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getTimesUsed",134],"(",")",["T_WHITESPACE"," ",134],["T_IS_GREATER_OR_EQUAL",">=",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$rule",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getUsesPerCustomer",134],"(",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                    ",134],["T_VARIABLE","$rule",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","setIsValidForAddress",135],"(",["T_VARIABLE","$address",135],",",["T_WHITESPACE"," ",135],["T_STRING","false",135],")",";",["T_WHITESPACE","\n                    ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_STRING","false",136],";",["T_WHITESPACE","\n                ",136],"}",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$rule",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","afterLoad",140],"(",")",";",["T_WHITESPACE","\n        ",140],["T_DOC_COMMENT","\/**\n         * quote does not meet rule's conditions\n         *\/",141],["T_WHITESPACE","\n        ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_VARIABLE","$rule",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","validate",144],"(",["T_VARIABLE","$address",144],")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$rule",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","setIsValidForAddress",145],"(",["T_VARIABLE","$address",145],",",["T_WHITESPACE"," ",145],["T_STRING","false",145],")",";",["T_WHITESPACE","\n            ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","false",146],";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n        ",147],["T_DOC_COMMENT","\/**\n         * passed all validations, remember to be valid\n         *\/",148],["T_WHITESPACE","\n        ",150],["T_VARIABLE","$rule",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","setIsValidForAddress",151],"(",["T_VARIABLE","$address",151],",",["T_WHITESPACE"," ",151],["T_STRING","true",151],")",";",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_STRING","true",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data $discountData\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param float $qty\n     * @return void\n     *\/",155],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","minFix",161],"(",["T_WHITESPACE","\n        ",161],["T_NS_SEPARATOR","\\",162],["T_STRING","Magento",162],["T_NS_SEPARATOR","\\",162],["T_STRING","SalesRule",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Model",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Rule",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Action",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Discount",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Data",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$discountData",162],",",["T_WHITESPACE","\n        ",162],["T_NS_SEPARATOR","\\",163],["T_STRING","Magento",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Quote",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Model",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Quote",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Item",163],["T_NS_SEPARATOR","\\",163],["T_STRING","AbstractItem",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$item",163],",",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$qty",164],["T_WHITESPACE","\n    ",164],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$itemPrice",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getItemPrice",166],"(",["T_VARIABLE","$item",166],")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$baseItemPrice",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getItemBasePrice",167],"(",["T_VARIABLE","$item",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$itemDiscountAmount",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$item",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getDiscountAmount",169],"(",")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$itemBaseDiscountAmount",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$item",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getBaseDiscountAmount",170],"(",")",";",["T_WHITESPACE","\n\n        ",170],["T_VARIABLE","$discountAmount",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","min",172],"(",["T_VARIABLE","$itemDiscountAmount",172],["T_WHITESPACE"," ",172],"+",["T_WHITESPACE"," ",172],["T_VARIABLE","$discountData",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getAmount",172],"(",")",",",["T_WHITESPACE"," ",172],["T_VARIABLE","$itemPrice",172],["T_WHITESPACE"," ",172],"*",["T_WHITESPACE"," ",172],["T_VARIABLE","$qty",172],")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$baseDiscountAmount",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","min",173],"(",["T_VARIABLE","$itemBaseDiscountAmount",173],["T_WHITESPACE"," ",173],"+",["T_WHITESPACE"," ",173],["T_VARIABLE","$discountData",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getBaseAmount",173],"(",")",",",["T_WHITESPACE"," ",173],["T_VARIABLE","$baseItemPrice",173],["T_WHITESPACE"," ",173],"*",["T_WHITESPACE"," ",173],["T_VARIABLE","$qty",173],")",";",["T_WHITESPACE","\n\n        ",173],["T_VARIABLE","$discountData",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setAmount",175],"(",["T_VARIABLE","$discountAmount",175],")",";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$discountData",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","setBaseAmount",176],"(",["T_VARIABLE","$baseDiscountAmount",176],")",";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * Process \"delta\" rounding\n     *\n     * @param \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data $discountData\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @return $this\n     * @SuppressWarnings(PHPMD.UnusedLocalVariable)\n     *\/",179],["T_WHITESPACE","\n    ",186],["T_PUBLIC","public",187],["T_WHITESPACE"," ",187],["T_FUNCTION","function",187],["T_WHITESPACE"," ",187],["T_STRING","deltaRoundingFix",187],"(",["T_WHITESPACE","\n        ",187],["T_NS_SEPARATOR","\\",188],["T_STRING","Magento",188],["T_NS_SEPARATOR","\\",188],["T_STRING","SalesRule",188],["T_NS_SEPARATOR","\\",188],["T_STRING","Model",188],["T_NS_SEPARATOR","\\",188],["T_STRING","Rule",188],["T_NS_SEPARATOR","\\",188],["T_STRING","Action",188],["T_NS_SEPARATOR","\\",188],["T_STRING","Discount",188],["T_NS_SEPARATOR","\\",188],["T_STRING","Data",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$discountData",188],",",["T_WHITESPACE","\n        ",188],["T_NS_SEPARATOR","\\",189],["T_STRING","Magento",189],["T_NS_SEPARATOR","\\",189],["T_STRING","Quote",189],["T_NS_SEPARATOR","\\",189],["T_STRING","Model",189],["T_NS_SEPARATOR","\\",189],["T_STRING","Quote",189],["T_NS_SEPARATOR","\\",189],["T_STRING","Item",189],["T_NS_SEPARATOR","\\",189],["T_STRING","AbstractItem",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$item",189],["T_WHITESPACE","\n    ",189],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$store",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$item",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getQuote",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getStore",191],"(",")",";",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$discountAmount",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$discountData",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getAmount",192],"(",")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$baseDiscountAmount",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$discountData",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getBaseAmount",193],"(",")",";",["T_WHITESPACE","\n\n        ",193],["T_COMMENT","\/\/TODO Seems \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem::getDiscountPercent() returns float value\n",195],["T_WHITESPACE","        ",196],["T_COMMENT","\/\/that can not be used as array index\n",196],["T_WHITESPACE","        ",197],["T_VARIABLE","$percentKey",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$item",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getDiscountPercent",197],"(",")",";",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$percentKey",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$delta",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_ISSET","isset",199],"(",["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_roundingDeltas",199],"[",["T_VARIABLE","$percentKey",199],"]",")",["T_WHITESPACE"," ",199],"?",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_roundingDeltas",199],"[",["T_VARIABLE","$percentKey",199],"]",["T_WHITESPACE"," ",199],":",["T_WHITESPACE"," ",199],["T_LNUMBER","0",199],";",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$baseDelta",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_ISSET","isset",200],"(",["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_baseRoundingDeltas",200],"[",["T_VARIABLE","$percentKey",200],"]",")",["T_WHITESPACE"," ",200],"?",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_baseRoundingDeltas",200],"[",["T_VARIABLE","$percentKey",200],"]",["T_WHITESPACE"," ",200],":",["T_WHITESPACE"," ",200],["T_LNUMBER","0",200],";",["T_WHITESPACE","\n\n            ",200],["T_VARIABLE","$discountAmount",202],["T_WHITESPACE"," ",202],["T_PLUS_EQUAL","+=",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$delta",202],";",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$baseDiscountAmount",203],["T_WHITESPACE"," ",203],["T_PLUS_EQUAL","+=",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$baseDelta",203],";",["T_WHITESPACE","\n\n            ",203],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_roundingDeltas",205],"[",["T_VARIABLE","$percentKey",205],"]",["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$discountAmount",205],["T_WHITESPACE"," ",205],"-",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","priceCurrency",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","round",205],"(",["T_VARIABLE","$discountAmount",205],")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_baseRoundingDeltas",206],"[",["T_VARIABLE","$percentKey",206],"]",["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$baseDiscountAmount",206],["T_WHITESPACE","\n                ",206],"-",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","priceCurrency",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","round",207],"(",["T_VARIABLE","$baseDiscountAmount",207],")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$discountData",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","setAmount",210],"(",["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","priceCurrency",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","round",210],"(",["T_VARIABLE","$discountAmount",210],")",")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$discountData",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","setBaseAmount",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","priceCurrency",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","round",211],"(",["T_VARIABLE","$baseDiscountAmount",211],")",")",";",["T_WHITESPACE","\n\n        ",211],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],";",["T_WHITESPACE","\n    ",213],"}",["T_WHITESPACE","\n\n    ",214],["T_DOC_COMMENT","\/**\n     * Return item price\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @return float\n     *\/",216],["T_WHITESPACE","\n    ",221],["T_PUBLIC","public",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","getItemPrice",222],"(",["T_VARIABLE","$item",222],")",["T_WHITESPACE","\n    ",222],"{",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$price",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$item",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getDiscountCalculationPrice",224],"(",")",";",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$calcPrice",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getCalculationPrice",225],"(",")",";",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$price",226],["T_WHITESPACE"," ",226],["T_IS_IDENTICAL","===",226],["T_WHITESPACE"," ",226],["T_STRING","null",226],["T_WHITESPACE"," ",226],"?",["T_WHITESPACE"," ",226],["T_VARIABLE","$calcPrice",226],["T_WHITESPACE"," ",226],":",["T_WHITESPACE"," ",226],["T_VARIABLE","$price",226],";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Return item base price\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @return float\n     *\/",229],["T_WHITESPACE","\n    ",234],["T_PUBLIC","public",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","getItemBasePrice",235],"(",["T_VARIABLE","$item",235],")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$price",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$item",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getDiscountCalculationPrice",237],"(",")",";",["T_WHITESPACE","\n        ",237],["T_RETURN","return",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$price",238],["T_WHITESPACE"," ",238],["T_IS_NOT_IDENTICAL","!==",238],["T_WHITESPACE"," ",238],["T_STRING","null",238],["T_WHITESPACE"," ",238],"?",["T_WHITESPACE"," ",238],["T_VARIABLE","$item",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getBaseDiscountCalculationPrice",238],"(",")",["T_WHITESPACE"," ",238],":",["T_WHITESPACE"," ",238],["T_VARIABLE","$item",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getBaseCalculationPrice",238],"(",")",";",["T_WHITESPACE","\n    ",238],"}",["T_WHITESPACE","\n\n    ",239],["T_DOC_COMMENT","\/**\n     * Return discount item qty\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @return int\n     *\/",241],["T_WHITESPACE","\n    ",247],["T_PUBLIC","public",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","getItemQty",248],"(",["T_VARIABLE","$item",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$rule",248],")",["T_WHITESPACE","\n    ",248],"{",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$qty",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$item",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getTotalQty",250],"(",")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$discountQty",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$rule",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getDiscountQty",251],"(",")",";",["T_WHITESPACE","\n        ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$discountQty",252],["T_WHITESPACE"," ",252],"?",["T_WHITESPACE"," ",252],["T_STRING","min",252],"(",["T_VARIABLE","$qty",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$discountQty",252],")",["T_WHITESPACE"," ",252],":",["T_WHITESPACE"," ",252],["T_VARIABLE","$qty",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Merge two sets of ids\n     *\n     * @param array|string $a1\n     * @param array|string $a2\n     * @param bool $asString\n     * @return array|string\n     *\/",255],["T_WHITESPACE","\n    ",262],["T_PUBLIC","public",263],["T_WHITESPACE"," ",263],["T_FUNCTION","function",263],["T_WHITESPACE"," ",263],["T_STRING","mergeIds",263],"(",["T_VARIABLE","$a1",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$a2",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$asString",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_STRING","true",263],")",["T_WHITESPACE","\n    ",263],"{",["T_WHITESPACE","\n        ",264],["T_IF","if",265],["T_WHITESPACE"," ",265],"(","!",["T_STRING","is_array",265],"(",["T_VARIABLE","$a1",265],")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$a1",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_EMPTY","empty",266],"(",["T_VARIABLE","$a1",266],")",["T_WHITESPACE"," ",266],"?",["T_WHITESPACE"," ",266],"[","]",["T_WHITESPACE"," ",266],":",["T_WHITESPACE"," ",266],["T_STRING","explode",266],"(",["T_CONSTANT_ENCAPSED_STRING","','",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$a1",266],")",";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n        ",267],["T_IF","if",268],["T_WHITESPACE"," ",268],"(","!",["T_STRING","is_array",268],"(",["T_VARIABLE","$a2",268],")",")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$a2",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_EMPTY","empty",269],"(",["T_VARIABLE","$a2",269],")",["T_WHITESPACE"," ",269],"?",["T_WHITESPACE"," ",269],"[","]",["T_WHITESPACE"," ",269],":",["T_WHITESPACE"," ",269],["T_STRING","explode",269],"(",["T_CONSTANT_ENCAPSED_STRING","','",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$a2",269],")",";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$a",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_STRING","array_unique",271],"(",["T_STRING","array_merge",271],"(",["T_VARIABLE","$a1",271],",",["T_WHITESPACE"," ",271],["T_VARIABLE","$a2",271],")",")",";",["T_WHITESPACE","\n        ",271],["T_IF","if",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$asString",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$a",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","implode",273],"(",["T_CONSTANT_ENCAPSED_STRING","','",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$a",273],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n        ",274],["T_RETURN","return",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$a",275],";",["T_WHITESPACE","\n    ",275],"}",["T_WHITESPACE","\n\n    ",276],["T_DOC_COMMENT","\/**\n     * @return void\n     *\/",278],["T_WHITESPACE","\n    ",280],["T_PUBLIC","public",281],["T_WHITESPACE"," ",281],["T_FUNCTION","function",281],["T_WHITESPACE"," ",281],["T_STRING","resetRoundingDeltas",281],"(",")",["T_WHITESPACE","\n    ",281],"{",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_roundingDeltas",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],"[","]",";",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_baseRoundingDeltas",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],"[","]",";",["T_WHITESPACE","\n    ",284],"}",["T_WHITESPACE","\n",285],"}",["T_WHITESPACE","\n",286]]