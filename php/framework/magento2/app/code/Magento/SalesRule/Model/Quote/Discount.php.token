[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SalesRule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],";",["T_WHITESPACE","\n\n",6],["T_CLASS","class",8],["T_WHITESPACE"," ",8],["T_STRING","Discount",8],["T_WHITESPACE"," ",8],["T_EXTENDS","extends",8],["T_WHITESPACE"," ",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Address",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Total",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractTotal",8],["T_WHITESPACE","\n",8],"{",["T_WHITESPACE","\n    ",9],["T_DOC_COMMENT","\/**\n     * Discount calculation object\n     *\n     * @var \\Magento\\SalesRule\\Model\\Validator\n     *\/",10],["T_WHITESPACE","\n    ",14],["T_PROTECTED","protected",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$calculator",15],";",["T_WHITESPACE","\n\n    ",15],["T_DOC_COMMENT","\/**\n     * Core event manager proxy\n     *\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",17],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$eventManager",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_STRING","null",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$storeManager",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Pricing\\PriceCurrencyInterface\n     *\/",29],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$priceCurrency",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\SalesRule\\Model\\Validator $validator\n     * @param \\Magento\\Framework\\Pricing\\PriceCurrencyInterface $priceCurrency\n     *\/",34],["T_WHITESPACE","\n    ",39],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","__construct",40],"(",["T_WHITESPACE","\n        ",40],["T_NS_SEPARATOR","\\",41],["T_STRING","Magento",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Framework",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Event",41],["T_NS_SEPARATOR","\\",41],["T_STRING","ManagerInterface",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$eventManager",41],",",["T_WHITESPACE","\n        ",41],["T_NS_SEPARATOR","\\",42],["T_STRING","Magento",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Store",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Model",42],["T_NS_SEPARATOR","\\",42],["T_STRING","StoreManagerInterface",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$storeManager",42],",",["T_WHITESPACE","\n        ",42],["T_NS_SEPARATOR","\\",43],["T_STRING","Magento",43],["T_NS_SEPARATOR","\\",43],["T_STRING","SalesRule",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Model",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Validator",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$validator",43],",",["T_WHITESPACE","\n        ",43],["T_NS_SEPARATOR","\\",44],["T_STRING","Magento",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Framework",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Pricing",44],["T_NS_SEPARATOR","\\",44],["T_STRING","PriceCurrencyInterface",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$priceCurrency",44],["T_WHITESPACE","\n    ",44],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","setCode",46],"(",["T_CONSTANT_ENCAPSED_STRING","'discount'",46],")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","eventManager",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$eventManager",47],";",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","calculator",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$validator",48],";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","storeManager",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$storeManager",49],";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","priceCurrency",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$priceCurrency",50],";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Collect address discount amount\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param \\Magento\\Quote\\Api\\Data\\ShippingAssignmentInterface $shippingAssignment\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",53],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","collect",62],"(",["T_WHITESPACE","\n        ",62],["T_NS_SEPARATOR","\\",63],["T_STRING","Magento",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Quote",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Model",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Quote",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$quote",63],",",["T_WHITESPACE","\n        ",63],["T_NS_SEPARATOR","\\",64],["T_STRING","Magento",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Quote",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Api",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Data",64],["T_NS_SEPARATOR","\\",64],["T_STRING","ShippingAssignmentInterface",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$shippingAssignment",64],",",["T_WHITESPACE","\n        ",64],["T_NS_SEPARATOR","\\",65],["T_STRING","Magento",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Quote",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Model",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Quote",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Address",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Total",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$total",65],["T_WHITESPACE","\n    ",65],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n        ",66],["T_STRING","parent",67],["T_DOUBLE_COLON","::",67],["T_STRING","collect",67],"(",["T_VARIABLE","$quote",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$shippingAssignment",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$total",67],")",";",["T_WHITESPACE","\n\n        ",67],["T_VARIABLE","$store",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","storeManager",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getStore",69],"(",["T_VARIABLE","$quote",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getStoreId",69],"(",")",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$address",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$shippingAssignment",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getShipping",70],"(",")",["T_OBJECT_OPERATOR","->",70],["T_STRING","getAddress",70],"(",")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","calculator",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","reset",71],"(",["T_VARIABLE","$address",71],")",";",["T_WHITESPACE","\n\n        ",71],["T_VARIABLE","$items",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$shippingAssignment",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getItems",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(","!",["T_STRING","count",74],"(",["T_VARIABLE","$items",74],")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$eventArgs",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],"[",["T_WHITESPACE","\n            ",78],["T_CONSTANT_ENCAPSED_STRING","'website_id'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$store",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getWebsiteId",79],"(",")",",",["T_WHITESPACE","\n            ",79],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$quote",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getCustomerGroupId",80],"(",")",",",["T_WHITESPACE","\n            ",80],["T_CONSTANT_ENCAPSED_STRING","'coupon_code'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$quote",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getCouponCode",81],"(",")",",",["T_WHITESPACE","\n        ",81],"]",";",["T_WHITESPACE","\n\n        ",82],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","calculator",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","init",84],"(",["T_VARIABLE","$store",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getWebsiteId",84],"(",")",",",["T_WHITESPACE"," ",84],["T_VARIABLE","$quote",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getCustomerGroupId",84],"(",")",",",["T_WHITESPACE"," ",84],["T_VARIABLE","$quote",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getCouponCode",84],"(",")",")",";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","calculator",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","initTotals",85],"(",["T_VARIABLE","$items",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$address",85],")",";",["T_WHITESPACE","\n\n        ",85],["T_VARIABLE","$address",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setDiscountDescription",87],"(","[","]",")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$items",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","calculator",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","sortItemsByPriority",88],"(",["T_VARIABLE","$items",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$address",88],")",";",["T_WHITESPACE","\n\n        ",88],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote\\Item $item *\/",90],["T_WHITESPACE","\n        ",90],["T_FOREACH","foreach",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$items",91],["T_WHITESPACE"," ",91],["T_AS","as",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$item",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$item",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getNoDiscount",92],"(",")",["T_WHITESPACE"," ",92],["T_BOOLEAN_OR","||",92],["T_WHITESPACE"," ",92],"!",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","calculator",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","canApplyDiscount",92],"(",["T_VARIABLE","$item",92],")",")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$item",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","setDiscountAmount",93],"(",["T_LNUMBER","0",93],")",";",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$item",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setBaseDiscountAmount",94],"(",["T_LNUMBER","0",94],")",";",["T_WHITESPACE","\n\n                ",94],["T_COMMENT","\/\/ ensure my children are zeroed out\n",96],["T_WHITESPACE","                ",97],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_VARIABLE","$item",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getHasChildren",97],"(",")",["T_WHITESPACE"," ",97],["T_BOOLEAN_AND","&&",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$item",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","isChildrenCalculated",97],"(",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n                    ",97],["T_FOREACH","foreach",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$item",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getChildren",98],"(",")",["T_WHITESPACE"," ",98],["T_AS","as",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$child",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                        ",98],["T_VARIABLE","$child",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setDiscountAmount",99],"(",["T_LNUMBER","0",99],")",";",["T_WHITESPACE","\n                        ",99],["T_VARIABLE","$child",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setBaseDiscountAmount",100],"(",["T_LNUMBER","0",100],")",";",["T_WHITESPACE","\n                    ",100],"}",["T_WHITESPACE","\n                ",101],"}",["T_WHITESPACE","\n                ",102],["T_CONTINUE","continue",103],";",["T_WHITESPACE","\n            ",103],"}",["T_WHITESPACE","\n            ",104],["T_COMMENT","\/\/ to determine the child item discount, we calculate the parent\n",105],["T_WHITESPACE","            ",106],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_VARIABLE","$item",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getParentItem",106],"(",")",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n                ",106],["T_CONTINUE","continue",107],";",["T_WHITESPACE","\n            ",107],"}",["T_WHITESPACE","\n\n            ",108],["T_VARIABLE","$eventArgs",110],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",110],"]",["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$item",110],";",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","eventManager",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","dispatch",111],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_quote_address_discount_item'",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$eventArgs",111],")",";",["T_WHITESPACE","\n\n            ",111],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$item",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getHasChildren",113],"(",")",["T_WHITESPACE"," ",113],["T_BOOLEAN_AND","&&",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$item",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","isChildrenCalculated",113],"(",")",")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","calculator",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","process",114],"(",["T_VARIABLE","$item",114],")",";",["T_WHITESPACE","\n                ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","distributeDiscount",115],"(",["T_VARIABLE","$item",115],")",";",["T_WHITESPACE","\n                ",115],["T_FOREACH","foreach",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$item",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getChildren",116],"(",")",["T_WHITESPACE"," ",116],["T_AS","as",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$child",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                    ",116],["T_VARIABLE","$eventArgs",117],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",117],"]",["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$child",117],";",["T_WHITESPACE","\n                    ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","eventManager",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","dispatch",118],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_quote_address_discount_item'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$eventArgs",118],")",";",["T_WHITESPACE","\n                    ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","aggregateItemDiscount",119],"(",["T_VARIABLE","$child",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$total",119],")",";",["T_WHITESPACE","\n                ",119],"}",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE"," ",121],["T_ELSE","else",121],["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","calculator",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","process",122],"(",["T_VARIABLE","$item",122],")",";",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","aggregateItemDiscount",123],"(",["T_VARIABLE","$item",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$total",123],")",";",["T_WHITESPACE","\n            ",123],"}",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n\n        ",125],["T_DOC_COMMENT","\/** Process shipping amount discount *\/",127],["T_WHITESPACE","\n        ",127],["T_VARIABLE","$address",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","setShippingDiscountAmount",128],"(",["T_LNUMBER","0",128],")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$address",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","setBaseShippingDiscountAmount",129],"(",["T_LNUMBER","0",129],")",";",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$address",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getShippingAmount",130],"(",")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","calculator",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","processShippingAmount",131],"(",["T_VARIABLE","$address",131],")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$total",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","addTotalAmount",132],"(",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getCode",132],"(",")",",",["T_WHITESPACE"," ",132],"-",["T_VARIABLE","$address",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getShippingDiscountAmount",132],"(",")",")",";",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$total",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","addBaseTotalAmount",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getCode",133],"(",")",",",["T_WHITESPACE"," ",133],"-",["T_VARIABLE","$address",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getBaseShippingDiscountAmount",133],"(",")",")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n\n        ",134],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","calculator",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","prepareDescription",136],"(",["T_VARIABLE","$address",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$total",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","setDiscountDescription",137],"(",["T_VARIABLE","$address",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getDiscountDescription",137],"(",")",")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$total",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","setSubtotalWithDiscount",138],"(",["T_VARIABLE","$total",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getSubtotal",138],"(",")",["T_WHITESPACE"," ",138],"+",["T_WHITESPACE"," ",138],["T_VARIABLE","$total",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getDiscountAmount",138],"(",")",")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$total",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","setBaseSubtotalWithDiscount",139],"(",["T_VARIABLE","$total",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getBaseSubtotal",139],"(",")",["T_WHITESPACE"," ",139],"+",["T_WHITESPACE"," ",139],["T_VARIABLE","$total",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getBaseDiscountAmount",139],"(",")",")",";",["T_WHITESPACE","\n        ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Aggregate item discount information to total data and related properties\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @return $this\n     *\/",143],["T_WHITESPACE","\n    ",149],["T_PROTECTED","protected",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","aggregateItemDiscount",150],"(",["T_WHITESPACE","\n        ",150],["T_NS_SEPARATOR","\\",151],["T_STRING","Magento",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Quote",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Model",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Quote",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Item",151],["T_NS_SEPARATOR","\\",151],["T_STRING","AbstractItem",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$item",151],",",["T_WHITESPACE","\n        ",151],["T_NS_SEPARATOR","\\",152],["T_STRING","Magento",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Quote",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Model",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Quote",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Address",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Total",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$total",152],["T_WHITESPACE","\n    ",152],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$total",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","addTotalAmount",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getCode",154],"(",")",",",["T_WHITESPACE"," ",154],"-",["T_VARIABLE","$item",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getDiscountAmount",154],"(",")",")",";",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$total",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","addBaseTotalAmount",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getCode",155],"(",")",",",["T_WHITESPACE"," ",155],"-",["T_VARIABLE","$item",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getBaseDiscountAmount",155],"(",")",")",";",["T_WHITESPACE","\n        ",155],["T_RETURN","return",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],";",["T_WHITESPACE","\n    ",156],"}",["T_WHITESPACE","\n\n    ",157],["T_DOC_COMMENT","\/**\n     * Distribute discount at parent item to children items\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @return $this\n     *\/",159],["T_WHITESPACE","\n    ",164],["T_PROTECTED","protected",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","distributeDiscount",165],"(",["T_NS_SEPARATOR","\\",165],["T_STRING","Magento",165],["T_NS_SEPARATOR","\\",165],["T_STRING","Quote",165],["T_NS_SEPARATOR","\\",165],["T_STRING","Model",165],["T_NS_SEPARATOR","\\",165],["T_STRING","Quote",165],["T_NS_SEPARATOR","\\",165],["T_STRING","Item",165],["T_NS_SEPARATOR","\\",165],["T_STRING","AbstractItem",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$item",165],")",["T_WHITESPACE","\n    ",165],"{",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$parentBaseRowTotal",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$item",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getBaseRowTotal",167],"(",")",";",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$keys",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],"[",["T_WHITESPACE","\n            ",168],["T_CONSTANT_ENCAPSED_STRING","'discount_amount'",169],",",["T_WHITESPACE","\n            ",169],["T_CONSTANT_ENCAPSED_STRING","'base_discount_amount'",170],",",["T_WHITESPACE","\n            ",170],["T_CONSTANT_ENCAPSED_STRING","'original_discount_amount'",171],",",["T_WHITESPACE","\n            ",171],["T_CONSTANT_ENCAPSED_STRING","'base_original_discount_amount'",172],",",["T_WHITESPACE","\n        ",172],"]",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$roundingDelta",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],"[","]",";",["T_WHITESPACE","\n        ",174],["T_FOREACH","foreach",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$keys",175],["T_WHITESPACE"," ",175],["T_AS","as",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$key",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_COMMENT","\/\/Initialize the rounding delta to a tiny number to avoid floating point precision problem\n",176],["T_WHITESPACE","            ",177],["T_VARIABLE","$roundingDelta",177],"[",["T_VARIABLE","$key",177],"]",["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_DNUMBER","0.0000001",177],";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n        ",178],["T_FOREACH","foreach",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$item",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getChildren",179],"(",")",["T_WHITESPACE"," ",179],["T_AS","as",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$child",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$ratio",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$child",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getBaseRowTotal",180],"(",")",["T_WHITESPACE"," ",180],"\/",["T_WHITESPACE"," ",180],["T_VARIABLE","$parentBaseRowTotal",180],";",["T_WHITESPACE","\n            ",180],["T_FOREACH","foreach",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$keys",181],["T_WHITESPACE"," ",181],["T_AS","as",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$key",181],")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(","!",["T_VARIABLE","$item",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","hasData",182],"(",["T_VARIABLE","$key",182],")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                    ",182],["T_CONTINUE","continue",183],";",["T_WHITESPACE","\n                ",183],"}",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$value",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$item",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getData",185],"(",["T_VARIABLE","$key",185],")",["T_WHITESPACE"," ",185],"*",["T_WHITESPACE"," ",185],["T_VARIABLE","$ratio",185],";",["T_WHITESPACE","\n                ",185],["T_VARIABLE","$roundedValue",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","priceCurrency",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","round",186],"(",["T_VARIABLE","$value",186],["T_WHITESPACE"," ",186],"+",["T_WHITESPACE"," ",186],["T_VARIABLE","$roundingDelta",186],"[",["T_VARIABLE","$key",186],"]",")",";",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$roundingDelta",187],"[",["T_VARIABLE","$key",187],"]",["T_WHITESPACE"," ",187],["T_PLUS_EQUAL","+=",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$value",187],["T_WHITESPACE"," ",187],"-",["T_WHITESPACE"," ",187],["T_VARIABLE","$roundedValue",187],";",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$child",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","setData",188],"(",["T_VARIABLE","$key",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$roundedValue",188],")",";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_FOREACH","foreach",192],["T_WHITESPACE"," ",192],"(",["T_VARIABLE","$keys",192],["T_WHITESPACE"," ",192],["T_AS","as",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$key",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$item",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","setData",193],"(",["T_VARIABLE","$key",193],",",["T_WHITESPACE"," ",193],["T_LNUMBER","0",193],")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n        ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Add discount total information to address\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @return array|null\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",198],["T_WHITESPACE","\n    ",205],["T_PUBLIC","public",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","fetch",206],"(",["T_NS_SEPARATOR","\\",206],["T_STRING","Magento",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Quote",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Model",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Quote",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$quote",206],",",["T_WHITESPACE"," ",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Magento",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Quote",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Model",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Quote",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Address",206],["T_NS_SEPARATOR","\\",206],["T_STRING","Total",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$total",206],")",["T_WHITESPACE","\n    ",206],"{",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$result",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","null",208],";",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$amount",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$total",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getDiscountAmount",209],"(",")",";",["T_WHITESPACE","\n\n        ",209],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$amount",211],["T_WHITESPACE"," ",211],["T_IS_NOT_EQUAL","!=",211],["T_WHITESPACE"," ",211],["T_LNUMBER","0",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$description",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$total",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getDiscountDescription",212],"(",")",";",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$result",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],"[",["T_WHITESPACE","\n                ",213],["T_CONSTANT_ENCAPSED_STRING","'code'",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getCode",214],"(",")",",",["T_WHITESPACE","\n                ",214],["T_CONSTANT_ENCAPSED_STRING","'title'",215],["T_WHITESPACE"," ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_STRING","strlen",215],"(",["T_VARIABLE","$description",215],")",["T_WHITESPACE"," ",215],"?",["T_WHITESPACE"," ",215],["T_STRING","__",215],"(",["T_CONSTANT_ENCAPSED_STRING","'Discount (%1)'",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$description",215],")",["T_WHITESPACE"," ",215],":",["T_WHITESPACE"," ",215],["T_STRING","__",215],"(",["T_CONSTANT_ENCAPSED_STRING","'Discount'",215],")",",",["T_WHITESPACE","\n                ",215],["T_CONSTANT_ENCAPSED_STRING","'value'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$amount",216],["T_WHITESPACE","\n            ",216],"]",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n        ",218],["T_RETURN","return",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$result",219],";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n",220],"}",["T_WHITESPACE","\n",221]]