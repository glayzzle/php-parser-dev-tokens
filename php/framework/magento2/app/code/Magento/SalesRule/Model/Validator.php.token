[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","SalesRule",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Quote",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Quote",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Address",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Quote",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Quote",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Item",12],["T_NS_SEPARATOR","\\",12],["T_STRING","AbstractItem",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * SalesRule Validator Model\n *\n * Allows dispatching before and after events for each controller action\n *\n * @method mixed getCouponCode()\n * @method Validator setCouponCode($code)\n * @method mixed getWebsiteId()\n * @method Validator setWebsiteId($id)\n * @method mixed getCustomerGroupId()\n * @method Validator setCustomerGroupId($id)\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",14],["T_WHITESPACE","\n",26],["T_CLASS","class",27],["T_WHITESPACE"," ",27],["T_STRING","Validator",27],["T_WHITESPACE"," ",27],["T_EXTENDS","extends",27],["T_WHITESPACE"," ",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Magento",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Framework",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Model",27],["T_NS_SEPARATOR","\\",27],["T_STRING","AbstractModel",27],["T_WHITESPACE","\n",27],"{",["T_WHITESPACE","\n    ",28],["T_DOC_COMMENT","\/**\n     * Rule source collection\n     *\n     * @var \\Magento\\SalesRule\\Model\\ResourceModel\\Rule\\Collection\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_rules",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Defines if method \\Magento\\SalesRule\\Model\\Validator::reset() wasn't called\n     * Used for clearing applied rule ids in Quote and in Address\n     *\n     * @var bool\n     *\/",36],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_isFirstTimeResetRun",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","true",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Information about item totals for rules\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_rulesItemTotals",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],"[","]",";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Skip action rules validation flag\n     *\n     * @var bool\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_skipActionsValidation",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","false",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Catalog data\n     *\n     * @var \\Magento\\Catalog\\Helper\\Data|null\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_catalogData",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","null",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\ResourceModel\\Rule\\CollectionFactory\n     *\/",65],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$_collectionFactory",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\Utility\n     *\/",70],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$validatorUtility",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\RulesApplier\n     *\/",75],["T_WHITESPACE","\n    ",77],["T_PROTECTED","protected",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$rulesApplier",78],";",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Pricing\\PriceCurrencyInterface\n     *\/",80],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$priceCurrency",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * @var Validator\\Pool\n     *\/",85],["T_WHITESPACE","\n    ",87],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$validators",88],";",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Message\\ManagerInterface\n     *\/",90],["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$messageManager",93],";",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Counter is used for assigning temporary id to quote address\n     *\n     * @var int\n     *\/",95],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$counter",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_LNUMBER","0",100],";",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\Context $context\n     * @param \\Magento\\Framework\\Registry $registry\n     * @param \\Magento\\SalesRule\\Model\\ResourceModel\\Rule\\CollectionFactory $collectionFactory\n     * @param \\Magento\\Catalog\\Helper\\Data $catalogData\n     * @param Utility $utility\n     * @param RulesApplier $rulesApplier\n     * @param \\Magento\\Framework\\Pricing\\PriceCurrencyInterface $priceCurrency\n     * @param Validator\\Pool $validators\n     * @param \\Magento\\Framework\\Message\\ManagerInterface $messageManager\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\AbstractResource $resource\n     * @param \\Magento\\Framework\\Data\\Collection\\AbstractDb $resourceCollection\n     * @param array $data\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",102],["T_WHITESPACE","\n    ",116],["T_PUBLIC","public",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","__construct",117],"(",["T_WHITESPACE","\n        ",117],["T_NS_SEPARATOR","\\",118],["T_STRING","Magento",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Framework",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Model",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Context",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$context",118],",",["T_WHITESPACE","\n        ",118],["T_NS_SEPARATOR","\\",119],["T_STRING","Magento",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Framework",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Registry",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$registry",119],",",["T_WHITESPACE","\n        ",119],["T_NS_SEPARATOR","\\",120],["T_STRING","Magento",120],["T_NS_SEPARATOR","\\",120],["T_STRING","SalesRule",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Model",120],["T_NS_SEPARATOR","\\",120],["T_STRING","ResourceModel",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Rule",120],["T_NS_SEPARATOR","\\",120],["T_STRING","CollectionFactory",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$collectionFactory",120],",",["T_WHITESPACE","\n        ",120],["T_NS_SEPARATOR","\\",121],["T_STRING","Magento",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Catalog",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Helper",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Data",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$catalogData",121],",",["T_WHITESPACE","\n        ",121],["T_NS_SEPARATOR","\\",122],["T_STRING","Magento",122],["T_NS_SEPARATOR","\\",122],["T_STRING","SalesRule",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Model",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Utility",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$utility",122],",",["T_WHITESPACE","\n        ",122],["T_NS_SEPARATOR","\\",123],["T_STRING","Magento",123],["T_NS_SEPARATOR","\\",123],["T_STRING","SalesRule",123],["T_NS_SEPARATOR","\\",123],["T_STRING","Model",123],["T_NS_SEPARATOR","\\",123],["T_STRING","RulesApplier",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$rulesApplier",123],",",["T_WHITESPACE","\n        ",123],["T_NS_SEPARATOR","\\",124],["T_STRING","Magento",124],["T_NS_SEPARATOR","\\",124],["T_STRING","Framework",124],["T_NS_SEPARATOR","\\",124],["T_STRING","Pricing",124],["T_NS_SEPARATOR","\\",124],["T_STRING","PriceCurrencyInterface",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$priceCurrency",124],",",["T_WHITESPACE","\n        ",124],["T_NS_SEPARATOR","\\",125],["T_STRING","Magento",125],["T_NS_SEPARATOR","\\",125],["T_STRING","SalesRule",125],["T_NS_SEPARATOR","\\",125],["T_STRING","Model",125],["T_NS_SEPARATOR","\\",125],["T_STRING","Validator",125],["T_NS_SEPARATOR","\\",125],["T_STRING","Pool",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$validators",125],",",["T_WHITESPACE","\n        ",125],["T_NS_SEPARATOR","\\",126],["T_STRING","Magento",126],["T_NS_SEPARATOR","\\",126],["T_STRING","Framework",126],["T_NS_SEPARATOR","\\",126],["T_STRING","Message",126],["T_NS_SEPARATOR","\\",126],["T_STRING","ManagerInterface",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$messageManager",126],",",["T_WHITESPACE","\n        ",126],["T_NS_SEPARATOR","\\",127],["T_STRING","Magento",127],["T_NS_SEPARATOR","\\",127],["T_STRING","Framework",127],["T_NS_SEPARATOR","\\",127],["T_STRING","Model",127],["T_NS_SEPARATOR","\\",127],["T_STRING","ResourceModel",127],["T_NS_SEPARATOR","\\",127],["T_STRING","AbstractResource",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$resource",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","null",127],",",["T_WHITESPACE","\n        ",127],["T_NS_SEPARATOR","\\",128],["T_STRING","Magento",128],["T_NS_SEPARATOR","\\",128],["T_STRING","Framework",128],["T_NS_SEPARATOR","\\",128],["T_STRING","Data",128],["T_NS_SEPARATOR","\\",128],["T_STRING","Collection",128],["T_NS_SEPARATOR","\\",128],["T_STRING","AbstractDb",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$resourceCollection",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","null",128],",",["T_WHITESPACE","\n        ",128],["T_ARRAY","array",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$data",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],"[","]",["T_WHITESPACE","\n    ",129],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_collectionFactory",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$collectionFactory",131],";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_catalogData",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$catalogData",132],";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","validatorUtility",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$utility",133],";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","rulesApplier",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$rulesApplier",134],";",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","priceCurrency",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$priceCurrency",135],";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","validators",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$validators",136],";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","messageManager",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$messageManager",137],";",["T_WHITESPACE","\n        ",137],["T_STRING","parent",138],["T_DOUBLE_COLON","::",138],["T_STRING","__construct",138],"(",["T_VARIABLE","$context",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$registry",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$resource",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$resourceCollection",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$data",138],")",";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Init validator\n     * Init process load collection of rules for specific website,\n     * customer group and coupon code\n     *\n     * @param int $websiteId\n     * @param int $customerGroupId\n     * @param string $couponCode\n     * @return $this\n     *\/",141],["T_WHITESPACE","\n    ",150],["T_PUBLIC","public",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","init",151],"(",["T_VARIABLE","$websiteId",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$customerGroupId",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$couponCode",151],")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","setWebsiteId",153],"(",["T_VARIABLE","$websiteId",153],")",["T_OBJECT_OPERATOR","->",153],["T_STRING","setCustomerGroupId",153],"(",["T_VARIABLE","$customerGroupId",153],")",["T_OBJECT_OPERATOR","->",153],["T_STRING","setCouponCode",153],"(",["T_VARIABLE","$couponCode",153],")",";",["T_WHITESPACE","\n\n        ",153],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Get rules collection for current object state\n     *\n     * @param Address|null $address\n     * @return \\Magento\\SalesRule\\Model\\ResourceModel\\Rule\\Collection\n     *\/",158],["T_WHITESPACE","\n    ",163],["T_PROTECTED","protected",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","_getRules",164],"(",["T_STRING","Address",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$address",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_STRING","null",164],")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$addressId",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getAddressId",166],"(",["T_VARIABLE","$address",166],")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$key",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getWebsiteId",167],"(",")",["T_WHITESPACE"," ",167],".",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'_'",167],["T_WHITESPACE","\n            ",167],".",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getCustomerGroupId",168],"(",")",["T_WHITESPACE"," ",168],".",["T_WHITESPACE"," ",168],["T_CONSTANT_ENCAPSED_STRING","'_'",168],["T_WHITESPACE","\n            ",168],".",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getCouponCode",169],"(",")",["T_WHITESPACE"," ",169],".",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'_'",169],["T_WHITESPACE","\n            ",169],".",["T_WHITESPACE"," ",170],["T_VARIABLE","$addressId",170],";",["T_WHITESPACE","\n        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(","!",["T_ISSET","isset",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_rules",171],"[",["T_VARIABLE","$key",171],"]",")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_rules",172],"[",["T_VARIABLE","$key",172],"]",["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_collectionFactory",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","create",172],"(",")",["T_WHITESPACE","\n                ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","setValidationFilter",173],"(",["T_WHITESPACE","\n                    ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getWebsiteId",174],"(",")",",",["T_WHITESPACE","\n                    ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getCustomerGroupId",175],"(",")",",",["T_WHITESPACE","\n                    ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCouponCode",176],"(",")",",",["T_WHITESPACE","\n                    ",176],["T_STRING","null",177],",",["T_WHITESPACE","\n                    ",177],["T_VARIABLE","$address",178],["T_WHITESPACE","\n                ",178],")",["T_WHITESPACE","\n                ",179],["T_OBJECT_OPERATOR","->",180],["T_STRING","addFieldToFilter",180],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",180],",",["T_WHITESPACE"," ",180],["T_LNUMBER","1",180],")",["T_WHITESPACE","\n                ",180],["T_OBJECT_OPERATOR","->",181],["T_STRING","load",181],"(",")",";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n        ",182],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_rules",183],"[",["T_VARIABLE","$key",183],"]",";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * @param Address $address\n     * @return string\n     *\/",186],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","getAddressId",190],"(",["T_STRING","Address",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$address",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_IF","if",192],["T_WHITESPACE"," ",192],"(",["T_VARIABLE","$address",192],["T_WHITESPACE"," ",192],["T_IS_EQUAL","==",192],["T_WHITESPACE"," ",192],["T_STRING","null",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","''",193],";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n        ",194],["T_IF","if",195],["T_WHITESPACE"," ",195],"(","!",["T_VARIABLE","$address",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","hasData",195],"(",["T_CONSTANT_ENCAPSED_STRING","'address_sales_rule_id'",195],")",")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$address",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","hasData",196],"(",["T_CONSTANT_ENCAPSED_STRING","'address_id'",196],")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$address",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","setData",197],"(",["T_CONSTANT_ENCAPSED_STRING","'address_sales_rule_id'",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$address",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getData",197],"(",["T_CONSTANT_ENCAPSED_STRING","'address_id'",197],")",")",";",["T_WHITESPACE","\n            ",197],"}",["T_WHITESPACE"," ",198],["T_ELSE","else",198],["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_VARIABLE","$type",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$address",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getAddressType",199],"(",")",";",["T_WHITESPACE","\n                ",199],["T_VARIABLE","$tempId",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$type",200],["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","counter",200],["T_INC","++",200],";",["T_WHITESPACE","\n                ",200],["T_VARIABLE","$address",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","setData",201],"(",["T_CONSTANT_ENCAPSED_STRING","'address_sales_rule_id'",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$tempId",201],")",";",["T_WHITESPACE","\n            ",201],"}",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n        ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$address",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getData",204],"(",["T_CONSTANT_ENCAPSED_STRING","'address_sales_rule_id'",204],")",";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Set skip actions validation flag\n     *\n     * @param bool $flag\n     * @return $this\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PUBLIC","public",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","setSkipActionsValidation",213],"(",["T_VARIABLE","$flag",213],")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_skipActionsValidation",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$flag",215],";",["T_WHITESPACE","\n        ",215],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Can apply rules check\n     *\n     * @param AbstractItem $item\n     * @return bool\n     *\/",219],["T_WHITESPACE","\n    ",224],["T_PUBLIC","public",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","canApplyRules",225],"(",["T_STRING","AbstractItem",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$item",225],")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$address",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$item",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getAddress",227],"(",")",";",["T_WHITESPACE","\n        ",227],["T_FOREACH","foreach",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_getRules",228],"(",["T_VARIABLE","$address",228],")",["T_WHITESPACE"," ",228],["T_AS","as",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$rule",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(","!",["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","validatorUtility",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","canProcessRule",229],"(",["T_VARIABLE","$rule",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$address",229],")",["T_WHITESPACE"," ",229],["T_BOOLEAN_OR","||",229],["T_WHITESPACE"," ",229],"!",["T_VARIABLE","$rule",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getActions",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","validate",229],"(",["T_VARIABLE","$item",229],")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_STRING","false",230],";",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_STRING","true",234],";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Reset quote and address applied rules\n     *\n     * @param Address $address\n     * @return $this\n     *\/",237],["T_WHITESPACE","\n    ",242],["T_PUBLIC","public",243],["T_WHITESPACE"," ",243],["T_FUNCTION","function",243],["T_WHITESPACE"," ",243],["T_STRING","reset",243],"(",["T_STRING","Address",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$address",243],")",["T_WHITESPACE","\n    ",243],"{",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","validatorUtility",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","resetRoundingDeltas",245],"(",")",";",["T_WHITESPACE","\n        ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_isFirstTimeResetRun",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$address",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setAppliedRuleIds",247],"(",["T_CONSTANT_ENCAPSED_STRING","''",247],")",";",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$address",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getQuote",248],"(",")",["T_OBJECT_OPERATOR","->",248],["T_STRING","setAppliedRuleIds",248],"(",["T_CONSTANT_ENCAPSED_STRING","''",248],")",";",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","_isFirstTimeResetRun",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_STRING","false",249],";",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE","\n\n        ",250],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Quote item discount calculation process\n     *\n     * @param AbstractItem $item\n     * @return $this\n     *\/",255],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","process",261],"(",["T_STRING","AbstractItem",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$item",261],")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$item",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","setDiscountAmount",263],"(",["T_LNUMBER","0",263],")",";",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$item",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","setBaseDiscountAmount",264],"(",["T_LNUMBER","0",264],")",";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$item",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setDiscountPercent",265],"(",["T_LNUMBER","0",265],")",";",["T_WHITESPACE","\n\n        ",265],["T_VARIABLE","$itemPrice",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getItemPrice",267],"(",["T_VARIABLE","$item",267],")",";",["T_WHITESPACE","\n        ",267],["T_IF","if",268],["T_WHITESPACE"," ",268],"(",["T_VARIABLE","$itemPrice",268],["T_WHITESPACE"," ",268],"<",["T_WHITESPACE"," ",268],["T_LNUMBER","0",268],")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n\n        ",270],["T_VARIABLE","$appliedRuleIds",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","rulesApplier",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","applyRules",272],"(",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$item",273],",",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getRules",274],"(",["T_VARIABLE","$item",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getAddress",274],"(",")",")",",",["T_WHITESPACE","\n            ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_skipActionsValidation",275],",",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getCouponCode",276],"(",")",["T_WHITESPACE","\n        ",276],")",";",["T_WHITESPACE","\n        ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","rulesApplier",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","setAppliedRuleIds",278],"(",["T_VARIABLE","$item",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$appliedRuleIds",278],")",";",["T_WHITESPACE","\n\n        ",278],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Apply discounts to shipping amount\n     *\n     * @param Address $address\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",283],["T_WHITESPACE","\n    ",289],["T_PUBLIC","public",290],["T_WHITESPACE"," ",290],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","processShippingAmount",290],"(",["T_STRING","Address",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$address",290],")",["T_WHITESPACE","\n    ",290],"{",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$shippingAmount",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$address",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getShippingAmountForDiscount",292],"(",")",";",["T_WHITESPACE","\n        ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$shippingAmount",293],["T_WHITESPACE"," ",293],["T_IS_NOT_IDENTICAL","!==",293],["T_WHITESPACE"," ",293],["T_STRING","null",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n            ",293],["T_VARIABLE","$baseShippingAmount",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$address",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getBaseShippingAmountForDiscount",294],"(",")",";",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE"," ",295],["T_ELSE","else",295],["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$shippingAmount",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$address",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getShippingAmount",296],"(",")",";",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$baseShippingAmount",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$address",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getBaseShippingAmount",297],"(",")",";",["T_WHITESPACE","\n        ",297],"}",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$quote",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$address",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getQuote",299],"(",")",";",["T_WHITESPACE","\n        ",299],["T_VARIABLE","$appliedRuleIds",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],"[","]",";",["T_WHITESPACE","\n        ",300],["T_FOREACH","foreach",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_getRules",301],"(",["T_VARIABLE","$address",301],")",["T_WHITESPACE"," ",301],["T_AS","as",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$rule",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_COMMENT","\/* @var \\Magento\\SalesRule\\Model\\Rule $rule *\/",302],["T_WHITESPACE","\n            ",302],["T_IF","if",303],["T_WHITESPACE"," ",303],"(","!",["T_VARIABLE","$rule",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getApplyToShipping",303],"(",")",["T_WHITESPACE"," ",303],["T_BOOLEAN_OR","||",303],["T_WHITESPACE"," ",303],"!",["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","validatorUtility",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","canProcessRule",303],"(",["T_VARIABLE","$rule",303],",",["T_WHITESPACE"," ",303],["T_VARIABLE","$address",303],")",")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                ",303],["T_CONTINUE","continue",304],";",["T_WHITESPACE","\n            ",304],"}",["T_WHITESPACE","\n\n            ",305],["T_VARIABLE","$discountAmount",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_LNUMBER","0",307],";",["T_WHITESPACE","\n            ",307],["T_VARIABLE","$baseDiscountAmount",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_LNUMBER","0",308],";",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$rulePercent",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_STRING","min",309],"(",["T_LNUMBER","100",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$rule",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getDiscountAmount",309],"(",")",")",";",["T_WHITESPACE","\n            ",309],["T_SWITCH","switch",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$rule",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getSimpleAction",310],"(",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                ",310],["T_CASE","case",311],["T_WHITESPACE"," ",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Magento",311],["T_NS_SEPARATOR","\\",311],["T_STRING","SalesRule",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Model",311],["T_NS_SEPARATOR","\\",311],["T_STRING","Rule",311],["T_DOUBLE_COLON","::",311],["T_STRING","TO_PERCENT_ACTION",311],":",["T_WHITESPACE","\n                    ",311],["T_VARIABLE","$rulePercent",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_STRING","max",312],"(",["T_LNUMBER","0",312],",",["T_WHITESPACE"," ",312],["T_LNUMBER","100",312],["T_WHITESPACE"," ",312],"-",["T_WHITESPACE"," ",312],["T_VARIABLE","$rule",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getDiscountAmount",312],"(",")",")",";",["T_WHITESPACE","\n                ",312],["T_COMMENT","\/\/ break is intentionally omitted\n",313],["T_WHITESPACE","                ",314],["T_CASE","case",314],["T_WHITESPACE"," ",314],["T_NS_SEPARATOR","\\",314],["T_STRING","Magento",314],["T_NS_SEPARATOR","\\",314],["T_STRING","SalesRule",314],["T_NS_SEPARATOR","\\",314],["T_STRING","Model",314],["T_NS_SEPARATOR","\\",314],["T_STRING","Rule",314],["T_DOUBLE_COLON","::",314],["T_STRING","BY_PERCENT_ACTION",314],":",["T_WHITESPACE","\n                    ",314],["T_VARIABLE","$discountAmount",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$shippingAmount",315],["T_WHITESPACE"," ",315],"-",["T_WHITESPACE"," ",315],["T_VARIABLE","$address",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getShippingDiscountAmount",315],"(",")",")",["T_WHITESPACE"," ",315],"*",["T_WHITESPACE"," ",315],["T_VARIABLE","$rulePercent",315],["T_WHITESPACE"," ",315],"\/",["T_WHITESPACE"," ",315],["T_LNUMBER","100",315],";",["T_WHITESPACE","\n                    ",315],["T_VARIABLE","$baseDiscountAmount",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$baseShippingAmount",316],["T_WHITESPACE"," ",316],"-",["T_WHITESPACE","\n                            ",316],["T_VARIABLE","$address",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getBaseShippingDiscountAmount",317],"(",")",")",["T_WHITESPACE"," ",317],"*",["T_WHITESPACE"," ",317],["T_VARIABLE","$rulePercent",317],["T_WHITESPACE"," ",317],"\/",["T_WHITESPACE"," ",317],["T_LNUMBER","100",317],";",["T_WHITESPACE","\n                    ",317],["T_VARIABLE","$discountPercent",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","min",318],"(",["T_LNUMBER","100",318],",",["T_WHITESPACE"," ",318],["T_VARIABLE","$address",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getShippingDiscountPercent",318],"(",")",["T_WHITESPACE"," ",318],"+",["T_WHITESPACE"," ",318],["T_VARIABLE","$rulePercent",318],")",";",["T_WHITESPACE","\n                    ",318],["T_VARIABLE","$address",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","setShippingDiscountPercent",319],"(",["T_VARIABLE","$discountPercent",319],")",";",["T_WHITESPACE","\n                    ",319],["T_BREAK","break",320],";",["T_WHITESPACE","\n                ",320],["T_CASE","case",321],["T_WHITESPACE"," ",321],["T_NS_SEPARATOR","\\",321],["T_STRING","Magento",321],["T_NS_SEPARATOR","\\",321],["T_STRING","SalesRule",321],["T_NS_SEPARATOR","\\",321],["T_STRING","Model",321],["T_NS_SEPARATOR","\\",321],["T_STRING","Rule",321],["T_DOUBLE_COLON","::",321],["T_STRING","TO_FIXED_ACTION",321],":",["T_WHITESPACE","\n                    ",321],["T_VARIABLE","$quoteAmount",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","priceCurrency",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","convert",322],"(",["T_VARIABLE","$rule",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getDiscountAmount",322],"(",")",",",["T_WHITESPACE"," ",322],["T_VARIABLE","$quote",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getStore",322],"(",")",")",";",["T_WHITESPACE","\n                    ",322],["T_VARIABLE","$discountAmount",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$shippingAmount",323],["T_WHITESPACE"," ",323],"-",["T_WHITESPACE"," ",323],["T_VARIABLE","$quoteAmount",323],";",["T_WHITESPACE","\n                    ",323],["T_VARIABLE","$baseDiscountAmount",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_VARIABLE","$baseShippingAmount",324],["T_WHITESPACE"," ",324],"-",["T_WHITESPACE"," ",324],["T_VARIABLE","$rule",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getDiscountAmount",324],"(",")",";",["T_WHITESPACE","\n                    ",324],["T_BREAK","break",325],";",["T_WHITESPACE","\n                ",325],["T_CASE","case",326],["T_WHITESPACE"," ",326],["T_NS_SEPARATOR","\\",326],["T_STRING","Magento",326],["T_NS_SEPARATOR","\\",326],["T_STRING","SalesRule",326],["T_NS_SEPARATOR","\\",326],["T_STRING","Model",326],["T_NS_SEPARATOR","\\",326],["T_STRING","Rule",326],["T_DOUBLE_COLON","::",326],["T_STRING","BY_FIXED_ACTION",326],":",["T_WHITESPACE","\n                    ",326],["T_VARIABLE","$quoteAmount",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","priceCurrency",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","convert",327],"(",["T_VARIABLE","$rule",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getDiscountAmount",327],"(",")",",",["T_WHITESPACE"," ",327],["T_VARIABLE","$quote",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getStore",327],"(",")",")",";",["T_WHITESPACE","\n                    ",327],["T_VARIABLE","$discountAmount",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$quoteAmount",328],";",["T_WHITESPACE","\n                    ",328],["T_VARIABLE","$baseDiscountAmount",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$rule",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getDiscountAmount",329],"(",")",";",["T_WHITESPACE","\n                    ",329],["T_BREAK","break",330],";",["T_WHITESPACE","\n                ",330],["T_CASE","case",331],["T_WHITESPACE"," ",331],["T_NS_SEPARATOR","\\",331],["T_STRING","Magento",331],["T_NS_SEPARATOR","\\",331],["T_STRING","SalesRule",331],["T_NS_SEPARATOR","\\",331],["T_STRING","Model",331],["T_NS_SEPARATOR","\\",331],["T_STRING","Rule",331],["T_DOUBLE_COLON","::",331],["T_STRING","CART_FIXED_ACTION",331],":",["T_WHITESPACE","\n                    ",331],["T_VARIABLE","$cartRules",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$address",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getCartFixedRules",332],"(",")",";",["T_WHITESPACE","\n                    ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(","!",["T_ISSET","isset",333],"(",["T_VARIABLE","$cartRules",333],"[",["T_VARIABLE","$rule",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getId",333],"(",")","]",")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                        ",333],["T_VARIABLE","$cartRules",334],"[",["T_VARIABLE","$rule",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getId",334],"(",")","]",["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$rule",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getDiscountAmount",334],"(",")",";",["T_WHITESPACE","\n                    ",334],"}",["T_WHITESPACE","\n                    ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$cartRules",336],"[",["T_VARIABLE","$rule",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getId",336],"(",")","]",["T_WHITESPACE"," ",336],">",["T_WHITESPACE"," ",336],["T_LNUMBER","0",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n                        ",336],["T_VARIABLE","$quoteAmount",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","priceCurrency",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","convert",337],"(",["T_VARIABLE","$cartRules",337],"[",["T_VARIABLE","$rule",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getId",337],"(",")","]",",",["T_WHITESPACE"," ",337],["T_VARIABLE","$quote",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getStore",337],"(",")",")",";",["T_WHITESPACE","\n                        ",337],["T_VARIABLE","$discountAmount",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_STRING","min",338],"(",["T_VARIABLE","$shippingAmount",338],["T_WHITESPACE"," ",338],"-",["T_WHITESPACE"," ",338],["T_VARIABLE","$address",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getShippingDiscountAmount",338],"(",")",",",["T_WHITESPACE"," ",338],["T_VARIABLE","$quoteAmount",338],")",";",["T_WHITESPACE","\n                        ",338],["T_VARIABLE","$baseDiscountAmount",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_STRING","min",339],"(",["T_WHITESPACE","\n                            ",339],["T_VARIABLE","$baseShippingAmount",340],["T_WHITESPACE"," ",340],"-",["T_WHITESPACE"," ",340],["T_VARIABLE","$address",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getBaseShippingDiscountAmount",340],"(",")",",",["T_WHITESPACE","\n                            ",340],["T_VARIABLE","$cartRules",341],"[",["T_VARIABLE","$rule",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getId",341],"(",")","]",["T_WHITESPACE","\n                        ",341],")",";",["T_WHITESPACE","\n                        ",342],["T_VARIABLE","$cartRules",343],"[",["T_VARIABLE","$rule",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getId",343],"(",")","]",["T_WHITESPACE"," ",343],["T_MINUS_EQUAL","-=",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$baseDiscountAmount",343],";",["T_WHITESPACE","\n                    ",343],"}",["T_WHITESPACE","\n\n                    ",344],["T_VARIABLE","$address",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","setCartFixedRules",346],"(",["T_VARIABLE","$cartRules",346],")",";",["T_WHITESPACE","\n                    ",346],["T_BREAK","break",347],";",["T_WHITESPACE","\n            ",347],"}",["T_WHITESPACE","\n\n            ",348],["T_VARIABLE","$discountAmount",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_STRING","min",350],"(",["T_VARIABLE","$address",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getShippingDiscountAmount",350],"(",")",["T_WHITESPACE"," ",350],"+",["T_WHITESPACE"," ",350],["T_VARIABLE","$discountAmount",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$shippingAmount",350],")",";",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$baseDiscountAmount",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","min",351],"(",["T_WHITESPACE","\n                ",351],["T_VARIABLE","$address",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getBaseShippingDiscountAmount",352],"(",")",["T_WHITESPACE"," ",352],"+",["T_WHITESPACE"," ",352],["T_VARIABLE","$baseDiscountAmount",352],",",["T_WHITESPACE","\n                ",352],["T_VARIABLE","$baseShippingAmount",353],["T_WHITESPACE","\n            ",353],")",";",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$address",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","setShippingDiscountAmount",355],"(",["T_VARIABLE","$discountAmount",355],")",";",["T_WHITESPACE","\n            ",355],["T_VARIABLE","$address",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","setBaseShippingDiscountAmount",356],"(",["T_VARIABLE","$baseDiscountAmount",356],")",";",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$appliedRuleIds",357],"[",["T_VARIABLE","$rule",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getRuleId",357],"(",")","]",["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$rule",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getRuleId",357],"(",")",";",["T_WHITESPACE","\n\n            ",357],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","rulesApplier",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","maintainAddressCouponCode",359],"(",["T_VARIABLE","$address",359],",",["T_WHITESPACE"," ",359],["T_VARIABLE","$rule",359],",",["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getCouponCode",359],"(",")",")",";",["T_WHITESPACE","\n            ",359],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","rulesApplier",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","addDiscountDescription",360],"(",["T_VARIABLE","$address",360],",",["T_WHITESPACE"," ",360],["T_VARIABLE","$rule",360],")",";",["T_WHITESPACE","\n            ",360],["T_IF","if",361],["T_WHITESPACE"," ",361],"(",["T_VARIABLE","$rule",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getStopRulesProcessing",361],"(",")",")",["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n                ",361],["T_BREAK","break",362],";",["T_WHITESPACE","\n            ",362],"}",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE","\n\n        ",364],["T_VARIABLE","$address",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","setAppliedRuleIds",366],"(",["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","validatorUtility",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","mergeIds",366],"(",["T_VARIABLE","$address",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getAppliedRuleIds",366],"(",")",",",["T_WHITESPACE"," ",366],["T_VARIABLE","$appliedRuleIds",366],")",")",";",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$quote",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","setAppliedRuleIds",367],"(",["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","validatorUtility",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","mergeIds",367],"(",["T_VARIABLE","$quote",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getAppliedRuleIds",367],"(",")",",",["T_WHITESPACE"," ",367],["T_VARIABLE","$appliedRuleIds",367],")",")",";",["T_WHITESPACE","\n\n        ",367],["T_RETURN","return",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],";",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Calculate quote totals for each rule and save results\n     *\n     * @param mixed $items\n     * @param Address $address\n     * @return $this\n     *\/",372],["T_WHITESPACE","\n    ",378],["T_PUBLIC","public",379],["T_WHITESPACE"," ",379],["T_FUNCTION","function",379],["T_WHITESPACE"," ",379],["T_STRING","initTotals",379],"(",["T_VARIABLE","$items",379],",",["T_WHITESPACE"," ",379],["T_STRING","Address",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$address",379],")",["T_WHITESPACE","\n    ",379],"{",["T_WHITESPACE","\n        ",380],["T_VARIABLE","$address",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","setCartFixedRules",381],"(","[","]",")",";",["T_WHITESPACE","\n\n        ",381],["T_IF","if",383],["T_WHITESPACE"," ",383],"(","!",["T_VARIABLE","$items",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n            ",383],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],";",["T_WHITESPACE","\n        ",384],"}",["T_WHITESPACE","\n\n        ",385],["T_DOC_COMMENT","\/** @var \\Magento\\SalesRule\\Model\\Rule $rule *\/",387],["T_WHITESPACE","\n        ",387],["T_FOREACH","foreach",388],["T_WHITESPACE"," ",388],"(",["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_getRules",388],"(",["T_VARIABLE","$address",388],")",["T_WHITESPACE"," ",388],["T_AS","as",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$rule",388],")",["T_WHITESPACE"," ",388],"{",["T_WHITESPACE","\n            ",388],["T_IF","if",389],["T_WHITESPACE"," ",389],"(",["T_NS_SEPARATOR","\\",389],["T_STRING","Magento",389],["T_NS_SEPARATOR","\\",389],["T_STRING","SalesRule",389],["T_NS_SEPARATOR","\\",389],["T_STRING","Model",389],["T_NS_SEPARATOR","\\",389],["T_STRING","Rule",389],["T_DOUBLE_COLON","::",389],["T_STRING","CART_FIXED_ACTION",389],["T_WHITESPACE"," ",389],["T_IS_EQUAL","==",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$rule",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getSimpleAction",389],"(",")",["T_WHITESPACE","\n                ",389],["T_BOOLEAN_AND","&&",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","validatorUtility",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","canProcessRule",390],"(",["T_VARIABLE","$rule",390],",",["T_WHITESPACE"," ",390],["T_VARIABLE","$address",390],")",["T_WHITESPACE","\n            ",390],")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n                ",391],["T_VARIABLE","$ruleTotalItemsPrice",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_LNUMBER","0",392],";",["T_WHITESPACE","\n                ",392],["T_VARIABLE","$ruleTotalBaseItemsPrice",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_LNUMBER","0",393],";",["T_WHITESPACE","\n                ",393],["T_VARIABLE","$validItemsCount",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_LNUMBER","0",394],";",["T_WHITESPACE","\n\n                ",394],["T_FOREACH","foreach",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$items",396],["T_WHITESPACE"," ",396],["T_AS","as",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$item",396],")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n                    ",396],["T_COMMENT","\/\/Skipping child items to avoid double calculations\n",397],["T_WHITESPACE","                    ",398],["T_IF","if",398],["T_WHITESPACE"," ",398],"(",["T_VARIABLE","$item",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getParentItemId",398],"(",")",")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n                        ",398],["T_CONTINUE","continue",399],";",["T_WHITESPACE","\n                    ",399],"}",["T_WHITESPACE","\n                    ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(","!",["T_VARIABLE","$rule",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getActions",401],"(",")",["T_OBJECT_OPERATOR","->",401],["T_STRING","validate",401],"(",["T_VARIABLE","$item",401],")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n                        ",401],["T_CONTINUE","continue",402],";",["T_WHITESPACE","\n                    ",402],"}",["T_WHITESPACE","\n                    ",403],["T_IF","if",404],["T_WHITESPACE"," ",404],"(","!",["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","canApplyDiscount",404],"(",["T_VARIABLE","$item",404],")",")",["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n                        ",404],["T_CONTINUE","continue",405],";",["T_WHITESPACE","\n                    ",405],"}",["T_WHITESPACE","\n                    ",406],["T_VARIABLE","$qty",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","validatorUtility",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getItemQty",407],"(",["T_VARIABLE","$item",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$rule",407],")",";",["T_WHITESPACE","\n                    ",407],["T_VARIABLE","$ruleTotalItemsPrice",408],["T_WHITESPACE"," ",408],["T_PLUS_EQUAL","+=",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getItemPrice",408],"(",["T_VARIABLE","$item",408],")",["T_WHITESPACE"," ",408],"*",["T_WHITESPACE"," ",408],["T_VARIABLE","$qty",408],";",["T_WHITESPACE","\n                    ",408],["T_VARIABLE","$ruleTotalBaseItemsPrice",409],["T_WHITESPACE"," ",409],["T_PLUS_EQUAL","+=",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getItemBasePrice",409],"(",["T_VARIABLE","$item",409],")",["T_WHITESPACE"," ",409],"*",["T_WHITESPACE"," ",409],["T_VARIABLE","$qty",409],";",["T_WHITESPACE","\n                    ",409],["T_VARIABLE","$validItemsCount",410],["T_INC","++",410],";",["T_WHITESPACE","\n                ",410],"}",["T_WHITESPACE","\n\n                ",411],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_rulesItemTotals",413],"[",["T_VARIABLE","$rule",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getId",413],"(",")","]",["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],"[",["T_WHITESPACE","\n                    ",413],["T_CONSTANT_ENCAPSED_STRING","'items_price'",414],["T_WHITESPACE"," ",414],["T_DOUBLE_ARROW","=>",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$ruleTotalItemsPrice",414],",",["T_WHITESPACE","\n                    ",414],["T_CONSTANT_ENCAPSED_STRING","'base_items_price'",415],["T_WHITESPACE"," ",415],["T_DOUBLE_ARROW","=>",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$ruleTotalBaseItemsPrice",415],",",["T_WHITESPACE","\n                    ",415],["T_CONSTANT_ENCAPSED_STRING","'items_count'",416],["T_WHITESPACE"," ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$validItemsCount",416],",",["T_WHITESPACE","\n                ",416],"]",";",["T_WHITESPACE","\n            ",417],"}",["T_WHITESPACE","\n        ",418],"}",["T_WHITESPACE","\n\n        ",419],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Return item price\n     *\n     * @param AbstractItem $item\n     * @return float\n     *\/",424],["T_WHITESPACE","\n    ",429],["T_PUBLIC","public",430],["T_WHITESPACE"," ",430],["T_FUNCTION","function",430],["T_WHITESPACE"," ",430],["T_STRING","getItemPrice",430],"(",["T_VARIABLE","$item",430],")",["T_WHITESPACE","\n    ",430],"{",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$price",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_VARIABLE","$item",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getDiscountCalculationPrice",432],"(",")",";",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$calcPrice",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$item",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getCalculationPrice",433],"(",")",";",["T_WHITESPACE","\n        ",433],["T_RETURN","return",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$price",434],["T_WHITESPACE"," ",434],["T_IS_IDENTICAL","===",434],["T_WHITESPACE"," ",434],["T_STRING","null",434],["T_WHITESPACE"," ",434],"?",["T_WHITESPACE"," ",434],["T_VARIABLE","$calcPrice",434],["T_WHITESPACE"," ",434],":",["T_WHITESPACE"," ",434],["T_VARIABLE","$price",434],";",["T_WHITESPACE","\n    ",434],"}",["T_WHITESPACE","\n\n    ",435],["T_DOC_COMMENT","\/**\n     * Return item original price\n     *\n     * @param AbstractItem $item\n     * @return float\n     *\/",437],["T_WHITESPACE","\n    ",442],["T_PUBLIC","public",443],["T_WHITESPACE"," ",443],["T_FUNCTION","function",443],["T_WHITESPACE"," ",443],["T_STRING","getItemOriginalPrice",443],"(",["T_VARIABLE","$item",443],")",["T_WHITESPACE","\n    ",443],"{",["T_WHITESPACE","\n        ",444],["T_RETURN","return",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_catalogData",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getTaxPrice",445],"(",["T_VARIABLE","$item",445],",",["T_WHITESPACE"," ",445],["T_VARIABLE","$item",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getOriginalPrice",445],"(",")",",",["T_WHITESPACE"," ",445],["T_STRING","true",445],")",";",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * Return item base price\n     *\n     * @param AbstractItem $item\n     * @return float\n     *\/",448],["T_WHITESPACE","\n    ",453],["T_PUBLIC","public",454],["T_WHITESPACE"," ",454],["T_FUNCTION","function",454],["T_WHITESPACE"," ",454],["T_STRING","getItemBasePrice",454],"(",["T_VARIABLE","$item",454],")",["T_WHITESPACE","\n    ",454],"{",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$price",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_VARIABLE","$item",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getDiscountCalculationPrice",456],"(",")",";",["T_WHITESPACE","\n        ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$price",457],["T_WHITESPACE"," ",457],["T_IS_NOT_IDENTICAL","!==",457],["T_WHITESPACE"," ",457],["T_STRING","null",457],["T_WHITESPACE"," ",457],"?",["T_WHITESPACE"," ",457],["T_VARIABLE","$item",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getBaseDiscountCalculationPrice",457],"(",")",["T_WHITESPACE"," ",457],":",["T_WHITESPACE"," ",457],["T_VARIABLE","$item",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getBaseCalculationPrice",457],"(",")",";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Return item base original price\n     *\n     * @param AbstractItem $item\n     * @return float\n     *\/",460],["T_WHITESPACE","\n    ",465],["T_PUBLIC","public",466],["T_WHITESPACE"," ",466],["T_FUNCTION","function",466],["T_WHITESPACE"," ",466],["T_STRING","getItemBaseOriginalPrice",466],"(",["T_VARIABLE","$item",466],")",["T_WHITESPACE","\n    ",466],"{",["T_WHITESPACE","\n        ",467],["T_RETURN","return",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_catalogData",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getTaxPrice",468],"(",["T_VARIABLE","$item",468],",",["T_WHITESPACE"," ",468],["T_VARIABLE","$item",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getBaseOriginalPrice",468],"(",")",",",["T_WHITESPACE"," ",468],["T_STRING","true",468],")",";",["T_WHITESPACE","\n    ",468],"}",["T_WHITESPACE","\n\n    ",469],["T_DOC_COMMENT","\/**\n     * Convert address discount description array to string\n     *\n     * @param Address $address\n     * @param string $separator\n     * @return $this\n     *\/",471],["T_WHITESPACE","\n    ",477],["T_PUBLIC","public",478],["T_WHITESPACE"," ",478],["T_FUNCTION","function",478],["T_WHITESPACE"," ",478],["T_STRING","prepareDescription",478],"(",["T_VARIABLE","$address",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$separator",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_CONSTANT_ENCAPSED_STRING","', '",478],")",["T_WHITESPACE","\n    ",478],"{",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$descriptionArray",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$address",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getDiscountDescriptionArray",480],"(",")",";",["T_WHITESPACE","\n        ",480],["T_IF","if",481],["T_WHITESPACE"," ",481],"(","!",["T_VARIABLE","$descriptionArray",481],["T_WHITESPACE"," ",481],["T_BOOLEAN_AND","&&",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$address",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getQuote",481],"(",")",["T_OBJECT_OPERATOR","->",481],["T_STRING","getItemVirtualQty",481],"(",")",["T_WHITESPACE"," ",481],">",["T_WHITESPACE"," ",481],["T_LNUMBER","0",481],")",["T_WHITESPACE"," ",481],"{",["T_WHITESPACE","\n            ",481],["T_VARIABLE","$descriptionArray",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$address",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getQuote",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","getBillingAddress",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","getDiscountDescriptionArray",482],"(",")",";",["T_WHITESPACE","\n        ",482],"}",["T_WHITESPACE","\n\n        ",483],["T_VARIABLE","$description",485],["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_VARIABLE","$descriptionArray",485],["T_WHITESPACE"," ",485],["T_BOOLEAN_AND","&&",485],["T_WHITESPACE"," ",485],["T_STRING","is_array",485],"(",["T_WHITESPACE","\n            ",485],["T_VARIABLE","$descriptionArray",486],["T_WHITESPACE","\n        ",486],")",["T_WHITESPACE"," ",487],"?",["T_WHITESPACE"," ",487],["T_STRING","implode",487],"(",["T_WHITESPACE","\n            ",487],["T_VARIABLE","$separator",488],",",["T_WHITESPACE","\n            ",488],["T_STRING","array_unique",489],"(",["T_VARIABLE","$descriptionArray",489],")",["T_WHITESPACE","\n        ",489],")",["T_WHITESPACE"," ",490],":",["T_WHITESPACE"," ",490],["T_CONSTANT_ENCAPSED_STRING","''",490],";",["T_WHITESPACE","\n\n        ",490],["T_VARIABLE","$address",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","setDiscountDescription",492],"(",["T_VARIABLE","$description",492],")",";",["T_WHITESPACE","\n        ",492],["T_RETURN","return",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],";",["T_WHITESPACE","\n    ",493],"}",["T_WHITESPACE","\n\n    ",494],["T_DOC_COMMENT","\/**\n     * Return items list sorted by possibility to apply prioritized rules\n     *\n     * @param array $items\n     * @param Address $address\n     * @return array $items\n     *\/",496],["T_WHITESPACE","\n    ",502],["T_PUBLIC","public",503],["T_WHITESPACE"," ",503],["T_FUNCTION","function",503],["T_WHITESPACE"," ",503],["T_STRING","sortItemsByPriority",503],"(",["T_VARIABLE","$items",503],",",["T_WHITESPACE"," ",503],["T_STRING","Address",503],["T_WHITESPACE"," ",503],["T_VARIABLE","$address",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_STRING","null",503],")",["T_WHITESPACE","\n    ",503],"{",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$itemsSorted",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],"[","]",";",["T_WHITESPACE","\n        ",505],["T_DOC_COMMENT","\/** @var $rule \\Magento\\SalesRule\\Model\\Rule *\/",506],["T_WHITESPACE","\n        ",506],["T_FOREACH","foreach",507],["T_WHITESPACE"," ",507],"(",["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_getRules",507],"(",["T_VARIABLE","$address",507],")",["T_WHITESPACE"," ",507],["T_AS","as",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$rule",507],")",["T_WHITESPACE"," ",507],"{",["T_WHITESPACE","\n            ",507],["T_FOREACH","foreach",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$items",508],["T_WHITESPACE"," ",508],["T_AS","as",508],["T_WHITESPACE"," ",508],["T_VARIABLE","$itemKey",508],["T_WHITESPACE"," ",508],["T_DOUBLE_ARROW","=>",508],["T_WHITESPACE"," ",508],["T_VARIABLE","$itemValue",508],")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n                ",508],["T_IF","if",509],["T_WHITESPACE"," ",509],"(",["T_VARIABLE","$rule",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getActions",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","validate",509],"(",["T_VARIABLE","$itemValue",509],")",")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n                    ",509],["T_UNSET","unset",510],"(",["T_VARIABLE","$items",510],"[",["T_VARIABLE","$itemKey",510],"]",")",";",["T_WHITESPACE","\n                    ",510],["T_STRING","array_push",511],"(",["T_VARIABLE","$itemsSorted",511],",",["T_WHITESPACE"," ",511],["T_VARIABLE","$itemValue",511],")",";",["T_WHITESPACE","\n                ",511],"}",["T_WHITESPACE","\n            ",512],"}",["T_WHITESPACE","\n        ",513],"}",["T_WHITESPACE","\n\n        ",514],["T_IF","if",516],["T_WHITESPACE"," ",516],"(","!",["T_EMPTY","empty",516],"(",["T_VARIABLE","$itemsSorted",516],")",")",["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n            ",516],["T_VARIABLE","$items",517],["T_WHITESPACE"," ",517],"=",["T_WHITESPACE"," ",517],["T_STRING","array_merge",517],"(",["T_VARIABLE","$itemsSorted",517],",",["T_WHITESPACE"," ",517],["T_VARIABLE","$items",517],")",";",["T_WHITESPACE","\n        ",517],"}",["T_WHITESPACE","\n\n        ",518],["T_RETURN","return",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$items",520],";",["T_WHITESPACE","\n    ",520],"}",["T_WHITESPACE","\n\n    ",521],["T_DOC_COMMENT","\/**\n     * @param int $key\n     * @return array\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",523],["T_WHITESPACE","\n    ",527],["T_PUBLIC","public",528],["T_WHITESPACE"," ",528],["T_FUNCTION","function",528],["T_WHITESPACE"," ",528],["T_STRING","getRuleItemTotalsInfo",528],"(",["T_VARIABLE","$key",528],")",["T_WHITESPACE","\n    ",528],"{",["T_WHITESPACE","\n        ",529],["T_IF","if",530],["T_WHITESPACE"," ",530],"(",["T_EMPTY","empty",530],"(",["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","_rulesItemTotals",530],"[",["T_VARIABLE","$key",530],"]",")",")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n            ",530],["T_THROW","throw",531],["T_WHITESPACE"," ",531],["T_NEW","new",531],["T_WHITESPACE"," ",531],["T_NS_SEPARATOR","\\",531],["T_STRING","Magento",531],["T_NS_SEPARATOR","\\",531],["T_STRING","Framework",531],["T_NS_SEPARATOR","\\",531],["T_STRING","Exception",531],["T_NS_SEPARATOR","\\",531],["T_STRING","LocalizedException",531],"(",["T_STRING","__",531],"(",["T_CONSTANT_ENCAPSED_STRING","'Item totals are not set for the rule.'",531],")",")",";",["T_WHITESPACE","\n        ",531],"}",["T_WHITESPACE","\n\n        ",532],["T_RETURN","return",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_rulesItemTotals",534],"[",["T_VARIABLE","$key",534],"]",";",["T_WHITESPACE","\n    ",534],"}",["T_WHITESPACE","\n\n    ",535],["T_DOC_COMMENT","\/**\n     * @param int $key\n     * @return $this\n     *\/",537],["T_WHITESPACE","\n    ",540],["T_PUBLIC","public",541],["T_WHITESPACE"," ",541],["T_FUNCTION","function",541],["T_WHITESPACE"," ",541],["T_STRING","decrementRuleItemTotalsCount",541],"(",["T_VARIABLE","$key",541],")",["T_WHITESPACE","\n    ",541],"{",["T_WHITESPACE","\n        ",542],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","_rulesItemTotals",543],"[",["T_VARIABLE","$key",543],"]","[",["T_CONSTANT_ENCAPSED_STRING","'items_count'",543],"]",["T_DEC","--",543],";",["T_WHITESPACE","\n\n        ",543],["T_RETURN","return",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Check if we can apply discount to current QuoteItem\n     *\n     * @param AbstractItem $item\n     * @return bool\n     *\/",548],["T_WHITESPACE","\n    ",553],["T_PUBLIC","public",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","canApplyDiscount",554],"(",["T_STRING","AbstractItem",554],["T_WHITESPACE"," ",554],["T_VARIABLE","$item",554],")",["T_WHITESPACE","\n    ",554],"{",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$result",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_STRING","true",556],";",["T_WHITESPACE","\n        ",556],["T_DOC_COMMENT","\/** @var \\Zend_Validate_Interface $validator *\/",557],["T_WHITESPACE","\n        ",557],["T_FOREACH","foreach",558],["T_WHITESPACE"," ",558],"(",["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","validators",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getValidators",558],"(",["T_CONSTANT_ENCAPSED_STRING","'discount'",558],")",["T_WHITESPACE"," ",558],["T_AS","as",558],["T_WHITESPACE"," ",558],["T_VARIABLE","$validator",558],")",["T_WHITESPACE"," ",558],"{",["T_WHITESPACE","\n            ",558],["T_VARIABLE","$result",559],["T_WHITESPACE"," ",559],"=",["T_WHITESPACE"," ",559],["T_VARIABLE","$validator",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","isValid",559],"(",["T_VARIABLE","$item",559],")",";",["T_WHITESPACE","\n            ",559],["T_IF","if",560],["T_WHITESPACE"," ",560],"(","!",["T_VARIABLE","$result",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n                ",560],["T_BREAK","break",561],";",["T_WHITESPACE","\n            ",561],"}",["T_WHITESPACE","\n        ",562],"}",["T_WHITESPACE","\n        ",563],["T_RETURN","return",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$result",564],";",["T_WHITESPACE","\n    ",564],"}",["T_WHITESPACE","\n",565],"}",["T_WHITESPACE","\n",566]]