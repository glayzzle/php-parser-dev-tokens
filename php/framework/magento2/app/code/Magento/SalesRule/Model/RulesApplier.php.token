[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SalesRule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Address",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Class RulesApplier\n * @package Magento\\SalesRule\\Model\\Validator\n *\/",10],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","RulesApplier",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Application Event Dispatcher\n     *\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",16],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$_eventManager",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\Utility\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$validatorUtility",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\CalculatorFactory $calculatorFactory\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param \\Magento\\SalesRule\\Model\\Utility $utility\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","__construct",33],"(",["T_WHITESPACE","\n        ",33],["T_NS_SEPARATOR","\\",34],["T_STRING","Magento",34],["T_NS_SEPARATOR","\\",34],["T_STRING","SalesRule",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Model",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Rule",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Action",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Discount",34],["T_NS_SEPARATOR","\\",34],["T_STRING","CalculatorFactory",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$calculatorFactory",34],",",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Framework",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Event",35],["T_NS_SEPARATOR","\\",35],["T_STRING","ManagerInterface",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$eventManager",35],",",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","SalesRule",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Utility",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$utility",36],["T_WHITESPACE","\n    ",36],")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","calculatorFactory",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$calculatorFactory",38],";",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","validatorUtility",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$utility",39],";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","_eventManager",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$eventManager",40],";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Apply rules to current order item\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\SalesRule\\Model\\ResourceModel\\Rule\\Collection $rules\n     * @param bool $skipValidation\n     * @param mixed $couponCode\n     * @return array\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",43],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","applyRules",53],"(",["T_VARIABLE","$item",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$rules",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$skipValidation",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$couponCode",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$address",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$item",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getAddress",55],"(",")",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$appliedRuleIds",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],"[","]",";",["T_WHITESPACE","\n        ",56],["T_COMMENT","\/* @var $rule \\Magento\\SalesRule\\Model\\Rule *\/",57],["T_WHITESPACE","\n        ",57],["T_FOREACH","foreach",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$rules",58],["T_WHITESPACE"," ",58],["T_AS","as",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$rule",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(","!",["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","validatorUtility",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","canProcessRule",59],"(",["T_VARIABLE","$rule",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$address",59],")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n                ",59],["T_CONTINUE","continue",60],";",["T_WHITESPACE","\n            ",60],"}",["T_WHITESPACE","\n\n            ",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(","!",["T_VARIABLE","$skipValidation",63],["T_WHITESPACE"," ",63],["T_BOOLEAN_AND","&&",63],["T_WHITESPACE"," ",63],"!",["T_VARIABLE","$rule",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getActions",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","validate",63],"(",["T_VARIABLE","$item",63],")",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n                ",63],["T_VARIABLE","$childItems",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$item",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getChildren",64],"(",")",";",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$isContinue",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","true",65],";",["T_WHITESPACE","\n                ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(","!",["T_EMPTY","empty",66],"(",["T_VARIABLE","$childItems",66],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n                    ",66],["T_FOREACH","foreach",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$childItems",67],["T_WHITESPACE"," ",67],["T_AS","as",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$childItem",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$rule",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getActions",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","validate",68],"(",["T_VARIABLE","$childItem",68],")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n                            ",68],["T_VARIABLE","$isContinue",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","false",69],";",["T_WHITESPACE","\n                        ",69],"}",["T_WHITESPACE","\n                    ",70],"}",["T_WHITESPACE","\n                ",71],"}",["T_WHITESPACE","\n                ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$isContinue",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                    ",73],["T_CONTINUE","continue",74],";",["T_WHITESPACE","\n                ",74],"}",["T_WHITESPACE","\n            ",75],"}",["T_WHITESPACE","\n\n            ",76],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","applyRule",78],"(",["T_VARIABLE","$item",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$rule",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$address",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$couponCode",78],")",";",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$appliedRuleIds",79],"[",["T_VARIABLE","$rule",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getRuleId",79],"(",")","]",["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$rule",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getRuleId",79],"(",")",";",["T_WHITESPACE","\n\n            ",79],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$rule",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getStopRulesProcessing",81],"(",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                ",81],["T_BREAK","break",82],";",["T_WHITESPACE","\n            ",82],"}",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n\n        ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$appliedRuleIds",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Add rule discount description label to address object\n     *\n     * @param Address $address\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @return $this\n     *\/",89],["T_WHITESPACE","\n    ",95],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","addDiscountDescription",96],"(",["T_VARIABLE","$address",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$rule",96],")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$description",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$address",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getDiscountDescriptionArray",98],"(",")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$ruleLabel",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$rule",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getStoreLabel",99],"(",["T_VARIABLE","$address",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getQuote",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getStore",99],"(",")",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$label",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","''",100],";",["T_WHITESPACE","\n        ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$ruleLabel",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$label",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$ruleLabel",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE"," ",103],["T_ELSE","else",103],["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_STRING","strlen",104],"(",["T_VARIABLE","$address",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getCouponCode",104],"(",")",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$label",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$address",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getCouponCode",105],"(",")",";",["T_WHITESPACE","\n            ",105],"}",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n\n        ",107],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_STRING","strlen",109],"(",["T_VARIABLE","$label",109],")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$description",110],"[",["T_VARIABLE","$rule",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getId",110],"(",")","]",["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$label",110],";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$address",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","setDiscountDescriptionArray",113],"(",["T_VARIABLE","$description",113],")",";",["T_WHITESPACE","\n\n        ",113],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param \\Magento\\Quote\\Model\\Quote\\Address $address\n     * @param mixed $couponCode\n     * @return $this\n     *\/",118],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","applyRule",125],"(",["T_VARIABLE","$item",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$rule",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$address",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$couponCode",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$discountData",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getDiscountData",127],"(",["T_VARIABLE","$item",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$rule",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","setDiscountData",128],"(",["T_VARIABLE","$discountData",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$item",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","maintainAddressCouponCode",130],"(",["T_VARIABLE","$address",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$rule",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$couponCode",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","addDiscountDescription",131],"(",["T_VARIABLE","$address",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$rule",131],")",";",["T_WHITESPACE","\n\n        ",131],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @return \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data\n     *\/",136],["T_WHITESPACE","\n    ",140],["T_PROTECTED","protected",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","getDiscountData",141],"(",["T_VARIABLE","$item",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$rule",141],")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$qty",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","validatorUtility",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getItemQty",143],"(",["T_VARIABLE","$item",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$rule",143],")",";",["T_WHITESPACE","\n\n        ",143],["T_VARIABLE","$discountCalculator",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","calculatorFactory",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","create",145],"(",["T_VARIABLE","$rule",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getSimpleAction",145],"(",")",")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$qty",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$discountCalculator",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","fixQuantity",146],"(",["T_VARIABLE","$qty",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$rule",146],")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$discountData",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$discountCalculator",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","calculate",147],"(",["T_VARIABLE","$rule",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$item",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$qty",147],")",";",["T_WHITESPACE","\n\n        ",147],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","eventFix",149],"(",["T_VARIABLE","$discountData",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$item",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$rule",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$qty",149],")",";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","validatorUtility",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","deltaRoundingFix",150],"(",["T_VARIABLE","$discountData",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$item",150],")",";",["T_WHITESPACE","\n\n        ",150],["T_DOC_COMMENT","\/**\n         * We can't use row total here because row total not include tax\n         * Discount can be applied on price included tax\n         *\/",152],["T_WHITESPACE","\n\n        ",155],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","validatorUtility",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","minFix",157],"(",["T_VARIABLE","$discountData",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$item",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$qty",157],")",";",["T_WHITESPACE","\n\n        ",157],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$discountData",159],";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n\n    ",160],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data $discountData\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @return $this\n     *\/",162],["T_WHITESPACE","\n    ",166],["T_PROTECTED","protected",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","setDiscountData",167],"(",["T_VARIABLE","$discountData",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$item",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$item",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","setDiscountAmount",169],"(",["T_VARIABLE","$discountData",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getAmount",169],"(",")",")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$item",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","setBaseDiscountAmount",170],"(",["T_VARIABLE","$discountData",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getBaseAmount",170],"(",")",")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$item",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setOriginalDiscountAmount",171],"(",["T_VARIABLE","$discountData",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getOriginalAmount",171],"(",")",")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$item",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","setBaseOriginalDiscountAmount",172],"(",["T_VARIABLE","$discountData",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getBaseOriginalAmount",172],"(",")",")",";",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Set coupon code to address if $rule contains validated coupon\n     *\n     * @param Address $address\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param mixed $couponCode\n     * @return $this\n     *\/",177],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","maintainAddressCouponCode",185],"(",["T_VARIABLE","$address",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$rule",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$couponCode",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_COMMENT","\/*\n        Rule is a part of rules collection, which includes only rules with 'No Coupon' type or with validated coupon.\n        As a result, if rule uses coupon code(s) ('Specific' or 'Auto' Coupon Type), it always contains validated coupon\n        *\/",187],["T_WHITESPACE","\n        ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$rule",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getCouponType",191],"(",")",["T_WHITESPACE"," ",191],["T_IS_NOT_EQUAL","!=",191],["T_WHITESPACE"," ",191],["T_NS_SEPARATOR","\\",191],["T_STRING","Magento",191],["T_NS_SEPARATOR","\\",191],["T_STRING","SalesRule",191],["T_NS_SEPARATOR","\\",191],["T_STRING","Model",191],["T_NS_SEPARATOR","\\",191],["T_STRING","Rule",191],["T_DOUBLE_COLON","::",191],["T_STRING","COUPON_TYPE_NO_COUPON",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$address",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","setCouponCode",192],"(",["T_VARIABLE","$couponCode",192],")",";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n\n        ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Fire event to allow overwriting of discount amounts\n     *\n     * @param \\Magento\\SalesRule\\Model\\Rule\\Action\\Discount\\Data $discountData\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param float $qty\n     * @return $this\n     *\/",198],["T_WHITESPACE","\n    ",206],["T_PROTECTED","protected",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","eventFix",207],"(",["T_WHITESPACE","\n        ",207],["T_NS_SEPARATOR","\\",208],["T_STRING","Magento",208],["T_NS_SEPARATOR","\\",208],["T_STRING","SalesRule",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Model",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Rule",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Action",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Discount",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Data",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$discountData",208],",",["T_WHITESPACE","\n        ",208],["T_NS_SEPARATOR","\\",209],["T_STRING","Magento",209],["T_NS_SEPARATOR","\\",209],["T_STRING","Quote",209],["T_NS_SEPARATOR","\\",209],["T_STRING","Model",209],["T_NS_SEPARATOR","\\",209],["T_STRING","Quote",209],["T_NS_SEPARATOR","\\",209],["T_STRING","Item",209],["T_NS_SEPARATOR","\\",209],["T_STRING","AbstractItem",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$item",209],",",["T_WHITESPACE","\n        ",209],["T_NS_SEPARATOR","\\",210],["T_STRING","Magento",210],["T_NS_SEPARATOR","\\",210],["T_STRING","SalesRule",210],["T_NS_SEPARATOR","\\",210],["T_STRING","Model",210],["T_NS_SEPARATOR","\\",210],["T_STRING","Rule",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$rule",210],",",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$qty",211],["T_WHITESPACE","\n    ",211],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$quote",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$item",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getQuote",213],"(",")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$address",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$item",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getAddress",214],"(",")",";",["T_WHITESPACE","\n\n        ",214],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_eventManager",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","dispatch",216],"(",["T_WHITESPACE","\n            ",216],["T_CONSTANT_ENCAPSED_STRING","'salesrule_validator_process'",217],",",["T_WHITESPACE","\n            ",217],"[",["T_WHITESPACE","\n                ",218],["T_CONSTANT_ENCAPSED_STRING","'rule'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$rule",219],",",["T_WHITESPACE","\n                ",219],["T_CONSTANT_ENCAPSED_STRING","'item'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$item",220],",",["T_WHITESPACE","\n                ",220],["T_CONSTANT_ENCAPSED_STRING","'address'",221],["T_WHITESPACE"," ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$address",221],",",["T_WHITESPACE","\n                ",221],["T_CONSTANT_ENCAPSED_STRING","'quote'",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$quote",222],",",["T_WHITESPACE","\n                ",222],["T_CONSTANT_ENCAPSED_STRING","'qty'",223],["T_WHITESPACE"," ",223],["T_DOUBLE_ARROW","=>",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$qty",223],",",["T_WHITESPACE","\n                ",223],["T_CONSTANT_ENCAPSED_STRING","'result'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$discountData",224],["T_WHITESPACE","\n            ",224],"]",["T_WHITESPACE","\n        ",225],")",";",["T_WHITESPACE","\n\n        ",226],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Quote\\Model\\Quote\\Item\\AbstractItem $item\n     * @param int[] $appliedRuleIds\n     * @return $this\n     *\/",231],["T_WHITESPACE","\n    ",235],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","setAppliedRuleIds",236],"(",["T_NS_SEPARATOR","\\",236],["T_STRING","Magento",236],["T_NS_SEPARATOR","\\",236],["T_STRING","Quote",236],["T_NS_SEPARATOR","\\",236],["T_STRING","Model",236],["T_NS_SEPARATOR","\\",236],["T_STRING","Quote",236],["T_NS_SEPARATOR","\\",236],["T_STRING","Item",236],["T_NS_SEPARATOR","\\",236],["T_STRING","AbstractItem",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$item",236],",",["T_WHITESPACE"," ",236],["T_ARRAY","array",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$appliedRuleIds",236],")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$address",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$item",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getAddress",238],"(",")",";",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$quote",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$item",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getQuote",239],"(",")",";",["T_WHITESPACE","\n\n        ",239],["T_VARIABLE","$item",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setAppliedRuleIds",241],"(",["T_STRING","join",241],"(",["T_CONSTANT_ENCAPSED_STRING","','",241],",",["T_WHITESPACE"," ",241],["T_VARIABLE","$appliedRuleIds",241],")",")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$address",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setAppliedRuleIds",242],"(",["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","validatorUtility",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","mergeIds",242],"(",["T_VARIABLE","$address",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getAppliedRuleIds",242],"(",")",",",["T_WHITESPACE"," ",242],["T_VARIABLE","$appliedRuleIds",242],")",")",";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$quote",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","setAppliedRuleIds",243],"(",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","validatorUtility",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","mergeIds",243],"(",["T_VARIABLE","$quote",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getAppliedRuleIds",243],"(",")",",",["T_WHITESPACE"," ",243],["T_VARIABLE","$appliedRuleIds",243],")",")",";",["T_WHITESPACE","\n\n        ",243],["T_RETURN","return",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n",246],"}",["T_WHITESPACE","\n",247]]