[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SalesRule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","App",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ObjectManager",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","SalesRule",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Rule",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","SalesRule",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","AbstractModel",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Rule",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ResourceModel",11],["T_NS_SEPARATOR","\\",11],["T_STRING","AbstractResource",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","EntityManager",12],["T_NS_SEPARATOR","\\",12],["T_STRING","EntityManager",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * Sales Rule resource model\n *\/",14],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","Rule",17],["T_WHITESPACE"," ",17],["T_EXTENDS","extends",17],["T_WHITESPACE"," ",17],["T_STRING","AbstractResource",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_DOC_COMMENT","\/**\n     * Store associated with rule entities information map\n     *\n     * @var array\n     *\/",19],["T_WHITESPACE","\n    ",23],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$_associatedEntitiesMap",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],"[","]",";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$customerGroupIds",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],"[","]",";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",31],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$websiteIds",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],"[","]",";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Magento string lib\n     *\n     * @var \\Magento\\Framework\\Stdlib\\StringUtils\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$string",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\SalesRule\\Model\\ResourceModel\\Coupon\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_resourceCoupon",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @var EntityManager\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$entityManager",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Stdlib\\StringUtils $string\n     * @param \\Magento\\SalesRule\\Model\\ResourceModel\\Coupon $resourceCoupon\n     * @param string $connectionName\n     * @param \\Magento\\Framework\\DataObject|null $associatedEntityMapInstance\n     *\/",53],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","__construct",60],"(",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Magento",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Framework",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Model",61],["T_NS_SEPARATOR","\\",61],["T_STRING","ResourceModel",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Db",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Context",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$context",61],",",["T_WHITESPACE","\n        ",61],["T_NS_SEPARATOR","\\",62],["T_STRING","Magento",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Framework",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Stdlib",62],["T_NS_SEPARATOR","\\",62],["T_STRING","StringUtils",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$string",62],",",["T_WHITESPACE","\n        ",62],["T_NS_SEPARATOR","\\",63],["T_STRING","Magento",63],["T_NS_SEPARATOR","\\",63],["T_STRING","SalesRule",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Model",63],["T_NS_SEPARATOR","\\",63],["T_STRING","ResourceModel",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Coupon",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$resourceCoupon",63],",",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$connectionName",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","null",64],",",["T_WHITESPACE","\n        ",64],["T_NS_SEPARATOR","\\",65],["T_STRING","Magento",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Framework",65],["T_NS_SEPARATOR","\\",65],["T_STRING","DataObject",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$associatedEntityMapInstance",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","null",65],["T_WHITESPACE","\n    ",65],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","string",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$string",67],";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_resourceCoupon",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$resourceCoupon",68],";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$associatedEntitiesMapInstance",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$associatedEntityMapInstance",69],["T_WHITESPACE"," ",69],"?",":",["T_WHITESPACE"," ",69],["T_STRING","ObjectManager",69],["T_DOUBLE_COLON","::",69],["T_STRING","getInstance",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_WHITESPACE","\n            ",69],["T_NS_SEPARATOR","\\",70],["T_STRING","Magento",70],["T_NS_SEPARATOR","\\",70],["T_STRING","SalesRule",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Model",70],["T_NS_SEPARATOR","\\",70],["T_STRING","ResourceModel",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Rule",70],["T_NS_SEPARATOR","\\",70],["T_STRING","AssociatedEntityMap",70],["T_DOUBLE_COLON","::",70],["T_CLASS","class",70],["T_WHITESPACE","\n        ",70],")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_associatedEntitiesMap",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$associatedEntitiesMapInstance",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getData",72],"(",")",";",["T_WHITESPACE","\n        ",72],["T_STRING","parent",73],["T_DOUBLE_COLON","::",73],["T_STRING","__construct",73],"(",["T_VARIABLE","$context",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$connectionName",73],")",";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Initialize main table and table id field\n     *\n     * @return void\n     *\/",76],["T_WHITESPACE","\n    ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","_construct",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_init",83],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule'",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",83],")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * @param AbstractModel $object\n     * @return void\n     * @deprecated\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","loadCustomerGroupIds",91],"(",["T_STRING","AbstractModel",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$object",91],")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(","!",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","customerGroupIds",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","customerGroupIds",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_ARRAY_CAST","(array)",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getCustomerGroupIds",94],"(",["T_VARIABLE","$object",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getId",94],"(",")",")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$object",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","setData",96],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_ids'",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","customerGroupIds",96],")",";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * @param AbstractModel $object\n     * @return void\n     * @deprecated\n     *\/",99],["T_WHITESPACE","\n    ",103],["T_PUBLIC","public",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","loadWebsiteIds",104],"(",["T_STRING","AbstractModel",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$object",104],")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","websiteIds",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","websiteIds",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY_CAST","(array)",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getWebsiteIds",107],"(",["T_VARIABLE","$object",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getId",107],"(",")",")",";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$object",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","setData",110],"(",["T_CONSTANT_ENCAPSED_STRING","'website_ids'",110],",",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","websiteIds",110],")",";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Prepare sales rule's discount quantity\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",113],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","_beforeSave",119],"(",["T_STRING","AbstractModel",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$object",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n        ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(","!",["T_VARIABLE","$object",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getDiscountQty",121],"(",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$object",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","setDiscountQty",122],"(",["T_NEW","new",122],["T_WHITESPACE"," ",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Zend_Db_Expr",122],"(",["T_CONSTANT_ENCAPSED_STRING","'NULL'",122],")",")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n\n        ",123],["T_STRING","parent",125],["T_DOUBLE_COLON","::",125],["T_STRING","_beforeSave",125],"(",["T_VARIABLE","$object",125],")",";",["T_WHITESPACE","\n        ",125],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Load an object\n     *\n     * @param SalesRule|AbstractModel $object\n     * @param mixed $value\n     * @param string $field field to load by (defaults to model id)\n     * @return $this\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",129],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","load",138],"(",["T_STRING","AbstractModel",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$object",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$value",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$field",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_STRING","null",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getEntityManager",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","load",140],"(",["T_VARIABLE","$object",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$value",140],")",";",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Bind sales rule to customer group(s) and website(s).\n     * Save rule's associated store labels.\n     * Save product attributes used in rule.\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",144],["T_WHITESPACE","\n    ",151],["T_PROTECTED","protected",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","_afterSave",152],"(",["T_STRING","AbstractModel",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$object",152],")",["T_WHITESPACE","\n    ",152],"{",["T_WHITESPACE","\n        ",153],["T_IF","if",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$object",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","hasStoreLabels",154],"(",")",")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","saveStoreLabels",155],"(",["T_VARIABLE","$object",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getId",155],"(",")",",",["T_WHITESPACE"," ",155],["T_VARIABLE","$object",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getStoreLabels",155],"(",")",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_COMMENT","\/\/ Save product attributes used in rule\n",158],["T_WHITESPACE","        ",159],["T_VARIABLE","$ruleProductAttributes",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","array_merge",159],"(",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getProductAttributes",160],"(",["T_STRING","serialize",160],"(",["T_VARIABLE","$object",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getConditions",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","asArray",160],"(",")",")",")",",",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getProductAttributes",161],"(",["T_STRING","serialize",161],"(",["T_VARIABLE","$object",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getActions",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","asArray",161],"(",")",")",")",["T_WHITESPACE","\n        ",161],")",";",["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_STRING","count",163],"(",["T_VARIABLE","$ruleProductAttributes",163],")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setActualProductAttributes",164],"(",["T_VARIABLE","$object",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$ruleProductAttributes",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_COMMENT","\/\/ Update auto geterated specific coupons if exists\n",167],["T_WHITESPACE","        ",168],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$object",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getUseAutoGeneration",168],"(",")",["T_WHITESPACE"," ",168],["T_BOOLEAN_AND","&&",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$object",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","hasDataChanges",168],"(",")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_resourceCoupon",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","updateSpecificCoupons",169],"(",["T_VARIABLE","$object",169],")",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n        ",170],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_STRING","parent",171],["T_DOUBLE_COLON","::",171],["T_STRING","_afterSave",171],"(",["T_VARIABLE","$object",171],")",";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * Retrieve coupon\/rule uses for specified customer\n     *\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param int $customerId\n     * @return string\n     *\/",174],["T_WHITESPACE","\n    ",180],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","getCustomerUses",181],"(",["T_VARIABLE","$rule",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$customerId",181],")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$connection",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getConnection",183],"(",")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$select",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$connection",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","select",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","from",184],"(",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getTable",185],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_customer'",185],")",",",["T_WHITESPACE","\n            ",185],"[",["T_CONSTANT_ENCAPSED_STRING","'cnt'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'count(*)'",186],"]",["T_WHITESPACE","\n        ",186],")",["T_OBJECT_OPERATOR","->",187],["T_STRING","where",187],"(",["T_WHITESPACE","\n            ",187],["T_CONSTANT_ENCAPSED_STRING","'rule_id = :rule_id'",188],["T_WHITESPACE","\n        ",188],")",["T_OBJECT_OPERATOR","->",189],["T_STRING","where",189],"(",["T_WHITESPACE","\n            ",189],["T_CONSTANT_ENCAPSED_STRING","'customer_id = :customer_id'",190],["T_WHITESPACE","\n        ",190],")",";",["T_WHITESPACE","\n        ",191],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$connection",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","fetchOne",192],"(",["T_VARIABLE","$select",192],",",["T_WHITESPACE"," ",192],"[",["T_CONSTANT_ENCAPSED_STRING","':rule_id'",192],["T_WHITESPACE"," ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$rule",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getRuleId",192],"(",")",",",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","':customer_id'",192],["T_WHITESPACE"," ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$customerId",192],"]",")",";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n\n    ",193],["T_DOC_COMMENT","\/**\n     * Save rule labels for different store views\n     *\n     * @param int $ruleId\n     * @param array $labels\n     * @throws \\Exception\n     * @return $this\n     *\/",195],["T_WHITESPACE","\n    ",202],["T_PUBLIC","public",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","saveStoreLabels",203],"(",["T_VARIABLE","$ruleId",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$labels",203],")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$deleteByStoreIds",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],"[","]",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$table",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getTable",206],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_label'",206],")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$connection",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getConnection",207],"(",")",";",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$data",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],"[","]",";",["T_WHITESPACE","\n        ",209],["T_FOREACH","foreach",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$labels",210],["T_WHITESPACE"," ",210],["T_AS","as",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$storeId",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$label",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","string",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","strlen",211],"(",["T_VARIABLE","$label",211],")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                ",211],["T_VARIABLE","$data",212],"[","]",["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$ruleId",212],",",["T_WHITESPACE"," ",212],["T_CONSTANT_ENCAPSED_STRING","'store_id'",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$storeId",212],",",["T_WHITESPACE"," ",212],["T_CONSTANT_ENCAPSED_STRING","'label'",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$label",212],"]",";",["T_WHITESPACE","\n            ",212],"}",["T_WHITESPACE"," ",213],["T_ELSE","else",213],["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n                ",213],["T_VARIABLE","$deleteByStoreIds",214],"[","]",["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$storeId",214],";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_VARIABLE","$connection",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","beginTransaction",218],"(",")",";",["T_WHITESPACE","\n        ",218],["T_TRY","try",219],["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_EMPTY","empty",220],"(",["T_VARIABLE","$data",220],")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$connection",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","insertOnDuplicate",221],"(",["T_VARIABLE","$table",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$data",221],",",["T_WHITESPACE"," ",221],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",221],"]",")",";",["T_WHITESPACE","\n            ",221],"}",["T_WHITESPACE","\n\n            ",222],["T_IF","if",224],["T_WHITESPACE"," ",224],"(","!",["T_EMPTY","empty",224],"(",["T_VARIABLE","$deleteByStoreIds",224],")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_VARIABLE","$connection",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","delete",225],"(",["T_VARIABLE","$table",225],",",["T_WHITESPACE"," ",225],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id=?'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$ruleId",225],",",["T_WHITESPACE"," ",225],["T_CONSTANT_ENCAPSED_STRING","'store_id IN (?)'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$deleteByStoreIds",225],"]",")",";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE"," ",227],["T_CATCH","catch",227],["T_WHITESPACE"," ",227],"(",["T_NS_SEPARATOR","\\",227],["T_STRING","Exception",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$e",227],")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$connection",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","rollback",228],"(",")",";",["T_WHITESPACE","\n            ",228],["T_THROW","throw",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$e",229],";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$connection",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","commit",231],"(",")",";",["T_WHITESPACE","\n\n        ",231],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Get all existing rule labels\n     *\n     * @param int $ruleId\n     * @return array\n     *\/",236],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","getStoreLabels",242],"(",["T_VARIABLE","$ruleId",242],")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$select",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getConnection",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","select",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","from",244],"(",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getTable",245],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_label'",245],")",",",["T_WHITESPACE","\n            ",245],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'label'",246],"]",["T_WHITESPACE","\n        ",246],")",["T_OBJECT_OPERATOR","->",247],["T_STRING","where",247],"(",["T_WHITESPACE","\n            ",247],["T_CONSTANT_ENCAPSED_STRING","'rule_id = :rule_id'",248],["T_WHITESPACE","\n        ",248],")",";",["T_WHITESPACE","\n        ",249],["T_RETURN","return",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getConnection",250],"(",")",["T_OBJECT_OPERATOR","->",250],["T_STRING","fetchPairs",250],"(",["T_VARIABLE","$select",250],",",["T_WHITESPACE"," ",250],"[",["T_CONSTANT_ENCAPSED_STRING","':rule_id'",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$ruleId",250],"]",")",";",["T_WHITESPACE","\n    ",250],"}",["T_WHITESPACE","\n\n    ",251],["T_DOC_COMMENT","\/**\n     * Get rule label by specific store id\n     *\n     * @param int $ruleId\n     * @param int $storeId\n     * @return string\n     *\/",253],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","getStoreLabel",260],"(",["T_VARIABLE","$ruleId",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$storeId",260],")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$select",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getConnection",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","select",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","from",262],"(",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getTable",263],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_label'",263],")",",",["T_WHITESPACE","\n            ",263],["T_CONSTANT_ENCAPSED_STRING","'label'",264],["T_WHITESPACE","\n        ",264],")",["T_OBJECT_OPERATOR","->",265],["T_STRING","where",265],"(",["T_WHITESPACE","\n            ",265],["T_CONSTANT_ENCAPSED_STRING","'rule_id = :rule_id'",266],["T_WHITESPACE","\n        ",266],")",["T_OBJECT_OPERATOR","->",267],["T_STRING","where",267],"(",["T_WHITESPACE","\n            ",267],["T_CONSTANT_ENCAPSED_STRING","'store_id IN(0, :store_id)'",268],["T_WHITESPACE","\n        ",268],")",["T_OBJECT_OPERATOR","->",269],["T_STRING","order",269],"(",["T_WHITESPACE","\n            ",269],["T_CONSTANT_ENCAPSED_STRING","'store_id DESC'",270],["T_WHITESPACE","\n        ",270],")",";",["T_WHITESPACE","\n        ",271],["T_RETURN","return",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getConnection",272],"(",")",["T_OBJECT_OPERATOR","->",272],["T_STRING","fetchOne",272],"(",["T_VARIABLE","$select",272],",",["T_WHITESPACE"," ",272],"[",["T_CONSTANT_ENCAPSED_STRING","':rule_id'",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$ruleId",272],",",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","':store_id'",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$storeId",272],"]",")",";",["T_WHITESPACE","\n    ",272],"}",["T_WHITESPACE","\n\n    ",273],["T_DOC_COMMENT","\/**\n     * Return codes of all product attributes currently used in promo rules\n     *\n     * @return array\n     *\/",275],["T_WHITESPACE","\n    ",279],["T_PUBLIC","public",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","getActiveAttributes",280],"(",")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$connection",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getConnection",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$select",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$connection",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","select",283],"(",")",["T_OBJECT_OPERATOR","->",283],["T_STRING","from",283],"(",["T_WHITESPACE","\n            ",283],"[",["T_CONSTANT_ENCAPSED_STRING","'a'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getTable",284],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_product_attribute'",284],")","]",",",["T_WHITESPACE","\n            ",284],["T_NEW","new",285],["T_WHITESPACE"," ",285],["T_NS_SEPARATOR","\\",285],["T_STRING","Zend_Db_Expr",285],"(",["T_CONSTANT_ENCAPSED_STRING","'DISTINCT ea.attribute_code'",285],")",["T_WHITESPACE","\n        ",285],")",["T_OBJECT_OPERATOR","->",286],["T_STRING","joinInner",286],"(",["T_WHITESPACE","\n            ",286],"[",["T_CONSTANT_ENCAPSED_STRING","'ea'",287],["T_WHITESPACE"," ",287],["T_DOUBLE_ARROW","=>",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getTable",287],"(",["T_CONSTANT_ENCAPSED_STRING","'eav_attribute'",287],")","]",",",["T_WHITESPACE","\n            ",287],["T_CONSTANT_ENCAPSED_STRING","'ea.attribute_id = a.attribute_id'",288],",",["T_WHITESPACE","\n            ",288],"[","]",["T_WHITESPACE","\n        ",289],")",";",["T_WHITESPACE","\n        ",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$connection",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","fetchAll",291],"(",["T_VARIABLE","$select",291],")",";",["T_WHITESPACE","\n    ",291],"}",["T_WHITESPACE","\n\n    ",292],["T_DOC_COMMENT","\/**\n     * Save product attributes currently used in conditions and actions of rule\n     *\n     * @param \\Magento\\SalesRule\\Model\\Rule $rule\n     * @param mixed $attributes\n     * @return $this\n     *\/",294],["T_WHITESPACE","\n    ",300],["T_PUBLIC","public",301],["T_WHITESPACE"," ",301],["T_FUNCTION","function",301],["T_WHITESPACE"," ",301],["T_STRING","setActualProductAttributes",301],"(",["T_VARIABLE","$rule",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$attributes",301],")",["T_WHITESPACE","\n    ",301],"{",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$connection",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getConnection",303],"(",")",";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$connection",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","delete",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getTable",304],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_product_attribute'",304],")",",",["T_WHITESPACE"," ",304],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id=?'",304],["T_WHITESPACE"," ",304],["T_DOUBLE_ARROW","=>",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$rule",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getId",304],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",304],["T_COMMENT","\/\/Getting attribute IDs for attribute codes\n",306],["T_WHITESPACE","        ",307],["T_VARIABLE","$attributeIds",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],"[","]",";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$select",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getConnection",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","select",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","from",308],"(",["T_WHITESPACE","\n            ",308],"[",["T_CONSTANT_ENCAPSED_STRING","'a'",309],["T_WHITESPACE"," ",309],["T_DOUBLE_ARROW","=>",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getTable",309],"(",["T_CONSTANT_ENCAPSED_STRING","'eav_attribute'",309],")","]",",",["T_WHITESPACE","\n            ",309],"[",["T_CONSTANT_ENCAPSED_STRING","'a.attribute_id'",310],"]",["T_WHITESPACE","\n        ",310],")",["T_OBJECT_OPERATOR","->",311],["T_STRING","where",311],"(",["T_WHITESPACE","\n            ",311],["T_CONSTANT_ENCAPSED_STRING","'a.attribute_code IN (?)'",312],",",["T_WHITESPACE","\n            ",312],"[",["T_VARIABLE","$attributes",313],"]",["T_WHITESPACE","\n        ",313],")",";",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$attributesFound",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getConnection",315],"(",")",["T_OBJECT_OPERATOR","->",315],["T_STRING","fetchAll",315],"(",["T_VARIABLE","$select",315],")",";",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$attributesFound",316],")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_FOREACH","foreach",317],["T_WHITESPACE"," ",317],"(",["T_VARIABLE","$attributesFound",317],["T_WHITESPACE"," ",317],["T_AS","as",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$attribute",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                ",317],["T_VARIABLE","$attributeIds",318],"[","]",["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$attribute",318],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",318],"]",";",["T_WHITESPACE","\n            ",318],"}",["T_WHITESPACE","\n\n            ",319],["T_VARIABLE","$data",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],"[","]",";",["T_WHITESPACE","\n            ",321],["T_FOREACH","foreach",322],["T_WHITESPACE"," ",322],"(",["T_VARIABLE","$rule",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getCustomerGroupIds",322],"(",")",["T_WHITESPACE"," ",322],["T_AS","as",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$customerGroupId",322],")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n                ",322],["T_FOREACH","foreach",323],["T_WHITESPACE"," ",323],"(",["T_VARIABLE","$rule",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getWebsiteIds",323],"(",")",["T_WHITESPACE"," ",323],["T_AS","as",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$websiteId",323],")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n                    ",323],["T_FOREACH","foreach",324],["T_WHITESPACE"," ",324],"(",["T_VARIABLE","$attributeIds",324],["T_WHITESPACE"," ",324],["T_AS","as",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$attribute",324],")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n                        ",324],["T_VARIABLE","$data",325],"[","]",["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],"[",["T_WHITESPACE","\n                            ",325],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$rule",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getId",326],"(",")",",",["T_WHITESPACE","\n                            ",326],["T_CONSTANT_ENCAPSED_STRING","'website_id'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$websiteId",327],",",["T_WHITESPACE","\n                            ",327],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$customerGroupId",328],",",["T_WHITESPACE","\n                            ",328],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",329],["T_WHITESPACE"," ",329],["T_DOUBLE_ARROW","=>",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$attribute",329],",",["T_WHITESPACE","\n                        ",329],"]",";",["T_WHITESPACE","\n                    ",330],"}",["T_WHITESPACE","\n                ",331],"}",["T_WHITESPACE","\n            ",332],"}",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$connection",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","insertMultiple",334],"(",["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getTable",334],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule_product_attribute'",334],")",",",["T_WHITESPACE"," ",334],["T_VARIABLE","$data",334],")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n\n        ",335],["T_RETURN","return",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],";",["T_WHITESPACE","\n    ",337],"}",["T_WHITESPACE","\n\n    ",338],["T_DOC_COMMENT","\/**\n     * Collect all product attributes used in serialized rule's action or condition\n     *\n     * @param string $serializedString\n     * @return array\n     *\/",340],["T_WHITESPACE","\n    ",345],["T_PUBLIC","public",346],["T_WHITESPACE"," ",346],["T_FUNCTION","function",346],["T_WHITESPACE"," ",346],["T_STRING","getProductAttributes",346],"(",["T_VARIABLE","$serializedString",346],")",["T_WHITESPACE","\n    ",346],"{",["T_WHITESPACE","\n        ",347],["T_VARIABLE","$result",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],"[","]",";",["T_WHITESPACE","\n        ",348],["T_IF","if",349],["T_WHITESPACE"," ",349],"(",["T_STRING","preg_match_all",349],"(",["T_WHITESPACE","\n            ",349],["T_CONSTANT_ENCAPSED_STRING","'~s:32:\"salesrule\/rule_condition_product\";s:9:\"attribute\";s:\\d+:\"(.*?)\"~s'",350],",",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$serializedString",351],",",["T_WHITESPACE","\n            ",351],["T_VARIABLE","$matches",352],["T_WHITESPACE","\n        ",352],")",["T_WHITESPACE","\n        ",353],")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n            ",354],["T_FOREACH","foreach",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$matches",355],"[",["T_LNUMBER","1",355],"]",["T_WHITESPACE"," ",355],["T_AS","as",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$attributeCode",355],")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                ",355],["T_VARIABLE","$result",356],"[","]",["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_VARIABLE","$attributeCode",356],";",["T_WHITESPACE","\n            ",356],"}",["T_WHITESPACE","\n        ",357],"}",["T_WHITESPACE","\n\n        ",358],["T_RETURN","return",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$result",360],";",["T_WHITESPACE","\n    ",360],"}",["T_WHITESPACE","\n\n    ",361],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     * @throws \\Exception\n     *\/",363],["T_WHITESPACE","\n    ",367],["T_PUBLIC","public",368],["T_WHITESPACE"," ",368],["T_FUNCTION","function",368],["T_WHITESPACE"," ",368],["T_STRING","save",368],"(",["T_NS_SEPARATOR","\\",368],["T_STRING","Magento",368],["T_NS_SEPARATOR","\\",368],["T_STRING","Framework",368],["T_NS_SEPARATOR","\\",368],["T_STRING","Model",368],["T_NS_SEPARATOR","\\",368],["T_STRING","AbstractModel",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$object",368],")",["T_WHITESPACE","\n    ",368],"{",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getEntityManager",370],"(",")",["T_OBJECT_OPERATOR","->",370],["T_STRING","save",370],"(",["T_VARIABLE","$object",370],")",";",["T_WHITESPACE","\n        ",370],["T_RETURN","return",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],";",["T_WHITESPACE","\n    ",371],"}",["T_WHITESPACE","\n\n    ",372],["T_DOC_COMMENT","\/**\n     * Delete the object\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     * @throws \\Exception\n     *\/",374],["T_WHITESPACE","\n    ",380],["T_PUBLIC","public",381],["T_WHITESPACE"," ",381],["T_FUNCTION","function",381],["T_WHITESPACE"," ",381],["T_STRING","delete",381],"(",["T_STRING","AbstractModel",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$object",381],")",["T_WHITESPACE","\n    ",381],"{",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getEntityManager",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","delete",383],"(",["T_VARIABLE","$object",383],")",";",["T_WHITESPACE","\n        ",383],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Framework\\EntityManager\\EntityManager\n     * @deprecated\n     *\/",387],["T_WHITESPACE","\n    ",390],["T_PRIVATE","private",391],["T_WHITESPACE"," ",391],["T_FUNCTION","function",391],["T_WHITESPACE"," ",391],["T_STRING","getEntityManager",391],"(",")",["T_WHITESPACE","\n    ",391],"{",["T_WHITESPACE","\n        ",392],["T_IF","if",393],["T_WHITESPACE"," ",393],"(",["T_STRING","null",393],["T_WHITESPACE"," ",393],["T_IS_IDENTICAL","===",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","entityManager",393],")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n            ",393],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","entityManager",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_NS_SEPARATOR","\\",394],["T_STRING","Magento",394],["T_NS_SEPARATOR","\\",394],["T_STRING","Framework",394],["T_NS_SEPARATOR","\\",394],["T_STRING","App",394],["T_NS_SEPARATOR","\\",394],["T_STRING","ObjectManager",394],["T_DOUBLE_COLON","::",394],["T_STRING","getInstance",394],"(",")",["T_WHITESPACE","\n                ",394],["T_OBJECT_OPERATOR","->",395],["T_STRING","get",395],"(",["T_NS_SEPARATOR","\\",395],["T_STRING","Magento",395],["T_NS_SEPARATOR","\\",395],["T_STRING","Framework",395],["T_NS_SEPARATOR","\\",395],["T_STRING","EntityManager",395],["T_NS_SEPARATOR","\\",395],["T_STRING","EntityManager",395],["T_DOUBLE_COLON","::",395],["T_CLASS","class",395],")",";",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n        ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","entityManager",397],";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n",398],"}",["T_WHITESPACE","\n",399]]