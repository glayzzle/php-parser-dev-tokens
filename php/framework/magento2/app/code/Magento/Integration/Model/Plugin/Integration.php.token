[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Integration",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Plugin",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Authorization",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Acl",9],["T_NS_SEPARATOR","\\",9],["T_STRING","AclRetriever",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Authorization",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","UserContextInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Integration",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Integration",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","IntegrationModel",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Integration",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","AuthorizationServiceInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Integration",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","IntegrationServiceInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Integration",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","IntegrationConfig",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Integration",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","ConsolidatedConfig",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Plugin for \\Magento\\Integration\\Model\\IntegrationService.\n *\/",17],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","Integration",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/** @var AuthorizationServiceInterface *\/",22],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$integrationAuthorizationService",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/** @var  AclRetriever *\/",25],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$aclRetriever",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/** @var IntegrationConfig *\/",28],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$integrationConfig",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/** @var ConsolidatedConfig *\/",31],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$consolidatedConfig",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * Initialize dependencies.\n     *\n     * @param AuthorizationServiceInterface $integrationAuthorizationService\n     * @param AclRetriever $aclRetriever\n     * @param IntegrationConfig $integrationConfig\n     * @param ConsolidatedConfig $consolidatedConfig\n     *\/",34],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","__construct",42],"(",["T_WHITESPACE","\n        ",42],["T_STRING","AuthorizationServiceInterface",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$integrationAuthorizationService",43],",",["T_WHITESPACE","\n        ",43],["T_STRING","AclRetriever",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$aclRetriever",44],",",["T_WHITESPACE","\n        ",44],["T_STRING","IntegrationConfig",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$integrationConfig",45],",",["T_WHITESPACE","\n        ",45],["T_STRING","ConsolidatedConfig",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$consolidatedConfig",46],["T_WHITESPACE","\n    ",46],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","integrationAuthorizationService",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$integrationAuthorizationService",48],";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","aclRetriever",49],["T_WHITESPACE","  ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$aclRetriever",49],";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","integrationConfig",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$integrationConfig",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","consolidatedConfig",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$consolidatedConfig",51],";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Persist API permissions.\n     *\n     * @param IntegrationServiceInterface $subject\n     * @param IntegrationModel $integration\n     *\n     * @return IntegrationModel\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",54],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","afterCreate",63],"(",["T_STRING","IntegrationServiceInterface",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$subject",63],",",["T_WHITESPACE"," ",63],["T_VARIABLE","$integration",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$integration",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getSetupType",65],"(",")",["T_WHITESPACE"," ",65],["T_IS_EQUAL","==",65],["T_WHITESPACE"," ",65],["T_STRING","IntegrationModel",65],["T_DOUBLE_COLON","::",65],["T_STRING","TYPE_CONFIG",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_addAllowedResources",66],"(",["T_VARIABLE","$integration",66],")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_saveApiPermissions",68],"(",["T_VARIABLE","$integration",68],")",";",["T_WHITESPACE","\n        ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$integration",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Persist API permissions.\n     *\n     * @param IntegrationServiceInterface $subject\n     * @param IntegrationModel $integration\n     *\n     * @return IntegrationModel\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",72],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","afterUpdate",81],"(",["T_STRING","IntegrationServiceInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$subject",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$integration",81],")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$integration",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getSetupType",83],"(",")",["T_WHITESPACE"," ",83],["T_IS_EQUAL","==",83],["T_WHITESPACE"," ",83],["T_STRING","IntegrationModel",83],["T_DOUBLE_COLON","::",83],["T_STRING","TYPE_CONFIG",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_addAllowedResources",84],"(",["T_VARIABLE","$integration",84],")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_saveApiPermissions",86],"(",["T_VARIABLE","$integration",86],")",";",["T_WHITESPACE","\n        ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$integration",87],";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Add API permissions to integration data.\n     *\n     * @param IntegrationServiceInterface $subject\n     * @param IntegrationModel $integration\n     *\n     * @return IntegrationModel\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",90],["T_WHITESPACE","\n    ",98],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","afterGet",99],"(",["T_STRING","IntegrationServiceInterface",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$subject",99],",",["T_WHITESPACE"," ",99],["T_VARIABLE","$integration",99],")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_addAllowedResources",101],"(",["T_VARIABLE","$integration",101],")",";",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$integration",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Add the list of allowed resources to the integration object data by 'resource' key.\n     *\n     * @param IntegrationModel $integration\n     * @return void\n     *\/",105],["T_WHITESPACE","\n    ",110],["T_PROTECTED","protected",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","_addAllowedResources",111],"(",["T_STRING","IntegrationModel",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$integration",111],")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$integrations",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","array_merge",113],"(",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","integrationConfig",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getIntegrations",114],"(",")",",",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","consolidatedConfig",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getIntegrations",115],"(",")",["T_WHITESPACE","\n        ",115],")",";",["T_WHITESPACE","\n        ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$integration",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$integration",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getSetupType",118],"(",")",["T_WHITESPACE"," ",118],["T_IS_EQUAL","==",118],["T_WHITESPACE"," ",118],["T_STRING","IntegrationModel",118],["T_DOUBLE_COLON","::",118],["T_STRING","TYPE_CONFIG",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n                ",118],["T_VARIABLE","$integration",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","setData",119],"(",["T_WHITESPACE","\n                    ",119],["T_CONSTANT_ENCAPSED_STRING","'resource'",120],",",["T_WHITESPACE","\n                    ",120],["T_VARIABLE","$integrations",121],"[",["T_VARIABLE","$integration",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getData",121],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",121],")","]","[",["T_CONSTANT_ENCAPSED_STRING","'resource'",121],"]",["T_WHITESPACE","\n                ",121],")",";",["T_WHITESPACE","\n            ",122],"}",["T_WHITESPACE"," ",123],["T_ELSE","else",123],["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$integration",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","setData",124],"(",["T_WHITESPACE","\n                    ",124],["T_CONSTANT_ENCAPSED_STRING","'resource'",125],",",["T_WHITESPACE","\n                    ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","aclRetriever",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getAllowedResourcesByUser",126],"(",["T_WHITESPACE","\n                        ",126],["T_STRING","UserContextInterface",127],["T_DOUBLE_COLON","::",127],["T_STRING","USER_TYPE_INTEGRATION",127],",",["T_WHITESPACE","\n                        ",127],["T_INT_CAST","(int)",128],["T_VARIABLE","$integration",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getId",128],"(",")",["T_WHITESPACE","\n                    ",128],")",["T_WHITESPACE","\n                ",129],")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Persist API permissions.\n     *\n     * Permissions are expected to be set to integration object by 'resource' key.\n     * If 'all_resources' is set and is evaluated to true, permissions to all resources will be granted.\n     *\n     * @param IntegrationModel $integration\n     * @return void\n     *\/",135],["T_WHITESPACE","\n    ",143],["T_PROTECTED","protected",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","_saveApiPermissions",144],"(",["T_STRING","IntegrationModel",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$integration",144],")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$integration",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getId",146],"(",")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$integration",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getData",147],"(",["T_CONSTANT_ENCAPSED_STRING","'all_resources'",147],")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","integrationAuthorizationService",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","grantAllPermissions",148],"(",["T_VARIABLE","$integration",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getId",148],"(",")",")",";",["T_WHITESPACE","\n            ",148],"}",["T_WHITESPACE"," ",149],["T_ELSEIF","elseif",149],["T_WHITESPACE"," ",149],"(",["T_STRING","is_array",149],"(",["T_VARIABLE","$integration",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getData",149],"(",["T_CONSTANT_ENCAPSED_STRING","'resource'",149],")",")",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n                ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","integrationAuthorizationService",150],["T_WHITESPACE","\n                    ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","grantPermissions",151],"(",["T_VARIABLE","$integration",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getId",151],"(",")",",",["T_WHITESPACE"," ",151],["T_VARIABLE","$integration",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getData",151],"(",["T_CONSTANT_ENCAPSED_STRING","'resource'",151],")",")",";",["T_WHITESPACE","\n            ",151],"}",["T_WHITESPACE"," ",152],["T_ELSE","else",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","integrationAuthorizationService",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","grantPermissions",153],"(",["T_VARIABLE","$integration",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getId",153],"(",")",",",["T_WHITESPACE"," ",153],"[","]",")",";",["T_WHITESPACE","\n            ",153],"}",["T_WHITESPACE","\n        ",154],"}",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Process integration resource permissions after the integration is created\n     *\n     * @param IntegrationServiceInterface $subject\n     * @param array $integrationData Data of integration deleted\n     *\n     * @return array $integrationData\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",158],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","afterDelete",167],"(",["T_STRING","IntegrationServiceInterface",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$subject",167],",",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$integrationData",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_COMMENT","\/\/No check needed for integration data since it cannot be empty in the parent invocation - delete\n",169],["T_WHITESPACE","        ",170],["T_VARIABLE","$integrationId",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_INT_CAST","(int)",170],["T_VARIABLE","$integrationData",170],"[",["T_STRING","IntegrationModel",170],["T_DOUBLE_COLON","::",170],["T_STRING","ID",170],"]",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","integrationAuthorizationService",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","removePermissions",171],"(",["T_VARIABLE","$integrationId",171],")",";",["T_WHITESPACE","\n        ",171],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$integrationData",172],";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n",173],"}",["T_WHITESPACE","\n",174]]