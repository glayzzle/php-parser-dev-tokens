[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",6],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Integration",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Controller",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Adminhtml",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Integration",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Integration",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Integration",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","IntegrationModel",9],";",["T_WHITESPACE","\n\n",9],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","TokensExchange",11],["T_WHITESPACE"," ",11],["T_EXTENDS","extends",11],["T_WHITESPACE"," ",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Integration",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Controller",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Adminhtml",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Integration",11],["T_WHITESPACE","\n",11],"{",["T_WHITESPACE","\n    ",12],["T_DOC_COMMENT","\/**\n     * Let the admin know that integration has been sent for activation and token exchange is in process.\n     *\n     * @param bool   $isReauthorize\n     * @param string $integrationName\n     * @return void\n     *\/",13],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_FUNCTION","function",20],["T_WHITESPACE"," ",20],["T_STRING","_setActivationInProcessMsg",20],"(",["T_VARIABLE","$isReauthorize",20],",",["T_WHITESPACE"," ",20],["T_VARIABLE","$integrationName",20],")",["T_WHITESPACE","\n    ",20],"{",["T_WHITESPACE","\n        ",21],["T_VARIABLE","$msg",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_VARIABLE","$isReauthorize",22],["T_WHITESPACE"," ",22],"?",["T_WHITESPACE"," ",22],["T_STRING","__",22],"(",["T_WHITESPACE","\n            ",22],["T_CONSTANT_ENCAPSED_STRING","\"Integration '%1' has been sent for re-authorization.\"",23],",",["T_WHITESPACE","\n            ",23],["T_VARIABLE","$integrationName",24],["T_WHITESPACE","\n        ",24],")",["T_WHITESPACE"," ",25],":",["T_WHITESPACE"," ",25],["T_STRING","__",25],"(",["T_WHITESPACE","\n            ",25],["T_CONSTANT_ENCAPSED_STRING","\"Integration '%1' has been sent for activation.\"",26],",",["T_WHITESPACE","\n            ",26],["T_VARIABLE","$integrationName",27],["T_WHITESPACE","\n        ",27],")",";",["T_WHITESPACE","\n        ",28],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","messageManager",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","addNotice",29],"(",["T_VARIABLE","$msg",29],")",";",["T_WHITESPACE","\n    ",29],"}",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Post consumer credentials for Oauth integration.\n     *\n     * @return void\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","execute",37],"(",")",["T_WHITESPACE","\n    ",37],"{",["T_WHITESPACE","\n        ",38],["T_TRY","try",39],["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n            ",39],["T_VARIABLE","$integrationId",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getRequest",40],"(",")",["T_OBJECT_OPERATOR","->",40],["T_STRING","getParam",40],"(",["T_STRING","self",40],["T_DOUBLE_COLON","::",40],["T_STRING","PARAM_INTEGRATION_ID",40],")",";",["T_WHITESPACE","\n            ",40],["T_VARIABLE","$isReauthorize",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_BOOL_CAST","(bool)",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getRequest",41],"(",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","getParam",41],"(",["T_STRING","self",41],["T_DOUBLE_COLON","::",41],["T_STRING","PARAM_REAUTHORIZE",41],",",["T_WHITESPACE"," ",41],["T_LNUMBER","0",41],")",";",["T_WHITESPACE","\n            ",41],["T_VARIABLE","$integration",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_integrationService",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","get",42],"(",["T_VARIABLE","$integrationId",42],")",";",["T_WHITESPACE","\n            ",42],["T_IF","if",43],["T_WHITESPACE"," ",43],"(",["T_VARIABLE","$isReauthorize",43],")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n                ",43],["T_DOC_COMMENT","\/** Remove existing token associated with consumer before issuing a new one. *\/",44],["T_WHITESPACE","\n                ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_oauthService",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","deleteIntegrationToken",45],"(",["T_VARIABLE","$integration",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getConsumerId",45],"(",")",")",";",["T_WHITESPACE","\n                ",45],["T_VARIABLE","$integration",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","setStatus",46],"(",["T_STRING","IntegrationModel",46],["T_DOUBLE_COLON","::",46],["T_STRING","STATUS_INACTIVE",46],")",["T_OBJECT_OPERATOR","->",46],["T_STRING","save",46],"(",")",";",["T_WHITESPACE","\n            ",46],"}",["T_WHITESPACE","\n            ",47],["T_COMMENT","\/\/Integration chooses to use Oauth for token exchange\n",48],["T_WHITESPACE","            ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_oauthService",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","postToConsumer",49],"(",["T_VARIABLE","$integration",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getConsumerId",49],"(",")",",",["T_WHITESPACE"," ",49],["T_VARIABLE","$integration",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getEndpoint",49],"(",")",")",";",["T_WHITESPACE","\n            ",49],["T_DOC_COMMENT","\/** Generate JS popup content *\/",50],["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_view",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","loadLayout",51],"(",["T_STRING","false",51],")",";",["T_WHITESPACE","\n            ",51],["T_COMMENT","\/\/ Activation or authorization is done only when the Oauth token exchange completes\n",52],["T_WHITESPACE","            ",53],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_setActivationInProcessMsg",53],"(",["T_VARIABLE","$isReauthorize",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$integration",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getName",53],"(",")",")",";",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_view",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","renderLayout",54],"(",")",";",["T_WHITESPACE","\n            ",54],["T_VARIABLE","$popupContent",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_response",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getBody",55],"(",")",";",["T_WHITESPACE","\n            ",55],["T_VARIABLE","$consumer",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_oauthService",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","loadConsumer",56],"(",["T_VARIABLE","$integration",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getConsumerId",56],"(",")",")",";",["T_WHITESPACE","\n            ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(","!",["T_VARIABLE","$consumer",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getId",57],"(",")",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n                ",57],["T_THROW","throw",58],["T_WHITESPACE"," ",58],["T_NEW","new",58],["T_WHITESPACE"," ",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Magento",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Framework",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Oauth",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Exception",58],"(",["T_WHITESPACE","\n                    ",58],["T_STRING","__",59],"(",["T_CONSTANT_ENCAPSED_STRING","'A consumer with ID %1 does not exist'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$integration",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getConsumerId",59],"(",")",")",["T_WHITESPACE","\n                ",59],")",";",["T_WHITESPACE","\n            ",60],"}",["T_WHITESPACE","\n            ",61],["T_DOC_COMMENT","\/** Initialize response body *\/",62],["T_WHITESPACE","\n            ",62],["T_VARIABLE","$result",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],"[",["T_WHITESPACE","\n                ",63],["T_STRING","IntegrationModel",64],["T_DOUBLE_COLON","::",64],["T_STRING","IDENTITY_LINK_URL",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$integration",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getIdentityLinkUrl",64],"(",")",",",["T_WHITESPACE","\n                ",64],["T_CONSTANT_ENCAPSED_STRING","'oauth_consumer_key'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$consumer",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getKey",65],"(",")",",",["T_WHITESPACE","\n                ",65],["T_CONSTANT_ENCAPSED_STRING","'popup_content'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$popupContent",66],",",["T_WHITESPACE","\n            ",66],"]",";",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getResponse",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","representJson",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","jsonHelper",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","jsonEncode",68],"(",["T_VARIABLE","$result",68],")",")",";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE"," ",69],["T_CATCH","catch",69],["T_WHITESPACE"," ",69],"(",["T_NS_SEPARATOR","\\",69],["T_STRING","Magento",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Framework",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Exception",69],["T_NS_SEPARATOR","\\",69],["T_STRING","LocalizedException",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$e",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","messageManager",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","addError",70],"(",["T_VARIABLE","$e",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getMessage",70],"(",")",")",";",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_redirect",71],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",71],")",";",["T_WHITESPACE","\n            ",71],["T_RETURN","return",72],";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE"," ",73],["T_CATCH","catch",73],["T_WHITESPACE"," ",73],"(",["T_NS_SEPARATOR","\\",73],["T_STRING","Exception",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$e",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_logger",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","critical",74],"(",["T_VARIABLE","$e",74],")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","messageManager",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","addError",75],"(",["T_STRING","__",75],"(",["T_CONSTANT_ENCAPSED_STRING","'Internal error. Check exception log for details.'",75],")",")",";",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_redirect",76],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",76],")",";",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n",79],"}",["T_WHITESPACE","\n",80]]