[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","GiftMessage",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Exception",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CouldNotSaveException",8],";",["T_WHITESPACE","\n\n",8],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","GiftMessageManager",10],["T_WHITESPACE","\n",10],"{",["T_WHITESPACE","\n    ",11],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\GiftMessage\\Model\\MessageFactory\n     *\/",12],["T_WHITESPACE","\n    ",14],["T_PROTECTED","protected",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$messageFactory",15],";",["T_WHITESPACE","\n\n    ",15],["T_DOC_COMMENT","\/**\n     * @param MessageFactory $messageFactory\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PUBLIC","public",20],["T_WHITESPACE"," ",20],["T_FUNCTION","function",20],["T_WHITESPACE"," ",20],["T_STRING","__construct",20],"(",["T_WHITESPACE","\n        ",20],["T_NS_SEPARATOR","\\",21],["T_STRING","Magento",21],["T_NS_SEPARATOR","\\",21],["T_STRING","GiftMessage",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Model",21],["T_NS_SEPARATOR","\\",21],["T_STRING","MessageFactory",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$messageFactory",21],["T_WHITESPACE","\n    ",21],")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n        ",22],["T_VARIABLE","$this",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","messageFactory",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_VARIABLE","$messageFactory",23],";",["T_WHITESPACE","\n    ",23],"}",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @param array $giftMessages\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",26],["T_WHITESPACE","\n    ",31],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","add",32],"(",["T_VARIABLE","$giftMessages",32],",",["T_WHITESPACE"," ",32],["T_VARIABLE","$quote",32],")",["T_WHITESPACE","\n    ",32],"{",["T_WHITESPACE","\n        ",33],["T_IF","if",34],["T_WHITESPACE"," ",34],"(","!",["T_STRING","is_array",34],"(",["T_VARIABLE","$giftMessages",34],")",")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n            ",34],["T_RETURN","return",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$this",35],";",["T_WHITESPACE","\n        ",35],"}",["T_WHITESPACE","\n        ",36],["T_COMMENT","\/\/ types are 'quote', 'quote_item', etc\n",37],["T_WHITESPACE","        ",38],["T_FOREACH","foreach",38],["T_WHITESPACE"," ",38],"(",["T_VARIABLE","$giftMessages",38],["T_WHITESPACE"," ",38],["T_AS","as",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$type",38],["T_WHITESPACE"," ",38],["T_DOUBLE_ARROW","=>",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$giftMessageEntities",38],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n            ",38],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$giftMessageEntities",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$entityId",39],["T_WHITESPACE"," ",39],["T_DOUBLE_ARROW","=>",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$message",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n                ",39],["T_VARIABLE","$giftMessage",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","messageFactory",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","create",40],"(",")",";",["T_WHITESPACE","\n                ",40],["T_SWITCH","switch",41],["T_WHITESPACE"," ",41],"(",["T_VARIABLE","$type",41],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n                    ",41],["T_CASE","case",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'quote'",42],":",["T_WHITESPACE","\n                        ",42],["T_VARIABLE","$entity",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$quote",43],";",["T_WHITESPACE","\n                        ",43],["T_BREAK","break",44],";",["T_WHITESPACE","\n                    ",44],["T_CASE","case",45],["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",45],":",["T_WHITESPACE","\n                        ",45],["T_VARIABLE","$entity",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$quote",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getItemById",46],"(",["T_VARIABLE","$entityId",46],")",";",["T_WHITESPACE","\n                        ",46],["T_BREAK","break",47],";",["T_WHITESPACE","\n                    ",47],["T_CASE","case",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'quote_address'",48],":",["T_WHITESPACE","\n                        ",48],["T_VARIABLE","$entity",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$quote",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getAddressById",49],"(",["T_VARIABLE","$entityId",49],")",";",["T_WHITESPACE","\n                        ",49],["T_BREAK","break",50],";",["T_WHITESPACE","\n                    ",50],["T_CASE","case",51],["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'quote_address_item'",51],":",["T_WHITESPACE","\n                        ",51],["T_VARIABLE","$entity",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$quote",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getAddressById",52],"(",["T_VARIABLE","$message",52],"[",["T_CONSTANT_ENCAPSED_STRING","'address'",52],"]",")",["T_OBJECT_OPERATOR","->",52],["T_STRING","getItemById",52],"(",["T_VARIABLE","$entityId",52],")",";",["T_WHITESPACE","\n                        ",52],["T_BREAK","break",53],";",["T_WHITESPACE","\n                    ",53],["T_DEFAULT","default",54],":",["T_WHITESPACE","\n                        ",54],["T_VARIABLE","$entity",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$quote",55],";",["T_WHITESPACE","\n                        ",55],["T_BREAK","break",56],";",["T_WHITESPACE","\n                ",56],"}",["T_WHITESPACE","\n\n                ",57],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$entity",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getGiftMessageId",59],"(",")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n                    ",59],["T_VARIABLE","$giftMessage",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","load",60],"(",["T_VARIABLE","$entity",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getGiftMessageId",60],"(",")",")",";",["T_WHITESPACE","\n                ",60],"}",["T_WHITESPACE","\n\n                ",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_STRING","trim",63],"(",["T_VARIABLE","$message",63],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",63],"]",")",["T_WHITESPACE"," ",63],["T_IS_EQUAL","==",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","''",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n                    ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$giftMessage",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n                        ",64],["T_TRY","try",65],["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                            ",65],["T_VARIABLE","$giftMessage",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","delete",66],"(",")",";",["T_WHITESPACE","\n                            ",66],["T_VARIABLE","$entity",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","setGiftMessageId",67],"(",["T_LNUMBER","0",67],")",["T_OBJECT_OPERATOR","->",67],["T_STRING","save",67],"(",")",";",["T_WHITESPACE","\n                        ",67],"}",["T_WHITESPACE"," ",68],["T_CATCH","catch",68],["T_WHITESPACE"," ",68],"(",["T_NS_SEPARATOR","\\",68],["T_STRING","Exception",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$e",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n                        ",68],"}",["T_WHITESPACE","\n                    ",69],"}",["T_WHITESPACE","\n                    ",70],["T_CONTINUE","continue",71],";",["T_WHITESPACE","\n                ",71],"}",["T_WHITESPACE","\n\n                ",72],["T_TRY","try",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                    ",74],["T_VARIABLE","$giftMessage",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","setSender",75],"(",["T_WHITESPACE","\n                        ",75],["T_VARIABLE","$message",76],"[",["T_CONSTANT_ENCAPSED_STRING","'from'",76],"]",["T_WHITESPACE","\n                    ",76],")",["T_OBJECT_OPERATOR","->",77],["T_STRING","setRecipient",77],"(",["T_WHITESPACE","\n                        ",77],["T_VARIABLE","$message",78],"[",["T_CONSTANT_ENCAPSED_STRING","'to'",78],"]",["T_WHITESPACE","\n                    ",78],")",["T_OBJECT_OPERATOR","->",79],["T_STRING","setMessage",79],"(",["T_WHITESPACE","\n                        ",79],["T_VARIABLE","$message",80],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",80],"]",["T_WHITESPACE","\n                    ",80],")",["T_OBJECT_OPERATOR","->",81],["T_STRING","setCustomerId",81],"(",["T_WHITESPACE","\n                        ",81],["T_VARIABLE","$quote",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getCustomerId",82],"(",")",["T_WHITESPACE","\n                    ",82],")",["T_OBJECT_OPERATOR","->",83],["T_STRING","save",83],"(",")",";",["T_WHITESPACE","\n\n                    ",83],["T_VARIABLE","$entity",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","setGiftMessageId",85],"(",["T_VARIABLE","$giftMessage",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getId",85],"(",")",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","save",85],"(",")",";",["T_WHITESPACE","\n                ",85],"}",["T_WHITESPACE"," ",86],["T_CATCH","catch",86],["T_WHITESPACE"," ",86],"(",["T_NS_SEPARATOR","\\",86],["T_STRING","Exception",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$e",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                ",86],"}",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Sets the gift message to item or quote.\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote The quote.\n     * @param string $type The type.\n     * @param \\Magento\\GiftMessage\\Api\\Data\\MessageInterface $giftMessage The gift message.\n     * @param null|int $entityId The entity ID.\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\CouldNotSaveException The specified gift message is not available.\n     *\/",93],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","setMessage",103],"(",["T_NS_SEPARATOR","\\",103],["T_STRING","Magento",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Quote",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Model",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Quote",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$quote",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$type",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$giftMessage",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$entityId",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_STRING","null",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$message",105],"[",["T_VARIABLE","$type",105],"]","[",["T_VARIABLE","$entityId",105],"]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],"[",["T_WHITESPACE","\n            ",105],["T_CONSTANT_ENCAPSED_STRING","'from'",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$giftMessage",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getSender",106],"(",")",",",["T_WHITESPACE","\n            ",106],["T_CONSTANT_ENCAPSED_STRING","'to'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$giftMessage",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getRecipient",107],"(",")",",",["T_WHITESPACE","\n            ",107],["T_CONSTANT_ENCAPSED_STRING","'message'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$giftMessage",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getMessage",108],"(",")",",",["T_WHITESPACE","\n        ",108],"]",";",["T_WHITESPACE","\n\n        ",109],["T_TRY","try",111],["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","add",112],"(",["T_VARIABLE","$message",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$quote",112],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE"," ",113],["T_CATCH","catch",113],["T_WHITESPACE"," ",113],"(",["T_NS_SEPARATOR","\\",113],["T_STRING","Exception",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$e",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_THROW","throw",114],["T_WHITESPACE"," ",114],["T_NEW","new",114],["T_WHITESPACE"," ",114],["T_STRING","CouldNotSaveException",114],"(",["T_STRING","__",114],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not add gift message to shopping cart'",114],")",")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n",116],"}",["T_WHITESPACE","\n",117]]