[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Review",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Rating resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Rating",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceModel",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Db",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractDb",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_CONST","const",15],["T_WHITESPACE"," ",15],["T_STRING","RATING_STATUS_APPROVED",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],["T_CONSTANT_ENCAPSED_STRING","'Approved'",15],";",["T_WHITESPACE","\n\n    ",15],["T_DOC_COMMENT","\/**\n     * Store manager\n     *\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",17],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$_storeManager",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Module\\Manager\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$moduleManager",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @var \\Psr\\Log\\LoggerInterface\n     *\/",29],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$_logger",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Psr\\Log\\LoggerInterface $logger\n     * @param \\Magento\\Framework\\Module\\Manager $moduleManager\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Review\\Model\\ResourceModel\\Review\\Summary $reviewSummary\n     * @param string $connectionName\n     *\/",34],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","__construct",42],"(",["T_WHITESPACE","\n        ",42],["T_NS_SEPARATOR","\\",43],["T_STRING","Magento",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Framework",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Model",43],["T_NS_SEPARATOR","\\",43],["T_STRING","ResourceModel",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Db",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Context",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$context",43],",",["T_WHITESPACE","\n        ",43],["T_NS_SEPARATOR","\\",44],["T_STRING","Psr",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Log",44],["T_NS_SEPARATOR","\\",44],["T_STRING","LoggerInterface",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$logger",44],",",["T_WHITESPACE","\n        ",44],["T_NS_SEPARATOR","\\",45],["T_STRING","Magento",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Framework",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Module",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Manager",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$moduleManager",45],",",["T_WHITESPACE","\n        ",45],["T_NS_SEPARATOR","\\",46],["T_STRING","Magento",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Store",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Model",46],["T_NS_SEPARATOR","\\",46],["T_STRING","StoreManagerInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$storeManager",46],",",["T_WHITESPACE","\n        ",46],["T_NS_SEPARATOR","\\",47],["T_STRING","Magento",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Review",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Model",47],["T_NS_SEPARATOR","\\",47],["T_STRING","ResourceModel",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Review",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Summary",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$reviewSummary",47],",",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$connectionName",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","null",48],["T_WHITESPACE","\n    ",48],")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","moduleManager",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$moduleManager",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_storeManager",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$storeManager",51],";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_logger",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$logger",52],";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_reviewSummary",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$reviewSummary",53],";",["T_WHITESPACE","\n        ",53],["T_STRING","parent",54],["T_DOUBLE_COLON","::",54],["T_STRING","__construct",54],"(",["T_VARIABLE","$context",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$connectionName",54],")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\n     * @return void\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","_construct",62],"(",")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_init",64],"(",["T_CONSTANT_ENCAPSED_STRING","'rating'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",64],")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Initialize unique fields\n     *\n     * @return $this\n     *\/",67],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","_initUniqueFields",72],"(",")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_uniqueFields",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],"[","[",["T_CONSTANT_ENCAPSED_STRING","'field'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'rating_code'",74],",",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'title'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","''",74],"]","]",";",["T_WHITESPACE","\n        ",74],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],";",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Retrieve select object for load object data\n     *\n     * @param string $field\n     * @param mixed $value\n     * @param \\Magento\\Review\\Model\\Rating $object\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",78],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","_getLoadSelect",86],"(",["T_VARIABLE","$field",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$value",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$object",86],")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$connection",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getConnection",88],"(",")",";",["T_WHITESPACE","\n\n        ",88],["T_VARIABLE","$table",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getMainTable",90],"(",")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$storeId",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_INT_CAST","(int)",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_storeManager",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getStore",91],"(",["T_NS_SEPARATOR","\\",91],["T_STRING","Magento",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Store",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Model",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Store",91],["T_DOUBLE_COLON","::",91],["T_STRING","ADMIN_CODE",91],")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getId",91],"(",")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$select",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","parent",92],["T_DOUBLE_COLON","::",92],["T_STRING","_getLoadSelect",92],"(",["T_VARIABLE","$field",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$value",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$object",92],")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$codeExpr",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$connection",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getIfNullSql",93],"(",["T_CONSTANT_ENCAPSED_STRING","'title.value'",93],",",["T_WHITESPACE"," ",93],"\"",["T_CURLY_OPEN","{",93],["T_VARIABLE","$table",93],"}",["T_ENCAPSED_AND_WHITESPACE",".rating_code",93],"\"",")",";",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$select",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","joinLeft",95],"(",["T_WHITESPACE","\n            ",95],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getTable",96],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_title'",96],")","]",",",["T_WHITESPACE","\n            ",96],["T_VARIABLE","$connection",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","quoteInto",97],"(","\"",["T_CURLY_OPEN","{",97],["T_VARIABLE","$table",97],"}",["T_ENCAPSED_AND_WHITESPACE",".rating_id = title.rating_id AND title.store_id = ?",97],"\"",",",["T_WHITESPACE"," ",97],["T_VARIABLE","$storeId",97],")",",",["T_WHITESPACE","\n            ",97],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_code'",98],["T_WHITESPACE"," ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$codeExpr",98],"]",["T_WHITESPACE","\n        ",98],")",";",["T_WHITESPACE","\n\n        ",99],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$select",101],";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Actions after load\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel|\\Magento\\Review\\Model\\Rating $object\n     * @return $this\n     *\/",104],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","_afterLoad",110],"(",["T_NS_SEPARATOR","\\",110],["T_STRING","Magento",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Framework",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Model",110],["T_NS_SEPARATOR","\\",110],["T_STRING","AbstractModel",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$object",110],")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_STRING","parent",112],["T_DOUBLE_COLON","::",112],["T_STRING","_afterLoad",112],"(",["T_VARIABLE","$object",112],")",";",["T_WHITESPACE","\n\n        ",112],["T_IF","if",114],["T_WHITESPACE"," ",114],"(","!",["T_VARIABLE","$object",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getId",114],"(",")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE","\n\n        ",116],["T_VARIABLE","$connection",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getConnection",118],"(",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$bind",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],"[",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_INT_CAST","(int)",119],["T_VARIABLE","$object",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getId",119],"(",")","]",";",["T_WHITESPACE","\n        ",119],["T_COMMENT","\/\/ load rating titles\n",120],["T_WHITESPACE","        ",121],["T_VARIABLE","$select",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$connection",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","select",121],"(",")",["T_OBJECT_OPERATOR","->",121],["T_STRING","from",121],"(",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getTable",122],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_title'",122],")",",",["T_WHITESPACE","\n            ",122],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'value'",123],"]",["T_WHITESPACE","\n        ",123],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","where",124],"(",["T_WHITESPACE","\n            ",124],["T_CONSTANT_ENCAPSED_STRING","'rating_id=:rating_id'",125],["T_WHITESPACE","\n        ",125],")",";",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$result",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$connection",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","fetchPairs",128],"(",["T_VARIABLE","$select",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$bind",128],")",";",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$result",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$object",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setRatingCodes",130],"(",["T_VARIABLE","$result",130],")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n\n        ",131],["T_COMMENT","\/\/ load rating available in stores\n",133],["T_WHITESPACE","        ",134],["T_VARIABLE","$object",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","setStores",134],"(",["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getStores",134],"(",["T_INT_CAST","(int)",134],["T_VARIABLE","$object",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getId",134],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",134],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Retrieve store IDs related to given rating\n     *\n     * @param  int $ratingId\n     * @return array\n     *\/",139],["T_WHITESPACE","\n    ",144],["T_PUBLIC","public",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","getStores",145],"(",["T_VARIABLE","$ratingId",145],")",["T_WHITESPACE","\n    ",145],"{",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$select",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getConnection",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","select",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","from",147],"(",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getTable",148],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",148],")",",",["T_WHITESPACE","\n            ",148],["T_CONSTANT_ENCAPSED_STRING","'store_id'",149],["T_WHITESPACE","\n        ",149],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","where",150],"(",["T_WHITESPACE","\n            ",150],["T_CONSTANT_ENCAPSED_STRING","'rating_id = ?'",151],",",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$ratingId",152],["T_WHITESPACE","\n        ",152],")",";",["T_WHITESPACE","\n        ",153],["T_RETURN","return",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getConnection",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","fetchCol",154],"(",["T_VARIABLE","$select",154],")",";",["T_WHITESPACE","\n    ",154],"}",["T_WHITESPACE","\n\n    ",155],["T_DOC_COMMENT","\/**\n     * Actions after save\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel|\\Magento\\Review\\Model\\Rating $object\n     * @return $this\n     *\/",157],["T_WHITESPACE","\n    ",162],["T_PROTECTED","protected",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","_afterSave",163],"(",["T_NS_SEPARATOR","\\",163],["T_STRING","Magento",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Framework",163],["T_NS_SEPARATOR","\\",163],["T_STRING","Model",163],["T_NS_SEPARATOR","\\",163],["T_STRING","AbstractModel",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$object",163],")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_STRING","parent",165],["T_DOUBLE_COLON","::",165],["T_STRING","_afterSave",165],"(",["T_VARIABLE","$object",165],")",";",["T_WHITESPACE","\n        ",165],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","hasRatingCodes",166],"(",")",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","processRatingCodes",167],"(",["T_VARIABLE","$object",167],")",";",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n\n        ",168],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_VARIABLE","$object",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","hasStores",170],"(",")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","processRatingStores",171],"(",["T_VARIABLE","$object",171],")",";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",177],["T_WHITESPACE","\n    ",180],["T_PROTECTED","protected",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","processRatingCodes",181],"(",["T_NS_SEPARATOR","\\",181],["T_STRING","Magento",181],["T_NS_SEPARATOR","\\",181],["T_STRING","Framework",181],["T_NS_SEPARATOR","\\",181],["T_STRING","Model",181],["T_NS_SEPARATOR","\\",181],["T_STRING","AbstractModel",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$object",181],")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$connection",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getConnection",183],"(",")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$ratingId",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_INT_CAST","(int)",184],["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getId",184],"(",")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$table",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getTable",185],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_title'",185],")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$select",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$connection",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","select",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","from",186],"(",["T_VARIABLE","$table",186],",",["T_WHITESPACE"," ",186],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'value'",186],"]",")",["T_WHITESPACE","\n            ",186],["T_OBJECT_OPERATOR","->",187],["T_STRING","where",187],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = :rating_id'",187],")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$old",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$connection",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","fetchPairs",188],"(",["T_VARIABLE","$select",188],",",["T_WHITESPACE"," ",188],"[",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",188],["T_WHITESPACE"," ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$ratingId",188],"]",")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$new",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","array_filter",189],"(",["T_STRING","array_map",189],"(",["T_CONSTANT_ENCAPSED_STRING","'trim'",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$object",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getRatingCodes",189],"(",")",")",")",";",["T_WHITESPACE","\n        ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","deleteRatingData",190],"(",["T_VARIABLE","$ratingId",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$table",190],",",["T_WHITESPACE"," ",190],["T_STRING","array_keys",190],"(",["T_STRING","array_diff_assoc",190],"(",["T_VARIABLE","$old",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$new",190],")",")",")",";",["T_WHITESPACE","\n\n        ",190],["T_VARIABLE","$insert",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],"[","]",";",["T_WHITESPACE","\n        ",192],["T_FOREACH","foreach",193],["T_WHITESPACE"," ",193],"(",["T_STRING","array_diff_assoc",193],"(",["T_VARIABLE","$new",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$old",193],")",["T_WHITESPACE"," ",193],["T_AS","as",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$storeId",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$title",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$insert",194],"[","]",["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$ratingId",194],",",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'store_id'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_INT_CAST","(int)",194],["T_VARIABLE","$storeId",194],",",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'value'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$title",194],"]",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n        ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","insertRatingData",196],"(",["T_VARIABLE","$table",196],",",["T_WHITESPACE"," ",196],["T_VARIABLE","$insert",196],")",";",["T_WHITESPACE","\n        ",196],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",200],["T_WHITESPACE","\n    ",203],["T_PROTECTED","protected",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","processRatingStores",204],"(",["T_NS_SEPARATOR","\\",204],["T_STRING","Magento",204],["T_NS_SEPARATOR","\\",204],["T_STRING","Framework",204],["T_NS_SEPARATOR","\\",204],["T_STRING","Model",204],["T_NS_SEPARATOR","\\",204],["T_STRING","AbstractModel",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$object",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$connection",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getConnection",206],"(",")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$ratingId",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_INT_CAST","(int)",207],["T_VARIABLE","$object",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getId",207],"(",")",";",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$table",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getTable",208],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",208],")",";",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$select",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$connection",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","select",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","from",209],"(",["T_VARIABLE","$table",209],",",["T_WHITESPACE"," ",209],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",209],"]",")",["T_WHITESPACE","\n            ",209],["T_OBJECT_OPERATOR","->",210],["T_STRING","where",210],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = :rating_id'",210],")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$old",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$connection",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","fetchCol",211],"(",["T_VARIABLE","$select",211],",",["T_WHITESPACE"," ",211],"[",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",211],["T_WHITESPACE"," ",211],["T_DOUBLE_ARROW","=>",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$ratingId",211],"]",")",";",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$new",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$object",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getStores",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","deleteRatingData",213],"(",["T_VARIABLE","$ratingId",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$table",213],",",["T_WHITESPACE"," ",213],["T_STRING","array_diff",213],"(",["T_VARIABLE","$old",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$new",213],")",")",";",["T_WHITESPACE","\n\n        ",213],["T_VARIABLE","$insert",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],"[","]",";",["T_WHITESPACE","\n        ",215],["T_FOREACH","foreach",216],["T_WHITESPACE"," ",216],"(",["T_STRING","array_diff",216],"(",["T_VARIABLE","$new",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$old",216],")",["T_WHITESPACE"," ",216],["T_AS","as",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$storeId",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$insert",217],"[","]",["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$ratingId",217],",",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","'store_id'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_INT_CAST","(int)",217],["T_VARIABLE","$storeId",217],"]",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n        ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","insertRatingData",219],"(",["T_VARIABLE","$table",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$insert",219],")",";",["T_WHITESPACE","\n        ",219],["T_RETURN","return",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_DOC_COMMENT","\/**\n     * @param int $ratingId\n     * @param string $table\n     * @param array $storeIds\n     * @return void\n     *\/",223],["T_WHITESPACE","\n    ",228],["T_PROTECTED","protected",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","deleteRatingData",229],"(",["T_VARIABLE","$ratingId",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$table",229],",",["T_WHITESPACE"," ",229],["T_ARRAY","array",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$storeIds",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_EMPTY","empty",231],"(",["T_VARIABLE","$storeIds",231],")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n            ",231],["T_RETURN","return",232],";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$connection",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getConnection",234],"(",")",";",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$connection",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","beginTransaction",235],"(",")",";",["T_WHITESPACE","\n        ",235],["T_TRY","try",236],["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$where",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id = ?'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$ratingId",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'store_id IN(?)'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$storeIds",237],"]",";",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$connection",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","delete",238],"(",["T_VARIABLE","$table",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$where",238],")",";",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$connection",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","commit",239],"(",")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE"," ",240],["T_CATCH","catch",240],["T_WHITESPACE"," ",240],"(",["T_NS_SEPARATOR","\\",240],["T_STRING","Exception",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$e",240],")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_logger",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","critical",241],"(",["T_VARIABLE","$e",241],")",";",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$connection",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","rollBack",242],"(",")",";",["T_WHITESPACE","\n        ",242],"}",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * @param string $table\n     * @param array $data\n     * @return void\n     *\/",246],["T_WHITESPACE","\n    ",250],["T_PROTECTED","protected",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","insertRatingData",251],"(",["T_VARIABLE","$table",251],",",["T_WHITESPACE"," ",251],["T_ARRAY","array",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$data",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_IF","if",253],["T_WHITESPACE"," ",253],"(",["T_EMPTY","empty",253],"(",["T_VARIABLE","$data",253],")",")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n            ",253],["T_RETURN","return",254],";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$connection",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getConnection",256],"(",")",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$connection",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","beginTransaction",257],"(",")",";",["T_WHITESPACE","\n        ",257],["T_TRY","try",258],["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_VARIABLE","$connection",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","insertMultiple",259],"(",["T_VARIABLE","$table",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$data",259],")",";",["T_WHITESPACE","\n            ",259],["T_VARIABLE","$connection",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","commit",260],"(",")",";",["T_WHITESPACE","\n        ",260],"}",["T_WHITESPACE"," ",261],["T_CATCH","catch",261],["T_WHITESPACE"," ",261],"(",["T_NS_SEPARATOR","\\",261],["T_STRING","Exception",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$e",261],")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_logger",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","critical",262],"(",["T_VARIABLE","$e",262],")",";",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$connection",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","rollBack",263],"(",")",";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n    ",265],["T_DOC_COMMENT","\/**\n     * Perform actions after object delete\n     * Prepare rating data for reaggregate all data for reviews\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",267],["T_WHITESPACE","\n    ",273],["T_PROTECTED","protected",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","_afterDelete",274],"(",["T_NS_SEPARATOR","\\",274],["T_STRING","Magento",274],["T_NS_SEPARATOR","\\",274],["T_STRING","Framework",274],["T_NS_SEPARATOR","\\",274],["T_STRING","Model",274],["T_NS_SEPARATOR","\\",274],["T_STRING","AbstractModel",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$object",274],")",["T_WHITESPACE","\n    ",274],"{",["T_WHITESPACE","\n        ",275],["T_STRING","parent",276],["T_DOUBLE_COLON","::",276],["T_STRING","_afterDelete",276],"(",["T_VARIABLE","$object",276],")",";",["T_WHITESPACE","\n        ",276],["T_IF","if",277],["T_WHITESPACE"," ",277],"(","!",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","moduleManager",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","isEnabled",277],"(",["T_CONSTANT_ENCAPSED_STRING","'Magento_Review'",277],")",")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_RETURN","return",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$data",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_getEntitySummaryData",280],"(",["T_VARIABLE","$object",280],")",";",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$summary",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],"[","]",";",["T_WHITESPACE","\n        ",281],["T_FOREACH","foreach",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$data",282],["T_WHITESPACE"," ",282],["T_AS","as",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$row",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$clone",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_CLONE","clone",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$object",283],";",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$clone",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","addData",284],"(",["T_VARIABLE","$row",284],")",";",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$summary",285],"[",["T_VARIABLE","$clone",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getStoreId",285],"(",")","]","[",["T_VARIABLE","$clone",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getEntityPkValue",285],"(",")","]",["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$clone",285],";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_reviewSummary",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","reAggregate",287],"(",["T_VARIABLE","$summary",287],")",";",["T_WHITESPACE","\n        ",287],["T_RETURN","return",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],";",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * Return array of rating summary\n     *\n     * @param \\Magento\\Review\\Model\\Rating $object\n     * @param boolean $onlyForCurrentStore\n     * @return array\n     *\/",291],["T_WHITESPACE","\n    ",297],["T_PUBLIC","public",298],["T_WHITESPACE"," ",298],["T_FUNCTION","function",298],["T_WHITESPACE"," ",298],["T_STRING","getEntitySummary",298],"(",["T_VARIABLE","$object",298],",",["T_WHITESPACE"," ",298],["T_VARIABLE","$onlyForCurrentStore",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_STRING","true",298],")",["T_WHITESPACE","\n    ",298],"{",["T_WHITESPACE","\n        ",299],["T_VARIABLE","$data",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_getEntitySummaryData",300],"(",["T_VARIABLE","$object",300],")",";",["T_WHITESPACE","\n\n        ",300],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$onlyForCurrentStore",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_FOREACH","foreach",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$data",303],["T_WHITESPACE"," ",303],["T_AS","as",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$row",303],")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$row",304],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",304],"]",["T_WHITESPACE"," ",304],["T_IS_EQUAL","==",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_storeManager",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getStore",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","getId",304],"(",")",")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                    ",304],["T_VARIABLE","$object",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","addData",305],"(",["T_VARIABLE","$row",305],")",";",["T_WHITESPACE","\n                ",305],"}",["T_WHITESPACE","\n            ",306],"}",["T_WHITESPACE","\n            ",307],["T_RETURN","return",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$object",308],";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_VARIABLE","$stores",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_storeManager",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getStores",311],"(",")",";",["T_WHITESPACE","\n\n        ",311],["T_VARIABLE","$result",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],"[","]",";",["T_WHITESPACE","\n        ",313],["T_FOREACH","foreach",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$data",314],["T_WHITESPACE"," ",314],["T_AS","as",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$row",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_VARIABLE","$clone",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_CLONE","clone",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$object",315],";",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$clone",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","addData",316],"(",["T_VARIABLE","$row",316],")",";",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$result",317],"[",["T_VARIABLE","$clone",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getStoreId",317],"(",")","]",["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$clone",317],";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n\n        ",318],["T_VARIABLE","$usedStoresId",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_STRING","array_keys",320],"(",["T_VARIABLE","$result",320],")",";",["T_WHITESPACE","\n        ",320],["T_FOREACH","foreach",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$stores",321],["T_WHITESPACE"," ",321],["T_AS","as",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$store",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_IF","if",322],["T_WHITESPACE"," ",322],"(","!",["T_STRING","in_array",322],"(",["T_VARIABLE","$store",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getId",322],"(",")",",",["T_WHITESPACE"," ",322],["T_VARIABLE","$usedStoresId",322],")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n                ",322],["T_VARIABLE","$clone",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_CLONE","clone",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$object",323],";",["T_WHITESPACE","\n                ",323],["T_VARIABLE","$clone",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","setCount",324],"(",["T_LNUMBER","0",324],")",";",["T_WHITESPACE","\n                ",324],["T_VARIABLE","$clone",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","setSum",325],"(",["T_LNUMBER","0",325],")",";",["T_WHITESPACE","\n                ",325],["T_VARIABLE","$clone",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","setStoreId",326],"(",["T_VARIABLE","$store",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getId",326],"(",")",")",";",["T_WHITESPACE","\n                ",326],["T_VARIABLE","$result",327],"[",["T_VARIABLE","$store",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getId",327],"(",")","]",["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$clone",327],";",["T_WHITESPACE","\n            ",327],"}",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n        ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_STRING","array_values",330],"(",["T_VARIABLE","$result",330],")",";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n    ",331],["T_DOC_COMMENT","\/**\n     * Return data of rating summary\n     *\n     * @param \\Magento\\Review\\Model\\Rating $object\n     * @return array\n     *\/",333],["T_WHITESPACE","\n    ",338],["T_PROTECTED","protected",339],["T_WHITESPACE"," ",339],["T_FUNCTION","function",339],["T_WHITESPACE"," ",339],["T_STRING","_getEntitySummaryData",339],"(",["T_VARIABLE","$object",339],")",["T_WHITESPACE","\n    ",339],"{",["T_WHITESPACE","\n        ",340],["T_VARIABLE","$connection",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getConnection",341],"(",")",";",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$sumColumn",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_NEW","new",343],["T_WHITESPACE"," ",343],["T_NS_SEPARATOR","\\",343],["T_STRING","Zend_Db_Expr",343],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(rating_vote.",343],["T_CURLY_OPEN","{",343],["T_VARIABLE","$connection",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","quoteIdentifier",343],"(",["T_CONSTANT_ENCAPSED_STRING","'percent'",343],")","}",["T_ENCAPSED_AND_WHITESPACE",")",343],"\"",")",";",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$countColumn",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_NEW","new",344],["T_WHITESPACE"," ",344],["T_NS_SEPARATOR","\\",344],["T_STRING","Zend_Db_Expr",344],"(",["T_CONSTANT_ENCAPSED_STRING","\"COUNT(*)\"",344],")",";",["T_WHITESPACE","\n\n        ",344],["T_VARIABLE","$select",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$connection",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","select",346],"(",")",["T_OBJECT_OPERATOR","->",346],["T_STRING","from",346],"(",["T_WHITESPACE","\n            ",346],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_vote'",347],["T_WHITESPACE"," ",347],["T_DOUBLE_ARROW","=>",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getTable",347],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote'",347],")","]",",",["T_WHITESPACE","\n            ",347],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value'",348],",",["T_WHITESPACE"," ",348],["T_CONSTANT_ENCAPSED_STRING","'sum'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$sumColumn",348],",",["T_WHITESPACE"," ",348],["T_CONSTANT_ENCAPSED_STRING","'count'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$countColumn",348],"]",["T_WHITESPACE","\n        ",348],")",["T_OBJECT_OPERATOR","->",349],["T_STRING","join",349],"(",["T_WHITESPACE","\n            ",349],"[",["T_CONSTANT_ENCAPSED_STRING","'review'",350],["T_WHITESPACE"," ",350],["T_DOUBLE_ARROW","=>",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getTable",350],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",350],")","]",",",["T_WHITESPACE","\n            ",350],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id=review.review_id'",351],",",["T_WHITESPACE","\n            ",351],"[","]",["T_WHITESPACE","\n        ",352],")",["T_OBJECT_OPERATOR","->",353],["T_STRING","joinLeft",353],"(",["T_WHITESPACE","\n            ",353],"[",["T_CONSTANT_ENCAPSED_STRING","'review_store'",354],["T_WHITESPACE"," ",354],["T_DOUBLE_ARROW","=>",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getTable",354],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",354],")","]",",",["T_WHITESPACE","\n            ",354],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id=review_store.review_id'",355],",",["T_WHITESPACE","\n            ",355],"[",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",356],"]",["T_WHITESPACE","\n        ",356],")",";",["T_WHITESPACE","\n        ",357],["T_IF","if",358],["T_WHITESPACE"," ",358],"(","!",["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_storeManager",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","isSingleStoreMode",358],"(",")",")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n            ",358],["T_VARIABLE","$select",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","join",359],"(",["T_WHITESPACE","\n                ",359],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",360],["T_WHITESPACE"," ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getTable",360],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",360],")","]",",",["T_WHITESPACE","\n                ",360],["T_CONSTANT_ENCAPSED_STRING","'rating_store.rating_id = rating_vote.rating_id AND rating_store.store_id = review_store.store_id'",361],",",["T_WHITESPACE","\n                ",361],"[","]",["T_WHITESPACE","\n            ",362],")",";",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$select",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","join",365],"(",["T_WHITESPACE","\n            ",365],"[",["T_CONSTANT_ENCAPSED_STRING","'review_status'",366],["T_WHITESPACE"," ",366],["T_DOUBLE_ARROW","=>",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getTable",366],"(",["T_CONSTANT_ENCAPSED_STRING","'review_status'",366],")","]",",",["T_WHITESPACE","\n            ",366],["T_CONSTANT_ENCAPSED_STRING","'review.status_id = review_status.status_id'",367],",",["T_WHITESPACE","\n            ",367],"[","]",["T_WHITESPACE","\n        ",368],")",["T_OBJECT_OPERATOR","->",369],["T_STRING","where",369],"(",["T_WHITESPACE","\n            ",369],["T_CONSTANT_ENCAPSED_STRING","'review_status.status_code = :status_code'",370],["T_WHITESPACE","\n        ",370],")",["T_OBJECT_OPERATOR","->",371],["T_STRING","group",371],"(",["T_WHITESPACE","\n            ",371],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value'",372],["T_WHITESPACE","\n        ",372],")",["T_OBJECT_OPERATOR","->",373],["T_STRING","group",373],"(",["T_WHITESPACE","\n            ",373],["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",374],["T_WHITESPACE","\n        ",374],")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$bind",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],"[",["T_CONSTANT_ENCAPSED_STRING","':status_code'",376],["T_WHITESPACE"," ",376],["T_DOUBLE_ARROW","=>",376],["T_WHITESPACE"," ",376],["T_STRING","self",376],["T_DOUBLE_COLON","::",376],["T_STRING","RATING_STATUS_APPROVED",376],"]",";",["T_WHITESPACE","\n\n        ",376],["T_VARIABLE","$entityPkValue",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$object",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getEntityPkValue",378],"(",")",";",["T_WHITESPACE","\n        ",378],["T_IF","if",379],["T_WHITESPACE"," ",379],"(",["T_VARIABLE","$entityPkValue",379],")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$select",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","where",380],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value = :pk_value'",380],")",";",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$bind",381],"[",["T_CONSTANT_ENCAPSED_STRING","':pk_value'",381],"]",["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$entityPkValue",381],";",["T_WHITESPACE","\n        ",381],"}",["T_WHITESPACE","\n\n        ",382],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$connection",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","fetchAll",384],"(",["T_VARIABLE","$select",384],",",["T_WHITESPACE"," ",384],["T_VARIABLE","$bind",384],")",";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_DOC_COMMENT","\/**\n     * Review summary\n     *\n     * @param \\Magento\\Review\\Model\\Rating $object\n     * @param boolean $onlyForCurrentStore\n     * @return array\n     *\/",387],["T_WHITESPACE","\n    ",393],["T_PUBLIC","public",394],["T_WHITESPACE"," ",394],["T_FUNCTION","function",394],["T_WHITESPACE"," ",394],["T_STRING","getReviewSummary",394],"(",["T_VARIABLE","$object",394],",",["T_WHITESPACE"," ",394],["T_VARIABLE","$onlyForCurrentStore",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_STRING","true",394],")",["T_WHITESPACE","\n    ",394],"{",["T_WHITESPACE","\n        ",395],["T_VARIABLE","$connection",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getConnection",396],"(",")",";",["T_WHITESPACE","\n\n        ",396],["T_VARIABLE","$sumColumn",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_NEW","new",398],["T_WHITESPACE"," ",398],["T_NS_SEPARATOR","\\",398],["T_STRING","Zend_Db_Expr",398],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(rating_vote.",398],["T_CURLY_OPEN","{",398],["T_VARIABLE","$connection",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","quoteIdentifier",398],"(",["T_CONSTANT_ENCAPSED_STRING","'percent'",398],")","}",["T_ENCAPSED_AND_WHITESPACE",")",398],"\"",")",";",["T_WHITESPACE","\n        ",398],["T_VARIABLE","$countColumn",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_NEW","new",399],["T_WHITESPACE"," ",399],["T_NS_SEPARATOR","\\",399],["T_STRING","Zend_Db_Expr",399],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",399],")",";",["T_WHITESPACE","\n        ",399],["T_VARIABLE","$select",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$connection",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","select",400],"(",")",["T_OBJECT_OPERATOR","->",400],["T_STRING","from",400],"(",["T_WHITESPACE","\n            ",400],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_vote'",401],["T_WHITESPACE"," ",401],["T_DOUBLE_ARROW","=>",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getTable",401],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote'",401],")","]",",",["T_WHITESPACE","\n            ",401],"[",["T_CONSTANT_ENCAPSED_STRING","'sum'",402],["T_WHITESPACE"," ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$sumColumn",402],",",["T_WHITESPACE"," ",402],["T_CONSTANT_ENCAPSED_STRING","'count'",402],["T_WHITESPACE"," ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$countColumn",402],"]",["T_WHITESPACE","\n        ",402],")",["T_OBJECT_OPERATOR","->",403],["T_STRING","joinLeft",403],"(",["T_WHITESPACE","\n            ",403],"[",["T_CONSTANT_ENCAPSED_STRING","'review_store'",404],["T_WHITESPACE"," ",404],["T_DOUBLE_ARROW","=>",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getTable",404],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",404],")","]",",",["T_WHITESPACE","\n            ",404],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id = review_store.review_id'",405],",",["T_WHITESPACE","\n            ",405],"[",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",406],"]",["T_WHITESPACE","\n        ",406],")",";",["T_WHITESPACE","\n        ",407],["T_IF","if",408],["T_WHITESPACE"," ",408],"(","!",["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_storeManager",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","isSingleStoreMode",408],"(",")",")",["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$select",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","join",409],"(",["T_WHITESPACE","\n                ",409],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",410],["T_WHITESPACE"," ",410],["T_DOUBLE_ARROW","=>",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getTable",410],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",410],")","]",",",["T_WHITESPACE","\n                ",410],["T_CONSTANT_ENCAPSED_STRING","'rating_store.rating_id = rating_vote.rating_id AND rating_store.store_id = review_store.store_id'",411],",",["T_WHITESPACE","\n                ",411],"[","]",["T_WHITESPACE","\n            ",412],")",";",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$select",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","where",415],"(",["T_WHITESPACE","\n            ",415],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id = :review_id'",416],["T_WHITESPACE","\n        ",416],")",["T_OBJECT_OPERATOR","->",417],["T_STRING","group",417],"(",["T_WHITESPACE","\n            ",417],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id'",418],["T_WHITESPACE","\n        ",418],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","group",419],"(",["T_WHITESPACE","\n            ",419],["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",420],["T_WHITESPACE","\n        ",420],")",";",["T_WHITESPACE","\n\n        ",421],["T_VARIABLE","$data",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$connection",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","fetchAll",423],"(",["T_VARIABLE","$select",423],",",["T_WHITESPACE"," ",423],"[",["T_CONSTANT_ENCAPSED_STRING","':review_id'",423],["T_WHITESPACE"," ",423],["T_DOUBLE_ARROW","=>",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$object",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getReviewId",423],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",423],["T_IF","if",425],["T_WHITESPACE"," ",425],"(",["T_VARIABLE","$onlyForCurrentStore",425],")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n            ",425],["T_FOREACH","foreach",426],["T_WHITESPACE"," ",426],"(",["T_VARIABLE","$data",426],["T_WHITESPACE"," ",426],["T_AS","as",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$row",426],")",["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n                ",426],["T_IF","if",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$row",427],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",427],"]",["T_WHITESPACE"," ",427],["T_IS_EQUAL","==",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_storeManager",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getStore",427],"(",")",["T_OBJECT_OPERATOR","->",427],["T_STRING","getId",427],"(",")",")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n                    ",427],["T_VARIABLE","$object",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","addData",428],"(",["T_VARIABLE","$row",428],")",";",["T_WHITESPACE","\n                ",428],"}",["T_WHITESPACE","\n            ",429],"}",["T_WHITESPACE","\n            ",430],["T_RETURN","return",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$object",431],";",["T_WHITESPACE","\n        ",431],"}",["T_WHITESPACE","\n\n        ",432],["T_VARIABLE","$result",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],"[","]",";",["T_WHITESPACE","\n\n        ",434],["T_VARIABLE","$stores",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","_storeManager",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getStore",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","getResourceCollection",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","load",436],"(",")",";",["T_WHITESPACE","\n\n        ",436],["T_FOREACH","foreach",438],["T_WHITESPACE"," ",438],"(",["T_VARIABLE","$data",438],["T_WHITESPACE"," ",438],["T_AS","as",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$row",438],")",["T_WHITESPACE"," ",438],"{",["T_WHITESPACE","\n            ",438],["T_VARIABLE","$clone",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_CLONE","clone",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$object",439],";",["T_WHITESPACE","\n            ",439],["T_VARIABLE","$clone",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","addData",440],"(",["T_VARIABLE","$row",440],")",";",["T_WHITESPACE","\n            ",440],["T_VARIABLE","$result",441],"[",["T_VARIABLE","$clone",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getStoreId",441],"(",")","]",["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$clone",441],";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE","\n\n        ",442],["T_VARIABLE","$usedStoresId",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_STRING","array_keys",444],"(",["T_VARIABLE","$result",444],")",";",["T_WHITESPACE","\n\n        ",444],["T_FOREACH","foreach",446],["T_WHITESPACE"," ",446],"(",["T_VARIABLE","$stores",446],["T_WHITESPACE"," ",446],["T_AS","as",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$store",446],")",["T_WHITESPACE"," ",446],"{",["T_WHITESPACE","\n            ",446],["T_IF","if",447],["T_WHITESPACE"," ",447],"(","!",["T_STRING","in_array",447],"(",["T_VARIABLE","$store",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getId",447],"(",")",",",["T_WHITESPACE"," ",447],["T_VARIABLE","$usedStoresId",447],")",")",["T_WHITESPACE"," ",447],"{",["T_WHITESPACE","\n                ",447],["T_VARIABLE","$clone",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_CLONE","clone",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$object",448],";",["T_WHITESPACE","\n                ",448],["T_VARIABLE","$clone",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","setCount",449],"(",["T_LNUMBER","0",449],")",";",["T_WHITESPACE","\n                ",449],["T_VARIABLE","$clone",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","setSum",450],"(",["T_LNUMBER","0",450],")",";",["T_WHITESPACE","\n                ",450],["T_VARIABLE","$clone",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","setStoreId",451],"(",["T_VARIABLE","$store",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getId",451],"(",")",")",";",["T_WHITESPACE","\n                ",451],["T_VARIABLE","$result",452],"[",["T_VARIABLE","$store",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getId",452],"(",")","]",["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_VARIABLE","$clone",452],";",["T_WHITESPACE","\n            ",452],"}",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n\n        ",454],["T_RETURN","return",456],["T_WHITESPACE"," ",456],["T_STRING","array_values",456],"(",["T_VARIABLE","$result",456],")",";",["T_WHITESPACE","\n    ",456],"}",["T_WHITESPACE","\n\n    ",457],["T_DOC_COMMENT","\/**\n     * Get rating entity type id by code\n     *\n     * @param string $entityCode\n     * @return int\n     *\/",459],["T_WHITESPACE","\n    ",464],["T_PUBLIC","public",465],["T_WHITESPACE"," ",465],["T_FUNCTION","function",465],["T_WHITESPACE"," ",465],["T_STRING","getEntityIdByCode",465],"(",["T_VARIABLE","$entityCode",465],")",["T_WHITESPACE","\n    ",465],"{",["T_WHITESPACE","\n        ",466],["T_VARIABLE","$select",467],["T_WHITESPACE"," ",467],"=",["T_WHITESPACE"," ",467],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getConnection",467],"(",")",["T_OBJECT_OPERATOR","->",467],["T_STRING","select",467],"(",")",["T_OBJECT_OPERATOR","->",467],["T_STRING","from",467],"(",["T_WHITESPACE","\n            ",467],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getTable",468],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_entity'",468],")",",",["T_WHITESPACE","\n            ",468],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",469],"]",["T_WHITESPACE","\n        ",469],")",["T_OBJECT_OPERATOR","->",470],["T_STRING","where",470],"(",["T_WHITESPACE","\n            ",470],["T_CONSTANT_ENCAPSED_STRING","'entity_code = :entity_code'",471],["T_WHITESPACE","\n        ",471],")",";",["T_WHITESPACE","\n\n        ",472],["T_RETURN","return",474],["T_WHITESPACE"," ",474],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getConnection",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","fetchOne",474],"(",["T_VARIABLE","$select",474],",",["T_WHITESPACE"," ",474],"[",["T_CONSTANT_ENCAPSED_STRING","':entity_code'",474],["T_WHITESPACE"," ",474],["T_DOUBLE_ARROW","=>",474],["T_WHITESPACE"," ",474],["T_VARIABLE","$entityCode",474],"]",")",";",["T_WHITESPACE","\n    ",474],"}",["T_WHITESPACE","\n\n    ",475],["T_DOC_COMMENT","\/**\n     * Delete ratings by product id\n     *\n     * @param int $productId\n     * @return $this\n     *\/",477],["T_WHITESPACE","\n    ",482],["T_PUBLIC","public",483],["T_WHITESPACE"," ",483],["T_FUNCTION","function",483],["T_WHITESPACE"," ",483],["T_STRING","deleteAggregatedRatingsByProductId",483],"(",["T_VARIABLE","$productId",483],")",["T_WHITESPACE","\n    ",483],"{",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$entityId",485],["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getEntityIdByCode",485],"(",["T_NS_SEPARATOR","\\",485],["T_STRING","Magento",485],["T_NS_SEPARATOR","\\",485],["T_STRING","Review",485],["T_NS_SEPARATOR","\\",485],["T_STRING","Model",485],["T_NS_SEPARATOR","\\",485],["T_STRING","Rating",485],["T_DOUBLE_COLON","::",485],["T_STRING","ENTITY_PRODUCT_CODE",485],")",";",["T_WHITESPACE","\n        ",485],["T_VARIABLE","$connection",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getConnection",486],"(",")",";",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$select",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$connection",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","select",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","from",487],"(",["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getMainTable",487],"(",")",",",["T_WHITESPACE"," ",487],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",487],")",["T_OBJECT_OPERATOR","->",487],["T_STRING","where",487],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",487],")",";",["T_WHITESPACE","\n        ",487],["T_VARIABLE","$ratingIds",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_VARIABLE","$connection",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","fetchCol",488],"(",["T_VARIABLE","$select",488],",",["T_WHITESPACE"," ",488],"[",["T_CONSTANT_ENCAPSED_STRING","':entity_id'",488],["T_WHITESPACE"," ",488],["T_DOUBLE_ARROW","=>",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$entityId",488],"]",")",";",["T_WHITESPACE","\n\n        ",488],["T_IF","if",490],["T_WHITESPACE"," ",490],"(",["T_VARIABLE","$ratingIds",490],")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n            ",490],["T_VARIABLE","$where",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value = ?'",491],["T_WHITESPACE"," ",491],["T_DOUBLE_ARROW","=>",491],["T_WHITESPACE"," ",491],["T_INT_CAST","(int)",491],["T_VARIABLE","$productId",491],",",["T_WHITESPACE"," ",491],["T_CONSTANT_ENCAPSED_STRING","'rating_id IN(?)'",491],["T_WHITESPACE"," ",491],["T_DOUBLE_ARROW","=>",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$ratingIds",491],"]",";",["T_WHITESPACE","\n            ",491],["T_VARIABLE","$connection",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","delete",492],"(",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getTable",492],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote_aggregated'",492],")",",",["T_WHITESPACE"," ",492],["T_VARIABLE","$where",492],")",";",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n\n        ",493],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$this",495],";",["T_WHITESPACE","\n    ",495],"}",["T_WHITESPACE","\n",496],"}",["T_WHITESPACE","\n",497]]