[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Review",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Review",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractModel",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Review summary resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","Summary",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","ResourceModel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Db",15],["T_NS_SEPARATOR","\\",15],["T_STRING","AbstractDb",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * Define module\n     *\n     * @return void\n     *\/",17],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_FUNCTION","function",22],["T_WHITESPACE"," ",22],["T_STRING","_construct",22],"(",")",["T_WHITESPACE","\n    ",22],"{",["T_WHITESPACE","\n        ",23],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","_init",24],"(",["T_CONSTANT_ENCAPSED_STRING","'review_entity_summary'",24],",",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",24],")",";",["T_WHITESPACE","\n    ",24],"}",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * Retrieve select object for load object data\n     *\n     * @param string $field\n     * @param mixed $value\n     * @param AbstractModel $object\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",27],["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_FUNCTION","function",35],["T_WHITESPACE"," ",35],["T_STRING","_getLoadSelect",35],"(",["T_VARIABLE","$field",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$value",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$object",35],")",["T_WHITESPACE","\n    ",35],"{",["T_WHITESPACE","\n        ",36],["T_VARIABLE","$select",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","parent",37],["T_DOUBLE_COLON","::",37],["T_STRING","_getLoadSelect",37],"(",["T_VARIABLE","$field",37],",",["T_WHITESPACE"," ",37],["T_VARIABLE","$value",37],",",["T_WHITESPACE"," ",37],["T_VARIABLE","$object",37],")",";",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$select",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","where",38],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",38],",",["T_WHITESPACE"," ",38],["T_INT_CAST","(int)",38],["T_VARIABLE","$object",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getStoreId",38],"(",")",")",";",["T_WHITESPACE","\n        ",38],["T_RETURN","return",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$select",39],";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Re-aggregate all data by rating summary\n     *\n     * @param array $summary\n     * @return $this\n     *\/",42],["T_WHITESPACE","\n    ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","reAggregate",48],"(",["T_VARIABLE","$summary",48],")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$connection",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getConnection",50],"(",")",";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$select",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$connection",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","select",51],"(",")",["T_OBJECT_OPERATOR","->",51],["T_STRING","from",51],"(",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getMainTable",52],"(",")",",",["T_WHITESPACE","\n            ",52],"[",["T_CONSTANT_ENCAPSED_STRING","'primary_id'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_NEW","new",53],["T_WHITESPACE"," ",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Zend_Db_Expr",53],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX(primary_id)'",53],")",",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'store_id'",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",53],"]",["T_WHITESPACE","\n        ",53],")",["T_OBJECT_OPERATOR","->",54],["T_STRING","group",54],"(",["T_WHITESPACE","\n            ",54],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'store_id'",55],"]",["T_WHITESPACE","\n        ",55],")",";",["T_WHITESPACE","\n        ",56],["T_FOREACH","foreach",57],["T_WHITESPACE"," ",57],"(",["T_VARIABLE","$connection",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","fetchAll",57],"(",["T_VARIABLE","$select",57],")",["T_WHITESPACE"," ",57],["T_AS","as",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$row",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n            ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_ISSET","isset",58],"(",["T_VARIABLE","$summary",58],"[",["T_VARIABLE","$row",58],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",58],"]","]",")",["T_WHITESPACE"," ",58],["T_BOOLEAN_AND","&&",58],["T_WHITESPACE"," ",58],["T_ISSET","isset",58],"(",["T_VARIABLE","$summary",58],"[",["T_VARIABLE","$row",58],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",58],"]","]","[",["T_VARIABLE","$row",58],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",58],"]","]",")",")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n                ",58],["T_VARIABLE","$summaryItem",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$summary",59],"[",["T_VARIABLE","$row",59],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",59],"]","]","[",["T_VARIABLE","$row",59],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",59],"]","]",";",["T_WHITESPACE","\n                ",59],["T_IF","if",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$summaryItem",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getCount",60],"(",")",")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n                    ",60],["T_VARIABLE","$ratingSummary",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","round",61],"(",["T_VARIABLE","$summaryItem",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getSum",61],"(",")",["T_WHITESPACE"," ",61],"\/",["T_WHITESPACE"," ",61],["T_VARIABLE","$summaryItem",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getCount",61],"(",")",")",";",["T_WHITESPACE","\n                ",61],"}",["T_WHITESPACE"," ",62],["T_ELSE","else",62],["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n                    ",62],["T_VARIABLE","$ratingSummary",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$summaryItem",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getSum",63],"(",")",";",["T_WHITESPACE","\n                ",63],"}",["T_WHITESPACE","\n            ",64],"}",["T_WHITESPACE"," ",65],["T_ELSE","else",65],["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                ",65],["T_VARIABLE","$ratingSummary",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_LNUMBER","0",66],";",["T_WHITESPACE","\n            ",66],"}",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$connection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","update",68],"(",["T_WHITESPACE","\n                ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getMainTable",69],"(",")",",",["T_WHITESPACE","\n                ",69],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_summary'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$ratingSummary",70],"]",",",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$connection",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","quoteInto",71],"(",["T_CONSTANT_ENCAPSED_STRING","'primary_id = ?'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$row",71],"[",["T_CONSTANT_ENCAPSED_STRING","'primary_id'",71],"]",")",["T_WHITESPACE","\n            ",71],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n        ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n",75],"}",["T_WHITESPACE","\n",76]]