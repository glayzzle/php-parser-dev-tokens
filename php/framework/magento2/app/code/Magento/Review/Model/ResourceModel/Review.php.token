[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Review",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractModel",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Review resource model\n *\/",10],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Review",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceModel",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Db",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractDb",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * Review table\n     *\n     * @var string\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$_reviewTable",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * Review Detail table\n     *\n     * @var string\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_reviewDetailTable",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Review status table\n     *\n     * @var string\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_reviewStatusTable",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Review entity table\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_reviewEntityTable",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Review store table\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_reviewStoreTable",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Review aggregate table\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_aggregateTable",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Cache of deleted rating data\n     *\n     * @var array\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PRIVATE","private",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_deleteCache",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],"[","]",";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Core date model\n     *\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\DateTime\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_date",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Core model store manager interface\n     *\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_storeManager",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Rating model\n     *\n     * @var \\Magento\\Review\\Model\\RatingFactory\n     *\/",78],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_ratingFactory",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Rating resource model\n     *\n     * @var \\Magento\\Review\\Model\\ResourceModel\\Rating\\Option\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_ratingOptions",90],";",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $date\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Review\\Model\\RatingFactory $ratingFactory\n     * @param \\Magento\\Review\\Model\\ResourceModel\\Rating\\Option $ratingOptions\n     * @param string $connectionName\n     *\/",92],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","__construct",100],"(",["T_WHITESPACE","\n        ",100],["T_NS_SEPARATOR","\\",101],["T_STRING","Magento",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Framework",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Model",101],["T_NS_SEPARATOR","\\",101],["T_STRING","ResourceModel",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Db",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Context",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$context",101],",",["T_WHITESPACE","\n        ",101],["T_NS_SEPARATOR","\\",102],["T_STRING","Magento",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Framework",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Stdlib",102],["T_NS_SEPARATOR","\\",102],["T_STRING","DateTime",102],["T_NS_SEPARATOR","\\",102],["T_STRING","DateTime",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$date",102],",",["T_WHITESPACE","\n        ",102],["T_NS_SEPARATOR","\\",103],["T_STRING","Magento",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Store",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Model",103],["T_NS_SEPARATOR","\\",103],["T_STRING","StoreManagerInterface",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$storeManager",103],",",["T_WHITESPACE","\n        ",103],["T_NS_SEPARATOR","\\",104],["T_STRING","Magento",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Review",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Model",104],["T_NS_SEPARATOR","\\",104],["T_STRING","RatingFactory",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$ratingFactory",104],",",["T_WHITESPACE","\n        ",104],["T_STRING","Rating",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Option",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$ratingOptions",105],",",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$connectionName",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","null",106],["T_WHITESPACE","\n    ",106],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_date",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$date",108],";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_storeManager",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$storeManager",109],";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_ratingFactory",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$ratingFactory",110],";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_ratingOptions",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$ratingOptions",111],";",["T_WHITESPACE","\n\n        ",111],["T_STRING","parent",113],["T_DOUBLE_COLON","::",113],["T_STRING","__construct",113],"(",["T_VARIABLE","$context",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$connectionName",113],")",";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Define main table. Define other tables name\n     *\n     * @return void\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","_construct",121],"(",")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_init",123],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'review_id'",123],")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_reviewTable",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getTable",124],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",124],")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_reviewDetailTable",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getTable",125],"(",["T_CONSTANT_ENCAPSED_STRING","'review_detail'",125],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_reviewStatusTable",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getTable",126],"(",["T_CONSTANT_ENCAPSED_STRING","'review_status'",126],")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_reviewEntityTable",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getTable",127],"(",["T_CONSTANT_ENCAPSED_STRING","'review_entity'",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_reviewStoreTable",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getTable",128],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",128],")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_aggregateTable",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getTable",129],"(",["T_CONSTANT_ENCAPSED_STRING","'review_entity_summary'",129],")",";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Retrieve select object for load object data\n     *\n     * @param string $field\n     * @param mixed $value\n     * @param AbstractModel $object\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",132],["T_WHITESPACE","\n    ",139],["T_PROTECTED","protected",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","_getLoadSelect",140],"(",["T_VARIABLE","$field",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$value",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$object",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$select",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","parent",142],["T_DOUBLE_COLON","::",142],["T_STRING","_getLoadSelect",142],"(",["T_VARIABLE","$field",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$value",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$object",142],")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$select",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","join",143],"(",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_reviewDetailTable",144],",",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getMainTable",145],"(",")",["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],"\"",["T_ENCAPSED_AND_WHITESPACE",".review_id = ",145],["T_CURLY_OPEN","{",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_reviewDetailTable",145],"}",["T_ENCAPSED_AND_WHITESPACE",".review_id",145],"\"",["T_WHITESPACE","\n        ",145],")",";",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$select",147],";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Perform actions before object save\n     *\n     * @param AbstractModel $object\n     * @return $this\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PROTECTED","protected",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","_beforeSave",156],"(",["T_STRING","AbstractModel",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$object",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_IF","if",158],["T_WHITESPACE"," ",158],"(","!",["T_VARIABLE","$object",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getId",158],"(",")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$object",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","setCreatedAt",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_date",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","gmtDate",159],"(",")",")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n        ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$object",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","hasData",161],"(",["T_CONSTANT_ENCAPSED_STRING","'stores'",161],")",["T_WHITESPACE"," ",161],["T_BOOLEAN_AND","&&",161],["T_WHITESPACE"," ",161],["T_STRING","is_array",161],"(",["T_VARIABLE","$object",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getStores",161],"(",")",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$stores",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$object",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getStores",162],"(",")",";",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$stores",163],"[","]",["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_LNUMBER","0",163],";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$object",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setStores",164],"(",["T_VARIABLE","$stores",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE"," ",165],["T_ELSEIF","elseif",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$object",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","hasData",165],"(",["T_CONSTANT_ENCAPSED_STRING","'stores'",165],")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setStores",166],"(","[",["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getStores",166],"(",")",",",["T_WHITESPACE"," ",166],["T_LNUMBER","0",166],"]",")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Perform actions after object save\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",171],["T_WHITESPACE","\n    ",176],["T_PROTECTED","protected",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","_afterSave",177],"(",["T_STRING","AbstractModel",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$object",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$connection",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getConnection",179],"(",")",";",["T_WHITESPACE","\n        ",179],["T_DOC_COMMENT","\/**\n         * save detail\n         *\/",180],["T_WHITESPACE","\n        ",182],["T_VARIABLE","$detail",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],"[",["T_WHITESPACE","\n            ",183],["T_CONSTANT_ENCAPSED_STRING","'title'",184],["T_WHITESPACE"," ",184],["T_DOUBLE_ARROW","=>",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getTitle",184],"(",")",",",["T_WHITESPACE","\n            ",184],["T_CONSTANT_ENCAPSED_STRING","'detail'",185],["T_WHITESPACE"," ",185],["T_DOUBLE_ARROW","=>",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$object",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getDetail",185],"(",")",",",["T_WHITESPACE","\n            ",185],["T_CONSTANT_ENCAPSED_STRING","'nickname'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$object",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getNickname",186],"(",")",",",["T_WHITESPACE","\n        ",186],"]",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$select",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$connection",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","select",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","from",188],"(",["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_reviewDetailTable",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'detail_id'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","where",188],"(",["T_CONSTANT_ENCAPSED_STRING","'review_id = :review_id'",188],")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$detailId",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$connection",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","fetchOne",189],"(",["T_VARIABLE","$select",189],",",["T_WHITESPACE"," ",189],"[",["T_CONSTANT_ENCAPSED_STRING","':review_id'",189],["T_WHITESPACE"," ",189],["T_DOUBLE_ARROW","=>",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$object",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getId",189],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",189],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$detailId",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$condition",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],"[",["T_CONSTANT_ENCAPSED_STRING","\"detail_id = ?\"",192],["T_WHITESPACE"," ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$detailId",192],"]",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$connection",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","update",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_reviewDetailTable",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$detail",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$condition",193],")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE"," ",194],["T_ELSE","else",194],["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$detail",195],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",195],"]",["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$object",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getStoreId",195],"(",")",";",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$detail",196],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",196],"]",["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$object",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getCustomerId",196],"(",")",";",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$detail",197],"[",["T_CONSTANT_ENCAPSED_STRING","'review_id'",197],"]",["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$object",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getId",197],"(",")",";",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$connection",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","insert",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_reviewDetailTable",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$detail",198],")",";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n\n        ",199],["T_DOC_COMMENT","\/**\n         * save stores\n         *\/",201],["T_WHITESPACE","\n        ",203],["T_VARIABLE","$stores",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$object",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getStores",204],"(",")",";",["T_WHITESPACE","\n        ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(","!",["T_EMPTY","empty",205],"(",["T_VARIABLE","$stores",205],")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$condition",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],"[",["T_CONSTANT_ENCAPSED_STRING","'review_id = ?'",206],["T_WHITESPACE"," ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$object",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getId",206],"(",")","]",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$connection",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","delete",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_reviewStoreTable",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$condition",207],")",";",["T_WHITESPACE","\n\n            ",207],["T_VARIABLE","$insertedStoreIds",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],"[","]",";",["T_WHITESPACE","\n            ",209],["T_FOREACH","foreach",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$stores",210],["T_WHITESPACE"," ",210],["T_AS","as",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$storeId",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                ",210],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_STRING","in_array",211],"(",["T_VARIABLE","$storeId",211],",",["T_WHITESPACE"," ",211],["T_VARIABLE","$insertedStoreIds",211],")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                    ",211],["T_CONTINUE","continue",212],";",["T_WHITESPACE","\n                ",212],"}",["T_WHITESPACE","\n\n                ",213],["T_VARIABLE","$insertedStoreIds",215],"[","]",["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$storeId",215],";",["T_WHITESPACE","\n                ",215],["T_VARIABLE","$storeInsert",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$storeId",216],",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'review_id'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$object",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getId",216],"(",")","]",";",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$connection",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","insert",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_reviewStoreTable",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$storeInsert",217],")",";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n\n        ",219],["T_COMMENT","\/\/ reaggregate ratings, that depend on this review\n",221],["T_WHITESPACE","        ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_aggregateRatings",222],"(",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_loadVotedRatingIds",222],"(",["T_VARIABLE","$object",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getId",222],"(",")",")",",",["T_WHITESPACE"," ",222],["T_VARIABLE","$object",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getEntityPkValue",222],"(",")",")",";",["T_WHITESPACE","\n\n        ",222],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * Perform actions after object load\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",227],["T_WHITESPACE","\n    ",232],["T_PROTECTED","protected",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","_afterLoad",233],"(",["T_STRING","AbstractModel",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$object",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$connection",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getConnection",235],"(",")",";",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$select",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$connection",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","select",236],"(",")",["T_OBJECT_OPERATOR","->",236],["T_STRING","from",236],"(",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_reviewStoreTable",237],",",["T_WHITESPACE","\n            ",237],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",238],"]",["T_WHITESPACE","\n        ",238],")",["T_OBJECT_OPERATOR","->",239],["T_STRING","where",239],"(",["T_WHITESPACE","\n            ",239],["T_CONSTANT_ENCAPSED_STRING","'review_id = :review_id'",240],["T_WHITESPACE","\n        ",240],")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$stores",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$connection",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","fetchCol",242],"(",["T_VARIABLE","$select",242],",",["T_WHITESPACE"," ",242],"[",["T_CONSTANT_ENCAPSED_STRING","':review_id'",242],["T_WHITESPACE"," ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$object",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getId",242],"(",")","]",")",";",["T_WHITESPACE","\n        ",242],["T_IF","if",243],["T_WHITESPACE"," ",243],"(",["T_EMPTY","empty",243],"(",["T_VARIABLE","$stores",243],")",["T_WHITESPACE"," ",243],["T_BOOLEAN_AND","&&",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_storeManager",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","hasSingleStore",243],"(",")",")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$object",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","setStores",244],"(","[",["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_storeManager",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getStore",244],"(",["T_STRING","true",244],")",["T_OBJECT_OPERATOR","->",244],["T_STRING","getId",244],"(",")","]",")",";",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE"," ",245],["T_ELSE","else",245],["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$object",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setStores",246],"(",["T_VARIABLE","$stores",246],")",";",["T_WHITESPACE","\n        ",246],"}",["T_WHITESPACE","\n        ",247],["T_RETURN","return",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Action before delete\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",251],["T_WHITESPACE","\n    ",256],["T_PROTECTED","protected",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","_beforeDelete",257],"(",["T_STRING","AbstractModel",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$object",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_COMMENT","\/\/ prepare rating ids, that depend on review\n",259],["T_WHITESPACE","        ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_deleteCache",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],"[",["T_WHITESPACE","\n            ",260],["T_CONSTANT_ENCAPSED_STRING","'ratingIds'",261],["T_WHITESPACE"," ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_loadVotedRatingIds",261],"(",["T_VARIABLE","$object",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getId",261],"(",")",")",",",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'entityPkValue'",262],["T_WHITESPACE"," ",262],["T_DOUBLE_ARROW","=>",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$object",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getEntityPkValue",262],"(",")",",",["T_WHITESPACE","\n        ",262],"]",";",["T_WHITESPACE","\n        ",263],["T_RETURN","return",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n    ",265],["T_DOC_COMMENT","\/**\n     * Perform actions after object delete\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",267],["T_WHITESPACE","\n    ",272],["T_PUBLIC","public",273],["T_WHITESPACE"," ",273],["T_FUNCTION","function",273],["T_WHITESPACE"," ",273],["T_STRING","afterDeleteCommit",273],"(",["T_STRING","AbstractModel",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$object",273],")",["T_WHITESPACE","\n    ",273],"{",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","aggregate",275],"(",["T_VARIABLE","$object",275],")",";",["T_WHITESPACE","\n\n        ",275],["T_COMMENT","\/\/ reaggregate ratings, that depended on this review\n",277],["T_WHITESPACE","        ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_aggregateRatings",278],"(",["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_deleteCache",278],"[",["T_CONSTANT_ENCAPSED_STRING","'ratingIds'",278],"]",",",["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_deleteCache",278],"[",["T_CONSTANT_ENCAPSED_STRING","'entityPkValue'",278],"]",")",";",["T_WHITESPACE","\n        ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_deleteCache",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],"[","]",";",["T_WHITESPACE","\n\n        ",279],["T_RETURN","return",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],";",["T_WHITESPACE","\n    ",281],"}",["T_WHITESPACE","\n\n    ",282],["T_DOC_COMMENT","\/**\n     * Retrieves total reviews\n     *\n     * @param int $entityPkValue\n     * @param bool $approvedOnly\n     * @param int $storeId\n     * @return int\n     *\/",284],["T_WHITESPACE","\n    ",291],["T_PUBLIC","public",292],["T_WHITESPACE"," ",292],["T_FUNCTION","function",292],["T_WHITESPACE"," ",292],["T_STRING","getTotalReviews",292],"(",["T_VARIABLE","$entityPkValue",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$approvedOnly",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","false",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$storeId",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_LNUMBER","0",292],")",["T_WHITESPACE","\n    ",292],"{",["T_WHITESPACE","\n        ",293],["T_VARIABLE","$connection",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getConnection",294],"(",")",";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$select",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$connection",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","select",295],"(",")",["T_OBJECT_OPERATOR","->",295],["T_STRING","from",295],"(",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_reviewTable",296],",",["T_WHITESPACE","\n            ",296],"[",["T_CONSTANT_ENCAPSED_STRING","'review_count'",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_NEW","new",297],["T_WHITESPACE"," ",297],["T_NS_SEPARATOR","\\",297],["T_STRING","Zend_Db_Expr",297],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",297],")","]",["T_WHITESPACE","\n        ",297],")",["T_OBJECT_OPERATOR","->",298],["T_STRING","where",298],"(",["T_WHITESPACE","\n            ",298],"\"",["T_CURLY_OPEN","{",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_reviewTable",299],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_pk_value = :pk_value",299],"\"",["T_WHITESPACE","\n        ",299],")",";",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$bind",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],"[",["T_CONSTANT_ENCAPSED_STRING","':pk_value'",301],["T_WHITESPACE"," ",301],["T_DOUBLE_ARROW","=>",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$entityPkValue",301],"]",";",["T_WHITESPACE","\n        ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$storeId",302],["T_WHITESPACE"," ",302],">",["T_WHITESPACE"," ",302],["T_LNUMBER","0",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$select",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","join",303],"(",["T_WHITESPACE","\n                ",303],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",304],["T_WHITESPACE"," ",304],["T_DOUBLE_ARROW","=>",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_reviewStoreTable",304],"]",",",["T_WHITESPACE","\n                ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_reviewTable",305],["T_WHITESPACE"," ",305],".",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'.review_id=store.review_id AND store.store_id = :store_id'",305],",",["T_WHITESPACE","\n                ",305],"[","]",["T_WHITESPACE","\n            ",306],")",";",["T_WHITESPACE","\n            ",307],["T_VARIABLE","$bind",308],"[",["T_CONSTANT_ENCAPSED_STRING","':store_id'",308],"]",["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_INT_CAST","(int)",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$storeId",308],";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$approvedOnly",310],")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_VARIABLE","$select",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","where",311],"(","\"",["T_CURLY_OPEN","{",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_reviewTable",311],"}",["T_ENCAPSED_AND_WHITESPACE",".status_id = :status_id",311],"\"",")",";",["T_WHITESPACE","\n            ",311],["T_VARIABLE","$bind",312],"[",["T_CONSTANT_ENCAPSED_STRING","':status_id'",312],"]",["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_NS_SEPARATOR","\\",312],["T_STRING","Magento",312],["T_NS_SEPARATOR","\\",312],["T_STRING","Review",312],["T_NS_SEPARATOR","\\",312],["T_STRING","Model",312],["T_NS_SEPARATOR","\\",312],["T_STRING","Review",312],["T_DOUBLE_COLON","::",312],["T_STRING","STATUS_APPROVED",312],";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n        ",313],["T_RETURN","return",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$connection",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","fetchOne",314],"(",["T_VARIABLE","$select",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$bind",314],")",";",["T_WHITESPACE","\n    ",314],"}",["T_WHITESPACE","\n\n    ",315],["T_DOC_COMMENT","\/**\n     * Aggregate\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return void\n     *\/",317],["T_WHITESPACE","\n    ",322],["T_PUBLIC","public",323],["T_WHITESPACE"," ",323],["T_FUNCTION","function",323],["T_WHITESPACE"," ",323],["T_STRING","aggregate",323],"(",["T_VARIABLE","$object",323],")",["T_WHITESPACE","\n    ",323],"{",["T_WHITESPACE","\n        ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(","!",["T_VARIABLE","$object",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getEntityPkValue",325],"(",")",["T_WHITESPACE"," ",325],["T_BOOLEAN_AND","&&",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$object",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getId",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$object",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","load",326],"(",["T_VARIABLE","$object",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getReviewId",326],"(",")",")",";",["T_WHITESPACE","\n        ",326],"}",["T_WHITESPACE","\n\n        ",327],["T_VARIABLE","$ratingModel",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_ratingFactory",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","create",329],"(",")",";",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$ratingSummaries",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$ratingModel",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getEntitySummary",330],"(",["T_VARIABLE","$object",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getEntityPkValue",330],"(",")",",",["T_WHITESPACE"," ",330],["T_STRING","false",330],")",";",["T_WHITESPACE","\n\n        ",330],["T_FOREACH","foreach",332],["T_WHITESPACE"," ",332],"(",["T_VARIABLE","$ratingSummaries",332],["T_WHITESPACE"," ",332],["T_AS","as",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$ratingSummaryObject",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n            ",332],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","aggregateReviewSummary",333],"(",["T_VARIABLE","$object",333],",",["T_WHITESPACE"," ",333],["T_VARIABLE","$ratingSummaryObject",333],")",";",["T_WHITESPACE","\n        ",333],"}",["T_WHITESPACE","\n    ",334],"}",["T_WHITESPACE","\n\n    ",335],["T_DOC_COMMENT","\/**\n     * Aggregate review summary\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @param \\Magento\\Review\\Model\\Rating $ratingSummaryObject\n     * @return void\n     *\/",337],["T_WHITESPACE","\n    ",343],["T_PROTECTED","protected",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","aggregateReviewSummary",344],"(",["T_VARIABLE","$object",344],",",["T_WHITESPACE"," ",344],["T_VARIABLE","$ratingSummaryObject",344],")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$connection",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getConnection",346],"(",")",";",["T_WHITESPACE","\n\n        ",346],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$ratingSummaryObject",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getCount",348],"(",")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$ratingSummary",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","round",349],"(",["T_VARIABLE","$ratingSummaryObject",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getSum",349],"(",")",["T_WHITESPACE"," ",349],"\/",["T_WHITESPACE"," ",349],["T_VARIABLE","$ratingSummaryObject",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getCount",349],"(",")",")",";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE"," ",350],["T_ELSE","else",350],["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$ratingSummary",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$ratingSummaryObject",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getSum",351],"(",")",";",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n\n        ",352],["T_VARIABLE","$reviewsCount",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getTotalReviews",354],"(",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$object",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getEntityPkValue",355],"(",")",",",["T_WHITESPACE","\n            ",355],["T_STRING","true",356],",",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$ratingSummaryObject",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getStoreId",357],"(",")",["T_WHITESPACE","\n        ",357],")",";",["T_WHITESPACE","\n        ",358],["T_VARIABLE","$select",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_VARIABLE","$connection",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","select",359],"(",")",["T_OBJECT_OPERATOR","->",359],["T_STRING","from",359],"(",["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","_aggregateTable",359],")",["T_WHITESPACE","\n            ",359],["T_OBJECT_OPERATOR","->",360],["T_STRING","where",360],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value = :pk_value'",360],")",["T_WHITESPACE","\n            ",360],["T_OBJECT_OPERATOR","->",361],["T_STRING","where",361],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type = :entity_type'",361],")",["T_WHITESPACE","\n            ",361],["T_OBJECT_OPERATOR","->",362],["T_STRING","where",362],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",362],")",";",["T_WHITESPACE","\n        ",362],["T_VARIABLE","$bind",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],"[",["T_WHITESPACE","\n            ",363],["T_CONSTANT_ENCAPSED_STRING","':pk_value'",364],["T_WHITESPACE"," ",364],["T_DOUBLE_ARROW","=>",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$object",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getEntityPkValue",364],"(",")",",",["T_WHITESPACE","\n            ",364],["T_CONSTANT_ENCAPSED_STRING","':entity_type'",365],["T_WHITESPACE"," ",365],["T_DOUBLE_ARROW","=>",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$object",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getEntityId",365],"(",")",",",["T_WHITESPACE","\n            ",365],["T_CONSTANT_ENCAPSED_STRING","':store_id'",366],["T_WHITESPACE"," ",366],["T_DOUBLE_ARROW","=>",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$ratingSummaryObject",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getStoreId",366],"(",")",",",["T_WHITESPACE","\n        ",366],"]",";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$oldData",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$connection",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","fetchRow",368],"(",["T_VARIABLE","$select",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$bind",368],")",";",["T_WHITESPACE","\n        ",368],["T_VARIABLE","$data",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_NEW","new",369],["T_WHITESPACE"," ",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Magento",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Framework",369],["T_NS_SEPARATOR","\\",369],["T_STRING","DataObject",369],"(",")",";",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$data",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setReviewsCount",371],"(",["T_VARIABLE","$reviewsCount",371],")",["T_WHITESPACE","\n            ",371],["T_OBJECT_OPERATOR","->",372],["T_STRING","setEntityPkValue",372],"(",["T_VARIABLE","$object",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getEntityPkValue",372],"(",")",")",["T_WHITESPACE","\n            ",372],["T_OBJECT_OPERATOR","->",373],["T_STRING","setEntityType",373],"(",["T_VARIABLE","$object",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getEntityId",373],"(",")",")",["T_WHITESPACE","\n            ",373],["T_OBJECT_OPERATOR","->",374],["T_STRING","setRatingSummary",374],"(",["T_VARIABLE","$ratingSummary",374],["T_WHITESPACE"," ",374],">",["T_WHITESPACE"," ",374],["T_LNUMBER","0",374],["T_WHITESPACE"," ",374],"?",["T_WHITESPACE"," ",374],["T_VARIABLE","$ratingSummary",374],["T_WHITESPACE"," ",374],":",["T_WHITESPACE"," ",374],["T_LNUMBER","0",374],")",["T_WHITESPACE","\n            ",374],["T_OBJECT_OPERATOR","->",375],["T_STRING","setStoreId",375],"(",["T_VARIABLE","$ratingSummaryObject",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getStoreId",375],"(",")",")",";",["T_WHITESPACE","\n\n        ",375],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","writeReviewSummary",377],"(",["T_VARIABLE","$oldData",377],",",["T_WHITESPACE"," ",377],["T_VARIABLE","$data",377],")",";",["T_WHITESPACE","\n    ",377],"}",["T_WHITESPACE","\n\n    ",378],["T_DOC_COMMENT","\/**\n     * Write rating summary\n     *\n     * @param array|bool $oldData\n     * @param \\Magento\\Framework\\DataObject $data\n     * @return void\n     *\/",380],["T_WHITESPACE","\n    ",386],["T_PROTECTED","protected",387],["T_WHITESPACE"," ",387],["T_FUNCTION","function",387],["T_WHITESPACE"," ",387],["T_STRING","writeReviewSummary",387],"(",["T_VARIABLE","$oldData",387],",",["T_WHITESPACE"," ",387],["T_NS_SEPARATOR","\\",387],["T_STRING","Magento",387],["T_NS_SEPARATOR","\\",387],["T_STRING","Framework",387],["T_NS_SEPARATOR","\\",387],["T_STRING","DataObject",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$data",387],")",["T_WHITESPACE","\n    ",387],"{",["T_WHITESPACE","\n        ",388],["T_VARIABLE","$connection",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getConnection",389],"(",")",";",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$connection",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","beginTransaction",390],"(",")",";",["T_WHITESPACE","\n        ",390],["T_TRY","try",391],["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n            ",391],["T_IF","if",392],["T_WHITESPACE"," ",392],"(",["T_ISSET","isset",392],"(",["T_VARIABLE","$oldData",392],"[",["T_CONSTANT_ENCAPSED_STRING","'primary_id'",392],"]",")",["T_WHITESPACE"," ",392],["T_BOOLEAN_AND","&&",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$oldData",392],"[",["T_CONSTANT_ENCAPSED_STRING","'primary_id'",392],"]",["T_WHITESPACE"," ",392],">",["T_WHITESPACE"," ",392],["T_LNUMBER","0",392],")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n                ",392],["T_VARIABLE","$condition",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],"[","\"",["T_CURLY_OPEN","{",393],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","_aggregateTable",393],"}",["T_ENCAPSED_AND_WHITESPACE",".primary_id = ?",393],"\"",["T_WHITESPACE"," ",393],["T_DOUBLE_ARROW","=>",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$oldData",393],"[",["T_CONSTANT_ENCAPSED_STRING","'primary_id'",393],"]","]",";",["T_WHITESPACE","\n                ",393],["T_VARIABLE","$connection",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","update",394],"(",["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","_aggregateTable",394],",",["T_WHITESPACE"," ",394],["T_VARIABLE","$data",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getData",394],"(",")",",",["T_WHITESPACE"," ",394],["T_VARIABLE","$condition",394],")",";",["T_WHITESPACE","\n            ",394],"}",["T_WHITESPACE"," ",395],["T_ELSE","else",395],["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n                ",395],["T_VARIABLE","$connection",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","insert",396],"(",["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","_aggregateTable",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$data",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getData",396],"(",")",")",";",["T_WHITESPACE","\n            ",396],"}",["T_WHITESPACE","\n            ",397],["T_VARIABLE","$connection",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","commit",398],"(",")",";",["T_WHITESPACE","\n        ",398],"}",["T_WHITESPACE"," ",399],["T_CATCH","catch",399],["T_WHITESPACE"," ",399],"(",["T_NS_SEPARATOR","\\",399],["T_STRING","Exception",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$e",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$connection",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","rollBack",400],"(",")",";",["T_WHITESPACE","\n        ",400],"}",["T_WHITESPACE","\n    ",401],"}",["T_WHITESPACE","\n\n    ",402],["T_DOC_COMMENT","\/**\n     * Get rating IDs from review votes\n     *\n     * @param int $reviewId\n     * @return array\n     *\/",404],["T_WHITESPACE","\n    ",409],["T_PROTECTED","protected",410],["T_WHITESPACE"," ",410],["T_FUNCTION","function",410],["T_WHITESPACE"," ",410],["T_STRING","_loadVotedRatingIds",410],"(",["T_VARIABLE","$reviewId",410],")",["T_WHITESPACE","\n    ",410],"{",["T_WHITESPACE","\n        ",411],["T_VARIABLE","$connection",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getConnection",412],"(",")",";",["T_WHITESPACE","\n        ",412],["T_IF","if",413],["T_WHITESPACE"," ",413],"(",["T_EMPTY","empty",413],"(",["T_VARIABLE","$reviewId",413],")",")",["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n            ",413],["T_RETURN","return",414],["T_WHITESPACE"," ",414],"[","]",";",["T_WHITESPACE","\n        ",414],"}",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$select",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$connection",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","select",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","from",416],"(","[",["T_CONSTANT_ENCAPSED_STRING","'v'",416],["T_WHITESPACE"," ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getTable",416],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote'",416],")","]",",",["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'r.rating_id'",416],")",["T_WHITESPACE","\n            ",416],["T_OBJECT_OPERATOR","->",417],["T_STRING","joinInner",417],"(","[",["T_CONSTANT_ENCAPSED_STRING","'r'",417],["T_WHITESPACE"," ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getTable",417],"(",["T_CONSTANT_ENCAPSED_STRING","'rating'",417],")","]",",",["T_WHITESPACE"," ",417],["T_CONSTANT_ENCAPSED_STRING","'v.rating_id=r.rating_id'",417],")",["T_WHITESPACE","\n            ",417],["T_OBJECT_OPERATOR","->",418],["T_STRING","where",418],"(",["T_CONSTANT_ENCAPSED_STRING","'v.review_id = :revire_id'",418],")",";",["T_WHITESPACE","\n        ",418],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$connection",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","fetchCol",419],"(",["T_VARIABLE","$select",419],",",["T_WHITESPACE"," ",419],"[",["T_CONSTANT_ENCAPSED_STRING","':revire_id'",419],["T_WHITESPACE"," ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$reviewId",419],"]",")",";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Aggregate this review's ratings.\n     * Useful, when changing the review.\n     *\n     * @param int[] $ratingIds\n     * @param int $entityPkValue\n     * @return $this\n     *\/",422],["T_WHITESPACE","\n    ",429],["T_PROTECTED","protected",430],["T_WHITESPACE"," ",430],["T_FUNCTION","function",430],["T_WHITESPACE"," ",430],["T_STRING","_aggregateRatings",430],"(",["T_VARIABLE","$ratingIds",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$entityPkValue",430],")",["T_WHITESPACE","\n    ",430],"{",["T_WHITESPACE","\n        ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_VARIABLE","$ratingIds",432],["T_WHITESPACE"," ",432],["T_BOOLEAN_AND","&&",432],["T_WHITESPACE"," ",432],"!",["T_STRING","is_array",432],"(",["T_VARIABLE","$ratingIds",432],")",")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n            ",432],["T_VARIABLE","$ratingIds",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],"[",["T_INT_CAST","(int)",433],["T_VARIABLE","$ratingIds",433],"]",";",["T_WHITESPACE","\n        ",433],"}",["T_WHITESPACE","\n        ",434],["T_IF","if",435],["T_WHITESPACE"," ",435],"(",["T_VARIABLE","$ratingIds",435],["T_WHITESPACE"," ",435],["T_BOOLEAN_AND","&&",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$entityPkValue",435],")",["T_WHITESPACE"," ",435],"{",["T_WHITESPACE","\n            ",435],["T_FOREACH","foreach",436],["T_WHITESPACE"," ",436],"(",["T_VARIABLE","$ratingIds",436],["T_WHITESPACE"," ",436],["T_AS","as",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$ratingId",436],")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n                ",436],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","_ratingOptions",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","aggregateEntityByRatingId",437],"(",["T_VARIABLE","$ratingId",437],",",["T_WHITESPACE"," ",437],["T_VARIABLE","$entityPkValue",437],")",";",["T_WHITESPACE","\n            ",437],"}",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n        ",439],["T_RETURN","return",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$this",440],";",["T_WHITESPACE","\n    ",440],"}",["T_WHITESPACE","\n\n    ",441],["T_DOC_COMMENT","\/**\n     * Reaggregate this review's ratings.\n     *\n     * @param int $reviewId\n     * @param int $entityPkValue\n     * @return void\n     *\/",443],["T_WHITESPACE","\n    ",449],["T_PUBLIC","public",450],["T_WHITESPACE"," ",450],["T_FUNCTION","function",450],["T_WHITESPACE"," ",450],["T_STRING","reAggregateReview",450],"(",["T_VARIABLE","$reviewId",450],",",["T_WHITESPACE"," ",450],["T_VARIABLE","$entityPkValue",450],")",["T_WHITESPACE","\n    ",450],"{",["T_WHITESPACE","\n        ",451],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","_aggregateRatings",452],"(",["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","_loadVotedRatingIds",452],"(",["T_VARIABLE","$reviewId",452],")",",",["T_WHITESPACE"," ",452],["T_VARIABLE","$entityPkValue",452],")",";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Get review entity type id by code\n     *\n     * @param string $entityCode\n     * @return int|bool\n     *\/",455],["T_WHITESPACE","\n    ",460],["T_PUBLIC","public",461],["T_WHITESPACE"," ",461],["T_FUNCTION","function",461],["T_WHITESPACE"," ",461],["T_STRING","getEntityIdByCode",461],"(",["T_VARIABLE","$entityCode",461],")",["T_WHITESPACE","\n    ",461],"{",["T_WHITESPACE","\n        ",462],["T_VARIABLE","$connection",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getConnection",463],"(",")",";",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$select",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$connection",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","select",464],"(",")",["T_OBJECT_OPERATOR","->",464],["T_STRING","from",464],"(",["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_reviewEntityTable",464],",",["T_WHITESPACE"," ",464],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",464],"]",")",["T_WHITESPACE","\n            ",464],["T_OBJECT_OPERATOR","->",465],["T_STRING","where",465],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_code = :entity_code'",465],")",";",["T_WHITESPACE","\n        ",465],["T_RETURN","return",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$connection",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","fetchOne",466],"(",["T_VARIABLE","$select",466],",",["T_WHITESPACE"," ",466],"[",["T_CONSTANT_ENCAPSED_STRING","':entity_code'",466],["T_WHITESPACE"," ",466],["T_DOUBLE_ARROW","=>",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$entityCode",466],"]",")",";",["T_WHITESPACE","\n    ",466],"}",["T_WHITESPACE","\n\n    ",467],["T_DOC_COMMENT","\/**\n     * Delete reviews by product id.\n     * Better to call this method in transaction, because operation performed on two separated tables\n     *\n     * @param int $productId\n     * @return $this\n     *\/",469],["T_WHITESPACE","\n    ",475],["T_PUBLIC","public",476],["T_WHITESPACE"," ",476],["T_FUNCTION","function",476],["T_WHITESPACE"," ",476],["T_STRING","deleteReviewsByProductId",476],"(",["T_VARIABLE","$productId",476],")",["T_WHITESPACE","\n    ",476],"{",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getConnection",478],"(",")",["T_OBJECT_OPERATOR","->",478],["T_STRING","delete",478],"(",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_reviewTable",479],",",["T_WHITESPACE","\n            ",479],"[",["T_WHITESPACE","\n                ",480],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value=?'",481],["T_WHITESPACE"," ",481],["T_DOUBLE_ARROW","=>",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$productId",481],",",["T_WHITESPACE","\n                ",481],["T_CONSTANT_ENCAPSED_STRING","'entity_id=?'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getEntityIdByCode",482],"(",["T_NS_SEPARATOR","\\",482],["T_STRING","Magento",482],["T_NS_SEPARATOR","\\",482],["T_STRING","Review",482],["T_NS_SEPARATOR","\\",482],["T_STRING","Model",482],["T_NS_SEPARATOR","\\",482],["T_STRING","Review",482],["T_DOUBLE_COLON","::",482],["T_STRING","ENTITY_PRODUCT_CODE",482],")",["T_WHITESPACE","\n            ",482],"]",["T_WHITESPACE","\n        ",483],")",";",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getConnection",485],"(",")",["T_OBJECT_OPERATOR","->",485],["T_STRING","delete",485],"(",["T_WHITESPACE","\n            ",485],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getTable",486],"(",["T_CONSTANT_ENCAPSED_STRING","'review_entity_summary'",486],")",",",["T_WHITESPACE","\n            ",486],"[",["T_WHITESPACE","\n                ",487],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value=?'",488],["T_WHITESPACE"," ",488],["T_DOUBLE_ARROW","=>",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$productId",488],",",["T_WHITESPACE","\n                ",488],["T_CONSTANT_ENCAPSED_STRING","'entity_type=?'",489],["T_WHITESPACE"," ",489],["T_DOUBLE_ARROW","=>",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getEntityIdByCode",489],"(",["T_NS_SEPARATOR","\\",489],["T_STRING","Magento",489],["T_NS_SEPARATOR","\\",489],["T_STRING","Review",489],["T_NS_SEPARATOR","\\",489],["T_STRING","Model",489],["T_NS_SEPARATOR","\\",489],["T_STRING","Review",489],["T_DOUBLE_COLON","::",489],["T_STRING","ENTITY_PRODUCT_CODE",489],")",["T_WHITESPACE","\n            ",489],"]",["T_WHITESPACE","\n        ",490],")",";",["T_WHITESPACE","\n        ",491],["T_RETURN","return",492],["T_WHITESPACE"," ",492],["T_VARIABLE","$this",492],";",["T_WHITESPACE","\n    ",492],"}",["T_WHITESPACE","\n",493],"}",["T_WHITESPACE","\n",494]]