[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CatalogRule",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Indexer",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Catalog",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ProductInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Catalog",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Product",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CatalogRule",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ResourceModel",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Rule",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CollectionFactory",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","RuleCollectionFactory",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","CatalogRule",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Rule",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","App",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceConnection",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EntityManager",14],["T_NS_SEPARATOR","\\",14],["T_STRING","MetadataPool",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Pricing",15],["T_NS_SEPARATOR","\\",15],["T_STRING","PriceCurrencyInterface",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",17],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","IndexBuilder",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_CONST","const",22],["T_WHITESPACE"," ",22],["T_STRING","SECONDS_IN_DAY",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_LNUMBER","86400",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\EntityManager\\MetadataPool\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$metadataPool",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * CatalogRuleGroupWebsite columns list\n     *\n     * This array contain list of CatalogRuleGroupWebsite table columns\n     *\n     * @var array\n     *\/",29],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_catalogRuleGroupWebsiteColumnsList",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'website_id'",36],"]",";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\ResourceConnection\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$resource",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$storeManager",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @var RuleCollectionFactory\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$ruleCollectionFactory",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * @var \\Psr\\Log\\LoggerInterface\n     *\/",53],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$logger",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * @var PriceCurrencyInterface\n     *\/",58],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$priceCurrency",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Eav\\Model\\Config\n     *\/",63],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$eavConfig",66],";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\n     *\/",68],["T_WHITESPACE","\n    ",70],["T_PROTECTED","protected",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$dateFormat",71],";",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\DateTime\n     *\/",73],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$dateTime",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\ProductFactory\n     *\/",78],["T_WHITESPACE","\n    ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$productFactory",81],";",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * @var Product[]\n     *\/",83],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$loadedProducts",86],";",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * @var int\n     *\/",88],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$batchCount",91],";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",93],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$connection",96],";",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * @param RuleCollectionFactory $ruleCollectionFactory\n     * @param PriceCurrencyInterface $priceCurrency\n     * @param \\Magento\\Framework\\App\\ResourceConnection $resource\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Psr\\Log\\LoggerInterface $logger\n     * @param \\Magento\\Eav\\Model\\Config $eavConfig\n     * @param \\Magento\\Framework\\Stdlib\\DateTime $dateFormat\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $dateTime\n     * @param \\Magento\\Catalog\\Model\\ProductFactory $productFactory\n     * @param int $batchCount\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",98],["T_WHITESPACE","\n    ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","__construct",111],"(",["T_WHITESPACE","\n        ",111],["T_STRING","RuleCollectionFactory",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$ruleCollectionFactory",112],",",["T_WHITESPACE","\n        ",112],["T_STRING","PriceCurrencyInterface",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$priceCurrency",113],",",["T_WHITESPACE","\n        ",113],["T_NS_SEPARATOR","\\",114],["T_STRING","Magento",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Framework",114],["T_NS_SEPARATOR","\\",114],["T_STRING","App",114],["T_NS_SEPARATOR","\\",114],["T_STRING","ResourceConnection",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$resource",114],",",["T_WHITESPACE","\n        ",114],["T_NS_SEPARATOR","\\",115],["T_STRING","Magento",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Store",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Model",115],["T_NS_SEPARATOR","\\",115],["T_STRING","StoreManagerInterface",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$storeManager",115],",",["T_WHITESPACE","\n        ",115],["T_NS_SEPARATOR","\\",116],["T_STRING","Psr",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Log",116],["T_NS_SEPARATOR","\\",116],["T_STRING","LoggerInterface",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$logger",116],",",["T_WHITESPACE","\n        ",116],["T_NS_SEPARATOR","\\",117],["T_STRING","Magento",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Eav",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Model",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Config",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$eavConfig",117],",",["T_WHITESPACE","\n        ",117],["T_NS_SEPARATOR","\\",118],["T_STRING","Magento",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Framework",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Stdlib",118],["T_NS_SEPARATOR","\\",118],["T_STRING","DateTime",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$dateFormat",118],",",["T_WHITESPACE","\n        ",118],["T_NS_SEPARATOR","\\",119],["T_STRING","Magento",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Framework",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Stdlib",119],["T_NS_SEPARATOR","\\",119],["T_STRING","DateTime",119],["T_NS_SEPARATOR","\\",119],["T_STRING","DateTime",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$dateTime",119],",",["T_WHITESPACE","\n        ",119],["T_NS_SEPARATOR","\\",120],["T_STRING","Magento",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Catalog",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Model",120],["T_NS_SEPARATOR","\\",120],["T_STRING","ProductFactory",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$productFactory",120],",",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$batchCount",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_LNUMBER","1000",121],["T_WHITESPACE","\n    ",121],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","resource",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$resource",123],";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","connection",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$resource",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getConnection",124],"(",")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","storeManager",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$storeManager",125],";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","ruleCollectionFactory",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$ruleCollectionFactory",126],";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","logger",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$logger",127],";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","priceCurrency",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$priceCurrency",128],";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","eavConfig",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$eavConfig",129],";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","dateFormat",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$dateFormat",130],";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","dateTime",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$dateTime",131],";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","productFactory",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$productFactory",132],";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","batchCount",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$batchCount",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Reindex by id\n     *\n     * @param int $id\n     * @return void\n     * @api\n     *\/",136],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","reindexById",143],"(",["T_VARIABLE","$id",143],")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","reindexByIds",145],"(","[",["T_VARIABLE","$id",145],"]",")",";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Reindex by ids\n     *\n     * @param array $ids\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @return void\n     * @api\n     *\/",148],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","reindexByIds",156],"(",["T_ARRAY","array",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$ids",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_TRY","try",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","doReindexByIds",159],"(",["T_VARIABLE","$ids",159],")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE"," ",160],["T_CATCH","catch",160],["T_WHITESPACE"," ",160],"(",["T_NS_SEPARATOR","\\",160],["T_STRING","Exception",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$e",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","critical",161],"(",["T_VARIABLE","$e",161],")",";",["T_WHITESPACE","\n            ",161],["T_THROW","throw",162],["T_WHITESPACE"," ",162],["T_NEW","new",162],["T_WHITESPACE"," ",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Magento",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Framework",162],["T_NS_SEPARATOR","\\",162],["T_STRING","Exception",162],["T_NS_SEPARATOR","\\",162],["T_STRING","LocalizedException",162],"(",["T_WHITESPACE","\n                ",162],["T_STRING","__",163],"(",["T_CONSTANT_ENCAPSED_STRING","\"Catalog rule indexing failed. See details in exception log.\"",163],")",["T_WHITESPACE","\n            ",163],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n    ",165],"}",["T_WHITESPACE","\n\n    ",166],["T_DOC_COMMENT","\/**\n     * Reindex by ids. Template method\n     *\n     * @param array $ids\n     * @return void\n     *\/",168],["T_WHITESPACE","\n    ",173],["T_PROTECTED","protected",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","doReindexByIds",174],"(",["T_VARIABLE","$ids",174],")",["T_WHITESPACE","\n    ",174],"{",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","cleanByIds",176],"(",["T_VARIABLE","$ids",176],")",";",["T_WHITESPACE","\n\n        ",176],["T_FOREACH","foreach",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getActiveRules",178],"(",")",["T_WHITESPACE"," ",178],["T_AS","as",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$rule",178],")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n            ",178],["T_FOREACH","foreach",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$ids",179],["T_WHITESPACE"," ",179],["T_AS","as",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$productId",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","applyRule",180],"(",["T_VARIABLE","$rule",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getProduct",180],"(",["T_VARIABLE","$productId",180],")",")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Full reindex\n     *\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @return void\n     * @api\n     *\/",185],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","reindexFull",192],"(",")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_TRY","try",194],["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","doReindexFull",195],"(",")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE"," ",196],["T_CATCH","catch",196],["T_WHITESPACE"," ",196],"(",["T_NS_SEPARATOR","\\",196],["T_STRING","Exception",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$e",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","critical",197],"(",["T_VARIABLE","$e",197],")",";",["T_WHITESPACE","\n            ",197],["T_THROW","throw",198],["T_WHITESPACE"," ",198],["T_NEW","new",198],["T_WHITESPACE"," ",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Magento",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Framework",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Exception",198],["T_NS_SEPARATOR","\\",198],["T_STRING","LocalizedException",198],"(",["T_WHITESPACE","\n                ",198],["T_STRING","__",199],"(",["T_CONSTANT_ENCAPSED_STRING","\"Catalog rule indexing failed. See details in exception log.\"",199],")",["T_WHITESPACE","\n            ",199],")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE","\n    ",201],"}",["T_WHITESPACE","\n\n    ",202],["T_DOC_COMMENT","\/**\n     * Full reindex Template method\n     *\n     * @return void\n     *\/",204],["T_WHITESPACE","\n    ",208],["T_PROTECTED","protected",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","doReindexFull",209],"(",")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_FOREACH","foreach",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getAllRules",211],"(",")",["T_WHITESPACE"," ",211],["T_AS","as",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$rule",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","updateRuleProductData",212],"(",["T_VARIABLE","$rule",212],")",";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","deleteOldData",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","applyAllRules",214],"(",")",";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * Clean by product ids\n     *\n     * @param array $productIds\n     * @return void\n     *\/",217],["T_WHITESPACE","\n    ",222],["T_PROTECTED","protected",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","cleanByIds",223],"(",["T_VARIABLE","$productIds",223],")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$query",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","connection",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","deleteFromSelect",225],"(",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","connection",226],["T_WHITESPACE","\n                ",226],["T_OBJECT_OPERATOR","->",227],["T_STRING","select",227],"(",")",["T_WHITESPACE","\n                ",227],["T_OBJECT_OPERATOR","->",228],["T_STRING","from",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","resource",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getTableName",228],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",228],")",",",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'product_id'",228],")",["T_WHITESPACE","\n                ",228],["T_OBJECT_OPERATOR","->",229],["T_STRING","distinct",229],"(",")",["T_WHITESPACE","\n                ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","where",230],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$productIds",230],")",",",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","resource",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getTableName",231],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",231],")",["T_WHITESPACE","\n        ",231],")",";",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","connection",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","query",233],"(",["T_VARIABLE","$query",233],")",";",["T_WHITESPACE","\n\n        ",233],["T_VARIABLE","$query",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","connection",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","deleteFromSelect",235],"(",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","connection",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","select",236],"(",")",["T_WHITESPACE","\n                ",236],["T_OBJECT_OPERATOR","->",237],["T_STRING","from",237],"(",["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","resource",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getTableName",237],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",237],")",",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'product_id'",237],")",["T_WHITESPACE","\n                ",237],["T_OBJECT_OPERATOR","->",238],["T_STRING","distinct",238],"(",")",["T_WHITESPACE","\n                ",238],["T_OBJECT_OPERATOR","->",239],["T_STRING","where",239],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$productIds",239],")",",",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","resource",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getTableName",240],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",240],")",["T_WHITESPACE","\n        ",240],")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","connection",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","query",242],"(",["T_VARIABLE","$query",242],")",";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * @param Rule $rule\n     * @param Product $product\n     * @return $this\n     * @throws \\Exception\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",245],["T_WHITESPACE","\n    ",251],["T_PROTECTED","protected",252],["T_WHITESPACE"," ",252],["T_FUNCTION","function",252],["T_WHITESPACE"," ",252],["T_STRING","applyRule",252],"(",["T_STRING","Rule",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$rule",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$product",252],")",["T_WHITESPACE","\n    ",252],"{",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$ruleId",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$rule",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getId",254],"(",")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$productEntityId",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$product",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getId",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$websiteIds",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_STRING","array_intersect",256],"(",["T_VARIABLE","$product",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getWebsiteIds",256],"(",")",",",["T_WHITESPACE"," ",256],["T_VARIABLE","$rule",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getWebsiteIds",256],"(",")",")",";",["T_WHITESPACE","\n\n        ",256],["T_IF","if",258],["T_WHITESPACE"," ",258],"(","!",["T_VARIABLE","$rule",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","validate",258],"(",["T_VARIABLE","$product",258],")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],";",["T_WHITESPACE","\n        ",259],"}",["T_WHITESPACE","\n\n        ",260],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","connection",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","delete",262],"(",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","resource",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getTableName",263],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",263],")",",",["T_WHITESPACE","\n            ",263],"[",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","connection",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","quoteInto",265],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id = ?'",265],",",["T_WHITESPACE"," ",265],["T_VARIABLE","$ruleId",265],")",",",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","connection",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","quoteInto",266],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$productEntityId",266],")",["T_WHITESPACE","\n            ",266],"]",["T_WHITESPACE","\n        ",267],")",";",["T_WHITESPACE","\n\n        ",268],["T_VARIABLE","$customerGroupIds",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$rule",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getCustomerGroupIds",270],"(",")",";",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$fromTime",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_STRING","strtotime",271],"(",["T_VARIABLE","$rule",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getFromDate",271],"(",")",")",";",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$toTime",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","strtotime",272],"(",["T_VARIABLE","$rule",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getToDate",272],"(",")",")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$toTime",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$toTime",273],["T_WHITESPACE"," ",273],"?",["T_WHITESPACE"," ",273],["T_VARIABLE","$toTime",273],["T_WHITESPACE"," ",273],"+",["T_WHITESPACE"," ",273],["T_STRING","self",273],["T_DOUBLE_COLON","::",273],["T_STRING","SECONDS_IN_DAY",273],["T_WHITESPACE"," ",273],"-",["T_WHITESPACE"," ",273],["T_LNUMBER","1",273],["T_WHITESPACE"," ",273],":",["T_WHITESPACE"," ",273],["T_LNUMBER","0",273],";",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$sortOrder",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_INT_CAST","(int)",274],["T_VARIABLE","$rule",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getSortOrder",274],"(",")",";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$actionOperator",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$rule",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getSimpleAction",275],"(",")",";",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$actionAmount",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$rule",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getDiscountAmount",276],"(",")",";",["T_WHITESPACE","\n        ",276],["T_VARIABLE","$actionStop",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_VARIABLE","$rule",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getStopRulesProcessing",277],"(",")",";",["T_WHITESPACE","\n\n        ",277],["T_VARIABLE","$rows",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],"[","]",";",["T_WHITESPACE","\n        ",279],["T_TRY","try",280],["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_FOREACH","foreach",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$websiteIds",281],["T_WHITESPACE"," ",281],["T_AS","as",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$websiteId",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                ",281],["T_FOREACH","foreach",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$customerGroupIds",282],["T_WHITESPACE"," ",282],["T_AS","as",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$customerGroupId",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n                    ",282],["T_VARIABLE","$rows",283],"[","]",["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],"[",["T_WHITESPACE","\n                        ",283],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$ruleId",284],",",["T_WHITESPACE","\n                        ",284],["T_CONSTANT_ENCAPSED_STRING","'from_time'",285],["T_WHITESPACE"," ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$fromTime",285],",",["T_WHITESPACE","\n                        ",285],["T_CONSTANT_ENCAPSED_STRING","'to_time'",286],["T_WHITESPACE"," ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$toTime",286],",",["T_WHITESPACE","\n                        ",286],["T_CONSTANT_ENCAPSED_STRING","'website_id'",287],["T_WHITESPACE"," ",287],["T_DOUBLE_ARROW","=>",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$websiteId",287],",",["T_WHITESPACE","\n                        ",287],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",288],["T_WHITESPACE"," ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$customerGroupId",288],",",["T_WHITESPACE","\n                        ",288],["T_CONSTANT_ENCAPSED_STRING","'product_id'",289],["T_WHITESPACE"," ",289],["T_DOUBLE_ARROW","=>",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$productEntityId",289],",",["T_WHITESPACE","\n                        ",289],["T_CONSTANT_ENCAPSED_STRING","'action_operator'",290],["T_WHITESPACE"," ",290],["T_DOUBLE_ARROW","=>",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$actionOperator",290],",",["T_WHITESPACE","\n                        ",290],["T_CONSTANT_ENCAPSED_STRING","'action_amount'",291],["T_WHITESPACE"," ",291],["T_DOUBLE_ARROW","=>",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$actionAmount",291],",",["T_WHITESPACE","\n                        ",291],["T_CONSTANT_ENCAPSED_STRING","'action_stop'",292],["T_WHITESPACE"," ",292],["T_DOUBLE_ARROW","=>",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$actionStop",292],",",["T_WHITESPACE","\n                        ",292],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$sortOrder",293],",",["T_WHITESPACE","\n                    ",293],"]",";",["T_WHITESPACE","\n\n                    ",294],["T_IF","if",296],["T_WHITESPACE"," ",296],"(",["T_STRING","count",296],"(",["T_VARIABLE","$rows",296],")",["T_WHITESPACE"," ",296],["T_IS_EQUAL","==",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","batchCount",296],")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n                        ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","connection",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","insertMultiple",297],"(",["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getTable",297],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",297],")",",",["T_WHITESPACE"," ",297],["T_VARIABLE","$rows",297],")",";",["T_WHITESPACE","\n                        ",297],["T_VARIABLE","$rows",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],"[","]",";",["T_WHITESPACE","\n                    ",298],"}",["T_WHITESPACE","\n                ",299],"}",["T_WHITESPACE","\n            ",300],"}",["T_WHITESPACE","\n\n            ",301],["T_IF","if",303],["T_WHITESPACE"," ",303],"(","!",["T_EMPTY","empty",303],"(",["T_VARIABLE","$rows",303],")",")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","connection",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","insertMultiple",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","resource",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getTableName",304],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",304],")",",",["T_WHITESPACE"," ",304],["T_VARIABLE","$rows",304],")",";",["T_WHITESPACE","\n            ",304],"}",["T_WHITESPACE","\n        ",305],"}",["T_WHITESPACE"," ",306],["T_CATCH","catch",306],["T_WHITESPACE"," ",306],"(",["T_NS_SEPARATOR","\\",306],["T_STRING","Exception",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$e",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_THROW","throw",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$e",307],";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE","\n\n        ",308],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","applyAllRules",310],"(",["T_VARIABLE","$product",310],")",";",["T_WHITESPACE","\n\n        ",310],["T_RETURN","return",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$this",312],";",["T_WHITESPACE","\n    ",312],"}",["T_WHITESPACE","\n\n    ",313],["T_DOC_COMMENT","\/**\n     * @param string $tableName\n     * @return string\n     *\/",315],["T_WHITESPACE","\n    ",318],["T_PROTECTED","protected",319],["T_WHITESPACE"," ",319],["T_FUNCTION","function",319],["T_WHITESPACE"," ",319],["T_STRING","getTable",319],"(",["T_VARIABLE","$tableName",319],")",["T_WHITESPACE","\n    ",319],"{",["T_WHITESPACE","\n        ",320],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","resource",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getTableName",321],"(",["T_VARIABLE","$tableName",321],")",";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * @param Rule $rule\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",324],["T_WHITESPACE","\n    ",329],["T_PROTECTED","protected",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","updateRuleProductData",330],"(",["T_STRING","Rule",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$rule",330],")",["T_WHITESPACE","\n    ",330],"{",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$ruleId",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$rule",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getId",332],"(",")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$rule",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getProductsFilter",333],"(",")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","connection",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","delete",334],"(",["T_WHITESPACE","\n                ",334],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getTable",335],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",335],")",",",["T_WHITESPACE","\n                ",335],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id=?'",336],["T_WHITESPACE"," ",336],["T_DOUBLE_ARROW","=>",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$ruleId",336],",",["T_WHITESPACE"," ",336],["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",336],["T_WHITESPACE"," ",336],["T_DOUBLE_ARROW","=>",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$rule",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getProductsFilter",336],"(",")","]",["T_WHITESPACE","\n            ",336],")",";",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE"," ",338],["T_ELSE","else",338],["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","connection",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","delete",339],"(",["T_WHITESPACE","\n                ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getTable",340],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",340],")",",",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","connection",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","quoteInto",341],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id=?'",341],",",["T_WHITESPACE"," ",341],["T_VARIABLE","$ruleId",341],")",["T_WHITESPACE","\n            ",341],")",";",["T_WHITESPACE","\n        ",342],"}",["T_WHITESPACE","\n\n        ",343],["T_IF","if",345],["T_WHITESPACE"," ",345],"(","!",["T_VARIABLE","$rule",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getIsActive",345],"(",")",")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n            ",345],["T_RETURN","return",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],";",["T_WHITESPACE","\n        ",346],"}",["T_WHITESPACE","\n\n        ",347],["T_VARIABLE","$websiteIds",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$rule",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getWebsiteIds",349],"(",")",";",["T_WHITESPACE","\n        ",349],["T_IF","if",350],["T_WHITESPACE"," ",350],"(","!",["T_STRING","is_array",350],"(",["T_VARIABLE","$websiteIds",350],")",")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$websiteIds",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","explode",351],"(",["T_CONSTANT_ENCAPSED_STRING","','",351],",",["T_WHITESPACE"," ",351],["T_VARIABLE","$websiteIds",351],")",";",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n        ",352],["T_IF","if",353],["T_WHITESPACE"," ",353],"(",["T_EMPTY","empty",353],"(",["T_VARIABLE","$websiteIds",353],")",")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n            ",353],["T_RETURN","return",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],";",["T_WHITESPACE","\n        ",354],"}",["T_WHITESPACE","\n\n        ",355],["T_NS_SEPARATOR","\\",357],["T_STRING","Magento",357],["T_NS_SEPARATOR","\\",357],["T_STRING","Framework",357],["T_NS_SEPARATOR","\\",357],["T_STRING","Profiler",357],["T_DOUBLE_COLON","::",357],["T_STRING","start",357],"(",["T_CONSTANT_ENCAPSED_STRING","'__MATCH_PRODUCTS__'",357],")",";",["T_WHITESPACE","\n        ",357],["T_VARIABLE","$productIds",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_VARIABLE","$rule",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getMatchingProductIds",358],"(",")",";",["T_WHITESPACE","\n        ",358],["T_NS_SEPARATOR","\\",359],["T_STRING","Magento",359],["T_NS_SEPARATOR","\\",359],["T_STRING","Framework",359],["T_NS_SEPARATOR","\\",359],["T_STRING","Profiler",359],["T_DOUBLE_COLON","::",359],["T_STRING","stop",359],"(",["T_CONSTANT_ENCAPSED_STRING","'__MATCH_PRODUCTS__'",359],")",";",["T_WHITESPACE","\n\n        ",359],["T_VARIABLE","$customerGroupIds",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_VARIABLE","$rule",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getCustomerGroupIds",361],"(",")",";",["T_WHITESPACE","\n        ",361],["T_VARIABLE","$fromTime",362],["T_WHITESPACE"," ",362],"=",["T_WHITESPACE"," ",362],["T_STRING","strtotime",362],"(",["T_VARIABLE","$rule",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","getFromDate",362],"(",")",")",";",["T_WHITESPACE","\n        ",362],["T_VARIABLE","$toTime",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_STRING","strtotime",363],"(",["T_VARIABLE","$rule",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getToDate",363],"(",")",")",";",["T_WHITESPACE","\n        ",363],["T_VARIABLE","$toTime",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_VARIABLE","$toTime",364],["T_WHITESPACE"," ",364],"?",["T_WHITESPACE"," ",364],["T_VARIABLE","$toTime",364],["T_WHITESPACE"," ",364],"+",["T_WHITESPACE"," ",364],["T_STRING","self",364],["T_DOUBLE_COLON","::",364],["T_STRING","SECONDS_IN_DAY",364],["T_WHITESPACE"," ",364],"-",["T_WHITESPACE"," ",364],["T_LNUMBER","1",364],["T_WHITESPACE"," ",364],":",["T_WHITESPACE"," ",364],["T_LNUMBER","0",364],";",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$sortOrder",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_INT_CAST","(int)",365],["T_VARIABLE","$rule",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getSortOrder",365],"(",")",";",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$actionOperator",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$rule",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getSimpleAction",366],"(",")",";",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$actionAmount",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$rule",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getDiscountAmount",367],"(",")",";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$actionStop",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$rule",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getStopRulesProcessing",368],"(",")",";",["T_WHITESPACE","\n\n        ",368],["T_VARIABLE","$rows",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],"[","]",";",["T_WHITESPACE","\n\n        ",370],["T_FOREACH","foreach",372],["T_WHITESPACE"," ",372],"(",["T_VARIABLE","$productIds",372],["T_WHITESPACE"," ",372],["T_AS","as",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$productId",372],["T_WHITESPACE"," ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$validationByWebsite",372],")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_FOREACH","foreach",373],["T_WHITESPACE"," ",373],"(",["T_VARIABLE","$websiteIds",373],["T_WHITESPACE"," ",373],["T_AS","as",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$websiteId",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(",["T_EMPTY","empty",374],"(",["T_VARIABLE","$validationByWebsite",374],"[",["T_VARIABLE","$websiteId",374],"]",")",")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                    ",374],["T_CONTINUE","continue",375],";",["T_WHITESPACE","\n                ",375],"}",["T_WHITESPACE","\n                ",376],["T_FOREACH","foreach",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$customerGroupIds",377],["T_WHITESPACE"," ",377],["T_AS","as",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$customerGroupId",377],")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n                    ",377],["T_VARIABLE","$rows",378],"[","]",["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],"[",["T_WHITESPACE","\n                        ",378],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",379],["T_WHITESPACE"," ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$ruleId",379],",",["T_WHITESPACE","\n                        ",379],["T_CONSTANT_ENCAPSED_STRING","'from_time'",380],["T_WHITESPACE"," ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$fromTime",380],",",["T_WHITESPACE","\n                        ",380],["T_CONSTANT_ENCAPSED_STRING","'to_time'",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$toTime",381],",",["T_WHITESPACE","\n                        ",381],["T_CONSTANT_ENCAPSED_STRING","'website_id'",382],["T_WHITESPACE"," ",382],["T_DOUBLE_ARROW","=>",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$websiteId",382],",",["T_WHITESPACE","\n                        ",382],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",383],["T_WHITESPACE"," ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$customerGroupId",383],",",["T_WHITESPACE","\n                        ",383],["T_CONSTANT_ENCAPSED_STRING","'product_id'",384],["T_WHITESPACE"," ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$productId",384],",",["T_WHITESPACE","\n                        ",384],["T_CONSTANT_ENCAPSED_STRING","'action_operator'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$actionOperator",385],",",["T_WHITESPACE","\n                        ",385],["T_CONSTANT_ENCAPSED_STRING","'action_amount'",386],["T_WHITESPACE"," ",386],["T_DOUBLE_ARROW","=>",386],["T_WHITESPACE"," ",386],["T_VARIABLE","$actionAmount",386],",",["T_WHITESPACE","\n                        ",386],["T_CONSTANT_ENCAPSED_STRING","'action_stop'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$actionStop",387],",",["T_WHITESPACE","\n                        ",387],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",388],["T_WHITESPACE"," ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$sortOrder",388],",",["T_WHITESPACE","\n                    ",388],"]",";",["T_WHITESPACE","\n\n                    ",389],["T_IF","if",391],["T_WHITESPACE"," ",391],"(",["T_STRING","count",391],"(",["T_VARIABLE","$rows",391],")",["T_WHITESPACE"," ",391],["T_IS_EQUAL","==",391],["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","batchCount",391],")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n                        ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","connection",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","insertMultiple",392],"(",["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getTable",392],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",392],")",",",["T_WHITESPACE"," ",392],["T_VARIABLE","$rows",392],")",";",["T_WHITESPACE","\n                        ",392],["T_VARIABLE","$rows",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],"[","]",";",["T_WHITESPACE","\n                    ",393],"}",["T_WHITESPACE","\n                ",394],"}",["T_WHITESPACE","\n            ",395],"}",["T_WHITESPACE","\n        ",396],"}",["T_WHITESPACE","\n        ",397],["T_IF","if",398],["T_WHITESPACE"," ",398],"(","!",["T_EMPTY","empty",398],"(",["T_VARIABLE","$rows",398],")",")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","connection",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","insertMultiple",399],"(",["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getTable",399],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",399],")",",",["T_WHITESPACE"," ",399],["T_VARIABLE","$rows",399],")",";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n\n        ",400],["T_RETURN","return",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$this",402],";",["T_WHITESPACE","\n    ",402],"}",["T_WHITESPACE","\n\n    ",403],["T_DOC_COMMENT","\/**\n     * @param Product|null $product\n     * @throws \\Exception\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",405],["T_WHITESPACE","\n    ",412],["T_PROTECTED","protected",413],["T_WHITESPACE"," ",413],["T_FUNCTION","function",413],["T_WHITESPACE"," ",413],["T_STRING","applyAllRules",413],"(",["T_STRING","Product",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$product",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_STRING","null",413],")",["T_WHITESPACE","\n    ",413],"{",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$fromDate",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","mktime",415],"(",["T_LNUMBER","0",415],",",["T_WHITESPACE"," ",415],["T_LNUMBER","0",415],",",["T_WHITESPACE"," ",415],["T_LNUMBER","0",415],",",["T_WHITESPACE"," ",415],["T_STRING","date",415],"(",["T_CONSTANT_ENCAPSED_STRING","'m'",415],")",",",["T_WHITESPACE"," ",415],["T_STRING","date",415],"(",["T_CONSTANT_ENCAPSED_STRING","'d'",415],")",["T_WHITESPACE"," ",415],"-",["T_WHITESPACE"," ",415],["T_LNUMBER","1",415],")",";",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$toDate",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_STRING","mktime",416],"(",["T_LNUMBER","0",416],",",["T_WHITESPACE"," ",416],["T_LNUMBER","0",416],",",["T_WHITESPACE"," ",416],["T_LNUMBER","0",416],",",["T_WHITESPACE"," ",416],["T_STRING","date",416],"(",["T_CONSTANT_ENCAPSED_STRING","'m'",416],")",",",["T_WHITESPACE"," ",416],["T_STRING","date",416],"(",["T_CONSTANT_ENCAPSED_STRING","'d'",416],")",["T_WHITESPACE"," ",416],"+",["T_WHITESPACE"," ",416],["T_LNUMBER","1",416],")",";",["T_WHITESPACE","\n\n        ",416],["T_DOC_COMMENT","\/**\n         * Update products rules prices per each website separately\n         * because of max join limit in mysql\n         *\/",418],["T_WHITESPACE","\n        ",421],["T_FOREACH","foreach",422],["T_WHITESPACE"," ",422],"(",["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","storeManager",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getWebsites",422],"(",")",["T_WHITESPACE"," ",422],["T_AS","as",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$website",422],")",["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$productsStmt",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getRuleProductsStmt",423],"(",["T_VARIABLE","$website",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getId",423],"(",")",",",["T_WHITESPACE"," ",423],["T_VARIABLE","$product",423],")",";",["T_WHITESPACE","\n\n            ",423],["T_VARIABLE","$dayPrices",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],"[","]",";",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$stopFlags",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],"[","]",";",["T_WHITESPACE","\n            ",426],["T_VARIABLE","$prevKey",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_STRING","null",427],";",["T_WHITESPACE","\n\n            ",427],["T_WHILE","while",429],["T_WHITESPACE"," ",429],"(",["T_VARIABLE","$ruleData",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$productsStmt",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","fetch",429],"(",")",")",["T_WHITESPACE"," ",429],"{",["T_WHITESPACE","\n                ",429],["T_VARIABLE","$ruleProductId",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$ruleData",430],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",430],"]",";",["T_WHITESPACE","\n                ",430],["T_VARIABLE","$productKey",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$ruleProductId",431],["T_WHITESPACE"," ",431],".",["T_WHITESPACE","\n                    ",431],["T_CONSTANT_ENCAPSED_STRING","'_'",432],["T_WHITESPACE"," ",432],".",["T_WHITESPACE","\n                    ",432],["T_VARIABLE","$ruleData",433],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",433],"]",["T_WHITESPACE"," ",433],".",["T_WHITESPACE","\n                    ",433],["T_CONSTANT_ENCAPSED_STRING","'_'",434],["T_WHITESPACE"," ",434],".",["T_WHITESPACE","\n                    ",434],["T_VARIABLE","$ruleData",435],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",435],"]",";",["T_WHITESPACE","\n\n                ",435],["T_IF","if",437],["T_WHITESPACE"," ",437],"(",["T_VARIABLE","$prevKey",437],["T_WHITESPACE"," ",437],["T_BOOLEAN_AND","&&",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$prevKey",437],["T_WHITESPACE"," ",437],["T_IS_NOT_EQUAL","!=",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$productKey",437],")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n                    ",437],["T_VARIABLE","$stopFlags",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],"[","]",";",["T_WHITESPACE","\n                    ",438],["T_IF","if",439],["T_WHITESPACE"," ",439],"(",["T_STRING","count",439],"(",["T_VARIABLE","$dayPrices",439],")",["T_WHITESPACE"," ",439],">",["T_WHITESPACE"," ",439],["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","batchCount",439],")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n                        ",439],["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","saveRuleProductPrices",440],"(",["T_VARIABLE","$dayPrices",440],")",";",["T_WHITESPACE","\n                        ",440],["T_VARIABLE","$dayPrices",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],"[","]",";",["T_WHITESPACE","\n                    ",441],"}",["T_WHITESPACE","\n                ",442],"}",["T_WHITESPACE","\n\n                ",443],["T_VARIABLE","$ruleData",445],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",445],"]",["T_WHITESPACE"," ",445],"=",["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","roundTime",445],"(",["T_VARIABLE","$ruleData",445],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",445],"]",")",";",["T_WHITESPACE","\n                ",445],["T_VARIABLE","$ruleData",446],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",446],"]",["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","roundTime",446],"(",["T_VARIABLE","$ruleData",446],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",446],"]",")",";",["T_WHITESPACE","\n                ",446],["T_DOC_COMMENT","\/**\n                 * Build prices for each day\n                 *\/",447],["T_WHITESPACE","\n                ",449],["T_FOR","for",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$time",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_VARIABLE","$fromDate",450],";",["T_WHITESPACE"," ",450],["T_VARIABLE","$time",450],["T_WHITESPACE"," ",450],["T_IS_SMALLER_OR_EQUAL","<=",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$toDate",450],";",["T_WHITESPACE"," ",450],["T_VARIABLE","$time",450],["T_WHITESPACE"," ",450],["T_PLUS_EQUAL","+=",450],["T_WHITESPACE"," ",450],["T_STRING","self",450],["T_DOUBLE_COLON","::",450],["T_STRING","SECONDS_IN_DAY",450],")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n                    ",450],["T_IF","if",451],["T_WHITESPACE"," ",451],"(","(",["T_VARIABLE","$ruleData",451],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",451],"]",["T_WHITESPACE"," ",451],["T_IS_EQUAL","==",451],["T_WHITESPACE"," ",451],["T_LNUMBER","0",451],["T_WHITESPACE"," ",451],["T_BOOLEAN_OR","||",451],["T_WHITESPACE","\n                            ",451],["T_VARIABLE","$time",452],["T_WHITESPACE"," ",452],["T_IS_GREATER_OR_EQUAL",">=",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$ruleData",452],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",452],"]",")",["T_WHITESPACE"," ",452],["T_BOOLEAN_AND","&&",452],["T_WHITESPACE"," ",452],"(",["T_VARIABLE","$ruleData",452],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",452],"]",["T_WHITESPACE"," ",452],["T_IS_EQUAL","==",452],["T_WHITESPACE"," ",452],["T_LNUMBER","0",452],["T_WHITESPACE"," ",452],["T_BOOLEAN_OR","||",452],["T_WHITESPACE","\n                            ",452],["T_VARIABLE","$time",453],["T_WHITESPACE"," ",453],["T_IS_SMALLER_OR_EQUAL","<=",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$ruleData",453],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",453],"]",")",["T_WHITESPACE","\n                    ",453],")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n                        ",454],["T_VARIABLE","$priceKey",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$time",455],["T_WHITESPACE"," ",455],".",["T_WHITESPACE"," ",455],["T_CONSTANT_ENCAPSED_STRING","'_'",455],["T_WHITESPACE"," ",455],".",["T_WHITESPACE"," ",455],["T_VARIABLE","$productKey",455],";",["T_WHITESPACE","\n\n                        ",455],["T_IF","if",457],["T_WHITESPACE"," ",457],"(",["T_ISSET","isset",457],"(",["T_VARIABLE","$stopFlags",457],"[",["T_VARIABLE","$priceKey",457],"]",")",")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n                            ",457],["T_CONTINUE","continue",458],";",["T_WHITESPACE","\n                        ",458],"}",["T_WHITESPACE","\n\n                        ",459],["T_IF","if",461],["T_WHITESPACE"," ",461],"(","!",["T_ISSET","isset",461],"(",["T_VARIABLE","$dayPrices",461],"[",["T_VARIABLE","$priceKey",461],"]",")",")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n                            ",461],["T_VARIABLE","$dayPrices",462],"[",["T_VARIABLE","$priceKey",462],"]",["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],"[",["T_WHITESPACE","\n                                ",462],["T_CONSTANT_ENCAPSED_STRING","'rule_date'",463],["T_WHITESPACE"," ",463],["T_DOUBLE_ARROW","=>",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$time",463],",",["T_WHITESPACE","\n                                ",463],["T_CONSTANT_ENCAPSED_STRING","'website_id'",464],["T_WHITESPACE"," ",464],["T_DOUBLE_ARROW","=>",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$ruleData",464],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",464],"]",",",["T_WHITESPACE","\n                                ",464],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",465],["T_WHITESPACE"," ",465],["T_DOUBLE_ARROW","=>",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$ruleData",465],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",465],"]",",",["T_WHITESPACE","\n                                ",465],["T_CONSTANT_ENCAPSED_STRING","'product_id'",466],["T_WHITESPACE"," ",466],["T_DOUBLE_ARROW","=>",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$ruleProductId",466],",",["T_WHITESPACE","\n                                ",466],["T_CONSTANT_ENCAPSED_STRING","'rule_price'",467],["T_WHITESPACE"," ",467],["T_DOUBLE_ARROW","=>",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","calcRuleProductPrice",467],"(",["T_VARIABLE","$ruleData",467],")",",",["T_WHITESPACE","\n                                ",467],["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",468],["T_WHITESPACE"," ",468],["T_DOUBLE_ARROW","=>",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$ruleData",468],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",468],"]",",",["T_WHITESPACE","\n                                ",468],["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",469],["T_WHITESPACE"," ",469],["T_DOUBLE_ARROW","=>",469],["T_WHITESPACE"," ",469],["T_VARIABLE","$ruleData",469],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",469],"]",",",["T_WHITESPACE","\n                            ",469],"]",";",["T_WHITESPACE","\n                        ",470],"}",["T_WHITESPACE"," ",471],["T_ELSE","else",471],["T_WHITESPACE"," ",471],"{",["T_WHITESPACE","\n                            ",471],["T_VARIABLE","$dayPrices",472],"[",["T_VARIABLE","$priceKey",472],"]","[",["T_CONSTANT_ENCAPSED_STRING","'rule_price'",472],"]",["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","calcRuleProductPrice",472],"(",["T_WHITESPACE","\n                                ",472],["T_VARIABLE","$ruleData",473],",",["T_WHITESPACE","\n                                ",473],["T_VARIABLE","$dayPrices",474],"[",["T_VARIABLE","$priceKey",474],"]",["T_WHITESPACE","\n                            ",474],")",";",["T_WHITESPACE","\n                            ",475],["T_VARIABLE","$dayPrices",476],"[",["T_VARIABLE","$priceKey",476],"]","[",["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",476],"]",["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_STRING","max",476],"(",["T_WHITESPACE","\n                                ",476],["T_VARIABLE","$dayPrices",477],"[",["T_VARIABLE","$priceKey",477],"]","[",["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",477],"]",",",["T_WHITESPACE","\n                                ",477],["T_VARIABLE","$ruleData",478],"[",["T_CONSTANT_ENCAPSED_STRING","'from_time'",478],"]",["T_WHITESPACE","\n                            ",478],")",";",["T_WHITESPACE","\n                            ",479],["T_VARIABLE","$dayPrices",480],"[",["T_VARIABLE","$priceKey",480],"]","[",["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",480],"]",["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_STRING","min",480],"(",["T_WHITESPACE","\n                                ",480],["T_VARIABLE","$dayPrices",481],"[",["T_VARIABLE","$priceKey",481],"]","[",["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",481],"]",",",["T_WHITESPACE","\n                                ",481],["T_VARIABLE","$ruleData",482],"[",["T_CONSTANT_ENCAPSED_STRING","'to_time'",482],"]",["T_WHITESPACE","\n                            ",482],")",";",["T_WHITESPACE","\n                        ",483],"}",["T_WHITESPACE","\n\n                        ",484],["T_IF","if",486],["T_WHITESPACE"," ",486],"(",["T_VARIABLE","$ruleData",486],"[",["T_CONSTANT_ENCAPSED_STRING","'action_stop'",486],"]",")",["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n                            ",486],["T_VARIABLE","$stopFlags",487],"[",["T_VARIABLE","$priceKey",487],"]",["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_STRING","true",487],";",["T_WHITESPACE","\n                        ",487],"}",["T_WHITESPACE","\n                    ",488],"}",["T_WHITESPACE","\n                ",489],"}",["T_WHITESPACE","\n\n                ",490],["T_VARIABLE","$prevKey",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$productKey",492],";",["T_WHITESPACE","\n            ",492],"}",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","saveRuleProductPrices",494],"(",["T_VARIABLE","$dayPrices",494],")",";",["T_WHITESPACE","\n        ",494],"}",["T_WHITESPACE","\n\n        ",495],["T_RETURN","return",497],["T_WHITESPACE"," ",497],["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","updateCatalogRuleGroupWebsiteData",497],"(",")",";",["T_WHITESPACE","\n    ",497],"}",["T_WHITESPACE","\n\n    ",498],["T_DOC_COMMENT","\/**\n     * Update CatalogRuleGroupWebsite data\n     *\n     * @return $this\n     *\/",500],["T_WHITESPACE","\n    ",504],["T_PROTECTED","protected",505],["T_WHITESPACE"," ",505],["T_FUNCTION","function",505],["T_WHITESPACE"," ",505],["T_STRING","updateCatalogRuleGroupWebsiteData",505],"(",")",["T_WHITESPACE","\n    ",505],"{",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","connection",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","delete",507],"(",["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getTable",507],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_group_website'",507],")",",",["T_WHITESPACE"," ",507],"[","]",")",";",["T_WHITESPACE","\n\n        ",507],["T_VARIABLE","$timestamp",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","dateTime",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","gmtTimestamp",509],"(",")",";",["T_WHITESPACE","\n\n        ",509],["T_VARIABLE","$select",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","connection",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","select",511],"(",")",["T_OBJECT_OPERATOR","->",511],["T_STRING","distinct",511],"(",["T_WHITESPACE","\n            ",511],["T_STRING","true",512],["T_WHITESPACE","\n        ",512],")",["T_OBJECT_OPERATOR","->",513],["T_STRING","from",513],"(",["T_WHITESPACE","\n            ",513],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getTable",514],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",514],")",",",["T_WHITESPACE","\n            ",514],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","_catalogRuleGroupWebsiteColumnsList",515],["T_WHITESPACE","\n        ",515],")",["T_OBJECT_OPERATOR","->",516],["T_STRING","where",516],"(",["T_WHITESPACE","\n            ",516],"\"",["T_CURLY_OPEN","{",517],["T_VARIABLE","$timestamp",517],"}",["T_ENCAPSED_AND_WHITESPACE"," >= from_time AND ((",517],["T_CURLY_OPEN","{",517],["T_VARIABLE","$timestamp",517],"}",["T_ENCAPSED_AND_WHITESPACE"," <= to_time AND to_time > 0) OR to_time = 0)",517],"\"",["T_WHITESPACE","\n        ",517],")",";",["T_WHITESPACE","\n        ",518],["T_VARIABLE","$query",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_VARIABLE","$select",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","insertFromSelect",519],"(",["T_WHITESPACE","\n            ",519],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getTable",520],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_group_website'",520],")",",",["T_WHITESPACE","\n            ",520],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","_catalogRuleGroupWebsiteColumnsList",521],["T_WHITESPACE","\n        ",521],")",";",["T_WHITESPACE","\n\n        ",522],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","connection",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","query",524],"(",["T_VARIABLE","$query",524],")",";",["T_WHITESPACE","\n\n        ",524],["T_RETURN","return",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],";",["T_WHITESPACE","\n    ",526],"}",["T_WHITESPACE","\n\n    ",527],["T_DOC_COMMENT","\/**\n     * Clean rule price index\n     *\n     * @return $this\n     *\/",529],["T_WHITESPACE","\n    ",533],["T_PROTECTED","protected",534],["T_WHITESPACE"," ",534],["T_FUNCTION","function",534],["T_WHITESPACE"," ",534],["T_STRING","deleteOldData",534],"(",")",["T_WHITESPACE","\n    ",534],"{",["T_WHITESPACE","\n        ",535],["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","connection",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","delete",536],"(",["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","getTable",536],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",536],")",")",";",["T_WHITESPACE","\n        ",536],["T_RETURN","return",537],["T_WHITESPACE"," ",537],["T_VARIABLE","$this",537],";",["T_WHITESPACE","\n    ",537],"}",["T_WHITESPACE","\n\n    ",538],["T_DOC_COMMENT","\/**\n     * @param array $ruleData\n     * @param null $productData\n     * @return float\n     *\/",540],["T_WHITESPACE","\n    ",544],["T_PROTECTED","protected",545],["T_WHITESPACE"," ",545],["T_FUNCTION","function",545],["T_WHITESPACE"," ",545],["T_STRING","calcRuleProductPrice",545],"(",["T_VARIABLE","$ruleData",545],",",["T_WHITESPACE"," ",545],["T_VARIABLE","$productData",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_STRING","null",545],")",["T_WHITESPACE","\n    ",545],"{",["T_WHITESPACE","\n        ",546],["T_IF","if",547],["T_WHITESPACE"," ",547],"(",["T_VARIABLE","$productData",547],["T_WHITESPACE"," ",547],["T_IS_NOT_IDENTICAL","!==",547],["T_WHITESPACE"," ",547],["T_STRING","null",547],["T_WHITESPACE"," ",547],["T_BOOLEAN_AND","&&",547],["T_WHITESPACE"," ",547],["T_ISSET","isset",547],"(",["T_VARIABLE","$productData",547],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_price'",547],"]",")",")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n            ",547],["T_VARIABLE","$productPrice",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_VARIABLE","$productData",548],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_price'",548],"]",";",["T_WHITESPACE","\n        ",548],"}",["T_WHITESPACE"," ",549],["T_ELSE","else",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$productPrice",550],["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_VARIABLE","$ruleData",550],"[",["T_CONSTANT_ENCAPSED_STRING","'default_price'",550],"]",";",["T_WHITESPACE","\n        ",550],"}",["T_WHITESPACE","\n\n        ",551],["T_SWITCH","switch",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$ruleData",553],"[",["T_CONSTANT_ENCAPSED_STRING","'action_operator'",553],"]",")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n            ",553],["T_CASE","case",554],["T_WHITESPACE"," ",554],["T_CONSTANT_ENCAPSED_STRING","'to_fixed'",554],":",["T_WHITESPACE","\n                ",554],["T_VARIABLE","$productPrice",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_STRING","min",555],"(",["T_VARIABLE","$ruleData",555],"[",["T_CONSTANT_ENCAPSED_STRING","'action_amount'",555],"]",",",["T_WHITESPACE"," ",555],["T_VARIABLE","$productPrice",555],")",";",["T_WHITESPACE","\n                ",555],["T_BREAK","break",556],";",["T_WHITESPACE","\n            ",556],["T_CASE","case",557],["T_WHITESPACE"," ",557],["T_CONSTANT_ENCAPSED_STRING","'to_percent'",557],":",["T_WHITESPACE","\n                ",557],["T_VARIABLE","$productPrice",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$productPrice",558],["T_WHITESPACE"," ",558],"*",["T_WHITESPACE"," ",558],["T_VARIABLE","$ruleData",558],"[",["T_CONSTANT_ENCAPSED_STRING","'action_amount'",558],"]",["T_WHITESPACE"," ",558],"\/",["T_WHITESPACE"," ",558],["T_LNUMBER","100",558],";",["T_WHITESPACE","\n                ",558],["T_BREAK","break",559],";",["T_WHITESPACE","\n            ",559],["T_CASE","case",560],["T_WHITESPACE"," ",560],["T_CONSTANT_ENCAPSED_STRING","'by_fixed'",560],":",["T_WHITESPACE","\n                ",560],["T_VARIABLE","$productPrice",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_STRING","max",561],"(",["T_LNUMBER","0",561],",",["T_WHITESPACE"," ",561],["T_VARIABLE","$productPrice",561],["T_WHITESPACE"," ",561],"-",["T_WHITESPACE"," ",561],["T_VARIABLE","$ruleData",561],"[",["T_CONSTANT_ENCAPSED_STRING","'action_amount'",561],"]",")",";",["T_WHITESPACE","\n                ",561],["T_BREAK","break",562],";",["T_WHITESPACE","\n            ",562],["T_CASE","case",563],["T_WHITESPACE"," ",563],["T_CONSTANT_ENCAPSED_STRING","'by_percent'",563],":",["T_WHITESPACE","\n                ",563],["T_VARIABLE","$productPrice",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_VARIABLE","$productPrice",564],["T_WHITESPACE"," ",564],"*",["T_WHITESPACE"," ",564],"(",["T_LNUMBER","1",564],["T_WHITESPACE"," ",564],"-",["T_WHITESPACE"," ",564],["T_VARIABLE","$ruleData",564],"[",["T_CONSTANT_ENCAPSED_STRING","'action_amount'",564],"]",["T_WHITESPACE"," ",564],"\/",["T_WHITESPACE"," ",564],["T_LNUMBER","100",564],")",";",["T_WHITESPACE","\n                ",564],["T_BREAK","break",565],";",["T_WHITESPACE","\n            ",565],["T_DEFAULT","default",566],":",["T_WHITESPACE","\n                ",566],["T_VARIABLE","$productPrice",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_LNUMBER","0",567],";",["T_WHITESPACE","\n        ",567],"}",["T_WHITESPACE","\n\n        ",568],["T_RETURN","return",570],["T_WHITESPACE"," ",570],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","priceCurrency",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","round",570],"(",["T_VARIABLE","$productPrice",570],")",";",["T_WHITESPACE","\n    ",570],"}",["T_WHITESPACE","\n\n    ",571],["T_DOC_COMMENT","\/**\n     * @param int $websiteId\n     * @param Product|null $product\n     * @return \\Zend_Db_Statement_Interface\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",573],["T_WHITESPACE","\n    ",578],["T_PROTECTED","protected",579],["T_WHITESPACE"," ",579],["T_FUNCTION","function",579],["T_WHITESPACE"," ",579],["T_STRING","getRuleProductsStmt",579],"(",["T_VARIABLE","$websiteId",579],",",["T_WHITESPACE"," ",579],["T_STRING","Product",579],["T_WHITESPACE"," ",579],["T_VARIABLE","$product",579],["T_WHITESPACE"," ",579],"=",["T_WHITESPACE"," ",579],["T_STRING","null",579],")",["T_WHITESPACE","\n    ",579],"{",["T_WHITESPACE","\n        ",580],["T_DOC_COMMENT","\/**\n         * Sort order is important\n         * It used for check stop price rule condition.\n         * website_id   customer_group_id   product_id  sort_order\n         *  1           1                   1           0\n         *  1           1                   1           1\n         *  1           1                   1           2\n         * if row with sort order 1 will have stop flag we should exclude\n         * all next rows for same product id from price calculation\n         *\/",581],["T_WHITESPACE","\n        ",590],["T_VARIABLE","$select",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","connection",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","select",591],"(",")",["T_OBJECT_OPERATOR","->",591],["T_STRING","from",591],"(",["T_WHITESPACE","\n            ",591],"[",["T_CONSTANT_ENCAPSED_STRING","'rp'",592],["T_WHITESPACE"," ",592],["T_DOUBLE_ARROW","=>",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getTable",592],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product'",592],")","]",["T_WHITESPACE","\n        ",592],")",["T_OBJECT_OPERATOR","->",593],["T_STRING","order",593],"(",["T_WHITESPACE","\n            ",593],"[",["T_CONSTANT_ENCAPSED_STRING","'rp.website_id'",594],",",["T_WHITESPACE"," ",594],["T_CONSTANT_ENCAPSED_STRING","'rp.customer_group_id'",594],",",["T_WHITESPACE"," ",594],["T_CONSTANT_ENCAPSED_STRING","'rp.product_id'",594],",",["T_WHITESPACE"," ",594],["T_CONSTANT_ENCAPSED_STRING","'rp.sort_order'",594],",",["T_WHITESPACE"," ",594],["T_CONSTANT_ENCAPSED_STRING","'rp.rule_id'",594],"]",["T_WHITESPACE","\n        ",594],")",";",["T_WHITESPACE","\n\n        ",595],["T_IF","if",597],["T_WHITESPACE"," ",597],"(",["T_VARIABLE","$product",597],["T_WHITESPACE"," ",597],["T_BOOLEAN_AND","&&",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$product",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getEntityId",597],"(",")",")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n            ",597],["T_VARIABLE","$select",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","where",598],"(",["T_CONSTANT_ENCAPSED_STRING","'rp.product_id=?'",598],",",["T_WHITESPACE"," ",598],["T_VARIABLE","$product",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getEntityId",598],"(",")",")",";",["T_WHITESPACE","\n        ",598],"}",["T_WHITESPACE","\n\n        ",599],["T_DOC_COMMENT","\/**\n         * Join default price and websites prices to result\n         *\/",601],["T_WHITESPACE","\n        ",603],["T_VARIABLE","$priceAttr",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","eavConfig",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","getAttribute",604],"(",["T_STRING","Product",604],["T_DOUBLE_COLON","::",604],["T_STRING","ENTITY",604],",",["T_WHITESPACE"," ",604],["T_CONSTANT_ENCAPSED_STRING","'price'",604],")",";",["T_WHITESPACE","\n        ",604],["T_VARIABLE","$priceTable",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$priceAttr",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getBackend",605],"(",")",["T_OBJECT_OPERATOR","->",605],["T_STRING","getTable",605],"(",")",";",["T_WHITESPACE","\n        ",605],["T_VARIABLE","$attributeId",606],["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_VARIABLE","$priceAttr",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","getId",606],"(",")",";",["T_WHITESPACE","\n\n        ",606],["T_VARIABLE","$linkField",608],["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_VARIABLE","$this",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","getMetadataPool",608],"(",")",["T_OBJECT_OPERATOR","->",608],["T_STRING","getMetadata",608],"(",["T_STRING","ProductInterface",608],["T_DOUBLE_COLON","::",608],["T_CLASS","class",608],")",["T_OBJECT_OPERATOR","->",608],["T_STRING","getLinkField",608],"(",")",";",["T_WHITESPACE","\n        ",608],["T_VARIABLE","$select",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","join",609],"(",["T_WHITESPACE","\n            ",609],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",610],["T_WHITESPACE"," ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$this",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getTable",610],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",610],")","]",",",["T_WHITESPACE","\n            ",610],["T_STRING","sprintf",611],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = rp.product_id'",611],")",",",["T_WHITESPACE","\n            ",611],"[","]",["T_WHITESPACE","\n        ",612],")",";",["T_WHITESPACE","\n        ",613],["T_VARIABLE","$joinCondition",614],["T_WHITESPACE"," ",614],"=",["T_WHITESPACE"," ",614],["T_CONSTANT_ENCAPSED_STRING","'%1$s.'",614],["T_WHITESPACE"," ",614],".",["T_WHITESPACE"," ",614],["T_VARIABLE","$linkField",614],["T_WHITESPACE"," ",614],".",["T_WHITESPACE"," ",614],["T_CONSTANT_ENCAPSED_STRING","'=e.'",614],["T_WHITESPACE"," ",614],".",["T_WHITESPACE"," ",614],["T_VARIABLE","$linkField",614],["T_WHITESPACE"," ",614],".",["T_WHITESPACE"," ",614],["T_CONSTANT_ENCAPSED_STRING","' AND (%1$s.attribute_id='",614],["T_WHITESPACE","\n            ",614],".",["T_WHITESPACE"," ",615],["T_VARIABLE","$attributeId",615],["T_WHITESPACE","\n            ",615],".",["T_WHITESPACE"," ",616],["T_CONSTANT_ENCAPSED_STRING","') and %1$s.store_id=%2$s'",616],";",["T_WHITESPACE","\n\n        ",616],["T_VARIABLE","$select",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","join",618],"(",["T_WHITESPACE","\n            ",618],"[",["T_CONSTANT_ENCAPSED_STRING","'pp_default'",619],["T_WHITESPACE"," ",619],["T_DOUBLE_ARROW","=>",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$priceTable",619],"]",",",["T_WHITESPACE","\n            ",619],["T_STRING","sprintf",620],"(",["T_VARIABLE","$joinCondition",620],",",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","'pp_default'",620],",",["T_WHITESPACE"," ",620],["T_NS_SEPARATOR","\\",620],["T_STRING","Magento",620],["T_NS_SEPARATOR","\\",620],["T_STRING","Store",620],["T_NS_SEPARATOR","\\",620],["T_STRING","Model",620],["T_NS_SEPARATOR","\\",620],["T_STRING","Store",620],["T_DOUBLE_COLON","::",620],["T_STRING","DEFAULT_STORE_ID",620],")",",",["T_WHITESPACE","\n            ",620],"[","]",["T_WHITESPACE","\n        ",621],")",";",["T_WHITESPACE","\n\n        ",622],["T_VARIABLE","$website",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","storeManager",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","getWebsite",624],"(",["T_VARIABLE","$websiteId",624],")",";",["T_WHITESPACE","\n        ",624],["T_VARIABLE","$defaultGroup",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_VARIABLE","$website",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","getDefaultGroup",625],"(",")",";",["T_WHITESPACE","\n        ",625],["T_IF","if",626],["T_WHITESPACE"," ",626],"(",["T_VARIABLE","$defaultGroup",626],["T_WHITESPACE"," ",626],["T_INSTANCEOF","instanceof",626],["T_WHITESPACE"," ",626],["T_NS_SEPARATOR","\\",626],["T_STRING","Magento",626],["T_NS_SEPARATOR","\\",626],["T_STRING","Store",626],["T_NS_SEPARATOR","\\",626],["T_STRING","Model",626],["T_NS_SEPARATOR","\\",626],["T_STRING","Group",626],")",["T_WHITESPACE"," ",626],"{",["T_WHITESPACE","\n            ",626],["T_VARIABLE","$storeId",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_VARIABLE","$defaultGroup",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","getDefaultStoreId",627],"(",")",";",["T_WHITESPACE","\n        ",627],"}",["T_WHITESPACE"," ",628],["T_ELSE","else",628],["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n            ",628],["T_VARIABLE","$storeId",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_NS_SEPARATOR","\\",629],["T_STRING","Magento",629],["T_NS_SEPARATOR","\\",629],["T_STRING","Store",629],["T_NS_SEPARATOR","\\",629],["T_STRING","Model",629],["T_NS_SEPARATOR","\\",629],["T_STRING","Store",629],["T_DOUBLE_COLON","::",629],["T_STRING","DEFAULT_STORE_ID",629],";",["T_WHITESPACE","\n        ",629],"}",["T_WHITESPACE","\n\n        ",630],["T_VARIABLE","$select",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","joinInner",632],"(",["T_WHITESPACE","\n            ",632],"[",["T_CONSTANT_ENCAPSED_STRING","'product_website'",633],["T_WHITESPACE"," ",633],["T_DOUBLE_ARROW","=>",633],["T_WHITESPACE"," ",633],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","getTable",633],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_website'",633],")","]",",",["T_WHITESPACE","\n            ",633],["T_CONSTANT_ENCAPSED_STRING","'product_website.product_id=rp.product_id '",634],["T_WHITESPACE","\n            ",634],".",["T_WHITESPACE"," ",635],["T_CONSTANT_ENCAPSED_STRING","'AND product_website.website_id = rp.website_id '",635],["T_WHITESPACE","\n            ",635],".",["T_WHITESPACE"," ",636],["T_CONSTANT_ENCAPSED_STRING","'AND product_website.website_id='",636],["T_WHITESPACE","\n            ",636],".",["T_WHITESPACE"," ",637],["T_VARIABLE","$websiteId",637],",",["T_WHITESPACE","\n            ",637],"[","]",["T_WHITESPACE","\n        ",638],")",";",["T_WHITESPACE","\n\n        ",639],["T_VARIABLE","$tableAlias",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'pp'",641],["T_WHITESPACE"," ",641],".",["T_WHITESPACE"," ",641],["T_VARIABLE","$websiteId",641],";",["T_WHITESPACE","\n        ",641],["T_VARIABLE","$select",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","joinLeft",642],"(",["T_WHITESPACE","\n            ",642],"[",["T_VARIABLE","$tableAlias",643],["T_WHITESPACE"," ",643],["T_DOUBLE_ARROW","=>",643],["T_WHITESPACE"," ",643],["T_VARIABLE","$priceTable",643],"]",",",["T_WHITESPACE","\n            ",643],["T_STRING","sprintf",644],"(",["T_VARIABLE","$joinCondition",644],",",["T_WHITESPACE"," ",644],["T_VARIABLE","$tableAlias",644],",",["T_WHITESPACE"," ",644],["T_VARIABLE","$storeId",644],")",",",["T_WHITESPACE","\n            ",644],"[","]",["T_WHITESPACE","\n        ",645],")",";",["T_WHITESPACE","\n        ",646],["T_VARIABLE","$select",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","columns",647],"(","[",["T_WHITESPACE","\n            ",647],["T_CONSTANT_ENCAPSED_STRING","'default_price'",648],["T_WHITESPACE"," ",648],["T_DOUBLE_ARROW","=>",648],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","connection",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getIfNullSql",648],"(",["T_VARIABLE","$tableAlias",648],["T_WHITESPACE"," ",648],".",["T_WHITESPACE"," ",648],["T_CONSTANT_ENCAPSED_STRING","'.value'",648],",",["T_WHITESPACE"," ",648],["T_CONSTANT_ENCAPSED_STRING","'pp_default.value'",648],")",",",["T_WHITESPACE","\n        ",648],"]",")",";",["T_WHITESPACE","\n\n        ",649],["T_RETURN","return",651],["T_WHITESPACE"," ",651],["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","connection",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","query",651],"(",["T_VARIABLE","$select",651],")",";",["T_WHITESPACE","\n    ",651],"}",["T_WHITESPACE","\n\n    ",652],["T_DOC_COMMENT","\/**\n     * @param array $arrData\n     * @return $this\n     * @throws \\Exception\n     *\/",654],["T_WHITESPACE","\n    ",658],["T_PROTECTED","protected",659],["T_WHITESPACE"," ",659],["T_FUNCTION","function",659],["T_WHITESPACE"," ",659],["T_STRING","saveRuleProductPrices",659],"(",["T_VARIABLE","$arrData",659],")",["T_WHITESPACE","\n    ",659],"{",["T_WHITESPACE","\n        ",660],["T_IF","if",661],["T_WHITESPACE"," ",661],"(",["T_EMPTY","empty",661],"(",["T_VARIABLE","$arrData",661],")",")",["T_WHITESPACE"," ",661],"{",["T_WHITESPACE","\n            ",661],["T_RETURN","return",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$this",662],";",["T_WHITESPACE","\n        ",662],"}",["T_WHITESPACE","\n\n        ",663],["T_VARIABLE","$productIds",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],"[","]",";",["T_WHITESPACE","\n\n        ",665],["T_TRY","try",667],["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n            ",667],["T_FOREACH","foreach",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$arrData",668],["T_WHITESPACE"," ",668],["T_AS","as",668],["T_WHITESPACE"," ",668],["T_VARIABLE","$key",668],["T_WHITESPACE"," ",668],["T_DOUBLE_ARROW","=>",668],["T_WHITESPACE"," ",668],["T_VARIABLE","$data",668],")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n                ",668],["T_VARIABLE","$productIds",669],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",669],"]",["T_WHITESPACE"," ",669],"=",["T_WHITESPACE"," ",669],["T_VARIABLE","$data",669],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",669],"]",";",["T_WHITESPACE","\n                ",669],["T_VARIABLE","$arrData",670],"[",["T_VARIABLE","$key",670],"]","[",["T_CONSTANT_ENCAPSED_STRING","'rule_date'",670],"]",["T_WHITESPACE"," ",670],"=",["T_WHITESPACE"," ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","dateFormat",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","formatDate",670],"(",["T_VARIABLE","$data",670],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_date'",670],"]",",",["T_WHITESPACE"," ",670],["T_STRING","false",670],")",";",["T_WHITESPACE","\n                ",670],["T_VARIABLE","$arrData",671],"[",["T_VARIABLE","$key",671],"]","[",["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",671],"]",["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","dateFormat",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","formatDate",671],"(",["T_VARIABLE","$data",671],"[",["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",671],"]",",",["T_WHITESPACE"," ",671],["T_STRING","false",671],")",";",["T_WHITESPACE","\n                ",671],["T_VARIABLE","$arrData",672],"[",["T_VARIABLE","$key",672],"]","[",["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",672],"]",["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","dateFormat",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","formatDate",672],"(",["T_VARIABLE","$data",672],"[",["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",672],"]",",",["T_WHITESPACE"," ",672],["T_STRING","false",672],")",";",["T_WHITESPACE","\n            ",672],"}",["T_WHITESPACE","\n            ",673],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","connection",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","insertOnDuplicate",674],"(",["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","getTable",674],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",674],")",",",["T_WHITESPACE"," ",674],["T_VARIABLE","$arrData",674],")",";",["T_WHITESPACE","\n        ",674],"}",["T_WHITESPACE"," ",675],["T_CATCH","catch",675],["T_WHITESPACE"," ",675],"(",["T_NS_SEPARATOR","\\",675],["T_STRING","Exception",675],["T_WHITESPACE"," ",675],["T_VARIABLE","$e",675],")",["T_WHITESPACE"," ",675],"{",["T_WHITESPACE","\n            ",675],["T_THROW","throw",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$e",676],";",["T_WHITESPACE","\n        ",676],"}",["T_WHITESPACE","\n\n        ",677],["T_RETURN","return",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$this",679],";",["T_WHITESPACE","\n    ",679],"}",["T_WHITESPACE","\n\n    ",680],["T_DOC_COMMENT","\/**\n     * Get active rules\n     *\n     * @return array\n     *\/",682],["T_WHITESPACE","\n    ",686],["T_PROTECTED","protected",687],["T_WHITESPACE"," ",687],["T_FUNCTION","function",687],["T_WHITESPACE"," ",687],["T_STRING","getActiveRules",687],"(",")",["T_WHITESPACE","\n    ",687],"{",["T_WHITESPACE","\n        ",688],["T_RETURN","return",689],["T_WHITESPACE"," ",689],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","ruleCollectionFactory",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","create",689],"(",")",["T_WHITESPACE","\n            ",689],["T_OBJECT_OPERATOR","->",690],["T_STRING","addFieldToFilter",690],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",690],",",["T_WHITESPACE"," ",690],["T_LNUMBER","1",690],")",";",["T_WHITESPACE","\n    ",690],"}",["T_WHITESPACE","\n\n    ",691],["T_DOC_COMMENT","\/**\n     * Get active rules\n     *\n     * @return array\n     *\/",693],["T_WHITESPACE","\n    ",697],["T_PROTECTED","protected",698],["T_WHITESPACE"," ",698],["T_FUNCTION","function",698],["T_WHITESPACE"," ",698],["T_STRING","getAllRules",698],"(",")",["T_WHITESPACE","\n    ",698],"{",["T_WHITESPACE","\n        ",699],["T_RETURN","return",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$this",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","ruleCollectionFactory",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","create",700],"(",")",";",["T_WHITESPACE","\n    ",700],"}",["T_WHITESPACE","\n\n    ",701],["T_DOC_COMMENT","\/**\n     * @param int $productId\n     * @return Product\n     *\/",703],["T_WHITESPACE","\n    ",706],["T_PROTECTED","protected",707],["T_WHITESPACE"," ",707],["T_FUNCTION","function",707],["T_WHITESPACE"," ",707],["T_STRING","getProduct",707],"(",["T_VARIABLE","$productId",707],")",["T_WHITESPACE","\n    ",707],"{",["T_WHITESPACE","\n        ",708],["T_IF","if",709],["T_WHITESPACE"," ",709],"(","!",["T_ISSET","isset",709],"(",["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","loadedProducts",709],"[",["T_VARIABLE","$productId",709],"]",")",")",["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n            ",709],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","loadedProducts",710],"[",["T_VARIABLE","$productId",710],"]",["T_WHITESPACE"," ",710],"=",["T_WHITESPACE"," ",710],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","productFactory",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","create",710],"(",")",["T_OBJECT_OPERATOR","->",710],["T_STRING","load",710],"(",["T_VARIABLE","$productId",710],")",";",["T_WHITESPACE","\n        ",710],"}",["T_WHITESPACE","\n        ",711],["T_RETURN","return",712],["T_WHITESPACE"," ",712],["T_VARIABLE","$this",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","loadedProducts",712],"[",["T_VARIABLE","$productId",712],"]",";",["T_WHITESPACE","\n    ",712],"}",["T_WHITESPACE","\n\n    ",713],["T_DOC_COMMENT","\/**\n     * @param \\Exception $e\n     * @return void\n     *\/",715],["T_WHITESPACE","\n    ",718],["T_PROTECTED","protected",719],["T_WHITESPACE"," ",719],["T_FUNCTION","function",719],["T_WHITESPACE"," ",719],["T_STRING","critical",719],"(",["T_VARIABLE","$e",719],")",["T_WHITESPACE","\n    ",719],"{",["T_WHITESPACE","\n        ",720],["T_VARIABLE","$this",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","logger",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","critical",721],"(",["T_VARIABLE","$e",721],")",";",["T_WHITESPACE","\n    ",721],"}",["T_WHITESPACE","\n\n    ",722],["T_DOC_COMMENT","\/**\n     * @param int $timeStamp\n     * @return int\n     *\/",724],["T_WHITESPACE","\n    ",727],["T_PRIVATE","private",728],["T_WHITESPACE"," ",728],["T_FUNCTION","function",728],["T_WHITESPACE"," ",728],["T_STRING","roundTime",728],"(",["T_VARIABLE","$timeStamp",728],")",["T_WHITESPACE","\n    ",728],"{",["T_WHITESPACE","\n        ",729],["T_IF","if",730],["T_WHITESPACE"," ",730],"(",["T_STRING","is_numeric",730],"(",["T_VARIABLE","$timeStamp",730],")",["T_WHITESPACE"," ",730],["T_BOOLEAN_AND","&&",730],["T_WHITESPACE"," ",730],["T_VARIABLE","$timeStamp",730],["T_WHITESPACE"," ",730],["T_IS_NOT_EQUAL","!=",730],["T_WHITESPACE"," ",730],["T_LNUMBER","0",730],")",["T_WHITESPACE"," ",730],"{",["T_WHITESPACE","\n            ",730],["T_VARIABLE","$timeStamp",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","dateTime",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","timestamp",731],"(",["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","dateTime",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","date",731],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d 00:00:00'",731],",",["T_WHITESPACE"," ",731],["T_VARIABLE","$timeStamp",731],")",")",";",["T_WHITESPACE","\n        ",731],"}",["T_WHITESPACE","\n\n        ",732],["T_RETURN","return",734],["T_WHITESPACE"," ",734],["T_VARIABLE","$timeStamp",734],";",["T_WHITESPACE","\n    ",734],"}",["T_WHITESPACE","\n\n    ",735],["T_DOC_COMMENT","\/**\n     * @return MetadataPool\n     *\/",737],["T_WHITESPACE","\n    ",739],["T_PRIVATE","private",740],["T_WHITESPACE"," ",740],["T_FUNCTION","function",740],["T_WHITESPACE"," ",740],["T_STRING","getMetadataPool",740],"(",")",["T_WHITESPACE","\n    ",740],"{",["T_WHITESPACE","\n        ",741],["T_IF","if",742],["T_WHITESPACE"," ",742],"(",["T_STRING","null",742],["T_WHITESPACE"," ",742],["T_IS_IDENTICAL","===",742],["T_WHITESPACE"," ",742],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","metadataPool",742],")",["T_WHITESPACE"," ",742],"{",["T_WHITESPACE","\n            ",742],["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","metadataPool",743],["T_WHITESPACE"," ",743],"=",["T_WHITESPACE"," ",743],["T_NS_SEPARATOR","\\",743],["T_STRING","Magento",743],["T_NS_SEPARATOR","\\",743],["T_STRING","Framework",743],["T_NS_SEPARATOR","\\",743],["T_STRING","App",743],["T_NS_SEPARATOR","\\",743],["T_STRING","ObjectManager",743],["T_DOUBLE_COLON","::",743],["T_STRING","getInstance",743],"(",")",["T_WHITESPACE","\n                ",743],["T_OBJECT_OPERATOR","->",744],["T_STRING","get",744],"(",["T_NS_SEPARATOR","\\",744],["T_STRING","Magento",744],["T_NS_SEPARATOR","\\",744],["T_STRING","Framework",744],["T_NS_SEPARATOR","\\",744],["T_STRING","EntityManager",744],["T_NS_SEPARATOR","\\",744],["T_STRING","MetadataPool",744],["T_DOUBLE_COLON","::",744],["T_CLASS","class",744],")",";",["T_WHITESPACE","\n        ",744],"}",["T_WHITESPACE","\n        ",745],["T_RETURN","return",746],["T_WHITESPACE"," ",746],["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","metadataPool",746],";",["T_WHITESPACE","\n    ",746],"}",["T_WHITESPACE","\n",747],"}",["T_WHITESPACE","\n",748]]