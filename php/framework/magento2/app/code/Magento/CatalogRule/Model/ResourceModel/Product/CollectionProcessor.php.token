[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",6],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","CatalogRule",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ResourceModel",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Product",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Catalog",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Product",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Collection",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","ProductCollection",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CatalogRule",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Pricing",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Price",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CatalogRulePrice",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Add catalog rule prices to collection\n *\/",12],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","CollectionProcessor",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PRIVATE","private",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$storeManager",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\ResourceConnection\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PRIVATE","private",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$resource",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Customer\\Model\\Session\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PRIVATE","private",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$customerSession",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$dateTime",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PRIVATE","private",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$localeDate",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Framework\\App\\ResourceConnection $resourceConnection\n     * @param \\Magento\\Customer\\Model\\Session $customerSession\n     * @param \\Magento\\Framework\\Stdlib\\DateTime $dateTime\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface $localeDate\n     *\/",42],["T_WHITESPACE","\n    ",48],["T_PUBLIC","public",49],["T_WHITESPACE"," ",49],["T_FUNCTION","function",49],["T_WHITESPACE"," ",49],["T_STRING","__construct",49],"(",["T_WHITESPACE","\n        ",49],["T_NS_SEPARATOR","\\",50],["T_STRING","Magento",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Store",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Model",50],["T_NS_SEPARATOR","\\",50],["T_STRING","StoreManagerInterface",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$storeManager",50],",",["T_WHITESPACE","\n        ",50],["T_NS_SEPARATOR","\\",51],["T_STRING","Magento",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Framework",51],["T_NS_SEPARATOR","\\",51],["T_STRING","App",51],["T_NS_SEPARATOR","\\",51],["T_STRING","ResourceConnection",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$resourceConnection",51],",",["T_WHITESPACE","\n        ",51],["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Customer",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Model",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Session",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$customerSession",52],",",["T_WHITESPACE","\n        ",52],["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Framework",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Stdlib",53],["T_NS_SEPARATOR","\\",53],["T_STRING","DateTime",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$dateTime",53],",",["T_WHITESPACE","\n        ",53],["T_NS_SEPARATOR","\\",54],["T_STRING","Magento",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Framework",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Stdlib",54],["T_NS_SEPARATOR","\\",54],["T_STRING","DateTime",54],["T_NS_SEPARATOR","\\",54],["T_STRING","TimezoneInterface",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$localeDate",54],["T_WHITESPACE","\n    ",54],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","storeManager",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$storeManager",56],";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","resource",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$resourceConnection",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","customerSession",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$customerSession",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","dateTime",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$dateTime",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","localeDate",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$localeDate",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * @param ProductCollection $productCollection\n     * @param string $joinColumn\n     * @return ProductCollection\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","addPriceData",68],"(",["T_STRING","ProductCollection",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$productCollection",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$joinColumn",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_VARIABLE","$productCollection",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","hasFlag",70],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_rule_loaded'",70],")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$connection",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","resource",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getConnection",71],"(",")",";",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$store",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","storeManager",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getStore",72],"(",")",";",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$productCollection",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getSelect",73],"(",")",["T_WHITESPACE","\n                ",73],["T_OBJECT_OPERATOR","->",74],["T_STRING","joinLeft",74],"(",["T_WHITESPACE","\n                    ",74],"[",["T_CONSTANT_ENCAPSED_STRING","'catalog_rule'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","resource",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getTableName",75],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",75],")","]",",",["T_WHITESPACE","\n                    ",75],["T_STRING","implode",76],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",76],",",["T_WHITESPACE"," ",76],"[",["T_WHITESPACE","\n                        ",76],["T_CONSTANT_ENCAPSED_STRING","'catalog_rule.product_id = '",77],["T_WHITESPACE"," ",77],".",["T_WHITESPACE"," ",77],["T_VARIABLE","$connection",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","quoteIdentifier",77],"(",["T_VARIABLE","$joinColumn",77],")",",",["T_WHITESPACE","\n                        ",77],["T_VARIABLE","$connection",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","quoteInto",78],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_rule.website_id = ?'",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$store",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getWebsiteId",78],"(",")",")",",",["T_WHITESPACE","\n                        ",78],["T_VARIABLE","$connection",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","quoteInto",79],"(",["T_WHITESPACE","\n                            ",79],["T_CONSTANT_ENCAPSED_STRING","'catalog_rule.customer_group_id = ?'",80],",",["T_WHITESPACE","\n                            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","customerSession",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getCustomerGroupId",81],"(",")",["T_WHITESPACE","\n                        ",81],")",",",["T_WHITESPACE","\n                        ",82],["T_VARIABLE","$connection",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","quoteInto",83],"(",["T_WHITESPACE","\n                            ",83],["T_CONSTANT_ENCAPSED_STRING","'catalog_rule.rule_date = ?'",84],",",["T_WHITESPACE","\n                            ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","dateTime",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","formatDate",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","localeDate",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","scopeDate",85],"(",["T_VARIABLE","$store",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getId",85],"(",")",")",",",["T_WHITESPACE"," ",85],["T_STRING","false",85],")",["T_WHITESPACE","\n                        ",85],")",",",["T_WHITESPACE","\n                    ",86],"]",")",",",["T_WHITESPACE","\n                    ",87],"[",["T_STRING","CatalogRulePrice",88],["T_DOUBLE_COLON","::",88],["T_STRING","PRICE_CODE",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'rule_price'",88],"]",["T_WHITESPACE","\n                ",88],")",";",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$productCollection",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setFlag",90],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_rule_loaded'",90],",",["T_WHITESPACE"," ",90],["T_STRING","true",90],")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$productCollection",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n",94],"}",["T_WHITESPACE","\n",95]]