[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Catalog Rule Product Aggregated Price per date Resource Model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","CatalogRule",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Rule",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Product",12],";",["T_WHITESPACE","\n\n",12],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Price",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Db",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractDb",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Initialize connection and define main table\n     *\n     * @return void\n     * @codeCoverageIgnore\n     *\/",16],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_FUNCTION","function",22],["T_WHITESPACE"," ",22],["T_STRING","_construct",22],"(",")",["T_WHITESPACE","\n    ",22],"{",["T_WHITESPACE","\n        ",23],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","_init",24],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_product_price'",24],",",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'rule_product_price_id'",24],")",";",["T_WHITESPACE","\n    ",24],"}",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * Apply price rule price to price index table\n     *\n     * @param \\Magento\\Framework\\DB\\Select $select\n     * @param array|string $indexTable\n     * @param string $entityId\n     * @param string $customerGroupId\n     * @param string $websiteId\n     * @param array $updateFields       the array of fields for compare with rule price and update\n     * @param string $websiteDate\n     * @return \\Magento\\CatalogRule\\Model\\ResourceModel\\Rule\\Product\\Price\n     *\/",27],["T_WHITESPACE","\n    ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","applyPriceRuleToIndexTable",39],"(",["T_WHITESPACE","\n        ",39],["T_NS_SEPARATOR","\\",40],["T_STRING","Magento",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Framework",40],["T_NS_SEPARATOR","\\",40],["T_STRING","DB",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Select",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$select",40],",",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$indexTable",41],",",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$entityId",42],",",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$customerGroupId",43],",",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$websiteId",44],",",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$updateFields",45],",",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$websiteDate",46],["T_WHITESPACE","\n    ",46],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n        ",47],["T_IF","if",48],["T_WHITESPACE"," ",48],"(",["T_EMPTY","empty",48],"(",["T_VARIABLE","$updateFields",48],")",")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_RETURN","return",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],";",["T_WHITESPACE","\n        ",49],"}",["T_WHITESPACE","\n\n        ",50],["T_IF","if",52],["T_WHITESPACE"," ",52],"(",["T_STRING","is_array",52],"(",["T_VARIABLE","$indexTable",52],")",")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n            ",52],["T_FOREACH","foreach",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$indexTable",53],["T_WHITESPACE"," ",53],["T_AS","as",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$k",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$v",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n                ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(",["T_STRING","is_string",54],"(",["T_VARIABLE","$k",54],")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n                    ",54],["T_VARIABLE","$indexAlias",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$k",55],";",["T_WHITESPACE","\n                ",55],"}",["T_WHITESPACE"," ",56],["T_ELSE","else",56],["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n                    ",56],["T_VARIABLE","$indexAlias",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$v",57],";",["T_WHITESPACE","\n                ",57],"}",["T_WHITESPACE","\n                ",58],["T_BREAK","break",59],";",["T_WHITESPACE","\n            ",59],"}",["T_WHITESPACE","\n        ",60],"}",["T_WHITESPACE"," ",61],["T_ELSE","else",61],["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$indexAlias",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$indexTable",62],";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$select",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","join",65],"(",["T_WHITESPACE","\n            ",65],"[",["T_CONSTANT_ENCAPSED_STRING","'rp'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getMainTable",66],"(",")","]",",",["T_WHITESPACE","\n            ",66],"\"",["T_ENCAPSED_AND_WHITESPACE","rp.rule_date = ",67],["T_CURLY_OPEN","{",67],["T_VARIABLE","$websiteDate",67],"}","\"",",",["T_WHITESPACE","\n            ",67],"[","]",["T_WHITESPACE","\n        ",68],")",["T_OBJECT_OPERATOR","->",69],["T_STRING","where",69],"(",["T_WHITESPACE","\n            ",69],"\"",["T_ENCAPSED_AND_WHITESPACE","rp.product_id = ",70],["T_CURLY_OPEN","{",70],["T_VARIABLE","$entityId",70],"}",["T_ENCAPSED_AND_WHITESPACE"," AND rp.website_id = ",70],["T_CURLY_OPEN","{",70],["T_VARIABLE","$websiteId",70],"}",["T_ENCAPSED_AND_WHITESPACE"," AND rp.customer_group_id = ",70],["T_CURLY_OPEN","{",70],["T_VARIABLE","$customerGroupId",70],"}","\"",["T_WHITESPACE","\n        ",70],")",";",["T_WHITESPACE","\n\n        ",71],["T_FOREACH","foreach",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$updateFields",73],["T_WHITESPACE"," ",73],["T_AS","as",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$priceField",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$priceCond",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getConnection",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","quoteIdentifier",74],"(","[",["T_VARIABLE","$indexAlias",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$priceField",74],"]",")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$priceExpr",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getConnection",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","getCheckSql",75],"(",["T_WHITESPACE","\n                ",75],"\"",["T_ENCAPSED_AND_WHITESPACE","rp.rule_price < ",76],["T_CURLY_OPEN","{",76],["T_VARIABLE","$priceCond",76],"}","\"",",",["T_WHITESPACE","\n                ",76],["T_CONSTANT_ENCAPSED_STRING","'rp.rule_price'",77],",",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$priceCond",78],["T_WHITESPACE","\n            ",78],")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$select",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","columns",80],"(","[",["T_VARIABLE","$priceField",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$priceExpr",80],"]",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_VARIABLE","$query",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$select",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","crossUpdateFromSelect",83],"(",["T_VARIABLE","$indexTable",83],")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getConnection",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","query",84],"(",["T_VARIABLE","$query",84],")",";",["T_WHITESPACE","\n\n        ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n",87],"}",["T_WHITESPACE","\n",88]]