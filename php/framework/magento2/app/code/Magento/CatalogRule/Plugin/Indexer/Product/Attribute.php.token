[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","CatalogRule",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Plugin",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Product",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CatalogRule",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Indexer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Rule",8],["T_NS_SEPARATOR","\\",8],["T_STRING","RuleProductProcessor",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","CatalogRule",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Rule",9],["T_NS_SEPARATOR","\\",9],["T_STRING","CollectionFactory",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","RuleCollectionFactory",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CatalogRule",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Rule",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CatalogRule",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Rule",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Condition",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Combine",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Message",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ManagerInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Rule",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Condition",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Product",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractProduct",13],";",["T_WHITESPACE","\n\n",13],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","Attribute",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * @var RuleCollectionFactory\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$ruleCollectionFactory",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @var RuleProductProcessor\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$ruleProductProcessor",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var ManagerInterface\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$messageManager",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * @param RuleCollectionFactory $ruleCollectionFactory\n     * @param RuleProductProcessor $ruleProductProcessor\n     * @param ManagerInterface $messageManager\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","__construct",37],"(",["T_WHITESPACE","\n        ",37],["T_STRING","RuleCollectionFactory",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$ruleCollectionFactory",38],",",["T_WHITESPACE","\n        ",38],["T_STRING","RuleProductProcessor",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$ruleProductProcessor",39],",",["T_WHITESPACE","\n        ",39],["T_STRING","ManagerInterface",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$messageManager",40],["T_WHITESPACE","\n    ",40],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","ruleCollectionFactory",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$ruleCollectionFactory",42],";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","ruleProductProcessor",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$ruleProductProcessor",43],";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","messageManager",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$messageManager",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute $subject\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute $attribute\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute\n     *\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",47],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","afterSave",54],"(",["T_WHITESPACE","\n        ",54],["T_NS_SEPARATOR","\\",55],["T_STRING","Magento",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Catalog",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Model",55],["T_NS_SEPARATOR","\\",55],["T_STRING","ResourceModel",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Eav",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Attribute",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$subject",55],",",["T_WHITESPACE","\n        ",55],["T_NS_SEPARATOR","\\",56],["T_STRING","Magento",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Catalog",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Model",56],["T_NS_SEPARATOR","\\",56],["T_STRING","ResourceModel",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Eav",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Attribute",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$attribute",56],["T_WHITESPACE","\n    ",56],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$attribute",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","dataHasChangedFor",58],"(",["T_CONSTANT_ENCAPSED_STRING","'is_used_for_promo_rules'",58],")",["T_WHITESPACE"," ",58],["T_BOOLEAN_AND","&&",58],["T_WHITESPACE"," ",58],"!",["T_VARIABLE","$attribute",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getIsUsedForPromoRules",58],"(",")",")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","checkCatalogRulesAvailability",59],"(",["T_VARIABLE","$attribute",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getAttributeCode",59],"(",")",")",";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n        ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$attribute",61],";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute $subject\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute $attribute\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Eav\\Attribute\n     *\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",64],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","afterDelete",71],"(",["T_WHITESPACE","\n        ",71],["T_NS_SEPARATOR","\\",72],["T_STRING","Magento",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Catalog",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Model",72],["T_NS_SEPARATOR","\\",72],["T_STRING","ResourceModel",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Eav",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Attribute",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$subject",72],",",["T_WHITESPACE","\n        ",72],["T_NS_SEPARATOR","\\",73],["T_STRING","Magento",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Catalog",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Model",73],["T_NS_SEPARATOR","\\",73],["T_STRING","ResourceModel",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Eav",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Attribute",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$attribute",73],["T_WHITESPACE","\n    ",73],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$attribute",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getIsUsedForPromoRules",75],"(",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","checkCatalogRulesAvailability",76],"(",["T_VARIABLE","$attribute",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getAttributeCode",76],"(",")",")",";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE","\n        ",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$attribute",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Check rules that contains affected attribute\n     * If rules were found they will be set to inactive and notice will be add to admin session\n     *\n     * @param string $attributeCode\n     * @return $this\n     *\/",81],["T_WHITESPACE","\n    ",87],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","checkCatalogRulesAvailability",88],"(",["T_VARIABLE","$attributeCode",88],")",["T_WHITESPACE","\n    ",88],"{",["T_WHITESPACE","\n        ",89],["T_COMMENT","\/* @var $collection RuleCollectionFactory *\/",90],["T_WHITESPACE","\n        ",90],["T_VARIABLE","$collection",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","ruleCollectionFactory",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","create",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","addAttributeInConditionFilter",91],"(",["T_VARIABLE","$attributeCode",91],")",";",["T_WHITESPACE","\n\n        ",91],["T_VARIABLE","$disabledRulesCount",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_LNUMBER","0",93],";",["T_WHITESPACE","\n        ",93],["T_FOREACH","foreach",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$collection",94],["T_WHITESPACE"," ",94],["T_AS","as",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$rule",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_COMMENT","\/* @var $rule Rule *\/",95],["T_WHITESPACE","\n            ",95],["T_VARIABLE","$rule",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","setIsActive",96],"(",["T_LNUMBER","0",96],")",";",["T_WHITESPACE","\n            ",96],["T_COMMENT","\/* @var $rule->getConditions() Combine *\/",97],["T_WHITESPACE","\n            ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","removeAttributeFromConditions",98],"(",["T_VARIABLE","$rule",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getConditions",98],"(",")",",",["T_WHITESPACE"," ",98],["T_VARIABLE","$attributeCode",98],")",";",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$rule",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","save",99],"(",")",";",["T_WHITESPACE","\n\n            ",99],["T_VARIABLE","$disabledRulesCount",101],["T_INC","++",101],";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n\n        ",102],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$disabledRulesCount",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","ruleProductProcessor",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","markIndexerAsInvalid",105],"(",")",";",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","messageManager",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","addWarning",106],"(",["T_WHITESPACE","\n                ",106],["T_STRING","__",107],"(",["T_WHITESPACE","\n                    ",107],["T_CONSTANT_ENCAPSED_STRING","'You disabled %1 Catalog Price Rules based on \"%2\" attribute.'",108],",",["T_WHITESPACE","\n                    ",108],["T_VARIABLE","$disabledRulesCount",109],",",["T_WHITESPACE","\n                    ",109],["T_VARIABLE","$attributeCode",110],["T_WHITESPACE","\n                ",110],")",["T_WHITESPACE","\n            ",111],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Remove catalog attribute condition by attribute code from rule conditions\n     *\n     * @param Combine $combine\n     * @param string $attributeCode\n     * @return void\n     *\/",118],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","removeAttributeFromConditions",125],"(",["T_STRING","Combine",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$combine",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$attributeCode",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$conditions",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$combine",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getConditions",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_FOREACH","foreach",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$conditions",128],["T_WHITESPACE"," ",128],["T_AS","as",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$conditionId",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$condition",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$condition",129],["T_WHITESPACE"," ",129],["T_INSTANCEOF","instanceof",129],["T_WHITESPACE"," ",129],["T_STRING","Combine",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","removeAttributeFromConditions",130],"(",["T_VARIABLE","$condition",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$attributeCode",130],")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n            ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_VARIABLE","$condition",132],["T_WHITESPACE"," ",132],["T_INSTANCEOF","instanceof",132],["T_WHITESPACE"," ",132],["T_STRING","AbstractProduct",132],")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$condition",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getAttribute",133],"(",")",["T_WHITESPACE"," ",133],["T_IS_EQUAL","==",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$attributeCode",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n                    ",133],["T_UNSET","unset",134],"(",["T_VARIABLE","$conditions",134],"[",["T_VARIABLE","$conditionId",134],"]",")",";",["T_WHITESPACE","\n                ",134],"}",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$combine",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","setConditions",138],"(",["T_VARIABLE","$conditions",138],")",";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n",139],"}",["T_WHITESPACE","\n",140]]