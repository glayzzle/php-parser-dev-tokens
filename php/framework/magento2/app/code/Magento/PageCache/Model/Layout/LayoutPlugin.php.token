[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","PageCache",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Layout",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Class LayoutPlugin\n *\/",8],["T_WHITESPACE","\n",10],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","LayoutPlugin",11],["T_WHITESPACE","\n",11],"{",["T_WHITESPACE","\n    ",12],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\PageCache\\Model\\Config\n     *\/",13],["T_WHITESPACE","\n    ",15],["T_PROTECTED","protected",16],["T_WHITESPACE"," ",16],["T_VARIABLE","$config",16],";",["T_WHITESPACE","\n\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\ResponseInterface\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$response",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param \\Magento\\Framework\\App\\ResponseInterface $response\n     * @param \\Magento\\PageCache\\Model\\Config $config\n     *\/",23],["T_WHITESPACE","\n    ",28],["T_PUBLIC","public",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","__construct",29],"(",["T_WHITESPACE","\n        ",29],["T_NS_SEPARATOR","\\",30],["T_STRING","Magento",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Framework",30],["T_NS_SEPARATOR","\\",30],["T_STRING","App",30],["T_NS_SEPARATOR","\\",30],["T_STRING","ResponseInterface",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$response",30],",",["T_WHITESPACE","\n        ",30],["T_NS_SEPARATOR","\\",31],["T_STRING","Magento",31],["T_NS_SEPARATOR","\\",31],["T_STRING","PageCache",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Model",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Config",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$config",31],["T_WHITESPACE","\n    ",31],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n        ",32],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","response",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$response",33],";",["T_WHITESPACE","\n        ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","config",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_VARIABLE","$config",34],";",["T_WHITESPACE","\n    ",34],"}",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Set appropriate Cache-Control headers\n     * We have to set public headers in order to tell Varnish and Builtin app that page should be cached\n     *\n     * @param \\Magento\\Framework\\View\\Layout $subject\n     * @param mixed $result\n     * @return mixed\n     *\/",37],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","afterGenerateXml",45],"(",["T_NS_SEPARATOR","\\",45],["T_STRING","Magento",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Framework",45],["T_NS_SEPARATOR","\\",45],["T_STRING","View",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Layout",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$subject",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$result",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_IF","if",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$subject",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","isCacheable",47],"(",")",["T_WHITESPACE"," ",47],["T_BOOLEAN_AND","&&",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","config",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","isEnabled",47],"(",")",")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","response",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","setPublicHeaders",48],"(",["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","config",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getTtl",48],"(",")",")",";",["T_WHITESPACE","\n        ",48],"}",["T_WHITESPACE","\n        ",49],["T_RETURN","return",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$result",50],";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Retrieve all identities from blocks for further cache invalidation\n     *\n     * @param \\Magento\\Framework\\View\\Layout $subject\n     * @param mixed $result\n     * @return mixed\n     *\/",53],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","afterGetOutput",60],"(",["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Framework",60],["T_NS_SEPARATOR","\\",60],["T_STRING","View",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Layout",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$subject",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$result",60],")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$subject",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","isCacheable",62],"(",")",["T_WHITESPACE"," ",62],["T_BOOLEAN_AND","&&",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","config",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","isEnabled",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$tags",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],"[","]",";",["T_WHITESPACE","\n            ",63],["T_FOREACH","foreach",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$subject",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getAllBlocks",64],"(",")",["T_WHITESPACE"," ",64],["T_AS","as",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$block",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n                ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$block",65],["T_WHITESPACE"," ",65],["T_INSTANCEOF","instanceof",65],["T_WHITESPACE"," ",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Magento",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Framework",65],["T_NS_SEPARATOR","\\",65],["T_STRING","DataObject",65],["T_NS_SEPARATOR","\\",65],["T_STRING","IdentityInterface",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                    ",65],["T_VARIABLE","$isEsiBlock",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$block",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getTtl",66],"(",")",["T_WHITESPACE"," ",66],">",["T_WHITESPACE"," ",66],["T_LNUMBER","0",66],";",["T_WHITESPACE","\n                    ",66],["T_VARIABLE","$isVarnish",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","config",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getType",67],"(",")",["T_WHITESPACE"," ",67],["T_IS_EQUAL","==",67],["T_WHITESPACE"," ",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Magento",67],["T_NS_SEPARATOR","\\",67],["T_STRING","PageCache",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Model",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Config",67],["T_DOUBLE_COLON","::",67],["T_STRING","VARNISH",67],";",["T_WHITESPACE","\n                    ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$isVarnish",68],["T_WHITESPACE"," ",68],["T_BOOLEAN_AND","&&",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$isEsiBlock",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n                        ",68],["T_CONTINUE","continue",69],";",["T_WHITESPACE","\n                    ",69],"}",["T_WHITESPACE","\n                    ",70],["T_VARIABLE","$tags",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","array_merge",71],"(",["T_VARIABLE","$tags",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$block",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getIdentities",71],"(",")",")",";",["T_WHITESPACE","\n                ",71],"}",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$tags",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","array_unique",74],"(",["T_VARIABLE","$tags",74],")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","response",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","setHeader",75],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Magento-Tags'",75],",",["T_WHITESPACE"," ",75],["T_STRING","implode",75],"(",["T_CONSTANT_ENCAPSED_STRING","','",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$tags",75],")",")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n        ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$result",77],";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n",78],"}",["T_WHITESPACE","\n",79]]