[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Framework",7],["T_NS_SEPARATOR","\\",7],["T_STRING","App",7],["T_NS_SEPARATOR","\\",7],["T_STRING","TemplateTypesInterface",7],";",["T_WHITESPACE","\n\n",7],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",9],["T_WHITESPACE","\n",10],["T_COMMENT","\/* @var $block \\Magento\\Newsletter\\Block\\Adminhtml\\Template\\Edit *\/",11],["T_WHITESPACE","\n\n",11],["T_CLOSE_TAG","?>\n",13],["T_INLINE_HTML","<form action=\"",14],["T_OPEN_TAG","<?php ",14],["T_ECHO","echo",14],["T_WHITESPACE"," ",14],["T_VARIABLE","$block",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","escapeUrl",14],"(",["T_VARIABLE","$block",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","getSaveUrl",14],"(",")",")",["T_WHITESPACE"," ",14],["T_CLOSE_TAG","?>",14],["T_INLINE_HTML","\" method=\"post\" id=\"newsletter_template_edit_form\">\n    ",14],["T_OPEN_TAG","<?php ",15],["T_ECHO","echo",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$block",15],["T_OBJECT_OPERATOR","->",15],["T_STRING","getBlockHtml",15],"(",["T_CONSTANT_ENCAPSED_STRING","'formkey'",15],")",["T_CLOSE_TAG","?>\n",15],["T_INLINE_HTML","    <div class=\"no-display\">\n        <input type=\"hidden\" id=\"change_flag_element\" name=\"_change_type_flag\" value=\"\" \/>\n        <input type=\"hidden\" id=\"save_as_flag\" name=\"_save_as_flag\" value=\"",16],["T_OPEN_TAG","<?php ",18],["T_ECHO","echo",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$block",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","escapeHtmlAttr",18],"(",["T_VARIABLE","$block",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","getSaveAsFlag",18],"(",")",")",["T_WHITESPACE"," ",18],["T_CLOSE_TAG","?>",18],["T_INLINE_HTML","\" \/>\n    <\/div>\n    ",18],["T_OPEN_TAG","<?php ",20],["T_COMMENT","\/* @noEscape *\/",20],["T_WHITESPACE"," ",20],["T_ECHO","echo",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$block",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","getForm",20],"(",")",["T_WHITESPACE"," ",20],["T_CLOSE_TAG","?>\n",20],["T_INLINE_HTML","<\/form>\n<form action=\"",21],["T_OPEN_TAG","<?php ",22],["T_ECHO","echo",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$block",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","escapeUrl",22],"(",["T_VARIABLE","$block",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","getPreviewUrl",22],"(",")",")",["T_WHITESPACE"," ",22],["T_CLOSE_TAG","?>",22],["T_INLINE_HTML","\" method=\"post\" id=\"newsletter_template_preview_form\" target=\"_blank\">\n    ",22],["T_OPEN_TAG","<?php ",23],["T_ECHO","echo",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$block",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","getBlockHtml",23],"(",["T_CONSTANT_ENCAPSED_STRING","'formkey'",23],")",["T_CLOSE_TAG","?>\n",23],["T_INLINE_HTML","    <div class=\"no-display\">\n        <input type=\"hidden\" id=\"preview_type\" name=\"type\" value=\"",24],["T_OPEN_TAG","<?php ",25],["T_COMMENT","\/* @noEscape *\/",25],["T_WHITESPACE"," ",25],["T_ECHO","echo",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$block",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","isTextType",25],"(",")",["T_WHITESPACE"," ",25],"?",["T_WHITESPACE"," ",25],["T_LNUMBER","1",25],["T_WHITESPACE"," ",25],":",["T_WHITESPACE"," ",25],["T_LNUMBER","2",25],["T_WHITESPACE"," ",25],["T_CLOSE_TAG","?>",25],["T_INLINE_HTML","\" \/>\n        <input type=\"hidden\" id=\"preview_text\" name=\"text\" value=\"\" \/>\n        <input type=\"hidden\" id=\"preview_styles\" name=\"styles\" value=\"\" \/>\n        <input type=\"hidden\" id=\"preview_id\" name=\"id\" value=\"\" \/>\n    <\/div>\n<\/form>\n<script>\nrequire([\n    'jquery',\n    'tinymce',\n    'Magento_Ui\/js\/modal\/prompt',\n    'Magento_Ui\/js\/modal\/confirm',\n    'mage\/mage',\n    'prototype'\n], function(jQuery, tinyMCE, prompt, confirm){\n\n\/\/<![CDATA[\n    jQuery('#newsletter_template_edit_form').mage('form').mage('validation');\n    jQuery('#newsletter_template_preview_form').mage('form').mage('validation');\n    templateControl = {\n\n        unconvertedText: '',\n        typeChange: false,\n        templateName: false,\n        id: 'text',\n\n        events: {\n            'click [data-role=template-save]' : 'save',\n            'click [data-role=template-save-as]': 'saveAs',\n            'click [data-role=template-preview]' : 'preview',\n            'click [data-role=template-unstrip]' : 'unStripTags',\n            'click [data-role=template-strip]' : 'stripTags',\n            'click [data-role=template-delete]': 'deleteTemplate'\n        },\n\n        init: function () {\n            if ($('convert_button_back')) {\n                $('convert_button_back').hide();\n            }\n\n            this.bindEvents();\n        },\n\n        bindEvents: function(){\n            var events = this.events,\n                eventName,\n                selector,\n                callback,\n                key;\n\n            for( key in events ){\n                callback    = this[events[key]];\n                key         = key.split(' ');\n\n                eventName   = key[0];\n                selector    = key.slice(1).join(' ');\n\n                jQuery(selector).on(eventName, jQuery.proxy(callback, this) );\n            }\n        },\n\n        stripTags: function () {\n            var self = this;\n\n            confirm({\n                content: \"",25],["T_OPEN_TAG","<?php ",90],["T_ECHO","echo",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$block",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","escapeJs",90],"(",["T_VARIABLE","$block",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","escapeHtml",90],"(",["T_STRING","__",90],"(",["T_CONSTANT_ENCAPSED_STRING","'Are you sure that you want to strip all tags?'",90],")",")",")",["T_WHITESPACE"," ",90],["T_CLOSE_TAG","?>",90],["T_INLINE_HTML","\",\n                actions: {\n                    confirm: function(){\n                        if(self.isEditor()) {\n                            self.getEditor().turnOff();\n                            self.getEditor().getToggleButton().hide();\n                        }\n                        self.unconvertedText = $(self.id).value;\n                        $('convert_button').hide();\n                        $('convert_button_back').show();\n                        $(self.id).value =  $(self.id).value.stripScripts().stripTags();\n                        $('field_template_styles').hide();\n                        self.typeChange = true;\n                    }\n                }\n            });\n\n        },\n\n        unStripTags: function () {\n            $('convert_button').show();\n            $('convert_button_back').hide();\n            $(this.id).value =  this.unconvertedText;\n            if(this.isEditor()) {\n                this.getEditor().turnOn();\n                this.getEditor().getToggleButton().show();\n            }\n            this.typeChange = false;\n            $('field_template_styles').show();\n            return false;\n        },\n\n        save: function() {\n            if (this.typeChange) {\n                $('change_flag_element').value = '1';\n            }\n            if(this.isEditor()) {\n                tinyMCE.triggerSave();\n            }\n            \/\/ Temporary solution will be replaced after refactoring of newsletter functionality\n            jQuery('#newsletter_template_edit_form').triggerHandler('save');\n            return false;\n        },\n\n        saveAs: function() {\n            var self = this;\n\n            if (this.typeChange) {\n                $('change_flag_element').value = '1';\n            }\n\n            if($F('code').blank() || $F('code')==templateControl.templateName) {\n\n                prompt({\n                    content: '",90],["T_OPEN_TAG","<?php ",144],["T_ECHO","echo",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$block",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","escapeJs",144],"(",["T_VARIABLE","$block",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","escapeHtml",144],"(",["T_STRING","__",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Please enter a new template name.'",144],")",")",")",["T_WHITESPACE"," ",144],["T_CLOSE_TAG","?>",144],["T_INLINE_HTML","',\n                    value: templateControl.templateName + '",144],["T_OPEN_TAG","<?php ",145],["T_ECHO","echo",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$block",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","escapeJs",145],"(",["T_STRING","__",145],"(",["T_CONSTANT_ENCAPSED_STRING","' Copy'",145],")",")",["T_WHITESPACE"," ",145],["T_CLOSE_TAG","?>",145],["T_INLINE_HTML","',\n                    actions: {\n                        confirm: function(value) {\n                            $('code').value = value;\n                            self._saveAs();\n\n                            return false;\n                        },\n                        cancel: function(){\n                            $('code').value = '';\n                            \/\/ Temporary solution will be replaced after refactoring of newsletter functionality\n                            jQuery('#newsletter_template_edit_form').triggerHandler('save');\n                            self._saveAs();\n\n                            return false;\n                        }\n                    }\n                });\n            }\n        },\n\n        _saveAs: function() {\n            $('save_as_flag').value = '1';\n\n            if(this.isEditor()) {\n                tinyMCE.triggerSave();\n            }\n            \/\/ Temporary solution will be replaced after refactoring of newsletter functionality\n            jQuery('#newsletter_template_edit_form').triggerHandler('save');\n            return false;\n        },\n\n        preview: function() {\n            if (this.typeChange) {\n                $('preview_type').value = ",145],["T_OPEN_TAG","<?php ",179],["T_ECHO","echo",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$block",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","escapeJs",179],"(",["T_STRING","TemplateTypesInterface",179],["T_DOUBLE_COLON","::",179],["T_STRING","TYPE_TEXT",179],")",["T_WHITESPACE"," ",179],["T_CLOSE_TAG","?>",179],["T_INLINE_HTML",";\n            } else {\n                $('preview_type').value = ",179],["T_OPEN_TAG","<?php ",181],["T_ECHO","echo",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$block",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","escapeJs",181],"(",["T_VARIABLE","$block",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getTemplateType",181],"(",")",")",["T_WHITESPACE"," ",181],["T_CLOSE_TAG","?>",181],["T_INLINE_HTML",";\n            }\n            if (this.isEditor() && tinyMCE.get(this.id)) {\n                tinyMCE.triggerSave();\n                $('preview_text').value = tinyMCE.get(this.id).getContent();\n                tinyMCE.triggerSave();\n            } else {\n                $('preview_text').value = $(this.id).value;\n            }\n            if ($('template_styles') != undefined) {\n                $('preview_styles').value = $('template_styles').value;\n            }\n            if ($('id') != undefined) {\n                $('preview_id').value = $('id').value;\n            }\n            \/\/ Temporary solution will be replaced after refactoring of newsletter functionality\n            jQuery('#newsletter_template_preview_form').triggerHandler('save');\n            return false;\n        },\n\n        deleteTemplate: function() {\n            confirm({\n                content: \"",181],["T_OPEN_TAG","<?php ",203],["T_ECHO","echo",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$block",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","escapeJs",203],"(",["T_VARIABLE","$block",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","escapeHtml",203],"(",["T_STRING","__",203],"(",["T_CONSTANT_ENCAPSED_STRING","'Are you sure you want to delete this template?'",203],")",")",")",["T_WHITESPACE"," ",203],["T_CLOSE_TAG","?>",203],["T_INLINE_HTML","\",\n                actions: {\n                    confirm: function() {\n                        window.location.href = '",203],["T_OPEN_TAG","<?php ",206],["T_ECHO","echo",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$block",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","escapeUrl",206],"(",["T_VARIABLE","$block",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getDeleteUrl",206],"(",")",")",["T_WHITESPACE"," ",206],["T_CLOSE_TAG","?>",206],["T_INLINE_HTML","';\n                    }\n                }\n            });\n        },\n\n        isEditor: function() {\n            return (typeof tinyMceEditors != 'undefined' && tinyMceEditors.get(this.id) != undefined)\n        },\n\n        getEditor: function() {\n            return tinyMceEditors.get(this.id);\n        }\n    };\n\n    templateControl.init();\n    templateControl.templateName = \"",206],["T_OPEN_TAG","<?php ",222],["T_ECHO","echo",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$block",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","escapeJs",222],"(",["T_VARIABLE","$block",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getJsTemplateName",222],"(",")",")",["T_WHITESPACE"," ",222],["T_CLOSE_TAG","?>",222],["T_INLINE_HTML","\";\n\/\/]]>\n\n});\n<\/script>\n",222]]