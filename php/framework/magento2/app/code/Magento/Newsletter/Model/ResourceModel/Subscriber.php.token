[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Newsletter",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Newsletter subscriber resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Subscriber",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceModel",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Db",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractDb",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * DB connection\n     *\n     * @var \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$connection",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * Name of subscriber link DB table\n     *\n     * @var string\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$_subscriberLinkTable",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Name of scope for error messages\n     *\n     * @var string\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_messagesScope",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'newsletter\/session'",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Date\n     *\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\DateTime\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_date",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Math\\Random\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$mathRandom",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Construct\n     *\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $date\n     * @param \\Magento\\Framework\\Math\\Random $mathRandom\n     * @param string $connectionName\n     *\/",48],["T_WHITESPACE","\n    ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","__construct",56],"(",["T_WHITESPACE","\n        ",56],["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Framework",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Model",57],["T_NS_SEPARATOR","\\",57],["T_STRING","ResourceModel",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Db",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Context",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$context",57],",",["T_WHITESPACE","\n        ",57],["T_NS_SEPARATOR","\\",58],["T_STRING","Magento",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Framework",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Stdlib",58],["T_NS_SEPARATOR","\\",58],["T_STRING","DateTime",58],["T_NS_SEPARATOR","\\",58],["T_STRING","DateTime",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$date",58],",",["T_WHITESPACE","\n        ",58],["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Framework",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Math",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Random",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$mathRandom",59],",",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$connectionName",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","null",60],["T_WHITESPACE","\n    ",60],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_date",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$date",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","mathRandom",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$mathRandom",63],";",["T_WHITESPACE","\n        ",63],["T_STRING","parent",64],["T_DOUBLE_COLON","::",64],["T_STRING","__construct",64],"(",["T_VARIABLE","$context",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$connectionName",64],")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Initialize resource model\n     * Get tablename from config\n     *\n     * @return void\n     *\/",67],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","_construct",73],"(",")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_init",75],"(",["T_CONSTANT_ENCAPSED_STRING","'newsletter_subscriber'",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'subscriber_id'",75],")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_subscriberLinkTable",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getTable",76],"(",["T_CONSTANT_ENCAPSED_STRING","'newsletter_queue_link'",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","connection",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getConnection",77],"(",")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * Set error messages scope\n     *\n     * @param string $scope\n     * @return void\n     *\/",80],["T_WHITESPACE","\n    ",85],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","setMessagesScope",86],"(",["T_VARIABLE","$scope",86],")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_messagesScope",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$scope",88],";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Load subscriber from DB by email\n     *\n     * @param string $subscriberEmail\n     * @return array\n     *\/",91],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","loadByEmail",97],"(",["T_VARIABLE","$subscriberEmail",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$select",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","connection",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","select",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","from",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getMainTable",99],"(",")",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","where",99],"(",["T_CONSTANT_ENCAPSED_STRING","'subscriber_email=:subscriber_email'",99],")",";",["T_WHITESPACE","\n\n        ",99],["T_VARIABLE","$result",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","connection",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","fetchRow",101],"(",["T_VARIABLE","$select",101],",",["T_WHITESPACE"," ",101],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber_email'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$subscriberEmail",101],"]",")",";",["T_WHITESPACE","\n\n        ",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!",["T_VARIABLE","$result",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_RETURN","return",104],["T_WHITESPACE"," ",104],"[","]",";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$result",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Load subscriber by customer\n     *\n     * @param \\Magento\\Customer\\Api\\Data\\CustomerInterface $customer\n     * @return array\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","loadByCustomerData",116],"(",["T_NS_SEPARATOR","\\",116],["T_STRING","Magento",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Customer",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Api",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Data",116],["T_NS_SEPARATOR","\\",116],["T_STRING","CustomerInterface",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$customer",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$select",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","connection",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","select",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","from",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getMainTable",118],"(",")",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","where",118],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id=:customer_id'",118],")",";",["T_WHITESPACE","\n\n        ",118],["T_VARIABLE","$result",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","connection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","fetchRow",120],"(",["T_VARIABLE","$select",120],",",["T_WHITESPACE"," ",120],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$customer",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getId",120],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",120],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$result",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$result",123],";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_VARIABLE","$select",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","connection",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","select",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","from",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getMainTable",126],"(",")",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","where",126],"(",["T_CONSTANT_ENCAPSED_STRING","'subscriber_email=:subscriber_email'",126],")",";",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$result",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","connection",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","fetchRow",128],"(",["T_VARIABLE","$select",128],",",["T_WHITESPACE"," ",128],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber_email'",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$customer",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getEmail",128],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",128],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$result",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$result",131],";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],"[","]",";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Generates random code for subscription confirmation\n     *\n     * @return string\n     *\/",137],["T_WHITESPACE","\n    ",141],["T_PROTECTED","protected",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","_generateRandomCode",142],"(",")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","mathRandom",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getUniqueHash",144],"(",")",";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Updates data when subscriber received\n     *\n     * @param \\Magento\\Newsletter\\Model\\Subscriber $subscriber\n     * @param \\Magento\\Newsletter\\Model\\Queue $queue\n     * @return $this\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",147],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","received",155],"(",["T_NS_SEPARATOR","\\",155],["T_STRING","Magento",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Newsletter",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Model",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Subscriber",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$subscriber",155],",",["T_WHITESPACE"," ",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Magento",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Newsletter",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Model",155],["T_NS_SEPARATOR","\\",155],["T_STRING","Queue",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$queue",155],")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","connection",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","beginTransaction",157],"(",")",";",["T_WHITESPACE","\n        ",157],["T_TRY","try",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$data",159],"[",["T_CONSTANT_ENCAPSED_STRING","'letter_sent_at'",159],"]",["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_date",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","gmtDate",159],"(",")",";",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","connection",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","update",160],"(",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_subscriberLinkTable",161],",",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$data",162],",",["T_WHITESPACE","\n                ",162],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber_id = ?'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$subscriber",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getId",163],"(",")",",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'queue_id = ?'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$queue",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getId",163],"(",")","]",["T_WHITESPACE","\n            ",163],")",";",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","connection",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","commit",165],"(",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE"," ",166],["T_CATCH","catch",166],["T_WHITESPACE"," ",166],"(",["T_NS_SEPARATOR","\\",166],["T_STRING","Exception",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$e",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","connection",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","rollBack",167],"(",")",";",["T_WHITESPACE","\n            ",167],["T_THROW","throw",168],["T_WHITESPACE"," ",168],["T_NEW","new",168],["T_WHITESPACE"," ",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Magento",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Framework",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Exception",168],["T_NS_SEPARATOR","\\",168],["T_STRING","LocalizedException",168],"(",["T_STRING","__",168],"(",["T_CONSTANT_ENCAPSED_STRING","'We cannot mark as received subscriber.'",168],")",")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n        ",169],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n",171],"}",["T_WHITESPACE","\n",172]]