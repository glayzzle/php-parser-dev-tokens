[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Report Products Review collection\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Reports",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Review",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Product",12],";",["T_WHITESPACE","\n\n",12],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Collection",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Catalog",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Product",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Collection",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Init Select\n     *\n     * @return \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Collection\n     *\/",16],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_FUNCTION","function",21],["T_WHITESPACE"," ",21],["T_STRING","_initSelect",21],"(",")",["T_WHITESPACE","\n    ",21],"{",["T_WHITESPACE","\n        ",22],["T_STRING","parent",23],["T_DOUBLE_COLON","::",23],["T_STRING","_initSelect",23],"(",")",";",["T_WHITESPACE","\n        ",23],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","_joinReview",24],"(",")",";",["T_WHITESPACE","\n        ",24],["T_RETURN","return",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$this",25],";",["T_WHITESPACE","\n    ",25],"}",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Join review table to result\n     *\n     * @return $this\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","_joinReview",33],"(",")",["T_WHITESPACE","\n    ",33],"{",["T_WHITESPACE","\n        ",34],["T_VARIABLE","$subSelect",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_CLONE","clone",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getSelect",35],"(",")",";",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$subSelect",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","reset",36],"(",")",["T_OBJECT_OPERATOR","->",36],["T_STRING","from",36],"(",["T_WHITESPACE","\n            ",36],"[",["T_CONSTANT_ENCAPSED_STRING","'rev'",37],["T_WHITESPACE"," ",37],["T_DOUBLE_ARROW","=>",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","getTable",37],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",37],")","]",",",["T_WHITESPACE","\n            ",37],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT rev.review_id)'",38],["T_WHITESPACE","\n        ",38],")",["T_OBJECT_OPERATOR","->",39],["T_STRING","where",39],"(",["T_WHITESPACE","\n            ",39],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = rev.entity_pk_value'",40],["T_WHITESPACE","\n        ",40],")",";",["T_WHITESPACE","\n\n        ",41],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","addAttributeToSelect",43],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",43],")",";",["T_WHITESPACE","\n\n        ",43],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getSelect",45],"(",")",["T_OBJECT_OPERATOR","->",45],["T_STRING","join",45],"(",["T_WHITESPACE","\n            ",45],"[",["T_CONSTANT_ENCAPSED_STRING","'r'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getTable",46],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",46],")","]",",",["T_WHITESPACE","\n            ",46],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = r.entity_pk_value'",47],",",["T_WHITESPACE","\n            ",47],"[",["T_WHITESPACE","\n                ",48],["T_CONSTANT_ENCAPSED_STRING","'review_cnt'",49],["T_WHITESPACE"," ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_NEW","new",49],["T_WHITESPACE"," ",49],["T_NS_SEPARATOR","\\",49],["T_STRING","Zend_Db_Expr",49],"(",["T_STRING","sprintf",49],"(",["T_CONSTANT_ENCAPSED_STRING","'(%s)'",49],",",["T_WHITESPACE"," ",49],["T_VARIABLE","$subSelect",49],")",")",",",["T_WHITESPACE","\n                ",49],["T_CONSTANT_ENCAPSED_STRING","'created_at'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'MAX(r.created_at)'",50],["T_WHITESPACE","\n            ",50],"]",["T_WHITESPACE","\n        ",51],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","group",52],"(",["T_WHITESPACE","\n            ",52],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",53],["T_WHITESPACE","\n        ",53],")",";",["T_WHITESPACE","\n\n        ",54],["T_VARIABLE","$joinCondition",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],"[",["T_WHITESPACE","\n            ",56],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = table_rating.entity_pk_value'",57],",",["T_WHITESPACE","\n            ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getConnection",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","quoteInto",58],"(",["T_CONSTANT_ENCAPSED_STRING","'table_rating.store_id > ?'",58],",",["T_WHITESPACE"," ",58],["T_LNUMBER","0",58],")",",",["T_WHITESPACE","\n        ",58],"]",";",["T_WHITESPACE","\n\n        ",59],["T_VARIABLE","$sumPercentField",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_NEW","new",61],["T_WHITESPACE"," ",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Zend_Db_Expr",61],"(",["T_CONSTANT_ENCAPSED_STRING","\"SUM(table_rating.percent)\"",61],")",";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$sumPercentApproved",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_NEW","new",62],["T_WHITESPACE"," ",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Zend_Db_Expr",62],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(table_rating.percent_approved)'",62],")",";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$countRatingId",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_NEW","new",63],["T_WHITESPACE"," ",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Zend_Db_Expr",63],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(table_rating.rating_id)'",63],")",";",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getSelect",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","joinLeft",65],"(",["T_WHITESPACE","\n            ",65],"[",["T_CONSTANT_ENCAPSED_STRING","'table_rating'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getTable",66],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote_aggregated'",66],")","]",",",["T_WHITESPACE","\n            ",66],["T_STRING","implode",67],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$joinCondition",67],")",",",["T_WHITESPACE","\n            ",67],"[",["T_WHITESPACE","\n                ",68],["T_CONSTANT_ENCAPSED_STRING","'avg_rating'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_NEW","new",69],["T_WHITESPACE"," ",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Zend_Db_Expr",69],"(",["T_STRING","sprintf",69],"(",["T_CONSTANT_ENCAPSED_STRING","'%s\/%s'",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$sumPercentField",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$countRatingId",69],")",")",",",["T_WHITESPACE","\n                ",69],["T_CONSTANT_ENCAPSED_STRING","'avg_rating_approved'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_NEW","new",70],["T_WHITESPACE"," ",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Zend_Db_Expr",70],"(",["T_STRING","sprintf",70],"(",["T_CONSTANT_ENCAPSED_STRING","'%s\/%s'",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$sumPercentApproved",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$countRatingId",70],")",")",["T_WHITESPACE","\n            ",70],"]",["T_WHITESPACE","\n        ",71],")",";",["T_WHITESPACE","\n\n        ",72],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Add attribute to sort\n     *\n     * @param string $attribute\n     * @param string $dir\n     * @return $this|\\Magento\\Catalog\\Model\\ResourceModel\\Product\\Collection\n     *\/",77],["T_WHITESPACE","\n    ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","addAttributeToSort",84],"(",["T_VARIABLE","$attribute",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$dir",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","self",84],["T_DOUBLE_COLON","::",84],["T_STRING","SORT_ORDER_ASC",84],")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_STRING","in_array",86],"(",["T_VARIABLE","$attribute",86],",",["T_WHITESPACE"," ",86],"[",["T_CONSTANT_ENCAPSED_STRING","'review_cnt'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'created_at'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'avg_rating'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'avg_rating_approved'",86],"]",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getSelect",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","order",87],"(",["T_VARIABLE","$attribute",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","' '",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_VARIABLE","$dir",87],")",";",["T_WHITESPACE","\n            ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_RETURN","return",91],["T_WHITESPACE"," ",91],["T_STRING","parent",91],["T_DOUBLE_COLON","::",91],["T_STRING","addAttributeToSort",91],"(",["T_VARIABLE","$attribute",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$dir",91],")",";",["T_WHITESPACE","\n    ",91],"}",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Get select count sql\n     *\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",94],["T_WHITESPACE","\n    ",98],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","getSelectCountSql",99],"(",")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_renderFilters",101],"(",")",";",["T_WHITESPACE","\n\n        ",101],["T_COMMENT","\/* @var \\Magento\\Framework\\DB\\Select $select *\/",103],["T_WHITESPACE","\n        ",103],["T_VARIABLE","$select",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_CLONE","clone",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getSelect",104],"(",")",";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$select",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","reset",105],"(",["T_NS_SEPARATOR","\\",105],["T_STRING","Magento",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Framework",105],["T_NS_SEPARATOR","\\",105],["T_STRING","DB",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Select",105],["T_DOUBLE_COLON","::",105],["T_STRING","ORDER",105],")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$select",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","reset",106],"(",["T_NS_SEPARATOR","\\",106],["T_STRING","Magento",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Framework",106],["T_NS_SEPARATOR","\\",106],["T_STRING","DB",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Select",106],["T_DOUBLE_COLON","::",106],["T_STRING","LIMIT_COUNT",106],")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$select",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","reset",107],"(",["T_NS_SEPARATOR","\\",107],["T_STRING","Magento",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Framework",107],["T_NS_SEPARATOR","\\",107],["T_STRING","DB",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Select",107],["T_DOUBLE_COLON","::",107],["T_STRING","LIMIT_OFFSET",107],")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$select",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","reset",108],"(",["T_NS_SEPARATOR","\\",108],["T_STRING","Magento",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Framework",108],["T_NS_SEPARATOR","\\",108],["T_STRING","DB",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Select",108],["T_DOUBLE_COLON","::",108],["T_STRING","COLUMNS",108],")",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$select",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","resetJoinLeft",109],"(",")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$select",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","columns",110],"(",["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Zend_Db_Expr",110],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",110],")",")",";",["T_WHITESPACE","\n\n        ",110],["T_COMMENT","\/* @var \\Magento\\Framework\\DB\\Select $countSelect *\/",112],["T_WHITESPACE","\n        ",112],["T_VARIABLE","$countSelect",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_CLONE","clone",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$select",113],";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$countSelect",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","reset",114],"(",")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$countSelect",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","from",115],"(",["T_VARIABLE","$select",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","\"COUNT(*)\"",115],")",";",["T_WHITESPACE","\n\n        ",115],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$countSelect",117],";",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n",118],"}",["T_WHITESPACE","\n",119]]