[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Most viewed product report aggregate resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Reports",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Report",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Product",12],";",["T_WHITESPACE","\n\n",12],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Viewed",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Sales",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Report",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractReport",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Aggregation key daily\n     *\/",16],["T_WHITESPACE","\n    ",18],["T_CONST","const",19],["T_WHITESPACE"," ",19],["T_STRING","AGGREGATION_DAILY",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_CONSTANT_ENCAPSED_STRING","'report_viewed_product_aggregated_daily'",19],";",["T_WHITESPACE","\n\n    ",19],["T_DOC_COMMENT","\/**\n     * Aggregation key monthly\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","AGGREGATION_MONTHLY",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'report_viewed_product_aggregated_monthly'",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * Aggregation key yearly\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_CONST","const",29],["T_WHITESPACE"," ",29],["T_STRING","AGGREGATION_YEARLY",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'report_viewed_product_aggregated_yearly'",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Product resource instance\n     *\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Product\n     *\/",31],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_productResource",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Resource helper instance\n     *\n     * @var \\Magento\\Reports\\Model\\ResourceModel\\Helper\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_resourceHelper",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Psr\\Log\\LoggerInterface $logger\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface $localeDate\n     * @param \\Magento\\Reports\\Model\\FlagFactory $reportsFlagFactory\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\Timezone\\Validator $timezoneValidator\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $dateTime\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Product $productResource\n     * @param \\Magento\\Reports\\Model\\ResourceModel\\Helper $resourceHelper\n     * @param string $connectionName\n     *\/",45],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","__construct",58],"(",["T_WHITESPACE","\n        ",58],["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Framework",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Model",59],["T_NS_SEPARATOR","\\",59],["T_STRING","ResourceModel",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Db",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Context",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$context",59],",",["T_WHITESPACE","\n        ",59],["T_NS_SEPARATOR","\\",60],["T_STRING","Psr",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Log",60],["T_NS_SEPARATOR","\\",60],["T_STRING","LoggerInterface",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$logger",60],",",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Magento",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Framework",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Stdlib",61],["T_NS_SEPARATOR","\\",61],["T_STRING","DateTime",61],["T_NS_SEPARATOR","\\",61],["T_STRING","TimezoneInterface",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$localeDate",61],",",["T_WHITESPACE","\n        ",61],["T_NS_SEPARATOR","\\",62],["T_STRING","Magento",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Reports",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Model",62],["T_NS_SEPARATOR","\\",62],["T_STRING","FlagFactory",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$reportsFlagFactory",62],",",["T_WHITESPACE","\n        ",62],["T_NS_SEPARATOR","\\",63],["T_STRING","Magento",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Framework",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Stdlib",63],["T_NS_SEPARATOR","\\",63],["T_STRING","DateTime",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Timezone",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Validator",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$timezoneValidator",63],",",["T_WHITESPACE","\n        ",63],["T_NS_SEPARATOR","\\",64],["T_STRING","Magento",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Framework",64],["T_NS_SEPARATOR","\\",64],["T_STRING","Stdlib",64],["T_NS_SEPARATOR","\\",64],["T_STRING","DateTime",64],["T_NS_SEPARATOR","\\",64],["T_STRING","DateTime",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$dateTime",64],",",["T_WHITESPACE","\n        ",64],["T_NS_SEPARATOR","\\",65],["T_STRING","Magento",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Catalog",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Model",65],["T_NS_SEPARATOR","\\",65],["T_STRING","ResourceModel",65],["T_NS_SEPARATOR","\\",65],["T_STRING","Product",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$productResource",65],",",["T_WHITESPACE","\n        ",65],["T_NS_SEPARATOR","\\",66],["T_STRING","Magento",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Reports",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Model",66],["T_NS_SEPARATOR","\\",66],["T_STRING","ResourceModel",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Helper",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$resourceHelper",66],",",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$connectionName",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","null",67],["T_WHITESPACE","\n    ",67],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n        ",68],["T_STRING","parent",69],["T_DOUBLE_COLON","::",69],["T_STRING","__construct",69],"(",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$context",70],",",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$logger",71],",",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$localeDate",72],",",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$reportsFlagFactory",73],",",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$timezoneValidator",74],",",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$dateTime",75],",",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$connectionName",76],["T_WHITESPACE","\n        ",76],")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_productResource",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$productResource",78],";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_resourceHelper",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$resourceHelper",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     * @return void\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_construct",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_init",89],"(",["T_STRING","self",89],["T_DOUBLE_COLON","::",89],["T_STRING","AGGREGATION_DAILY",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'id'",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Aggregate products view data\n     *\n     * @param null|mixed $from\n     * @param null|mixed $to\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",92],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","aggregate",100],"(",["T_VARIABLE","$from",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","null",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$to",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","null",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$mainTable",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getMainTable",102],"(",")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$connection",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getConnection",103],"(",")",";",["T_WHITESPACE","\n\n        ",103],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_VARIABLE","$from",105],["T_WHITESPACE"," ",105],["T_IS_NOT_IDENTICAL","!==",105],["T_WHITESPACE"," ",105],["T_STRING","null",105],["T_WHITESPACE"," ",105],["T_BOOLEAN_OR","||",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$to",105],["T_WHITESPACE"," ",105],["T_IS_NOT_IDENTICAL","!==",105],["T_WHITESPACE"," ",105],["T_STRING","null",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$subSelect",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_getTableDateRangeSelect",106],"(",["T_WHITESPACE","\n                ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getTable",107],"(",["T_CONSTANT_ENCAPSED_STRING","'report_event'",107],")",",",["T_WHITESPACE","\n                ",107],["T_CONSTANT_ENCAPSED_STRING","'logged_at'",108],",",["T_WHITESPACE","\n                ",108],["T_CONSTANT_ENCAPSED_STRING","'logged_at'",109],",",["T_WHITESPACE","\n                ",109],["T_VARIABLE","$from",110],",",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$to",111],["T_WHITESPACE","\n            ",111],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE"," ",113],["T_ELSE","else",113],["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$subSelect",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","null",114],";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_clearTableByDateRange",116],"(",["T_VARIABLE","$mainTable",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$from",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$to",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$subSelect",116],")",";",["T_WHITESPACE","\n        ",116],["T_COMMENT","\/\/ convert dates to current admin timezone\n",117],["T_WHITESPACE","        ",118],["T_VARIABLE","$periodExpr",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$connection",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getDatePartSql",118],"(",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getStoreTZOffsetQuery",119],"(",["T_WHITESPACE","\n                ",119],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getTable",120],"(",["T_CONSTANT_ENCAPSED_STRING","'report_event'",120],")","]",",",["T_WHITESPACE","\n                ",120],["T_CONSTANT_ENCAPSED_STRING","'source_table.logged_at'",121],",",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$from",122],",",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$to",123],["T_WHITESPACE","\n            ",123],")",["T_WHITESPACE","\n        ",124],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$select",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$connection",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","select",126],"(",")",";",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$select",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","group",128],"(","[",["T_VARIABLE","$periodExpr",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'source_table.object_id'",128],"]",")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$viewsNumExpr",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_NEW","new",130],["T_WHITESPACE"," ",130],["T_NS_SEPARATOR","\\",130],["T_STRING","Zend_Db_Expr",130],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(source_table.event_id)'",130],")",";",["T_WHITESPACE","\n\n        ",130],["T_VARIABLE","$columns",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],"[",["T_WHITESPACE","\n            ",132],["T_CONSTANT_ENCAPSED_STRING","'period'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$periodExpr",133],",",["T_WHITESPACE","\n            ",133],["T_CONSTANT_ENCAPSED_STRING","'store_id'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",134],",",["T_WHITESPACE","\n            ",134],["T_CONSTANT_ENCAPSED_STRING","'product_id'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'source_table.object_id'",135],",",["T_WHITESPACE","\n            ",135],["T_CONSTANT_ENCAPSED_STRING","'product_name'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_NEW","new",136],["T_WHITESPACE"," ",136],["T_NS_SEPARATOR","\\",136],["T_STRING","Zend_Db_Expr",136],"(",["T_WHITESPACE","\n                ",136],["T_STRING","sprintf",137],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$connection",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getIfNullSql",137],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.value'",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.value'",137],")",")",["T_WHITESPACE","\n            ",137],")",",",["T_WHITESPACE","\n            ",138],["T_CONSTANT_ENCAPSED_STRING","'product_price'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_NEW","new",139],["T_WHITESPACE"," ",139],["T_NS_SEPARATOR","\\",139],["T_STRING","Zend_Db_Expr",139],"(",["T_WHITESPACE","\n                ",139],["T_STRING","sprintf",140],"(",["T_WHITESPACE","\n                    ",140],["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",141],",",["T_WHITESPACE","\n                    ",141],["T_VARIABLE","$connection",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getIfNullSql",142],"(",["T_WHITESPACE","\n                        ",142],["T_VARIABLE","$connection",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getIfNullSql",143],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.value'",143],",",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.value'",143],")",",",["T_WHITESPACE","\n                        ",143],["T_LNUMBER","0",144],["T_WHITESPACE","\n                    ",144],")",["T_WHITESPACE","\n                ",145],")",["T_WHITESPACE","\n            ",146],")",",",["T_WHITESPACE","\n            ",147],["T_CONSTANT_ENCAPSED_STRING","'views_num'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$viewsNumExpr",148],",",["T_WHITESPACE","\n        ",148],"]",";",["T_WHITESPACE","\n\n        ",149],["T_VARIABLE","$select",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","from",151],"(",["T_WHITESPACE","\n            ",151],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getTable",152],"(",["T_CONSTANT_ENCAPSED_STRING","'report_event'",152],")","]",",",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$columns",153],["T_WHITESPACE","\n        ",153],")",["T_OBJECT_OPERATOR","->",154],["T_STRING","where",154],"(",["T_WHITESPACE","\n            ",154],["T_CONSTANT_ENCAPSED_STRING","'source_table.event_type_id = ?'",155],",",["T_WHITESPACE","\n            ",155],["T_NS_SEPARATOR","\\",156],["T_STRING","Magento",156],["T_NS_SEPARATOR","\\",156],["T_STRING","Reports",156],["T_NS_SEPARATOR","\\",156],["T_STRING","Model",156],["T_NS_SEPARATOR","\\",156],["T_STRING","Event",156],["T_DOUBLE_COLON","::",156],["T_STRING","EVENT_PRODUCT_VIEW",156],["T_WHITESPACE","\n        ",156],")",";",["T_WHITESPACE","\n\n        ",157],["T_VARIABLE","$productLinkField",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_productResource",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getLinkField",159],"(",")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$select",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","joinInner",160],"(",["T_WHITESPACE","\n            ",160],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",161],["T_WHITESPACE"," ",161],["T_DOUBLE_ARROW","=>",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getTable",161],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",161],")","]",",",["T_WHITESPACE","\n            ",161],["T_CONSTANT_ENCAPSED_STRING","'product.entity_id = source_table.object_id'",162],",",["T_WHITESPACE","\n            ",162],"[","]",["T_WHITESPACE","\n        ",163],")",";",["T_WHITESPACE","\n\n        ",164],["T_COMMENT","\/\/ join product attributes Name & Price\n",166],["T_WHITESPACE","        ",167],["T_VARIABLE","$nameAttribute",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","_productResource",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getAttribute",167],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",167],")",";",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$joinExprProductName",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],"[",["T_WHITESPACE","\n            ",168],"\"",["T_ENCAPSED_AND_WHITESPACE","product_name.",169],["T_CURLY_OPEN","{",169],["T_VARIABLE","$productLinkField",169],"}",["T_ENCAPSED_AND_WHITESPACE"," = product.",169],["T_CURLY_OPEN","{",169],["T_VARIABLE","$productLinkField",169],"}","\"",",",["T_WHITESPACE","\n            ",169],["T_CONSTANT_ENCAPSED_STRING","'product_name.store_id = source_table.store_id'",170],",",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$connection",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","quoteInto",171],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.attribute_id = ?'",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$nameAttribute",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getAttributeId",171],"(",")",")",",",["T_WHITESPACE","\n        ",171],"]",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$joinExprProductName",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","implode",173],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$joinExprProductName",173],")",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$joinProductName",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],"[",["T_WHITESPACE","\n            ",174],"\"",["T_ENCAPSED_AND_WHITESPACE","product_default_name.",175],["T_CURLY_OPEN","{",175],["T_VARIABLE","$productLinkField",175],"}",["T_ENCAPSED_AND_WHITESPACE"," = product.",175],["T_CURLY_OPEN","{",175],["T_VARIABLE","$productLinkField",175],"}","\"",",",["T_WHITESPACE","\n            ",175],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.store_id = 0'",176],",",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$connection",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","quoteInto",177],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.attribute_id = ?'",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$nameAttribute",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getAttributeId",177],"(",")",")",",",["T_WHITESPACE","\n        ",177],"]",";",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$joinProductName",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","implode",179],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$joinProductName",179],")",";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$select",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","joinLeft",180],"(",["T_WHITESPACE","\n            ",180],"[",["T_CONSTANT_ENCAPSED_STRING","'product_name'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$nameAttribute",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getBackend",181],"(",")",["T_OBJECT_OPERATOR","->",181],["T_STRING","getTable",181],"(",")","]",",",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$joinExprProductName",182],",",["T_WHITESPACE","\n            ",182],"[","]",["T_WHITESPACE","\n        ",183],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","joinLeft",184],"(",["T_WHITESPACE","\n            ",184],"[",["T_CONSTANT_ENCAPSED_STRING","'product_default_name'",185],["T_WHITESPACE"," ",185],["T_DOUBLE_ARROW","=>",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$nameAttribute",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getBackend",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","getTable",185],"(",")","]",",",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$joinProductName",186],",",["T_WHITESPACE","\n            ",186],"[","]",["T_WHITESPACE","\n        ",187],")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$priceAttribute",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_productResource",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getAttribute",189],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",189],")",";",["T_WHITESPACE","\n        ",189],["T_VARIABLE","$joinExprProductPrice",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],"[",["T_WHITESPACE","\n            ",190],"\"",["T_ENCAPSED_AND_WHITESPACE","product_price.",191],["T_CURLY_OPEN","{",191],["T_VARIABLE","$productLinkField",191],"}",["T_ENCAPSED_AND_WHITESPACE"," = product.",191],["T_CURLY_OPEN","{",191],["T_VARIABLE","$productLinkField",191],"}","\"",",",["T_WHITESPACE","\n            ",191],["T_CONSTANT_ENCAPSED_STRING","'product_price.store_id = source_table.store_id'",192],",",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$connection",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","quoteInto",193],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.attribute_id = ?'",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$priceAttribute",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getAttributeId",193],"(",")",")",",",["T_WHITESPACE","\n        ",193],"]",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$joinExprProductPrice",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_STRING","implode",195],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$joinExprProductPrice",195],")",";",["T_WHITESPACE","\n\n        ",195],["T_VARIABLE","$joinProductPrice",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],"[",["T_WHITESPACE","\n            ",197],"\"",["T_ENCAPSED_AND_WHITESPACE","product_default_price.",198],["T_CURLY_OPEN","{",198],["T_VARIABLE","$productLinkField",198],"}",["T_ENCAPSED_AND_WHITESPACE"," = product.",198],["T_CURLY_OPEN","{",198],["T_VARIABLE","$productLinkField",198],"}","\"",",",["T_WHITESPACE","\n            ",198],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.store_id = 0'",199],",",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$connection",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","quoteInto",200],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.attribute_id = ?'",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$priceAttribute",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getAttributeId",200],"(",")",")",",",["T_WHITESPACE","\n        ",200],"]",";",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$joinProductPrice",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","implode",202],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$joinProductPrice",202],")",";",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$select",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","joinLeft",203],"(",["T_WHITESPACE","\n            ",203],"[",["T_CONSTANT_ENCAPSED_STRING","'product_price'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$priceAttribute",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getBackend",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getTable",204],"(",")","]",",",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$joinExprProductPrice",205],",",["T_WHITESPACE","\n            ",205],"[","]",["T_WHITESPACE","\n        ",206],")",["T_OBJECT_OPERATOR","->",207],["T_STRING","joinLeft",207],"(",["T_WHITESPACE","\n            ",207],"[",["T_CONSTANT_ENCAPSED_STRING","'product_default_price'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$priceAttribute",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getBackend",208],"(",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","getTable",208],"(",")","]",",",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$joinProductPrice",209],",",["T_WHITESPACE","\n            ",209],"[","]",["T_WHITESPACE","\n        ",210],")",";",["T_WHITESPACE","\n\n        ",211],["T_VARIABLE","$havingPart",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],"[",["T_VARIABLE","$connection",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","prepareSqlCondition",213],"(",["T_VARIABLE","$viewsNumExpr",213],",",["T_WHITESPACE"," ",213],"[",["T_CONSTANT_ENCAPSED_STRING","'gt'",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_LNUMBER","0",213],"]",")","]",";",["T_WHITESPACE","\n        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_STRING","null",214],["T_WHITESPACE"," ",214],["T_IS_NOT_IDENTICAL","!==",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$subSelect",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$subSelectHavingPart",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_makeConditionFromDateRangeSelect",215],"(",["T_VARIABLE","$subSelect",215],",",["T_WHITESPACE"," ",215],["T_CONSTANT_ENCAPSED_STRING","'period'",215],")",";",["T_WHITESPACE","\n            ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$subSelectHavingPart",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$havingPart",217],"[","]",["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","'('",217],["T_WHITESPACE"," ",217],".",["T_WHITESPACE"," ",217],["T_VARIABLE","$subSelectHavingPart",217],["T_WHITESPACE"," ",217],".",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","')'",217],";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$select",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","having",220],"(",["T_STRING","implode",220],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$havingPart",220],")",")",";",["T_WHITESPACE","\n\n        ",220],["T_VARIABLE","$select",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","useStraightJoin",222],"(",")",";",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$insertQuery",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$select",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","insertFromSelect",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getMainTable",223],"(",")",",",["T_WHITESPACE"," ",223],["T_STRING","array_keys",223],"(",["T_VARIABLE","$columns",223],")",")",";",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$connection",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","query",224],"(",["T_VARIABLE","$insertQuery",224],")",";",["T_WHITESPACE","\n\n        ",224],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_resourceHelper",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","updateReportRatingPos",226],"(",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$connection",227],",",["T_WHITESPACE","\n            ",227],["T_CONSTANT_ENCAPSED_STRING","'day'",228],",",["T_WHITESPACE","\n            ",228],["T_CONSTANT_ENCAPSED_STRING","'views_num'",229],",",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$mainTable",230],",",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getTable",231],"(",["T_STRING","self",231],["T_DOUBLE_COLON","::",231],["T_STRING","AGGREGATION_DAILY",231],")",["T_WHITESPACE","\n        ",231],")",";",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_resourceHelper",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","updateReportRatingPos",233],"(",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$connection",234],",",["T_WHITESPACE","\n            ",234],["T_CONSTANT_ENCAPSED_STRING","'month'",235],",",["T_WHITESPACE","\n            ",235],["T_CONSTANT_ENCAPSED_STRING","'views_num'",236],",",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$mainTable",237],",",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getTable",238],"(",["T_STRING","self",238],["T_DOUBLE_COLON","::",238],["T_STRING","AGGREGATION_MONTHLY",238],")",["T_WHITESPACE","\n        ",238],")",";",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_resourceHelper",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","updateReportRatingPos",240],"(",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$connection",241],",",["T_WHITESPACE","\n            ",241],["T_CONSTANT_ENCAPSED_STRING","'year'",242],",",["T_WHITESPACE","\n            ",242],["T_CONSTANT_ENCAPSED_STRING","'views_num'",243],",",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$mainTable",244],",",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getTable",245],"(",["T_STRING","self",245],["T_DOUBLE_COLON","::",245],["T_STRING","AGGREGATION_YEARLY",245],")",["T_WHITESPACE","\n        ",245],")",";",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_setFlagData",247],"(",["T_NS_SEPARATOR","\\",247],["T_STRING","Magento",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Reports",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Model",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Flag",247],["T_DOUBLE_COLON","::",247],["T_STRING","REPORT_PRODUCT_VIEWED_FLAG_CODE",247],")",";",["T_WHITESPACE","\n        ",247],["T_RETURN","return",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n",249],"}",["T_WHITESPACE","\n",250]]