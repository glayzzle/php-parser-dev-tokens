[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Bundle",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Indexer",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Catalog",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ProductInterface",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Bundle products Price indexer resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","Price",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Catalog",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","ResourceModel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Product",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Indexer",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Price",15],["T_NS_SEPARATOR","\\",15],["T_STRING","DefaultPrice",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for all products\n     *\n     * @return $this\n     * @throws \\Exception\n     *\/",17],["T_WHITESPACE","\n    ",22],["T_PUBLIC","public",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","reindexAll",23],"(",")",["T_WHITESPACE","\n    ",23],"{",["T_WHITESPACE","\n        ",24],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","tableStrategy",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","setUseIdxTable",25],"(",["T_STRING","true",25],")",";",["T_WHITESPACE","\n\n        ",25],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","beginTransaction",27],"(",")",";",["T_WHITESPACE","\n        ",27],["T_TRY","try",28],["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n            ",28],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","_prepareBundlePrice",29],"(",")",";",["T_WHITESPACE","\n            ",29],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","commit",30],"(",")",";",["T_WHITESPACE","\n        ",30],"}",["T_WHITESPACE"," ",31],["T_CATCH","catch",31],["T_WHITESPACE"," ",31],"(",["T_NS_SEPARATOR","\\",31],["T_STRING","Exception",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$e",31],")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n            ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","rollBack",32],"(",")",";",["T_WHITESPACE","\n            ",32],["T_THROW","throw",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$e",33],";",["T_WHITESPACE","\n        ",33],"}",["T_WHITESPACE","\n\n        ",34],["T_RETURN","return",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],";",["T_WHITESPACE","\n    ",36],"}",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return $this\n     *\/",39],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","reindexEntity",45],"(",["T_VARIABLE","$entityIds",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_prepareBundlePrice",47],"(",["T_VARIABLE","$entityIds",47],")",";",["T_WHITESPACE","\n\n        ",47],["T_RETURN","return",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],";",["T_WHITESPACE","\n    ",49],"}",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * Retrieve temporary price index table name for fixed bundle products\n     *\n     * @return string\n     *\/",52],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","_getBundlePriceTable",57],"(",")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","tableStrategy",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getTableName",59],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_bundle'",59],")",";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Retrieve table name for temporary bundle selection prices index\n     *\n     * @return string\n     *\/",62],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","_getBundleSelectionTable",67],"(",")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","tableStrategy",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getTableName",69],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_bundle_sel'",69],")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Retrieve table name for temporary bundle option prices index\n     *\n     * @return string\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","_getBundleOptionTable",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","tableStrategy",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getTableName",79],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_index_price_bundle_opt'",79],")",";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Prepare temporary price index table for fixed bundle products\n     *\n     * @return $this\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_prepareBundlePriceTable",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getConnection",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","delete",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_getBundlePriceTable",89],"(",")",")",";",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Prepare table structure for temporary bundle selection prices index\n     *\n     * @return $this\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","_prepareBundleSelectionTable",98],"(",")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getConnection",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","delete",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","_getBundleSelectionTable",100],"(",")",")",";",["T_WHITESPACE","\n        ",100],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Prepare table structure for temporary bundle option prices index\n     *\n     * @return $this\n     *\/",104],["T_WHITESPACE","\n    ",108],["T_PROTECTED","protected",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","_prepareBundleOptionTable",109],"(",")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getConnection",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","delete",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_getBundleOptionTable",111],"(",")",")",";",["T_WHITESPACE","\n        ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Prepare temporary price index data for bundle products by price type\n     *\n     * @param int $priceType\n     * @param int|array $entityIds the entity ids limitation\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",115],["T_WHITESPACE","\n    ",122],["T_PROTECTED","protected",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","_prepareBundlePriceByType",123],"(",["T_VARIABLE","$priceType",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$entityIds",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","null",123],")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$connection",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getConnection",125],"(",")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$table",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_getBundlePriceTable",126],"(",")",";",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$select",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$connection",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","select",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","from",128],"(",["T_WHITESPACE","\n            ",128],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getTable",129],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",129],")","]",",",["T_WHITESPACE","\n            ",129],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",130],"]",["T_WHITESPACE","\n        ",130],")",["T_OBJECT_OPERATOR","->",131],["T_STRING","join",131],"(",["T_WHITESPACE","\n            ",131],"[",["T_CONSTANT_ENCAPSED_STRING","'cg'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getTable",132],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group'",132],")","]",",",["T_WHITESPACE","\n            ",132],["T_CONSTANT_ENCAPSED_STRING","''",133],",",["T_WHITESPACE","\n            ",133],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",134],"]",["T_WHITESPACE","\n        ",134],")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_addWebsiteJoinToSelect",136],"(",["T_VARIABLE","$select",136],",",["T_WHITESPACE"," ",136],["T_STRING","true",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_addProductWebsiteJoinToSelect",137],"(",["T_VARIABLE","$select",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",137],",",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","\"e.entity_id\"",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$select",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","columns",138],"(",["T_WHITESPACE","\n            ",138],["T_CONSTANT_ENCAPSED_STRING","'website_id'",139],",",["T_WHITESPACE","\n            ",139],["T_CONSTANT_ENCAPSED_STRING","'cw'",140],["T_WHITESPACE","\n        ",140],")",["T_OBJECT_OPERATOR","->",141],["T_STRING","join",141],"(",["T_WHITESPACE","\n            ",141],"[",["T_CONSTANT_ENCAPSED_STRING","'cwd'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_getWebsiteDateTable",142],"(",")","]",",",["T_WHITESPACE","\n            ",142],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",143],",",["T_WHITESPACE","\n            ",143],"[","]",["T_WHITESPACE","\n        ",144],")",["T_OBJECT_OPERATOR","->",145],["T_STRING","joinLeft",145],"(",["T_WHITESPACE","\n            ",145],"[",["T_CONSTANT_ENCAPSED_STRING","'tp'",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_getTierPriceIndexTable",146],"(",")","]",",",["T_WHITESPACE","\n            ",146],["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id = e.entity_id AND tp.website_id = cw.website_id'",147],["T_WHITESPACE"," ",147],".",["T_WHITESPACE","\n            ",147],["T_CONSTANT_ENCAPSED_STRING","' AND tp.customer_group_id = cg.customer_group_id'",148],",",["T_WHITESPACE","\n            ",148],"[","]",["T_WHITESPACE","\n        ",149],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","where",150],"(",["T_WHITESPACE","\n            ",150],["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",151],",",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getTypeId",152],"(",")",["T_WHITESPACE","\n        ",152],")",";",["T_WHITESPACE","\n\n        ",153],["T_COMMENT","\/\/ add enable products limitation\n",155],["T_WHITESPACE","        ",156],["T_VARIABLE","$statusCond",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$connection",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","quoteInto",156],"(",["T_WHITESPACE","\n            ",156],["T_CONSTANT_ENCAPSED_STRING","'=?'",157],",",["T_WHITESPACE","\n            ",157],["T_NS_SEPARATOR","\\",158],["T_STRING","Magento",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Catalog",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Model",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Product",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Attribute",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Source",158],["T_NS_SEPARATOR","\\",158],["T_STRING","Status",158],["T_DOUBLE_COLON","::",158],["T_STRING","STATUS_ENABLED",158],["T_WHITESPACE","\n        ",158],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$linkField",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getMetadataPool",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getMetadata",160],"(",["T_STRING","ProductInterface",160],["T_DOUBLE_COLON","::",160],["T_CLASS","class",160],")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getLinkField",160],"(",")",";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_addAttributeToSelect",161],"(",["T_VARIABLE","$select",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'status'",161],",",["T_WHITESPACE"," ",161],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",161],["T_VARIABLE","$linkField",161],"\"",",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$statusCond",161],",",["T_WHITESPACE"," ",161],["T_STRING","true",161],")",";",["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","moduleManager",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","isEnabled",162],"(",["T_CONSTANT_ENCAPSED_STRING","'Magento_Tax'",162],")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$taxClassId",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_addAttributeToSelect",163],"(",["T_VARIABLE","$select",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",163],",",["T_WHITESPACE"," ",163],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",163],["T_VARIABLE","$linkField",163],"\"",",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",163],")",";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE"," ",164],["T_ELSE","else",164],["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$taxClassId",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_NEW","new",165],["T_WHITESPACE"," ",165],["T_NS_SEPARATOR","\\",165],["T_STRING","Zend_Db_Expr",165],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",165],")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n\n        ",166],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$priceType",168],["T_WHITESPACE"," ",168],["T_IS_EQUAL","==",168],["T_WHITESPACE"," ",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Magento",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Bundle",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Model",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Product",168],["T_NS_SEPARATOR","\\",168],["T_STRING","Price",168],["T_DOUBLE_COLON","::",168],["T_STRING","PRICE_TYPE_DYNAMIC",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$select",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","columns",169],"(","[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_NEW","new",169],["T_WHITESPACE"," ",169],["T_NS_SEPARATOR","\\",169],["T_STRING","Zend_Db_Expr",169],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",169],")","]",")",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE"," ",170],["T_ELSE","else",170],["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$select",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","columns",171],"(",["T_WHITESPACE","\n                ",171],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$connection",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getCheckSql",172],"(",["T_VARIABLE","$taxClassId",172],["T_WHITESPACE"," ",172],".",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$taxClassId",172],",",["T_WHITESPACE"," ",172],["T_LNUMBER","0",172],")","]",["T_WHITESPACE","\n            ",172],")",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n\n        ",174],["T_VARIABLE","$priceTypeCond",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$connection",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","quoteInto",176],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$priceType",176],")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_addAttributeToSelect",177],"(",["T_VARIABLE","$select",177],",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'price_type'",177],",",["T_WHITESPACE"," ",177],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",177],["T_VARIABLE","$linkField",177],"\"",",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$priceTypeCond",177],")",";",["T_WHITESPACE","\n\n        ",177],["T_VARIABLE","$price",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_addAttributeToSelect",179],"(",["T_VARIABLE","$select",179],",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'price'",179],",",["T_WHITESPACE"," ",179],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",179],["T_VARIABLE","$linkField",179],"\"",",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",179],")",";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$specialPrice",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_addAttributeToSelect",180],"(",["T_VARIABLE","$select",180],",",["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'special_price'",180],",",["T_WHITESPACE"," ",180],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",180],["T_VARIABLE","$linkField",180],"\"",",",["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",180],")",";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$specialFrom",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_addAttributeToSelect",181],"(",["T_VARIABLE","$select",181],",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",181],",",["T_WHITESPACE"," ",181],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",181],["T_VARIABLE","$linkField",181],"\"",",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",181],")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$specialTo",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_addAttributeToSelect",182],"(",["T_VARIABLE","$select",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",182],",",["T_WHITESPACE"," ",182],"\"",["T_ENCAPSED_AND_WHITESPACE","e.",182],["T_VARIABLE","$linkField",182],"\"",",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",182],")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$curentDate",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_NEW","new",183],["T_WHITESPACE"," ",183],["T_NS_SEPARATOR","\\",183],["T_STRING","Zend_Db_Expr",183],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd.website_date'",183],")",";",["T_WHITESPACE","\n\n        ",183],["T_VARIABLE","$specialExpr",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$connection",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getCheckSql",185],"(",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$connection",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getCheckSql",186],"(",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$specialFrom",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",187],",",["T_WHITESPACE","\n                ",187],["T_CONSTANT_ENCAPSED_STRING","'1'",188],",",["T_WHITESPACE","\n                ",188],["T_VARIABLE","$connection",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getCheckSql",189],"(",["T_VARIABLE","$specialFrom",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","' <= '",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_VARIABLE","$curentDate",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'1'",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'0'",189],")",["T_WHITESPACE","\n            ",189],")",["T_WHITESPACE"," ",190],".",["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","\" > 0 AND \"",190],["T_WHITESPACE"," ",190],".",["T_WHITESPACE"," ",190],["T_VARIABLE","$connection",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getCheckSql",190],"(",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$specialTo",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",191],",",["T_WHITESPACE","\n                ",191],["T_CONSTANT_ENCAPSED_STRING","'1'",192],",",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$connection",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getCheckSql",193],"(",["T_VARIABLE","$specialTo",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","' >= '",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_VARIABLE","$curentDate",193],",",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","'1'",193],",",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","'0'",193],")",["T_WHITESPACE","\n            ",193],")",["T_WHITESPACE"," ",194],".",["T_WHITESPACE"," ",194],"\"",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",194],["T_CURLY_OPEN","{",194],["T_VARIABLE","$specialPrice",194],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",194],["T_CURLY_OPEN","{",194],["T_VARIABLE","$specialPrice",194],"}",["T_ENCAPSED_AND_WHITESPACE"," < 100 ",194],"\"",",",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$specialPrice",195],",",["T_WHITESPACE","\n            ",195],["T_CONSTANT_ENCAPSED_STRING","'0'",196],["T_WHITESPACE","\n        ",196],")",";",["T_WHITESPACE","\n\n        ",197],["T_VARIABLE","$tierExpr",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_NEW","new",199],["T_WHITESPACE"," ",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Zend_Db_Expr",199],"(",["T_CONSTANT_ENCAPSED_STRING","\"tp.min_price\"",199],")",";",["T_WHITESPACE","\n\n        ",199],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$priceType",201],["T_WHITESPACE"," ",201],["T_IS_EQUAL","==",201],["T_WHITESPACE"," ",201],["T_NS_SEPARATOR","\\",201],["T_STRING","Magento",201],["T_NS_SEPARATOR","\\",201],["T_STRING","Bundle",201],["T_NS_SEPARATOR","\\",201],["T_STRING","Model",201],["T_NS_SEPARATOR","\\",201],["T_STRING","Product",201],["T_NS_SEPARATOR","\\",201],["T_STRING","Price",201],["T_DOUBLE_COLON","::",201],["T_STRING","PRICE_TYPE_FIXED",201],")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$finalPrice",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$connection",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getCheckSql",202],"(",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$specialExpr",203],["T_WHITESPACE"," ",203],".",["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","' > 0'",203],",",["T_WHITESPACE","\n                ",203],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_VARIABLE","$price",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","' * ('",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_VARIABLE","$specialExpr",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'  \/ 100), 4)'",204],",",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$price",205],["T_WHITESPACE","\n            ",205],")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$tierPrice",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$connection",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getCheckSql",207],"(",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$tierExpr",208],["T_WHITESPACE"," ",208],".",["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",208],",",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$price",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","' - '",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'('",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$price",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","' * ('",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$tierExpr",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","' \/ 100)), 4)'",209],",",["T_WHITESPACE","\n                ",209],["T_CONSTANT_ENCAPSED_STRING","'NULL'",210],["T_WHITESPACE","\n            ",210],")",";",["T_WHITESPACE","\n\n            ",211],["T_VARIABLE","$finalPrice",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$connection",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getCheckSql",213],"(",["T_WHITESPACE","\n                ",213],"\"",["T_CURLY_OPEN","{",214],["T_VARIABLE","$tierPrice",214],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",214],["T_CURLY_OPEN","{",214],["T_VARIABLE","$finalPrice",214],"}","\"",",",["T_WHITESPACE","\n                ",214],["T_VARIABLE","$tierPrice",215],",",["T_WHITESPACE","\n                ",215],["T_VARIABLE","$finalPrice",216],["T_WHITESPACE","\n            ",216],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE"," ",218],["T_ELSE","else",218],["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$finalPrice",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_NEW","new",219],["T_WHITESPACE"," ",219],["T_NS_SEPARATOR","\\",219],["T_STRING","Zend_Db_Expr",219],"(",["T_CONSTANT_ENCAPSED_STRING","\"0\"",219],")",";",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$tierPrice",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$connection",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getCheckSql",220],"(",["T_VARIABLE","$tierExpr",220],["T_WHITESPACE"," ",220],".",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'0'",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'NULL'",220],")",";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_VARIABLE","$select",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","columns",223],"(",["T_WHITESPACE","\n            ",223],"[",["T_WHITESPACE","\n                ",224],["T_CONSTANT_ENCAPSED_STRING","'price_type'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_NEW","new",225],["T_WHITESPACE"," ",225],["T_NS_SEPARATOR","\\",225],["T_STRING","Zend_Db_Expr",225],"(",["T_VARIABLE","$priceType",225],")",",",["T_WHITESPACE","\n                ",225],["T_CONSTANT_ENCAPSED_STRING","'special_price'",226],["T_WHITESPACE"," ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$specialExpr",226],",",["T_WHITESPACE","\n                ",226],["T_CONSTANT_ENCAPSED_STRING","'tier_percent'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$tierExpr",227],",",["T_WHITESPACE","\n                ",227],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$connection",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getCheckSql",228],"(",["T_VARIABLE","$price",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",228],",",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'0'",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$price",228],")",",",["T_WHITESPACE","\n                ",228],["T_CONSTANT_ENCAPSED_STRING","'price'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$finalPrice",229],",",["T_WHITESPACE","\n                ",229],["T_CONSTANT_ENCAPSED_STRING","'min_price'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$finalPrice",230],",",["T_WHITESPACE","\n                ",230],["T_CONSTANT_ENCAPSED_STRING","'max_price'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$finalPrice",231],",",["T_WHITESPACE","\n                ",231],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$tierPrice",232],",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$tierPrice",233],",",["T_WHITESPACE","\n            ",233],"]",["T_WHITESPACE","\n        ",234],")",";",["T_WHITESPACE","\n\n        ",235],["T_IF","if",237],["T_WHITESPACE"," ",237],"(",["T_VARIABLE","$entityIds",237],["T_WHITESPACE"," ",237],["T_IS_NOT_IDENTICAL","!==",237],["T_WHITESPACE"," ",237],["T_STRING","null",237],")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$select",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","where",238],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$entityIds",238],")",";",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n\n        ",239],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",241],["T_WHITESPACE","\n        ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_eventManager",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","dispatch",244],"(",["T_WHITESPACE","\n            ",244],["T_CONSTANT_ENCAPSED_STRING","'catalog_product_prepare_index_select'",245],",",["T_WHITESPACE","\n            ",245],"[",["T_WHITESPACE","\n                ",246],["T_CONSTANT_ENCAPSED_STRING","'select'",247],["T_WHITESPACE"," ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$select",247],",",["T_WHITESPACE","\n                ",247],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",248],["T_WHITESPACE"," ",248],["T_DOUBLE_ARROW","=>",248],["T_WHITESPACE"," ",248],["T_NEW","new",248],["T_WHITESPACE"," ",248],["T_NS_SEPARATOR","\\",248],["T_STRING","Zend_Db_Expr",248],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",248],")",",",["T_WHITESPACE","\n                ",248],["T_CONSTANT_ENCAPSED_STRING","'website_field'",249],["T_WHITESPACE"," ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_NEW","new",249],["T_WHITESPACE"," ",249],["T_NS_SEPARATOR","\\",249],["T_STRING","Zend_Db_Expr",249],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",249],")",",",["T_WHITESPACE","\n                ",249],["T_CONSTANT_ENCAPSED_STRING","'store_field'",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_NEW","new",250],["T_WHITESPACE"," ",250],["T_NS_SEPARATOR","\\",250],["T_STRING","Zend_Db_Expr",250],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",250],")",["T_WHITESPACE","\n            ",250],"]",["T_WHITESPACE","\n        ",251],")",";",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$query",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$select",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","insertFromSelect",254],"(",["T_VARIABLE","$table",254],")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$connection",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","query",255],"(",["T_VARIABLE","$query",255],")",";",["T_WHITESPACE","\n\n        ",255],["T_RETURN","return",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],";",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Calculate fixed bundle product selections price\n     *\n     * @return $this\n     *\/",260],["T_WHITESPACE","\n    ",264],["T_PROTECTED","protected",265],["T_WHITESPACE"," ",265],["T_FUNCTION","function",265],["T_WHITESPACE"," ",265],["T_STRING","_calculateBundleOptionPrice",265],"(",")",["T_WHITESPACE","\n    ",265],"{",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$connection",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getConnection",267],"(",")",";",["T_WHITESPACE","\n\n        ",267],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_prepareBundleSelectionTable",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_calculateBundleSelectionPrice",270],"(",["T_NS_SEPARATOR","\\",270],["T_STRING","Magento",270],["T_NS_SEPARATOR","\\",270],["T_STRING","Bundle",270],["T_NS_SEPARATOR","\\",270],["T_STRING","Model",270],["T_NS_SEPARATOR","\\",270],["T_STRING","Product",270],["T_NS_SEPARATOR","\\",270],["T_STRING","Price",270],["T_DOUBLE_COLON","::",270],["T_STRING","PRICE_TYPE_FIXED",270],")",";",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_calculateBundleSelectionPrice",271],"(",["T_NS_SEPARATOR","\\",271],["T_STRING","Magento",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Bundle",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Model",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Product",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Price",271],["T_DOUBLE_COLON","::",271],["T_STRING","PRICE_TYPE_DYNAMIC",271],")",";",["T_WHITESPACE","\n\n        ",271],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_prepareBundleOptionTable",273],"(",")",";",["T_WHITESPACE","\n\n        ",273],["T_VARIABLE","$select",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$connection",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","select",275],"(",")",["T_OBJECT_OPERATOR","->",275],["T_STRING","from",275],"(",["T_WHITESPACE","\n            ",275],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",276],["T_WHITESPACE"," ",276],["T_DOUBLE_ARROW","=>",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_getBundleSelectionTable",276],"(",")","]",",",["T_WHITESPACE","\n            ",276],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",277],",",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",277],",",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'website_id'",277],",",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'option_id'",277],"]",["T_WHITESPACE","\n        ",277],")",["T_OBJECT_OPERATOR","->",278],["T_STRING","group",278],"(",["T_WHITESPACE","\n            ",278],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'website_id'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'option_id'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'is_required'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'group_type'",279],"]",["T_WHITESPACE","\n        ",279],")",["T_OBJECT_OPERATOR","->",280],["T_STRING","columns",280],"(",["T_WHITESPACE","\n            ",280],"[",["T_WHITESPACE","\n                ",281],["T_CONSTANT_ENCAPSED_STRING","'min_price'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$connection",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getCheckSql",282],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 1'",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.price)'",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'0'",282],")",",",["T_WHITESPACE","\n                ",282],["T_CONSTANT_ENCAPSED_STRING","'alt_price'",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$connection",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getCheckSql",283],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 0'",283],",",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.price)'",283],",",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'0'",283],")",",",["T_WHITESPACE","\n                ",283],["T_CONSTANT_ENCAPSED_STRING","'max_price'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$connection",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getCheckSql",284],"(",["T_CONSTANT_ENCAPSED_STRING","'i.group_type = 1'",284],",",["T_WHITESPACE"," ",284],["T_CONSTANT_ENCAPSED_STRING","'SUM(i.price)'",284],",",["T_WHITESPACE"," ",284],["T_CONSTANT_ENCAPSED_STRING","'MAX(i.price)'",284],")",",",["T_WHITESPACE","\n                ",284],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",285],["T_WHITESPACE"," ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$connection",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getCheckSql",285],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 1'",285],",",["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_price)'",285],",",["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","'0'",285],")",",",["T_WHITESPACE","\n                ",285],["T_CONSTANT_ENCAPSED_STRING","'alt_tier_price'",286],["T_WHITESPACE"," ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$connection",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getCheckSql",286],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 0'",286],",",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_price)'",286],",",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'0'",286],")",",",["T_WHITESPACE","\n            ",286],"]",["T_WHITESPACE","\n        ",287],")",";",["T_WHITESPACE","\n\n        ",288],["T_VARIABLE","$query",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$select",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","insertFromSelect",290],"(",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_getBundleOptionTable",290],"(",")",")",";",["T_WHITESPACE","\n        ",290],["T_VARIABLE","$connection",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","query",291],"(",["T_VARIABLE","$query",291],")",";",["T_WHITESPACE","\n\n        ",291],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_prepareDefaultFinalPriceTable",293],"(",")",";",["T_WHITESPACE","\n\n        ",293],["T_VARIABLE","$minPrice",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_NEW","new",295],["T_WHITESPACE"," ",295],["T_NS_SEPARATOR","\\",295],["T_STRING","Zend_Db_Expr",295],"(",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$connection",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getCheckSql",296],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(io.min_price) = 0'",296],",",["T_WHITESPACE"," ",296],["T_CONSTANT_ENCAPSED_STRING","'MIN(io.alt_price)'",296],",",["T_WHITESPACE"," ",296],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.min_price)'",296],")",["T_WHITESPACE"," ",296],".",["T_WHITESPACE"," ",296],["T_CONSTANT_ENCAPSED_STRING","' + i.price'",296],["T_WHITESPACE","\n        ",296],")",";",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$maxPrice",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_NEW","new",298],["T_WHITESPACE"," ",298],["T_NS_SEPARATOR","\\",298],["T_STRING","Zend_Db_Expr",298],"(",["T_CONSTANT_ENCAPSED_STRING","\"SUM(io.max_price) + i.price\"",298],")",";",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$tierPrice",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$connection",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getCheckSql",299],"(",["T_WHITESPACE","\n            ",299],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_percent) IS NOT NULL'",300],",",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$connection",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getCheckSql",301],"(",["T_WHITESPACE","\n                ",301],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.tier_price) = 0'",302],",",["T_WHITESPACE","\n                ",302],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.alt_tier_price)'",303],",",["T_WHITESPACE","\n                ",303],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.tier_price)'",304],["T_WHITESPACE","\n            ",304],")",["T_WHITESPACE"," ",305],".",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","' + MIN(i.tier_price)'",305],",",["T_WHITESPACE","\n            ",305],["T_CONSTANT_ENCAPSED_STRING","'NULL'",306],["T_WHITESPACE","\n        ",306],")",";",["T_WHITESPACE","\n\n        ",307],["T_VARIABLE","$select",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$connection",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","select",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","from",309],"(",["T_WHITESPACE","\n            ",309],"[",["T_CONSTANT_ENCAPSED_STRING","'io'",310],["T_WHITESPACE"," ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_getBundleOptionTable",310],"(",")","]",",",["T_WHITESPACE","\n            ",310],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",311],",",["T_WHITESPACE"," ",311],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",311],",",["T_WHITESPACE"," ",311],["T_CONSTANT_ENCAPSED_STRING","'website_id'",311],"]",["T_WHITESPACE","\n        ",311],")",["T_OBJECT_OPERATOR","->",312],["T_STRING","join",312],"(",["T_WHITESPACE","\n            ",312],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",313],["T_WHITESPACE"," ",313],["T_DOUBLE_ARROW","=>",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_getBundlePriceTable",313],"(",")","]",",",["T_WHITESPACE","\n            ",313],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id = io.entity_id AND i.customer_group_id = io.customer_group_id'",314],["T_WHITESPACE"," ",314],".",["T_WHITESPACE","\n            ",314],["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = io.website_id'",315],",",["T_WHITESPACE","\n            ",315],"[","]",["T_WHITESPACE","\n        ",316],")",["T_OBJECT_OPERATOR","->",317],["T_STRING","group",317],"(",["T_WHITESPACE","\n            ",317],"[",["T_CONSTANT_ENCAPSED_STRING","'io.entity_id'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'io.customer_group_id'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'io.website_id'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'i.tax_class_id'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'i.orig_price'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'i.price'",318],"]",["T_WHITESPACE","\n        ",318],")",["T_OBJECT_OPERATOR","->",319],["T_STRING","columns",319],"(",["T_WHITESPACE","\n            ",319],"[",["T_WHITESPACE","\n                ",320],["T_CONSTANT_ENCAPSED_STRING","'i.tax_class_id'",321],",",["T_WHITESPACE","\n                ",321],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",322],["T_WHITESPACE"," ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'i.orig_price'",322],",",["T_WHITESPACE","\n                ",322],["T_CONSTANT_ENCAPSED_STRING","'price'",323],["T_WHITESPACE"," ",323],["T_DOUBLE_ARROW","=>",323],["T_WHITESPACE"," ",323],["T_CONSTANT_ENCAPSED_STRING","'i.price'",323],",",["T_WHITESPACE","\n                ",323],["T_CONSTANT_ENCAPSED_STRING","'min_price'",324],["T_WHITESPACE"," ",324],["T_DOUBLE_ARROW","=>",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$minPrice",324],",",["T_WHITESPACE","\n                ",324],["T_CONSTANT_ENCAPSED_STRING","'max_price'",325],["T_WHITESPACE"," ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$maxPrice",325],",",["T_WHITESPACE","\n                ",325],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$tierPrice",326],",",["T_WHITESPACE","\n                ",326],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.base_tier)'",327],",",["T_WHITESPACE","\n            ",327],"]",["T_WHITESPACE","\n        ",328],")",";",["T_WHITESPACE","\n\n        ",329],["T_VARIABLE","$query",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$select",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","insertFromSelect",331],"(",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_getDefaultFinalPriceTable",331],"(",")",")",";",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$connection",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","query",332],"(",["T_VARIABLE","$query",332],")",";",["T_WHITESPACE","\n\n        ",332],["T_RETURN","return",334],["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],";",["T_WHITESPACE","\n    ",334],"}",["T_WHITESPACE","\n\n    ",335],["T_DOC_COMMENT","\/**\n     * Calculate bundle product selections price by product type\n     *\n     * @param int $priceType\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",337],["T_WHITESPACE","\n    ",343],["T_PROTECTED","protected",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","_calculateBundleSelectionPrice",344],"(",["T_VARIABLE","$priceType",344],")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$connection",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getConnection",346],"(",")",";",["T_WHITESPACE","\n\n        ",346],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$priceType",348],["T_WHITESPACE"," ",348],["T_IS_EQUAL","==",348],["T_WHITESPACE"," ",348],["T_NS_SEPARATOR","\\",348],["T_STRING","Magento",348],["T_NS_SEPARATOR","\\",348],["T_STRING","Bundle",348],["T_NS_SEPARATOR","\\",348],["T_STRING","Model",348],["T_NS_SEPARATOR","\\",348],["T_STRING","Product",348],["T_NS_SEPARATOR","\\",348],["T_STRING","Price",348],["T_DOUBLE_COLON","::",348],["T_STRING","PRICE_TYPE_FIXED",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$selectionPriceValue",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$connection",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getCheckSql",349],"(",["T_WHITESPACE","\n                ",349],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_value IS NULL'",350],",",["T_WHITESPACE","\n                ",350],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_price_value'",351],",",["T_WHITESPACE","\n                ",351],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_value'",352],["T_WHITESPACE","\n            ",352],")",";",["T_WHITESPACE","\n            ",353],["T_VARIABLE","$selectionPriceType",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$connection",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getCheckSql",354],"(",["T_WHITESPACE","\n                ",354],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_type IS NULL'",355],",",["T_WHITESPACE","\n                ",355],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_price_type'",356],",",["T_WHITESPACE","\n                ",356],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_type'",357],["T_WHITESPACE","\n            ",357],")",";",["T_WHITESPACE","\n            ",358],["T_VARIABLE","$priceExpr",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_NEW","new",359],["T_WHITESPACE"," ",359],["T_NS_SEPARATOR","\\",359],["T_STRING","Zend_Db_Expr",359],"(",["T_WHITESPACE","\n                ",359],["T_VARIABLE","$connection",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getCheckSql",360],"(",["T_WHITESPACE","\n                    ",360],["T_VARIABLE","$selectionPriceType",361],["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","' = 1'",361],",",["T_WHITESPACE","\n                    ",361],["T_CONSTANT_ENCAPSED_STRING","'ROUND(i.price * ('",362],["T_WHITESPACE"," ",362],".",["T_WHITESPACE"," ",362],["T_VARIABLE","$selectionPriceValue",362],["T_WHITESPACE"," ",362],".",["T_WHITESPACE"," ",362],["T_CONSTANT_ENCAPSED_STRING","' \/ 100),4)'",362],",",["T_WHITESPACE","\n                    ",362],["T_VARIABLE","$connection",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getCheckSql",363],"(",["T_WHITESPACE","\n                        ",363],["T_CONSTANT_ENCAPSED_STRING","'i.special_price > 0 AND i.special_price < 100'",364],",",["T_WHITESPACE","\n                        ",364],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",365],["T_WHITESPACE"," ",365],".",["T_WHITESPACE"," ",365],["T_VARIABLE","$selectionPriceValue",365],["T_WHITESPACE"," ",365],".",["T_WHITESPACE"," ",365],["T_CONSTANT_ENCAPSED_STRING","' * (i.special_price \/ 100),4)'",365],",",["T_WHITESPACE","\n                        ",365],["T_VARIABLE","$selectionPriceValue",366],["T_WHITESPACE","\n                    ",366],")",["T_WHITESPACE","\n                ",367],")",["T_WHITESPACE"," ",368],".",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'* bs.selection_qty'",368],["T_WHITESPACE","\n            ",368],")",";",["T_WHITESPACE","\n\n            ",369],["T_VARIABLE","$tierExpr",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$connection",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getCheckSql",371],"(",["T_WHITESPACE","\n                ",371],["T_CONSTANT_ENCAPSED_STRING","'i.base_tier IS NOT NULL'",372],",",["T_WHITESPACE","\n                ",372],["T_VARIABLE","$connection",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getCheckSql",373],"(",["T_WHITESPACE","\n                    ",373],["T_VARIABLE","$selectionPriceType",374],["T_WHITESPACE"," ",374],".",["T_WHITESPACE"," ",374],["T_CONSTANT_ENCAPSED_STRING","' = 1'",374],",",["T_WHITESPACE","\n                    ",374],["T_CONSTANT_ENCAPSED_STRING","'ROUND(i.base_tier - (i.base_tier * ('",375],["T_WHITESPACE"," ",375],".",["T_WHITESPACE"," ",375],["T_VARIABLE","$selectionPriceValue",375],["T_WHITESPACE"," ",375],".",["T_WHITESPACE"," ",375],["T_CONSTANT_ENCAPSED_STRING","' \/ 100)),4)'",375],",",["T_WHITESPACE","\n                    ",375],["T_VARIABLE","$connection",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getCheckSql",376],"(",["T_WHITESPACE","\n                        ",376],["T_CONSTANT_ENCAPSED_STRING","'i.tier_percent > 0'",377],",",["T_WHITESPACE","\n                        ",377],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",378],["T_WHITESPACE"," ",378],".",["T_WHITESPACE","\n                        ",378],["T_VARIABLE","$selectionPriceValue",379],["T_WHITESPACE"," ",379],".",["T_WHITESPACE","\n                        ",379],["T_CONSTANT_ENCAPSED_STRING","' - ('",380],["T_WHITESPACE"," ",380],".",["T_WHITESPACE","\n                        ",380],["T_VARIABLE","$selectionPriceValue",381],["T_WHITESPACE"," ",381],".",["T_WHITESPACE","\n                        ",381],["T_CONSTANT_ENCAPSED_STRING","' * (i.tier_percent \/ 100)),4)'",382],",",["T_WHITESPACE","\n                        ",382],["T_VARIABLE","$selectionPriceValue",383],["T_WHITESPACE","\n                    ",383],")",["T_WHITESPACE","\n                ",384],")",["T_WHITESPACE"," ",385],".",["T_WHITESPACE"," ",385],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",385],",",["T_WHITESPACE","\n                ",385],["T_CONSTANT_ENCAPSED_STRING","'NULL'",386],["T_WHITESPACE","\n            ",386],")",";",["T_WHITESPACE","\n\n            ",387],["T_VARIABLE","$priceExpr",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_NEW","new",389],["T_WHITESPACE"," ",389],["T_NS_SEPARATOR","\\",389],["T_STRING","Zend_Db_Expr",389],"(",["T_WHITESPACE","\n                ",389],["T_VARIABLE","$connection",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getCheckSql",390],"(","\"",["T_CURLY_OPEN","{",390],["T_VARIABLE","$tierExpr",390],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",390],["T_CURLY_OPEN","{",390],["T_VARIABLE","$priceExpr",390],"}","\"",",",["T_WHITESPACE"," ",390],["T_VARIABLE","$tierExpr",390],",",["T_WHITESPACE"," ",390],["T_VARIABLE","$priceExpr",390],")",["T_WHITESPACE","\n            ",390],")",";",["T_WHITESPACE","\n        ",391],"}",["T_WHITESPACE"," ",392],["T_ELSE","else",392],["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n            ",392],["T_VARIABLE","$priceExpr",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_NEW","new",393],["T_WHITESPACE"," ",393],["T_NS_SEPARATOR","\\",393],["T_STRING","Zend_Db_Expr",393],"(",["T_WHITESPACE","\n                ",393],["T_VARIABLE","$connection",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getCheckSql",394],"(",["T_WHITESPACE","\n                    ",394],["T_CONSTANT_ENCAPSED_STRING","'i.special_price > 0 AND i.special_price < 100'",395],",",["T_WHITESPACE","\n                    ",395],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price * (i.special_price \/ 100), 4)'",396],",",["T_WHITESPACE","\n                    ",396],["T_CONSTANT_ENCAPSED_STRING","'idx.min_price'",397],["T_WHITESPACE","\n                ",397],")",["T_WHITESPACE"," ",398],".",["T_WHITESPACE"," ",398],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",398],["T_WHITESPACE","\n            ",398],")",";",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$tierExpr",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$connection",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getCheckSql",400],"(",["T_WHITESPACE","\n                ",400],["T_CONSTANT_ENCAPSED_STRING","'i.base_tier IS NOT NULL'",401],",",["T_WHITESPACE","\n                ",401],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price * (i.base_tier \/ 100), 4)* bs.selection_qty'",402],",",["T_WHITESPACE","\n                ",402],["T_CONSTANT_ENCAPSED_STRING","'NULL'",403],["T_WHITESPACE","\n            ",403],")",";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE","\n\n        ",405],["T_VARIABLE","$linkField",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getMetadataPool",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","getMetadata",407],"(",["T_STRING","ProductInterface",407],["T_DOUBLE_COLON","::",407],["T_CLASS","class",407],")",["T_OBJECT_OPERATOR","->",407],["T_STRING","getLinkField",407],"(",")",";",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$select",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_VARIABLE","$connection",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","select",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","from",408],"(",["T_WHITESPACE","\n            ",408],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",409],["T_WHITESPACE"," ",409],["T_DOUBLE_ARROW","=>",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","_getBundlePriceTable",409],"(",")","]",",",["T_WHITESPACE","\n            ",409],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",410],",",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",410],",",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","'website_id'",410],"]",["T_WHITESPACE","\n        ",410],")",["T_OBJECT_OPERATOR","->",411],["T_STRING","join",411],"(",["T_WHITESPACE","\n            ",411],"[",["T_CONSTANT_ENCAPSED_STRING","'parent_product'",412],["T_WHITESPACE"," ",412],["T_DOUBLE_ARROW","=>",412],["T_WHITESPACE"," ",412],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getTable",412],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",412],")","]",",",["T_WHITESPACE","\n            ",412],["T_CONSTANT_ENCAPSED_STRING","'parent_product.entity_id = i.entity_id'",413],",",["T_WHITESPACE","\n            ",413],"[","]",["T_WHITESPACE","\n        ",414],")",["T_OBJECT_OPERATOR","->",415],["T_STRING","join",415],"(",["T_WHITESPACE","\n            ",415],"[",["T_CONSTANT_ENCAPSED_STRING","'bo'",416],["T_WHITESPACE"," ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getTable",416],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_bundle_option'",416],")","]",",",["T_WHITESPACE","\n            ",416],"\"",["T_ENCAPSED_AND_WHITESPACE","bo.parent_id = parent_product.",417],["T_VARIABLE","$linkField",417],"\"",",",["T_WHITESPACE","\n            ",417],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",418],"]",["T_WHITESPACE","\n        ",418],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","join",419],"(",["T_WHITESPACE","\n            ",419],"[",["T_CONSTANT_ENCAPSED_STRING","'bs'",420],["T_WHITESPACE"," ",420],["T_DOUBLE_ARROW","=>",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getTable",420],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_bundle_selection'",420],")","]",",",["T_WHITESPACE","\n            ",420],["T_CONSTANT_ENCAPSED_STRING","'bs.option_id = bo.option_id'",421],",",["T_WHITESPACE","\n            ",421],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",422],"]",["T_WHITESPACE","\n        ",422],")",["T_OBJECT_OPERATOR","->",423],["T_STRING","joinLeft",423],"(",["T_WHITESPACE","\n            ",423],"[",["T_CONSTANT_ENCAPSED_STRING","'bsp'",424],["T_WHITESPACE"," ",424],["T_DOUBLE_ARROW","=>",424],["T_WHITESPACE"," ",424],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getTable",424],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_bundle_selection_price'",424],")","]",",",["T_WHITESPACE","\n            ",424],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_id = bsp.selection_id AND bsp.website_id = i.website_id'",425],",",["T_WHITESPACE","\n            ",425],"[",["T_CONSTANT_ENCAPSED_STRING","''",426],"]",["T_WHITESPACE","\n        ",426],")",["T_OBJECT_OPERATOR","->",427],["T_STRING","join",427],"(",["T_WHITESPACE","\n            ",427],"[",["T_CONSTANT_ENCAPSED_STRING","'idx'",428],["T_WHITESPACE"," ",428],["T_DOUBLE_ARROW","=>",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getIdxTable",428],"(",")","]",",",["T_WHITESPACE","\n            ",428],["T_CONSTANT_ENCAPSED_STRING","'bs.product_id = idx.entity_id AND i.customer_group_id = idx.customer_group_id'",429],["T_WHITESPACE"," ",429],".",["T_WHITESPACE","\n            ",429],["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = idx.website_id'",430],",",["T_WHITESPACE","\n            ",430],"[","]",["T_WHITESPACE","\n        ",431],")",["T_OBJECT_OPERATOR","->",432],["T_STRING","join",432],"(",["T_WHITESPACE","\n            ",432],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",433],["T_WHITESPACE"," ",433],["T_DOUBLE_ARROW","=>",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getTable",433],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",433],")","]",",",["T_WHITESPACE","\n            ",433],["T_CONSTANT_ENCAPSED_STRING","'bs.product_id = e.entity_id AND e.required_options=0'",434],",",["T_WHITESPACE","\n            ",434],"[","]",["T_WHITESPACE","\n        ",435],")",["T_OBJECT_OPERATOR","->",436],["T_STRING","where",436],"(",["T_WHITESPACE","\n            ",436],["T_CONSTANT_ENCAPSED_STRING","'i.price_type=?'",437],",",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$priceType",438],["T_WHITESPACE","\n        ",438],")",["T_OBJECT_OPERATOR","->",439],["T_STRING","columns",439],"(",["T_WHITESPACE","\n            ",439],"[",["T_WHITESPACE","\n                ",440],["T_CONSTANT_ENCAPSED_STRING","'group_type'",441],["T_WHITESPACE"," ",441],["T_DOUBLE_ARROW","=>",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$connection",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getCheckSql",441],"(",["T_CONSTANT_ENCAPSED_STRING","\"bo.type = 'select' OR bo.type = 'radio'\"",441],",",["T_WHITESPACE"," ",441],["T_CONSTANT_ENCAPSED_STRING","'0'",441],",",["T_WHITESPACE"," ",441],["T_CONSTANT_ENCAPSED_STRING","'1'",441],")",",",["T_WHITESPACE","\n                ",441],["T_CONSTANT_ENCAPSED_STRING","'is_required'",442],["T_WHITESPACE"," ",442],["T_DOUBLE_ARROW","=>",442],["T_WHITESPACE"," ",442],["T_CONSTANT_ENCAPSED_STRING","'bo.required'",442],",",["T_WHITESPACE","\n                ",442],["T_CONSTANT_ENCAPSED_STRING","'price'",443],["T_WHITESPACE"," ",443],["T_DOUBLE_ARROW","=>",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$priceExpr",443],",",["T_WHITESPACE","\n                ",443],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",444],["T_WHITESPACE"," ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$tierExpr",444],",",["T_WHITESPACE","\n            ",444],"]",["T_WHITESPACE","\n        ",445],")",";",["T_WHITESPACE","\n\n        ",446],["T_VARIABLE","$query",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_VARIABLE","$select",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","insertFromSelect",448],"(",["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_getBundleSelectionTable",448],"(",")",")",";",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$connection",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","query",449],"(",["T_VARIABLE","$query",449],")",";",["T_WHITESPACE","\n\n        ",449],["T_RETURN","return",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],";",["T_WHITESPACE","\n    ",451],"}",["T_WHITESPACE","\n\n    ",452],["T_DOC_COMMENT","\/**\n     * Prepare temporary index price for bundle products\n     *\n     * @param int|array $entityIds  the entity ids limitation\n     * @return $this\n     *\/",454],["T_WHITESPACE","\n    ",459],["T_PROTECTED","protected",460],["T_WHITESPACE"," ",460],["T_FUNCTION","function",460],["T_WHITESPACE"," ",460],["T_STRING","_prepareBundlePrice",460],"(",["T_VARIABLE","$entityIds",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_STRING","null",460],")",["T_WHITESPACE","\n    ",460],"{",["T_WHITESPACE","\n        ",461],["T_IF","if",462],["T_WHITESPACE"," ",462],"(","!",["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","hasEntity",462],"(",")",["T_WHITESPACE"," ",462],["T_BOOLEAN_AND","&&",462],["T_WHITESPACE"," ",462],["T_EMPTY","empty",462],"(",["T_VARIABLE","$entityIds",462],")",")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_RETURN","return",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],";",["T_WHITESPACE","\n        ",463],"}",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","_prepareTierPriceIndex",465],"(",["T_VARIABLE","$entityIds",465],")",";",["T_WHITESPACE","\n        ",465],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_prepareBundlePriceTable",466],"(",")",";",["T_WHITESPACE","\n        ",466],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","_prepareBundlePriceByType",467],"(",["T_NS_SEPARATOR","\\",467],["T_STRING","Magento",467],["T_NS_SEPARATOR","\\",467],["T_STRING","Bundle",467],["T_NS_SEPARATOR","\\",467],["T_STRING","Model",467],["T_NS_SEPARATOR","\\",467],["T_STRING","Product",467],["T_NS_SEPARATOR","\\",467],["T_STRING","Price",467],["T_DOUBLE_COLON","::",467],["T_STRING","PRICE_TYPE_FIXED",467],",",["T_WHITESPACE"," ",467],["T_VARIABLE","$entityIds",467],")",";",["T_WHITESPACE","\n        ",467],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_prepareBundlePriceByType",468],"(",["T_NS_SEPARATOR","\\",468],["T_STRING","Magento",468],["T_NS_SEPARATOR","\\",468],["T_STRING","Bundle",468],["T_NS_SEPARATOR","\\",468],["T_STRING","Model",468],["T_NS_SEPARATOR","\\",468],["T_STRING","Product",468],["T_NS_SEPARATOR","\\",468],["T_STRING","Price",468],["T_DOUBLE_COLON","::",468],["T_STRING","PRICE_TYPE_DYNAMIC",468],",",["T_WHITESPACE"," ",468],["T_VARIABLE","$entityIds",468],")",";",["T_WHITESPACE","\n\n        ",468],["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","_calculateBundleOptionPrice",470],"(",")",";",["T_WHITESPACE","\n        ",470],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","_applyCustomOption",471],"(",")",";",["T_WHITESPACE","\n\n        ",471],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","_movePriceDataToIndexTable",473],"(",")",";",["T_WHITESPACE","\n\n        ",473],["T_RETURN","return",475],["T_WHITESPACE"," ",475],["T_VARIABLE","$this",475],";",["T_WHITESPACE","\n    ",475],"}",["T_WHITESPACE","\n\n    ",476],["T_DOC_COMMENT","\/**\n     * Prepare percentage tier price for bundle products\n     *\n     * @param int|array $entityIds\n     * @return $this\n     *\/",478],["T_WHITESPACE","\n    ",483],["T_PROTECTED","protected",484],["T_WHITESPACE"," ",484],["T_FUNCTION","function",484],["T_WHITESPACE"," ",484],["T_STRING","_prepareTierPriceIndex",484],"(",["T_VARIABLE","$entityIds",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_STRING","null",484],")",["T_WHITESPACE","\n    ",484],"{",["T_WHITESPACE","\n        ",485],["T_VARIABLE","$connection",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getConnection",486],"(",")",";",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$linkField",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getMetadataPool",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getMetadata",487],"(",["T_STRING","ProductInterface",487],["T_DOUBLE_COLON","::",487],["T_CLASS","class",487],")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getLinkField",487],"(",")",";",["T_WHITESPACE","\n        ",487],["T_COMMENT","\/\/ remove index by bundle products\n",488],["T_WHITESPACE","        ",489],["T_VARIABLE","$select",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_VARIABLE","$connection",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","select",489],"(",")",["T_OBJECT_OPERATOR","->",489],["T_STRING","from",489],"(",["T_WHITESPACE","\n            ",489],"[",["T_CONSTANT_ENCAPSED_STRING","'i'",490],["T_WHITESPACE"," ",490],["T_DOUBLE_ARROW","=>",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","_getTierPriceIndexTable",490],"(",")","]",",",["T_WHITESPACE","\n            ",490],["T_STRING","null",491],["T_WHITESPACE","\n        ",491],")",["T_OBJECT_OPERATOR","->",492],["T_STRING","join",492],"(",["T_WHITESPACE","\n            ",492],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",493],["T_WHITESPACE"," ",493],["T_DOUBLE_ARROW","=>",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getTable",493],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",493],")","]",",",["T_WHITESPACE","\n            ",493],["T_CONSTANT_ENCAPSED_STRING","\"i.entity_id=e.entity_id\"",494],",",["T_WHITESPACE","\n            ",494],"[","]",["T_WHITESPACE","\n        ",495],")",["T_OBJECT_OPERATOR","->",496],["T_STRING","where",496],"(",["T_WHITESPACE","\n            ",496],["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",497],",",["T_WHITESPACE","\n            ",497],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getTypeId",498],"(",")",["T_WHITESPACE","\n        ",498],")",";",["T_WHITESPACE","\n        ",499],["T_VARIABLE","$query",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$select",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","deleteFromSelect",500],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",500],")",";",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$connection",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","query",501],"(",["T_VARIABLE","$query",501],")",";",["T_WHITESPACE","\n\n        ",501],["T_VARIABLE","$select",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_VARIABLE","$connection",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","select",503],"(",")",["T_OBJECT_OPERATOR","->",503],["T_STRING","from",503],"(",["T_WHITESPACE","\n            ",503],"[",["T_CONSTANT_ENCAPSED_STRING","'tp'",504],["T_WHITESPACE"," ",504],["T_DOUBLE_ARROW","=>",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getTable",504],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity_tier_price'",504],")","]",",",["T_WHITESPACE","\n            ",504],"[",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",505],"]",["T_WHITESPACE","\n        ",505],")",["T_OBJECT_OPERATOR","->",506],["T_STRING","join",506],"(",["T_WHITESPACE","\n            ",506],"[",["T_CONSTANT_ENCAPSED_STRING","'e'",507],["T_WHITESPACE"," ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getTable",507],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_entity'",507],")","]",",",["T_WHITESPACE","\n            ",507],"\"",["T_ENCAPSED_AND_WHITESPACE","tp.",508],["T_CURLY_OPEN","{",508],["T_VARIABLE","$linkField",508],"}",["T_ENCAPSED_AND_WHITESPACE"," = e.",508],["T_CURLY_OPEN","{",508],["T_VARIABLE","$linkField",508],"}","\"",",",["T_WHITESPACE","\n            ",508],"[","]",["T_WHITESPACE","\n        ",509],")",["T_OBJECT_OPERATOR","->",510],["T_STRING","join",510],"(",["T_WHITESPACE","\n            ",510],"[",["T_CONSTANT_ENCAPSED_STRING","'cg'",511],["T_WHITESPACE"," ",511],["T_DOUBLE_ARROW","=>",511],["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getTable",511],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group'",511],")","]",",",["T_WHITESPACE","\n            ",511],["T_CONSTANT_ENCAPSED_STRING","'tp.all_groups = 1 OR (tp.all_groups = 0 AND tp.customer_group_id = cg.customer_group_id)'",512],",",["T_WHITESPACE","\n            ",512],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",513],"]",["T_WHITESPACE","\n        ",513],")",["T_OBJECT_OPERATOR","->",514],["T_STRING","join",514],"(",["T_WHITESPACE","\n            ",514],"[",["T_CONSTANT_ENCAPSED_STRING","'cw'",515],["T_WHITESPACE"," ",515],["T_DOUBLE_ARROW","=>",515],["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getTable",515],"(",["T_CONSTANT_ENCAPSED_STRING","'store_website'",515],")","]",",",["T_WHITESPACE","\n            ",515],["T_CONSTANT_ENCAPSED_STRING","'tp.website_id = 0 OR tp.website_id = cw.website_id'",516],",",["T_WHITESPACE","\n            ",516],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",517],"]",["T_WHITESPACE","\n        ",517],")",["T_OBJECT_OPERATOR","->",518],["T_STRING","where",518],"(",["T_WHITESPACE","\n            ",518],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",519],["T_WHITESPACE","\n        ",519],")",["T_OBJECT_OPERATOR","->",520],["T_STRING","where",520],"(",["T_WHITESPACE","\n            ",520],["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",521],",",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getTypeId",522],"(",")",["T_WHITESPACE","\n        ",522],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","columns",523],"(",["T_WHITESPACE","\n            ",523],["T_NEW","new",524],["T_WHITESPACE"," ",524],["T_NS_SEPARATOR","\\",524],["T_STRING","Zend_Db_Expr",524],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(tp.value)'",524],")",["T_WHITESPACE","\n        ",524],")",["T_OBJECT_OPERATOR","->",525],["T_STRING","group",525],"(",["T_WHITESPACE","\n            ",525],"[",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",526],",",["T_WHITESPACE"," ",526],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",526],",",["T_WHITESPACE"," ",526],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",526],"]",["T_WHITESPACE","\n        ",526],")",";",["T_WHITESPACE","\n\n        ",527],["T_IF","if",529],["T_WHITESPACE"," ",529],"(","!",["T_EMPTY","empty",529],"(",["T_VARIABLE","$entityIds",529],")",")",["T_WHITESPACE"," ",529],"{",["T_WHITESPACE","\n            ",529],["T_VARIABLE","$select",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","where",530],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$entityIds",530],")",";",["T_WHITESPACE","\n        ",530],"}",["T_WHITESPACE","\n\n        ",531],["T_VARIABLE","$query",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$select",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","insertFromSelect",533],"(",["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","_getTierPriceIndexTable",533],"(",")",")",";",["T_WHITESPACE","\n        ",533],["T_VARIABLE","$connection",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","query",534],"(",["T_VARIABLE","$query",534],")",";",["T_WHITESPACE","\n\n        ",534],["T_RETURN","return",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$this",536],";",["T_WHITESPACE","\n    ",536],"}",["T_WHITESPACE","\n",537],"}",["T_WHITESPACE","\n",538]]