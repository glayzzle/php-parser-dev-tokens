[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Bundle",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Observer",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Event",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ObserverInterface",8],";",["T_WHITESPACE","\n\n",8],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","AppendUpsellProductsObserver",10],["T_WHITESPACE"," ",10],["T_IMPLEMENTS","implements",10],["T_WHITESPACE"," ",10],["T_STRING","ObserverInterface",10],["T_WHITESPACE","\n",10],"{",["T_WHITESPACE","\n    ",11],["T_DOC_COMMENT","\/**\n     * Bundle data\n     *\n     * @var \\Magento\\Bundle\\Helper\\Data\n     *\/",12],["T_WHITESPACE","\n    ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$bundleData",17],";",["T_WHITESPACE","\n\n    ",17],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Bundle\\Model\\ResourceModel\\Selection\n     *\/",19],["T_WHITESPACE","\n    ",21],["T_PROTECTED","protected",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$bundleSelection",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\Config\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$config",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\Product\\Visibility\n     *\/",29],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$productVisibility",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Bundle\\Helper\\Data $bundleData\n     * @param \\Magento\\Catalog\\Model\\Product\\Visibility $productVisibility\n     * @param \\Magento\\Catalog\\Model\\Config $config\n     * @param \\Magento\\Bundle\\Model\\ResourceModel\\Selection $bundleSelection\n     *\/",34],["T_WHITESPACE","\n    ",39],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","__construct",40],"(",["T_WHITESPACE","\n        ",40],["T_NS_SEPARATOR","\\",41],["T_STRING","Magento",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Bundle",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Helper",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Data",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$bundleData",41],",",["T_WHITESPACE","\n        ",41],["T_NS_SEPARATOR","\\",42],["T_STRING","Magento",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Catalog",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Model",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Product",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Visibility",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$productVisibility",42],",",["T_WHITESPACE","\n        ",42],["T_NS_SEPARATOR","\\",43],["T_STRING","Magento",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Catalog",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Model",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Config",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$config",43],",",["T_WHITESPACE","\n        ",43],["T_NS_SEPARATOR","\\",44],["T_STRING","Magento",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Bundle",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Model",44],["T_NS_SEPARATOR","\\",44],["T_STRING","ResourceModel",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Selection",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$bundleSelection",44],["T_WHITESPACE","\n    ",44],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","bundleData",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$bundleData",46],";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","productVisibility",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$productVisibility",47],";",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","config",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$config",48],";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","bundleSelection",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$bundleSelection",49],";",["T_WHITESPACE","\n    ",49],"}",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * Append bundles in upsell list for current product\n     *\n     * @param \\Magento\\Framework\\Event\\Observer $observer\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",52],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","execute",60],"(",["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Framework",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Event",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Observer",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$observer",60],")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_COMMENT","\/* @var $product \\Magento\\Catalog\\Model\\Product *\/",62],["T_WHITESPACE","\n        ",62],["T_VARIABLE","$product",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$observer",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getEvent",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","getProduct",63],"(",")",";",["T_WHITESPACE","\n\n        ",63],["T_DOC_COMMENT","\/**\n         * Check is current product type is allowed for bundle selection product type\n         *\/",65],["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(","!",["T_STRING","in_array",68],"(",["T_VARIABLE","$product",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getTypeId",68],"(",")",",",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","bundleData",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getAllowedSelectionTypes",68],"(",")",")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_COMMENT","\/* @var $collection \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Link\\Product\\Collection *\/",72],["T_WHITESPACE","\n        ",72],["T_VARIABLE","$collection",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$observer",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getEvent",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getCollection",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$limit",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$observer",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getEvent",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","getLimit",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_STRING","is_array",75],"(",["T_VARIABLE","$limit",75],")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_ISSET","isset",76],"(",["T_VARIABLE","$limit",76],"[",["T_CONSTANT_ENCAPSED_STRING","'upsell'",76],"]",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n                ",76],["T_VARIABLE","$limit",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$limit",77],"[",["T_CONSTANT_ENCAPSED_STRING","'upsell'",77],"]",";",["T_WHITESPACE","\n            ",77],"}",["T_WHITESPACE"," ",78],["T_ELSE","else",78],["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n                ",78],["T_VARIABLE","$limit",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_LNUMBER","0",79],";",["T_WHITESPACE","\n            ",79],"}",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_COMMENT","\/* @var $resource \\Magento\\Bundle\\Model\\ResourceModel\\Selection *\/",83],["T_WHITESPACE","\n        ",83],["T_VARIABLE","$resource",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","bundleSelection",84],";",["T_WHITESPACE","\n\n        ",84],["T_VARIABLE","$productIds",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","array_keys",86],"(",["T_VARIABLE","$collection",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getItems",86],"(",")",")",";",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$limit",87],["T_WHITESPACE"," ",87],["T_IS_NOT_IDENTICAL","!==",87],["T_WHITESPACE"," ",87],["T_STRING","null",87],["T_WHITESPACE"," ",87],["T_BOOLEAN_AND","&&",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$limit",87],["T_WHITESPACE"," ",87],["T_IS_SMALLER_OR_EQUAL","<=",87],["T_WHITESPACE"," ",87],["T_STRING","count",87],"(",["T_VARIABLE","$productIds",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_COMMENT","\/\/ retrieve bundle product ids\n",91],["T_WHITESPACE","        ",92],["T_VARIABLE","$bundleIds",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$resource",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getParentIdsByChild",92],"(",["T_VARIABLE","$product",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getId",92],"(",")",")",";",["T_WHITESPACE","\n        ",92],["T_COMMENT","\/\/ exclude up-sell product ids\n",93],["T_WHITESPACE","        ",94],["T_VARIABLE","$bundleIds",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","array_diff",94],"(",["T_VARIABLE","$bundleIds",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$productIds",94],")",";",["T_WHITESPACE","\n\n        ",94],["T_IF","if",96],["T_WHITESPACE"," ",96],"(","!",["T_VARIABLE","$bundleIds",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n        ",97],"}",["T_WHITESPACE","\n\n        ",98],["T_COMMENT","\/* @var $bundleCollection \\Magento\\Catalog\\Model\\ResourceModel\\Product\\Collection *\/",100],["T_WHITESPACE","\n        ",100],["T_VARIABLE","$bundleCollection",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$product",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getCollection",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","addAttributeToSelect",101],"(",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","config",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getProductAttributes",102],"(",")",["T_WHITESPACE","\n        ",102],")",["T_OBJECT_OPERATOR","->",103],["T_STRING","addStoreFilter",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","addMinimalPrice",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","addFinalPrice",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","addTaxPercents",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","setVisibility",103],"(",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","productVisibility",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getVisibleInCatalogIds",104],"(",")",["T_WHITESPACE","\n        ",104],")",";",["T_WHITESPACE","\n\n        ",105],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$limit",107],["T_WHITESPACE"," ",107],["T_IS_NOT_IDENTICAL","!==",107],["T_WHITESPACE"," ",107],["T_STRING","null",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$bundleCollection",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","setPageSize",108],"(",["T_VARIABLE","$limit",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$bundleCollection",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","addFieldToFilter",110],"(",["T_WHITESPACE","\n            ",110],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",111],",",["T_WHITESPACE","\n            ",111],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$bundleIds",112],"]",["T_WHITESPACE","\n        ",112],")",["T_OBJECT_OPERATOR","->",113],["T_STRING","setFlag",113],"(",["T_WHITESPACE","\n            ",113],["T_CONSTANT_ENCAPSED_STRING","'do_not_use_category_id'",114],",",["T_WHITESPACE","\n            ",114],["T_STRING","true",115],["T_WHITESPACE","\n        ",115],")",";",["T_WHITESPACE","\n\n        ",116],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$collection",118],["T_WHITESPACE"," ",118],["T_INSTANCEOF","instanceof",118],["T_WHITESPACE"," ",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Magento",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Framework",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Data",118],["T_NS_SEPARATOR","\\",118],["T_STRING","Collection",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_FOREACH","foreach",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$bundleCollection",119],["T_WHITESPACE"," ",119],["T_AS","as",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$item",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$collection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","addItem",120],"(",["T_VARIABLE","$item",120],")",";",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE"," ",122],["T_ELSEIF","elseif",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$collection",122],["T_WHITESPACE"," ",122],["T_INSTANCEOF","instanceof",122],["T_WHITESPACE"," ",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Magento",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Framework",122],["T_NS_SEPARATOR","\\",122],["T_STRING","DataObject",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$items",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$collection",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getItems",123],"(",")",";",["T_WHITESPACE","\n            ",123],["T_FOREACH","foreach",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$bundleCollection",124],["T_WHITESPACE"," ",124],["T_AS","as",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$item",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$items",125],"[",["T_VARIABLE","$item",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getEntityId",125],"(",")","]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$item",125],";",["T_WHITESPACE","\n            ",125],"}",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$collection",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","setItems",127],"(",["T_VARIABLE","$items",127],")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n\n        ",128],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n",131],"}",["T_WHITESPACE","\n",132]]