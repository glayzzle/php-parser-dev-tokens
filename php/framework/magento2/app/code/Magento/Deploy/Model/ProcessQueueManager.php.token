[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Deploy",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","App",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceConnection",9],";",["T_WHITESPACE","\n\n",9],["T_CLASS","class",11],["T_WHITESPACE"," ",11],["T_STRING","ProcessQueueManager",11],["T_WHITESPACE","\n",11],"{",["T_WHITESPACE","\n    ",12],["T_DOC_COMMENT","\/**\n     * Default max amount of processes\n     *\/",13],["T_WHITESPACE","\n    ",15],["T_CONST","const",16],["T_WHITESPACE"," ",16],["T_STRING","DEFAULT_MAX_PROCESSES_AMOUNT",16],["T_WHITESPACE"," ",16],"=",["T_WHITESPACE"," ",16],["T_LNUMBER","4",16],";",["T_WHITESPACE","\n\n    ",16],["T_DOC_COMMENT","\/**\n     * @var ProcessTask[]\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PRIVATE","private",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$tasksQueue",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],"[","]",";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var ProcessTask[]\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$processTaskMap",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],"[","]",";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @var int\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PRIVATE","private",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$maxProcesses",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var ProcessManager\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PRIVATE","private",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$processManager",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @var ResourceConnection\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PRIVATE","private",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$resourceConnection",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var ProcessTaskFactory\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PRIVATE","private",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$processTaskFactory",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @param ProcessManager $processManager\n     * @param ResourceConnection $resourceConnection\n     * @param ProcessTaskFactory $processTaskFactory\n     * @param int $maxProcesses\n     *\/",48],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","__construct",54],"(",["T_WHITESPACE","\n        ",54],["T_STRING","ProcessManager",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$processManager",55],",",["T_WHITESPACE","\n        ",55],["T_STRING","ResourceConnection",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$resourceConnection",56],",",["T_WHITESPACE","\n        ",56],["T_STRING","ProcessTaskFactory",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$processTaskFactory",57],",",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$maxProcesses",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","self",58],["T_DOUBLE_COLON","::",58],["T_STRING","DEFAULT_MAX_PROCESSES_AMOUNT",58],["T_WHITESPACE","\n    ",58],")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","processManager",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$processManager",60],";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","resourceConnection",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$resourceConnection",61],";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","processTaskFactory",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$processTaskFactory",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","maxProcesses",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$maxProcesses",63],";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * @param callable $task\n     * @param callable[] $dependentTasks\n     * @return void\n     *\/",66],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","addTaskToQueue",71],"(",["T_CALLABLE","callable",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$task",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$dependentTasks",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],"[","]",")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$dependentTasks",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","array_map",73],"(",["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],"(",["T_CALLABLE","callable",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$task",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","createTask",74],"(",["T_VARIABLE","$task",74],")",";",["T_WHITESPACE","\n        ",74],"}",",",["T_WHITESPACE"," ",75],["T_VARIABLE","$dependentTasks",75],")",";",["T_WHITESPACE","\n\n        ",75],["T_VARIABLE","$task",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","createTask",77],"(",["T_VARIABLE","$task",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$dependentTasks",77],")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","tasksQueue",78],"[",["T_VARIABLE","$task",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getId",78],"(",")","]",["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$task",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Process tasks queue\n     * @return int\n     *\/",81],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","process",85],"(",")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$processQueue",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],"[","]",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","internalQueueProcess",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","tasksQueue",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$processQueue",88],")",";",["T_WHITESPACE","\n\n        ",88],["T_VARIABLE","$returnStatus",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_LNUMBER","0",90],";",["T_WHITESPACE","\n        ",90],["T_WHILE","while",91],["T_WHITESPACE"," ",91],"(",["T_STRING","count",91],"(",["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","processManager",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getProcesses",91],"(",")",")",["T_WHITESPACE"," ",91],">",["T_WHITESPACE"," ",91],["T_LNUMBER","0",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_FOREACH","foreach",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","processManager",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getProcesses",92],"(",")",["T_WHITESPACE"," ",92],["T_AS","as",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$process",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$process",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","isCompleted",93],"(",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                    ",93],["T_VARIABLE","$dependedTasks",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_ISSET","isset",94],"(",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","processTaskMap",94],"[",["T_VARIABLE","$process",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getPid",94],"(",")","]",")",["T_WHITESPACE","\n                        ",94],"?",["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","processTaskMap",95],"[",["T_VARIABLE","$process",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getPid",95],"(",")","]",["T_WHITESPACE","\n                        ",95],":",["T_WHITESPACE"," ",96],"[","]",";",["T_WHITESPACE","\n\n                    ",96],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","processManager",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","delete",98],"(",["T_VARIABLE","$process",98],")",";",["T_WHITESPACE","\n                    ",98],["T_VARIABLE","$returnStatus",99],["T_WHITESPACE"," ",99],["T_OR_EQUAL","|=",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$process",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getStatus",99],"(",")",";",["T_WHITESPACE","\n\n                    ",99],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","internalQueueProcess",101],"(",["T_STRING","array_merge",101],"(",["T_VARIABLE","$processQueue",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$dependedTasks",101],")",",",["T_WHITESPACE"," ",101],["T_VARIABLE","$processQueue",101],")",";",["T_WHITESPACE","\n\n                    ",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_STRING","count",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","processManager",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getProcesses",103],"(",")",")",["T_WHITESPACE"," ",103],["T_IS_GREATER_OR_EQUAL",">=",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","maxProcesses",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n                        ",103],["T_BREAK","break",104],["T_WHITESPACE"," ",104],["T_LNUMBER","1",104],";",["T_WHITESPACE","\n                    ",104],"}",["T_WHITESPACE","\n                ",105],"}",["T_WHITESPACE","\n            ",106],"}",["T_WHITESPACE","\n            ",107],["T_STRING","usleep",108],"(",["T_LNUMBER","5000",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","resourceConnection",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","closeConnection",110],"(",")",";",["T_WHITESPACE","\n\n        ",110],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$returnStatus",112],";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * @param ProcessTask[] $taskQueue\n     * @param ProcessTask[] $processQueue\n     * @return void\n     *\/",115],["T_WHITESPACE","\n    ",119],["T_PRIVATE","private",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","internalQueueProcess",120],"(",["T_VARIABLE","$taskQueue",120],",",["T_WHITESPACE"," ",120],"&",["T_VARIABLE","$processQueue",120],")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$processNumber",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","count",122],"(",["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","processManager",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getProcesses",122],"(",")",")",";",["T_WHITESPACE","\n        ",122],["T_FOREACH","foreach",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$taskQueue",123],["T_WHITESPACE"," ",123],["T_AS","as",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$task",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_IF","if",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$processNumber",124],["T_WHITESPACE"," ",124],["T_IS_GREATER_OR_EQUAL",">=",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","maxProcesses",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(","!",["T_ISSET","isset",125],"(",["T_VARIABLE","$processQueue",125],"[",["T_VARIABLE","$task",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getId",125],"(",")","]",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                    ",125],["T_VARIABLE","$processQueue",126],"[",["T_VARIABLE","$task",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getId",126],"(",")","]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$task",126],";",["T_WHITESPACE","\n                ",126],"}",["T_WHITESPACE","\n            ",127],"}",["T_WHITESPACE"," ",128],["T_ELSE","else",128],["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                ",128],["T_UNSET","unset",129],"(",["T_VARIABLE","$processQueue",129],"[",["T_VARIABLE","$task",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")","]",")",";",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","fork",130],"(",["T_VARIABLE","$task",130],")",";",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$processNumber",131],["T_INC","++",131],";",["T_WHITESPACE","\n            ",131],"}",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * @param callable $handler\n     * @param array $dependentTasks\n     * @return ProcessTask\n     *\/",136],["T_WHITESPACE","\n    ",140],["T_PRIVATE","private",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","createTask",141],"(",["T_VARIABLE","$handler",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$dependentTasks",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],"[","]",")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","processTaskFactory",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","create",143],"(","[",["T_CONSTANT_ENCAPSED_STRING","'handler'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$handler",143],",",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'dependentTasks'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$dependentTasks",143],"]",")",";",["T_WHITESPACE","\n    ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * @param ProcessTask $task\n     * @return void\n     *\/",146],["T_WHITESPACE","\n    ",149],["T_PRIVATE","private",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","fork",150],"(",["T_STRING","ProcessTask",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$task",150],")",["T_WHITESPACE","\n    ",150],"{",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$process",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","processManager",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","fork",152],"(",["T_VARIABLE","$task",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getHandler",152],"(",")",")",";",["T_WHITESPACE","\n        ",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$task",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getDependentTasks",153],"(",")",")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$pid",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$process",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getPid",154],"(",")",";",["T_WHITESPACE","\n            ",154],["T_FOREACH","foreach",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$task",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getDependentTasks",155],"(",")",["T_WHITESPACE"," ",155],["T_AS","as",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$dependentTask",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","processTaskMap",156],"[",["T_VARIABLE","$pid",156],"]","[",["T_VARIABLE","$dependentTask",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getId",156],"(",")","]",["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$dependentTask",156],";",["T_WHITESPACE","\n            ",156],"}",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n",159],"}",["T_WHITESPACE","\n",160]]