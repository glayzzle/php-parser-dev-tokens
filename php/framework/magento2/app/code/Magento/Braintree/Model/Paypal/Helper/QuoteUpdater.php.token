[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Braintree",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Paypal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Helper",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Quote",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Quote",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Address",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Quote",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Quote",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Payment",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Quote",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CartRepositoryInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Braintree",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Ui",12],["T_NS_SEPARATOR","\\",12],["T_STRING","PayPal",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ConfigProvider",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Exception",13],["T_NS_SEPARATOR","\\",13],["T_STRING","LocalizedException",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Braintree",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Observer",14],["T_NS_SEPARATOR","\\",14],["T_STRING","DataAssignObserver",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Braintree",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Gateway",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Config",15],["T_NS_SEPARATOR","\\",15],["T_STRING","PayPal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Config",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Class QuoteUpdater\n *\/",17],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","QuoteUpdater",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","AbstractHelper",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/**\n     * @var Config\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PRIVATE","private",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$config",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var CartRepositoryInterface\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PRIVATE","private",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$quoteRepository",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param Config $config\n     * @param CartRepositoryInterface $quoteRepository\n     *\/",32],["T_WHITESPACE","\n    ",37],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","__construct",38],"(",["T_WHITESPACE","\n        ",38],["T_STRING","Config",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$config",39],",",["T_WHITESPACE","\n        ",39],["T_STRING","CartRepositoryInterface",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$quoteRepository",40],["T_WHITESPACE","\n    ",40],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","config",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$config",42],";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","quoteRepository",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$quoteRepository",43],";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Execute operation\n     *\n     * @param string $nonce\n     * @param array $details\n     * @param Quote $quote\n     * @return void\n     * @throws \\InvalidArgumentException\n     * @throws LocalizedException\n     *\/",46],["T_WHITESPACE","\n    ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","execute",56],"(",["T_VARIABLE","$nonce",56],",",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$details",56],",",["T_WHITESPACE"," ",56],["T_STRING","Quote",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$quote",56],")",["T_WHITESPACE","\n    ",56],"{",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_EMPTY","empty",58],"(",["T_VARIABLE","$nonce",58],")",["T_WHITESPACE"," ",58],["T_BOOLEAN_OR","||",58],["T_WHITESPACE"," ",58],["T_EMPTY","empty",58],"(",["T_VARIABLE","$details",58],")",")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_THROW","throw",59],["T_WHITESPACE"," ",59],["T_NEW","new",59],["T_WHITESPACE"," ",59],["T_NS_SEPARATOR","\\",59],["T_STRING","InvalidArgumentException",59],"(",["T_CONSTANT_ENCAPSED_STRING","'The \"nonce\" and \"details\" fields does not exists'",59],")",";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n\n        ",60],["T_VARIABLE","$payment",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$quote",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getPayment",62],"(",")",";",["T_WHITESPACE","\n\n        ",62],["T_VARIABLE","$payment",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","setMethod",64],"(",["T_STRING","ConfigProvider",64],["T_DOUBLE_COLON","::",64],["T_STRING","PAYPAL_CODE",64],")",";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$payment",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","setAdditionalInformation",65],"(",["T_STRING","DataAssignObserver",65],["T_DOUBLE_COLON","::",65],["T_STRING","PAYMENT_METHOD_NONCE",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$nonce",65],")",";",["T_WHITESPACE","\n\n        ",65],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","updateQuote",67],"(",["T_VARIABLE","$quote",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$details",67],")",";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Update quote data\n     *\n     * @param Quote $quote\n     * @param array $details\n     * @return void\n     *\/",70],["T_WHITESPACE","\n    ",76],["T_PRIVATE","private",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","updateQuote",77],"(",["T_STRING","Quote",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$quote",77],",",["T_WHITESPACE"," ",77],["T_ARRAY","array",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$details",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$quote",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","setMayEditShippingAddress",79],"(",["T_STRING","false",79],")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$quote",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","setMayEditShippingMethod",80],"(",["T_STRING","true",80],")",";",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","updateQuoteAddress",82],"(",["T_VARIABLE","$quote",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$details",82],")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","disabledQuoteAddressValidation",83],"(",["T_VARIABLE","$quote",83],")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$quote",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","collectTotals",85],"(",")",";",["T_WHITESPACE","\n\n        ",85],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","quoteRepository",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","save",87],"(",["T_VARIABLE","$quote",87],")",";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Update quote address\n     *\n     * @param Quote $quote\n     * @param array $details\n     * @return void\n     *\/",90],["T_WHITESPACE","\n    ",96],["T_PRIVATE","private",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","updateQuoteAddress",97],"(",["T_STRING","Quote",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$quote",97],",",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$details",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(","!",["T_VARIABLE","$quote",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getIsVirtual",99],"(",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","updateShippingAddress",100],"(",["T_VARIABLE","$quote",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$details",100],")",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n\n        ",101],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","updateBillingAddress",103],"(",["T_VARIABLE","$quote",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$details",103],")",";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Update shipping address\n     * (PayPal doesn't provide detailed shipping info: prefix, suffix)\n     *\n     * @param Quote $quote\n     * @param array $details\n     * @return void\n     *\/",106],["T_WHITESPACE","\n    ",113],["T_PRIVATE","private",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","updateShippingAddress",114],"(",["T_STRING","Quote",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$quote",114],",",["T_WHITESPACE"," ",114],["T_ARRAY","array",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$details",114],")",["T_WHITESPACE","\n    ",114],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$shippingAddress",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$quote",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getShippingAddress",116],"(",")",";",["T_WHITESPACE","\n\n        ",116],["T_VARIABLE","$shippingAddress",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","setLastname",118],"(",["T_VARIABLE","$details",118],"[",["T_CONSTANT_ENCAPSED_STRING","'lastName'",118],"]",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$shippingAddress",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","setFirstname",119],"(",["T_VARIABLE","$details",119],"[",["T_CONSTANT_ENCAPSED_STRING","'firstName'",119],"]",")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$shippingAddress",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","setEmail",120],"(",["T_VARIABLE","$details",120],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",120],"]",")",";",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$shippingAddress",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","setCollectShippingRates",122],"(",["T_STRING","true",122],")",";",["T_WHITESPACE","\n\n        ",122],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","updateAddressData",124],"(",["T_VARIABLE","$shippingAddress",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$details",124],"[",["T_CONSTANT_ENCAPSED_STRING","'shippingAddress'",124],"]",")",";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Update billing address\n     *\n     * @param Quote $quote\n     * @param array $details\n     * @return void\n     *\/",127],["T_WHITESPACE","\n    ",133],["T_PRIVATE","private",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","updateBillingAddress",134],"(",["T_STRING","Quote",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$quote",134],",",["T_WHITESPACE"," ",134],["T_ARRAY","array",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$details",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$billingAddress",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$quote",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getBillingAddress",136],"(",")",";",["T_WHITESPACE","\n\n        ",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","config",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","isRequiredBillingAddress",138],"(",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","updateAddressData",139],"(",["T_VARIABLE","$billingAddress",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$details",139],"[",["T_CONSTANT_ENCAPSED_STRING","'billingAddress'",139],"]",")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE"," ",140],["T_ELSE","else",140],["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","updateAddressData",141],"(",["T_VARIABLE","$billingAddress",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$details",141],"[",["T_CONSTANT_ENCAPSED_STRING","'shippingAddress'",141],"]",")",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$billingAddress",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setFirstname",144],"(",["T_VARIABLE","$details",144],"[",["T_CONSTANT_ENCAPSED_STRING","'firstName'",144],"]",")",";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$billingAddress",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","setLastname",145],"(",["T_VARIABLE","$details",145],"[",["T_CONSTANT_ENCAPSED_STRING","'lastName'",145],"]",")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$billingAddress",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","setEmail",146],"(",["T_VARIABLE","$details",146],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",146],"]",")",";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Sets address data from exported address\n     *\n     * @param Address $address\n     * @param array $addressData\n     * @return void\n     *\/",149],["T_WHITESPACE","\n    ",155],["T_PRIVATE","private",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","updateAddressData",156],"(",["T_STRING","Address",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$address",156],",",["T_WHITESPACE"," ",156],["T_ARRAY","array",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$addressData",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$extendedAddress",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_ISSET","isset",158],"(",["T_VARIABLE","$addressData",158],"[",["T_CONSTANT_ENCAPSED_STRING","'extendedAddress'",158],"]",")",["T_WHITESPACE","\n            ",158],"?",["T_WHITESPACE"," ",159],["T_VARIABLE","$addressData",159],"[",["T_CONSTANT_ENCAPSED_STRING","'extendedAddress'",159],"]",["T_WHITESPACE","\n            ",159],":",["T_WHITESPACE"," ",160],["T_STRING","null",160],";",["T_WHITESPACE","\n\n        ",160],["T_VARIABLE","$address",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","setStreet",162],"(","[",["T_VARIABLE","$addressData",162],"[",["T_CONSTANT_ENCAPSED_STRING","'streetAddress'",162],"]",",",["T_WHITESPACE"," ",162],["T_VARIABLE","$extendedAddress",162],"]",")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$address",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","setCity",163],"(",["T_VARIABLE","$addressData",163],"[",["T_CONSTANT_ENCAPSED_STRING","'locality'",163],"]",")",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$address",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setRegionCode",164],"(",["T_VARIABLE","$addressData",164],"[",["T_CONSTANT_ENCAPSED_STRING","'region'",164],"]",")",";",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$address",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","setCountryId",165],"(",["T_VARIABLE","$addressData",165],"[",["T_CONSTANT_ENCAPSED_STRING","'countryCodeAlpha2'",165],"]",")",";",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$address",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setPostcode",166],"(",["T_VARIABLE","$addressData",166],"[",["T_CONSTANT_ENCAPSED_STRING","'postalCode'",166],"]",")",";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n",167],"}",["T_WHITESPACE","\n",168]]