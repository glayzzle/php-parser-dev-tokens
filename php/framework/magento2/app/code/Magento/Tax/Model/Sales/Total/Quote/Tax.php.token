[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tax",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Total",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Customer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AddressInterfaceFactory",8],["T_WHITESPACE"," ",8],["T_AS","as",8],["T_WHITESPACE"," ",8],["T_STRING","CustomerAddressFactory",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Customer",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","RegionInterfaceFactory",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","CustomerAddressRegionFactory",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Quote",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Quote",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Address",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Tax",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","TaxClassKeyInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Tax",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Calculation",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Quote",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Data",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ShippingAssignmentInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Serialize",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Serializer",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Json",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","App",15],["T_NS_SEPARATOR","\\",15],["T_STRING","ObjectManager",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Tax totals calculation model\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",17],["T_WHITESPACE","\n",20],["T_CLASS","class",21],["T_WHITESPACE"," ",21],["T_STRING","Tax",21],["T_WHITESPACE"," ",21],["T_EXTENDS","extends",21],["T_WHITESPACE"," ",21],["T_STRING","CommonTaxCollector",21],["T_WHITESPACE","\n",21],"{",["T_WHITESPACE","\n    ",22],["T_DOC_COMMENT","\/**\n     * Counter\n     *\n     * @var int\n     *\/",23],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$counter",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_LNUMBER","0",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Tax module helper\n     *\n     * @var \\Magento\\Tax\\Helper\\Data\n     *\/",30],["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$_taxData",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var \\Magento\\Tax\\Model\\Config\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_config",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Discount tax compensationes array\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_discountTaxCompensationes",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],"[","]",";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * @var Json\n     *\/",51],["T_WHITESPACE","\n    ",53],["T_PRIVATE","private",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$serializer",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     * @param \\Magento\\Tax\\Model\\Config $taxConfig\n     * @param \\Magento\\Tax\\Api\\TaxCalculationInterface $taxCalculationService\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsInterfaceFactory $quoteDetailsDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory $quoteDetailsItemDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\TaxClassKeyInterfaceFactory $taxClassKeyDataObjectFactory\n     * @param CustomerAddressFactory $customerAddressFactory\n     * @param CustomerAddressRegionFactory $customerAddressRegionFactory\n     * @param \\Magento\\Tax\\Helper\\Data $taxData\n     * @param Json $serializer\n     *\/",56],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","__construct",69],"(",["T_WHITESPACE","\n        ",69],["T_NS_SEPARATOR","\\",70],["T_STRING","Magento",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Tax",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Model",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Config",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$taxConfig",70],",",["T_WHITESPACE","\n        ",70],["T_NS_SEPARATOR","\\",71],["T_STRING","Magento",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Tax",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Api",71],["T_NS_SEPARATOR","\\",71],["T_STRING","TaxCalculationInterface",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$taxCalculationService",71],",",["T_WHITESPACE","\n        ",71],["T_NS_SEPARATOR","\\",72],["T_STRING","Magento",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Tax",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Api",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Data",72],["T_NS_SEPARATOR","\\",72],["T_STRING","QuoteDetailsInterfaceFactory",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$quoteDetailsDataObjectFactory",72],",",["T_WHITESPACE","\n        ",72],["T_NS_SEPARATOR","\\",73],["T_STRING","Magento",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Tax",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Api",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Data",73],["T_NS_SEPARATOR","\\",73],["T_STRING","QuoteDetailsItemInterfaceFactory",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$quoteDetailsItemDataObjectFactory",73],",",["T_WHITESPACE","\n        ",73],["T_NS_SEPARATOR","\\",74],["T_STRING","Magento",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Tax",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Api",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Data",74],["T_NS_SEPARATOR","\\",74],["T_STRING","TaxClassKeyInterfaceFactory",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$taxClassKeyDataObjectFactory",74],",",["T_WHITESPACE","\n        ",74],["T_STRING","CustomerAddressFactory",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$customerAddressFactory",75],",",["T_WHITESPACE","\n        ",75],["T_STRING","CustomerAddressRegionFactory",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$customerAddressRegionFactory",76],",",["T_WHITESPACE","\n        ",76],["T_NS_SEPARATOR","\\",77],["T_STRING","Magento",77],["T_NS_SEPARATOR","\\",77],["T_STRING","Tax",77],["T_NS_SEPARATOR","\\",77],["T_STRING","Helper",77],["T_NS_SEPARATOR","\\",77],["T_STRING","Data",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$taxData",77],",",["T_WHITESPACE","\n        ",77],["T_STRING","Json",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$serializer",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","null",78],["T_WHITESPACE","\n    ",78],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","setCode",80],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",80],")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_taxData",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$taxData",81],";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","serializer",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$serializer",82],["T_WHITESPACE"," ",82],"?",":",["T_WHITESPACE"," ",82],["T_STRING","ObjectManager",82],["T_DOUBLE_COLON","::",82],["T_STRING","getInstance",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","get",82],"(",["T_STRING","Json",82],["T_DOUBLE_COLON","::",82],["T_CLASS","class",82],")",";",["T_WHITESPACE","\n        ",82],["T_STRING","parent",83],["T_DOUBLE_COLON","::",83],["T_STRING","__construct",83],"(",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$taxConfig",84],",",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$taxCalculationService",85],",",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$quoteDetailsDataObjectFactory",86],",",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$quoteDetailsItemDataObjectFactory",87],",",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$taxClassKeyDataObjectFactory",88],",",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$customerAddressFactory",89],",",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$customerAddressRegionFactory",90],["T_WHITESPACE","\n        ",90],")",";",["T_WHITESPACE","\n    ",91],"}",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Collect tax totals for quote address\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param Address\\Total $total\n     * @return $this\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",94],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","collect",103],"(",["T_WHITESPACE","\n        ",103],["T_NS_SEPARATOR","\\",104],["T_STRING","Magento",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Quote",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Model",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Quote",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$quote",104],",",["T_WHITESPACE","\n        ",104],["T_NS_SEPARATOR","\\",105],["T_STRING","Magento",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Quote",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Api",105],["T_NS_SEPARATOR","\\",105],["T_STRING","Data",105],["T_NS_SEPARATOR","\\",105],["T_STRING","ShippingAssignmentInterface",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$shippingAssignment",105],",",["T_WHITESPACE","\n        ",105],["T_NS_SEPARATOR","\\",106],["T_STRING","Magento",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Quote",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Model",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Quote",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Address",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Total",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$total",106],["T_WHITESPACE","\n    ",106],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","clearValues",108],"(",["T_VARIABLE","$total",108],")",";",["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(","!",["T_VARIABLE","$shippingAssignment",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getItems",109],"(",")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$baseTaxDetails",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getQuoteTaxDetails",113],"(",["T_VARIABLE","$shippingAssignment",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$total",113],",",["T_WHITESPACE"," ",113],["T_STRING","true",113],")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$taxDetails",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getQuoteTaxDetails",114],"(",["T_VARIABLE","$shippingAssignment",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$total",114],",",["T_WHITESPACE"," ",114],["T_STRING","false",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_COMMENT","\/\/Populate address and items with tax calculation results\n",116],["T_WHITESPACE","        ",117],["T_VARIABLE","$itemsByType",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","organizeItemTaxDetailsByType",117],"(",["T_VARIABLE","$taxDetails",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$baseTaxDetails",117],")",";",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_ISSET","isset",118],"(",["T_VARIABLE","$itemsByType",118],"[",["T_STRING","self",118],["T_DOUBLE_COLON","::",118],["T_STRING","ITEM_TYPE_PRODUCT",118],"]",")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","processProductItems",119],"(",["T_VARIABLE","$shippingAssignment",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$itemsByType",119],"[",["T_STRING","self",119],["T_DOUBLE_COLON","::",119],["T_STRING","ITEM_TYPE_PRODUCT",119],"]",",",["T_WHITESPACE"," ",119],["T_VARIABLE","$total",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_ISSET","isset",122],"(",["T_VARIABLE","$itemsByType",122],"[",["T_STRING","self",122],["T_DOUBLE_COLON","::",122],["T_STRING","ITEM_TYPE_SHIPPING",122],"]",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$shippingTaxDetails",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$itemsByType",123],"[",["T_STRING","self",123],["T_DOUBLE_COLON","::",123],["T_STRING","ITEM_TYPE_SHIPPING",123],"]","[",["T_STRING","self",123],["T_DOUBLE_COLON","::",123],["T_STRING","ITEM_CODE_SHIPPING",123],"]","[",["T_STRING","self",123],["T_DOUBLE_COLON","::",123],["T_STRING","KEY_ITEM",123],"]",";",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$baseShippingTaxDetails",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$itemsByType",125],"[",["T_STRING","self",125],["T_DOUBLE_COLON","::",125],["T_STRING","ITEM_TYPE_SHIPPING",125],"]","[",["T_STRING","self",125],["T_DOUBLE_COLON","::",125],["T_STRING","ITEM_CODE_SHIPPING",125],"]","[",["T_STRING","self",125],["T_DOUBLE_COLON","::",125],["T_STRING","KEY_BASE_ITEM",125],"]",";",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","processShippingTaxInfo",126],"(",["T_VARIABLE","$shippingAssignment",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$total",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$shippingTaxDetails",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$baseShippingTaxDetails",126],")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_COMMENT","\/\/Process taxable items that are not product or shipping\n",129],["T_WHITESPACE","        ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","processExtraTaxables",130],"(",["T_VARIABLE","$total",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$itemsByType",130],")",";",["T_WHITESPACE","\n\n        ",130],["T_COMMENT","\/\/Save applied taxes for each item and the quote in aggregation\n",132],["T_WHITESPACE","        ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","processAppliedTaxes",133],"(",["T_VARIABLE","$total",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$shippingAssignment",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$itemsByType",133],")",";",["T_WHITESPACE","\n\n        ",133],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","includeExtraTax",135],"(",")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$total",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","addTotalAmount",136],"(",["T_CONSTANT_ENCAPSED_STRING","'extra_tax'",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$total",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getExtraTaxAmount",136],"(",")",")",";",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$total",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","addBaseTotalAmount",137],"(",["T_CONSTANT_ENCAPSED_STRING","'extra_tax'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$total",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getBaseExtraTaxAmount",137],"(",")",")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n\n        ",138],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Clear tax related total values in address\n     *\n     * @param Address\\Total $total\n     * @return void\n     *\/",143],["T_WHITESPACE","\n    ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","clearValues",149],"(",["T_STRING","Address",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Total",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$total",149],")",["T_WHITESPACE","\n    ",149],"{",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$total",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","setTotalAmount",151],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",151],",",["T_WHITESPACE"," ",151],["T_LNUMBER","0",151],")",";",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$total",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","setBaseTotalAmount",152],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",152],",",["T_WHITESPACE"," ",152],["T_LNUMBER","0",152],")",";",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$total",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","setTotalAmount",153],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",153],",",["T_WHITESPACE"," ",153],["T_LNUMBER","0",153],")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$total",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","setBaseTotalAmount",154],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",154],",",["T_WHITESPACE"," ",154],["T_LNUMBER","0",154],")",";",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$total",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","setTotalAmount",155],"(",["T_CONSTANT_ENCAPSED_STRING","'discount_tax_compensation'",155],",",["T_WHITESPACE"," ",155],["T_LNUMBER","0",155],")",";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$total",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","setBaseTotalAmount",156],"(",["T_CONSTANT_ENCAPSED_STRING","'discount_tax_compensation'",156],",",["T_WHITESPACE"," ",156],["T_LNUMBER","0",156],")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$total",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","setTotalAmount",157],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_discount_tax_compensation'",157],",",["T_WHITESPACE"," ",157],["T_LNUMBER","0",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$total",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","setBaseTotalAmount",158],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_discount_tax_compensation'",158],",",["T_WHITESPACE"," ",158],["T_LNUMBER","0",158],")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$total",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","setSubtotalInclTax",159],"(",["T_LNUMBER","0",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$total",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","setBaseSubtotalInclTax",160],"(",["T_LNUMBER","0",160],")",";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Call tax calculation service to get tax details on the quote and items\n     *\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param Address\\Total $total\n     * @param bool $useBaseCurrency\n     * @return \\Magento\\Tax\\Api\\Data\\TaxDetailsInterface\n     *\/",163],["T_WHITESPACE","\n    ",170],["T_PROTECTED","protected",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","getQuoteTaxDetails",171],"(",["T_VARIABLE","$shippingAssignment",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$total",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$useBaseCurrency",171],")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$address",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$shippingAssignment",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getShipping",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","getAddress",173],"(",")",";",["T_WHITESPACE","\n        ",173],["T_COMMENT","\/\/Setup taxable items\n",174],["T_WHITESPACE","        ",175],["T_VARIABLE","$priceIncludesTax",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_config",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","priceIncludesTax",175],"(",["T_VARIABLE","$address",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getQuote",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","getStore",175],"(",")",")",";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$itemDataObjects",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","mapItems",176],"(",["T_VARIABLE","$shippingAssignment",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$priceIncludesTax",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$useBaseCurrency",176],")",";",["T_WHITESPACE","\n\n        ",176],["T_COMMENT","\/\/Add shipping\n",178],["T_WHITESPACE","        ",179],["T_VARIABLE","$shippingDataObject",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getShippingDataObject",179],"(",["T_VARIABLE","$shippingAssignment",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$total",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$useBaseCurrency",179],")",";",["T_WHITESPACE","\n        ",179],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$shippingDataObject",180],["T_WHITESPACE"," ",180],["T_IS_NOT_EQUAL","!=",180],["T_WHITESPACE"," ",180],["T_STRING","null",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$itemDataObjects",181],"[","]",["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$shippingDataObject",181],";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n\n        ",182],["T_COMMENT","\/\/process extra taxable items associated only with quote\n",184],["T_WHITESPACE","        ",185],["T_VARIABLE","$quoteExtraTaxables",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","mapQuoteExtraTaxables",185],"(",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","quoteDetailsItemDataObjectFactory",186],",",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$address",187],",",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$useBaseCurrency",188],["T_WHITESPACE","\n        ",188],")",";",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_EMPTY","empty",190],"(",["T_VARIABLE","$quoteExtraTaxables",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$itemDataObjects",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","array_merge",191],"(",["T_VARIABLE","$itemDataObjects",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$quoteExtraTaxables",191],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n\n        ",192],["T_COMMENT","\/\/Preparation for calling taxCalculationService\n",194],["T_WHITESPACE","        ",195],["T_VARIABLE","$quoteDetails",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","prepareQuoteDetails",195],"(",["T_VARIABLE","$shippingAssignment",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$itemDataObjects",195],")",";",["T_WHITESPACE","\n\n        ",195],["T_VARIABLE","$taxDetails",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","taxCalculationService",197],["T_WHITESPACE","\n            ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","calculateTax",198],"(",["T_VARIABLE","$quoteDetails",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$address",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getQuote",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getStore",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getStoreId",198],"(",")",")",";",["T_WHITESPACE","\n\n        ",198],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$taxDetails",200],";",["T_WHITESPACE","\n    ",200],"}",["T_WHITESPACE","\n\n    ",201],["T_DOC_COMMENT","\/**\n     * Map extra taxables associated with quote\n     *\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory $itemDataObjectFactory\n     * @param Address $address\n     * @param bool $useBaseCurrency\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface[]\n     *\/",203],["T_WHITESPACE","\n    ",210],["T_PUBLIC","public",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","mapQuoteExtraTaxables",211],"(",["T_WHITESPACE","\n        ",211],["T_NS_SEPARATOR","\\",212],["T_STRING","Magento",212],["T_NS_SEPARATOR","\\",212],["T_STRING","Tax",212],["T_NS_SEPARATOR","\\",212],["T_STRING","Api",212],["T_NS_SEPARATOR","\\",212],["T_STRING","Data",212],["T_NS_SEPARATOR","\\",212],["T_STRING","QuoteDetailsItemInterfaceFactory",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$itemDataObjectFactory",212],",",["T_WHITESPACE","\n        ",212],["T_STRING","Address",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$address",213],",",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$useBaseCurrency",214],["T_WHITESPACE","\n    ",214],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$itemDataObjects",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],"[","]",";",["T_WHITESPACE","\n        ",216],["T_VARIABLE","$extraTaxables",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$address",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getAssociatedTaxables",217],"(",")",";",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(","!",["T_VARIABLE","$extraTaxables",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_RETURN","return",219],["T_WHITESPACE"," ",219],"[","]",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n\n        ",220],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$extraTaxables",222],["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$extraTaxable",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$useBaseCurrency",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$unitPrice",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$extraTaxable",224],"[",["T_STRING","self",224],["T_DOUBLE_COLON","::",224],["T_STRING","KEY_ASSOCIATED_TAXABLE_BASE_UNIT_PRICE",224],"]",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE"," ",225],["T_ELSE","else",225],["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$unitPrice",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$extraTaxable",226],"[",["T_STRING","self",226],["T_DOUBLE_COLON","::",226],["T_STRING","KEY_ASSOCIATED_TAXABLE_UNIT_PRICE",226],"]",";",["T_WHITESPACE","\n            ",226],"}",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$itemDataObjects",228],"[","]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$itemDataObjectFactory",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","create",228],"(",")",["T_WHITESPACE","\n                ",228],["T_OBJECT_OPERATOR","->",229],["T_STRING","setCode",229],"(",["T_VARIABLE","$extraTaxable",229],"[",["T_STRING","self",229],["T_DOUBLE_COLON","::",229],["T_STRING","KEY_ASSOCIATED_TAXABLE_CODE",229],"]",")",["T_WHITESPACE","\n                ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","setType",230],"(",["T_VARIABLE","$extraTaxable",230],"[",["T_STRING","self",230],["T_DOUBLE_COLON","::",230],["T_STRING","KEY_ASSOCIATED_TAXABLE_TYPE",230],"]",")",["T_WHITESPACE","\n                ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setQuantity",231],"(",["T_VARIABLE","$extraTaxable",231],"[",["T_STRING","self",231],["T_DOUBLE_COLON","::",231],["T_STRING","KEY_ASSOCIATED_TAXABLE_QUANTITY",231],"]",")",["T_WHITESPACE","\n                ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","setTaxClassKey",232],"(",["T_WHITESPACE","\n                    ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","taxClassKeyDataObjectFactory",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","create",233],"(",")",["T_WHITESPACE","\n                        ",233],["T_OBJECT_OPERATOR","->",234],["T_STRING","setType",234],"(",["T_STRING","TaxClassKeyInterface",234],["T_DOUBLE_COLON","::",234],["T_STRING","TYPE_ID",234],")",["T_WHITESPACE","\n                        ",234],["T_OBJECT_OPERATOR","->",235],["T_STRING","setValue",235],"(",["T_VARIABLE","$extraTaxable",235],"[",["T_STRING","self",235],["T_DOUBLE_COLON","::",235],["T_STRING","KEY_ASSOCIATED_TAXABLE_TAX_CLASS_ID",235],"]",")",["T_WHITESPACE","\n                ",235],")",["T_WHITESPACE","\n                ",236],["T_OBJECT_OPERATOR","->",237],["T_STRING","setUnitPrice",237],"(",["T_VARIABLE","$unitPrice",237],")",["T_WHITESPACE","\n                ",237],["T_OBJECT_OPERATOR","->",238],["T_STRING","setIsTaxIncluded",238],"(",["T_VARIABLE","$extraTaxable",238],"[",["T_STRING","self",238],["T_DOUBLE_COLON","::",238],["T_STRING","KEY_ASSOCIATED_TAXABLE_PRICE_INCLUDES_TAX",238],"]",")",["T_WHITESPACE","\n                ",238],["T_OBJECT_OPERATOR","->",239],["T_STRING","setAssociatedItemCode",239],"(",["T_VARIABLE","$extraTaxable",239],"[",["T_STRING","self",239],["T_DOUBLE_COLON","::",239],["T_STRING","KEY_ASSOCIATED_TAXABLE_ASSOCIATION_ITEM_CODE",239],"]",")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n\n        ",240],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$itemDataObjects",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Process everything other than product or shipping, save the result in quote\n     *\n     * @param Address\\Total $total\n     * @param array $itemsByType\n     * @return $this\n     * @SuppressWarnings(PHPMD.UnusedLocalVariable)\n     *\/",245],["T_WHITESPACE","\n    ",252],["T_PROTECTED","protected",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","processExtraTaxables",253],"(",["T_STRING","Address",253],["T_NS_SEPARATOR","\\",253],["T_STRING","Total",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$total",253],",",["T_WHITESPACE"," ",253],["T_ARRAY","Array",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$itemsByType",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$extraTaxableDetails",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],"[","]",";",["T_WHITESPACE","\n        ",255],["T_FOREACH","foreach",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$itemsByType",256],["T_WHITESPACE"," ",256],["T_AS","as",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$itemType",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$itemTaxDetails",256],")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_IF","if",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$itemType",257],["T_WHITESPACE"," ",257],["T_IS_NOT_EQUAL","!=",257],["T_WHITESPACE"," ",257],["T_STRING","self",257],["T_DOUBLE_COLON","::",257],["T_STRING","ITEM_TYPE_PRODUCT",257],["T_WHITESPACE"," ",257],["T_LOGICAL_AND","and",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$itemType",257],["T_WHITESPACE"," ",257],["T_IS_NOT_EQUAL","!=",257],["T_WHITESPACE"," ",257],["T_STRING","self",257],["T_DOUBLE_COLON","::",257],["T_STRING","ITEM_TYPE_SHIPPING",257],")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n                ",257],["T_FOREACH","foreach",258],["T_WHITESPACE"," ",258],"(",["T_VARIABLE","$itemTaxDetails",258],["T_WHITESPACE"," ",258],["T_AS","as",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$itemCode",258],["T_WHITESPACE"," ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$itemTaxDetail",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                    ",258],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\TaxDetailsInterface $taxDetails *\/",259],["T_WHITESPACE","\n                    ",259],["T_VARIABLE","$taxDetails",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$itemTaxDetail",260],"[",["T_STRING","self",260],["T_DOUBLE_COLON","::",260],["T_STRING","KEY_ITEM",260],"]",";",["T_WHITESPACE","\n                    ",260],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\TaxDetailsInterface $baseTaxDetails *\/",261],["T_WHITESPACE","\n                    ",261],["T_VARIABLE","$baseTaxDetails",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$itemTaxDetail",262],"[",["T_STRING","self",262],["T_DOUBLE_COLON","::",262],["T_STRING","KEY_BASE_ITEM",262],"]",";",["T_WHITESPACE","\n\n                    ",262],["T_VARIABLE","$appliedTaxes",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$taxDetails",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getAppliedTaxes",264],"(",")",";",["T_WHITESPACE","\n                    ",264],["T_VARIABLE","$baseAppliedTaxes",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$baseTaxDetails",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getAppliedTaxes",265],"(",")",";",["T_WHITESPACE","\n\n                    ",265],["T_VARIABLE","$associatedItemCode",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$taxDetails",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getAssociatedItemCode",267],"(",")",";",["T_WHITESPACE","\n\n                    ",267],["T_VARIABLE","$appliedTaxesArray",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","convertAppliedTaxes",269],"(",["T_VARIABLE","$appliedTaxes",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$baseAppliedTaxes",269],")",";",["T_WHITESPACE","\n                    ",269],["T_VARIABLE","$extraTaxableDetails",270],"[",["T_VARIABLE","$itemType",270],"]","[",["T_VARIABLE","$associatedItemCode",270],"]","[","]",["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],"[",["T_WHITESPACE","\n                        ",270],["T_STRING","self",271],["T_DOUBLE_COLON","::",271],["T_STRING","KEY_TAX_DETAILS_TYPE",271],["T_WHITESPACE"," ",271],["T_DOUBLE_ARROW","=>",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$taxDetails",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getType",271],"(",")",",",["T_WHITESPACE","\n                        ",271],["T_STRING","self",272],["T_DOUBLE_COLON","::",272],["T_STRING","KEY_TAX_DETAILS_CODE",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$taxDetails",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getCode",272],"(",")",",",["T_WHITESPACE","\n                        ",272],["T_STRING","self",273],["T_DOUBLE_COLON","::",273],["T_STRING","KEY_TAX_DETAILS_PRICE_EXCL_TAX",273],["T_WHITESPACE"," ",273],["T_DOUBLE_ARROW","=>",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$taxDetails",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getPrice",273],"(",")",",",["T_WHITESPACE","\n                        ",273],["T_STRING","self",274],["T_DOUBLE_COLON","::",274],["T_STRING","KEY_TAX_DETAILS_PRICE_INCL_TAX",274],["T_WHITESPACE"," ",274],["T_DOUBLE_ARROW","=>",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$taxDetails",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getPriceInclTax",274],"(",")",",",["T_WHITESPACE","\n                        ",274],["T_STRING","self",275],["T_DOUBLE_COLON","::",275],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_EXCL_TAX",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$baseTaxDetails",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getPrice",275],"(",")",",",["T_WHITESPACE","\n                        ",275],["T_STRING","self",276],["T_DOUBLE_COLON","::",276],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_INCL_TAX",276],["T_WHITESPACE"," ",276],["T_DOUBLE_ARROW","=>",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$baseTaxDetails",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getPriceInclTax",276],"(",")",",",["T_WHITESPACE","\n                        ",276],["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$taxDetails",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getRowTotal",277],"(",")",",",["T_WHITESPACE","\n                        ",277],["T_STRING","self",278],["T_DOUBLE_COLON","::",278],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL_INCL_TAX",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$taxDetails",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getRowTotalInclTax",278],"(",")",",",["T_WHITESPACE","\n                        ",278],["T_STRING","self",279],["T_DOUBLE_COLON","::",279],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL",279],["T_WHITESPACE"," ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$baseTaxDetails",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getRowTotal",279],"(",")",",",["T_WHITESPACE","\n                        ",279],["T_STRING","self",280],["T_DOUBLE_COLON","::",280],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL_INCL_TAX",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$baseTaxDetails",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getRowTotalInclTax",280],"(",")",",",["T_WHITESPACE","\n                        ",280],["T_STRING","self",281],["T_DOUBLE_COLON","::",281],["T_STRING","KEY_TAX_DETAILS_TAX_PERCENT",281],["T_WHITESPACE"," ",281],["T_DOUBLE_ARROW","=>",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$taxDetails",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getTaxPercent",281],"(",")",",",["T_WHITESPACE","\n                        ",281],["T_STRING","self",282],["T_DOUBLE_COLON","::",282],["T_STRING","KEY_TAX_DETAILS_ROW_TAX",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$taxDetails",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getRowTax",282],"(",")",",",["T_WHITESPACE","\n                        ",282],["T_STRING","self",283],["T_DOUBLE_COLON","::",283],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TAX",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$baseTaxDetails",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getRowTax",283],"(",")",",",["T_WHITESPACE","\n                        ",283],["T_STRING","self",284],["T_DOUBLE_COLON","::",284],["T_STRING","KEY_TAX_DETAILS_APPLIED_TAXES",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$appliedTaxesArray",284],",",["T_WHITESPACE","\n                    ",284],"]",";",["T_WHITESPACE","\n\n                    ",285],["T_VARIABLE","$total",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","addTotalAmount",287],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",287],",",["T_WHITESPACE"," ",287],["T_VARIABLE","$taxDetails",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getRowTax",287],"(",")",")",";",["T_WHITESPACE","\n                    ",287],["T_VARIABLE","$total",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","addBaseTotalAmount",288],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$baseTaxDetails",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getRowTax",288],"(",")",")",";",["T_WHITESPACE","\n                    ",288],["T_COMMENT","\/\/TODO: save applied taxes for the item\n",289],["T_WHITESPACE","                ",290],"}",["T_WHITESPACE","\n            ",290],"}",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_VARIABLE","$total",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","setExtraTaxableDetails",294],"(",["T_VARIABLE","$extraTaxableDetails",294],")",";",["T_WHITESPACE","\n        ",294],["T_RETURN","return",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],";",["T_WHITESPACE","\n    ",295],"}",["T_WHITESPACE","\n\n    ",296],["T_DOC_COMMENT","\/**\n     * Add tax totals information to address object\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param Address\\Total $total\n     * @return array|null\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",298],["T_WHITESPACE","\n    ",306],["T_PUBLIC","public",307],["T_WHITESPACE"," ",307],["T_FUNCTION","function",307],["T_WHITESPACE"," ",307],["T_STRING","fetch",307],"(",["T_NS_SEPARATOR","\\",307],["T_STRING","Magento",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Quote",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Model",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Quote",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$quote",307],",",["T_WHITESPACE"," ",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Magento",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Quote",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Model",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Quote",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Address",307],["T_NS_SEPARATOR","\\",307],["T_STRING","Total",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$total",307],")",["T_WHITESPACE","\n    ",307],"{",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$totals",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],"[","]",";",["T_WHITESPACE","\n        ",309],["T_VARIABLE","$store",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$quote",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getStore",310],"(",")",";",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$applied",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$total",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getAppliedTaxes",311],"(",")",";",["T_WHITESPACE","\n        ",311],["T_IF","if",312],["T_WHITESPACE"," ",312],"(",["T_STRING","is_string",312],"(",["T_VARIABLE","$applied",312],")",")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n            ",312],["T_VARIABLE","$applied",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","serializer",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","unserialize",313],"(",["T_VARIABLE","$applied",313],")",";",["T_WHITESPACE","\n        ",313],"}",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$amount",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$total",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getTaxAmount",315],"(",")",";",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$amount",316],["T_WHITESPACE"," ",316],["T_IS_IDENTICAL","===",316],["T_WHITESPACE"," ",316],["T_STRING","null",316],")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","enhanceTotalData",317],"(",["T_VARIABLE","$quote",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$total",317],")",";",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$amount",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$total",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getTaxAmount",318],"(",")",";",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n        ",319],["T_VARIABLE","$taxAmount",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$amount",320],["T_WHITESPACE"," ",320],"+",["T_WHITESPACE"," ",320],["T_VARIABLE","$total",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getTotalAmount",320],"(",["T_CONSTANT_ENCAPSED_STRING","'discount_tax_compensation'",320],")",";",["T_WHITESPACE","\n\n        ",320],["T_VARIABLE","$area",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_STRING","null",322],";",["T_WHITESPACE","\n        ",322],["T_IF","if",323],["T_WHITESPACE"," ",323],"(",["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_config",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","displayCartTaxWithGrandTotal",323],"(",["T_VARIABLE","$store",323],")",["T_WHITESPACE"," ",323],["T_BOOLEAN_AND","&&",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$total",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getGrandTotal",323],"(",")",")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$area",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'taxes'",324],";",["T_WHITESPACE","\n        ",324],"}",["T_WHITESPACE","\n\n        ",325],["T_VARIABLE","$totals",327],"[","]",["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],"[",["T_WHITESPACE","\n            ",327],["T_CONSTANT_ENCAPSED_STRING","'code'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getCode",328],"(",")",",",["T_WHITESPACE","\n            ",328],["T_CONSTANT_ENCAPSED_STRING","'title'",329],["T_WHITESPACE"," ",329],["T_DOUBLE_ARROW","=>",329],["T_WHITESPACE"," ",329],["T_STRING","__",329],"(",["T_CONSTANT_ENCAPSED_STRING","'Tax'",329],")",",",["T_WHITESPACE","\n            ",329],["T_CONSTANT_ENCAPSED_STRING","'full_info'",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$applied",330],["T_WHITESPACE"," ",330],"?",["T_WHITESPACE"," ",330],["T_VARIABLE","$applied",330],["T_WHITESPACE"," ",330],":",["T_WHITESPACE"," ",330],"[","]",",",["T_WHITESPACE","\n            ",330],["T_CONSTANT_ENCAPSED_STRING","'value'",331],["T_WHITESPACE"," ",331],["T_DOUBLE_ARROW","=>",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$amount",331],",",["T_WHITESPACE","\n            ",331],["T_CONSTANT_ENCAPSED_STRING","'area'",332],["T_WHITESPACE"," ",332],["T_DOUBLE_ARROW","=>",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$area",332],",",["T_WHITESPACE","\n        ",332],"]",";",["T_WHITESPACE","\n\n        ",333],["T_DOC_COMMENT","\/**\n         * Modify subtotal\n         *\/",335],["T_WHITESPACE","\n        ",337],["T_IF","if",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_config",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","displayCartSubtotalBoth",338],"(",["T_VARIABLE","$store",338],")",["T_WHITESPACE"," ",338],["T_BOOLEAN_OR","||",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_config",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","displayCartSubtotalInclTax",338],"(",["T_VARIABLE","$store",338],")",")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n            ",338],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$total",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getSubtotalInclTax",339],"(",")",["T_WHITESPACE"," ",339],">",["T_WHITESPACE"," ",339],["T_LNUMBER","0",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n                ",339],["T_VARIABLE","$subtotalInclTax",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$total",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getSubtotalInclTax",340],"(",")",";",["T_WHITESPACE","\n            ",340],"}",["T_WHITESPACE"," ",341],["T_ELSE","else",341],["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n                ",341],["T_VARIABLE","$subtotalInclTax",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$total",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getSubtotal",342],"(",")",["T_WHITESPACE"," ",342],"+",["T_WHITESPACE"," ",342],["T_VARIABLE","$taxAmount",342],["T_WHITESPACE"," ",342],"-",["T_WHITESPACE"," ",342],["T_VARIABLE","$total",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getShippingTaxAmount",342],"(",")",";",["T_WHITESPACE","\n            ",342],"}",["T_WHITESPACE","\n\n            ",343],["T_VARIABLE","$totals",345],"[","]",["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],"[",["T_WHITESPACE","\n                ",345],["T_CONSTANT_ENCAPSED_STRING","'code'",346],["T_WHITESPACE"," ",346],["T_DOUBLE_ARROW","=>",346],["T_WHITESPACE"," ",346],["T_CONSTANT_ENCAPSED_STRING","'subtotal'",346],",",["T_WHITESPACE","\n                ",346],["T_CONSTANT_ENCAPSED_STRING","'title'",347],["T_WHITESPACE"," ",347],["T_DOUBLE_ARROW","=>",347],["T_WHITESPACE"," ",347],["T_STRING","__",347],"(",["T_CONSTANT_ENCAPSED_STRING","'Subtotal'",347],")",",",["T_WHITESPACE","\n                ",347],["T_CONSTANT_ENCAPSED_STRING","'value'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$subtotalInclTax",348],",",["T_WHITESPACE","\n                ",348],["T_CONSTANT_ENCAPSED_STRING","'value_incl_tax'",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$subtotalInclTax",349],",",["T_WHITESPACE","\n                ",349],["T_CONSTANT_ENCAPSED_STRING","'value_excl_tax'",350],["T_WHITESPACE"," ",350],["T_DOUBLE_ARROW","=>",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$total",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getSubtotal",350],"(",")",",",["T_WHITESPACE","\n            ",350],"]",";",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n\n        ",352],["T_IF","if",354],["T_WHITESPACE"," ",354],"(",["T_EMPTY","empty",354],"(",["T_VARIABLE","$totals",354],")",")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n            ",354],["T_RETURN","return",355],["T_WHITESPACE"," ",355],["T_STRING","null",355],";",["T_WHITESPACE","\n        ",355],"}",["T_WHITESPACE","\n        ",356],["T_RETURN","return",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$totals",357],";",["T_WHITESPACE","\n    ",357],"}",["T_WHITESPACE","\n\n    ",358],["T_DOC_COMMENT","\/**\n     * Adds minimal tax information to the \"total\" data structure\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param Address\\Total $total\n     * @return null\n     *\/",360],["T_WHITESPACE","\n    ",366],["T_PROTECTED","protected",367],["T_WHITESPACE"," ",367],["T_FUNCTION","function",367],["T_WHITESPACE"," ",367],["T_STRING","enhanceTotalData",367],"(",["T_WHITESPACE","\n        ",367],["T_NS_SEPARATOR","\\",368],["T_STRING","Magento",368],["T_NS_SEPARATOR","\\",368],["T_STRING","Quote",368],["T_NS_SEPARATOR","\\",368],["T_STRING","Model",368],["T_NS_SEPARATOR","\\",368],["T_STRING","Quote",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$quote",368],",",["T_WHITESPACE","\n        ",368],["T_NS_SEPARATOR","\\",369],["T_STRING","Magento",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Quote",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Model",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Quote",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Address",369],["T_NS_SEPARATOR","\\",369],["T_STRING","Total",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$total",369],["T_WHITESPACE","\n    ",369],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$taxAmount",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_LNUMBER","0",371],";",["T_WHITESPACE","\n        ",371],["T_VARIABLE","$shippingTaxAmount",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_LNUMBER","0",372],";",["T_WHITESPACE","\n        ",372],["T_VARIABLE","$discountTaxCompensation",373],["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_LNUMBER","0",373],";",["T_WHITESPACE","\n\n        ",373],["T_VARIABLE","$subtotalInclTax",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$total",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getSubtotalInclTax",375],"(",")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$computeSubtotalInclTax",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_STRING","true",376],";",["T_WHITESPACE","\n        ",376],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$total",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getSubtotalInclTax",377],"(",")",["T_WHITESPACE"," ",377],">",["T_WHITESPACE"," ",377],["T_LNUMBER","0",377],")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n            ",377],["T_VARIABLE","$computeSubtotalInclTax",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_STRING","false",378],";",["T_WHITESPACE","\n        ",378],"}",["T_WHITESPACE","\n\n        ",379],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote\\Address $address *\/",381],["T_WHITESPACE","\n        ",381],["T_FOREACH","foreach",382],["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$quote",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getAllAddresses",382],"(",")",["T_WHITESPACE"," ",382],["T_AS","as",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$address",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$taxAmount",383],["T_WHITESPACE"," ",383],["T_PLUS_EQUAL","+=",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$address",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getTaxAmount",383],"(",")",";",["T_WHITESPACE","\n            ",383],["T_VARIABLE","$shippingTaxAmount",384],["T_WHITESPACE"," ",384],["T_PLUS_EQUAL","+=",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$address",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getShippingTaxAmount",384],"(",")",";",["T_WHITESPACE","\n            ",384],["T_VARIABLE","$discountTaxCompensation",385],["T_WHITESPACE"," ",385],["T_PLUS_EQUAL","+=",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$address",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getDiscountTaxCompensationAmount",385],"(",")",";",["T_WHITESPACE","\n            ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(",["T_VARIABLE","$computeSubtotalInclTax",386],")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                ",386],["T_VARIABLE","$subtotalInclTax",387],["T_WHITESPACE"," ",387],["T_PLUS_EQUAL","+=",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$address",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getSubtotalInclTax",387],"(",")",";",["T_WHITESPACE","\n            ",387],"}",["T_WHITESPACE","\n        ",388],"}",["T_WHITESPACE","\n\n        ",389],["T_VARIABLE","$total",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","setTaxAmount",391],"(",["T_VARIABLE","$taxAmount",391],")",";",["T_WHITESPACE","\n        ",391],["T_VARIABLE","$total",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","setShippingTaxAmount",392],"(",["T_VARIABLE","$shippingTaxAmount",392],")",";",["T_WHITESPACE","\n        ",392],["T_VARIABLE","$total",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","setDiscountTaxCompensationAmount",393],"(",["T_VARIABLE","$discountTaxCompensation",393],")",";",["T_WHITESPACE"," ",393],["T_COMMENT","\/\/ accessed via 'discount_tax_compensation'\n",393],["T_WHITESPACE","        ",394],["T_VARIABLE","$total",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","setSubtotalInclTax",394],"(",["T_VARIABLE","$subtotalInclTax",394],")",";",["T_WHITESPACE","\n        ",394],["T_RETURN","return",395],";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n\n    ",396],["T_DOC_COMMENT","\/**\n     * Process model configuration array.\n     * This method can be used for changing totals collect sort order\n     *\n     * @param   array $config\n     * @param   store $store\n     * @return  array\n     *\/",398],["T_WHITESPACE","\n    ",405],["T_PUBLIC","public",406],["T_WHITESPACE"," ",406],["T_FUNCTION","function",406],["T_WHITESPACE"," ",406],["T_STRING","processConfigArray",406],"(",["T_VARIABLE","$config",406],",",["T_WHITESPACE"," ",406],["T_VARIABLE","$store",406],")",["T_WHITESPACE","\n    ",406],"{",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$calculationSequence",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_taxData",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getCalculationSequence",408],"(",["T_VARIABLE","$store",408],")",";",["T_WHITESPACE","\n        ",408],["T_SWITCH","switch",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$calculationSequence",409],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_CASE","case",410],["T_WHITESPACE"," ",410],["T_STRING","Calculation",410],["T_DOUBLE_COLON","::",410],["T_STRING","CALC_TAX_BEFORE_DISCOUNT_ON_INCL",410],":",["T_WHITESPACE","\n                ",410],["T_VARIABLE","$config",411],"[",["T_CONSTANT_ENCAPSED_STRING","'before'",411],"]","[","]",["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_CONSTANT_ENCAPSED_STRING","'discount'",411],";",["T_WHITESPACE","\n                ",411],["T_BREAK","break",412],";",["T_WHITESPACE","\n            ",412],["T_DEFAULT","default",413],":",["T_WHITESPACE","\n                ",413],["T_VARIABLE","$config",414],"[",["T_CONSTANT_ENCAPSED_STRING","'after'",414],"]","[","]",["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'discount'",414],";",["T_WHITESPACE","\n                ",414],["T_BREAK","break",415],";",["T_WHITESPACE","\n        ",415],"}",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$config",417],";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Get Tax label\n     *\n     * @return \\Magento\\Framework\\Phrase\n     *\/",420],["T_WHITESPACE","\n    ",424],["T_PUBLIC","public",425],["T_WHITESPACE"," ",425],["T_FUNCTION","function",425],["T_WHITESPACE"," ",425],["T_STRING","getLabel",425],"(",")",["T_WHITESPACE","\n    ",425],"{",["T_WHITESPACE","\n        ",426],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_STRING","__",427],"(",["T_CONSTANT_ENCAPSED_STRING","'Tax'",427],")",";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n",428],"}",["T_WHITESPACE","\n",429]]