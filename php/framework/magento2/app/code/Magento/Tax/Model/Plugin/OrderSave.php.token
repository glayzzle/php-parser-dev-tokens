[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",6],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Tax",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Plugin",8],";",["T_WHITESPACE","\n\n",8],["T_CLASS","class",10],["T_WHITESPACE"," ",10],["T_STRING","OrderSave",10],["T_WHITESPACE","\n",10],"{",["T_WHITESPACE","\n    ",11],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Model\\Sales\\Order\\TaxFactory\n     *\/",12],["T_WHITESPACE","\n    ",14],["T_PROTECTED","protected",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$orderTaxFactory",15],";",["T_WHITESPACE","\n\n    ",15],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\Order\\Tax\\ItemFactory\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$taxItemFactory",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Tax\\Model\\Sales\\Order\\TaxFactory $orderTaxFactory\n     * @param \\Magento\\Sales\\Model\\Order\\Tax\\ItemFactory $taxItemFactory\n     *\/",22],["T_WHITESPACE","\n    ",25],["T_PUBLIC","public",26],["T_WHITESPACE"," ",26],["T_FUNCTION","function",26],["T_WHITESPACE"," ",26],["T_STRING","__construct",26],"(",["T_WHITESPACE","\n        ",26],["T_NS_SEPARATOR","\\",27],["T_STRING","Magento",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Tax",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Model",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Sales",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Order",27],["T_NS_SEPARATOR","\\",27],["T_STRING","TaxFactory",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$orderTaxFactory",27],",",["T_WHITESPACE","\n        ",27],["T_NS_SEPARATOR","\\",28],["T_STRING","Magento",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Sales",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Model",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Order",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Tax",28],["T_NS_SEPARATOR","\\",28],["T_STRING","ItemFactory",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$taxItemFactory",28],["T_WHITESPACE","\n    ",28],")",["T_WHITESPACE"," ",29],"{",["T_WHITESPACE","\n        ",29],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","orderTaxFactory",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$orderTaxFactory",30],";",["T_WHITESPACE","\n        ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","taxItemFactory",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$taxItemFactory",31],";",["T_WHITESPACE","\n    ",31],"}",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * Save order tax\n     *\n     * @param \\Magento\\Sales\\Api\\OrderRepositoryInterface $subject\n     * @param \\Magento\\Sales\\Api\\Data\\OrderInterface $order\n     * @return \\Magento\\Sales\\Api\\Data\\OrderInterface\n     * @SuppressWarnings(PHPMD.UnusedFormalParameter)\n     *\/",34],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","afterSave",42],"(",["T_WHITESPACE","\n        ",42],["T_NS_SEPARATOR","\\",43],["T_STRING","Magento",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Sales",43],["T_NS_SEPARATOR","\\",43],["T_STRING","Api",43],["T_NS_SEPARATOR","\\",43],["T_STRING","OrderRepositoryInterface",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$subject",43],",",["T_WHITESPACE","\n        ",43],["T_NS_SEPARATOR","\\",44],["T_STRING","Magento",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Sales",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Api",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Data",44],["T_NS_SEPARATOR","\\",44],["T_STRING","OrderInterface",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$order",44],["T_WHITESPACE","\n    ",44],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","saveOrderTax",46],"(",["T_VARIABLE","$order",46],")",";",["T_WHITESPACE","\n        ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$order",47],";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Api\\Data\\OrderInterface $order\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",50],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","saveOrderTax",57],"(",["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Sales",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Api",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Data",57],["T_NS_SEPARATOR","\\",57],["T_STRING","OrderInterface",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$order",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$extensionAttribute",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$order",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getExtensionAttributes",59],"(",")",";",["T_WHITESPACE","\n        ",59],["T_IF","if",60],["T_WHITESPACE"," ",60],"(","!",["T_VARIABLE","$extensionAttribute",60],["T_WHITESPACE"," ",60],["T_BOOLEAN_OR","||",60],["T_WHITESPACE","\n            ",60],"!",["T_VARIABLE","$extensionAttribute",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getConvertingFromQuote",61],"(",")",["T_WHITESPACE"," ",61],["T_BOOLEAN_OR","||",61],["T_WHITESPACE","\n            ",61],["T_VARIABLE","$order",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getAppliedTaxIsSaved",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_RETURN","return",63],";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE","\n\n        ",64],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsAppliedTaxInterface[]|null $taxes *\/",66],["T_WHITESPACE","\n        ",66],["T_VARIABLE","$taxes",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$extensionAttribute",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getAppliedTaxes",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$taxes",68],["T_WHITESPACE"," ",68],["T_IS_EQUAL","==",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$taxes",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],"[","]",";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsItemInterface[]|null $taxesForItems *\/",72],["T_WHITESPACE","\n        ",72],["T_VARIABLE","$taxesForItems",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$extensionAttribute",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getItemAppliedTaxes",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$taxesForItems",74],["T_WHITESPACE"," ",74],["T_IS_EQUAL","==",74],["T_WHITESPACE"," ",74],["T_STRING","null",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$taxesForItems",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],"[","]",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$ratesIdQuoteItemId",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],"[","]",";",["T_WHITESPACE","\n        ",78],["T_FOREACH","foreach",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$taxesForItems",79],["T_WHITESPACE"," ",79],["T_AS","as",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$taxesArray",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_FOREACH","foreach",80],["T_WHITESPACE"," ",80],"(",["T_VARIABLE","$taxesArray",80],"[",["T_CONSTANT_ENCAPSED_STRING","'applied_taxes'",80],"]",["T_WHITESPACE"," ",80],["T_AS","as",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$rates",80],")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n                ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_ISSET","isset",81],"(",["T_VARIABLE","$rates",81],"[",["T_CONSTANT_ENCAPSED_STRING","'extension_attributes'",81],"]",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                    ",81],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\AppliedTaxRateInterface[] $taxRates *\/",82],["T_WHITESPACE","\n                    ",82],["T_VARIABLE","$taxRates",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$rates",83],"[",["T_CONSTANT_ENCAPSED_STRING","'extension_attributes'",83],"]",["T_OBJECT_OPERATOR","->",83],["T_STRING","getRates",83],"(",")",";",["T_WHITESPACE","\n                    ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_STRING","is_array",84],"(",["T_VARIABLE","$taxRates",84],")",")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_STRING","count",85],"(",["T_VARIABLE","$taxRates",85],")",["T_WHITESPACE"," ",85],["T_IS_EQUAL","==",85],["T_WHITESPACE"," ",85],["T_LNUMBER","1",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                            ",85],["T_VARIABLE","$ratesIdQuoteItemId",86],"[",["T_VARIABLE","$rates",86],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",86],"]","]","[","]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],"[",["T_WHITESPACE","\n                                ",86],["T_CONSTANT_ENCAPSED_STRING","'id'",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$taxesArray",87],"[",["T_CONSTANT_ENCAPSED_STRING","'item_id'",87],"]",",",["T_WHITESPACE","\n                                ",87],["T_CONSTANT_ENCAPSED_STRING","'percent'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$rates",88],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",88],"]",",",["T_WHITESPACE","\n                                ",88],["T_CONSTANT_ENCAPSED_STRING","'code'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$taxRates",89],"[",["T_LNUMBER","0",89],"]","[",["T_CONSTANT_ENCAPSED_STRING","'code'",89],"]",",",["T_WHITESPACE","\n                                ",89],["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$taxesArray",90],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",90],"]",",",["T_WHITESPACE","\n                                ",90],["T_CONSTANT_ENCAPSED_STRING","'item_type'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$taxesArray",91],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",91],"]",",",["T_WHITESPACE","\n                                ",91],["T_CONSTANT_ENCAPSED_STRING","'amount'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$rates",92],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",92],"]",",",["T_WHITESPACE","\n                                ",92],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$rates",93],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",93],"]",",",["T_WHITESPACE","\n                                ",93],["T_CONSTANT_ENCAPSED_STRING","'real_amount'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$rates",94],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",94],"]",",",["T_WHITESPACE","\n                                ",94],["T_CONSTANT_ENCAPSED_STRING","'real_base_amount'",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$rates",95],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",95],"]",",",["T_WHITESPACE","\n                            ",95],"]",";",["T_WHITESPACE","\n                        ",96],"}",["T_WHITESPACE"," ",97],["T_ELSE","else",97],["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n                            ",97],["T_VARIABLE","$percentSum",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_LNUMBER","0",98],";",["T_WHITESPACE","\n                            ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$taxRates",99],["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$rate",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n                                ",99],["T_VARIABLE","$realAmount",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$rates",100],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",100],"]",["T_WHITESPACE"," ",100],"*",["T_WHITESPACE"," ",100],["T_VARIABLE","$rate",100],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",100],"]",["T_WHITESPACE"," ",100],"\/",["T_WHITESPACE"," ",100],["T_VARIABLE","$rates",100],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",100],"]",";",["T_WHITESPACE","\n                                ",100],["T_VARIABLE","$realBaseAmount",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$rates",101],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",101],"]",["T_WHITESPACE"," ",101],"*",["T_WHITESPACE"," ",101],["T_VARIABLE","$rate",101],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",101],"]",["T_WHITESPACE"," ",101],"\/",["T_WHITESPACE"," ",101],["T_VARIABLE","$rates",101],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",101],"]",";",["T_WHITESPACE","\n                                ",101],["T_VARIABLE","$ratesIdQuoteItemId",102],"[",["T_VARIABLE","$rates",102],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",102],"]","]","[","]",["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],"[",["T_WHITESPACE","\n                                    ",102],["T_CONSTANT_ENCAPSED_STRING","'id'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$taxesArray",103],"[",["T_CONSTANT_ENCAPSED_STRING","'item_id'",103],"]",",",["T_WHITESPACE","\n                                    ",103],["T_CONSTANT_ENCAPSED_STRING","'percent'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$rate",104],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",104],"]",",",["T_WHITESPACE","\n                                    ",104],["T_CONSTANT_ENCAPSED_STRING","'code'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$rate",105],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",105],"]",",",["T_WHITESPACE","\n                                    ",105],["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$taxesArray",106],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",106],"]",",",["T_WHITESPACE","\n                                    ",106],["T_CONSTANT_ENCAPSED_STRING","'item_type'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$taxesArray",107],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",107],"]",",",["T_WHITESPACE","\n                                    ",107],["T_CONSTANT_ENCAPSED_STRING","'amount'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$rates",108],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",108],"]",",",["T_WHITESPACE","\n                                    ",108],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$rates",109],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",109],"]",",",["T_WHITESPACE","\n                                    ",109],["T_CONSTANT_ENCAPSED_STRING","'real_amount'",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$realAmount",110],",",["T_WHITESPACE","\n                                    ",110],["T_CONSTANT_ENCAPSED_STRING","'real_base_amount'",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$realBaseAmount",111],",",["T_WHITESPACE","\n                                ",111],"]",";",["T_WHITESPACE","\n                                ",112],["T_VARIABLE","$percentSum",113],["T_WHITESPACE"," ",113],["T_PLUS_EQUAL","+=",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$rate",113],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",113],"]",";",["T_WHITESPACE","\n                            ",113],"}",["T_WHITESPACE","\n                        ",114],"}",["T_WHITESPACE","\n                    ",115],"}",["T_WHITESPACE","\n                ",116],"}",["T_WHITESPACE","\n            ",117],"}",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n\n        ",119],["T_FOREACH","foreach",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$taxes",121],["T_WHITESPACE"," ",121],["T_AS","as",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$row",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$id",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$row",122],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",122],"]",";",["T_WHITESPACE","\n            ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_ISSET","isset",123],"(",["T_VARIABLE","$row",123],"[",["T_CONSTANT_ENCAPSED_STRING","'extension_attributes'",123],"]",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\AppliedTaxRateInterface[] $taxRates *\/",124],["T_WHITESPACE","\n                ",124],["T_VARIABLE","$taxRates",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$row",125],"[",["T_CONSTANT_ENCAPSED_STRING","'extension_attributes'",125],"]",["T_OBJECT_OPERATOR","->",125],["T_STRING","getRates",125],"(",")",";",["T_WHITESPACE","\n                ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_STRING","is_array",126],"(",["T_VARIABLE","$taxRates",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                    ",126],["T_FOREACH","foreach",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$taxRates",127],["T_WHITESPACE"," ",127],["T_AS","as",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$tax",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n                        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$row",128],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",128],"]",["T_WHITESPACE"," ",128],["T_IS_EQUAL","==",128],["T_WHITESPACE"," ",128],["T_STRING","null",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                            ",128],["T_VARIABLE","$baseRealAmount",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$row",129],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",129],"]",";",["T_WHITESPACE","\n                        ",129],"}",["T_WHITESPACE"," ",130],["T_ELSE","else",130],["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                            ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$row",131],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",131],"]",["T_WHITESPACE"," ",131],["T_IS_EQUAL","==",131],["T_WHITESPACE"," ",131],["T_LNUMBER","0",131],["T_WHITESPACE"," ",131],["T_BOOLEAN_OR","||",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$tax",131],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",131],"]",["T_WHITESPACE"," ",131],["T_IS_EQUAL","==",131],["T_WHITESPACE"," ",131],["T_LNUMBER","0",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                                ",131],["T_CONTINUE","continue",132],";",["T_WHITESPACE","\n                            ",132],"}",["T_WHITESPACE","\n                            ",133],["T_VARIABLE","$baseRealAmount",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$row",134],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",134],"]",["T_WHITESPACE"," ",134],"\/",["T_WHITESPACE"," ",134],["T_VARIABLE","$row",134],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",134],"]",["T_WHITESPACE"," ",134],"*",["T_WHITESPACE"," ",134],["T_VARIABLE","$tax",134],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",134],"]",";",["T_WHITESPACE","\n                        ",134],"}",["T_WHITESPACE","\n                        ",135],["T_VARIABLE","$hidden",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ISSET","isset",136],"(",["T_VARIABLE","$row",136],"[",["T_CONSTANT_ENCAPSED_STRING","'hidden'",136],"]",")",["T_WHITESPACE"," ",136],"?",["T_WHITESPACE"," ",136],["T_VARIABLE","$row",136],"[",["T_CONSTANT_ENCAPSED_STRING","'hidden'",136],"]",["T_WHITESPACE"," ",136],":",["T_WHITESPACE"," ",136],["T_LNUMBER","0",136],";",["T_WHITESPACE","\n                        ",136],["T_VARIABLE","$priority",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_ISSET","isset",137],"(",["T_VARIABLE","$tax",137],"[",["T_CONSTANT_ENCAPSED_STRING","'priority'",137],"]",")",["T_WHITESPACE"," ",137],"?",["T_WHITESPACE"," ",137],["T_VARIABLE","$tax",137],"[",["T_CONSTANT_ENCAPSED_STRING","'priority'",137],"]",["T_WHITESPACE"," ",137],":",["T_WHITESPACE"," ",137],["T_LNUMBER","0",137],";",["T_WHITESPACE","\n                        ",137],["T_VARIABLE","$position",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_ISSET","isset",138],"(",["T_VARIABLE","$tax",138],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",138],"]",")",["T_WHITESPACE"," ",138],"?",["T_WHITESPACE"," ",138],["T_VARIABLE","$tax",138],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",138],"]",["T_WHITESPACE"," ",138],":",["T_WHITESPACE"," ",138],["T_LNUMBER","0",138],";",["T_WHITESPACE","\n                        ",138],["T_VARIABLE","$process",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ISSET","isset",139],"(",["T_VARIABLE","$row",139],"[",["T_CONSTANT_ENCAPSED_STRING","'process'",139],"]",")",["T_WHITESPACE"," ",139],"?",["T_WHITESPACE"," ",139],["T_VARIABLE","$row",139],"[",["T_CONSTANT_ENCAPSED_STRING","'process'",139],"]",["T_WHITESPACE"," ",139],":",["T_WHITESPACE"," ",139],["T_LNUMBER","0",139],";",["T_WHITESPACE","\n                        ",139],["T_VARIABLE","$data",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],"[",["T_WHITESPACE","\n                            ",140],["T_CONSTANT_ENCAPSED_STRING","'order_id'",141],["T_WHITESPACE"," ",141],["T_DOUBLE_ARROW","=>",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$order",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getEntityId",141],"(",")",",",["T_WHITESPACE","\n                            ",141],["T_CONSTANT_ENCAPSED_STRING","'code'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$tax",142],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",142],"]",",",["T_WHITESPACE","\n                            ",142],["T_CONSTANT_ENCAPSED_STRING","'title'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$tax",143],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",143],"]",",",["T_WHITESPACE","\n                            ",143],["T_CONSTANT_ENCAPSED_STRING","'hidden'",144],["T_WHITESPACE"," ",144],["T_DOUBLE_ARROW","=>",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$hidden",144],",",["T_WHITESPACE","\n                            ",144],["T_CONSTANT_ENCAPSED_STRING","'percent'",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$tax",145],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",145],"]",",",["T_WHITESPACE","\n                            ",145],["T_CONSTANT_ENCAPSED_STRING","'priority'",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$priority",146],",",["T_WHITESPACE","\n                            ",146],["T_CONSTANT_ENCAPSED_STRING","'position'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$position",147],",",["T_WHITESPACE","\n                            ",147],["T_CONSTANT_ENCAPSED_STRING","'amount'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$row",148],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",148],"]",",",["T_WHITESPACE","\n                            ",148],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$row",149],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",149],"]",",",["T_WHITESPACE","\n                            ",149],["T_CONSTANT_ENCAPSED_STRING","'process'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$process",150],",",["T_WHITESPACE","\n                            ",150],["T_CONSTANT_ENCAPSED_STRING","'base_real_amount'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$baseRealAmount",151],",",["T_WHITESPACE","\n                        ",151],"]",";",["T_WHITESPACE","\n\n                        ",152],["T_DOC_COMMENT","\/** @var $orderTax \\Magento\\Tax\\Model\\Sales\\Order\\Tax *\/",154],["T_WHITESPACE","\n                        ",154],["T_VARIABLE","$orderTax",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","orderTaxFactory",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","create",155],"(",")",";",["T_WHITESPACE","\n                        ",155],["T_VARIABLE","$result",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$orderTax",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","setData",156],"(",["T_VARIABLE","$data",156],")",["T_OBJECT_OPERATOR","->",156],["T_STRING","save",156],"(",")",";",["T_WHITESPACE","\n\n                        ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_ISSET","isset",158],"(",["T_VARIABLE","$ratesIdQuoteItemId",158],"[",["T_VARIABLE","$id",158],"]",")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                            ",158],["T_FOREACH","foreach",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$ratesIdQuoteItemId",159],"[",["T_VARIABLE","$id",159],"]",["T_WHITESPACE"," ",159],["T_AS","as",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$quoteItemId",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                                ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$quoteItemId",160],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",160],"]",["T_WHITESPACE"," ",160],["T_IS_EQUAL","==",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$tax",160],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",160],"]",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                                    ",160],["T_VARIABLE","$itemId",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","null",161],";",["T_WHITESPACE","\n                                    ",161],["T_VARIABLE","$associatedItemId",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","null",162],";",["T_WHITESPACE","\n                                    ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_ISSET","isset",163],"(",["T_VARIABLE","$quoteItemId",163],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",163],"]",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                                        ",163],["T_COMMENT","\/\/This is a product item\n",164],["T_WHITESPACE","                                        ",165],["T_VARIABLE","$item",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$order",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getItemByQuoteItemId",165],"(",["T_VARIABLE","$quoteItemId",165],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",165],"]",")",";",["T_WHITESPACE","\n                                        ",165],["T_VARIABLE","$itemId",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$item",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getId",166],"(",")",";",["T_WHITESPACE","\n                                    ",166],"}",["T_WHITESPACE"," ",167],["T_ELSEIF","elseif",167],["T_WHITESPACE"," ",167],"(",["T_ISSET","isset",167],"(",["T_VARIABLE","$quoteItemId",167],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",167],"]",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n                                        ",167],["T_COMMENT","\/\/This item is associated with a product item\n",168],["T_WHITESPACE","                                        ",169],["T_VARIABLE","$item",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$order",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getItemByQuoteItemId",169],"(",["T_VARIABLE","$quoteItemId",169],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",169],"]",")",";",["T_WHITESPACE","\n                                        ",169],["T_VARIABLE","$associatedItemId",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$item",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getId",170],"(",")",";",["T_WHITESPACE","\n                                    ",170],"}",["T_WHITESPACE","\n\n                                    ",171],["T_VARIABLE","$data",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],"[",["T_WHITESPACE","\n                                        ",173],["T_CONSTANT_ENCAPSED_STRING","'item_id'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$itemId",174],",",["T_WHITESPACE","\n                                        ",174],["T_CONSTANT_ENCAPSED_STRING","'tax_id'",175],["T_WHITESPACE"," ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$result",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getTaxId",175],"(",")",",",["T_WHITESPACE","\n                                        ",175],["T_CONSTANT_ENCAPSED_STRING","'tax_percent'",176],["T_WHITESPACE"," ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$quoteItemId",176],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",176],"]",",",["T_WHITESPACE","\n                                        ",176],["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$associatedItemId",177],",",["T_WHITESPACE","\n                                        ",177],["T_CONSTANT_ENCAPSED_STRING","'amount'",178],["T_WHITESPACE"," ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$quoteItemId",178],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",178],"]",",",["T_WHITESPACE","\n                                        ",178],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",179],["T_WHITESPACE"," ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$quoteItemId",179],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",179],"]",",",["T_WHITESPACE","\n                                        ",179],["T_CONSTANT_ENCAPSED_STRING","'real_amount'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$quoteItemId",180],"[",["T_CONSTANT_ENCAPSED_STRING","'real_amount'",180],"]",",",["T_WHITESPACE","\n                                        ",180],["T_CONSTANT_ENCAPSED_STRING","'real_base_amount'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$quoteItemId",181],"[",["T_CONSTANT_ENCAPSED_STRING","'real_base_amount'",181],"]",",",["T_WHITESPACE","\n                                        ",181],["T_CONSTANT_ENCAPSED_STRING","'taxable_item_type'",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$quoteItemId",182],"[",["T_CONSTANT_ENCAPSED_STRING","'item_type'",182],"]",",",["T_WHITESPACE","\n                                    ",182],"]",";",["T_WHITESPACE","\n                                    ",183],["T_DOC_COMMENT","\/** @var $taxItem \\Magento\\Sales\\Model\\Order\\Tax\\Item *\/",184],["T_WHITESPACE","\n                                    ",184],["T_VARIABLE","$taxItem",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","taxItemFactory",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","create",185],"(",")",";",["T_WHITESPACE","\n                                    ",185],["T_VARIABLE","$taxItem",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","setData",186],"(",["T_VARIABLE","$data",186],")",["T_OBJECT_OPERATOR","->",186],["T_STRING","save",186],"(",")",";",["T_WHITESPACE","\n                                ",186],"}",["T_WHITESPACE","\n                            ",187],"}",["T_WHITESPACE","\n                        ",188],"}",["T_WHITESPACE","\n                    ",189],"}",["T_WHITESPACE","\n                ",190],"}",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n\n        ",193],["T_VARIABLE","$order",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","setAppliedTaxIsSaved",195],"(",["T_STRING","true",195],")",";",["T_WHITESPACE","\n        ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],";",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n",197],"}",["T_WHITESPACE","\n",198]]