[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tax",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Pricing",8],["T_NS_SEPARATOR","\\",8],["T_STRING","PriceCurrencyInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Store",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Store",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Customer",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Data",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CustomerInterface",10],["T_WHITESPACE"," ",10],["T_AS","as",10],["T_WHITESPACE"," ",10],["T_STRING","CustomerDataObject",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Customer",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","RegionInterface",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","AddressRegion",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Customer",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","AccountManagementInterface",12],["T_WHITESPACE"," ",12],["T_AS","as",12],["T_WHITESPACE"," ",12],["T_STRING","CustomerAccountManagement",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Customer",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","GroupManagementInterface",13],["T_WHITESPACE"," ",13],["T_AS","as",13],["T_WHITESPACE"," ",13],["T_STRING","CustomerGroupManagement",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Customer",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Api",14],["T_NS_SEPARATOR","\\",14],["T_STRING","GroupRepositoryInterface",14],["T_WHITESPACE"," ",14],["T_AS","as",14],["T_WHITESPACE"," ",14],["T_STRING","CustomerGroupRepository",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Customer",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Api",15],["T_NS_SEPARATOR","\\",15],["T_STRING","CustomerRepositoryInterface",15],["T_WHITESPACE"," ",15],["T_AS","as",15],["T_WHITESPACE"," ",15],["T_STRING","CustomerRepository",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Customer",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Api",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Data",16],["T_NS_SEPARATOR","\\",16],["T_STRING","AddressInterface",16],["T_WHITESPACE"," ",16],["T_AS","as",16],["T_WHITESPACE"," ",16],["T_STRING","CustomerAddress",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Magento",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Framework",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Api",17],["T_NS_SEPARATOR","\\",17],["T_STRING","FilterBuilder",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Magento",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Framework",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Api",18],["T_NS_SEPARATOR","\\",18],["T_STRING","SearchCriteriaBuilder",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Magento",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Tax",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Api",19],["T_NS_SEPARATOR","\\",19],["T_STRING","TaxClassRepositoryInterface",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Magento",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Framework",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Exception",20],["T_NS_SEPARATOR","\\",20],["T_STRING","NoSuchEntityException",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Magento",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Tax",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Model",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Config",21],";",["T_WHITESPACE","\n\n",21],["T_DOC_COMMENT","\/**\n * Tax Calculation Model\n * @SuppressWarnings(PHPMD.TooManyFields)\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",23],["T_WHITESPACE","\n",27],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","Calculation",28],["T_WHITESPACE"," ",28],["T_EXTENDS","extends",28],["T_WHITESPACE"," ",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Magento",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Framework",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Model",28],["T_NS_SEPARATOR","\\",28],["T_STRING","AbstractModel",28],["T_WHITESPACE","\n",28],"{",["T_WHITESPACE","\n    ",29],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation before discount excluding TAX\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_CONST","const",33],["T_WHITESPACE"," ",33],["T_STRING","CALC_TAX_BEFORE_DISCOUNT_ON_EXCL",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'0_0'",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation before discount including TAX\n     *\/",35],["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","CALC_TAX_BEFORE_DISCOUNT_ON_INCL",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'0_1'",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation after discount excluding TAX\n     *\/",40],["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","CALC_TAX_AFTER_DISCOUNT_ON_EXCL",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'1_0'",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation after discount including TAX\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","CALC_TAX_AFTER_DISCOUNT_ON_INCL",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'1_1'",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Identifier constant for unit based calculation\n     *\/",50],["T_WHITESPACE","\n    ",52],["T_CONST","const",53],["T_WHITESPACE"," ",53],["T_STRING","CALC_UNIT_BASE",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'UNIT_BASE_CALCULATION'",53],";",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * Identifier constant for row based calculation\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_CONST","const",58],["T_WHITESPACE"," ",58],["T_STRING","CALC_ROW_BASE",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'ROW_BASE_CALCULATION'",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Identifier constant for total based calculation\n     *\/",60],["T_WHITESPACE","\n    ",62],["T_CONST","const",63],["T_WHITESPACE"," ",63],["T_STRING","CALC_TOTAL_BASE",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'TOTAL_BASE_CALCULATION'",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Identifier constant for unit based calculation\n     *\n     * @var array\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_rates",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],"[","]",";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Identifier constant for row based calculation\n     *\n     * @var array\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_ctc",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],"[","]",";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Identifier constant for total based calculation\n     *\n     * @var array\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_ptc",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],"[","]",";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Cache to hold the rates\n     *\n     * @var array\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_rateCache",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],"[","]",";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Store the rate calculation process\n     *\n     * @var array\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$_rateCalculationProcess",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],"[","]",";",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Hold the customer\n     *\n     * @var CustomerDataObject|bool\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$_customer",105],";",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * @var int\n     *\/",107],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$_defaultCustomerTaxClass",110],";",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Core store config\n     *\n     * @var \\Magento\\Framework\\App\\Config\\ScopeConfigInterface\n     *\/",112],["T_WHITESPACE","\n    ",116],["T_PROTECTED","protected",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$_scopeConfig",117],";",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",119],["T_WHITESPACE","\n    ",121],["T_PROTECTED","protected",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$_storeManager",122],";",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Customer\\Model\\Session\n     *\/",124],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$_customerSession",127],";",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Customer\\Model\\CustomerFactory\n     *\/",129],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$_customerFactory",132],";",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Model\\ResourceModel\\TaxClass\\CollectionFactory\n     *\/",134],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$_classesFactory",137],";",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var Config\n     *\/",139],["T_WHITESPACE","\n    ",143],["T_PROTECTED","protected",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$_config",144],";",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * @var CustomerAccountManagement\n     *\/",146],["T_WHITESPACE","\n    ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$customerAccountManagement",149],";",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * @var CustomerGroupManagement\n     *\/",151],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$customerGroupManagement",154],";",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * @var CustomerGroupRepository\n     *\/",156],["T_WHITESPACE","\n    ",158],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$customerGroupRepository",159],";",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * @var CustomerRepository\n     *\/",161],["T_WHITESPACE","\n    ",163],["T_PROTECTED","protected",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$customerRepository",164],";",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * @var PriceCurrencyInterface\n     *\/",166],["T_WHITESPACE","\n    ",168],["T_PROTECTED","protected",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$priceCurrency",169],";",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Filter Builder\n     *\n     * @var FilterBuilder\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PROTECTED","protected",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$filterBuilder",176],";",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Search Criteria Builder\n     *\n     * @var SearchCriteriaBuilder\n     *\/",178],["T_WHITESPACE","\n    ",182],["T_PROTECTED","protected",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$searchCriteriaBuilder",183],";",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Tax Class Repository\n     *\n     * @var TaxClassRepositoryInterface\n     *\/",185],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$taxClassRepository",190],";",["T_WHITESPACE","\n\n    ",190],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\Context $context\n     * @param \\Magento\\Framework\\Registry $registry\n     * @param \\Magento\\Framework\\App\\Config\\ScopeConfigInterface $scopeConfig\n     * @param Config $taxConfig\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Customer\\Model\\Session $customerSession\n     * @param \\Magento\\Customer\\Model\\CustomerFactory $customerFactory\n     * @param \\Magento\\Tax\\Model\\ResourceModel\\TaxClass\\CollectionFactory $classesFactory\n     * @param \\Magento\\Tax\\Model\\ResourceModel\\Calculation $resource\n     * @param CustomerAccountManagement $customerAccountManagement\n     * @param CustomerGroupManagement $customerGroupManagement\n     * @param CustomerGroupRepository $customerGroupRepository\n     * @param CustomerRepository $customerRepository\n     * @param PriceCurrencyInterface $priceCurrency\n     * @param SearchCriteriaBuilder $searchCriteriaBuilder\n     * @param FilterBuilder $filterBuilder\n     * @param TaxClassRepositoryInterface $taxClassRepository\n     * @param \\Magento\\Framework\\Data\\Collection\\AbstractDb $resourceCollection\n     * @param array $data\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",192],["T_WHITESPACE","\n    ",213],["T_PUBLIC","public",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","__construct",214],"(",["T_WHITESPACE","\n        ",214],["T_NS_SEPARATOR","\\",215],["T_STRING","Magento",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Framework",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Model",215],["T_NS_SEPARATOR","\\",215],["T_STRING","Context",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$context",215],",",["T_WHITESPACE","\n        ",215],["T_NS_SEPARATOR","\\",216],["T_STRING","Magento",216],["T_NS_SEPARATOR","\\",216],["T_STRING","Framework",216],["T_NS_SEPARATOR","\\",216],["T_STRING","Registry",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$registry",216],",",["T_WHITESPACE","\n        ",216],["T_NS_SEPARATOR","\\",217],["T_STRING","Magento",217],["T_NS_SEPARATOR","\\",217],["T_STRING","Framework",217],["T_NS_SEPARATOR","\\",217],["T_STRING","App",217],["T_NS_SEPARATOR","\\",217],["T_STRING","Config",217],["T_NS_SEPARATOR","\\",217],["T_STRING","ScopeConfigInterface",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$scopeConfig",217],",",["T_WHITESPACE","\n        ",217],["T_STRING","Config",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$taxConfig",218],",",["T_WHITESPACE","\n        ",218],["T_NS_SEPARATOR","\\",219],["T_STRING","Magento",219],["T_NS_SEPARATOR","\\",219],["T_STRING","Store",219],["T_NS_SEPARATOR","\\",219],["T_STRING","Model",219],["T_NS_SEPARATOR","\\",219],["T_STRING","StoreManagerInterface",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$storeManager",219],",",["T_WHITESPACE","\n        ",219],["T_NS_SEPARATOR","\\",220],["T_STRING","Magento",220],["T_NS_SEPARATOR","\\",220],["T_STRING","Customer",220],["T_NS_SEPARATOR","\\",220],["T_STRING","Model",220],["T_NS_SEPARATOR","\\",220],["T_STRING","Session",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$customerSession",220],",",["T_WHITESPACE","\n        ",220],["T_NS_SEPARATOR","\\",221],["T_STRING","Magento",221],["T_NS_SEPARATOR","\\",221],["T_STRING","Customer",221],["T_NS_SEPARATOR","\\",221],["T_STRING","Model",221],["T_NS_SEPARATOR","\\",221],["T_STRING","CustomerFactory",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$customerFactory",221],",",["T_WHITESPACE","\n        ",221],["T_NS_SEPARATOR","\\",222],["T_STRING","Magento",222],["T_NS_SEPARATOR","\\",222],["T_STRING","Tax",222],["T_NS_SEPARATOR","\\",222],["T_STRING","Model",222],["T_NS_SEPARATOR","\\",222],["T_STRING","ResourceModel",222],["T_NS_SEPARATOR","\\",222],["T_STRING","TaxClass",222],["T_NS_SEPARATOR","\\",222],["T_STRING","CollectionFactory",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$classesFactory",222],",",["T_WHITESPACE","\n        ",222],["T_NS_SEPARATOR","\\",223],["T_STRING","Magento",223],["T_NS_SEPARATOR","\\",223],["T_STRING","Tax",223],["T_NS_SEPARATOR","\\",223],["T_STRING","Model",223],["T_NS_SEPARATOR","\\",223],["T_STRING","ResourceModel",223],["T_NS_SEPARATOR","\\",223],["T_STRING","Calculation",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$resource",223],",",["T_WHITESPACE","\n        ",223],["T_STRING","CustomerAccountManagement",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$customerAccountManagement",224],",",["T_WHITESPACE","\n        ",224],["T_STRING","CustomerGroupManagement",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$customerGroupManagement",225],",",["T_WHITESPACE","\n        ",225],["T_STRING","CustomerGroupRepository",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$customerGroupRepository",226],",",["T_WHITESPACE","\n        ",226],["T_STRING","CustomerRepository",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$customerRepository",227],",",["T_WHITESPACE","\n        ",227],["T_STRING","PriceCurrencyInterface",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$priceCurrency",228],",",["T_WHITESPACE","\n        ",228],["T_STRING","SearchCriteriaBuilder",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$searchCriteriaBuilder",229],",",["T_WHITESPACE","\n        ",229],["T_STRING","FilterBuilder",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$filterBuilder",230],",",["T_WHITESPACE","\n        ",230],["T_STRING","TaxClassRepositoryInterface",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$taxClassRepository",231],",",["T_WHITESPACE","\n        ",231],["T_NS_SEPARATOR","\\",232],["T_STRING","Magento",232],["T_NS_SEPARATOR","\\",232],["T_STRING","Framework",232],["T_NS_SEPARATOR","\\",232],["T_STRING","Data",232],["T_NS_SEPARATOR","\\",232],["T_STRING","Collection",232],["T_NS_SEPARATOR","\\",232],["T_STRING","AbstractDb",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$resourceCollection",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","null",232],",",["T_WHITESPACE","\n        ",232],["T_ARRAY","array",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$data",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],"[","]",["T_WHITESPACE","\n    ",233],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_scopeConfig",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$scopeConfig",235],";",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_config",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$taxConfig",236],";",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_storeManager",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$storeManager",237],";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_customerSession",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$customerSession",238],";",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_customerFactory",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$customerFactory",239],";",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_classesFactory",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$classesFactory",240],";",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","customerAccountManagement",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$customerAccountManagement",241],";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","customerGroupManagement",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$customerGroupManagement",242],";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","customerGroupRepository",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$customerGroupRepository",243],";",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","customerRepository",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$customerRepository",244],";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","priceCurrency",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$priceCurrency",245],";",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","searchCriteriaBuilder",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$searchCriteriaBuilder",246],";",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","filterBuilder",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$filterBuilder",247],";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","taxClassRepository",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_VARIABLE","$taxClassRepository",248],";",["T_WHITESPACE","\n        ",248],["T_STRING","parent",249],["T_DOUBLE_COLON","::",249],["T_STRING","__construct",249],"(",["T_VARIABLE","$context",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$registry",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$resource",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$resourceCollection",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$data",249],")",";",["T_WHITESPACE","\n    ",249],"}",["T_WHITESPACE","\n\n    ",250],["T_DOC_COMMENT","\/**\n     * @return void\n     *\/",252],["T_WHITESPACE","\n    ",254],["T_PROTECTED","protected",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","_construct",255],"(",")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_init",257],"(",["T_NS_SEPARATOR","\\",257],["T_STRING","Magento",257],["T_NS_SEPARATOR","\\",257],["T_STRING","Tax",257],["T_NS_SEPARATOR","\\",257],["T_STRING","Model",257],["T_NS_SEPARATOR","\\",257],["T_STRING","ResourceModel",257],["T_NS_SEPARATOR","\\",257],["T_STRING","Calculation",257],["T_DOUBLE_COLON","::",257],["T_CLASS","class",257],")",";",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Fetch default customer tax class\n     *\n     * @param null|Store|string|int $store\n     * @return int\n     *\/",260],["T_WHITESPACE","\n    ",265],["T_PUBLIC","public",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","getDefaultCustomerTaxClass",266],"(",["T_VARIABLE","$store",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","null",266],")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_IF","if",268],["T_WHITESPACE"," ",268],"(",["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_defaultCustomerTaxClass",268],["T_WHITESPACE"," ",268],["T_IS_IDENTICAL","===",268],["T_WHITESPACE"," ",268],["T_STRING","null",268],")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_COMMENT","\/\/Not catching the exception here since default group is expected\n",269],["T_WHITESPACE","            ",270],["T_VARIABLE","$defaultCustomerGroup",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","customerGroupManagement",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getDefaultGroup",270],"(",["T_VARIABLE","$store",270],")",";",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_defaultCustomerTaxClass",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$defaultCustomerGroup",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getTaxClassId",271],"(",")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE","\n        ",272],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_defaultCustomerTaxClass",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Delete calculation settings by rule id\n     *\n     * @param   int $ruleId\n     * @return  $this\n     *\/",276],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","deleteByRuleId",282],"(",["T_VARIABLE","$ruleId",282],")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_getResource",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","deleteByRuleId",284],"(",["T_VARIABLE","$ruleId",284],")",";",["T_WHITESPACE","\n        ",284],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n\n    ",286],["T_DOC_COMMENT","\/**\n     * Get calculation rates by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",288],["T_WHITESPACE","\n    ",293],["T_PUBLIC","public",294],["T_WHITESPACE"," ",294],["T_FUNCTION","function",294],["T_WHITESPACE"," ",294],["T_STRING","getRates",294],"(",["T_VARIABLE","$ruleId",294],")",["T_WHITESPACE","\n    ",294],"{",["T_WHITESPACE","\n        ",295],["T_IF","if",296],["T_WHITESPACE"," ",296],"(","!",["T_ISSET","isset",296],"(",["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_rates",296],"[",["T_VARIABLE","$ruleId",296],"]",")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_rates",297],"[",["T_VARIABLE","$ruleId",297],"]",["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_getResource",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","getCalculationsById",297],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$ruleId",297],")",";",["T_WHITESPACE","\n        ",297],"}",["T_WHITESPACE","\n        ",298],["T_RETURN","return",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_rates",299],"[",["T_VARIABLE","$ruleId",299],"]",";",["T_WHITESPACE","\n    ",299],"}",["T_WHITESPACE","\n\n    ",300],["T_DOC_COMMENT","\/**\n     * Get allowed customer tax classes by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",302],["T_WHITESPACE","\n    ",307],["T_PUBLIC","public",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","getCustomerTaxClasses",308],"(",["T_VARIABLE","$ruleId",308],")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(","!",["T_ISSET","isset",310],"(",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_ctc",310],"[",["T_VARIABLE","$ruleId",310],"]",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_ctc",311],"[",["T_VARIABLE","$ruleId",311],"]",["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_getResource",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getCalculationsById",311],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_tax_class_id'",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$ruleId",311],")",";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n        ",312],["T_RETURN","return",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_ctc",313],"[",["T_VARIABLE","$ruleId",313],"]",";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n    ",314],["T_DOC_COMMENT","\/**\n     * Get allowed product tax classes by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",316],["T_WHITESPACE","\n    ",321],["T_PUBLIC","public",322],["T_WHITESPACE"," ",322],["T_FUNCTION","function",322],["T_WHITESPACE"," ",322],["T_STRING","getProductTaxClasses",322],"(",["T_VARIABLE","$ruleId",322],")",["T_WHITESPACE","\n    ",322],"{",["T_WHITESPACE","\n        ",323],["T_IF","if",324],["T_WHITESPACE"," ",324],"(","!",["T_ISSET","isset",324],"(",["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_ptc",324],"[",["T_VARIABLE","$ruleId",324],"]",")",")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n            ",324],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_ptc",325],"[",["T_VARIABLE","$ruleId",325],"]",["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getResource",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getCalculationsById",325],"(",["T_CONSTANT_ENCAPSED_STRING","'product_tax_class_id'",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$ruleId",325],")",";",["T_WHITESPACE","\n        ",325],"}",["T_WHITESPACE","\n        ",326],["T_RETURN","return",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_ptc",327],"[",["T_VARIABLE","$ruleId",327],"]",";",["T_WHITESPACE","\n    ",327],"}",["T_WHITESPACE","\n\n    ",328],["T_DOC_COMMENT","\/**\n     * Aggregate tax calculation data to array\n     *\n     * @return array\n     *\/",330],["T_WHITESPACE","\n    ",334],["T_PROTECTED","protected",335],["T_WHITESPACE"," ",335],["T_FUNCTION","function",335],["T_WHITESPACE"," ",335],["T_STRING","_formCalculationProcess",335],"(",")",["T_WHITESPACE","\n    ",335],"{",["T_WHITESPACE","\n        ",336],["T_VARIABLE","$title",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getRateTitle",337],"(",")",";",["T_WHITESPACE","\n        ",337],["T_VARIABLE","$value",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getRateValue",338],"(",")",";",["T_WHITESPACE","\n        ",338],["T_VARIABLE","$id",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getRateId",339],"(",")",";",["T_WHITESPACE","\n\n        ",339],["T_VARIABLE","$rate",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$title",341],",",["T_WHITESPACE"," ",341],["T_CONSTANT_ENCAPSED_STRING","'title'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$title",341],",",["T_WHITESPACE"," ",341],["T_CONSTANT_ENCAPSED_STRING","'percent'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$value",341],",",["T_WHITESPACE"," ",341],["T_CONSTANT_ENCAPSED_STRING","'position'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_LNUMBER","1",341],",",["T_WHITESPACE"," ",341],["T_CONSTANT_ENCAPSED_STRING","'priority'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_LNUMBER","1",341],"]",";",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$process",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],"[","]",";",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$process",344],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",344],"]",["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_VARIABLE","$value",344],";",["T_WHITESPACE","\n        ",344],["T_VARIABLE","$process",345],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",345],"]",["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],"\"",["T_CURLY_OPEN","{",345],["T_VARIABLE","$id",345],"}",["T_ENCAPSED_AND_WHITESPACE","-",345],["T_CURLY_OPEN","{",345],["T_VARIABLE","$value",345],"}","\"",";",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$process",346],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",346],"]","[","]",["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$rate",346],";",["T_WHITESPACE","\n\n        ",346],["T_RETURN","return",348],["T_WHITESPACE"," ",348],"[",["T_VARIABLE","$process",348],"]",";",["T_WHITESPACE","\n    ",348],"}",["T_WHITESPACE","\n\n    ",349],["T_DOC_COMMENT","\/**\n     * Get calculation tax rate by specific request\n     *\n     * @param   \\Magento\\Framework\\DataObject $request\n     * @return  float\n     *\/",351],["T_WHITESPACE","\n    ",356],["T_PUBLIC","public",357],["T_WHITESPACE"," ",357],["T_FUNCTION","function",357],["T_WHITESPACE"," ",357],["T_STRING","getRate",357],"(",["T_VARIABLE","$request",357],")",["T_WHITESPACE","\n    ",357],"{",["T_WHITESPACE","\n        ",358],["T_IF","if",359],["T_WHITESPACE"," ",359],"(","!",["T_VARIABLE","$request",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getCountryId",359],"(",")",["T_WHITESPACE"," ",359],["T_BOOLEAN_OR","||",359],["T_WHITESPACE"," ",359],"!",["T_VARIABLE","$request",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getCustomerClassId",359],"(",")",["T_WHITESPACE"," ",359],["T_BOOLEAN_OR","||",359],["T_WHITESPACE"," ",359],"!",["T_VARIABLE","$request",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getProductClassId",359],"(",")",")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n            ",359],["T_RETURN","return",360],["T_WHITESPACE"," ",360],["T_LNUMBER","0",360],";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n\n        ",361],["T_VARIABLE","$cacheKey",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","_getRequestCacheKey",363],"(",["T_VARIABLE","$request",363],")",";",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(","!",["T_ISSET","isset",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_rateCache",364],"[",["T_VARIABLE","$cacheKey",364],"]",")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","unsRateValue",365],"(",")",";",["T_WHITESPACE","\n            ",365],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","unsCalculationProcess",366],"(",")",";",["T_WHITESPACE","\n            ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","unsEventModuleId",367],"(",")",";",["T_WHITESPACE","\n            ",367],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_eventManager",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","dispatch",368],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_rate_data_fetch'",368],",",["T_WHITESPACE"," ",368],"[",["T_CONSTANT_ENCAPSED_STRING","'request'",368],["T_WHITESPACE"," ",368],["T_DOUBLE_ARROW","=>",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$request",368],",",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'sender'",368],["T_WHITESPACE"," ",368],["T_DOUBLE_ARROW","=>",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],"]",")",";",["T_WHITESPACE","\n            ",368],["T_IF","if",369],["T_WHITESPACE"," ",369],"(","!",["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","hasRateValue",369],"(",")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n                ",369],["T_VARIABLE","$rateInfo",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_getResource",370],"(",")",["T_OBJECT_OPERATOR","->",370],["T_STRING","getRateInfo",370],"(",["T_VARIABLE","$request",370],")",";",["T_WHITESPACE","\n                ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setCalculationProcess",371],"(",["T_VARIABLE","$rateInfo",371],"[",["T_CONSTANT_ENCAPSED_STRING","'process'",371],"]",")",";",["T_WHITESPACE","\n                ",371],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","setRateValue",372],"(",["T_VARIABLE","$rateInfo",372],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",372],"]",")",";",["T_WHITESPACE","\n            ",372],"}",["T_WHITESPACE"," ",373],["T_ELSE","else",373],["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","setCalculationProcess",374],"(",["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_formCalculationProcess",374],"(",")",")",";",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","_rateCache",376],"[",["T_VARIABLE","$cacheKey",376],"]",["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getRateValue",376],"(",")",";",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_rateCalculationProcess",377],"[",["T_VARIABLE","$cacheKey",377],"]",["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getCalculationProcess",377],"(",")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n        ",378],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","_rateCache",379],"[",["T_VARIABLE","$cacheKey",379],"]",";",["T_WHITESPACE","\n    ",379],"}",["T_WHITESPACE","\n\n    ",380],["T_DOC_COMMENT","\/**\n     * Get cache key value for specific tax rate request\n     *\n     * @param   \\Magento\\Framework\\DataObject $request\n     * @return  string\n     *\/",382],["T_WHITESPACE","\n    ",387],["T_PROTECTED","protected",388],["T_WHITESPACE"," ",388],["T_FUNCTION","function",388],["T_WHITESPACE"," ",388],["T_STRING","_getRequestCacheKey",388],"(",["T_VARIABLE","$request",388],")",["T_WHITESPACE","\n    ",388],"{",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$store",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_VARIABLE","$request",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getStore",390],"(",")",";",["T_WHITESPACE","\n        ",390],["T_VARIABLE","$key",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_CONSTANT_ENCAPSED_STRING","''",391],";",["T_WHITESPACE","\n        ",391],["T_IF","if",392],["T_WHITESPACE"," ",392],"(",["T_VARIABLE","$store",392],["T_WHITESPACE"," ",392],["T_INSTANCEOF","instanceof",392],["T_WHITESPACE"," ",392],["T_NS_SEPARATOR","\\",392],["T_STRING","Magento",392],["T_NS_SEPARATOR","\\",392],["T_STRING","Store",392],["T_NS_SEPARATOR","\\",392],["T_STRING","Model",392],["T_NS_SEPARATOR","\\",392],["T_STRING","Store",392],")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n            ",392],["T_VARIABLE","$key",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_VARIABLE","$store",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getId",393],"(",")",["T_WHITESPACE"," ",393],".",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'|'",393],";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE"," ",394],["T_ELSEIF","elseif",394],["T_WHITESPACE"," ",394],"(",["T_STRING","is_numeric",394],"(",["T_VARIABLE","$store",394],")",")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$key",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_VARIABLE","$store",395],["T_WHITESPACE"," ",395],".",["T_WHITESPACE"," ",395],["T_CONSTANT_ENCAPSED_STRING","'|'",395],";",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$key",397],["T_WHITESPACE"," ",397],["T_CONCAT_EQUAL",".=",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$request",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getProductClassId",397],"(",")",["T_WHITESPACE"," ",397],".",["T_WHITESPACE"," ",397],["T_CONSTANT_ENCAPSED_STRING","'|'",397],["T_WHITESPACE","\n            ",397],".",["T_WHITESPACE"," ",398],["T_VARIABLE","$request",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getCustomerClassId",398],"(",")",["T_WHITESPACE"," ",398],".",["T_WHITESPACE"," ",398],["T_CONSTANT_ENCAPSED_STRING","'|'",398],["T_WHITESPACE","\n            ",398],".",["T_WHITESPACE"," ",399],["T_VARIABLE","$request",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getCountryId",399],"(",")",["T_WHITESPACE"," ",399],".",["T_WHITESPACE"," ",399],["T_CONSTANT_ENCAPSED_STRING","'|'",399],["T_WHITESPACE","\n            ",399],".",["T_WHITESPACE"," ",400],["T_VARIABLE","$request",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getRegionId",400],"(",")",["T_WHITESPACE"," ",400],".",["T_WHITESPACE"," ",400],["T_CONSTANT_ENCAPSED_STRING","'|'",400],["T_WHITESPACE","\n            ",400],".",["T_WHITESPACE"," ",401],["T_VARIABLE","$request",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getPostcode",401],"(",")",";",["T_WHITESPACE","\n        ",401],["T_RETURN","return",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$key",402],";",["T_WHITESPACE","\n    ",402],"}",["T_WHITESPACE","\n\n    ",403],["T_DOC_COMMENT","\/**\n     * Get tax rate based on store shipping origin address settings\n     * This rate can be used for conversion store price including tax to\n     * store price excluding tax\n     *\n     * @param \\Magento\\Framework\\DataObject $request\n     * @param null|string|bool|int|Store $store\n     * @return float\n     *\/",405],["T_WHITESPACE","\n    ",413],["T_PUBLIC","public",414],["T_WHITESPACE"," ",414],["T_FUNCTION","function",414],["T_WHITESPACE"," ",414],["T_STRING","getStoreRate",414],"(",["T_VARIABLE","$request",414],",",["T_WHITESPACE"," ",414],["T_VARIABLE","$store",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_STRING","null",414],")",["T_WHITESPACE","\n    ",414],"{",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$storeRequest",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getRateOriginRequest",416],"(",["T_VARIABLE","$store",416],")",["T_OBJECT_OPERATOR","->",416],["T_STRING","setProductClassId",416],"(",["T_VARIABLE","$request",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getProductClassId",416],"(",")",")",";",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getRate",417],"(",["T_VARIABLE","$storeRequest",417],")",";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Get request object for getting tax rate based on store shipping original address\n     *\n     * @param   null|string|bool|int|Store $store\n     * @return  \\Magento\\Framework\\DataObject\n     *\/",420],["T_WHITESPACE","\n    ",425],["T_PROTECTED","protected",426],["T_WHITESPACE"," ",426],["T_FUNCTION","function",426],["T_WHITESPACE"," ",426],["T_STRING","getRateOriginRequest",426],"(",["T_VARIABLE","$store",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_STRING","null",426],")",["T_WHITESPACE","\n    ",426],"{",["T_WHITESPACE","\n        ",427],["T_VARIABLE","$request",428],["T_WHITESPACE"," ",428],"=",["T_WHITESPACE"," ",428],["T_NEW","new",428],["T_WHITESPACE"," ",428],["T_NS_SEPARATOR","\\",428],["T_STRING","Magento",428],["T_NS_SEPARATOR","\\",428],["T_STRING","Framework",428],["T_NS_SEPARATOR","\\",428],["T_STRING","DataObject",428],"(",")",";",["T_WHITESPACE","\n        ",428],["T_VARIABLE","$request",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","setCountryId",429],"(",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","_scopeConfig",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getValue",430],"(",["T_WHITESPACE","\n                ",430],["T_NS_SEPARATOR","\\",431],["T_STRING","Magento",431],["T_NS_SEPARATOR","\\",431],["T_STRING","Shipping",431],["T_NS_SEPARATOR","\\",431],["T_STRING","Model",431],["T_NS_SEPARATOR","\\",431],["T_STRING","Config",431],["T_DOUBLE_COLON","::",431],["T_STRING","XML_PATH_ORIGIN_COUNTRY_ID",431],",",["T_WHITESPACE","\n                ",431],["T_NS_SEPARATOR","\\",432],["T_STRING","Magento",432],["T_NS_SEPARATOR","\\",432],["T_STRING","Store",432],["T_NS_SEPARATOR","\\",432],["T_STRING","Model",432],["T_NS_SEPARATOR","\\",432],["T_STRING","ScopeInterface",432],["T_DOUBLE_COLON","::",432],["T_STRING","SCOPE_STORE",432],",",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$store",433],["T_WHITESPACE","\n            ",433],")",["T_WHITESPACE","\n        ",434],")",["T_OBJECT_OPERATOR","->",435],["T_STRING","setRegionId",435],"(",["T_WHITESPACE","\n            ",435],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","_scopeConfig",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getValue",436],"(",["T_WHITESPACE","\n                ",436],["T_NS_SEPARATOR","\\",437],["T_STRING","Magento",437],["T_NS_SEPARATOR","\\",437],["T_STRING","Shipping",437],["T_NS_SEPARATOR","\\",437],["T_STRING","Model",437],["T_NS_SEPARATOR","\\",437],["T_STRING","Config",437],["T_DOUBLE_COLON","::",437],["T_STRING","XML_PATH_ORIGIN_REGION_ID",437],",",["T_WHITESPACE","\n                ",437],["T_NS_SEPARATOR","\\",438],["T_STRING","Magento",438],["T_NS_SEPARATOR","\\",438],["T_STRING","Store",438],["T_NS_SEPARATOR","\\",438],["T_STRING","Model",438],["T_NS_SEPARATOR","\\",438],["T_STRING","ScopeInterface",438],["T_DOUBLE_COLON","::",438],["T_STRING","SCOPE_STORE",438],",",["T_WHITESPACE","\n                ",438],["T_VARIABLE","$store",439],["T_WHITESPACE","\n            ",439],")",["T_WHITESPACE","\n        ",440],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","setPostcode",441],"(",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","_scopeConfig",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getValue",442],"(",["T_WHITESPACE","\n                ",442],["T_NS_SEPARATOR","\\",443],["T_STRING","Magento",443],["T_NS_SEPARATOR","\\",443],["T_STRING","Shipping",443],["T_NS_SEPARATOR","\\",443],["T_STRING","Model",443],["T_NS_SEPARATOR","\\",443],["T_STRING","Config",443],["T_DOUBLE_COLON","::",443],["T_STRING","XML_PATH_ORIGIN_POSTCODE",443],",",["T_WHITESPACE","\n                ",443],["T_NS_SEPARATOR","\\",444],["T_STRING","Magento",444],["T_NS_SEPARATOR","\\",444],["T_STRING","Store",444],["T_NS_SEPARATOR","\\",444],["T_STRING","Model",444],["T_NS_SEPARATOR","\\",444],["T_STRING","ScopeInterface",444],["T_DOUBLE_COLON","::",444],["T_STRING","SCOPE_STORE",444],",",["T_WHITESPACE","\n                ",444],["T_VARIABLE","$store",445],["T_WHITESPACE","\n            ",445],")",["T_WHITESPACE","\n        ",446],")",["T_OBJECT_OPERATOR","->",447],["T_STRING","setCustomerClassId",447],"(",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","getDefaultCustomerTaxClass",448],"(",["T_VARIABLE","$store",448],")",["T_WHITESPACE","\n        ",448],")",["T_OBJECT_OPERATOR","->",449],["T_STRING","setStore",449],"(",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$store",450],["T_WHITESPACE","\n        ",450],")",";",["T_WHITESPACE","\n        ",451],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$request",452],";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Return the default rate request. It can be either based on store address or customer address\n     *\n     * @param null|int|string|Store $store\n     * @param int $customerId\n     * @return \\Magento\\Framework\\DataObject\n     *\/",455],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","getDefaultRateRequest",462],"(",["T_VARIABLE","$store",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","null",462],",",["T_WHITESPACE"," ",462],["T_VARIABLE","$customerId",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","null",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_IF","if",464],["T_WHITESPACE"," ",464],"(",["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_isCrossBorderTradeEnabled",464],"(",["T_VARIABLE","$store",464],")",")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n            ",464],["T_COMMENT","\/\/If cross border trade is enabled, we will use customer tax rate as store tax rate\n",465],["T_WHITESPACE","            ",466],["T_RETURN","return",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getRateRequest",466],"(",["T_STRING","null",466],",",["T_WHITESPACE"," ",466],["T_STRING","null",466],",",["T_WHITESPACE"," ",466],["T_STRING","null",466],",",["T_WHITESPACE"," ",466],["T_VARIABLE","$store",466],",",["T_WHITESPACE"," ",466],["T_VARIABLE","$customerId",466],")",";",["T_WHITESPACE","\n        ",466],"}",["T_WHITESPACE"," ",467],["T_ELSE","else",467],["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_RETURN","return",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getRateOriginRequest",468],"(",["T_VARIABLE","$store",468],")",";",["T_WHITESPACE","\n        ",468],"}",["T_WHITESPACE","\n    ",469],"}",["T_WHITESPACE","\n\n    ",470],["T_DOC_COMMENT","\/**\n     * Return whether cross border trade is enabled or not\n     *\n     * @param   null|int|string|Store $store\n     * @return  bool\n     *\/",472],["T_WHITESPACE","\n    ",477],["T_PROTECTED","protected",478],["T_WHITESPACE"," ",478],["T_FUNCTION","function",478],["T_WHITESPACE"," ",478],["T_STRING","_isCrossBorderTradeEnabled",478],"(",["T_VARIABLE","$store",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_STRING","null",478],")",["T_WHITESPACE","\n    ",478],"{",["T_WHITESPACE","\n        ",479],["T_RETURN","return",480],["T_WHITESPACE"," ",480],["T_BOOL_CAST","(bool)",480],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","_config",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","crossBorderTradeEnabled",480],"(",["T_VARIABLE","$store",480],")",";",["T_WHITESPACE","\n    ",480],"}",["T_WHITESPACE","\n\n    ",481],["T_DOC_COMMENT","\/**\n     * Get request object with information necessary for getting tax rate\n     *\n     * Request object contain:\n     *  country_id (->getCountryId())\n     *  region_id (->getRegionId())\n     *  postcode (->getPostcode())\n     *  customer_class_id (->getCustomerClassId())\n     *  store (->getStore())\n     *\n     * @param null|bool|\\Magento\\Framework\\DataObject|CustomerAddress $shippingAddress\n     * @param null|bool|\\Magento\\Framework\\DataObject|CustomerAddress $billingAddress\n     * @param null|int $customerTaxClass\n     * @param null|int|\\Magento\\Store\\Model\\Store $store\n     * @param int $customerId\n     * @return  \\Magento\\Framework\\DataObject\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",483],["T_WHITESPACE","\n    ",502],["T_PUBLIC","public",503],["T_WHITESPACE"," ",503],["T_FUNCTION","function",503],["T_WHITESPACE"," ",503],["T_STRING","getRateRequest",503],"(",["T_WHITESPACE","\n        ",503],["T_VARIABLE","$shippingAddress",504],["T_WHITESPACE"," ",504],"=",["T_WHITESPACE"," ",504],["T_STRING","null",504],",",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$billingAddress",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_STRING","null",505],",",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$customerTaxClass",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_STRING","null",506],",",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$store",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_STRING","null",507],",",["T_WHITESPACE","\n        ",507],["T_VARIABLE","$customerId",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_STRING","null",508],["T_WHITESPACE","\n    ",508],")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n        ",509],["T_IF","if",510],["T_WHITESPACE"," ",510],"(",["T_VARIABLE","$shippingAddress",510],["T_WHITESPACE"," ",510],["T_IS_IDENTICAL","===",510],["T_WHITESPACE"," ",510],["T_STRING","false",510],["T_WHITESPACE"," ",510],["T_BOOLEAN_AND","&&",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$billingAddress",510],["T_WHITESPACE"," ",510],["T_IS_IDENTICAL","===",510],["T_WHITESPACE"," ",510],["T_STRING","false",510],["T_WHITESPACE"," ",510],["T_BOOLEAN_AND","&&",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$customerTaxClass",510],["T_WHITESPACE"," ",510],["T_IS_IDENTICAL","===",510],["T_WHITESPACE"," ",510],["T_STRING","false",510],")",["T_WHITESPACE"," ",510],"{",["T_WHITESPACE","\n            ",510],["T_RETURN","return",511],["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getRateOriginRequest",511],"(",["T_VARIABLE","$store",511],")",";",["T_WHITESPACE","\n        ",511],"}",["T_WHITESPACE","\n        ",512],["T_VARIABLE","$address",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_NEW","new",513],["T_WHITESPACE"," ",513],["T_NS_SEPARATOR","\\",513],["T_STRING","Magento",513],["T_NS_SEPARATOR","\\",513],["T_STRING","Framework",513],["T_NS_SEPARATOR","\\",513],["T_STRING","DataObject",513],"(",")",";",["T_WHITESPACE","\n        ",513],["T_VARIABLE","$basedOn",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","_scopeConfig",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getValue",514],"(",["T_WHITESPACE","\n            ",514],["T_NS_SEPARATOR","\\",515],["T_STRING","Magento",515],["T_NS_SEPARATOR","\\",515],["T_STRING","Tax",515],["T_NS_SEPARATOR","\\",515],["T_STRING","Model",515],["T_NS_SEPARATOR","\\",515],["T_STRING","Config",515],["T_DOUBLE_COLON","::",515],["T_STRING","CONFIG_XML_PATH_BASED_ON",515],",",["T_WHITESPACE","\n            ",515],["T_NS_SEPARATOR","\\",516],["T_STRING","Magento",516],["T_NS_SEPARATOR","\\",516],["T_STRING","Store",516],["T_NS_SEPARATOR","\\",516],["T_STRING","Model",516],["T_NS_SEPARATOR","\\",516],["T_STRING","ScopeInterface",516],["T_DOUBLE_COLON","::",516],["T_STRING","SCOPE_STORE",516],",",["T_WHITESPACE","\n            ",516],["T_VARIABLE","$store",517],["T_WHITESPACE","\n        ",517],")",";",["T_WHITESPACE","\n\n        ",518],["T_IF","if",520],["T_WHITESPACE"," ",520],"(",["T_VARIABLE","$shippingAddress",520],["T_WHITESPACE"," ",520],["T_IS_IDENTICAL","===",520],["T_WHITESPACE"," ",520],["T_STRING","false",520],["T_WHITESPACE"," ",520],["T_BOOLEAN_AND","&&",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$basedOn",520],["T_WHITESPACE"," ",520],["T_IS_EQUAL","==",520],["T_WHITESPACE"," ",520],["T_CONSTANT_ENCAPSED_STRING","'shipping'",520],["T_WHITESPACE"," ",520],["T_BOOLEAN_OR","||",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$billingAddress",520],["T_WHITESPACE"," ",520],["T_IS_IDENTICAL","===",520],["T_WHITESPACE"," ",520],["T_STRING","false",520],["T_WHITESPACE"," ",520],["T_BOOLEAN_AND","&&",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$basedOn",520],["T_WHITESPACE"," ",520],["T_IS_EQUAL","==",520],["T_WHITESPACE"," ",520],["T_CONSTANT_ENCAPSED_STRING","'billing'",520],["T_WHITESPACE","\n        ",520],")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$basedOn",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_CONSTANT_ENCAPSED_STRING","'default'",522],";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE"," ",523],["T_ELSE","else",523],["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n\n            ",523],["T_IF","if",525],["T_WHITESPACE"," ",525],"(","(",["T_VARIABLE","$billingAddress",525],["T_WHITESPACE"," ",525],["T_IS_IDENTICAL","===",525],["T_WHITESPACE"," ",525],["T_STRING","null",525],["T_WHITESPACE"," ",525],["T_BOOLEAN_OR","||",525],["T_WHITESPACE"," ",525],"!",["T_VARIABLE","$billingAddress",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","getCountryId",525],"(",")",")",["T_WHITESPACE","\n                ",525],["T_BOOLEAN_AND","&&",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$basedOn",526],["T_WHITESPACE"," ",526],["T_IS_EQUAL","==",526],["T_WHITESPACE"," ",526],["T_CONSTANT_ENCAPSED_STRING","'billing'",526],["T_WHITESPACE","\n                ",526],["T_BOOLEAN_OR","||",527],["T_WHITESPACE"," ",527],"(",["T_VARIABLE","$shippingAddress",527],["T_WHITESPACE"," ",527],["T_IS_IDENTICAL","===",527],["T_WHITESPACE"," ",527],["T_STRING","null",527],["T_WHITESPACE"," ",527],["T_BOOLEAN_OR","||",527],["T_WHITESPACE"," ",527],"!",["T_VARIABLE","$shippingAddress",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getCountryId",527],"(",")",")",["T_WHITESPACE","\n                ",527],["T_BOOLEAN_AND","&&",528],["T_WHITESPACE"," ",528],["T_VARIABLE","$basedOn",528],["T_WHITESPACE"," ",528],["T_IS_EQUAL","==",528],["T_WHITESPACE"," ",528],["T_CONSTANT_ENCAPSED_STRING","'shipping'",528],["T_WHITESPACE","\n            ",528],")",["T_WHITESPACE"," ",529],"{",["T_WHITESPACE","\n                ",529],["T_IF","if",530],["T_WHITESPACE"," ",530],"(",["T_VARIABLE","$customerId",530],")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n                    ",530],["T_COMMENT","\/\/fallback to default address for registered customer\n",531],["T_WHITESPACE","                    ",532],["T_TRY","try",532],["T_WHITESPACE"," ",532],"{",["T_WHITESPACE","\n                        ",532],["T_VARIABLE","$defaultBilling",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","customerAccountManagement",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getDefaultBillingAddress",533],"(",["T_VARIABLE","$customerId",533],")",";",["T_WHITESPACE","\n                    ",533],"}",["T_WHITESPACE"," ",534],["T_CATCH","catch",534],["T_WHITESPACE"," ",534],"(",["T_STRING","NoSuchEntityException",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$e",534],")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n                    ",534],"}",["T_WHITESPACE","\n\n                    ",535],["T_TRY","try",537],["T_WHITESPACE"," ",537],"{",["T_WHITESPACE","\n                        ",537],["T_VARIABLE","$defaultShipping",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","customerAccountManagement",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getDefaultShippingAddress",538],"(",["T_VARIABLE","$customerId",538],")",";",["T_WHITESPACE","\n                    ",538],"}",["T_WHITESPACE"," ",539],["T_CATCH","catch",539],["T_WHITESPACE"," ",539],"(",["T_STRING","NoSuchEntityException",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$e",539],")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                    ",539],"}",["T_WHITESPACE","\n\n                    ",540],["T_IF","if",542],["T_WHITESPACE"," ",542],"(",["T_VARIABLE","$basedOn",542],["T_WHITESPACE"," ",542],["T_IS_EQUAL","==",542],["T_WHITESPACE"," ",542],["T_CONSTANT_ENCAPSED_STRING","'billing'",542],["T_WHITESPACE"," ",542],["T_BOOLEAN_AND","&&",542],["T_WHITESPACE"," ",542],["T_ISSET","isset",542],"(",["T_VARIABLE","$defaultBilling",542],")",["T_WHITESPACE"," ",542],["T_BOOLEAN_AND","&&",542],["T_WHITESPACE"," ",542],["T_VARIABLE","$defaultBilling",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getCountryId",542],"(",")",")",["T_WHITESPACE"," ",542],"{",["T_WHITESPACE","\n                        ",542],["T_VARIABLE","$billingAddress",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$defaultBilling",543],";",["T_WHITESPACE","\n                    ",543],"}",["T_WHITESPACE"," ",544],["T_ELSEIF","elseif",544],["T_WHITESPACE"," ",544],"(",["T_VARIABLE","$basedOn",544],["T_WHITESPACE"," ",544],["T_IS_EQUAL","==",544],["T_WHITESPACE"," ",544],["T_CONSTANT_ENCAPSED_STRING","'shipping'",544],["T_WHITESPACE"," ",544],["T_BOOLEAN_AND","&&",544],["T_WHITESPACE"," ",544],["T_ISSET","isset",544],"(",["T_VARIABLE","$defaultShipping",544],")",["T_WHITESPACE"," ",544],["T_BOOLEAN_AND","&&",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$defaultShipping",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getCountryId",544],"(",")",")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n                        ",544],["T_VARIABLE","$shippingAddress",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$defaultShipping",545],";",["T_WHITESPACE","\n                    ",545],"}",["T_WHITESPACE"," ",546],["T_ELSE","else",546],["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n                        ",546],["T_VARIABLE","$basedOn",547],["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_CONSTANT_ENCAPSED_STRING","'default'",547],";",["T_WHITESPACE","\n                    ",547],"}",["T_WHITESPACE","\n                ",548],"}",["T_WHITESPACE"," ",549],["T_ELSE","else",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n                    ",549],["T_COMMENT","\/\/fallback for guest\n",550],["T_WHITESPACE","                    ",551],["T_IF","if",551],["T_WHITESPACE"," ",551],"(",["T_VARIABLE","$basedOn",551],["T_WHITESPACE"," ",551],["T_IS_EQUAL","==",551],["T_WHITESPACE"," ",551],["T_CONSTANT_ENCAPSED_STRING","'billing'",551],["T_WHITESPACE"," ",551],["T_BOOLEAN_AND","&&",551],["T_WHITESPACE"," ",551],["T_STRING","is_object",551],"(",["T_VARIABLE","$shippingAddress",551],")",["T_WHITESPACE"," ",551],["T_BOOLEAN_AND","&&",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$shippingAddress",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getCountryId",551],"(",")",")",["T_WHITESPACE"," ",551],"{",["T_WHITESPACE","\n                        ",551],["T_VARIABLE","$billingAddress",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_VARIABLE","$shippingAddress",552],";",["T_WHITESPACE","\n                    ",552],"}",["T_WHITESPACE"," ",553],["T_ELSEIF","elseif",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$basedOn",553],["T_WHITESPACE"," ",553],["T_IS_EQUAL","==",553],["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'shipping'",553],["T_WHITESPACE"," ",553],["T_BOOLEAN_AND","&&",553],["T_WHITESPACE"," ",553],["T_STRING","is_object",553],"(",["T_VARIABLE","$billingAddress",553],")",["T_WHITESPACE"," ",553],["T_BOOLEAN_AND","&&",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$billingAddress",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","getCountryId",553],"(",")",")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                        ",553],["T_VARIABLE","$shippingAddress",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_VARIABLE","$billingAddress",554],";",["T_WHITESPACE","\n                    ",554],"}",["T_WHITESPACE"," ",555],["T_ELSE","else",555],["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n                        ",555],["T_VARIABLE","$basedOn",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_CONSTANT_ENCAPSED_STRING","'default'",556],";",["T_WHITESPACE","\n                    ",556],"}",["T_WHITESPACE","\n                ",557],"}",["T_WHITESPACE","\n            ",558],"}",["T_WHITESPACE","\n        ",559],"}",["T_WHITESPACE","\n\n        ",560],["T_SWITCH","switch",562],["T_WHITESPACE"," ",562],"(",["T_VARIABLE","$basedOn",562],")",["T_WHITESPACE"," ",562],"{",["T_WHITESPACE","\n            ",562],["T_CASE","case",563],["T_WHITESPACE"," ",563],["T_CONSTANT_ENCAPSED_STRING","'billing'",563],":",["T_WHITESPACE","\n                ",563],["T_VARIABLE","$address",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_VARIABLE","$billingAddress",564],";",["T_WHITESPACE","\n                ",564],["T_BREAK","break",565],";",["T_WHITESPACE","\n            ",565],["T_CASE","case",566],["T_WHITESPACE"," ",566],["T_CONSTANT_ENCAPSED_STRING","'shipping'",566],":",["T_WHITESPACE","\n                ",566],["T_VARIABLE","$address",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$shippingAddress",567],";",["T_WHITESPACE","\n                ",567],["T_BREAK","break",568],";",["T_WHITESPACE","\n            ",568],["T_CASE","case",569],["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'origin'",569],":",["T_WHITESPACE","\n                ",569],["T_VARIABLE","$address",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","getRateOriginRequest",570],"(",["T_VARIABLE","$store",570],")",";",["T_WHITESPACE","\n                ",570],["T_BREAK","break",571],";",["T_WHITESPACE","\n            ",571],["T_CASE","case",572],["T_WHITESPACE"," ",572],["T_CONSTANT_ENCAPSED_STRING","'default'",572],":",["T_WHITESPACE","\n                ",572],["T_VARIABLE","$address",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","setCountryId",573],"(",["T_WHITESPACE","\n                    ",573],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_scopeConfig",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getValue",574],"(",["T_WHITESPACE","\n                        ",574],["T_NS_SEPARATOR","\\",575],["T_STRING","Magento",575],["T_NS_SEPARATOR","\\",575],["T_STRING","Tax",575],["T_NS_SEPARATOR","\\",575],["T_STRING","Model",575],["T_NS_SEPARATOR","\\",575],["T_STRING","Config",575],["T_DOUBLE_COLON","::",575],["T_STRING","CONFIG_XML_PATH_DEFAULT_COUNTRY",575],",",["T_WHITESPACE","\n                        ",575],["T_NS_SEPARATOR","\\",576],["T_STRING","Magento",576],["T_NS_SEPARATOR","\\",576],["T_STRING","Store",576],["T_NS_SEPARATOR","\\",576],["T_STRING","Model",576],["T_NS_SEPARATOR","\\",576],["T_STRING","ScopeInterface",576],["T_DOUBLE_COLON","::",576],["T_STRING","SCOPE_STORE",576],",",["T_WHITESPACE","\n                        ",576],["T_VARIABLE","$store",577],["T_WHITESPACE","\n                    ",577],")",["T_WHITESPACE","\n                ",578],")",["T_OBJECT_OPERATOR","->",579],["T_STRING","setRegionId",579],"(",["T_WHITESPACE","\n                    ",579],["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","_scopeConfig",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getValue",580],"(",["T_WHITESPACE","\n                        ",580],["T_NS_SEPARATOR","\\",581],["T_STRING","Magento",581],["T_NS_SEPARATOR","\\",581],["T_STRING","Tax",581],["T_NS_SEPARATOR","\\",581],["T_STRING","Model",581],["T_NS_SEPARATOR","\\",581],["T_STRING","Config",581],["T_DOUBLE_COLON","::",581],["T_STRING","CONFIG_XML_PATH_DEFAULT_REGION",581],",",["T_WHITESPACE","\n                        ",581],["T_NS_SEPARATOR","\\",582],["T_STRING","Magento",582],["T_NS_SEPARATOR","\\",582],["T_STRING","Store",582],["T_NS_SEPARATOR","\\",582],["T_STRING","Model",582],["T_NS_SEPARATOR","\\",582],["T_STRING","ScopeInterface",582],["T_DOUBLE_COLON","::",582],["T_STRING","SCOPE_STORE",582],",",["T_WHITESPACE","\n                        ",582],["T_VARIABLE","$store",583],["T_WHITESPACE","\n                    ",583],")",["T_WHITESPACE","\n                ",584],")",["T_OBJECT_OPERATOR","->",585],["T_STRING","setPostcode",585],"(",["T_WHITESPACE","\n                    ",585],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","_scopeConfig",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getValue",586],"(",["T_WHITESPACE","\n                        ",586],["T_NS_SEPARATOR","\\",587],["T_STRING","Magento",587],["T_NS_SEPARATOR","\\",587],["T_STRING","Tax",587],["T_NS_SEPARATOR","\\",587],["T_STRING","Model",587],["T_NS_SEPARATOR","\\",587],["T_STRING","Config",587],["T_DOUBLE_COLON","::",587],["T_STRING","CONFIG_XML_PATH_DEFAULT_POSTCODE",587],",",["T_WHITESPACE","\n                        ",587],["T_NS_SEPARATOR","\\",588],["T_STRING","Magento",588],["T_NS_SEPARATOR","\\",588],["T_STRING","Store",588],["T_NS_SEPARATOR","\\",588],["T_STRING","Model",588],["T_NS_SEPARATOR","\\",588],["T_STRING","ScopeInterface",588],["T_DOUBLE_COLON","::",588],["T_STRING","SCOPE_STORE",588],",",["T_WHITESPACE","\n                        ",588],["T_VARIABLE","$store",589],["T_WHITESPACE","\n                    ",589],")",["T_WHITESPACE","\n                ",590],")",";",["T_WHITESPACE","\n                ",591],["T_BREAK","break",592],";",["T_WHITESPACE","\n            ",592],["T_DEFAULT","default",593],":",["T_WHITESPACE","\n                ",593],["T_BREAK","break",594],";",["T_WHITESPACE","\n        ",594],"}",["T_WHITESPACE","\n\n        ",595],["T_IF","if",597],["T_WHITESPACE"," ",597],"(",["T_VARIABLE","$customerTaxClass",597],["T_WHITESPACE"," ",597],["T_IS_IDENTICAL","===",597],["T_WHITESPACE"," ",597],["T_STRING","null",597],["T_WHITESPACE"," ",597],["T_BOOLEAN_OR","||",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$customerTaxClass",597],["T_WHITESPACE"," ",597],["T_IS_IDENTICAL","===",597],["T_WHITESPACE"," ",597],["T_STRING","false",597],")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n            ",597],["T_IF","if",598],["T_WHITESPACE"," ",598],"(",["T_VARIABLE","$customerId",598],")",["T_WHITESPACE"," ",598],"{",["T_WHITESPACE","\n                ",598],["T_VARIABLE","$customerData",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","customerRepository",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","getById",599],"(",["T_VARIABLE","$customerId",599],")",";",["T_WHITESPACE","\n                ",599],["T_VARIABLE","$customerTaxClass",600],["T_WHITESPACE"," ",600],"=",["T_WHITESPACE"," ",600],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","customerGroupRepository",600],["T_WHITESPACE","\n                    ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","getById",601],"(",["T_VARIABLE","$customerData",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getGroupId",601],"(",")",")",["T_WHITESPACE","\n                    ",601],["T_OBJECT_OPERATOR","->",602],["T_STRING","getTaxClassId",602],"(",")",";",["T_WHITESPACE","\n            ",602],"}",["T_WHITESPACE"," ",603],["T_ELSE","else",603],["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n                ",603],["T_VARIABLE","$customerTaxClass",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","customerGroupManagement",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","getNotLoggedInGroup",604],"(",")",["T_OBJECT_OPERATOR","->",604],["T_STRING","getTaxClassId",604],"(",")",";",["T_WHITESPACE","\n            ",604],"}",["T_WHITESPACE","\n        ",605],"}",["T_WHITESPACE","\n\n        ",606],["T_VARIABLE","$request",608],["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_NEW","new",608],["T_WHITESPACE"," ",608],["T_NS_SEPARATOR","\\",608],["T_STRING","Magento",608],["T_NS_SEPARATOR","\\",608],["T_STRING","Framework",608],["T_NS_SEPARATOR","\\",608],["T_STRING","DataObject",608],"(",")",";",["T_WHITESPACE","\n        ",608],["T_COMMENT","\/\/TODO: Address is not completely refactored to use Data objects\n",609],["T_WHITESPACE","        ",610],["T_IF","if",610],["T_WHITESPACE"," ",610],"(",["T_VARIABLE","$address",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getRegion",610],"(",")",["T_WHITESPACE"," ",610],["T_INSTANCEOF","instanceof",610],["T_WHITESPACE"," ",610],["T_STRING","AddressRegion",610],")",["T_WHITESPACE"," ",610],"{",["T_WHITESPACE","\n            ",610],["T_VARIABLE","$regionId",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_VARIABLE","$address",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","getRegion",611],"(",")",["T_OBJECT_OPERATOR","->",611],["T_STRING","getRegionId",611],"(",")",";",["T_WHITESPACE","\n        ",611],"}",["T_WHITESPACE"," ",612],["T_ELSE","else",612],["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n            ",612],["T_VARIABLE","$regionId",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$address",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","getRegionId",613],"(",")",";",["T_WHITESPACE","\n        ",613],"}",["T_WHITESPACE","\n        ",614],["T_VARIABLE","$request",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","setCountryId",615],"(",["T_VARIABLE","$address",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","getCountryId",615],"(",")",")",["T_WHITESPACE","\n            ",615],["T_OBJECT_OPERATOR","->",616],["T_STRING","setRegionId",616],"(",["T_VARIABLE","$regionId",616],")",["T_WHITESPACE","\n            ",616],["T_OBJECT_OPERATOR","->",617],["T_STRING","setPostcode",617],"(",["T_VARIABLE","$address",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getPostcode",617],"(",")",")",["T_WHITESPACE","\n            ",617],["T_OBJECT_OPERATOR","->",618],["T_STRING","setStore",618],"(",["T_VARIABLE","$store",618],")",["T_WHITESPACE","\n            ",618],["T_OBJECT_OPERATOR","->",619],["T_STRING","setCustomerClassId",619],"(",["T_VARIABLE","$customerTaxClass",619],")",";",["T_WHITESPACE","\n        ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_VARIABLE","$request",620],";",["T_WHITESPACE","\n    ",620],"}",["T_WHITESPACE","\n\n    ",621],["T_DOC_COMMENT","\/**\n     * Get information about tax rates applied to request\n     *\n     * @param   \\Magento\\Framework\\DataObject $request\n     * @return  array\n     *\/",623],["T_WHITESPACE","\n    ",628],["T_PUBLIC","public",629],["T_WHITESPACE"," ",629],["T_FUNCTION","function",629],["T_WHITESPACE"," ",629],["T_STRING","getAppliedRates",629],"(",["T_VARIABLE","$request",629],")",["T_WHITESPACE","\n    ",629],"{",["T_WHITESPACE","\n        ",630],["T_IF","if",631],["T_WHITESPACE"," ",631],"(","!",["T_VARIABLE","$request",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getCountryId",631],"(",")",["T_WHITESPACE"," ",631],["T_BOOLEAN_OR","||",631],["T_WHITESPACE"," ",631],"!",["T_VARIABLE","$request",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getCustomerClassId",631],"(",")",["T_WHITESPACE"," ",631],["T_BOOLEAN_OR","||",631],["T_WHITESPACE"," ",631],"!",["T_VARIABLE","$request",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getProductClassId",631],"(",")",")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n            ",631],["T_RETURN","return",632],["T_WHITESPACE"," ",632],"[","]",";",["T_WHITESPACE","\n        ",632],"}",["T_WHITESPACE","\n\n        ",633],["T_VARIABLE","$cacheKey",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","_getRequestCacheKey",635],"(",["T_VARIABLE","$request",635],")",";",["T_WHITESPACE","\n        ",635],["T_IF","if",636],["T_WHITESPACE"," ",636],"(","!",["T_ISSET","isset",636],"(",["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","_rateCalculationProcess",636],"[",["T_VARIABLE","$cacheKey",636],"]",")",")",["T_WHITESPACE"," ",636],"{",["T_WHITESPACE","\n            ",636],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_rateCalculationProcess",637],"[",["T_VARIABLE","$cacheKey",637],"]",["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_getResource",637],"(",")",["T_OBJECT_OPERATOR","->",637],["T_STRING","getCalculationProcess",637],"(",["T_VARIABLE","$request",637],")",";",["T_WHITESPACE","\n        ",637],"}",["T_WHITESPACE","\n        ",638],["T_RETURN","return",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_rateCalculationProcess",639],"[",["T_VARIABLE","$cacheKey",639],"]",";",["T_WHITESPACE","\n    ",639],"}",["T_WHITESPACE","\n\n    ",640],["T_DOC_COMMENT","\/**\n     * Gets the calculation process\n     *\n     * @param array $rates\n     * @return array\n     *\/",642],["T_WHITESPACE","\n    ",647],["T_PUBLIC","public",648],["T_WHITESPACE"," ",648],["T_FUNCTION","function",648],["T_WHITESPACE"," ",648],["T_STRING","reproduceProcess",648],"(",["T_VARIABLE","$rates",648],")",["T_WHITESPACE","\n    ",648],"{",["T_WHITESPACE","\n        ",649],["T_RETURN","return",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getResource",650],"(",")",["T_OBJECT_OPERATOR","->",650],["T_STRING","getCalculationProcess",650],"(",["T_STRING","null",650],",",["T_WHITESPACE"," ",650],["T_VARIABLE","$rates",650],")",";",["T_WHITESPACE","\n    ",650],"}",["T_WHITESPACE","\n\n    ",651],["T_DOC_COMMENT","\/**\n     * Calculate rated tax amount based on price and tax rate.\n     * If you are using price including tax $priceIncludeTax should be true.\n     *\n     * @param   float $price\n     * @param   float $taxRate\n     * @param   boolean $priceIncludeTax\n     * @param   boolean $round\n     * @return  float\n     *\/",653],["T_WHITESPACE","\n    ",662],["T_PUBLIC","public",663],["T_WHITESPACE"," ",663],["T_FUNCTION","function",663],["T_WHITESPACE"," ",663],["T_STRING","calcTaxAmount",663],"(",["T_VARIABLE","$price",663],",",["T_WHITESPACE"," ",663],["T_VARIABLE","$taxRate",663],",",["T_WHITESPACE"," ",663],["T_VARIABLE","$priceIncludeTax",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_STRING","false",663],",",["T_WHITESPACE"," ",663],["T_VARIABLE","$round",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_STRING","true",663],")",["T_WHITESPACE","\n    ",663],"{",["T_WHITESPACE","\n        ",664],["T_VARIABLE","$taxRate",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$taxRate",665],["T_WHITESPACE"," ",665],"\/",["T_WHITESPACE"," ",665],["T_LNUMBER","100",665],";",["T_WHITESPACE","\n\n        ",665],["T_IF","if",667],["T_WHITESPACE"," ",667],"(",["T_VARIABLE","$priceIncludeTax",667],")",["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n            ",667],["T_VARIABLE","$amount",668],["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_VARIABLE","$price",668],["T_WHITESPACE"," ",668],"*",["T_WHITESPACE"," ",668],"(",["T_LNUMBER","1",668],["T_WHITESPACE"," ",668],"-",["T_WHITESPACE"," ",668],["T_LNUMBER","1",668],["T_WHITESPACE"," ",668],"\/",["T_WHITESPACE"," ",668],"(",["T_LNUMBER","1",668],["T_WHITESPACE"," ",668],"+",["T_WHITESPACE"," ",668],["T_VARIABLE","$taxRate",668],")",")",";",["T_WHITESPACE","\n        ",668],"}",["T_WHITESPACE"," ",669],["T_ELSE","else",669],["T_WHITESPACE"," ",669],"{",["T_WHITESPACE","\n            ",669],["T_VARIABLE","$amount",670],["T_WHITESPACE"," ",670],"=",["T_WHITESPACE"," ",670],["T_VARIABLE","$price",670],["T_WHITESPACE"," ",670],"*",["T_WHITESPACE"," ",670],["T_VARIABLE","$taxRate",670],";",["T_WHITESPACE","\n        ",670],"}",["T_WHITESPACE","\n\n        ",671],["T_IF","if",673],["T_WHITESPACE"," ",673],"(",["T_VARIABLE","$round",673],")",["T_WHITESPACE"," ",673],"{",["T_WHITESPACE","\n            ",673],["T_RETURN","return",674],["T_WHITESPACE"," ",674],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","round",674],"(",["T_VARIABLE","$amount",674],")",";",["T_WHITESPACE","\n        ",674],"}",["T_WHITESPACE","\n\n        ",675],["T_RETURN","return",677],["T_WHITESPACE"," ",677],["T_VARIABLE","$amount",677],";",["T_WHITESPACE","\n    ",677],"}",["T_WHITESPACE","\n\n    ",678],["T_DOC_COMMENT","\/**\n     * Round tax amount\n     *\n     * @param   float $price\n     * @return  float\n     *\/",680],["T_WHITESPACE","\n    ",685],["T_PUBLIC","public",686],["T_WHITESPACE"," ",686],["T_FUNCTION","function",686],["T_WHITESPACE"," ",686],["T_STRING","round",686],"(",["T_VARIABLE","$price",686],")",["T_WHITESPACE","\n    ",686],"{",["T_WHITESPACE","\n        ",687],["T_RETURN","return",688],["T_WHITESPACE"," ",688],["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","priceCurrency",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","round",688],"(",["T_VARIABLE","$price",688],")",";",["T_WHITESPACE","\n    ",688],"}",["T_WHITESPACE","\n\n    ",689],["T_DOC_COMMENT","\/**\n     * @param array $billingAddress\n     * @param array $shippingAddress\n     * @param int $customerTaxClassId\n     * @return array\n     *\/",691],["T_WHITESPACE","\n    ",696],["T_PUBLIC","public",697],["T_WHITESPACE"," ",697],["T_FUNCTION","function",697],["T_WHITESPACE"," ",697],["T_STRING","getTaxRates",697],"(",["T_VARIABLE","$billingAddress",697],",",["T_WHITESPACE"," ",697],["T_VARIABLE","$shippingAddress",697],",",["T_WHITESPACE"," ",697],["T_VARIABLE","$customerTaxClassId",697],")",["T_WHITESPACE","\n    ",697],"{",["T_WHITESPACE","\n        ",698],["T_VARIABLE","$billingAddressObj",699],["T_WHITESPACE"," ",699],"=",["T_WHITESPACE"," ",699],["T_STRING","null",699],";",["T_WHITESPACE","\n        ",699],["T_VARIABLE","$shippingAddressObj",700],["T_WHITESPACE"," ",700],"=",["T_WHITESPACE"," ",700],["T_STRING","null",700],";",["T_WHITESPACE","\n        ",700],["T_IF","if",701],["T_WHITESPACE"," ",701],"(","!",["T_EMPTY","empty",701],"(",["T_VARIABLE","$billingAddress",701],")",")",["T_WHITESPACE"," ",701],"{",["T_WHITESPACE","\n            ",701],["T_VARIABLE","$billingAddressObj",702],["T_WHITESPACE"," ",702],"=",["T_WHITESPACE"," ",702],["T_NEW","new",702],["T_WHITESPACE"," ",702],["T_NS_SEPARATOR","\\",702],["T_STRING","Magento",702],["T_NS_SEPARATOR","\\",702],["T_STRING","Framework",702],["T_NS_SEPARATOR","\\",702],["T_STRING","DataObject",702],"(",["T_VARIABLE","$billingAddress",702],")",";",["T_WHITESPACE","\n        ",702],"}",["T_WHITESPACE","\n        ",703],["T_IF","if",704],["T_WHITESPACE"," ",704],"(","!",["T_EMPTY","empty",704],"(",["T_VARIABLE","$shippingAddress",704],")",")",["T_WHITESPACE"," ",704],"{",["T_WHITESPACE","\n            ",704],["T_VARIABLE","$shippingAddressObj",705],["T_WHITESPACE"," ",705],"=",["T_WHITESPACE"," ",705],["T_NEW","new",705],["T_WHITESPACE"," ",705],["T_NS_SEPARATOR","\\",705],["T_STRING","Magento",705],["T_NS_SEPARATOR","\\",705],["T_STRING","Framework",705],["T_NS_SEPARATOR","\\",705],["T_STRING","DataObject",705],"(",["T_VARIABLE","$shippingAddress",705],")",";",["T_WHITESPACE","\n        ",705],"}",["T_WHITESPACE","\n        ",706],["T_VARIABLE","$rateRequest",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_VARIABLE","$this",707],["T_OBJECT_OPERATOR","->",707],["T_STRING","getRateRequest",707],"(",["T_VARIABLE","$shippingAddressObj",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$billingAddressObj",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$customerTaxClassId",707],")",";",["T_WHITESPACE","\n\n        ",707],["T_VARIABLE","$searchCriteria",709],["T_WHITESPACE"," ",709],"=",["T_WHITESPACE"," ",709],["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","searchCriteriaBuilder",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","addFilters",709],"(",["T_WHITESPACE","\n            ",709],"[",["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","filterBuilder",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","setField",710],"(",["T_STRING","ClassModel",710],["T_DOUBLE_COLON","::",710],["T_STRING","KEY_TYPE",710],")",["T_WHITESPACE","\n                 ",710],["T_OBJECT_OPERATOR","->",711],["T_STRING","setValue",711],"(",["T_NS_SEPARATOR","\\",711],["T_STRING","Magento",711],["T_NS_SEPARATOR","\\",711],["T_STRING","Tax",711],["T_NS_SEPARATOR","\\",711],["T_STRING","Api",711],["T_NS_SEPARATOR","\\",711],["T_STRING","TaxClassManagementInterface",711],["T_DOUBLE_COLON","::",711],["T_STRING","TYPE_PRODUCT",711],")",["T_WHITESPACE","\n                 ",711],["T_OBJECT_OPERATOR","->",712],["T_STRING","create",712],"(",")","]",["T_WHITESPACE","\n        ",712],")",["T_OBJECT_OPERATOR","->",713],["T_STRING","create",713],"(",")",";",["T_WHITESPACE","\n        ",713],["T_VARIABLE","$ids",714],["T_WHITESPACE"," ",714],"=",["T_WHITESPACE"," ",714],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","taxClassRepository",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","getList",714],"(",["T_VARIABLE","$searchCriteria",714],")",["T_OBJECT_OPERATOR","->",714],["T_STRING","getItems",714],"(",")",";",["T_WHITESPACE","\n\n        ",714],["T_VARIABLE","$productRates",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],"[","]",";",["T_WHITESPACE","\n        ",716],["T_VARIABLE","$idKeys",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_STRING","array_keys",717],"(",["T_VARIABLE","$ids",717],")",";",["T_WHITESPACE","\n        ",717],["T_FOREACH","foreach",718],["T_WHITESPACE"," ",718],"(",["T_VARIABLE","$idKeys",718],["T_WHITESPACE"," ",718],["T_AS","as",718],["T_WHITESPACE"," ",718],["T_VARIABLE","$idKey",718],")",["T_WHITESPACE"," ",718],"{",["T_WHITESPACE","\n            ",718],["T_VARIABLE","$rateRequest",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","setProductClassId",719],"(",["T_VARIABLE","$idKey",719],")",";",["T_WHITESPACE","\n            ",719],["T_VARIABLE","$rate",720],["T_WHITESPACE"," ",720],"=",["T_WHITESPACE"," ",720],["T_VARIABLE","$this",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","getRate",720],"(",["T_VARIABLE","$rateRequest",720],")",";",["T_WHITESPACE","\n            ",720],["T_VARIABLE","$productRates",721],"[",["T_VARIABLE","$idKey",721],"]",["T_WHITESPACE"," ",721],"=",["T_WHITESPACE"," ",721],["T_VARIABLE","$rate",721],";",["T_WHITESPACE","\n        ",721],"}",["T_WHITESPACE","\n        ",722],["T_RETURN","return",723],["T_WHITESPACE"," ",723],["T_VARIABLE","$productRates",723],";",["T_WHITESPACE","\n    ",723],"}",["T_WHITESPACE","\n",724],"}",["T_WHITESPACE","\n",725]]