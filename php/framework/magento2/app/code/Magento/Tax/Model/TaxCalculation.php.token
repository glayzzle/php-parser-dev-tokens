[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Tax",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Tax",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","TaxCalculationInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Tax",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","TaxClassManagementInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Tax",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","TaxDetailsItemInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Tax",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Data",12],["T_NS_SEPARATOR","\\",12],["T_STRING","QuoteDetailsItemInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Tax",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Data",13],["T_NS_SEPARATOR","\\",13],["T_STRING","TaxDetailsInterfaceFactory",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Tax",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Api",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Data",14],["T_NS_SEPARATOR","\\",14],["T_STRING","TaxDetailsItemInterfaceFactory",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Tax",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Calculation",15],["T_NS_SEPARATOR","\\",15],["T_STRING","AbstractCalculator",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Tax",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Calculation",16],["T_NS_SEPARATOR","\\",16],["T_STRING","CalculatorFactory",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Magento",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Tax",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Model",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Config",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Magento",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Tax",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Model",18],["T_NS_SEPARATOR","\\",18],["T_STRING","TaxDetails",18],["T_NS_SEPARATOR","\\",18],["T_STRING","AppliedTax",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Magento",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Tax",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Model",19],["T_NS_SEPARATOR","\\",19],["T_STRING","TaxDetails",19],["T_NS_SEPARATOR","\\",19],["T_STRING","AppliedTaxRate",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Magento",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Tax",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Model",20],["T_NS_SEPARATOR","\\",20],["T_STRING","TaxDetails",20],["T_NS_SEPARATOR","\\",20],["T_STRING","TaxDetails",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Magento",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Store",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Model",21],["T_NS_SEPARATOR","\\",21],["T_STRING","StoreManagerInterface",21],";",["T_WHITESPACE","\n\n",21],["T_DOC_COMMENT","\/**\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",23],["T_WHITESPACE","\n",25],["T_CLASS","class",26],["T_WHITESPACE"," ",26],["T_STRING","TaxCalculation",26],["T_WHITESPACE"," ",26],["T_IMPLEMENTS","implements",26],["T_WHITESPACE"," ",26],["T_STRING","TaxCalculationInterface",26],["T_WHITESPACE","\n",26],"{",["T_WHITESPACE","\n    ",27],["T_DOC_COMMENT","\/**\n     * Tax Details factory\n     *\n     * @var TaxDetailsInterfaceFactory\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$taxDetailsDataObjectFactory",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var Config\n     *\/",35],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$config",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Tax calculation model\n     *\n     * @var Calculation\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$calculationTool",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Array to hold discount compensations for items\n     *\n     * @var array\n     *\/",49],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$discountTaxCompensations",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Tax details item factory\n     *\n     * @var TaxDetailsItemInterfaceFactory\n     *\/",56],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$taxDetailsItemDataObjectFactory",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",63],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$storeManager",66],";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Item code to Item object array.\n     *\n     * @var QuoteDetailsItemInterface[]\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PRIVATE","private",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$keyedItems",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Parent item code to children item array.\n     *\n     * @var QuoteDetailsItemInterface[][]\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PRIVATE","private",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$parentToChildren",80],";",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Tax Class Management\n     *\n     * @var TaxClassManagementInterface\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$taxClassManagement",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Calculator Factory\n     *\n     * @var CalculatorFactory\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$calculatorFactory",94],";",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Api\\DataObjectHelper\n     *\/",96],["T_WHITESPACE","\n    ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$dataObjectHelper",99],";",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * @param Calculation $calculation\n     * @param CalculatorFactory $calculatorFactory\n     * @param Config $config\n     * @param TaxDetailsInterfaceFactory $taxDetailsDataObjectFactory\n     * @param TaxDetailsItemInterfaceFactory $taxDetailsItemDataObjectFactory\n     * @param StoreManagerInterface $storeManager\n     * @param TaxClassManagementInterface $taxClassManagement\n     * @param \\Magento\\Framework\\Api\\DataObjectHelper $dataObjectHelper\n     *\/",101],["T_WHITESPACE","\n    ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","__construct",111],"(",["T_WHITESPACE","\n        ",111],["T_STRING","Calculation",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$calculation",112],",",["T_WHITESPACE","\n        ",112],["T_STRING","CalculatorFactory",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$calculatorFactory",113],",",["T_WHITESPACE","\n        ",113],["T_STRING","Config",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$config",114],",",["T_WHITESPACE","\n        ",114],["T_STRING","TaxDetailsInterfaceFactory",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$taxDetailsDataObjectFactory",115],",",["T_WHITESPACE","\n        ",115],["T_STRING","TaxDetailsItemInterfaceFactory",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$taxDetailsItemDataObjectFactory",116],",",["T_WHITESPACE","\n        ",116],["T_STRING","StoreManagerInterface",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$storeManager",117],",",["T_WHITESPACE","\n        ",117],["T_STRING","TaxClassManagementInterface",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$taxClassManagement",118],",",["T_WHITESPACE","\n        ",118],["T_NS_SEPARATOR","\\",119],["T_STRING","Magento",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Framework",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Api",119],["T_NS_SEPARATOR","\\",119],["T_STRING","DataObjectHelper",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$dataObjectHelper",119],["T_WHITESPACE","\n    ",119],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","calculationTool",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$calculation",121],";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","calculatorFactory",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$calculatorFactory",122],";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","config",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$config",123],";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","taxDetailsDataObjectFactory",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$taxDetailsDataObjectFactory",124],";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","taxDetailsItemDataObjectFactory",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$taxDetailsItemDataObjectFactory",125],";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","storeManager",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$storeManager",126],";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","taxClassManagement",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$taxClassManagement",127],";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","dataObjectHelper",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$dataObjectHelper",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",131],["T_WHITESPACE","\n    ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","calculateTax",134],"(",["T_WHITESPACE","\n        ",134],["T_NS_SEPARATOR","\\",135],["T_STRING","Magento",135],["T_NS_SEPARATOR","\\",135],["T_STRING","Tax",135],["T_NS_SEPARATOR","\\",135],["T_STRING","Api",135],["T_NS_SEPARATOR","\\",135],["T_STRING","Data",135],["T_NS_SEPARATOR","\\",135],["T_STRING","QuoteDetailsInterface",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$quoteDetails",135],",",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$storeId",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","null",136],",",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$round",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","true",137],["T_WHITESPACE","\n    ",137],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n        ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$storeId",139],["T_WHITESPACE"," ",139],["T_IS_IDENTICAL","===",139],["T_WHITESPACE"," ",139],["T_STRING","null",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$storeId",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","storeManager",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getStore",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","getStoreId",140],"(",")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_COMMENT","\/\/ initial TaxDetails data\n",143],["T_WHITESPACE","        ",144],["T_VARIABLE","$taxDetailsData",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],"[",["T_WHITESPACE","\n            ",144],["T_STRING","TaxDetails",145],["T_DOUBLE_COLON","::",145],["T_STRING","KEY_SUBTOTAL",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_DNUMBER","0.0",145],",",["T_WHITESPACE","\n            ",145],["T_STRING","TaxDetails",146],["T_DOUBLE_COLON","::",146],["T_STRING","KEY_TAX_AMOUNT",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_DNUMBER","0.0",146],",",["T_WHITESPACE","\n            ",146],["T_STRING","TaxDetails",147],["T_DOUBLE_COLON","::",147],["T_STRING","KEY_DISCOUNT_TAX_COMPENSATION_AMOUNT",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_DNUMBER","0.0",147],",",["T_WHITESPACE","\n            ",147],["T_STRING","TaxDetails",148],["T_DOUBLE_COLON","::",148],["T_STRING","KEY_APPLIED_TAXES",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],"[","]",",",["T_WHITESPACE","\n            ",148],["T_STRING","TaxDetails",149],["T_DOUBLE_COLON","::",149],["T_STRING","KEY_ITEMS",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],"[","]",",",["T_WHITESPACE","\n        ",149],"]",";",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$items",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$quoteDetails",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getItems",151],"(",")",";",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(",["T_EMPTY","empty",152],"(",["T_VARIABLE","$items",152],")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","taxDetailsDataObjectFactory",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","create",153],"(",")",["T_WHITESPACE","\n                ",153],["T_OBJECT_OPERATOR","->",154],["T_STRING","setSubtotal",154],"(",["T_DNUMBER","0.0",154],")",["T_WHITESPACE","\n                ",154],["T_OBJECT_OPERATOR","->",155],["T_STRING","setTaxAmount",155],"(",["T_DNUMBER","0.0",155],")",["T_WHITESPACE","\n                ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","setDiscountTaxCompensationAmount",156],"(",["T_DNUMBER","0.0",156],")",["T_WHITESPACE","\n                ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","setAppliedTaxes",157],"(","[","]",")",["T_WHITESPACE","\n                ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","setItems",158],"(","[","]",")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","computeRelationships",160],"(",["T_VARIABLE","$items",160],")",";",["T_WHITESPACE","\n\n        ",160],["T_VARIABLE","$calculator",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","calculatorFactory",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","create",162],"(",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","config",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getAlgorithm",163],"(",["T_VARIABLE","$storeId",163],")",",",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$storeId",164],",",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$quoteDetails",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getBillingAddress",165],"(",")",",",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$quoteDetails",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getShippingAddress",166],"(",")",",",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","taxClassManagement",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getTaxClassId",167],"(",["T_VARIABLE","$quoteDetails",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getCustomerTaxClassKey",167],"(",")",",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'customer'",167],")",",",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$quoteDetails",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getCustomerId",168],"(",")",["T_WHITESPACE","\n        ",168],")",";",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$processedItems",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],"[","]",";",["T_WHITESPACE","\n        ",171],["T_DOC_COMMENT","\/** @var QuoteDetailsItemInterface $item *\/",172],["T_WHITESPACE","\n        ",172],["T_FOREACH","foreach",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","keyedItems",173],["T_WHITESPACE"," ",173],["T_AS","as",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$item",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_ISSET","isset",174],"(",["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","parentToChildren",174],"[",["T_VARIABLE","$item",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getCode",174],"(",")","]",")",")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$processedChildren",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],"[","]",";",["T_WHITESPACE","\n                ",175],["T_FOREACH","foreach",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","parentToChildren",176],"[",["T_VARIABLE","$item",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCode",176],"(",")","]",["T_WHITESPACE"," ",176],["T_AS","as",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$child",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                    ",176],["T_VARIABLE","$processedItem",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","processItem",177],"(",["T_VARIABLE","$child",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$calculator",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$round",177],")",";",["T_WHITESPACE","\n                    ",177],["T_VARIABLE","$taxDetailsData",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","aggregateItemData",178],"(",["T_VARIABLE","$taxDetailsData",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$processedItem",178],")",";",["T_WHITESPACE","\n                    ",178],["T_VARIABLE","$processedItems",179],"[",["T_VARIABLE","$processedItem",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getCode",179],"(",")","]",["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$processedItem",179],";",["T_WHITESPACE","\n                    ",179],["T_VARIABLE","$processedChildren",180],"[","]",["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$processedItem",180],";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$processedItem",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","calculateParent",182],"(",["T_VARIABLE","$processedChildren",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$item",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getQuantity",182],"(",")",")",";",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$processedItem",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","setCode",183],"(",["T_VARIABLE","$item",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getCode",183],"(",")",")",";",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$processedItem",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","setType",184],"(",["T_VARIABLE","$item",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getType",184],"(",")",")",";",["T_WHITESPACE","\n            ",184],"}",["T_WHITESPACE"," ",185],["T_ELSE","else",185],["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                ",185],["T_VARIABLE","$processedItem",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","processItem",186],"(",["T_VARIABLE","$item",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$calculator",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$round",186],")",";",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$taxDetailsData",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","aggregateItemData",187],"(",["T_VARIABLE","$taxDetailsData",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$processedItem",187],")",";",["T_WHITESPACE","\n            ",187],"}",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$processedItems",189],"[",["T_VARIABLE","$processedItem",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getCode",189],"(",")","]",["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$processedItem",189],";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_VARIABLE","$taxDetailsDataObject",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","taxDetailsDataObjectFactory",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","create",192],"(",")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","dataObjectHelper",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","populateWithArray",193],"(",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$taxDetailsDataObject",194],",",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$taxDetailsData",195],",",["T_WHITESPACE","\n            ",195],["T_NS_SEPARATOR","\\",196],["T_STRING","Magento",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Tax",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Api",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Data",196],["T_NS_SEPARATOR","\\",196],["T_STRING","TaxDetailsInterface",196],["T_DOUBLE_COLON","::",196],["T_CLASS","class",196],["T_WHITESPACE","\n        ",196],")",";",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$taxDetailsDataObject",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","setItems",198],"(",["T_VARIABLE","$processedItems",198],")",";",["T_WHITESPACE","\n        ",198],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$taxDetailsDataObject",199],";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",202],["T_WHITESPACE","\n    ",204],["T_PUBLIC","public",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","getDefaultCalculatedRate",205],"(",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$productTaxClassID",206],",",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$customerId",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_STRING","null",207],",",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$storeId",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","null",208],["T_WHITESPACE","\n    ",208],")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n        ",209],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getRate",210],"(",["T_VARIABLE","$productTaxClassID",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$customerId",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$storeId",210],",",["T_WHITESPACE"," ",210],["T_STRING","true",210],")",";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",213],["T_WHITESPACE","\n    ",215],["T_PUBLIC","public",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","getCalculatedRate",216],"(",["T_WHITESPACE","\n        ",216],["T_VARIABLE","$productTaxClassID",217],",",["T_WHITESPACE","\n        ",217],["T_VARIABLE","$customerId",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","null",218],",",["T_WHITESPACE","\n        ",218],["T_VARIABLE","$storeId",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_STRING","null",219],["T_WHITESPACE","\n    ",219],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n        ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getRate",221],"(",["T_VARIABLE","$productTaxClassID",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$customerId",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$storeId",221],")",";",["T_WHITESPACE","\n    ",221],"}",["T_WHITESPACE","\n\n    ",222],["T_DOC_COMMENT","\/**\n     * Calculate rate based on default parameter\n     *\n     * @param int $productTaxClassID\n     * @param int|null $customerId\n     * @param string|null $storeId\n     * @param bool $isDefault\n     * @return float\n     *\/",224],["T_WHITESPACE","\n    ",232],["T_PROTECTED","protected",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","getRate",233],"(",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$productTaxClassID",234],",",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$customerId",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_STRING","null",235],",",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$storeId",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_STRING","null",236],",",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$isDefault",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_STRING","false",237],["T_WHITESPACE","\n    ",237],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_VARIABLE","$storeId",239],["T_WHITESPACE"," ",239],["T_IS_IDENTICAL","===",239],["T_WHITESPACE"," ",239],["T_STRING","null",239],")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$storeId",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","storeManager",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getStore",240],"(",")",["T_OBJECT_OPERATOR","->",240],["T_STRING","getStoreId",240],"(",")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n        ",241],["T_IF","if",242],["T_WHITESPACE"," ",242],"(","!",["T_VARIABLE","$isDefault",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$addressRequestObject",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","calculationTool",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getRateRequest",243],"(",["T_STRING","null",243],",",["T_WHITESPACE"," ",243],["T_STRING","null",243],",",["T_WHITESPACE"," ",243],["T_STRING","null",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$storeId",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$customerId",243],")",";",["T_WHITESPACE","\n        ",243],"}",["T_WHITESPACE"," ",244],["T_ELSE","else",244],["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$addressRequestObject",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","calculationTool",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getDefaultRateRequest",245],"(",["T_VARIABLE","$storeId",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$customerId",245],")",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$addressRequestObject",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setProductClassId",247],"(",["T_VARIABLE","$productTaxClassID",247],")",";",["T_WHITESPACE","\n        ",247],["T_RETURN","return",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","calculationTool",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getRate",248],"(",["T_VARIABLE","$addressRequestObject",248],")",";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Computes relationships between items, primarily the child to parent relationship.\n     *\n     * @param QuoteDetailsItemInterface[] $items\n     * @return void\n     *\/",251],["T_WHITESPACE","\n    ",256],["T_PRIVATE","private",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","computeRelationships",257],"(",["T_VARIABLE","$items",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","keyedItems",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],"[","]",";",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","parentToChildren",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],"[","]",";",["T_WHITESPACE","\n        ",260],["T_FOREACH","foreach",261],["T_WHITESPACE"," ",261],"(",["T_VARIABLE","$items",261],["T_WHITESPACE"," ",261],["T_AS","as",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$item",261],")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_VARIABLE","$item",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getParentCode",262],"(",")",["T_WHITESPACE"," ",262],["T_IS_IDENTICAL","===",262],["T_WHITESPACE"," ",262],["T_STRING","null",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n                ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","keyedItems",263],"[",["T_VARIABLE","$item",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getCode",263],"(",")","]",["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$item",263],";",["T_WHITESPACE","\n            ",263],"}",["T_WHITESPACE"," ",264],["T_ELSE","else",264],["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","parentToChildren",265],"[",["T_VARIABLE","$item",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getParentCode",265],"(",")","]","[","]",["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$item",265],";",["T_WHITESPACE","\n            ",265],"}",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n    ",267],"}",["T_WHITESPACE","\n\n    ",268],["T_DOC_COMMENT","\/**\n     * Calculate item tax with customized rounding level\n     *\n     * @param QuoteDetailsItemInterface $item\n     * @param AbstractCalculator $calculator\n     * @param bool $round\n     * @return TaxDetailsItemInterface\n     *\/",270],["T_WHITESPACE","\n    ",277],["T_PROTECTED","protected",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","processItem",278],"(",["T_WHITESPACE","\n        ",278],["T_STRING","QuoteDetailsItemInterface",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$item",279],",",["T_WHITESPACE","\n        ",279],["T_STRING","AbstractCalculator",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$calculator",280],",",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$round",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","true",281],["T_WHITESPACE","\n    ",281],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$quantity",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getTotalQuantity",283],"(",["T_VARIABLE","$item",283],")",";",["T_WHITESPACE","\n        ",283],["T_RETURN","return",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$calculator",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","calculate",284],"(",["T_VARIABLE","$item",284],",",["T_WHITESPACE"," ",284],["T_VARIABLE","$quantity",284],",",["T_WHITESPACE"," ",284],["T_VARIABLE","$round",284],")",";",["T_WHITESPACE","\n    ",284],"}",["T_WHITESPACE","\n\n    ",285],["T_DOC_COMMENT","\/**\n     * Calculate row information for item based on children calculation\n     *\n     * @param TaxDetailsItemInterface[] $children\n     * @param int $quantity\n     * @return TaxDetailsItemInterface\n     *\/",287],["T_WHITESPACE","\n    ",293],["T_PROTECTED","protected",294],["T_WHITESPACE"," ",294],["T_FUNCTION","function",294],["T_WHITESPACE"," ",294],["T_STRING","calculateParent",294],"(",["T_VARIABLE","$children",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$quantity",294],")",["T_WHITESPACE","\n    ",294],"{",["T_WHITESPACE","\n        ",295],["T_VARIABLE","$rowTotal",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_DNUMBER","0.00",296],";",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$rowTotalInclTax",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_DNUMBER","0.00",297],";",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$rowTax",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_DNUMBER","0.00",298],";",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$taxableAmount",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_DNUMBER","0.00",299],";",["T_WHITESPACE","\n\n        ",299],["T_FOREACH","foreach",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$children",301],["T_WHITESPACE"," ",301],["T_AS","as",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$child",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$rowTotal",302],["T_WHITESPACE"," ",302],["T_PLUS_EQUAL","+=",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$child",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getRowTotal",302],"(",")",";",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$rowTotalInclTax",303],["T_WHITESPACE"," ",303],["T_PLUS_EQUAL","+=",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$child",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getRowTotalInclTax",303],"(",")",";",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$rowTax",304],["T_WHITESPACE"," ",304],["T_PLUS_EQUAL","+=",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$child",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getRowTax",304],"(",")",";",["T_WHITESPACE","\n            ",304],["T_VARIABLE","$taxableAmount",305],["T_WHITESPACE"," ",305],["T_PLUS_EQUAL","+=",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$child",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getTaxableAmount",305],"(",")",";",["T_WHITESPACE","\n        ",305],"}",["T_WHITESPACE","\n\n        ",306],["T_VARIABLE","$price",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","calculationTool",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","round",308],"(",["T_VARIABLE","$rowTotal",308],["T_WHITESPACE"," ",308],"\/",["T_WHITESPACE"," ",308],["T_VARIABLE","$quantity",308],")",";",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$priceInclTax",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","calculationTool",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","round",309],"(",["T_VARIABLE","$rowTotalInclTax",309],["T_WHITESPACE"," ",309],"\/",["T_WHITESPACE"," ",309],["T_VARIABLE","$quantity",309],")",";",["T_WHITESPACE","\n\n        ",309],["T_VARIABLE","$taxDetailsItemDataObject",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","taxDetailsItemDataObjectFactory",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","create",311],"(",")",["T_WHITESPACE","\n            ",311],["T_OBJECT_OPERATOR","->",312],["T_STRING","setPrice",312],"(",["T_VARIABLE","$price",312],")",["T_WHITESPACE","\n            ",312],["T_OBJECT_OPERATOR","->",313],["T_STRING","setPriceInclTax",313],"(",["T_VARIABLE","$priceInclTax",313],")",["T_WHITESPACE","\n            ",313],["T_OBJECT_OPERATOR","->",314],["T_STRING","setRowTotal",314],"(",["T_VARIABLE","$rowTotal",314],")",["T_WHITESPACE","\n            ",314],["T_OBJECT_OPERATOR","->",315],["T_STRING","setRowTotalInclTax",315],"(",["T_VARIABLE","$rowTotalInclTax",315],")",["T_WHITESPACE","\n            ",315],["T_OBJECT_OPERATOR","->",316],["T_STRING","setRowTax",316],"(",["T_VARIABLE","$rowTax",316],")",";",["T_WHITESPACE","\n\n        ",316],["T_RETURN","return",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$taxDetailsItemDataObject",318],";",["T_WHITESPACE","\n    ",318],"}",["T_WHITESPACE","\n\n    ",319],["T_DOC_COMMENT","\/**\n     * Add row total item amount to subtotal\n     *\n     * @param array $taxDetailsData\n     * @param TaxDetailsItemInterface $item\n     * @return array\n     *\/",321],["T_WHITESPACE","\n    ",327],["T_PROTECTED","protected",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","aggregateItemData",328],"(",["T_VARIABLE","$taxDetailsData",328],",",["T_WHITESPACE"," ",328],["T_STRING","TaxDetailsItemInterface",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$item",328],")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$taxDetailsData",330],"[",["T_STRING","TaxDetails",330],["T_DOUBLE_COLON","::",330],["T_STRING","KEY_SUBTOTAL",330],"]",["T_WHITESPACE","\n            ",330],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$taxDetailsData",331],"[",["T_STRING","TaxDetails",331],["T_DOUBLE_COLON","::",331],["T_STRING","KEY_SUBTOTAL",331],"]",["T_WHITESPACE"," ",331],"+",["T_WHITESPACE"," ",331],["T_VARIABLE","$item",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getRowTotal",331],"(",")",";",["T_WHITESPACE","\n\n        ",331],["T_VARIABLE","$taxDetailsData",333],"[",["T_STRING","TaxDetails",333],["T_DOUBLE_COLON","::",333],["T_STRING","KEY_TAX_AMOUNT",333],"]",["T_WHITESPACE","\n            ",333],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$taxDetailsData",334],"[",["T_STRING","TaxDetails",334],["T_DOUBLE_COLON","::",334],["T_STRING","KEY_TAX_AMOUNT",334],"]",["T_WHITESPACE"," ",334],"+",["T_WHITESPACE"," ",334],["T_VARIABLE","$item",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getRowTax",334],"(",")",";",["T_WHITESPACE","\n\n        ",334],["T_VARIABLE","$taxDetailsData",336],"[",["T_STRING","TaxDetails",336],["T_DOUBLE_COLON","::",336],["T_STRING","KEY_DISCOUNT_TAX_COMPENSATION_AMOUNT",336],"]",["T_WHITESPACE"," ",336],"=",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$taxDetailsData",337],"[",["T_STRING","TaxDetails",337],["T_DOUBLE_COLON","::",337],["T_STRING","KEY_DISCOUNT_TAX_COMPENSATION_AMOUNT",337],"]",["T_WHITESPACE","\n            ",337],"+",["T_WHITESPACE"," ",338],["T_VARIABLE","$item",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getDiscountTaxCompensationAmount",338],"(",")",";",["T_WHITESPACE","\n\n        ",338],["T_VARIABLE","$itemAppliedTaxes",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$item",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getAppliedTaxes",340],"(",")",";",["T_WHITESPACE","\n        ",340],["T_IF","if",341],["T_WHITESPACE"," ",341],"(",["T_VARIABLE","$itemAppliedTaxes",341],["T_WHITESPACE"," ",341],["T_IS_IDENTICAL","===",341],["T_WHITESPACE"," ",341],["T_STRING","null",341],")",["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n            ",341],["T_RETURN","return",342],["T_WHITESPACE"," ",342],["T_VARIABLE","$taxDetailsData",342],";",["T_WHITESPACE","\n        ",342],"}",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$appliedTaxes",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_VARIABLE","$taxDetailsData",344],"[",["T_STRING","TaxDetails",344],["T_DOUBLE_COLON","::",344],["T_STRING","KEY_APPLIED_TAXES",344],"]",";",["T_WHITESPACE","\n        ",344],["T_FOREACH","foreach",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$itemAppliedTaxes",345],["T_WHITESPACE"," ",345],["T_AS","as",345],["T_WHITESPACE"," ",345],["T_VARIABLE","$taxId",345],["T_WHITESPACE"," ",345],["T_DOUBLE_ARROW","=>",345],["T_WHITESPACE"," ",345],["T_VARIABLE","$itemAppliedTax",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n            ",345],["T_IF","if",346],["T_WHITESPACE"," ",346],"(","!",["T_ISSET","isset",346],"(",["T_VARIABLE","$appliedTaxes",346],"[",["T_VARIABLE","$taxId",346],"]",")",")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n                ",346],["T_COMMENT","\/\/convert rate data object to array\n",347],["T_WHITESPACE","                ",348],["T_VARIABLE","$rates",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],"[","]",";",["T_WHITESPACE","\n                ",348],["T_VARIABLE","$rateDataObjects",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$itemAppliedTax",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getRates",349],"(",")",";",["T_WHITESPACE","\n                ",349],["T_FOREACH","foreach",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$rateDataObjects",350],["T_WHITESPACE"," ",350],["T_AS","as",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$rateDataObject",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                    ",350],["T_VARIABLE","$rates",351],"[",["T_VARIABLE","$rateDataObject",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getCode",351],"(",")","]",["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],"[",["T_WHITESPACE","\n                        ",351],["T_STRING","AppliedTaxRate",352],["T_DOUBLE_COLON","::",352],["T_STRING","KEY_CODE",352],["T_WHITESPACE"," ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$rateDataObject",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getCode",352],"(",")",",",["T_WHITESPACE","\n                        ",352],["T_STRING","AppliedTaxRate",353],["T_DOUBLE_COLON","::",353],["T_STRING","KEY_TITLE",353],["T_WHITESPACE"," ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$rateDataObject",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getTitle",353],"(",")",",",["T_WHITESPACE","\n                        ",353],["T_STRING","AppliedTaxRate",354],["T_DOUBLE_COLON","::",354],["T_STRING","KEY_PERCENT",354],["T_WHITESPACE"," ",354],["T_DOUBLE_ARROW","=>",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$rateDataObject",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getPercent",354],"(",")",",",["T_WHITESPACE","\n                    ",354],"]",";",["T_WHITESPACE","\n                ",355],"}",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$appliedTaxes",357],"[",["T_VARIABLE","$taxId",357],"]",["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],"[",["T_WHITESPACE","\n                    ",357],["T_STRING","AppliedTax",358],["T_DOUBLE_COLON","::",358],["T_STRING","KEY_AMOUNT",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$itemAppliedTax",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getAmount",358],"(",")",",",["T_WHITESPACE","\n                    ",358],["T_STRING","AppliedTax",359],["T_DOUBLE_COLON","::",359],["T_STRING","KEY_PERCENT",359],["T_WHITESPACE"," ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$itemAppliedTax",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getPercent",359],"(",")",",",["T_WHITESPACE","\n                    ",359],["T_STRING","AppliedTax",360],["T_DOUBLE_COLON","::",360],["T_STRING","KEY_RATES",360],["T_WHITESPACE"," ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$rates",360],",",["T_WHITESPACE","\n                    ",360],["T_STRING","AppliedTax",361],["T_DOUBLE_COLON","::",361],["T_STRING","KEY_TAX_RATE_KEY",361],["T_WHITESPACE"," ",361],["T_DOUBLE_ARROW","=>",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$itemAppliedTax",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getTaxRateKey",361],"(",")",",",["T_WHITESPACE","\n                ",361],"]",";",["T_WHITESPACE","\n            ",362],"}",["T_WHITESPACE"," ",363],["T_ELSE","else",363],["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n                ",363],["T_VARIABLE","$appliedTaxes",364],"[",["T_VARIABLE","$taxId",364],"]","[",["T_STRING","AppliedTax",364],["T_DOUBLE_COLON","::",364],["T_STRING","KEY_AMOUNT",364],"]",["T_WHITESPACE"," ",364],["T_PLUS_EQUAL","+=",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$itemAppliedTax",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getAmount",364],"(",")",";",["T_WHITESPACE","\n            ",364],"}",["T_WHITESPACE","\n        ",365],"}",["T_WHITESPACE","\n\n        ",366],["T_VARIABLE","$taxDetailsData",368],"[",["T_STRING","TaxDetails",368],["T_DOUBLE_COLON","::",368],["T_STRING","KEY_APPLIED_TAXES",368],"]",["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$appliedTaxes",368],";",["T_WHITESPACE","\n        ",368],["T_RETURN","return",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$taxDetailsData",369],";",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Calculates the total quantity for this item.\n     *\n     * What this really means is that if this is a child item, it return the parent quantity times\n     * the child quantity and return that as the child's quantity.\n     *\n     * @param QuoteDetailsItemInterface $item\n     * @return float\n     *\/",372],["T_WHITESPACE","\n    ",380],["T_PROTECTED","protected",381],["T_WHITESPACE"," ",381],["T_FUNCTION","function",381],["T_WHITESPACE"," ",381],["T_STRING","getTotalQuantity",381],"(",["T_STRING","QuoteDetailsItemInterface",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$item",381],")",["T_WHITESPACE","\n    ",381],"{",["T_WHITESPACE","\n        ",382],["T_IF","if",383],["T_WHITESPACE"," ",383],"(",["T_VARIABLE","$item",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getParentCode",383],"(",")",")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n            ",383],["T_VARIABLE","$parentQuantity",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","keyedItems",384],"[",["T_VARIABLE","$item",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getParentCode",384],"(",")","]",["T_OBJECT_OPERATOR","->",384],["T_STRING","getQuantity",384],"(",")",";",["T_WHITESPACE","\n            ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$parentQuantity",385],["T_WHITESPACE"," ",385],"*",["T_WHITESPACE"," ",385],["T_VARIABLE","$item",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getQuantity",385],"(",")",";",["T_WHITESPACE","\n        ",385],"}",["T_WHITESPACE","\n        ",386],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$item",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getQuantity",387],"(",")",";",["T_WHITESPACE","\n    ",387],"}",["T_WHITESPACE","\n",388],"}",["T_WHITESPACE","\n",389]]