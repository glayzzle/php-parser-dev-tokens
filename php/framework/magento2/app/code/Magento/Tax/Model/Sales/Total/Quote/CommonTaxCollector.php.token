[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Tax",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Sales",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Total",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Quote",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Customer",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","AddressInterfaceFactory",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","CustomerAddressFactory",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Customer",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Data",12],["T_NS_SEPARATOR","\\",12],["T_STRING","AddressInterface",12],["T_WHITESPACE"," ",12],["T_AS","as",12],["T_WHITESPACE"," ",12],["T_STRING","CustomerAddress",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Customer",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Data",13],["T_NS_SEPARATOR","\\",13],["T_STRING","RegionInterfaceFactory",13],["T_WHITESPACE"," ",13],["T_AS","as",13],["T_WHITESPACE"," ",13],["T_STRING","CustomerAddressRegionFactory",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","DataObject",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Quote",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Quote",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Address",15],["T_WHITESPACE"," ",15],["T_AS","as",15],["T_WHITESPACE"," ",15],["T_STRING","QuoteAddress",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Quote",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Quote",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Address",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Total",16],["T_NS_SEPARATOR","\\",16],["T_STRING","AbstractTotal",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Magento",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Quote",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Model",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Quote",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Item",17],["T_NS_SEPARATOR","\\",17],["T_STRING","AbstractItem",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Magento",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Store",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Model",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Store",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Magento",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Tax",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Api",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Data",19],["T_NS_SEPARATOR","\\",19],["T_STRING","QuoteDetailsInterfaceFactory",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Magento",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Tax",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Api",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Data",20],["T_NS_SEPARATOR","\\",20],["T_STRING","TaxClassKeyInterfaceFactory",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Magento",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Tax",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Api",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Data",21],["T_NS_SEPARATOR","\\",21],["T_STRING","TaxClassKeyInterface",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Magento",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Tax",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Api",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Data",22],["T_NS_SEPARATOR","\\",22],["T_STRING","TaxDetailsInterface",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Magento",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Tax",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Api",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Data",23],["T_NS_SEPARATOR","\\",23],["T_STRING","TaxDetailsItemInterface",23],";",["T_WHITESPACE","\n",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","Magento",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Tax",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Api",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Data",24],["T_NS_SEPARATOR","\\",24],["T_STRING","QuoteDetailsInterface",24],";",["T_WHITESPACE","\n",24],["T_USE","use",25],["T_WHITESPACE"," ",25],["T_STRING","Magento",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Quote",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Api",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Data",25],["T_NS_SEPARATOR","\\",25],["T_STRING","ShippingAssignmentInterface",25],";",["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Tax totals calculation model\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",27],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","CommonTaxCollector",31],["T_WHITESPACE"," ",31],["T_EXTENDS","extends",31],["T_WHITESPACE"," ",31],["T_STRING","AbstractTotal",31],["T_WHITESPACE","\n",31],"{",["T_WHITESPACE","\n    ",32],["T_COMMENT","\/**#@+\n     * Constants defined for type of items\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","ITEM_TYPE_SHIPPING",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'shipping'",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","ITEM_TYPE_PRODUCT",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'product'",37],";",["T_WHITESPACE","\n    ",37],["T_COMMENT","\/**#@-*\/",38],["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Constant for shipping item code\n     *\/",40],["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","ITEM_CODE_SHIPPING",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'shipping'",43],";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/**#@+\n     * Constants for array keys\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","KEY_ITEM",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'item'",48],";",["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","KEY_BASE_ITEM",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'base_item'",49],";",["T_WHITESPACE","\n    ",49],["T_COMMENT","\/**#@-*\/",50],["T_WHITESPACE","\n\n    ",50],["T_COMMENT","\/**#@+\n     * Constants for fields in associated taxables array\n     *\/",52],["T_WHITESPACE","\n    ",54],["T_CONST","const",55],["T_WHITESPACE"," ",55],["T_STRING","KEY_ASSOCIATED_TAXABLE_TYPE",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'type'",55],";",["T_WHITESPACE","\n    ",55],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","KEY_ASSOCIATED_TAXABLE_CODE",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'code'",56],";",["T_WHITESPACE","\n    ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","KEY_ASSOCIATED_TAXABLE_UNIT_PRICE",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'unit_price'",57],";",["T_WHITESPACE","\n    ",57],["T_CONST","const",58],["T_WHITESPACE"," ",58],["T_STRING","KEY_ASSOCIATED_TAXABLE_BASE_UNIT_PRICE",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'base_unit_price'",58],";",["T_WHITESPACE","\n    ",58],["T_CONST","const",59],["T_WHITESPACE"," ",59],["T_STRING","KEY_ASSOCIATED_TAXABLE_QUANTITY",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'quantity'",59],";",["T_WHITESPACE","\n    ",59],["T_CONST","const",60],["T_WHITESPACE"," ",60],["T_STRING","KEY_ASSOCIATED_TAXABLE_TAX_CLASS_ID",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",60],";",["T_WHITESPACE","\n    ",60],["T_CONST","const",61],["T_WHITESPACE"," ",61],["T_STRING","KEY_ASSOCIATED_TAXABLE_PRICE_INCLUDES_TAX",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'price_includes_tax'",61],";",["T_WHITESPACE","\n    ",61],["T_CONST","const",62],["T_WHITESPACE"," ",62],["T_STRING","KEY_ASSOCIATED_TAXABLE_ASSOCIATION_ITEM_CODE",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'associated_item_code'",62],";",["T_WHITESPACE","\n    ",62],["T_COMMENT","\/**#@-*\/",63],["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * When an extra taxable item is associated with quote and not with an item, this value\n     * is used as associated item code\n     *\/",65],["T_WHITESPACE","\n    ",68],["T_CONST","const",69],["T_WHITESPACE"," ",69],["T_STRING","ASSOCIATION_ITEM_CODE_FOR_QUOTE",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'quote'",69],";",["T_WHITESPACE","\n\n    ",69],["T_COMMENT","\/**#@+\n     * Constants for fields in tax details for associated taxable items\n     *\/",71],["T_WHITESPACE","\n    ",73],["T_CONST","const",74],["T_WHITESPACE"," ",74],["T_STRING","KEY_TAX_DETAILS_TYPE",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'type'",74],";",["T_WHITESPACE","\n    ",74],["T_CONST","const",75],["T_WHITESPACE"," ",75],["T_STRING","KEY_TAX_DETAILS_CODE",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'code'",75],";",["T_WHITESPACE","\n    ",75],["T_CONST","const",76],["T_WHITESPACE"," ",76],["T_STRING","KEY_TAX_DETAILS_PRICE_EXCL_TAX",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'price_excl_tax'",76],";",["T_WHITESPACE","\n    ",76],["T_CONST","const",77],["T_WHITESPACE"," ",77],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_EXCL_TAX",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'base_price_excl_tax'",77],";",["T_WHITESPACE","\n    ",77],["T_CONST","const",78],["T_WHITESPACE"," ",78],["T_STRING","KEY_TAX_DETAILS_PRICE_INCL_TAX",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'price_incl_tax'",78],";",["T_WHITESPACE","\n    ",78],["T_CONST","const",79],["T_WHITESPACE"," ",79],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_INCL_TAX",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'base_price_incl_tax'",79],";",["T_WHITESPACE","\n    ",79],["T_CONST","const",80],["T_WHITESPACE"," ",80],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'row_total_excl_tax'",80],";",["T_WHITESPACE","\n    ",80],["T_CONST","const",81],["T_WHITESPACE"," ",81],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'base_row_total_excl_tax'",81],";",["T_WHITESPACE","\n    ",81],["T_CONST","const",82],["T_WHITESPACE"," ",82],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL_INCL_TAX",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'row_total_incl_tax'",82],";",["T_WHITESPACE","\n    ",82],["T_CONST","const",83],["T_WHITESPACE"," ",83],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL_INCL_TAX",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'base_row_total_incl_tax'",83],";",["T_WHITESPACE","\n    ",83],["T_CONST","const",84],["T_WHITESPACE"," ",84],["T_STRING","KEY_TAX_DETAILS_TAX_PERCENT",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'tax_percent'",84],";",["T_WHITESPACE","\n    ",84],["T_CONST","const",85],["T_WHITESPACE"," ",85],["T_STRING","KEY_TAX_DETAILS_ROW_TAX",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'row_tax'",85],";",["T_WHITESPACE","\n    ",85],["T_CONST","const",86],["T_WHITESPACE"," ",86],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TAX",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'base_row_tax'",86],";",["T_WHITESPACE","\n    ",86],["T_CONST","const",87],["T_WHITESPACE"," ",87],["T_STRING","KEY_TAX_DETAILS_APPLIED_TAXES",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'applied_taxes'",87],";",["T_WHITESPACE","\n    ",87],["T_COMMENT","\/**#@-*\/",88],["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var \\Magento\\Tax\\Model\\Config\n     *\/",90],["T_WHITESPACE","\n    ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$_config",95],";",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Counter that is used to construct temporary ids for taxable items\n     *\n     * @var int\n     *\/",97],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$counter",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_LNUMBER","0",102],";",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Tax calculation service, the collector will call the service which performs the actual calculation\n     *\n     * @var \\Magento\\Tax\\Api\\TaxCalculationInterface\n     *\/",104],["T_WHITESPACE","\n    ",108],["T_PROTECTED","protected",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$taxCalculationService",109],";",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Factory to create QuoteDetails as input to tax calculation service\n     *\n     * @var \\Magento\\Tax\\Api\\Data\\QuoteDetailsInterfaceFactory\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PROTECTED","protected",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$quoteDetailsDataObjectFactory",116],";",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * @var CustomerAddressFactory\n     *\/",118],["T_WHITESPACE","\n    ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$customerAddressFactory",121],";",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * @var CustomerAddressRegionFactory\n     *\/",123],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$customerAddressRegionFactory",126],";",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Api\\Data\\TaxClassKeyInterfaceFactory\n     *\/",128],["T_WHITESPACE","\n    ",130],["T_PROTECTED","protected",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$taxClassKeyDataObjectFactory",131],";",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory\n     *\/",133],["T_WHITESPACE","\n    ",135],["T_PROTECTED","protected",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$quoteDetailsItemDataObjectFactory",136],";",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     * @param \\Magento\\Tax\\Model\\Config $taxConfig\n     * @param \\Magento\\Tax\\Api\\TaxCalculationInterface $taxCalculationService\n     * @param QuoteDetailsInterfaceFactory $quoteDetailsDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory $quoteDetailsItemDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\TaxClassKeyInterfaceFactory $taxClassKeyDataObjectFactory\n     * @param CustomerAddressFactory $customerAddressFactory\n     * @param CustomerAddressRegionFactory $customerAddressRegionFactory\n     *\/",138],["T_WHITESPACE","\n    ",148],["T_PUBLIC","public",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","__construct",149],"(",["T_WHITESPACE","\n        ",149],["T_NS_SEPARATOR","\\",150],["T_STRING","Magento",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Tax",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Model",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Config",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$taxConfig",150],",",["T_WHITESPACE","\n        ",150],["T_NS_SEPARATOR","\\",151],["T_STRING","Magento",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Tax",151],["T_NS_SEPARATOR","\\",151],["T_STRING","Api",151],["T_NS_SEPARATOR","\\",151],["T_STRING","TaxCalculationInterface",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$taxCalculationService",151],",",["T_WHITESPACE","\n        ",151],["T_NS_SEPARATOR","\\",152],["T_STRING","Magento",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Tax",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Api",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Data",152],["T_NS_SEPARATOR","\\",152],["T_STRING","QuoteDetailsInterfaceFactory",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$quoteDetailsDataObjectFactory",152],",",["T_WHITESPACE","\n        ",152],["T_NS_SEPARATOR","\\",153],["T_STRING","Magento",153],["T_NS_SEPARATOR","\\",153],["T_STRING","Tax",153],["T_NS_SEPARATOR","\\",153],["T_STRING","Api",153],["T_NS_SEPARATOR","\\",153],["T_STRING","Data",153],["T_NS_SEPARATOR","\\",153],["T_STRING","QuoteDetailsItemInterfaceFactory",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$quoteDetailsItemDataObjectFactory",153],",",["T_WHITESPACE","\n        ",153],["T_NS_SEPARATOR","\\",154],["T_STRING","Magento",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Tax",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Api",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Data",154],["T_NS_SEPARATOR","\\",154],["T_STRING","TaxClassKeyInterfaceFactory",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$taxClassKeyDataObjectFactory",154],",",["T_WHITESPACE","\n        ",154],["T_STRING","CustomerAddressFactory",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$customerAddressFactory",155],",",["T_WHITESPACE","\n        ",155],["T_STRING","CustomerAddressRegionFactory",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$customerAddressRegionFactory",156],["T_WHITESPACE","\n    ",156],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","taxCalculationService",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$taxCalculationService",158],";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","quoteDetailsDataObjectFactory",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$quoteDetailsDataObjectFactory",159],";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_config",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$taxConfig",160],";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","taxClassKeyDataObjectFactory",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$taxClassKeyDataObjectFactory",161],";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","quoteDetailsItemDataObjectFactory",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$quoteDetailsItemDataObjectFactory",162],";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","customerAddressFactory",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$customerAddressFactory",163],";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","customerAddressRegionFactory",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$customerAddressRegionFactory",164],";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n\n    ",165],["T_DOC_COMMENT","\/**\n     * Map quote address to customer address\n     *\n     * @param QuoteAddress $address\n     * @return CustomerAddress\n     *\/",167],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","mapAddress",173],"(",["T_STRING","QuoteAddress",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$address",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$customerAddress",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","customerAddressFactory",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","create",175],"(",")",";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$customerAddress",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","setCountryId",176],"(",["T_VARIABLE","$address",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCountryId",176],"(",")",")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$customerAddress",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","setRegion",177],"(",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","customerAddressRegionFactory",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","create",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","setRegionId",178],"(",["T_VARIABLE","$address",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getRegionId",178],"(",")",")",["T_WHITESPACE","\n        ",178],")",";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$customerAddress",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","setPostcode",180],"(",["T_VARIABLE","$address",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getPostcode",180],"(",")",")",";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$customerAddress",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","setCity",181],"(",["T_VARIABLE","$address",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getCity",181],"(",")",")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$customerAddress",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","setStreet",182],"(",["T_VARIABLE","$address",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getStreet",182],"(",")",")",";",["T_WHITESPACE","\n\n        ",182],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$customerAddress",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_DOC_COMMENT","\/**\n     * Map an item to item data object\n     *\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory $itemDataObjectFactory\n     * @param AbstractItem $item\n     * @param bool $priceIncludesTax\n     * @param bool $useBaseCurrency\n     * @param string $parentCode\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface\n     *\/",187],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","mapItem",197],"(",["T_WHITESPACE","\n        ",197],["T_NS_SEPARATOR","\\",198],["T_STRING","Magento",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Tax",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Api",198],["T_NS_SEPARATOR","\\",198],["T_STRING","Data",198],["T_NS_SEPARATOR","\\",198],["T_STRING","QuoteDetailsItemInterfaceFactory",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$itemDataObjectFactory",198],",",["T_WHITESPACE","\n        ",198],["T_STRING","AbstractItem",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$item",199],",",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$priceIncludesTax",200],",",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$useBaseCurrency",201],",",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$parentCode",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","null",202],["T_WHITESPACE","\n    ",202],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(","!",["T_VARIABLE","$item",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTaxCalculationItemId",204],"(",")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$sequence",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'sequence-'",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getNextIncrement",205],"(",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$item",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","setTaxCalculationItemId",206],"(",["T_VARIABLE","$sequence",206],")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n        ",207],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface $itemDataObject *\/",208],["T_WHITESPACE","\n        ",208],["T_VARIABLE","$itemDataObject",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$itemDataObjectFactory",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","create",209],"(",")",";",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$itemDataObject",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","setCode",210],"(",["T_VARIABLE","$item",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getTaxCalculationItemId",210],"(",")",")",["T_WHITESPACE","\n            ",210],["T_OBJECT_OPERATOR","->",211],["T_STRING","setQuantity",211],"(",["T_VARIABLE","$item",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getQty",211],"(",")",")",["T_WHITESPACE","\n            ",211],["T_OBJECT_OPERATOR","->",212],["T_STRING","setTaxClassKey",212],"(",["T_WHITESPACE","\n                ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","taxClassKeyDataObjectFactory",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","create",213],"(",")",["T_WHITESPACE","\n                    ",213],["T_OBJECT_OPERATOR","->",214],["T_STRING","setType",214],"(",["T_STRING","TaxClassKeyInterface",214],["T_DOUBLE_COLON","::",214],["T_STRING","TYPE_ID",214],")",["T_WHITESPACE","\n                    ",214],["T_OBJECT_OPERATOR","->",215],["T_STRING","setValue",215],"(",["T_VARIABLE","$item",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getProduct",215],"(",")",["T_OBJECT_OPERATOR","->",215],["T_STRING","getTaxClassId",215],"(",")",")",["T_WHITESPACE","\n            ",215],")",["T_WHITESPACE","\n            ",216],["T_OBJECT_OPERATOR","->",217],["T_STRING","setIsTaxIncluded",217],"(",["T_VARIABLE","$priceIncludesTax",217],")",["T_WHITESPACE","\n            ",217],["T_OBJECT_OPERATOR","->",218],["T_STRING","setType",218],"(",["T_STRING","self",218],["T_DOUBLE_COLON","::",218],["T_STRING","ITEM_TYPE_PRODUCT",218],")",";",["T_WHITESPACE","\n\n        ",218],["T_IF","if",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$useBaseCurrency",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(","!",["T_VARIABLE","$item",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getBaseTaxCalculationPrice",221],"(",")",")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n                ",221],["T_VARIABLE","$item",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","setBaseTaxCalculationPrice",222],"(",["T_VARIABLE","$item",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getBaseCalculationPriceOriginal",222],"(",")",")",";",["T_WHITESPACE","\n            ",222],"}",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$itemDataObject",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","setUnitPrice",224],"(",["T_VARIABLE","$item",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getBaseTaxCalculationPrice",224],"(",")",")",["T_WHITESPACE","\n                ",224],["T_OBJECT_OPERATOR","->",225],["T_STRING","setDiscountAmount",225],"(",["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getBaseDiscountAmount",225],"(",")",")",";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE"," ",226],["T_ELSE","else",226],["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(","!",["T_VARIABLE","$item",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getTaxCalculationPrice",227],"(",")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n                ",227],["T_VARIABLE","$item",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","setTaxCalculationPrice",228],"(",["T_VARIABLE","$item",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getCalculationPriceOriginal",228],"(",")",")",";",["T_WHITESPACE","\n            ",228],"}",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$itemDataObject",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","setUnitPrice",230],"(",["T_VARIABLE","$item",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getTaxCalculationPrice",230],"(",")",")",["T_WHITESPACE","\n                ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setDiscountAmount",231],"(",["T_VARIABLE","$item",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getDiscountAmount",231],"(",")",")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$itemDataObject",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","setParentCode",234],"(",["T_VARIABLE","$parentCode",234],")",";",["T_WHITESPACE","\n\n        ",234],["T_RETURN","return",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$itemDataObject",236],";",["T_WHITESPACE","\n    ",236],"}",["T_WHITESPACE","\n\n    ",237],["T_DOC_COMMENT","\/**\n     * Map item extra taxables\n     *\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterfaceFactory $itemDataObjectFactory\n     * @param AbstractItem $item\n     * @param bool $priceIncludesTax\n     * @param bool $useBaseCurrency\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface[]\n     *\/",239],["T_WHITESPACE","\n    ",247],["T_PUBLIC","public",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","mapItemExtraTaxables",248],"(",["T_WHITESPACE","\n        ",248],["T_NS_SEPARATOR","\\",249],["T_STRING","Magento",249],["T_NS_SEPARATOR","\\",249],["T_STRING","Tax",249],["T_NS_SEPARATOR","\\",249],["T_STRING","Api",249],["T_NS_SEPARATOR","\\",249],["T_STRING","Data",249],["T_NS_SEPARATOR","\\",249],["T_STRING","QuoteDetailsItemInterfaceFactory",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$itemDataObjectFactory",249],",",["T_WHITESPACE","\n        ",249],["T_STRING","AbstractItem",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$item",250],",",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$priceIncludesTax",251],",",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$useBaseCurrency",252],["T_WHITESPACE","\n    ",252],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$itemDataObjects",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],"[","]",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$extraTaxables",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$item",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getAssociatedTaxables",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_IF","if",256],["T_WHITESPACE"," ",256],"(","!",["T_VARIABLE","$extraTaxables",256],")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_RETURN","return",257],["T_WHITESPACE"," ",257],"[","]",";",["T_WHITESPACE","\n        ",257],"}",["T_WHITESPACE","\n\n        ",258],["T_FOREACH","foreach",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$extraTaxables",260],["T_WHITESPACE"," ",260],["T_AS","as",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$extraTaxable",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$extraTaxableIncludesTax",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE","\n                ",261],["T_ISSET","isset",262],"(",["T_VARIABLE","$extraTaxable",262],"[",["T_CONSTANT_ENCAPSED_STRING","'price_includes_tax'",262],"]",")",["T_WHITESPACE"," ",262],"?",["T_WHITESPACE"," ",262],["T_VARIABLE","$extraTaxable",262],"[",["T_CONSTANT_ENCAPSED_STRING","'price_includes_tax'",262],"]",["T_WHITESPACE"," ",262],":",["T_WHITESPACE"," ",262],["T_VARIABLE","$priceIncludesTax",262],";",["T_WHITESPACE","\n\n            ",262],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$useBaseCurrency",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$unitPrice",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$extraTaxable",265],"[",["T_STRING","self",265],["T_DOUBLE_COLON","::",265],["T_STRING","KEY_ASSOCIATED_TAXABLE_BASE_UNIT_PRICE",265],"]",";",["T_WHITESPACE","\n            ",265],"}",["T_WHITESPACE"," ",266],["T_ELSE","else",266],["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n                ",266],["T_VARIABLE","$unitPrice",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$extraTaxable",267],"[",["T_STRING","self",267],["T_DOUBLE_COLON","::",267],["T_STRING","KEY_ASSOCIATED_TAXABLE_UNIT_PRICE",267],"]",";",["T_WHITESPACE","\n            ",267],"}",["T_WHITESPACE","\n            ",268],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface $itemDataObject *\/",269],["T_WHITESPACE","\n            ",269],["T_VARIABLE","$itemDataObject",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$itemDataObjectFactory",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","create",270],"(",")",";",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$itemDataObject",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","setCode",271],"(",["T_VARIABLE","$extraTaxable",271],"[",["T_STRING","self",271],["T_DOUBLE_COLON","::",271],["T_STRING","KEY_ASSOCIATED_TAXABLE_CODE",271],"]",")",["T_WHITESPACE","\n                ",271],["T_OBJECT_OPERATOR","->",272],["T_STRING","setType",272],"(",["T_VARIABLE","$extraTaxable",272],"[",["T_STRING","self",272],["T_DOUBLE_COLON","::",272],["T_STRING","KEY_ASSOCIATED_TAXABLE_TYPE",272],"]",")",["T_WHITESPACE","\n                ",272],["T_OBJECT_OPERATOR","->",273],["T_STRING","setQuantity",273],"(",["T_VARIABLE","$extraTaxable",273],"[",["T_STRING","self",273],["T_DOUBLE_COLON","::",273],["T_STRING","KEY_ASSOCIATED_TAXABLE_QUANTITY",273],"]",")",["T_WHITESPACE","\n                ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","setTaxClassKey",274],"(",["T_WHITESPACE","\n                    ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","taxClassKeyDataObjectFactory",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","create",275],"(",")",["T_WHITESPACE","\n                        ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","setType",276],"(",["T_STRING","TaxClassKeyInterface",276],["T_DOUBLE_COLON","::",276],["T_STRING","TYPE_ID",276],")",["T_WHITESPACE","\n                        ",276],["T_OBJECT_OPERATOR","->",277],["T_STRING","setValue",277],"(",["T_VARIABLE","$extraTaxable",277],"[",["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","KEY_ASSOCIATED_TAXABLE_TAX_CLASS_ID",277],"]",")",["T_WHITESPACE","\n                ",277],")",["T_WHITESPACE","\n                ",278],["T_OBJECT_OPERATOR","->",279],["T_STRING","setUnitPrice",279],"(",["T_VARIABLE","$unitPrice",279],")",["T_WHITESPACE","\n                ",279],["T_OBJECT_OPERATOR","->",280],["T_STRING","setIsTaxIncluded",280],"(",["T_VARIABLE","$extraTaxableIncludesTax",280],")",["T_WHITESPACE","\n                ",280],["T_OBJECT_OPERATOR","->",281],["T_STRING","setAssociatedItemCode",281],"(",["T_VARIABLE","$item",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getTaxCalculationItemId",281],"(",")",")",";",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$itemDataObjects",282],"[","]",["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$itemDataObject",282],";",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE","\n\n        ",283],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$itemDataObjects",285],";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n\n    ",286],["T_DOC_COMMENT","\/**\n     * Add quote items\n     *\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param bool $useBaseCurrency\n     * @param bool $priceIncludesTax\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface[]\n     *\/",288],["T_WHITESPACE","\n    ",295],["T_PUBLIC","public",296],["T_WHITESPACE"," ",296],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","mapItems",296],"(",["T_WHITESPACE","\n        ",296],["T_STRING","ShippingAssignmentInterface",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$shippingAssignment",297],",",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$priceIncludesTax",298],",",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$useBaseCurrency",299],["T_WHITESPACE","\n    ",299],")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$items",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$shippingAssignment",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getItems",301],"(",")",";",["T_WHITESPACE","\n        ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(","!",["T_STRING","count",302],"(",["T_VARIABLE","$items",302],")",")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_RETURN","return",303],["T_WHITESPACE"," ",303],"[","]",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n\n        ",304],["T_COMMENT","\/\/Populate with items\n",306],["T_WHITESPACE","        ",307],["T_VARIABLE","$itemDataObjectFactory",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","quoteDetailsItemDataObjectFactory",307],";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$itemDataObjects",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],"[","]",";",["T_WHITESPACE","\n        ",308],["T_FOREACH","foreach",309],["T_WHITESPACE"," ",309],"(",["T_VARIABLE","$items",309],["T_WHITESPACE"," ",309],["T_AS","as",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$item",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$item",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getParentItem",310],"(",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                ",310],["T_CONTINUE","continue",311],";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n\n            ",312],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$item",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getHasChildren",314],"(",")",["T_WHITESPACE"," ",314],["T_BOOLEAN_AND","&&",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$item",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","isChildrenCalculated",314],"(",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                ",314],["T_VARIABLE","$parentItemDataObject",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","mapItem",315],"(",["T_VARIABLE","$itemDataObjectFactory",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$item",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$priceIncludesTax",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$useBaseCurrency",315],")",";",["T_WHITESPACE","\n                ",315],["T_VARIABLE","$itemDataObjects",316],"[","]",["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_VARIABLE","$parentItemDataObject",316],";",["T_WHITESPACE","\n                ",316],["T_FOREACH","foreach",317],["T_WHITESPACE"," ",317],"(",["T_VARIABLE","$item",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getChildren",317],"(",")",["T_WHITESPACE"," ",317],["T_AS","as",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$child",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                    ",317],["T_VARIABLE","$childItemDataObject",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","mapItem",318],"(",["T_WHITESPACE","\n                        ",318],["T_VARIABLE","$itemDataObjectFactory",319],",",["T_WHITESPACE","\n                        ",319],["T_VARIABLE","$child",320],",",["T_WHITESPACE","\n                        ",320],["T_VARIABLE","$priceIncludesTax",321],",",["T_WHITESPACE","\n                        ",321],["T_VARIABLE","$useBaseCurrency",322],",",["T_WHITESPACE","\n                        ",322],["T_VARIABLE","$parentItemDataObject",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getCode",323],"(",")",["T_WHITESPACE","\n                    ",323],")",";",["T_WHITESPACE","\n                    ",324],["T_VARIABLE","$itemDataObjects",325],"[","]",["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$childItemDataObject",325],";",["T_WHITESPACE","\n                    ",325],["T_VARIABLE","$extraTaxableItems",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","mapItemExtraTaxables",326],"(",["T_WHITESPACE","\n                        ",326],["T_VARIABLE","$itemDataObjectFactory",327],",",["T_WHITESPACE","\n                        ",327],["T_VARIABLE","$item",328],",",["T_WHITESPACE","\n                        ",328],["T_VARIABLE","$priceIncludesTax",329],",",["T_WHITESPACE","\n                        ",329],["T_VARIABLE","$useBaseCurrency",330],["T_WHITESPACE","\n                    ",330],")",";",["T_WHITESPACE","\n                    ",331],["T_VARIABLE","$itemDataObjects",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_STRING","array_merge",332],"(",["T_VARIABLE","$itemDataObjects",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$extraTaxableItems",332],")",";",["T_WHITESPACE","\n                ",332],"}",["T_WHITESPACE","\n            ",333],"}",["T_WHITESPACE"," ",334],["T_ELSE","else",334],["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n                ",334],["T_VARIABLE","$itemDataObject",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","mapItem",335],"(",["T_VARIABLE","$itemDataObjectFactory",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$item",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$priceIncludesTax",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$useBaseCurrency",335],")",";",["T_WHITESPACE","\n                ",335],["T_VARIABLE","$itemDataObjects",336],"[","]",["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$itemDataObject",336],";",["T_WHITESPACE","\n                ",336],["T_VARIABLE","$extraTaxableItems",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","mapItemExtraTaxables",337],"(",["T_WHITESPACE","\n                    ",337],["T_VARIABLE","$itemDataObjectFactory",338],",",["T_WHITESPACE","\n                    ",338],["T_VARIABLE","$item",339],",",["T_WHITESPACE","\n                    ",339],["T_VARIABLE","$priceIncludesTax",340],",",["T_WHITESPACE","\n                    ",340],["T_VARIABLE","$useBaseCurrency",341],["T_WHITESPACE","\n                ",341],")",";",["T_WHITESPACE","\n                ",342],["T_VARIABLE","$itemDataObjects",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","array_merge",343],"(",["T_VARIABLE","$itemDataObjects",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$extraTaxableItems",343],")",";",["T_WHITESPACE","\n            ",343],"}",["T_WHITESPACE","\n        ",344],"}",["T_WHITESPACE","\n\n        ",345],["T_RETURN","return",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$itemDataObjects",347],";",["T_WHITESPACE","\n    ",347],"}",["T_WHITESPACE","\n\n    ",348],["T_DOC_COMMENT","\/**\n     * Populate the quote details with address information\n     *\n     * @param QuoteDetailsInterface $quoteDetails\n     * @param QuoteAddress $address\n     * @return QuoteDetailsInterface\n     *\/",350],["T_WHITESPACE","\n    ",356],["T_PUBLIC","public",357],["T_WHITESPACE"," ",357],["T_FUNCTION","function",357],["T_WHITESPACE"," ",357],["T_STRING","populateAddressData",357],"(",["T_STRING","QuoteDetailsInterface",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$quoteDetails",357],",",["T_WHITESPACE"," ",357],["T_STRING","QuoteAddress",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$address",357],")",["T_WHITESPACE","\n    ",357],"{",["T_WHITESPACE","\n        ",358],["T_VARIABLE","$quoteDetails",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","setBillingAddress",359],"(",["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","mapAddress",359],"(",["T_VARIABLE","$address",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getQuote",359],"(",")",["T_OBJECT_OPERATOR","->",359],["T_STRING","getBillingAddress",359],"(",")",")",")",";",["T_WHITESPACE","\n        ",359],["T_VARIABLE","$quoteDetails",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setShippingAddress",360],"(",["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","mapAddress",360],"(",["T_VARIABLE","$address",360],")",")",";",["T_WHITESPACE","\n        ",360],["T_RETURN","return",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$quoteDetails",361],";",["T_WHITESPACE","\n    ",361],"}",["T_WHITESPACE","\n\n    ",362],["T_DOC_COMMENT","\/**\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param QuoteAddress\\Total $total\n     * @param bool $useBaseCurrency\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface\n     *\/",364],["T_WHITESPACE","\n    ",369],["T_PUBLIC","public",370],["T_WHITESPACE"," ",370],["T_FUNCTION","function",370],["T_WHITESPACE"," ",370],["T_STRING","getShippingDataObject",370],"(",["T_WHITESPACE","\n        ",370],["T_STRING","ShippingAssignmentInterface",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$shippingAssignment",371],",",["T_WHITESPACE","\n        ",371],["T_STRING","QuoteAddress",372],["T_NS_SEPARATOR","\\",372],["T_STRING","Total",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$total",372],",",["T_WHITESPACE","\n        ",372],["T_VARIABLE","$useBaseCurrency",373],["T_WHITESPACE","\n    ",373],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$store",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$shippingAssignment",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getShipping",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getAddress",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getQuote",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getStore",375],"(",")",";",["T_WHITESPACE","\n        ",375],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$total",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getShippingTaxCalculationAmount",376],"(",")",["T_WHITESPACE"," ",376],["T_IS_IDENTICAL","===",376],["T_WHITESPACE"," ",376],["T_STRING","null",376],")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_COMMENT","\/\/Save the original shipping amount because shipping amount will be overridden\n",377],["T_WHITESPACE","            ",378],["T_COMMENT","\/\/with shipping amount excluding tax\n",378],["T_WHITESPACE","            ",379],["T_VARIABLE","$total",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","setShippingTaxCalculationAmount",379],"(",["T_VARIABLE","$total",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getShippingAmount",379],"(",")",")",";",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$total",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","setBaseShippingTaxCalculationAmount",380],"(",["T_VARIABLE","$total",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getBaseShippingAmount",380],"(",")",")",";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$total",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getShippingTaxCalculationAmount",382],"(",")",["T_WHITESPACE"," ",382],["T_IS_NOT_IDENTICAL","!==",382],["T_WHITESPACE"," ",382],["T_STRING","null",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface $itemDataObject *\/",383],["T_WHITESPACE","\n            ",383],["T_VARIABLE","$itemDataObject",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","quoteDetailsItemDataObjectFactory",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","create",384],"(",")",["T_WHITESPACE","\n                ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","setType",385],"(",["T_STRING","self",385],["T_DOUBLE_COLON","::",385],["T_STRING","ITEM_TYPE_SHIPPING",385],")",["T_WHITESPACE","\n                ",385],["T_OBJECT_OPERATOR","->",386],["T_STRING","setCode",386],"(",["T_STRING","self",386],["T_DOUBLE_COLON","::",386],["T_STRING","ITEM_CODE_SHIPPING",386],")",["T_WHITESPACE","\n                ",386],["T_OBJECT_OPERATOR","->",387],["T_STRING","setQuantity",387],"(",["T_LNUMBER","1",387],")",";",["T_WHITESPACE","\n            ",387],["T_IF","if",388],["T_WHITESPACE"," ",388],"(",["T_VARIABLE","$useBaseCurrency",388],")",["T_WHITESPACE"," ",388],"{",["T_WHITESPACE","\n                ",388],["T_VARIABLE","$itemDataObject",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","setUnitPrice",389],"(",["T_VARIABLE","$total",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getBaseShippingTaxCalculationAmount",389],"(",")",")",";",["T_WHITESPACE","\n            ",389],"}",["T_WHITESPACE"," ",390],["T_ELSE","else",390],["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n                ",390],["T_VARIABLE","$itemDataObject",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","setUnitPrice",391],"(",["T_VARIABLE","$total",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getShippingTaxCalculationAmount",391],"(",")",")",";",["T_WHITESPACE","\n            ",391],"}",["T_WHITESPACE","\n            ",392],["T_IF","if",393],["T_WHITESPACE"," ",393],"(",["T_VARIABLE","$total",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getShippingDiscountAmount",393],"(",")",")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n                ",393],["T_IF","if",394],["T_WHITESPACE"," ",394],"(",["T_VARIABLE","$useBaseCurrency",394],")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n                    ",394],["T_VARIABLE","$itemDataObject",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","setDiscountAmount",395],"(",["T_VARIABLE","$total",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getBaseShippingDiscountAmount",395],"(",")",")",";",["T_WHITESPACE","\n                ",395],"}",["T_WHITESPACE"," ",396],["T_ELSE","else",396],["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n                    ",396],["T_VARIABLE","$itemDataObject",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","setDiscountAmount",397],"(",["T_VARIABLE","$total",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getShippingDiscountAmount",397],"(",")",")",";",["T_WHITESPACE","\n                ",397],"}",["T_WHITESPACE","\n            ",398],"}",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$itemDataObject",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","setTaxClassKey",400],"(",["T_WHITESPACE","\n                ",400],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","taxClassKeyDataObjectFactory",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","create",401],"(",")",["T_WHITESPACE","\n                    ",401],["T_OBJECT_OPERATOR","->",402],["T_STRING","setType",402],"(",["T_STRING","TaxClassKeyInterface",402],["T_DOUBLE_COLON","::",402],["T_STRING","TYPE_ID",402],")",["T_WHITESPACE","\n                    ",402],["T_OBJECT_OPERATOR","->",403],["T_STRING","setValue",403],"(",["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_config",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getShippingTaxClass",403],"(",["T_VARIABLE","$store",403],")",")",["T_WHITESPACE","\n            ",403],")",";",["T_WHITESPACE","\n            ",404],["T_VARIABLE","$itemDataObject",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","setIsTaxIncluded",405],"(",["T_WHITESPACE","\n                ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_config",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","shippingPriceIncludesTax",406],"(",["T_VARIABLE","$store",406],")",["T_WHITESPACE","\n            ",406],")",";",["T_WHITESPACE","\n            ",407],["T_RETURN","return",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$itemDataObject",408],";",["T_WHITESPACE","\n        ",408],"}",["T_WHITESPACE","\n\n        ",409],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_STRING","null",411],";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_DOC_COMMENT","\/**\n     * Populate QuoteDetails object from quote address object\n     *\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param \\Magento\\Tax\\Api\\Data\\QuoteDetailsItemInterface[] $itemDataObjects\n     * @return \\Magento\\Tax\\Api\\Data\\QuoteDetailsInterface\n     *\/",414],["T_WHITESPACE","\n    ",420],["T_PROTECTED","protected",421],["T_WHITESPACE"," ",421],["T_FUNCTION","function",421],["T_WHITESPACE"," ",421],["T_STRING","prepareQuoteDetails",421],"(",["T_STRING","ShippingAssignmentInterface",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$shippingAssignment",421],",",["T_WHITESPACE"," ",421],["T_VARIABLE","$itemDataObjects",421],")",["T_WHITESPACE","\n    ",421],"{",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$items",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$shippingAssignment",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getItems",423],"(",")",";",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$address",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$shippingAssignment",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getShipping",424],"(",")",["T_OBJECT_OPERATOR","->",424],["T_STRING","getAddress",424],"(",")",";",["T_WHITESPACE","\n        ",424],["T_IF","if",425],["T_WHITESPACE"," ",425],"(","!",["T_STRING","count",425],"(",["T_VARIABLE","$items",425],")",")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n            ",425],["T_RETURN","return",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","quoteDetailsDataObjectFactory",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","create",426],"(",")",";",["T_WHITESPACE","\n        ",426],"}",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$quoteDetails",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","quoteDetailsDataObjectFactory",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","create",429],"(",")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","populateAddressData",430],"(",["T_VARIABLE","$quoteDetails",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$address",430],")",";",["T_WHITESPACE","\n\n        ",430],["T_COMMENT","\/\/Set customer tax class\n",432],["T_WHITESPACE","        ",433],["T_VARIABLE","$quoteDetails",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","setCustomerTaxClassKey",433],"(",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","taxClassKeyDataObjectFactory",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","create",434],"(",")",["T_WHITESPACE","\n                ",434],["T_OBJECT_OPERATOR","->",435],["T_STRING","setType",435],"(",["T_STRING","TaxClassKeyInterface",435],["T_DOUBLE_COLON","::",435],["T_STRING","TYPE_ID",435],")",["T_WHITESPACE","\n                ",435],["T_OBJECT_OPERATOR","->",436],["T_STRING","setValue",436],"(",["T_VARIABLE","$address",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getQuote",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","getCustomerTaxClassId",436],"(",")",")",["T_WHITESPACE","\n        ",436],")",";",["T_WHITESPACE","\n        ",437],["T_VARIABLE","$quoteDetails",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","setItems",438],"(",["T_VARIABLE","$itemDataObjects",438],")",";",["T_WHITESPACE","\n        ",438],["T_VARIABLE","$quoteDetails",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","setCustomerId",439],"(",["T_VARIABLE","$address",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getQuote",439],"(",")",["T_OBJECT_OPERATOR","->",439],["T_STRING","getCustomerId",439],"(",")",")",";",["T_WHITESPACE","\n\n        ",439],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$quoteDetails",441],";",["T_WHITESPACE","\n    ",441],"}",["T_WHITESPACE","\n\n    ",442],["T_DOC_COMMENT","\/**\n     * Organize tax details by type and by item code\n     *\n     * @param TaxDetailsInterface $taxDetails\n     * @param TaxDetailsInterface $baseTaxDetails\n     * @return array\n     *\/",444],["T_WHITESPACE","\n    ",450],["T_PROTECTED","protected",451],["T_WHITESPACE"," ",451],["T_FUNCTION","function",451],["T_WHITESPACE"," ",451],["T_STRING","organizeItemTaxDetailsByType",451],"(",["T_WHITESPACE","\n        ",451],["T_STRING","TaxDetailsInterface",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$taxDetails",452],",",["T_WHITESPACE","\n        ",452],["T_STRING","TaxDetailsInterface",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$baseTaxDetails",453],["T_WHITESPACE","\n    ",453],")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n        ",454],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\TaxDetailsItemInterface[] $keyedItems *\/",455],["T_WHITESPACE","\n        ",455],["T_VARIABLE","$keyedItems",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],"[","]",";",["T_WHITESPACE","\n        ",456],["T_FOREACH","foreach",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$taxDetails",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getItems",457],"(",")",["T_WHITESPACE"," ",457],["T_AS","as",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$item",457],")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$keyedItems",458],"[",["T_VARIABLE","$item",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getCode",458],"(",")","]",["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_VARIABLE","$item",458],";",["T_WHITESPACE","\n        ",458],"}",["T_WHITESPACE","\n        ",459],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\TaxDetailsItemInterface[] $baseKeyedItems *\/",460],["T_WHITESPACE","\n        ",460],["T_VARIABLE","$baseKeyedItems",461],["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],"[","]",";",["T_WHITESPACE","\n        ",461],["T_FOREACH","foreach",462],["T_WHITESPACE"," ",462],"(",["T_VARIABLE","$baseTaxDetails",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","getItems",462],"(",")",["T_WHITESPACE"," ",462],["T_AS","as",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$item",462],")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$baseKeyedItems",463],"[",["T_VARIABLE","$item",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getCode",463],"(",")","]",["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$item",463],";",["T_WHITESPACE","\n        ",463],"}",["T_WHITESPACE","\n\n        ",464],["T_VARIABLE","$itemsByType",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],"[","]",";",["T_WHITESPACE","\n        ",466],["T_FOREACH","foreach",467],["T_WHITESPACE"," ",467],"(",["T_VARIABLE","$keyedItems",467],["T_WHITESPACE"," ",467],["T_AS","as",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$code",467],["T_WHITESPACE"," ",467],["T_DOUBLE_ARROW","=>",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$item",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_VARIABLE","$baseItem",468],["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_VARIABLE","$baseKeyedItems",468],"[",["T_VARIABLE","$code",468],"]",";",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$itemType",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$item",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getType",469],"(",")",";",["T_WHITESPACE","\n            ",469],["T_VARIABLE","$itemsByType",470],"[",["T_VARIABLE","$itemType",470],"]","[",["T_VARIABLE","$code",470],"]",["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],"[",["T_STRING","self",470],["T_DOUBLE_COLON","::",470],["T_STRING","KEY_ITEM",470],["T_WHITESPACE"," ",470],["T_DOUBLE_ARROW","=>",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$item",470],",",["T_WHITESPACE"," ",470],["T_STRING","self",470],["T_DOUBLE_COLON","::",470],["T_STRING","KEY_BASE_ITEM",470],["T_WHITESPACE"," ",470],["T_DOUBLE_ARROW","=>",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$baseItem",470],"]",";",["T_WHITESPACE","\n        ",470],"}",["T_WHITESPACE","\n\n        ",471],["T_RETURN","return",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$itemsByType",473],";",["T_WHITESPACE","\n    ",473],"}",["T_WHITESPACE","\n\n    ",474],["T_DOC_COMMENT","\/**\n     * Process product items in the quote.\n     * Set the following aggregated values in the quote object:\n     * subtotal, subtotalInclTax, tax, discount_tax_compensation,\n     *\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param array $itemTaxDetails\n     * @param QuoteAddress\\Total $total\n     * @return $this\n     *\/",476],["T_WHITESPACE","\n    ",485],["T_PROTECTED","protected",486],["T_WHITESPACE"," ",486],["T_FUNCTION","function",486],["T_WHITESPACE"," ",486],["T_STRING","processProductItems",486],"(",["T_WHITESPACE","\n        ",486],["T_STRING","ShippingAssignmentInterface",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$shippingAssignment",487],",",["T_WHITESPACE","\n        ",487],["T_ARRAY","array",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$itemTaxDetails",488],",",["T_WHITESPACE","\n        ",488],["T_STRING","QuoteAddress",489],["T_NS_SEPARATOR","\\",489],["T_STRING","Total",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$total",489],["T_WHITESPACE","\n    ",489],")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n        ",490],["T_VARIABLE","$store",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_VARIABLE","$shippingAssignment",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getShipping",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","getAddress",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","getQuote",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","getStore",491],"(",")",";",["T_WHITESPACE","\n\n        ",491],["T_DOC_COMMENT","\/** @var AbstractItem[] $keyedAddressItems *\/",493],["T_WHITESPACE","\n        ",493],["T_VARIABLE","$keyedAddressItems",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],"[","]",";",["T_WHITESPACE","\n        ",494],["T_FOREACH","foreach",495],["T_WHITESPACE"," ",495],"(",["T_VARIABLE","$shippingAssignment",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getItems",495],"(",")",["T_WHITESPACE"," ",495],["T_AS","as",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$addressItem",495],")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$keyedAddressItems",496],"[",["T_VARIABLE","$addressItem",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getTaxCalculationItemId",496],"(",")","]",["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_VARIABLE","$addressItem",496],";",["T_WHITESPACE","\n        ",496],"}",["T_WHITESPACE","\n\n        ",497],["T_VARIABLE","$subtotal",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_VARIABLE","$baseSubtotal",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_LNUMBER","0",499],";",["T_WHITESPACE","\n        ",499],["T_VARIABLE","$discountTaxCompensation",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$baseDiscountTaxCompensation",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_LNUMBER","0",500],";",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$tax",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_VARIABLE","$baseTax",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_LNUMBER","0",501],";",["T_WHITESPACE","\n        ",501],["T_VARIABLE","$subtotalInclTax",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_VARIABLE","$baseSubtotalInclTax",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_LNUMBER","0",502],";",["T_WHITESPACE","\n\n        ",502],["T_FOREACH","foreach",504],["T_WHITESPACE"," ",504],"(",["T_VARIABLE","$itemTaxDetails",504],["T_WHITESPACE"," ",504],["T_AS","as",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$code",504],["T_WHITESPACE"," ",504],["T_DOUBLE_ARROW","=>",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$itemTaxDetail",504],")",["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n            ",504],["T_DOC_COMMENT","\/** @var TaxDetailsItemInterface $taxDetail *\/",505],["T_WHITESPACE","\n            ",505],["T_VARIABLE","$taxDetail",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_VARIABLE","$itemTaxDetail",506],"[",["T_STRING","self",506],["T_DOUBLE_COLON","::",506],["T_STRING","KEY_ITEM",506],"]",";",["T_WHITESPACE","\n            ",506],["T_DOC_COMMENT","\/** @var TaxDetailsItemInterface $baseTaxDetail *\/",507],["T_WHITESPACE","\n            ",507],["T_VARIABLE","$baseTaxDetail",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_VARIABLE","$itemTaxDetail",508],"[",["T_STRING","self",508],["T_DOUBLE_COLON","::",508],["T_STRING","KEY_BASE_ITEM",508],"]",";",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$quoteItem",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$keyedAddressItems",509],"[",["T_VARIABLE","$code",509],"]",";",["T_WHITESPACE","\n            ",509],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","updateItemTaxInfo",510],"(",["T_VARIABLE","$quoteItem",510],",",["T_WHITESPACE"," ",510],["T_VARIABLE","$taxDetail",510],",",["T_WHITESPACE"," ",510],["T_VARIABLE","$baseTaxDetail",510],",",["T_WHITESPACE"," ",510],["T_VARIABLE","$store",510],")",";",["T_WHITESPACE","\n\n            ",510],["T_COMMENT","\/\/Update aggregated values\n",512],["T_WHITESPACE","            ",513],["T_IF","if",513],["T_WHITESPACE"," ",513],"(",["T_VARIABLE","$quoteItem",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getHasChildren",513],"(",")",["T_WHITESPACE"," ",513],["T_BOOLEAN_AND","&&",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$quoteItem",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","isChildrenCalculated",513],"(",")",")",["T_WHITESPACE"," ",513],"{",["T_WHITESPACE","\n                ",513],["T_COMMENT","\/\/avoid double counting\n",514],["T_WHITESPACE","                ",515],["T_CONTINUE","continue",515],";",["T_WHITESPACE","\n            ",515],"}",["T_WHITESPACE","\n            ",516],["T_VARIABLE","$subtotal",517],["T_WHITESPACE"," ",517],["T_PLUS_EQUAL","+=",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$taxDetail",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","getRowTotal",517],"(",")",";",["T_WHITESPACE","\n            ",517],["T_VARIABLE","$baseSubtotal",518],["T_WHITESPACE"," ",518],["T_PLUS_EQUAL","+=",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$baseTaxDetail",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getRowTotal",518],"(",")",";",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$discountTaxCompensation",519],["T_WHITESPACE"," ",519],["T_PLUS_EQUAL","+=",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$taxDetail",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getDiscountTaxCompensationAmount",519],"(",")",";",["T_WHITESPACE","\n            ",519],["T_VARIABLE","$baseDiscountTaxCompensation",520],["T_WHITESPACE"," ",520],["T_PLUS_EQUAL","+=",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$baseTaxDetail",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getDiscountTaxCompensationAmount",520],"(",")",";",["T_WHITESPACE","\n            ",520],["T_VARIABLE","$tax",521],["T_WHITESPACE"," ",521],["T_PLUS_EQUAL","+=",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$taxDetail",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getRowTax",521],"(",")",";",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$baseTax",522],["T_WHITESPACE"," ",522],["T_PLUS_EQUAL","+=",522],["T_WHITESPACE"," ",522],["T_VARIABLE","$baseTaxDetail",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getRowTax",522],"(",")",";",["T_WHITESPACE","\n            ",522],["T_VARIABLE","$subtotalInclTax",523],["T_WHITESPACE"," ",523],["T_PLUS_EQUAL","+=",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$taxDetail",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getRowTotalInclTax",523],"(",")",";",["T_WHITESPACE","\n            ",523],["T_VARIABLE","$baseSubtotalInclTax",524],["T_WHITESPACE"," ",524],["T_PLUS_EQUAL","+=",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$baseTaxDetail",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getRowTotalInclTax",524],"(",")",";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n\n        ",525],["T_COMMENT","\/\/Set aggregated values\n",527],["T_WHITESPACE","        ",528],["T_VARIABLE","$total",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","setTotalAmount",528],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",528],",",["T_WHITESPACE"," ",528],["T_VARIABLE","$subtotal",528],")",";",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$total",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","setBaseTotalAmount",529],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$baseSubtotal",529],")",";",["T_WHITESPACE","\n        ",529],["T_VARIABLE","$total",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","setTotalAmount",530],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$tax",530],")",";",["T_WHITESPACE","\n        ",530],["T_VARIABLE","$total",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","setBaseTotalAmount",531],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",531],",",["T_WHITESPACE"," ",531],["T_VARIABLE","$baseTax",531],")",";",["T_WHITESPACE","\n        ",531],["T_VARIABLE","$total",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","setTotalAmount",532],"(",["T_CONSTANT_ENCAPSED_STRING","'discount_tax_compensation'",532],",",["T_WHITESPACE"," ",532],["T_VARIABLE","$discountTaxCompensation",532],")",";",["T_WHITESPACE","\n        ",532],["T_VARIABLE","$total",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","setBaseTotalAmount",533],"(",["T_CONSTANT_ENCAPSED_STRING","'discount_tax_compensation'",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$baseDiscountTaxCompensation",533],")",";",["T_WHITESPACE","\n\n        ",533],["T_VARIABLE","$total",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","setSubtotalInclTax",535],"(",["T_VARIABLE","$subtotalInclTax",535],")",";",["T_WHITESPACE","\n        ",535],["T_VARIABLE","$total",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","setBaseSubtotalTotalInclTax",536],"(",["T_VARIABLE","$baseSubtotalInclTax",536],")",";",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$total",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","setBaseSubtotalInclTax",537],"(",["T_VARIABLE","$baseSubtotalInclTax",537],")",";",["T_WHITESPACE","\n        ",537],["T_VARIABLE","$shippingAssignment",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getShipping",538],"(",")",["T_OBJECT_OPERATOR","->",538],["T_STRING","getAddress",538],"(",")",["T_OBJECT_OPERATOR","->",538],["T_STRING","setBaseSubtotalTotalInclTax",538],"(",["T_VARIABLE","$baseSubtotalInclTax",538],")",";",";",["T_WHITESPACE","\n\n        ",538],["T_RETURN","return",540],["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],";",["T_WHITESPACE","\n    ",540],"}",["T_WHITESPACE","\n\n    ",541],["T_DOC_COMMENT","\/**\n     * Process applied taxes for items and quote\n     *\n     * @param QuoteAddress\\Total $total\n     * @param array $itemsByType\n     * @return $this\n     *\/",543],["T_WHITESPACE","\n    ",549],["T_PROTECTED","protected",550],["T_WHITESPACE"," ",550],["T_FUNCTION","function",550],["T_WHITESPACE"," ",550],["T_STRING","processAppliedTaxes",550],"(",["T_WHITESPACE","\n        ",550],["T_STRING","QuoteAddress",551],["T_NS_SEPARATOR","\\",551],["T_STRING","Total",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$total",551],",",["T_WHITESPACE","\n        ",551],["T_STRING","ShippingAssignmentInterface",552],["T_WHITESPACE"," ",552],["T_VARIABLE","$shippingAssignment",552],",",["T_WHITESPACE","\n        ",552],["T_ARRAY","Array",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$itemsByType",553],["T_WHITESPACE","\n    ",553],")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n        ",554],["T_VARIABLE","$total",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","setAppliedTaxes",555],"(","[","]",")",";",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$allAppliedTaxesArray",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],"[","]",";",["T_WHITESPACE","\n\n        ",556],["T_DOC_COMMENT","\/** @var AbstractItem[] $keyedAddressItems *\/",558],["T_WHITESPACE","\n        ",558],["T_VARIABLE","$keyedAddressItems",559],["T_WHITESPACE"," ",559],"=",["T_WHITESPACE"," ",559],"[","]",";",["T_WHITESPACE","\n        ",559],["T_FOREACH","foreach",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$shippingAssignment",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getItems",560],"(",")",["T_WHITESPACE"," ",560],["T_AS","as",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$addressItem",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n            ",560],["T_VARIABLE","$keyedAddressItems",561],"[",["T_VARIABLE","$addressItem",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","getTaxCalculationItemId",561],"(",")","]",["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_VARIABLE","$addressItem",561],";",["T_WHITESPACE","\n        ",561],"}",["T_WHITESPACE","\n\n        ",562],["T_FOREACH","foreach",564],["T_WHITESPACE"," ",564],"(",["T_VARIABLE","$itemsByType",564],["T_WHITESPACE"," ",564],["T_AS","as",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$itemType",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$items",564],")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n            ",564],["T_FOREACH","foreach",565],["T_WHITESPACE"," ",565],"(",["T_VARIABLE","$items",565],["T_WHITESPACE"," ",565],["T_AS","as",565],["T_WHITESPACE"," ",565],["T_VARIABLE","$itemTaxCalculationId",565],["T_WHITESPACE"," ",565],["T_DOUBLE_ARROW","=>",565],["T_WHITESPACE"," ",565],["T_VARIABLE","$itemTaxDetails",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n                ",565],["T_DOC_COMMENT","\/** @var TaxDetailsItemInterface $taxDetails *\/",566],["T_WHITESPACE","\n                ",566],["T_VARIABLE","$taxDetails",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$itemTaxDetails",567],"[",["T_STRING","self",567],["T_DOUBLE_COLON","::",567],["T_STRING","KEY_ITEM",567],"]",";",["T_WHITESPACE","\n                ",567],["T_VARIABLE","$baseTaxDetails",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$itemTaxDetails",568],"[",["T_STRING","self",568],["T_DOUBLE_COLON","::",568],["T_STRING","KEY_BASE_ITEM",568],"]",";",["T_WHITESPACE","\n\n                ",568],["T_VARIABLE","$appliedTaxes",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_VARIABLE","$taxDetails",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","getAppliedTaxes",570],"(",")",";",["T_WHITESPACE","\n                ",570],["T_VARIABLE","$baseAppliedTaxes",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$baseTaxDetails",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getAppliedTaxes",571],"(",")",";",["T_WHITESPACE","\n\n                ",571],["T_VARIABLE","$itemType",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_VARIABLE","$taxDetails",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getType",573],"(",")",";",["T_WHITESPACE","\n                ",573],["T_VARIABLE","$itemId",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_STRING","null",574],";",["T_WHITESPACE","\n                ",574],["T_VARIABLE","$associatedItemId",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_STRING","null",575],";",["T_WHITESPACE","\n                ",575],["T_IF","if",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$itemType",576],["T_WHITESPACE"," ",576],["T_IS_EQUAL","==",576],["T_WHITESPACE"," ",576],["T_STRING","self",576],["T_DOUBLE_COLON","::",576],["T_STRING","ITEM_TYPE_PRODUCT",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n                    ",576],["T_COMMENT","\/\/Use item id instead of tax calculation id\n",577],["T_WHITESPACE","                    ",578],["T_VARIABLE","$itemId",578],["T_WHITESPACE"," ",578],"=",["T_WHITESPACE"," ",578],["T_VARIABLE","$keyedAddressItems",578],"[",["T_VARIABLE","$itemTaxCalculationId",578],"]",["T_OBJECT_OPERATOR","->",578],["T_STRING","getId",578],"(",")",";",["T_WHITESPACE","\n                ",578],"}",["T_WHITESPACE"," ",579],["T_ELSE","else",579],["T_WHITESPACE"," ",579],"{",["T_WHITESPACE","\n                    ",579],["T_IF","if",580],["T_WHITESPACE"," ",580],"(",["T_VARIABLE","$taxDetails",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getAssociatedItemCode",580],"(",")",["T_WHITESPACE","\n                        ",580],["T_BOOLEAN_AND","&&",581],["T_WHITESPACE"," ",581],["T_VARIABLE","$taxDetails",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getAssociatedItemCode",581],"(",")",["T_WHITESPACE"," ",581],["T_IS_NOT_EQUAL","!=",581],["T_WHITESPACE"," ",581],["T_STRING","self",581],["T_DOUBLE_COLON","::",581],["T_STRING","ASSOCIATION_ITEM_CODE_FOR_QUOTE",581],")",["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n                        ",581],["T_COMMENT","\/\/This item is associated with a product item\n",582],["T_WHITESPACE","                        ",583],["T_VARIABLE","$associatedItemId",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$keyedAddressItems",583],"[",["T_VARIABLE","$taxDetails",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getAssociatedItemCode",583],"(",")","]",["T_OBJECT_OPERATOR","->",583],["T_STRING","getId",583],"(",")",";",["T_WHITESPACE","\n                    ",583],"}",["T_WHITESPACE"," ",584],["T_ELSE","else",584],["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n                        ",584],["T_COMMENT","\/\/This item is associated with an order, e.g., shipping, etc.\n",585],["T_WHITESPACE","                        ",586],["T_VARIABLE","$itemId",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_STRING","null",586],";",["T_WHITESPACE","\n                    ",586],"}",["T_WHITESPACE","\n                ",587],"}",["T_WHITESPACE","\n                ",588],["T_VARIABLE","$extraInfo",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],"[",["T_WHITESPACE","\n                    ",589],["T_CONSTANT_ENCAPSED_STRING","'item_id'",590],["T_WHITESPACE"," ",590],["T_DOUBLE_ARROW","=>",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$itemId",590],",",["T_WHITESPACE","\n                    ",590],["T_CONSTANT_ENCAPSED_STRING","'item_type'",591],["T_WHITESPACE"," ",591],["T_DOUBLE_ARROW","=>",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$itemType",591],",",["T_WHITESPACE","\n                    ",591],["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",592],["T_WHITESPACE"," ",592],["T_DOUBLE_ARROW","=>",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$associatedItemId",592],",",["T_WHITESPACE","\n                ",592],"]",";",["T_WHITESPACE","\n\n                ",593],["T_VARIABLE","$appliedTaxesArray",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","convertAppliedTaxes",595],"(",["T_VARIABLE","$appliedTaxes",595],",",["T_WHITESPACE"," ",595],["T_VARIABLE","$baseAppliedTaxes",595],",",["T_WHITESPACE"," ",595],["T_VARIABLE","$extraInfo",595],")",";",["T_WHITESPACE","\n\n                ",595],["T_IF","if",597],["T_WHITESPACE"," ",597],"(",["T_VARIABLE","$itemType",597],["T_WHITESPACE"," ",597],["T_IS_EQUAL","==",597],["T_WHITESPACE"," ",597],["T_STRING","self",597],["T_DOUBLE_COLON","::",597],["T_STRING","ITEM_TYPE_PRODUCT",597],")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n                    ",597],["T_VARIABLE","$quoteItem",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_VARIABLE","$keyedAddressItems",598],"[",["T_VARIABLE","$itemTaxCalculationId",598],"]",";",["T_WHITESPACE","\n                    ",598],["T_VARIABLE","$quoteItem",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","setAppliedTaxes",599],"(",["T_VARIABLE","$appliedTaxesArray",599],")",";",["T_WHITESPACE","\n                ",599],"}",["T_WHITESPACE","\n\n                ",600],["T_VARIABLE","$allAppliedTaxesArray",602],"[",["T_VARIABLE","$itemTaxCalculationId",602],"]",["T_WHITESPACE"," ",602],"=",["T_WHITESPACE"," ",602],["T_VARIABLE","$appliedTaxesArray",602],";",["T_WHITESPACE","\n\n                ",602],["T_FOREACH","foreach",604],["T_WHITESPACE"," ",604],"(",["T_VARIABLE","$appliedTaxesArray",604],["T_WHITESPACE"," ",604],["T_AS","as",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$appliedTaxArray",604],")",["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n                    ",604],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_saveAppliedTaxes",605],"(",["T_WHITESPACE","\n                        ",605],["T_VARIABLE","$total",606],",",["T_WHITESPACE","\n                        ",606],"[",["T_VARIABLE","$appliedTaxArray",607],"]",",",["T_WHITESPACE","\n                        ",607],["T_VARIABLE","$appliedTaxArray",608],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",608],"]",",",["T_WHITESPACE","\n                        ",608],["T_VARIABLE","$appliedTaxArray",609],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",609],"]",",",["T_WHITESPACE","\n                        ",609],["T_VARIABLE","$appliedTaxArray",610],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",610],"]",["T_WHITESPACE","\n                    ",610],")",";",["T_WHITESPACE","\n                ",611],"}",["T_WHITESPACE","\n            ",612],"}",["T_WHITESPACE","\n        ",613],"}",["T_WHITESPACE","\n\n        ",614],["T_VARIABLE","$total",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","setItemsAppliedTaxes",616],"(",["T_VARIABLE","$allAppliedTaxesArray",616],")",";",["T_WHITESPACE","\n\n        ",616],["T_RETURN","return",618],["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],";",["T_WHITESPACE","\n    ",618],"}",["T_WHITESPACE","\n\n    ",619],["T_DOC_COMMENT","\/**\n     * Update tax related fields for quote item\n     *\n     * @param AbstractItem $quoteItem\n     * @param TaxDetailsItemInterface $itemTaxDetails\n     * @param TaxDetailsItemInterface $baseItemTaxDetails\n     * @param Store $store\n     * @return $this\n     *\/",621],["T_WHITESPACE","\n    ",629],["T_PUBLIC","public",630],["T_WHITESPACE"," ",630],["T_FUNCTION","function",630],["T_WHITESPACE"," ",630],["T_STRING","updateItemTaxInfo",630],"(",["T_VARIABLE","$quoteItem",630],",",["T_WHITESPACE"," ",630],["T_VARIABLE","$itemTaxDetails",630],",",["T_WHITESPACE"," ",630],["T_VARIABLE","$baseItemTaxDetails",630],",",["T_WHITESPACE"," ",630],["T_VARIABLE","$store",630],")",["T_WHITESPACE","\n    ",630],"{",["T_WHITESPACE","\n        ",631],["T_COMMENT","\/\/The price should be base price\n",632],["T_WHITESPACE","        ",633],["T_VARIABLE","$quoteItem",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","setPrice",633],"(",["T_VARIABLE","$baseItemTaxDetails",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","getPrice",633],"(",")",")",";",["T_WHITESPACE","\n        ",633],["T_VARIABLE","$quoteItem",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","setConvertedPrice",634],"(",["T_VARIABLE","$itemTaxDetails",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","getPrice",634],"(",")",")",";",["T_WHITESPACE","\n        ",634],["T_VARIABLE","$quoteItem",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","setPriceInclTax",635],"(",["T_VARIABLE","$itemTaxDetails",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getPriceInclTax",635],"(",")",")",";",["T_WHITESPACE","\n        ",635],["T_VARIABLE","$quoteItem",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","setRowTotal",636],"(",["T_VARIABLE","$itemTaxDetails",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","getRowTotal",636],"(",")",")",";",["T_WHITESPACE","\n        ",636],["T_VARIABLE","$quoteItem",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","setRowTotalInclTax",637],"(",["T_VARIABLE","$itemTaxDetails",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","getRowTotalInclTax",637],"(",")",")",";",["T_WHITESPACE","\n        ",637],["T_VARIABLE","$quoteItem",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","setTaxAmount",638],"(",["T_VARIABLE","$itemTaxDetails",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","getRowTax",638],"(",")",")",";",["T_WHITESPACE","\n        ",638],["T_VARIABLE","$quoteItem",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","setTaxPercent",639],"(",["T_VARIABLE","$itemTaxDetails",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","getTaxPercent",639],"(",")",")",";",["T_WHITESPACE","\n        ",639],["T_VARIABLE","$quoteItem",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","setDiscountTaxCompensationAmount",640],"(",["T_VARIABLE","$itemTaxDetails",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","getDiscountTaxCompensationAmount",640],"(",")",")",";",["T_WHITESPACE","\n\n        ",640],["T_VARIABLE","$quoteItem",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","setBasePrice",642],"(",["T_VARIABLE","$baseItemTaxDetails",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getPrice",642],"(",")",")",";",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$quoteItem",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","setBasePriceInclTax",643],"(",["T_VARIABLE","$baseItemTaxDetails",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getPriceInclTax",643],"(",")",")",";",["T_WHITESPACE","\n        ",643],["T_VARIABLE","$quoteItem",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","setBaseRowTotal",644],"(",["T_VARIABLE","$baseItemTaxDetails",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getRowTotal",644],"(",")",")",";",["T_WHITESPACE","\n        ",644],["T_VARIABLE","$quoteItem",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","setBaseRowTotalInclTax",645],"(",["T_VARIABLE","$baseItemTaxDetails",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getRowTotalInclTax",645],"(",")",")",";",["T_WHITESPACE","\n        ",645],["T_VARIABLE","$quoteItem",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","setBaseTaxAmount",646],"(",["T_VARIABLE","$baseItemTaxDetails",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","getRowTax",646],"(",")",")",";",["T_WHITESPACE","\n        ",646],["T_VARIABLE","$quoteItem",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","setTaxPercent",647],"(",["T_VARIABLE","$baseItemTaxDetails",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getTaxPercent",647],"(",")",")",";",["T_WHITESPACE","\n        ",647],["T_VARIABLE","$quoteItem",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","setBaseDiscountTaxCompensationAmount",648],"(",["T_VARIABLE","$baseItemTaxDetails",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getDiscountTaxCompensationAmount",648],"(",")",")",";",["T_WHITESPACE","\n\n        ",648],["T_COMMENT","\/\/Set discount calculation price, this may be needed by discount collector\n",650],["T_WHITESPACE","        ",651],["T_IF","if",651],["T_WHITESPACE"," ",651],"(",["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","_config",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","discountTax",651],"(",["T_VARIABLE","$store",651],")",")",["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$quoteItem",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","setDiscountCalculationPrice",652],"(",["T_VARIABLE","$itemTaxDetails",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","getPriceInclTax",652],"(",")",")",";",["T_WHITESPACE","\n            ",652],["T_VARIABLE","$quoteItem",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","setBaseDiscountCalculationPrice",653],"(",["T_VARIABLE","$baseItemTaxDetails",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","getPriceInclTax",653],"(",")",")",";",["T_WHITESPACE","\n        ",653],"}",["T_WHITESPACE"," ",654],["T_ELSE","else",654],["T_WHITESPACE"," ",654],"{",["T_WHITESPACE","\n            ",654],["T_VARIABLE","$quoteItem",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","setDiscountCalculationPrice",655],"(",["T_VARIABLE","$itemTaxDetails",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","getPrice",655],"(",")",")",";",["T_WHITESPACE","\n            ",655],["T_VARIABLE","$quoteItem",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","setBaseDiscountCalculationPrice",656],"(",["T_VARIABLE","$baseItemTaxDetails",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getPrice",656],"(",")",")",";",["T_WHITESPACE","\n        ",656],"}",["T_WHITESPACE","\n\n        ",657],["T_RETURN","return",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$this",659],";",["T_WHITESPACE","\n    ",659],"}",["T_WHITESPACE","\n\n    ",660],["T_DOC_COMMENT","\/**\n     * Update tax related fields for shipping\n     *\n     * @param ShippingAssignmentInterface $shippingAssignment\n     * @param QuoteAddress\\Total $total\n     * @param TaxDetailsItemInterface $shippingTaxDetails\n     * @param TaxDetailsItemInterface $baseShippingTaxDetails\n     * @return $this\n     *\/",662],["T_WHITESPACE","\n    ",670],["T_PROTECTED","protected",671],["T_WHITESPACE"," ",671],["T_FUNCTION","function",671],["T_WHITESPACE"," ",671],["T_STRING","processShippingTaxInfo",671],"(",["T_WHITESPACE","\n        ",671],["T_STRING","ShippingAssignmentInterface",672],["T_WHITESPACE"," ",672],["T_VARIABLE","$shippingAssignment",672],",",["T_WHITESPACE","\n        ",672],["T_STRING","QuoteAddress",673],["T_NS_SEPARATOR","\\",673],["T_STRING","Total",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$total",673],",",["T_WHITESPACE","\n        ",673],["T_VARIABLE","$shippingTaxDetails",674],",",["T_WHITESPACE","\n        ",674],["T_VARIABLE","$baseShippingTaxDetails",675],["T_WHITESPACE","\n    ",675],")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n        ",676],["T_VARIABLE","$total",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","setTotalAmount",677],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",677],",",["T_WHITESPACE"," ",677],["T_VARIABLE","$shippingTaxDetails",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","getRowTotal",677],"(",")",")",";",["T_WHITESPACE","\n        ",677],["T_VARIABLE","$total",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","setBaseTotalAmount",678],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",678],",",["T_WHITESPACE"," ",678],["T_VARIABLE","$baseShippingTaxDetails",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getRowTotal",678],"(",")",")",";",["T_WHITESPACE","\n        ",678],["T_VARIABLE","$total",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","setTotalAmount",679],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_discount_tax_compensation'",679],",",["T_WHITESPACE"," ",679],["T_VARIABLE","$shippingTaxDetails",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getDiscountTaxCompensationAmount",679],"(",")",")",";",["T_WHITESPACE","\n        ",679],["T_VARIABLE","$total",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","setBaseTotalAmount",680],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_discount_tax_compensation'",680],",",["T_WHITESPACE"," ",680],["T_VARIABLE","$baseShippingTaxDetails",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getDiscountTaxCompensationAmount",680],"(",")",")",";",["T_WHITESPACE","\n\n        ",680],["T_VARIABLE","$total",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","setShippingInclTax",682],"(",["T_VARIABLE","$shippingTaxDetails",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getRowTotalInclTax",682],"(",")",")",";",["T_WHITESPACE","\n        ",682],["T_VARIABLE","$total",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","setBaseShippingInclTax",683],"(",["T_VARIABLE","$baseShippingTaxDetails",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getRowTotalInclTax",683],"(",")",")",";",["T_WHITESPACE","\n        ",683],["T_VARIABLE","$total",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","setShippingTaxAmount",684],"(",["T_VARIABLE","$shippingTaxDetails",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","getRowTax",684],"(",")",")",";",["T_WHITESPACE","\n        ",684],["T_VARIABLE","$total",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","setBaseShippingTaxAmount",685],"(",["T_VARIABLE","$baseShippingTaxDetails",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getRowTax",685],"(",")",")",";",["T_WHITESPACE","\n\n        ",685],["T_COMMENT","\/\/Add the shipping tax to total tax amount\n",687],["T_WHITESPACE","        ",688],["T_VARIABLE","$total",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","addTotalAmount",688],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",688],",",["T_WHITESPACE"," ",688],["T_VARIABLE","$shippingTaxDetails",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","getRowTax",688],"(",")",")",";",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$total",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","addBaseTotalAmount",689],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",689],",",["T_WHITESPACE"," ",689],["T_VARIABLE","$baseShippingTaxDetails",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","getRowTax",689],"(",")",")",";",["T_WHITESPACE","\n\n        ",689],["T_IF","if",691],["T_WHITESPACE"," ",691],"(",["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","_config",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","discountTax",691],"(",["T_VARIABLE","$shippingAssignment",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","getShipping",691],"(",")",["T_OBJECT_OPERATOR","->",691],["T_STRING","getAddress",691],"(",")",["T_OBJECT_OPERATOR","->",691],["T_STRING","getQuote",691],"(",")",["T_OBJECT_OPERATOR","->",691],["T_STRING","getStore",691],"(",")",")",")",["T_WHITESPACE"," ",691],"{",["T_WHITESPACE","\n            ",691],["T_VARIABLE","$total",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","setShippingAmountForDiscount",692],"(",["T_VARIABLE","$shippingTaxDetails",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","getRowTotalInclTax",692],"(",")",")",";",["T_WHITESPACE","\n            ",692],["T_VARIABLE","$total",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","setBaseShippingAmountForDiscount",693],"(",["T_VARIABLE","$baseShippingTaxDetails",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","getRowTotalInclTax",693],"(",")",")",";",["T_WHITESPACE","\n        ",693],"}",["T_WHITESPACE","\n\n        ",694],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$this",696],";",["T_WHITESPACE","\n    ",696],"}",["T_WHITESPACE","\n\n    ",697],["T_DOC_COMMENT","\/**\n     * Convert appliedTax data object from tax calculation service to internal array format\n     *\n     * @param \\Magento\\Tax\\Api\\Data\\AppliedTaxInterface[] $appliedTaxes\n     * @param \\Magento\\Tax\\Api\\Data\\AppliedTaxInterface[] $baseAppliedTaxes\n     * @param array $extraInfo\n     * @return array\n     *\/",699],["T_WHITESPACE","\n    ",706],["T_PUBLIC","public",707],["T_WHITESPACE"," ",707],["T_FUNCTION","function",707],["T_WHITESPACE"," ",707],["T_STRING","convertAppliedTaxes",707],"(",["T_VARIABLE","$appliedTaxes",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$baseAppliedTaxes",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$extraInfo",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],"[","]",")",["T_WHITESPACE","\n    ",707],"{",["T_WHITESPACE","\n        ",708],["T_VARIABLE","$appliedTaxesArray",709],["T_WHITESPACE"," ",709],"=",["T_WHITESPACE"," ",709],"[","]",";",["T_WHITESPACE","\n\n        ",709],["T_IF","if",711],["T_WHITESPACE"," ",711],"(","!",["T_VARIABLE","$appliedTaxes",711],["T_WHITESPACE"," ",711],["T_BOOLEAN_OR","||",711],["T_WHITESPACE"," ",711],"!",["T_VARIABLE","$baseAppliedTaxes",711],")",["T_WHITESPACE"," ",711],"{",["T_WHITESPACE","\n            ",711],["T_RETURN","return",712],["T_WHITESPACE"," ",712],["T_VARIABLE","$appliedTaxesArray",712],";",["T_WHITESPACE","\n        ",712],"}",["T_WHITESPACE","\n\n        ",713],["T_FOREACH","foreach",715],["T_WHITESPACE"," ",715],"(",["T_VARIABLE","$appliedTaxes",715],["T_WHITESPACE"," ",715],["T_AS","as",715],["T_WHITESPACE"," ",715],["T_VARIABLE","$taxId",715],["T_WHITESPACE"," ",715],["T_DOUBLE_ARROW","=>",715],["T_WHITESPACE"," ",715],["T_VARIABLE","$appliedTax",715],")",["T_WHITESPACE"," ",715],"{",["T_WHITESPACE","\n            ",715],["T_VARIABLE","$baseAppliedTax",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],["T_VARIABLE","$baseAppliedTaxes",716],"[",["T_VARIABLE","$taxId",716],"]",";",["T_WHITESPACE","\n            ",716],["T_VARIABLE","$rateDataObjects",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_VARIABLE","$appliedTax",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getRates",717],"(",")",";",["T_WHITESPACE","\n\n            ",717],["T_VARIABLE","$rates",719],["T_WHITESPACE"," ",719],"=",["T_WHITESPACE"," ",719],"[","]",";",["T_WHITESPACE","\n            ",719],["T_FOREACH","foreach",720],["T_WHITESPACE"," ",720],"(",["T_VARIABLE","$rateDataObjects",720],["T_WHITESPACE"," ",720],["T_AS","as",720],["T_WHITESPACE"," ",720],["T_VARIABLE","$rateDataObject",720],")",["T_WHITESPACE"," ",720],"{",["T_WHITESPACE","\n                ",720],["T_VARIABLE","$rates",721],"[","]",["T_WHITESPACE"," ",721],"=",["T_WHITESPACE"," ",721],"[",["T_WHITESPACE","\n                    ",721],["T_CONSTANT_ENCAPSED_STRING","'percent'",722],["T_WHITESPACE"," ",722],["T_DOUBLE_ARROW","=>",722],["T_WHITESPACE"," ",722],["T_VARIABLE","$rateDataObject",722],["T_OBJECT_OPERATOR","->",722],["T_STRING","getPercent",722],"(",")",",",["T_WHITESPACE","\n                    ",722],["T_CONSTANT_ENCAPSED_STRING","'code'",723],["T_WHITESPACE"," ",723],["T_DOUBLE_ARROW","=>",723],["T_WHITESPACE"," ",723],["T_VARIABLE","$rateDataObject",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","getCode",723],"(",")",",",["T_WHITESPACE","\n                    ",723],["T_CONSTANT_ENCAPSED_STRING","'title'",724],["T_WHITESPACE"," ",724],["T_DOUBLE_ARROW","=>",724],["T_WHITESPACE"," ",724],["T_VARIABLE","$rateDataObject",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","getTitle",724],"(",")",",",["T_WHITESPACE","\n                ",724],"]",";",["T_WHITESPACE","\n            ",725],"}",["T_WHITESPACE","\n\n            ",726],["T_VARIABLE","$appliedTaxArray",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],"[",["T_WHITESPACE","\n                ",728],["T_CONSTANT_ENCAPSED_STRING","'amount'",729],["T_WHITESPACE"," ",729],["T_DOUBLE_ARROW","=>",729],["T_WHITESPACE"," ",729],["T_VARIABLE","$appliedTax",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","getAmount",729],"(",")",",",["T_WHITESPACE","\n                ",729],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",730],["T_WHITESPACE"," ",730],["T_DOUBLE_ARROW","=>",730],["T_WHITESPACE"," ",730],["T_VARIABLE","$baseAppliedTax",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","getAmount",730],"(",")",",",["T_WHITESPACE","\n                ",730],["T_CONSTANT_ENCAPSED_STRING","'percent'",731],["T_WHITESPACE"," ",731],["T_DOUBLE_ARROW","=>",731],["T_WHITESPACE"," ",731],["T_VARIABLE","$appliedTax",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getPercent",731],"(",")",",",["T_WHITESPACE","\n                ",731],["T_CONSTANT_ENCAPSED_STRING","'id'",732],["T_WHITESPACE"," ",732],["T_DOUBLE_ARROW","=>",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$appliedTax",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","getTaxRateKey",732],"(",")",",",["T_WHITESPACE","\n                ",732],["T_CONSTANT_ENCAPSED_STRING","'rates'",733],["T_WHITESPACE"," ",733],["T_DOUBLE_ARROW","=>",733],["T_WHITESPACE"," ",733],["T_VARIABLE","$rates",733],",",["T_WHITESPACE","\n            ",733],"]",";",["T_WHITESPACE","\n            ",734],["T_IF","if",735],["T_WHITESPACE"," ",735],"(","!",["T_EMPTY","empty",735],"(",["T_VARIABLE","$extraInfo",735],")",")",["T_WHITESPACE"," ",735],"{",["T_WHITESPACE","\n                ",735],["T_VARIABLE","$appliedTaxArray",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_STRING","array_merge",736],"(",["T_VARIABLE","$appliedTaxArray",736],",",["T_WHITESPACE"," ",736],["T_VARIABLE","$extraInfo",736],")",";",["T_WHITESPACE","\n            ",736],"}",["T_WHITESPACE","\n\n            ",737],["T_VARIABLE","$appliedTaxesArray",739],"[","]",["T_WHITESPACE"," ",739],"=",["T_WHITESPACE"," ",739],["T_VARIABLE","$appliedTaxArray",739],";",["T_WHITESPACE","\n        ",739],"}",["T_WHITESPACE","\n\n        ",740],["T_RETURN","return",742],["T_WHITESPACE"," ",742],["T_VARIABLE","$appliedTaxesArray",742],";",["T_WHITESPACE","\n    ",742],"}",["T_WHITESPACE","\n\n    ",743],["T_DOC_COMMENT","\/**\n     * Collect applied tax rates information on address level\n     *\n     * @param QuoteAddress\\Total $total\n     * @param array $applied\n     * @param float $amount\n     * @param float $baseAmount\n     * @param float $rate\n     * @return void\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",745],["T_WHITESPACE","\n    ",756],["T_PROTECTED","protected",757],["T_WHITESPACE"," ",757],["T_FUNCTION","function",757],["T_WHITESPACE"," ",757],["T_STRING","_saveAppliedTaxes",757],"(",["T_WHITESPACE","\n        ",757],["T_STRING","QuoteAddress",758],["T_NS_SEPARATOR","\\",758],["T_STRING","Total",758],["T_WHITESPACE"," ",758],["T_VARIABLE","$total",758],",",["T_WHITESPACE","\n        ",758],["T_VARIABLE","$applied",759],",",["T_WHITESPACE","\n        ",759],["T_VARIABLE","$amount",760],",",["T_WHITESPACE","\n        ",760],["T_VARIABLE","$baseAmount",761],",",["T_WHITESPACE","\n        ",761],["T_VARIABLE","$rate",762],["T_WHITESPACE","\n    ",762],")",["T_WHITESPACE"," ",763],"{",["T_WHITESPACE","\n        ",763],["T_VARIABLE","$previouslyAppliedTaxes",764],["T_WHITESPACE"," ",764],"=",["T_WHITESPACE"," ",764],["T_VARIABLE","$total",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getAppliedTaxes",764],"(",")",";",["T_WHITESPACE","\n        ",764],["T_VARIABLE","$process",765],["T_WHITESPACE"," ",765],"=",["T_WHITESPACE"," ",765],["T_STRING","count",765],"(",["T_VARIABLE","$previouslyAppliedTaxes",765],")",";",["T_WHITESPACE","\n\n        ",765],["T_FOREACH","foreach",767],["T_WHITESPACE"," ",767],"(",["T_VARIABLE","$applied",767],["T_WHITESPACE"," ",767],["T_AS","as",767],["T_WHITESPACE"," ",767],["T_VARIABLE","$row",767],")",["T_WHITESPACE"," ",767],"{",["T_WHITESPACE","\n            ",767],["T_IF","if",768],["T_WHITESPACE"," ",768],"(",["T_VARIABLE","$row",768],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",768],"]",["T_WHITESPACE"," ",768],["T_IS_EQUAL","==",768],["T_WHITESPACE"," ",768],["T_LNUMBER","0",768],")",["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n                ",768],["T_CONTINUE","continue",769],";",["T_WHITESPACE","\n            ",769],"}",["T_WHITESPACE","\n            ",770],["T_IF","if",771],["T_WHITESPACE"," ",771],"(","!",["T_ISSET","isset",771],"(",["T_VARIABLE","$previouslyAppliedTaxes",771],"[",["T_VARIABLE","$row",771],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",771],"]","]",")",")",["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n                ",771],["T_VARIABLE","$row",772],"[",["T_CONSTANT_ENCAPSED_STRING","'process'",772],"]",["T_WHITESPACE"," ",772],"=",["T_WHITESPACE"," ",772],["T_VARIABLE","$process",772],";",["T_WHITESPACE","\n                ",772],["T_VARIABLE","$row",773],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",773],"]",["T_WHITESPACE"," ",773],"=",["T_WHITESPACE"," ",773],["T_LNUMBER","0",773],";",["T_WHITESPACE","\n                ",773],["T_VARIABLE","$row",774],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",774],"]",["T_WHITESPACE"," ",774],"=",["T_WHITESPACE"," ",774],["T_LNUMBER","0",774],";",["T_WHITESPACE","\n                ",774],["T_VARIABLE","$previouslyAppliedTaxes",775],"[",["T_VARIABLE","$row",775],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",775],"]","]",["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_VARIABLE","$row",775],";",["T_WHITESPACE","\n            ",775],"}",["T_WHITESPACE","\n\n            ",776],["T_IF","if",778],["T_WHITESPACE"," ",778],"(","!",["T_STRING","is_null",778],"(",["T_VARIABLE","$row",778],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",778],"]",")",")",["T_WHITESPACE"," ",778],"{",["T_WHITESPACE","\n                ",778],["T_VARIABLE","$row",779],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",779],"]",["T_WHITESPACE"," ",779],"=",["T_WHITESPACE"," ",779],["T_VARIABLE","$row",779],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",779],"]",["T_WHITESPACE"," ",779],"?",["T_WHITESPACE"," ",779],["T_VARIABLE","$row",779],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",779],"]",["T_WHITESPACE"," ",779],":",["T_WHITESPACE"," ",779],["T_LNUMBER","1",779],";",["T_WHITESPACE","\n                ",779],["T_VARIABLE","$rate",780],["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$rate",780],["T_WHITESPACE"," ",780],"?",["T_WHITESPACE"," ",780],["T_VARIABLE","$rate",780],["T_WHITESPACE"," ",780],":",["T_WHITESPACE"," ",780],["T_LNUMBER","1",780],";",["T_WHITESPACE","\n\n                ",780],["T_VARIABLE","$appliedAmount",782],["T_WHITESPACE"," ",782],"=",["T_WHITESPACE"," ",782],["T_VARIABLE","$amount",782],["T_WHITESPACE"," ",782],"\/",["T_WHITESPACE"," ",782],["T_VARIABLE","$rate",782],["T_WHITESPACE"," ",782],"*",["T_WHITESPACE"," ",782],["T_VARIABLE","$row",782],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",782],"]",";",["T_WHITESPACE","\n                ",782],["T_VARIABLE","$baseAppliedAmount",783],["T_WHITESPACE"," ",783],"=",["T_WHITESPACE"," ",783],["T_VARIABLE","$baseAmount",783],["T_WHITESPACE"," ",783],"\/",["T_WHITESPACE"," ",783],["T_VARIABLE","$rate",783],["T_WHITESPACE"," ",783],"*",["T_WHITESPACE"," ",783],["T_VARIABLE","$row",783],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",783],"]",";",["T_WHITESPACE","\n            ",783],"}",["T_WHITESPACE"," ",784],["T_ELSE","else",784],["T_WHITESPACE"," ",784],"{",["T_WHITESPACE","\n                ",784],["T_VARIABLE","$appliedAmount",785],["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_LNUMBER","0",785],";",["T_WHITESPACE","\n                ",785],["T_VARIABLE","$baseAppliedAmount",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_LNUMBER","0",786],";",["T_WHITESPACE","\n                ",786],["T_FOREACH","foreach",787],["T_WHITESPACE"," ",787],"(",["T_VARIABLE","$row",787],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",787],"]",["T_WHITESPACE"," ",787],["T_AS","as",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$rate",787],")",["T_WHITESPACE"," ",787],"{",["T_WHITESPACE","\n                    ",787],["T_VARIABLE","$appliedAmount",788],["T_WHITESPACE"," ",788],["T_PLUS_EQUAL","+=",788],["T_WHITESPACE"," ",788],["T_VARIABLE","$rate",788],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",788],"]",";",["T_WHITESPACE","\n                    ",788],["T_VARIABLE","$baseAppliedAmount",789],["T_WHITESPACE"," ",789],["T_PLUS_EQUAL","+=",789],["T_WHITESPACE"," ",789],["T_VARIABLE","$rate",789],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",789],"]",";",["T_WHITESPACE","\n                ",789],"}",["T_WHITESPACE","\n            ",790],"}",["T_WHITESPACE","\n\n            ",791],["T_IF","if",793],["T_WHITESPACE"," ",793],"(",["T_VARIABLE","$appliedAmount",793],["T_WHITESPACE"," ",793],["T_BOOLEAN_OR","||",793],["T_WHITESPACE"," ",793],["T_VARIABLE","$previouslyAppliedTaxes",793],"[",["T_VARIABLE","$row",793],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",793],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'amount'",793],"]",")",["T_WHITESPACE"," ",793],"{",["T_WHITESPACE","\n                ",793],["T_VARIABLE","$previouslyAppliedTaxes",794],"[",["T_VARIABLE","$row",794],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",794],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'amount'",794],"]",["T_WHITESPACE"," ",794],["T_PLUS_EQUAL","+=",794],["T_WHITESPACE"," ",794],["T_VARIABLE","$appliedAmount",794],";",["T_WHITESPACE","\n                ",794],["T_VARIABLE","$previouslyAppliedTaxes",795],"[",["T_VARIABLE","$row",795],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",795],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",795],"]",["T_WHITESPACE"," ",795],["T_PLUS_EQUAL","+=",795],["T_WHITESPACE"," ",795],["T_VARIABLE","$baseAppliedAmount",795],";",["T_WHITESPACE","\n            ",795],"}",["T_WHITESPACE"," ",796],["T_ELSE","else",796],["T_WHITESPACE"," ",796],"{",["T_WHITESPACE","\n                ",796],["T_UNSET","unset",797],"(",["T_VARIABLE","$previouslyAppliedTaxes",797],"[",["T_VARIABLE","$row",797],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",797],"]","]",")",";",["T_WHITESPACE","\n            ",797],"}",["T_WHITESPACE","\n        ",798],"}",["T_WHITESPACE","\n        ",799],["T_VARIABLE","$total",800],["T_OBJECT_OPERATOR","->",800],["T_STRING","setAppliedTaxes",800],"(",["T_VARIABLE","$previouslyAppliedTaxes",800],")",";",["T_WHITESPACE","\n    ",800],"}",["T_WHITESPACE","\n\n    ",801],["T_DOC_COMMENT","\/**\n     * Determine whether to include shipping in tax calculation\n     *\n     * @return bool\n     *\/",803],["T_WHITESPACE","\n    ",807],["T_PROTECTED","protected",808],["T_WHITESPACE"," ",808],["T_FUNCTION","function",808],["T_WHITESPACE"," ",808],["T_STRING","includeShipping",808],"(",")",["T_WHITESPACE","\n    ",808],"{",["T_WHITESPACE","\n        ",809],["T_RETURN","return",810],["T_WHITESPACE"," ",810],["T_STRING","false",810],";",["T_WHITESPACE","\n    ",810],"}",["T_WHITESPACE","\n\n    ",811],["T_DOC_COMMENT","\/**\n     * Determine whether to include item in tax calculation\n     *\n     * @return bool\n     *\/",813],["T_WHITESPACE","\n    ",817],["T_PROTECTED","protected",818],["T_WHITESPACE"," ",818],["T_FUNCTION","function",818],["T_WHITESPACE"," ",818],["T_STRING","includeItems",818],"(",")",["T_WHITESPACE","\n    ",818],"{",["T_WHITESPACE","\n        ",819],["T_RETURN","return",820],["T_WHITESPACE"," ",820],["T_STRING","false",820],";",["T_WHITESPACE","\n    ",820],"}",["T_WHITESPACE","\n\n    ",821],["T_DOC_COMMENT","\/**\n     * Determine whether to include item in tax calculation\n     *\n     * @return bool\n     *\/",823],["T_WHITESPACE","\n    ",827],["T_PROTECTED","protected",828],["T_WHITESPACE"," ",828],["T_FUNCTION","function",828],["T_WHITESPACE"," ",828],["T_STRING","includeExtraTax",828],"(",")",["T_WHITESPACE","\n    ",828],"{",["T_WHITESPACE","\n        ",829],["T_RETURN","return",830],["T_WHITESPACE"," ",830],["T_STRING","false",830],";",["T_WHITESPACE","\n    ",830],"}",["T_WHITESPACE","\n\n    ",831],["T_DOC_COMMENT","\/**\n     * Determine whether to save applied tax in address\n     *\n     * @return bool\n     *\/",833],["T_WHITESPACE","\n    ",837],["T_PROTECTED","protected",838],["T_WHITESPACE"," ",838],["T_FUNCTION","function",838],["T_WHITESPACE"," ",838],["T_STRING","saveAppliedTaxes",838],"(",")",["T_WHITESPACE","\n    ",838],"{",["T_WHITESPACE","\n        ",839],["T_RETURN","return",840],["T_WHITESPACE"," ",840],["T_STRING","false",840],";",["T_WHITESPACE","\n    ",840],"}",["T_WHITESPACE","\n\n    ",841],["T_DOC_COMMENT","\/**\n     * Increment and return counter. This function is intended to be used to generate temporary\n     * id for an item.\n     *\n     * @return int\n     *\/",843],["T_WHITESPACE","\n    ",848],["T_PROTECTED","protected",849],["T_WHITESPACE"," ",849],["T_FUNCTION","function",849],["T_WHITESPACE"," ",849],["T_STRING","getNextIncrement",849],"(",")",["T_WHITESPACE","\n    ",849],"{",["T_WHITESPACE","\n        ",850],["T_RETURN","return",851],["T_WHITESPACE"," ",851],["T_INC","++",851],["T_VARIABLE","$this",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","counter",851],";",["T_WHITESPACE","\n    ",851],"}",["T_WHITESPACE","\n",852],"}",["T_WHITESPACE","\n",853]]