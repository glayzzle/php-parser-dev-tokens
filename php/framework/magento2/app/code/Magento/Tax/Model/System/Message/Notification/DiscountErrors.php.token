[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tax",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","System",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Message",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Notification",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * This class allows to display notification in the admin panel about possible discount errors.\n *\n * Discount errors may be caused by tax settings misconfiguration.\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","DiscountErrors",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Tax",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","System",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Message",13],["T_NS_SEPARATOR","\\",13],["T_STRING","NotificationInterface",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PRIVATE","private",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$storeManager",18],";",["T_WHITESPACE","\n\n    ",18],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\UrlInterface\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_PRIVATE","private",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$urlBuilder",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Model\\Config\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_PRIVATE","private",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$taxConfig",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Websites with invalid discount settings\n     *\n     * @var array\n     *\/",30],["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$storesWithInvalidSettings",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Initialize dependencies\n     *\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Framework\\UrlInterface $urlBuilder\n     * @param \\Magento\\Tax\\Model\\Config $taxConfig\n     *\/",37],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","__construct",44],"(",["T_WHITESPACE","\n        ",44],["T_NS_SEPARATOR","\\",45],["T_STRING","Magento",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Store",45],["T_NS_SEPARATOR","\\",45],["T_STRING","Model",45],["T_NS_SEPARATOR","\\",45],["T_STRING","StoreManagerInterface",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$storeManager",45],",",["T_WHITESPACE","\n        ",45],["T_NS_SEPARATOR","\\",46],["T_STRING","Magento",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Framework",46],["T_NS_SEPARATOR","\\",46],["T_STRING","UrlInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$urlBuilder",46],",",["T_WHITESPACE","\n        ",46],["T_NS_SEPARATOR","\\",47],["T_STRING","Magento",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Tax",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Model",47],["T_NS_SEPARATOR","\\",47],["T_STRING","Config",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$taxConfig",47],["T_WHITESPACE","\n    ",47],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","storeManager",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$storeManager",49],";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","urlBuilder",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$urlBuilder",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","taxConfig",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$taxConfig",51],";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     * @codeCoverageIgnore\n     *\/",54],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","getIdentity",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_RETURN","return",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'TAX_NOTIFICATION_DISCOUNT_ERRORS'",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",63],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","isDisplayed",66],"(",")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(","!",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","taxConfig",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","isWrongDiscountSettingsIgnored",68],"(",")",["T_WHITESPACE"," ",68],["T_BOOLEAN_AND","&&",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getStoresWithWrongSettings",68],"(",")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_STRING","true",69],";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n        ",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_STRING","false",71],";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",74],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","getText",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$messageDetails",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","''",79],";",["T_WHITESPACE","\n\n        ",79],["T_IF","if",81],["T_WHITESPACE"," ",81],"(","!",["T_EMPTY","empty",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getStoresWithWrongSettings",81],"(",")",")",["T_WHITESPACE"," ",81],["T_BOOLEAN_AND","&&",81],["T_WHITESPACE"," ",81],"!",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","taxConfig",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","isWrongDiscountSettingsIgnored",81],"(",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$messageDetails",82],["T_WHITESPACE"," ",82],["T_CONCAT_EQUAL",".=",82],["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'<strong>'",82],";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$messageDetails",83],["T_WHITESPACE"," ",83],["T_CONCAT_EQUAL",".=",83],["T_WHITESPACE"," ",83],["T_STRING","__",83],"(",["T_CONSTANT_ENCAPSED_STRING","'With customer tax applied \u00e2\u0080\u009cBefore Discount\u00e2\u0080\u009d, the final discount calculation may not match customers\u00e2\u0080\u0099 expectations. '",83],")",";",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$messageDetails",84],["T_WHITESPACE"," ",84],["T_CONCAT_EQUAL",".=",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'<\/strong><p>'",84],";",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$messageDetails",85],["T_WHITESPACE"," ",85],["T_CONCAT_EQUAL",".=",85],["T_WHITESPACE"," ",85],["T_STRING","__",85],"(",["T_CONSTANT_ENCAPSED_STRING","'Store(s) affected: '",85],")",";",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$messageDetails",86],["T_WHITESPACE"," ",86],["T_CONCAT_EQUAL",".=",86],["T_WHITESPACE"," ",86],["T_STRING","implode",86],"(",["T_CONSTANT_ENCAPSED_STRING","', '",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getStoresWithWrongSettings",86],"(",")",")",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$messageDetails",87],["T_WHITESPACE"," ",87],["T_CONCAT_EQUAL",".=",87],["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'<\/p><p>'",87],";",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$messageDetails",88],["T_WHITESPACE"," ",88],["T_CONCAT_EQUAL",".=",88],["T_WHITESPACE"," ",88],["T_STRING","__",88],"(",["T_WHITESPACE","\n                ",88],["T_CONSTANT_ENCAPSED_STRING","'Click on the link to <a href=\"%1\">ignore this notification<\/a>'",89],",",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","urlBuilder",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getUrl",90],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/tax\/ignoreTaxNotification'",90],",",["T_WHITESPACE"," ",90],"[",["T_CONSTANT_ENCAPSED_STRING","'section'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'discount'",90],"]",")",["T_WHITESPACE","\n            ",90],")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$messageDetails",92],["T_WHITESPACE"," ",92],["T_CONCAT_EQUAL",".=",92],["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","\"<\/p>\"",92],";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n        \n        ",93],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$messageDetails",95],";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     * @codeCoverageIgnore\n     *\/",98],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","getSeverity",102],"(",")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_RETURN","return",104],["T_WHITESPACE"," ",104],["T_STRING","self",104],["T_DOUBLE_COLON","::",104],["T_STRING","SEVERITY_CRITICAL",104],";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Check if tax discount settings are compatible\n     *\n     * Matrix for invalid discount settings is as follows:\n     *      Before Discount \/ Excluding Tax\n     *      Before Discount \/ Including Tax\n     *\n     * @param null|int|bool|string|\\Magento\\Store\\Model\\Store $store $store\n     * @return bool\n     *\/",107],["T_WHITESPACE","\n    ",116],["T_PRIVATE","private",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","checkSettings",117],"(",["T_VARIABLE","$store",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","null",117],")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","taxConfig",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","applyTaxAfterDiscount",119],"(",["T_VARIABLE","$store",119],")",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Return list of store names where tax discount settings are compatible.\n     * Return true if settings are wrong for default store.\n     *\n     * @return array\n     *\/",122],["T_WHITESPACE","\n    ",127],["T_PRIVATE","private",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","getStoresWithWrongSettings",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_STRING","null",130],["T_WHITESPACE"," ",130],["T_IS_NOT_IDENTICAL","!==",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","storesWithInvalidSettings",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","storesWithInvalidSettings",131],";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","storesWithInvalidSettings",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],"[","]",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$storeCollection",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","storeManager",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getStores",134],"(",["T_STRING","true",134],")",";",["T_WHITESPACE","\n        ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$storeCollection",135],["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$store",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(","!",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","checkSettings",136],"(",["T_VARIABLE","$store",136],")",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$website",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$store",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getWebsite",137],"(",")",";",["T_WHITESPACE","\n                ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","storesWithInvalidSettings",138],"[","]",["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$website",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getName",138],"(",")",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","' ('",138],["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$store",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getName",138],"(",")",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","')'",138],";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","storesWithInvalidSettings",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n",142],"}",["T_WHITESPACE","\n",143]]