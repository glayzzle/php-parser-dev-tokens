[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Tax",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Calculation",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Customer",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AddressInterface",8],["T_WHITESPACE"," ",8],["T_AS","as",8],["T_WHITESPACE"," ",8],["T_STRING","CustomerAddress",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Tax",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","AppliedTaxInterfaceFactory",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Tax",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Data",10],["T_NS_SEPARATOR","\\",10],["T_STRING","AppliedTaxRateInterfaceFactory",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Tax",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","QuoteDetailsItemInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Tax",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Data",12],["T_NS_SEPARATOR","\\",12],["T_STRING","TaxDetailsItemInterfaceFactory",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Tax",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Data",13],["T_NS_SEPARATOR","\\",13],["T_STRING","TaxDetailsItemInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Tax",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Api",14],["T_NS_SEPARATOR","\\",14],["T_STRING","TaxClassManagementInterface",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Tax",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Calculation",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",17],["T_WHITESPACE","\n",19],["T_ABSTRACT","abstract",20],["T_WHITESPACE"," ",20],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","AbstractCalculator",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_COMMENT","\/**#@+\n     * Constants for delta rounding key\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_CONST","const",25],["T_WHITESPACE"," ",25],["T_STRING","KEY_REGULAR_DELTA_ROUNDING",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'regular'",25],";",["T_WHITESPACE","\n\n    ",25],["T_CONST","const",27],["T_WHITESPACE"," ",27],["T_STRING","KEY_APPLIED_TAX_DELTA_ROUNDING",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'applied_tax_amount'",27],";",["T_WHITESPACE","\n\n    ",27],["T_CONST","const",29],["T_WHITESPACE"," ",29],["T_STRING","KEY_TAX_BEFORE_DISCOUNT_DELTA_ROUNDING",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'tax_before_discount'",29],";",["T_WHITESPACE","\n    ",29],["T_COMMENT","\/**#@-*\/",30],["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Tax details item data object factory\n     *\n     * @var TaxDetailsItemInterfaceFactory\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$taxDetailsItemDataObjectFactory",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Tax calculation tool\n     *\n     * @var Calculation\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$calculationTool",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Store id\n     *\n     * @var int\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$storeId",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Customer tax class id\n     *\n     * @var int\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$customerTaxClassId",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Customer id\n     *\n     * @var int\n     *\/",60],["T_WHITESPACE","\n    ",64],["T_PROTECTED","protected",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$customerId",65],";",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Shipping Address\n     *\n     * @var CustomerAddress\n     *\/",67],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$shippingAddress",72],";",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Billing Address\n     *\n     * @var CustomerAddress\n     *\/",74],["T_WHITESPACE","\n    ",78],["T_PROTECTED","protected",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$billingAddress",79],";",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var \\Magento\\Tax\\Model\\Config\n     *\/",81],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$config",86],";",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Address rate request\n     *\n     * Request object contain:\n     *  country_id (->getCountryId())\n     *  region_id (->getRegionId())\n     *  postcode (->getPostcode())\n     *  customer_class_id (->getCustomerClassId())\n     *  store (->getStore())\n     *\n     * @var \\Magento\\Framework\\DataObject\n     *\/",88],["T_WHITESPACE","\n    ",99],["T_PRIVATE","private",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$addressRateRequest",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","null",100],";",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * Rounding deltas for prices\n     *\n     * @var string[]\n     * example:\n     *  [\n     *      'type' => [\n     *          'rate' => 'rounding delta',\n     *      ],\n     *  ]\n     *\/",102],["T_WHITESPACE","\n    ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$roundingDeltas",113],";",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Tax Class Service\n     *\n     * @var TaxClassManagementInterface\n     *\/",115],["T_WHITESPACE","\n    ",119],["T_PROTECTED","protected",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$taxClassManagement",120],";",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * @var AppliedTaxInterfaceFactory\n     *\/",122],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$appliedTaxDataObjectFactory",125],";",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * @var AppliedTaxRateInterfaceFactory\n     *\/",127],["T_WHITESPACE","\n    ",129],["T_PROTECTED","protected",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$appliedTaxRateDataObjectFactory",130],";",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param TaxClassManagementInterface $taxClassService\n     * @param TaxDetailsItemInterfaceFactory $taxDetailsItemDataObjectFactory\n     * @param AppliedTaxInterfaceFactory $appliedTaxDataObjectFactory\n     * @param AppliedTaxRateInterfaceFactory $appliedTaxRateDataObjectFactory\n     * @param Calculation $calculationTool\n     * @param \\Magento\\Tax\\Model\\Config $config\n     * @param int $storeId\n     * @param \\Magento\\Framework\\DataObject $addressRateRequest\n     *\/",132],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","__construct",144],"(",["T_WHITESPACE","\n        ",144],["T_STRING","TaxClassManagementInterface",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$taxClassService",145],",",["T_WHITESPACE","\n        ",145],["T_STRING","TaxDetailsItemInterfaceFactory",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$taxDetailsItemDataObjectFactory",146],",",["T_WHITESPACE","\n        ",146],["T_STRING","AppliedTaxInterfaceFactory",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$appliedTaxDataObjectFactory",147],",",["T_WHITESPACE","\n        ",147],["T_STRING","AppliedTaxRateInterfaceFactory",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$appliedTaxRateDataObjectFactory",148],",",["T_WHITESPACE","\n        ",148],["T_STRING","Calculation",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$calculationTool",149],",",["T_WHITESPACE","\n        ",149],["T_NS_SEPARATOR","\\",150],["T_STRING","Magento",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Tax",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Model",150],["T_NS_SEPARATOR","\\",150],["T_STRING","Config",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$config",150],",",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$storeId",151],",",["T_WHITESPACE","\n        ",151],["T_NS_SEPARATOR","\\",152],["T_STRING","Magento",152],["T_NS_SEPARATOR","\\",152],["T_STRING","Framework",152],["T_NS_SEPARATOR","\\",152],["T_STRING","DataObject",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$addressRateRequest",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_STRING","null",152],["T_WHITESPACE","\n    ",152],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","taxClassManagement",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$taxClassService",154],";",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","taxDetailsItemDataObjectFactory",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$taxDetailsItemDataObjectFactory",155],";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","appliedTaxDataObjectFactory",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$appliedTaxDataObjectFactory",156],";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","appliedTaxRateDataObjectFactory",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$appliedTaxRateDataObjectFactory",157],";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","calculationTool",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$calculationTool",158],";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","config",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$config",159],";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","storeId",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$storeId",160],";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","addressRateRequest",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$addressRateRequest",161],";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Set billing address\n     *\n     * @codeCoverageIgnoreStart\n     * @param CustomerAddress $billingAddress\n     * @return void\n     *\/",164],["T_WHITESPACE","\n    ",170],["T_PUBLIC","public",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","setBillingAddress",171],"(",["T_STRING","CustomerAddress",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$billingAddress",171],")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","billingAddress",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$billingAddress",173],";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Set shipping address\n     *\n     * @param CustomerAddress $shippingAddress\n     * @return void\n     *\/",176],["T_WHITESPACE","\n    ",181],["T_PUBLIC","public",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","setShippingAddress",182],"(",["T_STRING","CustomerAddress",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$shippingAddress",182],")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","shippingAddress",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$shippingAddress",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_DOC_COMMENT","\/**\n     * Set customer tax class id\n     *\n     * @param int $customerTaxClassId\n     * @return void\n     *\/",187],["T_WHITESPACE","\n    ",192],["T_PUBLIC","public",193],["T_WHITESPACE"," ",193],["T_FUNCTION","function",193],["T_WHITESPACE"," ",193],["T_STRING","setCustomerTaxClassId",193],"(",["T_VARIABLE","$customerTaxClassId",193],")",["T_WHITESPACE","\n    ",193],"{",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","customerTaxClassId",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$customerTaxClassId",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Set customer id\n     *\n     * @param int $customerId\n     * @return void\n     *\/",198],["T_WHITESPACE","\n    ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","setCustomerId",204],"(",["T_VARIABLE","$customerId",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","customerId",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$customerId",206],";",["T_WHITESPACE","\n    ",206],"}",["T_WHITESPACE","\n    ",207],["T_COMMENT","\/\/ @codeCoverageIgnoreEnd\n",208],["T_WHITESPACE","\n    ",209],["T_DOC_COMMENT","\/**\n     * Calculate tax details for quote item with given quantity\n     *\n     * @param QuoteDetailsItemInterface $item\n     * @param int $quantity\n     * @param bool $round\n     * @return TaxDetailsItemInterface\n     *\/",210],["T_WHITESPACE","\n    ",217],["T_PUBLIC","public",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","calculate",218],"(",["T_STRING","QuoteDetailsItemInterface",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$item",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$quantity",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$round",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","true",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$item",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getIsTaxIncluded",220],"(",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","calculateWithTaxInPrice",221],"(",["T_VARIABLE","$item",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$quantity",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$round",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE"," ",222],["T_ELSE","else",222],["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","calculateWithTaxNotInPrice",223],"(",["T_VARIABLE","$item",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$quantity",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$round",223],")",";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * Calculate tax details for quote item with tax in price with given quantity\n     *\n     * @param QuoteDetailsItemInterface $item\n     * @param int $quantity\n     * @param bool $round\n     * @return TaxDetailsItemInterface\n     *\/",227],["T_WHITESPACE","\n    ",234],["T_ABSTRACT","abstract",235],["T_WHITESPACE"," ",235],["T_PROTECTED","protected",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","calculateWithTaxInPrice",235],"(",["T_STRING","QuoteDetailsItemInterface",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$item",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$quantity",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$round",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_STRING","true",235],")",";",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Calculate tax details for quote item with tax not in price with given quantity\n     *\n     * @param QuoteDetailsItemInterface $item\n     * @param int $quantity\n     * @param bool $round\n     * @return TaxDetailsItemInterface\n     *\/",237],["T_WHITESPACE","\n    ",244],["T_ABSTRACT","abstract",245],["T_WHITESPACE"," ",245],["T_PROTECTED","protected",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","calculateWithTaxNotInPrice",245],"(",["T_STRING","QuoteDetailsItemInterface",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$item",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$quantity",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$round",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_STRING","true",245],")",";",["T_WHITESPACE","\n\n    ",245],["T_DOC_COMMENT","\/**\n     * Get address rate request\n     *\n     * Request object contain:\n     *  country_id (->getCountryId())\n     *  region_id (->getRegionId())\n     *  postcode (->getPostcode())\n     *  customer_class_id (->getCustomerClassId())\n     *  store (->getStore())\n     *\n     * @return \\Magento\\Framework\\DataObject\n     *\/",247],["T_WHITESPACE","\n    ",258],["T_PROTECTED","protected",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","getAddressRateRequest",259],"(",")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_STRING","null",261],["T_WHITESPACE"," ",261],["T_IS_EQUAL","==",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","addressRateRequest",261],")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","addressRateRequest",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","calculationTool",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getRateRequest",262],"(",["T_WHITESPACE","\n                ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","shippingAddress",263],",",["T_WHITESPACE","\n                ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","billingAddress",264],",",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","customerTaxClassId",265],",",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","storeId",266],",",["T_WHITESPACE","\n                ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","customerId",267],["T_WHITESPACE","\n            ",267],")",";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE","\n        ",269],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","addressRateRequest",270],";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * Check if tax rate is same as store tax rate\n     *\n     * @param float $rate\n     * @param float $storeRate\n     * @return bool\n     *\/",273],["T_WHITESPACE","\n    ",279],["T_PROTECTED","protected",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","isSameRateAsStore",280],"(",["T_VARIABLE","$rate",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$storeRate",280],")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_BOOL_CAST","(bool)",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","config",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","crossBorderTradeEnabled",282],"(",["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","storeId",282],")",")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_RETURN","return",283],["T_WHITESPACE"," ",283],["T_STRING","true",283],";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE"," ",284],["T_ELSE","else",284],["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_RETURN","return",285],["T_WHITESPACE"," ",285],"(",["T_STRING","abs",285],"(",["T_VARIABLE","$rate",285],["T_WHITESPACE"," ",285],"-",["T_WHITESPACE"," ",285],["T_VARIABLE","$storeRate",285],")",["T_WHITESPACE"," ",285],"<",["T_WHITESPACE"," ",285],["T_DNUMBER","0.00001",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Create AppliedTax data object based applied tax rates and tax amount\n     *\n     * @param float $rowTax\n     * @param array $appliedRate\n     * example:\n     *  [\n     *      'id' => 'id',\n     *      'percent' => 7.5,\n     *      'rates' => [\n     *          'code' => 'code',\n     *          'title' => 'title',\n     *          'percent' => 5.3,\n     *      ],\n     *  ]\n     * @return \\Magento\\Tax\\Api\\Data\\AppliedTaxInterface\n     *\/",289],["T_WHITESPACE","\n    ",305],["T_PROTECTED","protected",306],["T_WHITESPACE"," ",306],["T_FUNCTION","function",306],["T_WHITESPACE"," ",306],["T_STRING","getAppliedTax",306],"(",["T_VARIABLE","$rowTax",306],",",["T_WHITESPACE"," ",306],["T_VARIABLE","$appliedRate",306],")",["T_WHITESPACE","\n    ",306],"{",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$appliedTaxDataObject",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","appliedTaxDataObjectFactory",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","create",308],"(",")",";",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$appliedTaxDataObject",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","setAmount",309],"(",["T_VARIABLE","$rowTax",309],")",";",["T_WHITESPACE","\n        ",309],["T_VARIABLE","$appliedTaxDataObject",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","setPercent",310],"(",["T_VARIABLE","$appliedRate",310],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",310],"]",")",";",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$appliedTaxDataObject",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setTaxRateKey",311],"(",["T_VARIABLE","$appliedRate",311],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",311],"]",")",";",["T_WHITESPACE","\n\n        ",311],["T_DOC_COMMENT","\/** @var  \\Magento\\Tax\\Api\\Data\\AppliedTaxRateInterface[] $rateDataObjects *\/",313],["T_WHITESPACE","\n        ",313],["T_VARIABLE","$rateDataObjects",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],"[","]",";",["T_WHITESPACE","\n        ",314],["T_FOREACH","foreach",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$appliedRate",315],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",315],"]",["T_WHITESPACE"," ",315],["T_AS","as",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$rate",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_COMMENT","\/\/Skipped position, priority and rule_id\n",316],["T_WHITESPACE","            ",317],["T_VARIABLE","$rateDataObjects",317],"[",["T_VARIABLE","$rate",317],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",317],"]","]",["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","appliedTaxRateDataObjectFactory",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","create",317],"(",")",["T_WHITESPACE","\n                ",317],["T_OBJECT_OPERATOR","->",318],["T_STRING","setPercent",318],"(",["T_VARIABLE","$rate",318],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",318],"]",")",["T_WHITESPACE","\n                ",318],["T_OBJECT_OPERATOR","->",319],["T_STRING","setCode",319],"(",["T_VARIABLE","$rate",319],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",319],"]",")",["T_WHITESPACE","\n                ",319],["T_OBJECT_OPERATOR","->",320],["T_STRING","setTitle",320],"(",["T_VARIABLE","$rate",320],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",320],"]",")",";",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE","\n        ",321],["T_VARIABLE","$appliedTaxDataObject",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","setRates",322],"(",["T_VARIABLE","$rateDataObjects",322],")",";",["T_WHITESPACE","\n        ",322],["T_RETURN","return",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$appliedTaxDataObject",323],";",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n\n    ",324],["T_DOC_COMMENT","\/**\n     * Create AppliedTax data object based on applied tax rates and tax amount\n     *\n     * @param float $rowTax\n     * @param float $totalTaxRate\n     * @param array $appliedRates May contain multiple tax rates when catalog price includes tax\n     * example:\n     *  [\n     *      [\n     *          'id' => 'id1',\n     *          'percent' => 7.5,\n     *          'rates' => [\n     *              'code' => 'code1',\n     *              'title' => 'title1',\n     *              'percent' => 5.3,\n     *          ],\n     *      ],\n     *      [\n     *          'id' => 'id2',\n     *          'percent' => 8.5,\n     *          'rates' => [\n     *              'code' => 'code2',\n     *              'title' => 'title2',\n     *              'percent' => 7.3,\n     *          ],\n     *      ],\n     *  ]\n     * @return \\Magento\\Tax\\Api\\Data\\AppliedTaxInterface[]\n     *\/",326],["T_WHITESPACE","\n    ",354],["T_PROTECTED","protected",355],["T_WHITESPACE"," ",355],["T_FUNCTION","function",355],["T_WHITESPACE"," ",355],["T_STRING","getAppliedTaxes",355],"(",["T_VARIABLE","$rowTax",355],",",["T_WHITESPACE"," ",355],["T_VARIABLE","$totalTaxRate",355],",",["T_WHITESPACE"," ",355],["T_VARIABLE","$appliedRates",355],")",["T_WHITESPACE","\n    ",355],"{",["T_WHITESPACE","\n        ",356],["T_DOC_COMMENT","\/** @var \\Magento\\Tax\\Api\\Data\\AppliedTaxInterface[] $appliedTaxes *\/",357],["T_WHITESPACE","\n        ",357],["T_VARIABLE","$appliedTaxes",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],"[","]",";",["T_WHITESPACE","\n        ",358],["T_VARIABLE","$totalAppliedAmount",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_LNUMBER","0",359],";",["T_WHITESPACE","\n        ",359],["T_FOREACH","foreach",360],["T_WHITESPACE"," ",360],"(",["T_VARIABLE","$appliedRates",360],["T_WHITESPACE"," ",360],["T_AS","as",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$appliedRate",360],")",["T_WHITESPACE"," ",360],"{",["T_WHITESPACE","\n            ",360],["T_IF","if",361],["T_WHITESPACE"," ",361],"(",["T_VARIABLE","$appliedRate",361],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",361],"]",["T_WHITESPACE"," ",361],["T_IS_EQUAL","==",361],["T_WHITESPACE"," ",361],["T_LNUMBER","0",361],")",["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n                ",361],["T_CONTINUE","continue",362],";",["T_WHITESPACE","\n            ",362],"}",["T_WHITESPACE","\n\n            ",363],["T_VARIABLE","$appliedAmount",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$rowTax",365],["T_WHITESPACE"," ",365],"\/",["T_WHITESPACE"," ",365],["T_VARIABLE","$totalTaxRate",365],["T_WHITESPACE"," ",365],"*",["T_WHITESPACE"," ",365],["T_VARIABLE","$appliedRate",365],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",365],"]",";",["T_WHITESPACE","\n            ",365],["T_COMMENT","\/\/Use delta rounding to split tax amounts for each tax rates between items\n",366],["T_WHITESPACE","            ",367],["T_VARIABLE","$appliedAmount",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","deltaRound",367],"(",["T_WHITESPACE","\n                ",367],["T_VARIABLE","$appliedAmount",368],",",["T_WHITESPACE","\n                ",368],["T_VARIABLE","$appliedRate",369],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",369],"]",",",["T_WHITESPACE","\n                ",369],["T_STRING","true",370],",",["T_WHITESPACE","\n                ",370],["T_STRING","self",371],["T_DOUBLE_COLON","::",371],["T_STRING","KEY_APPLIED_TAX_DELTA_ROUNDING",371],["T_WHITESPACE","\n            ",371],")",";",["T_WHITESPACE","\n            ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(",["T_VARIABLE","$totalAppliedAmount",373],["T_WHITESPACE"," ",373],"+",["T_WHITESPACE"," ",373],["T_VARIABLE","$appliedAmount",373],["T_WHITESPACE"," ",373],">",["T_WHITESPACE"," ",373],["T_VARIABLE","$rowTax",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_VARIABLE","$appliedAmount",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$rowTax",374],["T_WHITESPACE"," ",374],"-",["T_WHITESPACE"," ",374],["T_VARIABLE","$totalAppliedAmount",374],";",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$totalAppliedAmount",376],["T_WHITESPACE"," ",376],["T_PLUS_EQUAL","+=",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$appliedAmount",376],";",["T_WHITESPACE","\n\n            ",376],["T_VARIABLE","$appliedTaxDataObject",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","appliedTaxDataObjectFactory",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","create",378],"(",")",";",["T_WHITESPACE","\n            ",378],["T_VARIABLE","$appliedTaxDataObject",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","setAmount",379],"(",["T_VARIABLE","$appliedAmount",379],")",";",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$appliedTaxDataObject",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","setPercent",380],"(",["T_VARIABLE","$appliedRate",380],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",380],"]",")",";",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$appliedTaxDataObject",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","setTaxRateKey",381],"(",["T_VARIABLE","$appliedRate",381],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",381],"]",")",";",["T_WHITESPACE","\n\n            ",381],["T_DOC_COMMENT","\/** @var  \\Magento\\Tax\\Api\\Data\\AppliedTaxRateInterface[] $rateDataObjects *\/",383],["T_WHITESPACE","\n            ",383],["T_VARIABLE","$rateDataObjects",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],"[","]",";",["T_WHITESPACE","\n            ",384],["T_FOREACH","foreach",385],["T_WHITESPACE"," ",385],"(",["T_VARIABLE","$appliedRate",385],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",385],"]",["T_WHITESPACE"," ",385],["T_AS","as",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$rate",385],")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n                ",385],["T_COMMENT","\/\/Skipped position, priority and rule_id\n",386],["T_WHITESPACE","                ",387],["T_VARIABLE","$rateDataObjects",387],"[",["T_VARIABLE","$rate",387],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",387],"]","]",["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","appliedTaxRateDataObjectFactory",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","create",387],"(",")",["T_WHITESPACE","\n                    ",387],["T_OBJECT_OPERATOR","->",388],["T_STRING","setPercent",388],"(",["T_VARIABLE","$rate",388],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",388],"]",")",["T_WHITESPACE","\n                    ",388],["T_OBJECT_OPERATOR","->",389],["T_STRING","setCode",389],"(",["T_VARIABLE","$rate",389],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",389],"]",")",["T_WHITESPACE","\n                    ",389],["T_OBJECT_OPERATOR","->",390],["T_STRING","setTitle",390],"(",["T_VARIABLE","$rate",390],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",390],"]",")",";",["T_WHITESPACE","\n            ",390],"}",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$appliedTaxDataObject",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","setRates",392],"(",["T_VARIABLE","$rateDataObjects",392],")",";",["T_WHITESPACE","\n            ",392],["T_VARIABLE","$appliedTaxes",393],"[",["T_VARIABLE","$appliedTaxDataObject",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getTaxRateKey",393],"(",")","]",["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_VARIABLE","$appliedTaxDataObject",393],";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE","\n\n        ",394],["T_RETURN","return",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$appliedTaxes",396],";",["T_WHITESPACE","\n    ",396],"}",["T_WHITESPACE","\n\n    ",397],["T_DOC_COMMENT","\/**\n     * Round price based on previous rounding operation delta\n     *\n     * @param float $price\n     * @param string $rate\n     * @param bool $direction\n     * @param string $type\n     * @param bool $round\n     * @return float\n     *\/",399],["T_WHITESPACE","\n    ",408],["T_PROTECTED","protected",409],["T_WHITESPACE"," ",409],["T_FUNCTION","function",409],["T_WHITESPACE"," ",409],["T_STRING","deltaRound",409],"(",["T_VARIABLE","$price",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$rate",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$direction",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$type",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","self",409],["T_DOUBLE_COLON","::",409],["T_STRING","KEY_REGULAR_DELTA_ROUNDING",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$round",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","true",409],")",["T_WHITESPACE","\n    ",409],"{",["T_WHITESPACE","\n        ",410],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_VARIABLE","$price",411],")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$rate",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING_CAST","(string)",412],["T_VARIABLE","$rate",412],";",["T_WHITESPACE","\n            ",412],["T_VARIABLE","$type",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$type",413],["T_WHITESPACE"," ",413],".",["T_WHITESPACE"," ",413],["T_VARIABLE","$direction",413],";",["T_WHITESPACE","\n            ",413],["T_COMMENT","\/\/ initialize the delta to a small number to avoid non-deterministic behavior with rounding of 0.5\n",414],["T_WHITESPACE","            ",415],["T_VARIABLE","$delta",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_ISSET","isset",415],"(",["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","roundingDeltas",415],"[",["T_VARIABLE","$type",415],"]","[",["T_VARIABLE","$rate",415],"]",")",["T_WHITESPACE"," ",415],"?",["T_WHITESPACE","\n                ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","roundingDeltas",416],"[",["T_VARIABLE","$type",416],"]","[",["T_VARIABLE","$rate",416],"]",["T_WHITESPACE"," ",416],":",["T_WHITESPACE","\n                ",416],["T_DNUMBER","0.000001",417],";",["T_WHITESPACE","\n            ",417],["T_VARIABLE","$price",418],["T_WHITESPACE"," ",418],["T_PLUS_EQUAL","+=",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$delta",418],";",["T_WHITESPACE","\n            ",418],["T_VARIABLE","$roundPrice",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_VARIABLE","$price",419],";",["T_WHITESPACE","\n            ",419],["T_IF","if",420],["T_WHITESPACE"," ",420],"(",["T_VARIABLE","$round",420],")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n                ",420],["T_VARIABLE","$roundPrice",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","calculationTool",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","round",421],"(",["T_VARIABLE","$roundPrice",421],")",";",["T_WHITESPACE","\n            ",421],"}",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","roundingDeltas",423],"[",["T_VARIABLE","$type",423],"]","[",["T_VARIABLE","$rate",423],"]",["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$price",423],["T_WHITESPACE"," ",423],"-",["T_WHITESPACE"," ",423],["T_VARIABLE","$roundPrice",423],";",["T_WHITESPACE","\n            ",423],["T_VARIABLE","$price",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$roundPrice",424],";",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n        ",425],["T_RETURN","return",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$price",426],";",["T_WHITESPACE","\n    ",426],"}",["T_WHITESPACE","\n\n    ",427],["T_DOC_COMMENT","\/**\n     * Given a store price that includes tax at the store rate, this function will back out the store's tax, and add in\n     * the customer's tax.  Returns this new price which is the customer's price including tax.\n     *\n     * @param float $storePriceInclTax\n     * @param float $storeRate\n     * @param float $customerRate\n     * @param boolean $round\n     * @return float\n     *\/",429],["T_WHITESPACE","\n    ",438],["T_PROTECTED","protected",439],["T_WHITESPACE"," ",439],["T_FUNCTION","function",439],["T_WHITESPACE"," ",439],["T_STRING","calculatePriceInclTax",439],"(",["T_VARIABLE","$storePriceInclTax",439],",",["T_WHITESPACE"," ",439],["T_VARIABLE","$storeRate",439],",",["T_WHITESPACE"," ",439],["T_VARIABLE","$customerRate",439],",",["T_WHITESPACE"," ",439],["T_VARIABLE","$round",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_STRING","true",439],")",["T_WHITESPACE","\n    ",439],"{",["T_WHITESPACE","\n        ",440],["T_VARIABLE","$storeTax",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","calculationTool",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","calcTaxAmount",441],"(",["T_VARIABLE","$storePriceInclTax",441],",",["T_WHITESPACE"," ",441],["T_VARIABLE","$storeRate",441],",",["T_WHITESPACE"," ",441],["T_STRING","true",441],",",["T_WHITESPACE"," ",441],["T_STRING","false",441],")",";",["T_WHITESPACE","\n        ",441],["T_VARIABLE","$priceExclTax",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_VARIABLE","$storePriceInclTax",442],["T_WHITESPACE"," ",442],"-",["T_WHITESPACE"," ",442],["T_VARIABLE","$storeTax",442],";",["T_WHITESPACE","\n        ",442],["T_VARIABLE","$customerTax",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","calculationTool",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","calcTaxAmount",443],"(",["T_VARIABLE","$priceExclTax",443],",",["T_WHITESPACE"," ",443],["T_VARIABLE","$customerRate",443],",",["T_WHITESPACE"," ",443],["T_STRING","false",443],",",["T_WHITESPACE"," ",443],["T_STRING","false",443],")",";",["T_WHITESPACE","\n        ",443],["T_VARIABLE","$customerPriceInclTax",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$priceExclTax",444],["T_WHITESPACE"," ",444],"+",["T_WHITESPACE"," ",444],["T_VARIABLE","$customerTax",444],";",["T_WHITESPACE","\n        ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(",["T_VARIABLE","$round",445],")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n            ",445],["T_VARIABLE","$customerPriceInclTax",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","calculationTool",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","round",446],"(",["T_VARIABLE","$customerPriceInclTax",446],")",";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n        ",447],["T_RETURN","return",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$customerPriceInclTax",448],";",["T_WHITESPACE","\n    ",448],"}",["T_WHITESPACE","\n",449],"}",["T_WHITESPACE","\n",450]]