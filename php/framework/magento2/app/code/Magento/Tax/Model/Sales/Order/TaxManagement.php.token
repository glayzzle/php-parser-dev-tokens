[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",6],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Tax",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Sales",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Order",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Exception",10],["T_NS_SEPARATOR","\\",10],["T_STRING","NoSuchEntityException",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Tax",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Data",11],["T_NS_SEPARATOR","\\",11],["T_STRING","OrderTaxDetailsAppliedTaxInterfaceFactory",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","TaxDetailsDataObjectFactory",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Tax",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Data",12],["T_NS_SEPARATOR","\\",12],["T_STRING","OrderTaxDetailsAppliedTaxInterface",12],["T_WHITESPACE"," ",12],["T_AS","as",12],["T_WHITESPACE"," ",12],["T_STRING","AppliedTax",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Tax",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sales",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Order",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Tax",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Sales",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Order",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Tax",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Item",14],";",["T_WHITESPACE","\n\n",14],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","TaxManagement",16],["T_WHITESPACE"," ",16],["T_IMPLEMENTS","implements",16],["T_WHITESPACE"," ",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Tax",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Api",16],["T_NS_SEPARATOR","\\",16],["T_STRING","OrderTaxManagementInterface",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\ResourceModel\\Order\\Tax\\ItemFactory\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$orderItemTaxFactory",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\OrderFactory\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$orderFactory",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsInterfaceFactory\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$orderTaxDetailsDataObjectFactory",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsItemInterfaceFactory\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$itemDataObjectFactory",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @var TaxDetailsDataObjectFactory\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$appliedTaxDataObjectFactory",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Model\\OrderFactory $orderFactory\n     * @param \\Magento\\Sales\\Model\\ResourceModel\\Order\\Tax\\ItemFactory $orderItemTaxFactory\n     * @param \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsInterfaceFactory $orderTaxDetailsDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsItemInterfaceFactory $itemDataObjectFactory\n     * @param TaxDetailsDataObjectFactory $appliedTaxDataObjectFactory\n     *\/",43],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","__construct",50],"(",["T_WHITESPACE","\n        ",50],["T_NS_SEPARATOR","\\",51],["T_STRING","Magento",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Sales",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Model",51],["T_NS_SEPARATOR","\\",51],["T_STRING","OrderFactory",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$orderFactory",51],",",["T_WHITESPACE","\n        ",51],["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Sales",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Model",52],["T_NS_SEPARATOR","\\",52],["T_STRING","ResourceModel",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Order",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Tax",52],["T_NS_SEPARATOR","\\",52],["T_STRING","ItemFactory",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$orderItemTaxFactory",52],",",["T_WHITESPACE","\n        ",52],["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Tax",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Api",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Data",53],["T_NS_SEPARATOR","\\",53],["T_STRING","OrderTaxDetailsInterfaceFactory",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$orderTaxDetailsDataObjectFactory",53],",",["T_WHITESPACE","\n        ",53],["T_NS_SEPARATOR","\\",54],["T_STRING","Magento",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Tax",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Api",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Data",54],["T_NS_SEPARATOR","\\",54],["T_STRING","OrderTaxDetailsItemInterfaceFactory",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$itemDataObjectFactory",54],",",["T_WHITESPACE","\n        ",54],["T_STRING","TaxDetailsDataObjectFactory",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$appliedTaxDataObjectFactory",55],["T_WHITESPACE","\n    ",55],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","orderFactory",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$orderFactory",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","orderItemTaxFactory",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$orderItemTaxFactory",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","orderTaxDetailsDataObjectFactory",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$orderTaxDetailsDataObjectFactory",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","itemDataObjectFactory",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$itemDataObjectFactory",60],";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","appliedTaxDataObjectFactory",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$appliedTaxDataObjectFactory",61],";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Convert applied tax from array to data object\n     *\n     * @param TaxDetailsDataObjectFactory $appliedTaxDataObjectFactory\n     * @param array $itemAppliedTax\n     * @param AppliedTax $existingAppliedTax\n     * @return AppliedTax\n     *\/",64],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","convertToAppliedTaxDataObject",72],"(",["T_WHITESPACE","\n        ",72],["T_STRING","TaxDetailsDataObjectFactory",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$appliedTaxDataObjectFactory",73],",",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$itemAppliedTax",74],",",["T_WHITESPACE","\n        ",74],["T_STRING","AppliedTax",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$existingAppliedTax",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","null",75],["T_WHITESPACE","\n    ",75],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n        ",76],["T_COMMENT","\/\/ if there is an existingAppliedTax, include its amount and baseAmount\n",77],["T_WHITESPACE","        ",78],["T_VARIABLE","$amount",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$baseAmount",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_LNUMBER","0",78],";",["T_WHITESPACE","\n        ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$existingAppliedTax",79],["T_WHITESPACE"," ",79],["T_IS_NOT_IDENTICAL","!==",79],["T_WHITESPACE"," ",79],["T_STRING","null",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$amount",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$existingAppliedTax",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getAmount",80],"(",")",";",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$baseAmount",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$existingAppliedTax",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getBaseAmount",81],"(",")",";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n\n        ",82],["T_RETURN","return",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$appliedTaxDataObjectFactory",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","create",84],"(",")",["T_WHITESPACE","\n            ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","setCode",85],"(",["T_VARIABLE","$itemAppliedTax",85],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",85],"]",")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setTitle",86],"(",["T_VARIABLE","$itemAppliedTax",86],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",86],"]",")",["T_WHITESPACE","\n            ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","setPercent",87],"(",["T_VARIABLE","$itemAppliedTax",87],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_percent'",87],"]",")",["T_WHITESPACE","\n            ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","setAmount",88],"(",["T_VARIABLE","$itemAppliedTax",88],"[",["T_CONSTANT_ENCAPSED_STRING","'real_amount'",88],"]",["T_WHITESPACE"," ",88],"+",["T_WHITESPACE"," ",88],["T_VARIABLE","$amount",88],")",["T_WHITESPACE","\n            ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","setBaseAmount",89],"(",["T_VARIABLE","$itemAppliedTax",89],"[",["T_CONSTANT_ENCAPSED_STRING","'real_base_amount'",89],"]",["T_WHITESPACE"," ",89],"+",["T_WHITESPACE"," ",89],["T_VARIABLE","$baseAmount",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Aggregate item applied taxes to get order applied taxes\n     *\n     * @param TaxDetailsDataObjectFactory $appliedTaxDataObjectFactory\n     * @param \\Magento\\Tax\\Api\\Data\\OrderTaxDetailsItemInterface[] $items\n     * @return AppliedTax[]\n     *\/",92],["T_WHITESPACE","\n    ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","aggregateAppliedTaxes",99],"(",["T_STRING","TaxDetailsDataObjectFactory",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$appliedTaxDataObjectFactory",99],",",["T_WHITESPACE"," ",99],["T_VARIABLE","$items",99],")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$orderAppliedTaxes",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],"[","]",";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$orderAppliedTaxesData",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],"[","]",";",["T_WHITESPACE","\n        ",102],["T_FOREACH","foreach",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$items",103],["T_WHITESPACE"," ",103],["T_AS","as",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$item",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$itemAppliedTaxes",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$item",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getAppliedTaxes",104],"(",")",";",["T_WHITESPACE","\n            ",104],["T_FOREACH","foreach",105],["T_WHITESPACE"," ",105],"(",["T_VARIABLE","$itemAppliedTaxes",105],["T_WHITESPACE"," ",105],["T_AS","as",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$itemAppliedTax",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n                ",105],["T_VARIABLE","$code",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$itemAppliedTax",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getCode",106],"(",")",";",["T_WHITESPACE","\n                ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(","!",["T_ISSET","isset",107],"(",["T_VARIABLE","$orderAppliedTaxesData",107],"[",["T_VARIABLE","$code",107],"]",")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                    ",107],["T_VARIABLE","$orderAppliedTaxesData",108],"[",["T_VARIABLE","$code",108],"]",["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],"[",["T_WHITESPACE","\n                        ",108],["T_STRING","Tax",109],["T_DOUBLE_COLON","::",109],["T_STRING","KEY_CODE",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$code",109],",",["T_WHITESPACE","\n                        ",109],["T_STRING","Tax",110],["T_DOUBLE_COLON","::",110],["T_STRING","KEY_TITLE",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$itemAppliedTax",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getTitle",110],"(",")",",",["T_WHITESPACE","\n                        ",110],["T_STRING","Tax",111],["T_DOUBLE_COLON","::",111],["T_STRING","KEY_PERCENT",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$itemAppliedTax",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getPercent",111],"(",")",",",["T_WHITESPACE","\n                        ",111],["T_STRING","Tax",112],["T_DOUBLE_COLON","::",112],["T_STRING","KEY_AMOUNT",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$itemAppliedTax",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getAmount",112],"(",")",",",["T_WHITESPACE","\n                        ",112],["T_STRING","Tax",113],["T_DOUBLE_COLON","::",113],["T_STRING","KEY_BASE_AMOUNT",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$itemAppliedTax",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getBaseAmount",113],"(",")",",",["T_WHITESPACE","\n                    ",113],"]",";",["T_WHITESPACE","\n                ",114],"}",["T_WHITESPACE"," ",115],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                    ",115],["T_VARIABLE","$orderAppliedTaxesData",116],"[",["T_VARIABLE","$code",116],"]","[",["T_STRING","Tax",116],["T_DOUBLE_COLON","::",116],["T_STRING","KEY_AMOUNT",116],"]",["T_WHITESPACE"," ",116],["T_PLUS_EQUAL","+=",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$itemAppliedTax",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getAmount",116],"(",")",";",["T_WHITESPACE","\n                    ",116],["T_VARIABLE","$orderAppliedTaxesData",117],"[",["T_VARIABLE","$code",117],"]","[",["T_STRING","Tax",117],["T_DOUBLE_COLON","::",117],["T_STRING","KEY_BASE_AMOUNT",117],"]",["T_WHITESPACE"," ",117],["T_PLUS_EQUAL","+=",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$itemAppliedTax",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getBaseAmount",117],"(",")",";",["T_WHITESPACE","\n                ",117],"}",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_FOREACH","foreach",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$orderAppliedTaxesData",121],["T_WHITESPACE"," ",121],["T_AS","as",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$orderAppliedTaxData",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$orderAppliedTaxes",122],"[","]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$appliedTaxDataObjectFactory",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","create",122],"(",")",["T_WHITESPACE","\n                ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","setCode",123],"(",["T_VARIABLE","$orderAppliedTaxData",123],"[",["T_STRING","Tax",123],["T_DOUBLE_COLON","::",123],["T_STRING","KEY_CODE",123],"]",")",["T_WHITESPACE","\n                ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","setTitle",124],"(",["T_VARIABLE","$orderAppliedTaxData",124],"[",["T_STRING","Tax",124],["T_DOUBLE_COLON","::",124],["T_STRING","KEY_TITLE",124],"]",")",["T_WHITESPACE","\n                ",124],["T_OBJECT_OPERATOR","->",125],["T_STRING","setPercent",125],"(",["T_VARIABLE","$orderAppliedTaxData",125],"[",["T_STRING","Tax",125],["T_DOUBLE_COLON","::",125],["T_STRING","KEY_PERCENT",125],"]",")",["T_WHITESPACE","\n                ",125],["T_OBJECT_OPERATOR","->",126],["T_STRING","setAmount",126],"(",["T_VARIABLE","$orderAppliedTaxData",126],"[",["T_STRING","Tax",126],["T_DOUBLE_COLON","::",126],["T_STRING","KEY_AMOUNT",126],"]",")",["T_WHITESPACE","\n                ",126],["T_OBJECT_OPERATOR","->",127],["T_STRING","setBaseAmount",127],"(",["T_VARIABLE","$orderAppliedTaxData",127],"[",["T_STRING","Tax",127],["T_DOUBLE_COLON","::",127],["T_STRING","KEY_BASE_AMOUNT",127],"]",")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$orderAppliedTaxes",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",132],["T_WHITESPACE","\n    ",134],["T_PUBLIC","public",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","getOrderTaxDetails",135],"(",["T_VARIABLE","$orderId",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$order",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","orderFactory",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","create",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","load",137],"(",["T_VARIABLE","$orderId",137],")",";",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_VARIABLE","$order",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_THROW","throw",139],["T_WHITESPACE"," ",139],["T_NEW","new",139],["T_WHITESPACE"," ",139],["T_STRING","NoSuchEntityException",139],"(",["T_WHITESPACE","\n                ",139],["T_STRING","__",140],"(",["T_WHITESPACE","\n                    ",140],["T_CONSTANT_ENCAPSED_STRING","'No such entity with %fieldName = %fieldValue'",141],",",["T_WHITESPACE","\n                    ",141],"[",["T_CONSTANT_ENCAPSED_STRING","'fieldName'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'orderId'",142],",",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'fieldValue'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$orderId",142],"]",["T_WHITESPACE","\n                ",142],")",["T_WHITESPACE","\n            ",143],")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$orderItemAppliedTaxes",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","orderItemTaxFactory",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","create",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","getTaxItemsByOrderId",147],"(",["T_VARIABLE","$orderId",147],")",";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$itemsData",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],"[","]",";",["T_WHITESPACE","\n        ",148],["T_FOREACH","foreach",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$orderItemAppliedTaxes",149],["T_WHITESPACE"," ",149],["T_AS","as",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$itemAppliedTax",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$key",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$itemId",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$associatedItemId",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","null",150],";",["T_WHITESPACE","\n\n            ",150],["T_COMMENT","\/\/group applied taxes by item\n",152],["T_WHITESPACE","            ",153],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_ISSET","isset",153],"(",["T_VARIABLE","$itemAppliedTax",153],"[",["T_CONSTANT_ENCAPSED_STRING","'item_id'",153],"]",")",")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                ",153],["T_COMMENT","\/\/The taxable is a product\n",154],["T_WHITESPACE","                ",155],["T_COMMENT","\/\/Note: the associatedItemId is null\n",155],["T_WHITESPACE","                ",156],["T_VARIABLE","$itemId",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$itemAppliedTax",156],"[",["T_CONSTANT_ENCAPSED_STRING","'item_id'",156],"]",";",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$key",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$itemId",157],";",["T_WHITESPACE","\n            ",157],"}",["T_WHITESPACE"," ",158],["T_ELSEIF","elseif",158],["T_WHITESPACE"," ",158],"(",["T_ISSET","isset",158],"(",["T_VARIABLE","$itemAppliedTax",158],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",158],"]",")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                ",158],["T_COMMENT","\/\/The taxable is associated with a product, e.g., weee, gift wrapping, etc.\n",159],["T_WHITESPACE","                ",160],["T_COMMENT","\/\/Note: the itemId is null\n",160],["T_WHITESPACE","                ",161],["T_VARIABLE","$associatedItemId",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$itemAppliedTax",161],"[",["T_CONSTANT_ENCAPSED_STRING","'associated_item_id'",161],"]",";",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$key",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$itemAppliedTax",162],"[",["T_CONSTANT_ENCAPSED_STRING","'taxable_item_type'",162],"]",["T_WHITESPACE"," ",162],".",["T_WHITESPACE"," ",162],["T_VARIABLE","$associatedItemId",162],";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE"," ",163],["T_ELSE","else",163],["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_COMMENT","\/\/The taxable is not associated with a product, e.g., shipping\n",164],["T_WHITESPACE","                ",165],["T_COMMENT","\/\/Use item type as key.  Both the itemId and associatedItemId are null\n",165],["T_WHITESPACE","                ",166],["T_VARIABLE","$key",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$itemAppliedTax",166],"[",["T_CONSTANT_ENCAPSED_STRING","'taxable_item_type'",166],"]",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n\n            ",167],["T_COMMENT","\/\/ create the itemsData entry\n",169],["T_WHITESPACE","            ",170],["T_IF","if",170],["T_WHITESPACE"," ",170],"(","!",["T_ISSET","isset",170],"(",["T_VARIABLE","$itemsData",170],"[",["T_VARIABLE","$key",170],"]",")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                ",170],["T_VARIABLE","$itemsData",171],"[",["T_VARIABLE","$key",171],"]",["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],"[",["T_WHITESPACE","\n                    ",171],["T_STRING","Item",172],["T_DOUBLE_COLON","::",172],["T_STRING","KEY_TYPE",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$itemAppliedTax",172],"[",["T_CONSTANT_ENCAPSED_STRING","'taxable_item_type'",172],"]",",",["T_WHITESPACE","\n                    ",172],["T_STRING","Item",173],["T_DOUBLE_COLON","::",173],["T_STRING","KEY_ITEM_ID",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$itemId",173],",",["T_WHITESPACE","                       ",173],["T_COMMENT","\/\/ might be null\n",173],["T_WHITESPACE","                    ",174],["T_STRING","Item",174],["T_DOUBLE_COLON","::",174],["T_STRING","KEY_ASSOCIATED_ITEM_ID",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$associatedItemId",174],",",["T_WHITESPACE","  ",174],["T_COMMENT","\/\/ might be null\n",174],["T_WHITESPACE","                ",175],"]",";",["T_WHITESPACE","\n            ",175],"}",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$current",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","null",177],";",["T_WHITESPACE","\n            ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_ISSET","isset",178],"(",["T_VARIABLE","$itemsData",178],"[",["T_VARIABLE","$key",178],"]","[",["T_STRING","Item",178],["T_DOUBLE_COLON","::",178],["T_STRING","KEY_APPLIED_TAXES",178],"]","[",["T_VARIABLE","$itemAppliedTax",178],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",178],"]","]",")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$current",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$itemsData",179],"[",["T_VARIABLE","$key",179],"]","[",["T_STRING","Item",179],["T_DOUBLE_COLON","::",179],["T_STRING","KEY_APPLIED_TAXES",179],"]","[",["T_VARIABLE","$itemAppliedTax",179],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",179],"]","]",";",["T_WHITESPACE","\n            ",179],"}",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$itemsData",181],"[",["T_VARIABLE","$key",181],"]","[",["T_STRING","Item",181],["T_DOUBLE_COLON","::",181],["T_STRING","KEY_APPLIED_TAXES",181],"]","[",["T_VARIABLE","$itemAppliedTax",181],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",181],"]","]",["T_WHITESPACE"," ",181],"=",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","convertToAppliedTaxDataObject",182],"(",["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","appliedTaxDataObjectFactory",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$itemAppliedTax",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$current",182],")",";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_VARIABLE","$items",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],"[","]",";",["T_WHITESPACE","\n        ",185],["T_FOREACH","foreach",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$itemsData",186],["T_WHITESPACE"," ",186],["T_AS","as",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$itemData",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$items",187],"[","]",["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","itemDataObjectFactory",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","create",187],"(",")",["T_WHITESPACE","\n                ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","setType",188],"(",["T_VARIABLE","$itemData",188],"[",["T_STRING","Item",188],["T_DOUBLE_COLON","::",188],["T_STRING","KEY_TYPE",188],"]",")",["T_WHITESPACE","\n                ",188],["T_OBJECT_OPERATOR","->",189],["T_STRING","setItemId",189],"(",["T_VARIABLE","$itemData",189],"[",["T_STRING","Item",189],["T_DOUBLE_COLON","::",189],["T_STRING","KEY_ITEM_ID",189],"]",")",["T_WHITESPACE","\n                ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","setAssociatedItemId",190],"(",["T_VARIABLE","$itemData",190],"[",["T_STRING","Item",190],["T_DOUBLE_COLON","::",190],["T_STRING","KEY_ASSOCIATED_ITEM_ID",190],"]",")",["T_WHITESPACE","\n                ",190],["T_OBJECT_OPERATOR","->",191],["T_STRING","setAppliedTaxes",191],"(",["T_VARIABLE","$itemData",191],"[",["T_STRING","Item",191],["T_DOUBLE_COLON","::",191],["T_STRING","KEY_APPLIED_TAXES",191],"]",")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$orderAppliedTaxesDOs",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","aggregateAppliedTaxes",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","appliedTaxDataObjectFactory",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$items",193],")",";",["T_WHITESPACE","\n        ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","orderTaxDetailsDataObjectFactory",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","create",194],"(",")",["T_WHITESPACE","\n            ",194],["T_OBJECT_OPERATOR","->",195],["T_STRING","setItems",195],"(",["T_VARIABLE","$items",195],")",["T_WHITESPACE","\n            ",195],["T_OBJECT_OPERATOR","->",196],["T_STRING","setAppliedTaxes",196],"(",["T_VARIABLE","$orderAppliedTaxesDOs",196],")",";",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n",197],"}",["T_WHITESPACE","\n",198]]