[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ImportExport",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Import",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * ImportExport import data resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Data",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","ResourceModel",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Db",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractDb",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","IteratorAggregate",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * @var \\Iterator\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$_iterator",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_STRING","null",18],";",["T_WHITESPACE","\n\n    ",18],["T_DOC_COMMENT","\/**\n     * Helper to encode\/decode json\n     *\n     * @var \\Magento\\Framework\\Json\\Helper\\Data\n     *\/",20],["T_WHITESPACE","\n    ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$jsonHelper",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Json\\Helper\\Data $jsonHelper\n     * @param string $connectionName\n     *\/",27],["T_WHITESPACE","\n    ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","__construct",34],"(",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Framework",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Model",35],["T_NS_SEPARATOR","\\",35],["T_STRING","ResourceModel",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Db",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Context",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$context",35],",",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Framework",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Json",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Helper",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Data",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$jsonHelper",36],",",["T_WHITESPACE","\n        ",36],["T_VARIABLE","$connectionName",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","null",37],["T_WHITESPACE","\n    ",37],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n        ",38],["T_STRING","parent",39],["T_DOUBLE_COLON","::",39],["T_STRING","__construct",39],"(",["T_VARIABLE","$context",39],",",["T_WHITESPACE"," ",39],["T_VARIABLE","$connectionName",39],")",";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","jsonHelper",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$jsonHelper",40],";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\n     * @return void\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","_construct",48],"(",")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_init",50],"(",["T_CONSTANT_ENCAPSED_STRING","'importexport_importdata'",50],",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'id'",50],")",";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Retrieve an external iterator\n     *\n     * @return \\Iterator\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","getIterator",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$connection",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getConnection",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$select",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$connection",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","select",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","from",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getMainTable",61],"(",")",",",["T_WHITESPACE"," ",61],"[",["T_CONSTANT_ENCAPSED_STRING","'data'",61],"]",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","order",61],"(",["T_CONSTANT_ENCAPSED_STRING","'id ASC'",61],")",";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$stmt",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$connection",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","query",62],"(",["T_VARIABLE","$select",62],")",";",["T_WHITESPACE","\n\n        ",62],["T_VARIABLE","$stmt",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","setFetchMode",64],"(",["T_NS_SEPARATOR","\\",64],["T_STRING","Zend_Db",64],["T_DOUBLE_COLON","::",64],["T_STRING","FETCH_NUM",64],")",";",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$stmt",65],["T_WHITESPACE"," ",65],["T_INSTANCEOF","instanceof",65],["T_WHITESPACE"," ",65],["T_NS_SEPARATOR","\\",65],["T_STRING","IteratorAggregate",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$iterator",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$stmt",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getIterator",66],"(",")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE"," ",67],["T_ELSE","else",67],["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n            ",67],["T_COMMENT","\/\/ Statement doesn't support iterating, so fetch all records and create iterator ourself\n",68],["T_WHITESPACE","            ",69],["T_VARIABLE","$rows",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$stmt",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","fetchAll",69],"(",")",";",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$iterator",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_NEW","new",70],["T_WHITESPACE"," ",70],["T_NS_SEPARATOR","\\",70],["T_STRING","ArrayIterator",70],"(",["T_VARIABLE","$rows",70],")",";",["T_WHITESPACE","\n        ",70],"}",["T_WHITESPACE","\n\n        ",71],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$iterator",73],";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Clean all bunches from table.\n     *\n     * @return \\Magento\\Framework\\DB\\Adapter\\AdapterInterface\n     *\/",76],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","cleanBunches",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getConnection",83],"(",")",["T_OBJECT_OPERATOR","->",83],["T_STRING","delete",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getMainTable",83],"(",")",")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Return behavior from import data table.\n     *\n     * @return string\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","getBehavior",91],"(",")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getUniqueColumnData",93],"(",["T_CONSTANT_ENCAPSED_STRING","'behavior'",93],")",";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Return entity type code from import data table.\n     *\n     * @return string\n     *\/",96],["T_WHITESPACE","\n    ",100],["T_PUBLIC","public",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","getEntityTypeCode",101],"(",")",["T_WHITESPACE","\n    ",101],"{",["T_WHITESPACE","\n        ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getUniqueColumnData",103],"(",["T_CONSTANT_ENCAPSED_STRING","'entity'",103],")",";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Return request data from import data table\n     *\n     * @param string $code parameter name\n     * @return string\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",106],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","getUniqueColumnData",113],"(",["T_VARIABLE","$code",113],")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$connection",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getConnection",115],"(",")",";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$values",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","array_unique",116],"(",["T_VARIABLE","$connection",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","fetchCol",116],"(",["T_VARIABLE","$connection",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","select",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","from",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getMainTable",116],"(",")",",",["T_WHITESPACE"," ",116],"[",["T_VARIABLE","$code",116],"]",")",")",")",";",["T_WHITESPACE","\n\n        ",116],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_STRING","count",118],"(",["T_VARIABLE","$values",118],")",["T_WHITESPACE"," ",118],["T_IS_NOT_EQUAL","!=",118],["T_WHITESPACE"," ",118],["T_LNUMBER","1",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_THROW","throw",119],["T_WHITESPACE"," ",119],["T_NEW","new",119],["T_WHITESPACE"," ",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Magento",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Framework",119],["T_NS_SEPARATOR","\\",119],["T_STRING","Exception",119],["T_NS_SEPARATOR","\\",119],["T_STRING","LocalizedException",119],"(",["T_WHITESPACE","\n                ",119],["T_STRING","__",120],"(",["T_CONSTANT_ENCAPSED_STRING","'Error in data structure: %1 values are mixed'",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$code",120],")",["T_WHITESPACE","\n            ",120],")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n        ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$values",123],"[",["T_LNUMBER","0",123],"]",";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Get next bunch of validated rows.\n     *\n     * @return array|null\n     *\/",126],["T_WHITESPACE","\n    ",130],["T_PUBLIC","public",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","getNextBunch",131],"(",")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_STRING","null",133],["T_WHITESPACE"," ",133],["T_IS_IDENTICAL","===",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_iterator",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_iterator",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getIterator",134],"(",")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_iterator",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","rewind",135],"(",")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$dataRow",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","null",137],";",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_iterator",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","valid",138],"(",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$encodedData",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_iterator",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","current",139],"(",")",";",["T_WHITESPACE","\n            ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_STRING","array_key_exists",140],"(",["T_LNUMBER","0",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$encodedData",140],")",["T_WHITESPACE"," ",140],["T_BOOLEAN_AND","&&",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$encodedData",140],"[",["T_LNUMBER","0",140],"]",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$dataRow",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","jsonHelper",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","jsonDecode",141],"(",["T_VARIABLE","$encodedData",141],"[",["T_LNUMBER","0",141],"]",")",";",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_iterator",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","next",142],"(",")",";",["T_WHITESPACE","\n            ",142],"}",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(","!",["T_VARIABLE","$dataRow",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_iterator",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","null",146],";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$dataRow",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Save import rows bunch.\n     *\n     * @param string $entity\n     * @param string $behavior\n     * @param array $data\n     * @return int\n     *\/",151],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","saveBunch",159],"(",["T_VARIABLE","$entity",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$behavior",159],",",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$data",159],")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_RETURN","return",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getConnection",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","insert",161],"(",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getMainTable",162],"(",")",",",["T_WHITESPACE","\n            ",162],"[",["T_CONSTANT_ENCAPSED_STRING","'behavior'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$behavior",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'entity'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$entity",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'data'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","jsonHelper",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","jsonEncode",163],"(",["T_VARIABLE","$data",163],")","]",["T_WHITESPACE","\n        ",163],")",";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n",165],"}",["T_WHITESPACE","\n",166]]