[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","EncryptionKey",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Key",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","App",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Filesystem",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DirectoryList",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Config",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ConfigOptionsListConstants",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Config",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Data",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ConfigData",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Config",11],["T_NS_SEPARATOR","\\",11],["T_STRING","File",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ConfigFilePool",11],";",["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Encryption key changer resource model\n * The operation must be done in one transaction\n *\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",13],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","Change",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Magento",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Framework",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Model",19],["T_NS_SEPARATOR","\\",19],["T_STRING","ResourceModel",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Db",19],["T_NS_SEPARATOR","\\",19],["T_STRING","AbstractDb",19],["T_WHITESPACE","\n",19],"{",["T_WHITESPACE","\n    ",20],["T_DOC_COMMENT","\/**\n     * Encryptor interface\n     *\n     * @var \\Magento\\Framework\\Encryption\\EncryptorInterface\n     *\/",21],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$encryptor",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Filesystem directory write interface\n     *\n     * @var \\Magento\\Framework\\Filesystem\\Directory\\WriteInterface\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$directory",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * System configuration structure\n     *\n     * @var \\Magento\\Config\\Model\\Config\\Structure\n     *\/",35],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$structure",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Configuration writer\n     *\n     * @var \\Magento\\Framework\\App\\DeploymentConfig\\Writer\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$writer",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Random\n     *\n     * @var \\Magento\\Framework\\Math\\Random\n     *\/",49],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$random",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Filesystem $filesystem\n     * @param \\Magento\\Config\\Model\\Config\\Structure $structure\n     * @param \\Magento\\Framework\\Encryption\\EncryptorInterface $encryptor\n     * @param \\Magento\\Framework\\App\\DeploymentConfig\\Writer $writer\n     * @param \\Magento\\Framework\\Math\\Random $random\n     * @param string $connectionName\n     *\/",56],["T_WHITESPACE","\n    ",64],["T_PUBLIC","public",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","__construct",65],"(",["T_WHITESPACE","\n        ",65],["T_NS_SEPARATOR","\\",66],["T_STRING","Magento",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Framework",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Model",66],["T_NS_SEPARATOR","\\",66],["T_STRING","ResourceModel",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Db",66],["T_NS_SEPARATOR","\\",66],["T_STRING","Context",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$context",66],",",["T_WHITESPACE","\n        ",66],["T_NS_SEPARATOR","\\",67],["T_STRING","Magento",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Framework",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Filesystem",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$filesystem",67],",",["T_WHITESPACE","\n        ",67],["T_NS_SEPARATOR","\\",68],["T_STRING","Magento",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Config",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Model",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Config",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Structure",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$structure",68],",",["T_WHITESPACE","\n        ",68],["T_NS_SEPARATOR","\\",69],["T_STRING","Magento",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Framework",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Encryption",69],["T_NS_SEPARATOR","\\",69],["T_STRING","EncryptorInterface",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$encryptor",69],",",["T_WHITESPACE","\n        ",69],["T_NS_SEPARATOR","\\",70],["T_STRING","Magento",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Framework",70],["T_NS_SEPARATOR","\\",70],["T_STRING","App",70],["T_NS_SEPARATOR","\\",70],["T_STRING","DeploymentConfig",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Writer",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$writer",70],",",["T_WHITESPACE","\n        ",70],["T_NS_SEPARATOR","\\",71],["T_STRING","Magento",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Framework",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Math",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Random",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$random",71],",",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$connectionName",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","null",72],["T_WHITESPACE","\n    ",72],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","encryptor",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_CLONE","clone",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$encryptor",74],";",["T_WHITESPACE","\n        ",74],["T_STRING","parent",75],["T_DOUBLE_COLON","::",75],["T_STRING","__construct",75],"(",["T_VARIABLE","$context",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$connectionName",75],")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","directory",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$filesystem",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getDirectoryWrite",76],"(",["T_STRING","DirectoryList",76],["T_DOUBLE_COLON","::",76],["T_STRING","CONFIG",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","structure",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$structure",77],";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","writer",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$writer",78],";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","random",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$random",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Initialize\n     *\n     * @return void\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_construct",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_init",89],"(",["T_CONSTANT_ENCAPSED_STRING","'core_config_data'",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'config_id'",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Change encryption key\n     *\n     * @param string|null $key\n     * @return null|string\n     * @throws \\Exception\n     *\/",92],["T_WHITESPACE","\n    ",98],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","changeEncryptionKey",99],"(",["T_VARIABLE","$key",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","null",99],")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_COMMENT","\/\/ prepare new key, encryptor and new configuration segment\n",101],["T_WHITESPACE","        ",102],["T_IF","if",102],["T_WHITESPACE"," ",102],"(","!",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","writer",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","checkIfWritable",102],"(",")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_THROW","throw",103],["T_WHITESPACE"," ",103],["T_NEW","new",103],["T_WHITESPACE"," ",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Exception",103],"(",["T_STRING","__",103],"(",["T_CONSTANT_ENCAPSED_STRING","'Deployment configuration file is not writable.'",103],")",")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n\n        ",104],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_STRING","null",106],["T_WHITESPACE"," ",106],["T_IS_IDENTICAL","===",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$key",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$key",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","md5",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","random",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getRandomString",107],"(",["T_STRING","ConfigOptionsListConstants",107],["T_DOUBLE_COLON","::",107],["T_STRING","STORE_KEY_RANDOM_STRING_SIZE",107],")",")",";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","encryptor",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","setNewKey",109],"(",["T_VARIABLE","$key",109],")",";",["T_WHITESPACE","\n\n        ",109],["T_VARIABLE","$encryptSegment",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_NEW","new",111],["T_WHITESPACE"," ",111],["T_STRING","ConfigData",111],"(",["T_STRING","ConfigFilePool",111],["T_DOUBLE_COLON","::",111],["T_STRING","APP_ENV",111],")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$encryptSegment",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","set",112],"(",["T_STRING","ConfigOptionsListConstants",112],["T_DOUBLE_COLON","::",112],["T_STRING","CONFIG_PATH_CRYPT_KEY",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","encryptor",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","exportKeys",112],"(",")",")",";",["T_WHITESPACE","\n\n        ",112],["T_VARIABLE","$configData",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],"[",["T_VARIABLE","$encryptSegment",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getFileKey",114],"(",")",["T_WHITESPACE"," ",114],["T_DOUBLE_ARROW","=>",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$encryptSegment",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getData",114],"(",")","]",";",["T_WHITESPACE","\n\n        ",114],["T_COMMENT","\/\/ update database and config.php\n",116],["T_WHITESPACE","        ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","beginTransaction",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_TRY","try",118],["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_reEncryptSystemConfigurationValues",119],"(",")",";",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_reEncryptCreditCardNumbers",120],"(",")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","writer",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","saveConfig",121],"(",["T_VARIABLE","$configData",121],")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","commit",122],"(",")",";",["T_WHITESPACE","\n            ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$key",123],";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE"," ",124],["T_CATCH","catch",124],["T_WHITESPACE"," ",124],"(",["T_NS_SEPARATOR","\\",124],["T_STRING","Exception",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$e",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","rollBack",125],"(",")",";",["T_WHITESPACE","\n            ",125],["T_THROW","throw",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$e",126],";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n    ",127],"}",["T_WHITESPACE","\n\n    ",128],["T_DOC_COMMENT","\/**\n     * Gather all encrypted system config values and re-encrypt them\n     *\n     * @return void\n     *\/",130],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","_reEncryptSystemConfigurationValues",135],"(",")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_COMMENT","\/\/ look for encrypted node entries in all system.xml files\n",137],["T_WHITESPACE","        ",138],["T_DOC_COMMENT","\/** @var \\Magento\\Config\\Model\\Config\\Structure $configStructure  *\/",138],["T_WHITESPACE","\n        ",138],["T_VARIABLE","$configStructure",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","structure",139],";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$paths",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$configStructure",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getFieldPathsByAttribute",140],"(",["T_WHITESPACE","\n            ",140],["T_CONSTANT_ENCAPSED_STRING","'backend_model'",141],",",["T_WHITESPACE","\n            ",141],["T_NS_SEPARATOR","\\",142],["T_STRING","Magento",142],["T_NS_SEPARATOR","\\",142],["T_STRING","Config",142],["T_NS_SEPARATOR","\\",142],["T_STRING","Model",142],["T_NS_SEPARATOR","\\",142],["T_STRING","Config",142],["T_NS_SEPARATOR","\\",142],["T_STRING","Backend",142],["T_NS_SEPARATOR","\\",142],["T_STRING","Encrypted",142],["T_DOUBLE_COLON","::",142],["T_CLASS","class",142],["T_WHITESPACE","\n        ",142],")",";",["T_WHITESPACE","\n\n        ",143],["T_COMMENT","\/\/ walk through found data and re-encrypt it\n",145],["T_WHITESPACE","        ",146],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$paths",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$table",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getTable",147],"(",["T_CONSTANT_ENCAPSED_STRING","'core_config_data'",147],")",";",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$values",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getConnection",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","fetchPairs",148],"(",["T_WHITESPACE","\n                ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getConnection",149],"(",")",["T_WHITESPACE","\n                    ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","select",150],"(",")",["T_WHITESPACE","\n                    ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","from",151],"(",["T_VARIABLE","$table",151],",",["T_WHITESPACE"," ",151],"[",["T_CONSTANT_ENCAPSED_STRING","'config_id'",151],",",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'value'",151],"]",")",["T_WHITESPACE","\n                    ",151],["T_OBJECT_OPERATOR","->",152],["T_STRING","where",152],"(",["T_CONSTANT_ENCAPSED_STRING","'path IN (?)'",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$paths",152],")",["T_WHITESPACE","\n                    ",152],["T_OBJECT_OPERATOR","->",153],["T_STRING","where",153],"(",["T_CONSTANT_ENCAPSED_STRING","'value NOT LIKE ?'",153],",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","''",153],")",["T_WHITESPACE","\n            ",153],")",";",["T_WHITESPACE","\n            ",154],["T_FOREACH","foreach",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$values",155],["T_WHITESPACE"," ",155],["T_AS","as",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$configId",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$value",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getConnection",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","update",156],"(",["T_WHITESPACE","\n                    ",156],["T_VARIABLE","$table",157],",",["T_WHITESPACE","\n                    ",157],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","encryptor",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","encrypt",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","encryptor",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","decrypt",158],"(",["T_VARIABLE","$value",158],")",")","]",",",["T_WHITESPACE","\n                    ",158],"[",["T_CONSTANT_ENCAPSED_STRING","'config_id = ?'",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_INT_CAST","(int)",159],["T_VARIABLE","$configId",159],"]",["T_WHITESPACE","\n                ",159],")",";",["T_WHITESPACE","\n            ",160],"}",["T_WHITESPACE","\n        ",161],"}",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * Gather saved credit card numbers from sales order payments and re-encrypt them\n     *\n     * @return void\n     *\/",165],["T_WHITESPACE","\n    ",169],["T_PROTECTED","protected",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","_reEncryptCreditCardNumbers",170],"(",")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$table",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getTable",172],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_payment'",172],")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$select",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getConnection",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","select",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","from",173],"(",["T_VARIABLE","$table",173],",",["T_WHITESPACE"," ",173],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'cc_number_enc'",173],"]",")",";",["T_WHITESPACE","\n\n        ",173],["T_VARIABLE","$attributeValues",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getConnection",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","fetchPairs",175],"(",["T_VARIABLE","$select",175],")",";",["T_WHITESPACE","\n        ",175],["T_COMMENT","\/\/ save new values\n",176],["T_WHITESPACE","        ",177],["T_FOREACH","foreach",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$attributeValues",177],["T_WHITESPACE"," ",177],["T_AS","as",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$valueId",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$value",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getConnection",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","update",178],"(",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$table",179],",",["T_WHITESPACE","\n                ",179],"[",["T_CONSTANT_ENCAPSED_STRING","'cc_number_enc'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","encryptor",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","encrypt",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","encryptor",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","decrypt",180],"(",["T_VARIABLE","$value",180],")",")","]",",",["T_WHITESPACE","\n                ",180],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_INT_CAST","(int)",181],["T_VARIABLE","$valueId",181],"]",["T_WHITESPACE","\n            ",181],")",";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n",184],"}",["T_WHITESPACE","\n",185]]