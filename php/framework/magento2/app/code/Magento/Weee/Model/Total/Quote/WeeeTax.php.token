[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Weee",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Total",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Address",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Total",8],["T_NS_SEPARATOR","\\",8],["T_STRING","AbstractTotal",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Store",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Store",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Tax",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Sales",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Total",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Quote",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CommonTaxCollector",10],";",["T_WHITESPACE","\n\n",10],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","WeeeTax",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","Weee",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_DOC_COMMENT","\/**\n     * Collect Weee taxes amount and prepare items prices for taxation and discount\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param \\Magento\\Quote\\Api\\Data\\ShippingAssignmentInterface|\\Magento\\Quote\\Model\\Quote\\Address $shippingAssignment\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @return $this\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",14],["T_WHITESPACE","\n    ",23],["T_PUBLIC","public",24],["T_WHITESPACE"," ",24],["T_FUNCTION","function",24],["T_WHITESPACE"," ",24],["T_STRING","collect",24],"(",["T_WHITESPACE","\n        ",24],["T_NS_SEPARATOR","\\",25],["T_STRING","Magento",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Quote",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Model",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Quote",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$quote",25],",",["T_WHITESPACE","\n        ",25],["T_NS_SEPARATOR","\\",26],["T_STRING","Magento",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Quote",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Api",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Data",26],["T_NS_SEPARATOR","\\",26],["T_STRING","ShippingAssignmentInterface",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$shippingAssignment",26],",",["T_WHITESPACE","\n        ",26],["T_NS_SEPARATOR","\\",27],["T_STRING","Magento",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Quote",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Model",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Quote",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Address",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Total",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$total",27],["T_WHITESPACE","\n    ",27],")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n        ",28],["T_NS_SEPARATOR","\\",29],["T_STRING","Magento",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Quote",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Model",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Quote",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Address",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Total",29],["T_NS_SEPARATOR","\\",29],["T_STRING","AbstractTotal",29],["T_DOUBLE_COLON","::",29],["T_STRING","collect",29],"(",["T_VARIABLE","$quote",29],",",["T_WHITESPACE"," ",29],["T_VARIABLE","$shippingAssignment",29],",",["T_WHITESPACE"," ",29],["T_VARIABLE","$total",29],")",";",["T_WHITESPACE","\n        ",29],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","_store",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$quote",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","getStore",30],"(",")",";",["T_WHITESPACE","\n        ",30],["T_IF","if",31],["T_WHITESPACE"," ",31],"(","!",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","weeeData",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","isEnabled",31],"(",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","_store",31],")",")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n            ",31],["T_RETURN","return",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$this",32],";",["T_WHITESPACE","\n        ",32],"}",["T_WHITESPACE","\n\n        ",33],["T_VARIABLE","$items",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$shippingAssignment",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getItems",35],"(",")",";",["T_WHITESPACE","\n        ",35],["T_IF","if",36],["T_WHITESPACE"," ",36],"(","!",["T_STRING","count",36],"(",["T_VARIABLE","$items",36],")",")",["T_WHITESPACE"," ",36],"{",["T_WHITESPACE","\n            ",36],["T_RETURN","return",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],";",["T_WHITESPACE","\n        ",37],"}",["T_WHITESPACE","\n\n        ",38],["T_COMMENT","\/\/If Weee is not taxable, then the 'weee' collector has accumulated the non-taxable total values\n",40],["T_WHITESPACE","        ",41],["T_IF","if",41],["T_WHITESPACE"," ",41],"(","!",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","weeeData",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","isTaxable",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","_store",41],")",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n            ",41],["T_COMMENT","\/\/Because Weee is not taxable:  Weee excluding tax == Weee including tax\n",42],["T_WHITESPACE","            ",43],["T_VARIABLE","$weeeTotal",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$total",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getWeeeTotalExclTax",43],"(",")",";",["T_WHITESPACE","\n            ",43],["T_VARIABLE","$weeeBaseTotal",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$total",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getWeeeBaseTotalExclTax",44],"(",")",";",["T_WHITESPACE","\n\n            ",44],["T_COMMENT","\/\/Add to appropriate 'subtotal' or 'weee' accumulators\n",46],["T_WHITESPACE","            ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","processTotalAmount",47],"(",["T_VARIABLE","$total",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$weeeTotal",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$weeeBaseTotal",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$weeeTotal",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$weeeBaseTotal",47],")",";",["T_WHITESPACE","\n            ",47],["T_RETURN","return",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],";",["T_WHITESPACE","\n        ",48],"}",["T_WHITESPACE","\n        \n        ",49],["T_VARIABLE","$extraTaxableDetails",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$total",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getExtraTaxableDetails",51],"(",")",";",["T_WHITESPACE","\n\n        ",51],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_ISSET","isset",53],"(",["T_VARIABLE","$extraTaxableDetails",53],"[",["T_STRING","self",53],["T_DOUBLE_COLON","::",53],["T_STRING","ITEM_TYPE",53],"]",")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_COMMENT","\/\/Get mapping from weeeCode to item\n",54],["T_WHITESPACE","            ",55],["T_VARIABLE","$weeeCodeToItemMap",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$total",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getWeeeCodeToItemMap",55],"(",")",";",["T_WHITESPACE","\n\n            ",55],["T_COMMENT","\/\/Create mapping from item to weeeCode\n",57],["T_WHITESPACE","            ",58],["T_VARIABLE","$itemToWeeeCodeMap",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","createItemToWeeeCodeMapping",58],"(",["T_VARIABLE","$weeeCodeToItemMap",58],")",";",["T_WHITESPACE","\n\n            ",58],["T_COMMENT","\/\/Create mapping from weeeCode to weeeTaxDetails\n",60],["T_WHITESPACE","            ",61],["T_VARIABLE","$weeeCodeToWeeeTaxDetailsMap",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],"[","]",";",["T_WHITESPACE","\n            ",61],["T_FOREACH","foreach",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$extraTaxableDetails",62],"[",["T_STRING","self",62],["T_DOUBLE_COLON","::",62],["T_STRING","ITEM_TYPE",62],"]",["T_WHITESPACE"," ",62],["T_AS","as",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$weeeAttributesTaxDetails",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n                ",62],["T_FOREACH","foreach",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$weeeAttributesTaxDetails",63],["T_WHITESPACE"," ",63],["T_AS","as",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$weeeTaxDetails",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n                    ",63],["T_VARIABLE","$weeeCode",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$weeeTaxDetails",64],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",64],"]",";",["T_WHITESPACE","\n                    ",64],["T_VARIABLE","$weeeCodeToWeeeTaxDetailsMap",65],"[",["T_VARIABLE","$weeeCode",65],"]",["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$weeeTaxDetails",65],";",["T_WHITESPACE","\n                ",65],"}",["T_WHITESPACE","\n            ",66],"}",["T_WHITESPACE","\n\n            ",67],["T_COMMENT","\/\/Process each item that has taxable weee\n",69],["T_WHITESPACE","            ",70],["T_FOREACH","foreach",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$itemToWeeeCodeMap",70],["T_WHITESPACE"," ",70],["T_AS","as",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$mapping",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$item",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$mapping",71],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",71],"]",";",["T_WHITESPACE","\n\n                ",71],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","weeeData",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","setApplied",73],"(",["T_VARIABLE","$item",73],",",["T_WHITESPACE"," ",73],"[","]",")",";",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$productTaxes",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],"[","]",";",["T_WHITESPACE","\n\n                ",74],["T_VARIABLE","$totalValueInclTax",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_LNUMBER","0",76],";",["T_WHITESPACE","\n                ",76],["T_VARIABLE","$baseTotalValueInclTax",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_LNUMBER","0",77],";",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$totalRowValueInclTax",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_LNUMBER","0",78],";",["T_WHITESPACE","\n                ",78],["T_VARIABLE","$baseTotalRowValueInclTax",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_LNUMBER","0",79],";",["T_WHITESPACE","\n\n                ",79],["T_VARIABLE","$totalValueExclTax",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_LNUMBER","0",81],";",["T_WHITESPACE","\n                ",81],["T_VARIABLE","$baseTotalValueExclTax",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_LNUMBER","0",82],";",["T_WHITESPACE","\n                ",82],["T_VARIABLE","$totalRowValueExclTax",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_LNUMBER","0",83],";",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$baseTotalRowValueExclTax",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_LNUMBER","0",84],";",["T_WHITESPACE","\n\n                ",84],["T_COMMENT","\/\/Process each taxed weee attribute of an item\n",86],["T_WHITESPACE","                ",87],["T_FOREACH","foreach",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$mapping",87],"[",["T_CONSTANT_ENCAPSED_STRING","'weeeCodes'",87],"]",["T_WHITESPACE"," ",87],["T_AS","as",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$weeeCode",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n                    ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(","!",["T_STRING","array_key_exists",88],"(",["T_VARIABLE","$weeeCode",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$weeeCodeToWeeeTaxDetailsMap",88],")",")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                        ",88],["T_COMMENT","\/\/Need to ensure that everyone is in sync for which weee code to process\n",89],["T_WHITESPACE","                        ",90],["T_CONTINUE","continue",90],";",["T_WHITESPACE","\n                    ",90],"}",["T_WHITESPACE","\n                    ",91],["T_VARIABLE","$weeeTaxDetails",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$weeeCodeToWeeeTaxDetailsMap",92],"[",["T_VARIABLE","$weeeCode",92],"]",";",["T_WHITESPACE","\n                    ",92],["T_VARIABLE","$attributeCode",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","explode",93],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$weeeCode",93],")","[",["T_LNUMBER","1",93],"]",";",["T_WHITESPACE","\n\n                    ",93],["T_VARIABLE","$valueExclTax",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$weeeTaxDetails",95],"[",["T_STRING","CommonTaxCollector",95],["T_DOUBLE_COLON","::",95],["T_STRING","KEY_TAX_DETAILS_PRICE_EXCL_TAX",95],"]",";",["T_WHITESPACE","\n                    ",95],["T_VARIABLE","$baseValueExclTax",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$weeeTaxDetails",96],"[",["T_STRING","CommonTaxCollector",96],["T_DOUBLE_COLON","::",96],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_EXCL_TAX",96],"]",";",["T_WHITESPACE","\n                    ",96],["T_VARIABLE","$valueInclTax",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$weeeTaxDetails",97],"[",["T_STRING","CommonTaxCollector",97],["T_DOUBLE_COLON","::",97],["T_STRING","KEY_TAX_DETAILS_PRICE_INCL_TAX",97],"]",";",["T_WHITESPACE","\n                    ",97],["T_VARIABLE","$baseValueInclTax",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$weeeTaxDetails",98],"[",["T_STRING","CommonTaxCollector",98],["T_DOUBLE_COLON","::",98],["T_STRING","KEY_TAX_DETAILS_BASE_PRICE_INCL_TAX",98],"]",";",["T_WHITESPACE","\n\n                    ",98],["T_VARIABLE","$rowValueExclTax",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$weeeTaxDetails",100],"[",["T_STRING","CommonTaxCollector",100],["T_DOUBLE_COLON","::",100],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL",100],"]",";",["T_WHITESPACE","\n                    ",100],["T_VARIABLE","$baseRowValueExclTax",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$weeeTaxDetails",101],"[",["T_STRING","CommonTaxCollector",101],["T_DOUBLE_COLON","::",101],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL",101],"]",";",["T_WHITESPACE","\n                    ",101],["T_VARIABLE","$rowValueInclTax",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$weeeTaxDetails",102],"[",["T_STRING","CommonTaxCollector",102],["T_DOUBLE_COLON","::",102],["T_STRING","KEY_TAX_DETAILS_ROW_TOTAL_INCL_TAX",102],"]",";",["T_WHITESPACE","\n                    ",102],["T_VARIABLE","$baseRowValueInclTax",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$weeeTaxDetails",103],"[",["T_STRING","CommonTaxCollector",103],["T_DOUBLE_COLON","::",103],["T_STRING","KEY_TAX_DETAILS_BASE_ROW_TOTAL_INCL_TAX",103],"]",";",["T_WHITESPACE","\n\n                    ",103],["T_VARIABLE","$totalValueInclTax",105],["T_WHITESPACE"," ",105],["T_PLUS_EQUAL","+=",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$valueInclTax",105],";",["T_WHITESPACE","\n                    ",105],["T_VARIABLE","$baseTotalValueInclTax",106],["T_WHITESPACE"," ",106],["T_PLUS_EQUAL","+=",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$baseValueInclTax",106],";",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$totalRowValueInclTax",107],["T_WHITESPACE"," ",107],["T_PLUS_EQUAL","+=",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$rowValueInclTax",107],";",["T_WHITESPACE","\n                    ",107],["T_VARIABLE","$baseTotalRowValueInclTax",108],["T_WHITESPACE"," ",108],["T_PLUS_EQUAL","+=",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$baseRowValueInclTax",108],";",["T_WHITESPACE","\n\n                    ",108],["T_VARIABLE","$totalValueExclTax",110],["T_WHITESPACE"," ",110],["T_PLUS_EQUAL","+=",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$valueExclTax",110],";",["T_WHITESPACE","\n                    ",110],["T_VARIABLE","$baseTotalValueExclTax",111],["T_WHITESPACE"," ",111],["T_PLUS_EQUAL","+=",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$baseValueExclTax",111],";",["T_WHITESPACE","\n                    ",111],["T_VARIABLE","$totalRowValueExclTax",112],["T_WHITESPACE"," ",112],["T_PLUS_EQUAL","+=",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$rowValueExclTax",112],";",["T_WHITESPACE","\n                    ",112],["T_VARIABLE","$baseTotalRowValueExclTax",113],["T_WHITESPACE"," ",113],["T_PLUS_EQUAL","+=",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$baseRowValueExclTax",113],";",["T_WHITESPACE","\n\n                    ",113],["T_VARIABLE","$productTaxes",115],"[","]",["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],"[",["T_WHITESPACE","\n                        ",115],["T_CONSTANT_ENCAPSED_STRING","'title'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$attributeCode",116],",",["T_WHITESPACE"," ",116],["T_COMMENT","\/\/TODO: fix this\n",116],["T_WHITESPACE","                        ",117],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$baseValueExclTax",117],",",["T_WHITESPACE","\n                        ",117],["T_CONSTANT_ENCAPSED_STRING","'amount'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$valueExclTax",118],",",["T_WHITESPACE","\n                        ",118],["T_CONSTANT_ENCAPSED_STRING","'row_amount'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$rowValueExclTax",119],",",["T_WHITESPACE","\n                        ",119],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$baseRowValueExclTax",120],",",["T_WHITESPACE","\n                        ",120],["T_CONSTANT_ENCAPSED_STRING","'base_amount_incl_tax'",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$baseValueInclTax",121],",",["T_WHITESPACE","\n                        ",121],["T_CONSTANT_ENCAPSED_STRING","'amount_incl_tax'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$valueInclTax",122],",",["T_WHITESPACE","\n                        ",122],["T_CONSTANT_ENCAPSED_STRING","'row_amount_incl_tax'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$rowValueInclTax",123],",",["T_WHITESPACE","\n                        ",123],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount_incl_tax'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$baseRowValueInclTax",124],",",["T_WHITESPACE","\n                    ",124],"]",";",["T_WHITESPACE","\n                ",125],"}",["T_WHITESPACE","\n\n                ",126],["T_VARIABLE","$item",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","setWeeeTaxAppliedAmount",128],"(",["T_VARIABLE","$totalValueExclTax",128],")",["T_WHITESPACE","\n                    ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","setBaseWeeeTaxAppliedAmount",129],"(",["T_VARIABLE","$baseTotalValueExclTax",129],")",["T_WHITESPACE","\n                    ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","setWeeeTaxAppliedRowAmount",130],"(",["T_VARIABLE","$totalRowValueExclTax",130],")",["T_WHITESPACE","\n                    ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","setBaseWeeeTaxAppliedRowAmnt",131],"(",["T_VARIABLE","$baseTotalRowValueExclTax",131],")",";",["T_WHITESPACE","\n\n                ",131],["T_VARIABLE","$item",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","setWeeeTaxAppliedAmountInclTax",133],"(",["T_VARIABLE","$totalValueInclTax",133],")",["T_WHITESPACE","\n                    ",133],["T_OBJECT_OPERATOR","->",134],["T_STRING","setBaseWeeeTaxAppliedAmountInclTax",134],"(",["T_VARIABLE","$baseTotalValueInclTax",134],")",["T_WHITESPACE","\n                    ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","setWeeeTaxAppliedRowAmountInclTax",135],"(",["T_VARIABLE","$totalRowValueInclTax",135],")",["T_WHITESPACE","\n                    ",135],["T_OBJECT_OPERATOR","->",136],["T_STRING","setBaseWeeeTaxAppliedRowAmntInclTax",136],"(",["T_VARIABLE","$baseTotalRowValueInclTax",136],")",";",["T_WHITESPACE","\n\n                ",136],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","processTotalAmount",138],"(",["T_WHITESPACE","\n                    ",138],["T_VARIABLE","$total",139],",",["T_WHITESPACE","\n                    ",139],["T_VARIABLE","$totalRowValueExclTax",140],",",["T_WHITESPACE","\n                    ",140],["T_VARIABLE","$baseTotalRowValueExclTax",141],",",["T_WHITESPACE","\n                    ",141],["T_VARIABLE","$totalRowValueInclTax",142],",",["T_WHITESPACE","\n                    ",142],["T_VARIABLE","$baseTotalRowValueInclTax",143],["T_WHITESPACE","\n                ",143],")",";",["T_WHITESPACE","\n\n                ",144],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","weeeData",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","setApplied",146],"(",["T_VARIABLE","$item",146],",",["T_WHITESPACE"," ",146],["T_STRING","array_merge",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","weeeData",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getApplied",146],"(",["T_VARIABLE","$item",146],")",",",["T_WHITESPACE"," ",146],["T_VARIABLE","$productTaxes",146],")",")",";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n        ",148],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * Given a mapping from a weeeCode to an item, create a mapping from the item to the list of weeeCodes.\n     *\n     * Example of input:\n     *  [\n     *      \"weeeCode1\" -> item1,\n     *      \"weeeCode2\" -> item1,\n     *      ...\n     *      \"weeeCodeX\" -> item22,\n     *      \"weeeCodeY\" -> item22,\n     *      ...\n     *   ]\n     *\n     * Example of output:\n     *  [\n     *    item1Id  -> [ \"item\"  -> item1,\n     *                  \"weeeCodes\" -> [weeeCode1, weeeCode2, ...]\n     *                ],\n     *    ...\n     *    item22Id -> [ \"item\"  -> item22,\n     *                  \"weeeCodes\" -> [weeeCodeX, weeeCodeY, ...]\n     *                ],\n     *    ...\n     *  ]\n     *\n     * @param array $weeeCodeToItemMap\n     * @return array\n     *\/",152],["T_WHITESPACE","\n    ",179],["T_PROTECTED","protected",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","createItemToWeeeCodeMapping",180],"(",["T_VARIABLE","$weeeCodeToItemMap",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$itemToCodeMap",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],"[","]",";",["T_WHITESPACE","\n        ",182],["T_FOREACH","foreach",183],["T_WHITESPACE"," ",183],"(",["T_VARIABLE","$weeeCodeToItemMap",183],["T_WHITESPACE"," ",183],["T_AS","as",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$weeeCode",183],["T_WHITESPACE"," ",183],["T_DOUBLE_ARROW","=>",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$item",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$key",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","spl_object_hash",184],"(",["T_VARIABLE","$item",184],")",";",["T_WHITESPACE","  ",184],["T_COMMENT","\/\/ note: $item->getItemId() can be null\n",184],["T_WHITESPACE","            ",185],["T_IF","if",185],["T_WHITESPACE"," ",185],"(","!",["T_STRING","array_key_exists",185],"(",["T_VARIABLE","$key",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$itemToCodeMap",185],")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                ",185],["T_COMMENT","\/\/Create the initial structure for this item\n",186],["T_WHITESPACE","                ",187],["T_VARIABLE","$itemToCodeMap",187],"[",["T_VARIABLE","$key",187],"]",["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",187],["T_WHITESPACE"," ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$item",187],",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'weeeCodes'",187],["T_WHITESPACE"," ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],"[",["T_VARIABLE","$weeeCode",187],"]","]",";",["T_WHITESPACE","\n            ",187],"}",["T_WHITESPACE"," ",188],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                ",188],["T_COMMENT","\/\/Append the weeeCode to the existing structure\n",189],["T_WHITESPACE","                ",190],["T_VARIABLE","$itemToCodeMap",190],"[",["T_VARIABLE","$key",190],"]","[",["T_CONSTANT_ENCAPSED_STRING","'weeeCodes'",190],"]","[","]",["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$weeeCode",190],";",["T_WHITESPACE","\n            ",190],"}",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$itemToCodeMap",193],";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Process row amount based on FPT total amount configuration setting\n     *\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @param float $rowValueExclTax\n     * @param float $baseRowValueExclTax\n     * @param float $rowValueInclTax\n     * @param float $baseRowValueInclTax\n     * @return $this\n     *\/",196],["T_WHITESPACE","\n    ",205],["T_PROTECTED","protected",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","processTotalAmount",206],"(",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$total",207],",",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$rowValueExclTax",208],",",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$baseRowValueExclTax",209],",",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$rowValueInclTax",210],",",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$baseRowValueInclTax",211],["T_WHITESPACE","\n    ",211],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n        ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","weeeData",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","includeInSubtotal",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_store",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$total",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","addTotalAmount",214],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$rowValueExclTax",214],")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$total",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","addBaseTotalAmount",215],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$baseRowValueExclTax",215],")",";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE"," ",216],["T_ELSE","else",216],["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$total",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","addTotalAmount",217],"(",["T_CONSTANT_ENCAPSED_STRING","'weee'",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$rowValueExclTax",217],")",";",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$total",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","addBaseTotalAmount",218],"(",["T_CONSTANT_ENCAPSED_STRING","'weee'",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$baseRowValueExclTax",218],")",";",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n\n        ",219],["T_VARIABLE","$total",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setSubtotalInclTax",221],"(",["T_VARIABLE","$total",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getSubtotalInclTax",221],"(",")",["T_WHITESPACE"," ",221],"+",["T_WHITESPACE"," ",221],["T_VARIABLE","$rowValueInclTax",221],")",";",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$total",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","setBaseSubtotalInclTax",222],"(",["T_VARIABLE","$total",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getBaseSubtotalInclTax",222],"(",")",["T_WHITESPACE"," ",222],"+",["T_WHITESPACE"," ",222],["T_VARIABLE","$baseRowValueInclTax",222],")",";",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Fetch the Weee total amount for display in totals block when building the initial quote\n     *\n     * @param \\Magento\\Quote\\Model\\Quote $quote\n     * @param \\Magento\\Quote\\Model\\Quote\\Address\\Total $total\n     * @return array\n     *\/",226],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","fetch",233],"(",["T_NS_SEPARATOR","\\",233],["T_STRING","Magento",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Quote",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Model",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Quote",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$quote",233],",",["T_WHITESPACE"," ",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Magento",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Quote",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Model",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Quote",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Address",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Total",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$total",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_DOC_COMMENT","\/** @var $items \\Magento\\Sales\\Model\\Order\\Item[] *\/",235],["T_WHITESPACE","\n        ",235],["T_VARIABLE","$items",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_ISSET","isset",236],"(",["T_VARIABLE","$total",236],"[",["T_CONSTANT_ENCAPSED_STRING","'address_quote_items'",236],"]",")",["T_WHITESPACE"," ",236],"?",["T_WHITESPACE"," ",236],["T_VARIABLE","$total",236],"[",["T_CONSTANT_ENCAPSED_STRING","'address_quote_items'",236],"]",["T_WHITESPACE"," ",236],":",["T_WHITESPACE"," ",236],"[","]",";",["T_WHITESPACE","\n\n        ",236],["T_VARIABLE","$weeeTotal",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","weeeData",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getTotalAmounts",238],"(",["T_VARIABLE","$items",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$quote",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getStore",238],"(",")",")",";",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_VARIABLE","$weeeTotal",239],")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],"[",["T_WHITESPACE","\n                ",240],["T_CONSTANT_ENCAPSED_STRING","'code'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getCode",241],"(",")",",",["T_WHITESPACE","\n                ",241],["T_CONSTANT_ENCAPSED_STRING","'title'",242],["T_WHITESPACE"," ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_STRING","__",242],"(",["T_CONSTANT_ENCAPSED_STRING","'FPT'",242],")",",",["T_WHITESPACE","\n                ",242],["T_CONSTANT_ENCAPSED_STRING","'value'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$weeeTotal",243],",",["T_WHITESPACE","\n                ",243],["T_CONSTANT_ENCAPSED_STRING","'area'",244],["T_WHITESPACE"," ",244],["T_DOUBLE_ARROW","=>",244],["T_WHITESPACE"," ",244],["T_STRING","null",244],",",["T_WHITESPACE","\n            ",244],"]",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n        ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_STRING","null",247],";",["T_WHITESPACE","\n    ",247],"}",["T_WHITESPACE","\n",248],"}",["T_WHITESPACE","\n",249]]