[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Quote",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Item",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Quote",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CartInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Quote",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","CartItemInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Exception",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CouldNotSaveException",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Exception",11],["T_NS_SEPARATOR","\\",11],["T_STRING","InputException",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Exception",12],["T_NS_SEPARATOR","\\",12],["T_STRING","NoSuchEntityException",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Exception",13],["T_NS_SEPARATOR","\\",13],["T_STRING","LocalizedException",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Catalog",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Api",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ProductRepositoryInterface",14],";",["T_WHITESPACE","\n\n",14],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","CartItemPersister",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * @var ProductRepositoryInterface\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PRIVATE","private",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$productRepository",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var CartItemOptionsProcessor\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$cartItemOptionProcessor",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @param ProductRepositoryInterface $productRepository\n     * @param CartItemOptionsProcessor $cartItemOptionProcessor\n     *\/",28],["T_WHITESPACE","\n    ",31],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","__construct",32],"(",["T_WHITESPACE","\n        ",32],["T_STRING","ProductRepositoryInterface",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$productRepository",33],",",["T_WHITESPACE","\n        ",33],["T_STRING","CartItemOptionsProcessor",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$cartItemOptionProcessor",34],["T_WHITESPACE","\n    ",34],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","productRepository",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$productRepository",36],";",["T_WHITESPACE","\n        ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","cartItemOptionProcessor",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$cartItemOptionProcessor",37],";",["T_WHITESPACE","\n    ",37],"}",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * @param CartInterface $quote\n     * @param CartItemInterface $item\n     * @return CartItemInterface\n     * @throws CouldNotSaveException\n     * @throws InputException\n     * @throws LocalizedException\n     * @throws NoSuchEntityException\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",40],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","save",50],"(",["T_STRING","CartInterface",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$quote",50],",",["T_WHITESPACE"," ",50],["T_STRING","CartItemInterface",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$item",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote $quote *\/",52],["T_WHITESPACE","\n        ",52],["T_VARIABLE","$qty",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$item",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getQty",53],"(",")",";",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_STRING","is_numeric",54],"(",["T_VARIABLE","$qty",54],")",["T_WHITESPACE"," ",54],["T_BOOLEAN_OR","||",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$qty",54],["T_WHITESPACE"," ",54],["T_IS_SMALLER_OR_EQUAL","<=",54],["T_WHITESPACE"," ",54],["T_LNUMBER","0",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_THROW","throw",55],["T_WHITESPACE"," ",55],["T_STRING","InputException",55],["T_DOUBLE_COLON","::",55],["T_STRING","invalidFieldValue",55],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$qty",55],")",";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$cartId",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$item",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getQuoteId",57],"(",")",";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$itemId",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$item",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getItemId",58],"(",")",";",["T_WHITESPACE","\n        ",58],["T_TRY","try",59],["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n            ",59],["T_DOC_COMMENT","\/** Update existing item *\/",60],["T_WHITESPACE","\n            ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(",["T_ISSET","isset",61],"(",["T_VARIABLE","$itemId",61],")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n                ",61],["T_VARIABLE","$currentItem",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$quote",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getItemById",62],"(",["T_VARIABLE","$itemId",62],")",";",["T_WHITESPACE","\n                ",62],["T_IF","if",63],["T_WHITESPACE"," ",63],"(","!",["T_VARIABLE","$currentItem",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n                    ",63],["T_THROW","throw",64],["T_WHITESPACE"," ",64],["T_NEW","new",64],["T_WHITESPACE"," ",64],["T_STRING","NoSuchEntityException",64],"(",["T_WHITESPACE","\n                        ",64],["T_STRING","__",65],"(",["T_CONSTANT_ENCAPSED_STRING","'Cart %1 does not contain item %2'",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$cartId",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$itemId",65],")",["T_WHITESPACE","\n                    ",65],")",";",["T_WHITESPACE","\n                ",66],"}",["T_WHITESPACE","\n                ",67],["T_VARIABLE","$productType",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$currentItem",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getProduct",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","getTypeId",68],"(",")",";",["T_WHITESPACE","\n                ",68],["T_VARIABLE","$buyRequestData",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","cartItemOptionProcessor",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getBuyRequest",69],"(",["T_VARIABLE","$productType",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$item",69],")",";",["T_WHITESPACE","\n                ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_STRING","is_object",70],"(",["T_VARIABLE","$buyRequestData",70],")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                    ",70],["T_DOC_COMMENT","\/** Update item product options *\/",71],["T_WHITESPACE","\n                    ",71],["T_VARIABLE","$item",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$quote",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","updateItem",72],"(",["T_VARIABLE","$itemId",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$buyRequestData",72],")",";",["T_WHITESPACE","\n                ",72],"}",["T_WHITESPACE"," ",73],["T_ELSE","else",73],["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                    ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$item",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getQty",74],"(",")",["T_WHITESPACE"," ",74],["T_IS_NOT_IDENTICAL","!==",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$currentItem",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getQty",74],"(",")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                        ",74],["T_VARIABLE","$currentItem",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","setQty",75],"(",["T_VARIABLE","$qty",75],")",";",["T_WHITESPACE","\n                        ",75],["T_DOC_COMMENT","\/**\n                         * Qty validation errors are stored as items message\n                         * @see \\Magento\\CatalogInventory\\Model\\Quote\\Item\\QuantityValidator::validate\n                         *\/",76],["T_WHITESPACE","\n                        ",79],["T_IF","if",80],["T_WHITESPACE"," ",80],"(","!",["T_EMPTY","empty",80],"(",["T_VARIABLE","$currentItem",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getMessage",80],"(",")",")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n                            ",80],["T_THROW","throw",81],["T_WHITESPACE"," ",81],["T_NEW","new",81],["T_WHITESPACE"," ",81],["T_STRING","LocalizedException",81],"(",["T_STRING","__",81],"(",["T_VARIABLE","$currentItem",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getMessage",81],"(",")",")",")",";",["T_WHITESPACE","\n                        ",81],"}",["T_WHITESPACE","\n                    ",82],"}",["T_WHITESPACE","\n                ",83],"}",["T_WHITESPACE","\n            ",84],"}",["T_WHITESPACE"," ",85],["T_ELSE","else",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_DOC_COMMENT","\/** add new item to shopping cart *\/",86],["T_WHITESPACE","\n                ",86],["T_VARIABLE","$product",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","productRepository",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","get",87],"(",["T_VARIABLE","$item",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getSku",87],"(",")",")",";",["T_WHITESPACE","\n                ",87],["T_VARIABLE","$productType",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$product",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getTypeId",88],"(",")",";",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$item",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$quote",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","addProduct",89],"(",["T_WHITESPACE","\n                    ",89],["T_VARIABLE","$product",90],",",["T_WHITESPACE","\n                    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","cartItemOptionProcessor",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getBuyRequest",91],"(",["T_VARIABLE","$productType",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$item",91],")",["T_WHITESPACE","\n                ",91],")",";",["T_WHITESPACE","\n                ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_STRING","is_string",93],"(",["T_VARIABLE","$item",93],")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                    ",93],["T_THROW","throw",94],["T_WHITESPACE"," ",94],["T_NEW","new",94],["T_WHITESPACE"," ",94],["T_STRING","LocalizedException",94],"(",["T_STRING","__",94],"(",["T_VARIABLE","$item",94],")",")",";",["T_WHITESPACE","\n                ",94],"}",["T_WHITESPACE","\n            ",95],"}",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE"," ",97],["T_CATCH","catch",97],["T_WHITESPACE"," ",97],"(",["T_STRING","NoSuchEntityException",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$e",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_THROW","throw",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$e",98],";",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE"," ",99],["T_CATCH","catch",99],["T_WHITESPACE"," ",99],"(",["T_STRING","LocalizedException",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$e",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_THROW","throw",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$e",100],";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE"," ",101],["T_CATCH","catch",101],["T_WHITESPACE"," ",101],"(",["T_NS_SEPARATOR","\\",101],["T_STRING","Exception",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$e",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_THROW","throw",102],["T_WHITESPACE"," ",102],["T_NEW","new",102],["T_WHITESPACE"," ",102],["T_STRING","CouldNotSaveException",102],"(",["T_STRING","__",102],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not save quote'",102],")",")",";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$itemId",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$item",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getId",104],"(",")",";",["T_WHITESPACE","\n        ",104],["T_FOREACH","foreach",105],["T_WHITESPACE"," ",105],"(",["T_VARIABLE","$quote",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getAllItems",105],"(",")",["T_WHITESPACE"," ",105],["T_AS","as",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$quoteItem",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_DOC_COMMENT","\/** @var \\Magento\\Quote\\Model\\Quote\\Item $quoteItem *\/",106],["T_WHITESPACE","\n            ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$itemId",107],["T_WHITESPACE"," ",107],["T_IS_EQUAL","==",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$quoteItem",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getId",107],"(",")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                ",107],["T_VARIABLE","$item",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","cartItemOptionProcessor",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","addProductOptions",108],"(",["T_VARIABLE","$productType",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$quoteItem",108],")",";",["T_WHITESPACE","\n                ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","cartItemOptionProcessor",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","applyCustomOptions",109],"(",["T_VARIABLE","$item",109],")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n        ",111],["T_THROW","throw",112],["T_WHITESPACE"," ",112],["T_NEW","new",112],["T_WHITESPACE"," ",112],["T_STRING","CouldNotSaveException",112],"(",["T_STRING","__",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not save quote'",112],")",")",";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n",113],"}",["T_WHITESPACE","\n",114]]