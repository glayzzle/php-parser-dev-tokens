[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","CatalogImportExport",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Import",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","App",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Filesystem",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DirectoryList",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Filesystem",9],["T_NS_SEPARATOR","\\",9],["T_STRING","DriverPool",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Import entity product model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",11],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","Uploader",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","MediaStorage",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","File",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Uploader",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * Temp directory.\n     *\n     * @var string\n     *\/",18],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_tmpDir",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","''",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Destination directory.\n     *\n     * @var string\n     *\/",25],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$_destDir",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","''",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * All mime types.\n     *\n     * @var array\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_allowedMimeTypes",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],"[",["T_WHITESPACE","\n        ",37],["T_CONSTANT_ENCAPSED_STRING","'jpg'",38],["T_WHITESPACE"," ",38],["T_DOUBLE_ARROW","=>",38],["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'image\/jpeg'",38],",",["T_WHITESPACE","\n        ",38],["T_CONSTANT_ENCAPSED_STRING","'jpeg'",39],["T_WHITESPACE"," ",39],["T_DOUBLE_ARROW","=>",39],["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'image\/jpeg'",39],",",["T_WHITESPACE","\n        ",39],["T_CONSTANT_ENCAPSED_STRING","'gif'",40],["T_WHITESPACE"," ",40],["T_DOUBLE_ARROW","=>",40],["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'image\/gif'",40],",",["T_WHITESPACE","\n        ",40],["T_CONSTANT_ENCAPSED_STRING","'png'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'image\/png'",41],",",["T_WHITESPACE","\n    ",41],"]",";",["T_WHITESPACE","\n\n    ",42],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","DEFAULT_FILE_TYPE",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'application\/octet-stream'",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Image factory.\n     *\n     * @var \\Magento\\Framework\\Image\\AdapterFactory\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_imageFactory",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Validator.\n     *\n     * @var \\Magento\\MediaStorage\\Model\\File\\Validator\\NotProtectedExtension\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_validator",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Instance of filesystem directory write interface.\n     *\n     * @var \\Magento\\Framework\\Filesystem\\Directory\\WriteInterface\n     *\/",60],["T_WHITESPACE","\n    ",64],["T_PROTECTED","protected",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$_directory",65],";",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Instance of filesystem read factory.\n     *\n     * @var \\Magento\\Framework\\Filesystem\\File\\ReadFactory\n     *\/",67],["T_WHITESPACE","\n    ",71],["T_PROTECTED","protected",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$_readFactory",72],";",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Instance of media file storage database.\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database\n     *\/",74],["T_WHITESPACE","\n    ",78],["T_PROTECTED","protected",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$_coreFileStorageDb",79],";",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Instance of media file storage.\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\n     *\/",81],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$_coreFileStorage",86],";",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database $coreFileStorageDb\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage $coreFileStorage\n     * @param \\Magento\\Framework\\Image\\AdapterFactory $imageFactory\n     * @param \\Magento\\MediaStorage\\Model\\File\\Validator\\NotProtectedExtension $validator\n     * @param \\Magento\\Framework\\Filesystem $filesystem\n     * @param \\Magento\\Framework\\Filesystem\\File\\ReadFactory $readFactory\n     * @param null $filePath\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",88],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","__construct",98],"(",["T_WHITESPACE","\n        ",98],["T_NS_SEPARATOR","\\",99],["T_STRING","Magento",99],["T_NS_SEPARATOR","\\",99],["T_STRING","MediaStorage",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Helper",99],["T_NS_SEPARATOR","\\",99],["T_STRING","File",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Storage",99],["T_NS_SEPARATOR","\\",99],["T_STRING","Database",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$coreFileStorageDb",99],",",["T_WHITESPACE","\n        ",99],["T_NS_SEPARATOR","\\",100],["T_STRING","Magento",100],["T_NS_SEPARATOR","\\",100],["T_STRING","MediaStorage",100],["T_NS_SEPARATOR","\\",100],["T_STRING","Helper",100],["T_NS_SEPARATOR","\\",100],["T_STRING","File",100],["T_NS_SEPARATOR","\\",100],["T_STRING","Storage",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$coreFileStorage",100],",",["T_WHITESPACE","\n        ",100],["T_NS_SEPARATOR","\\",101],["T_STRING","Magento",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Framework",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Image",101],["T_NS_SEPARATOR","\\",101],["T_STRING","AdapterFactory",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$imageFactory",101],",",["T_WHITESPACE","\n        ",101],["T_NS_SEPARATOR","\\",102],["T_STRING","Magento",102],["T_NS_SEPARATOR","\\",102],["T_STRING","MediaStorage",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Model",102],["T_NS_SEPARATOR","\\",102],["T_STRING","File",102],["T_NS_SEPARATOR","\\",102],["T_STRING","Validator",102],["T_NS_SEPARATOR","\\",102],["T_STRING","NotProtectedExtension",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$validator",102],",",["T_WHITESPACE","\n        ",102],["T_NS_SEPARATOR","\\",103],["T_STRING","Magento",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Framework",103],["T_NS_SEPARATOR","\\",103],["T_STRING","Filesystem",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$filesystem",103],",",["T_WHITESPACE","\n        ",103],["T_NS_SEPARATOR","\\",104],["T_STRING","Magento",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Framework",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Filesystem",104],["T_NS_SEPARATOR","\\",104],["T_STRING","File",104],["T_NS_SEPARATOR","\\",104],["T_STRING","ReadFactory",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$readFactory",104],",",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$filePath",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","null",105],["T_WHITESPACE","\n    ",105],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n        ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$filePath",107],["T_WHITESPACE"," ",107],["T_IS_NOT_IDENTICAL","!==",107],["T_WHITESPACE"," ",107],["T_STRING","null",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_setUploadFile",108],"(",["T_VARIABLE","$filePath",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_imageFactory",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$imageFactory",110],";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_coreFileStorageDb",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$coreFileStorageDb",111],";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_coreFileStorage",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$coreFileStorage",112],";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_validator",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$validator",113],";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_directory",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$filesystem",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getDirectoryWrite",114],"(",["T_STRING","DirectoryList",114],["T_DOUBLE_COLON","::",114],["T_STRING","ROOT",114],")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_readFactory",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$readFactory",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Initiate uploader default settings\n     *\n     * @return void\n     *\/",118],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","init",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","setAllowRenameFiles",125],"(",["T_STRING","true",125],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","setAllowCreateFolders",126],"(",["T_STRING","true",126],")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","setFilesDispersion",127],"(",["T_STRING","true",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","setAllowedExtensions",128],"(",["T_STRING","array_keys",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_allowedMimeTypes",128],")",")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$imageAdapter",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_imageFactory",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","create",129],"(",")",";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","addValidateCallback",130],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_image'",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$imageAdapter",130],",",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'validateUploadFile'",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_uploadType",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","self",131],["T_DOUBLE_COLON","::",131],["T_STRING","SINGLE_STYLE",131],";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Proceed moving a file from TMP to destination folder\n     *\n     * @param string $fileName\n     * @param bool $renameFileOff\n     * @return array\n     *\/",134],["T_WHITESPACE","\n    ",140],["T_PUBLIC","public",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","move",141],"(",["T_VARIABLE","$fileName",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$renameFileOff",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","false",141],")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$renameFileOff",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setAllowRenameFiles",144],"(",["T_STRING","false",144],")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_STRING","preg_match",146],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\bhttps?:\\\/\\\/\/i'",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$fileName",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$matches",146],")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$url",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_STRING","str_replace",147],"(",["T_VARIABLE","$matches",147],"[",["T_LNUMBER","0",147],"]",",",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","''",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$fileName",147],")",";",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$read",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_readFactory",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","create",148],"(",["T_VARIABLE","$url",148],",",["T_WHITESPACE"," ",148],["T_STRING","DriverPool",148],["T_DOUBLE_COLON","::",148],["T_STRING","HTTP",148],")",";",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$fileName",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","preg_replace",149],"(",["T_CONSTANT_ENCAPSED_STRING","'\/[^a-z0-9\\._-]+\/i'",149],",",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","''",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$fileName",149],")",";",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_directory",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","writeFile",150],"(",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_directory",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getRelativePath",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getTmpDir",151],"(",")",["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'\/'",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_VARIABLE","$fileName",151],")",",",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$read",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","readAll",152],"(",")",["T_WHITESPACE","\n            ",152],")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n\n        ",154],["T_VARIABLE","$filePath",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_directory",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getRelativePath",156],"(",["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getTmpDir",156],"(",")",["T_WHITESPACE"," ",156],".",["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","'\/'",156],["T_WHITESPACE"," ",156],".",["T_WHITESPACE"," ",156],["T_VARIABLE","$fileName",156],")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_setUploadFile",157],"(",["T_VARIABLE","$filePath",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$destDir",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_directory",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getAbsolutePath",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getDestDir",158],"(",")",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$result",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","save",159],"(",["T_VARIABLE","$destDir",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$result",160],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",160],"]",["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","self",160],["T_DOUBLE_COLON","::",160],["T_STRING","getCorrectFileName",160],"(",["T_VARIABLE","$result",160],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",160],"]",")",";",["T_WHITESPACE","\n        ",160],["T_RETURN","return",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$result",161],";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Prepare information about the file for moving\n     *\n     * @param string $filePath\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",164],["T_WHITESPACE","\n    ",170],["T_PROTECTED","protected",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","_setUploadFile",171],"(",["T_VARIABLE","$filePath",171],")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(","!",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_directory",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","isReadable",173],"(",["T_VARIABLE","$filePath",173],")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_THROW","throw",174],["T_WHITESPACE"," ",174],["T_NEW","new",174],["T_WHITESPACE"," ",174],["T_NS_SEPARATOR","\\",174],["T_STRING","Magento",174],["T_NS_SEPARATOR","\\",174],["T_STRING","Framework",174],["T_NS_SEPARATOR","\\",174],["T_STRING","Exception",174],["T_NS_SEPARATOR","\\",174],["T_STRING","LocalizedException",174],"(",["T_WHITESPACE","\n                ",174],["T_STRING","__",175],"(",["T_CONSTANT_ENCAPSED_STRING","'File \\'%1\\' was not found or has read restriction.'",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$filePath",175],")",["T_WHITESPACE","\n            ",175],")",";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_file",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_readFileInfo",178],"(",["T_VARIABLE","$filePath",178],")",";",["T_WHITESPACE","\n\n        ",178],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_validateFile",180],"(",")",";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Reads file info\n     *\n     * @param string $filePath\n     * @return array\n     *\/",183],["T_WHITESPACE","\n    ",188],["T_PROTECTED","protected",189],["T_WHITESPACE"," ",189],["T_FUNCTION","function",189],["T_WHITESPACE"," ",189],["T_STRING","_readFileInfo",189],"(",["T_VARIABLE","$filePath",189],")",["T_WHITESPACE","\n    ",189],"{",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$fullFilePath",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_directory",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getAbsolutePath",191],"(",["T_VARIABLE","$filePath",191],")",";",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$fileInfo",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","pathinfo",192],"(",["T_VARIABLE","$fullFilePath",192],")",";",["T_WHITESPACE","\n        ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],"[",["T_WHITESPACE","\n            ",193],["T_CONSTANT_ENCAPSED_STRING","'name'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$fileInfo",194],"[",["T_CONSTANT_ENCAPSED_STRING","'basename'",194],"]",",",["T_WHITESPACE","\n            ",194],["T_CONSTANT_ENCAPSED_STRING","'type'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","_getMimeTypeByExt",195],"(",["T_VARIABLE","$fileInfo",195],"[",["T_CONSTANT_ENCAPSED_STRING","'extension'",195],"]",")",",",["T_WHITESPACE","\n            ",195],["T_CONSTANT_ENCAPSED_STRING","'tmp_name'",196],["T_WHITESPACE"," ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$filePath",196],",",["T_WHITESPACE","\n            ",196],["T_CONSTANT_ENCAPSED_STRING","'error'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_LNUMBER","0",197],",",["T_WHITESPACE","\n            ",197],["T_CONSTANT_ENCAPSED_STRING","'size'",198],["T_WHITESPACE"," ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_directory",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","stat",198],"(",["T_VARIABLE","$filePath",198],")","[",["T_CONSTANT_ENCAPSED_STRING","'size'",198],"]",["T_WHITESPACE","\n        ",198],"]",";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_DOC_COMMENT","\/**\n     * Validate uploaded file by type and etc.\n     *\n     * @return void\n     * @throws \\Exception\n     *\/",202],["T_WHITESPACE","\n    ",207],["T_PROTECTED","protected",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","_validateFile",208],"(",")",["T_WHITESPACE","\n    ",208],"{",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$filePath",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_file",210],"[",["T_CONSTANT_ENCAPSED_STRING","'tmp_name'",210],"]",";",["T_WHITESPACE","\n        ",210],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_directory",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","isReadable",211],"(",["T_VARIABLE","$filePath",211],")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_fileExists",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","true",212],";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE"," ",213],["T_ELSE","else",213],["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_fileExists",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_STRING","false",214],";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$fileExtension",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_STRING","pathinfo",217],"(",["T_VARIABLE","$filePath",217],",",["T_WHITESPACE"," ",217],["T_STRING","PATHINFO_EXTENSION",217],")",";",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(","!",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","checkAllowedExtension",218],"(",["T_VARIABLE","$fileExtension",218],")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_THROW","throw",219],["T_WHITESPACE"," ",219],["T_NEW","new",219],["T_WHITESPACE"," ",219],["T_NS_SEPARATOR","\\",219],["T_STRING","Exception",219],"(",["T_CONSTANT_ENCAPSED_STRING","'Disallowed file type.'",219],")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n        ",220],["T_COMMENT","\/\/run validate callbacks\n",221],["T_WHITESPACE","        ",222],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_validateCallbacks",222],["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$params",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_STRING","is_object",223],"(",["T_VARIABLE","$params",223],"[",["T_CONSTANT_ENCAPSED_STRING","'object'",223],"]",")",["T_WHITESPACE","\n                ",223],["T_BOOLEAN_AND","&&",224],["T_WHITESPACE"," ",224],["T_STRING","method_exists",224],"(",["T_VARIABLE","$params",224],"[",["T_CONSTANT_ENCAPSED_STRING","'object'",224],"]",",",["T_WHITESPACE"," ",224],["T_VARIABLE","$params",224],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",224],"]",")",["T_WHITESPACE","\n                ",224],["T_BOOLEAN_AND","&&",225],["T_WHITESPACE"," ",225],["T_STRING","is_callable",225],"(","[",["T_VARIABLE","$params",225],"[",["T_CONSTANT_ENCAPSED_STRING","'object'",225],"]",",",["T_WHITESPACE"," ",225],["T_VARIABLE","$params",225],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",225],"]","]",")",["T_WHITESPACE","\n            ",225],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n                ",226],["T_VARIABLE","$params",227],"[",["T_CONSTANT_ENCAPSED_STRING","'object'",227],"]",["T_OBJECT_OPERATOR","->",227],"{",["T_VARIABLE","$params",227],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",227],"]","}","(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_directory",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getAbsolutePath",227],"(",["T_VARIABLE","$filePath",227],")",")",";",["T_WHITESPACE","\n            ",227],"}",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_DOC_COMMENT","\/**\n     * Returns file MIME type by extension\n     *\n     * @param string $ext\n     * @return string\n     *\/",232],["T_WHITESPACE","\n    ",237],["T_PROTECTED","protected",238],["T_WHITESPACE"," ",238],["T_FUNCTION","function",238],["T_WHITESPACE"," ",238],["T_STRING","_getMimeTypeByExt",238],"(",["T_VARIABLE","$ext",238],")",["T_WHITESPACE","\n    ",238],"{",["T_WHITESPACE","\n        ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_STRING","array_key_exists",240],"(",["T_VARIABLE","$ext",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_allowedMimeTypes",240],")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_RETURN","return",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_allowedMimeTypes",241],"[",["T_VARIABLE","$ext",241],"]",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n        ",242],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","''",243],";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Obtain TMP file path prefix\n     *\n     * @return string\n     *\/",246],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","getTmpDir",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_tmpDir",253],";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Set TMP file path prefix\n     *\n     * @param string $path\n     * @return bool\n     *\/",256],["T_WHITESPACE","\n    ",261],["T_PUBLIC","public",262],["T_WHITESPACE"," ",262],["T_FUNCTION","function",262],["T_WHITESPACE"," ",262],["T_STRING","setTmpDir",262],"(",["T_VARIABLE","$path",262],")",["T_WHITESPACE","\n    ",262],"{",["T_WHITESPACE","\n        ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_STRING","is_string",264],"(",["T_VARIABLE","$path",264],")",["T_WHITESPACE"," ",264],["T_BOOLEAN_AND","&&",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_directory",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","isReadable",264],"(",["T_VARIABLE","$path",264],")",")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_tmpDir",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$path",265],";",["T_WHITESPACE","\n            ",265],["T_RETURN","return",266],["T_WHITESPACE"," ",266],["T_STRING","true",266],";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n        ",267],["T_RETURN","return",268],["T_WHITESPACE"," ",268],["T_STRING","false",268],";",["T_WHITESPACE","\n    ",268],"}",["T_WHITESPACE","\n\n    ",269],["T_DOC_COMMENT","\/**\n     * Obtain destination file path prefix\n     *\n     * @return string\n     *\/",271],["T_WHITESPACE","\n    ",275],["T_PUBLIC","public",276],["T_WHITESPACE"," ",276],["T_FUNCTION","function",276],["T_WHITESPACE"," ",276],["T_STRING","getDestDir",276],"(",")",["T_WHITESPACE","\n    ",276],"{",["T_WHITESPACE","\n        ",277],["T_RETURN","return",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_destDir",278],";",["T_WHITESPACE","\n    ",278],"}",["T_WHITESPACE","\n\n    ",279],["T_DOC_COMMENT","\/**\n     * Set destination file path prefix\n     *\n     * @param string $path\n     * @return bool\n     *\/",281],["T_WHITESPACE","\n    ",286],["T_PUBLIC","public",287],["T_WHITESPACE"," ",287],["T_FUNCTION","function",287],["T_WHITESPACE"," ",287],["T_STRING","setDestDir",287],"(",["T_VARIABLE","$path",287],")",["T_WHITESPACE","\n    ",287],"{",["T_WHITESPACE","\n        ",288],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_STRING","is_string",289],"(",["T_VARIABLE","$path",289],")",["T_WHITESPACE"," ",289],["T_BOOLEAN_AND","&&",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_directory",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","isWritable",289],"(",["T_VARIABLE","$path",289],")",")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_destDir",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$path",290],";",["T_WHITESPACE","\n            ",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_STRING","true",291],";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n        ",292],["T_RETURN","return",293],["T_WHITESPACE"," ",293],["T_STRING","false",293],";",["T_WHITESPACE","\n    ",293],"}",["T_WHITESPACE","\n\n    ",294],["T_DOC_COMMENT","\/**\n     * Move files from TMP folder into destination folder\n     *\n     * @param string $tmpPath\n     * @param string $destPath\n     * @return bool\n     *\/",296],["T_WHITESPACE","\n    ",302],["T_PROTECTED","protected",303],["T_WHITESPACE"," ",303],["T_FUNCTION","function",303],["T_WHITESPACE"," ",303],["T_STRING","_moveFile",303],"(",["T_VARIABLE","$tmpPath",303],",",["T_WHITESPACE"," ",303],["T_VARIABLE","$destPath",303],")",["T_WHITESPACE","\n    ",303],"{",["T_WHITESPACE","\n        ",304],["T_IF","if",305],["T_WHITESPACE"," ",305],"(",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_directory",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","isFile",305],"(",["T_VARIABLE","$tmpPath",305],")",")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n            ",305],["T_VARIABLE","$tmpRealPath",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_directory",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getDriver",306],"(",")",["T_OBJECT_OPERATOR","->",306],["T_STRING","getRealPath",306],"(",["T_WHITESPACE","\n                ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_directory",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getAbsolutePath",307],"(",["T_VARIABLE","$tmpPath",307],")",["T_WHITESPACE","\n            ",307],")",";",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$destinationRealPath",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_directory",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getDriver",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","getRealPath",309],"(",["T_VARIABLE","$destPath",309],")",";",["T_WHITESPACE","\n            ",309],["T_VARIABLE","$relativeDestPath",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_directory",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getRelativePath",310],"(",["T_VARIABLE","$destPath",310],")",";",["T_WHITESPACE","\n            ",310],["T_VARIABLE","$isSameFile",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$tmpRealPath",311],["T_WHITESPACE"," ",311],["T_IS_IDENTICAL","===",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$destinationRealPath",311],";",["T_WHITESPACE","\n            ",311],["T_RETURN","return",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$isSameFile",312],["T_WHITESPACE"," ",312],"?",":",["T_WHITESPACE"," ",312],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","_directory",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","copyFile",312],"(",["T_VARIABLE","$tmpPath",312],",",["T_WHITESPACE"," ",312],["T_VARIABLE","$relativeDestPath",312],")",";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE"," ",313],["T_ELSE","else",313],["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_RETURN","return",314],["T_WHITESPACE"," ",314],["T_STRING","false",314],";",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE","\n    ",315],"}",["T_WHITESPACE","\n\n    ",316],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",318],["T_WHITESPACE","\n    ",320],["T_PROTECTED","protected",321],["T_WHITESPACE"," ",321],["T_FUNCTION","function",321],["T_WHITESPACE"," ",321],["T_STRING","chmod",321],"(",["T_VARIABLE","$file",321],")",["T_WHITESPACE","\n    ",321],"{",["T_WHITESPACE","\n        ",322],["T_RETURN","return",323],";",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n",324],"}",["T_WHITESPACE","\n",325]]