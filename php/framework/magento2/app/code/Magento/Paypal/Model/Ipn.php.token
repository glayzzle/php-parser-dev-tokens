[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Paypal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Exception",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Sales",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Order",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Email",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Sender",12],["T_NS_SEPARATOR","\\",12],["T_STRING","CreditmemoSender",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sales",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Order",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Email",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sender",13],["T_NS_SEPARATOR","\\",13],["T_STRING","OrderSender",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Paypal",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Info",14],";",["T_WHITESPACE","\n\n",14],["T_DOC_COMMENT","\/**\n * PayPal Instant Payment Notification processor model\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",16],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","Ipn",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Magento",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Paypal",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Model",20],["T_NS_SEPARATOR","\\",20],["T_STRING","AbstractIpn",20],["T_WHITESPACE"," ",20],["T_IMPLEMENTS","implements",20],["T_WHITESPACE"," ",20],["T_STRING","IpnInterface",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\Order\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$_order",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\OrderFactory\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$_orderFactory",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * PayPal info instance\n     *\n     * @var Info\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_paypalInfo",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * @var OrderSender\n     *\/",39],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$orderSender",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * @var CreditmemoSender\n     *\/",44],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$creditmemoSender",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Paypal\\Model\\ConfigFactory $configFactory\n     * @param \\Psr\\Log\\LoggerInterface $logger\n     * @param \\Magento\\Framework\\HTTP\\Adapter\\CurlFactory $curlFactory\n     * @param \\Magento\\Sales\\Model\\OrderFactory $orderFactory\n     * @param Info $paypalInfo\n     * @param OrderSender $orderSender\n     * @param CreditmemoSender $creditmemoSender\n     * @param array $data\n     *\/",49],["T_WHITESPACE","\n    ",58],["T_PUBLIC","public",59],["T_WHITESPACE"," ",59],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","__construct",59],"(",["T_WHITESPACE","\n        ",59],["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Paypal",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Model",60],["T_NS_SEPARATOR","\\",60],["T_STRING","ConfigFactory",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$configFactory",60],",",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Psr",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Log",61],["T_NS_SEPARATOR","\\",61],["T_STRING","LoggerInterface",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$logger",61],",",["T_WHITESPACE","\n        ",61],["T_NS_SEPARATOR","\\",62],["T_STRING","Magento",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Framework",62],["T_NS_SEPARATOR","\\",62],["T_STRING","HTTP",62],["T_NS_SEPARATOR","\\",62],["T_STRING","Adapter",62],["T_NS_SEPARATOR","\\",62],["T_STRING","CurlFactory",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$curlFactory",62],",",["T_WHITESPACE","\n        ",62],["T_NS_SEPARATOR","\\",63],["T_STRING","Magento",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Sales",63],["T_NS_SEPARATOR","\\",63],["T_STRING","Model",63],["T_NS_SEPARATOR","\\",63],["T_STRING","OrderFactory",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$orderFactory",63],",",["T_WHITESPACE","\n        ",63],["T_STRING","Info",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$paypalInfo",64],",",["T_WHITESPACE","\n        ",64],["T_STRING","OrderSender",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$orderSender",65],",",["T_WHITESPACE","\n        ",65],["T_STRING","CreditmemoSender",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$creditmemoSender",66],",",["T_WHITESPACE","\n        ",66],["T_ARRAY","array",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$data",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],"[","]",["T_WHITESPACE","\n    ",67],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n        ",68],["T_STRING","parent",69],["T_DOUBLE_COLON","::",69],["T_STRING","__construct",69],"(",["T_VARIABLE","$configFactory",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$logger",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$curlFactory",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$data",69],")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_orderFactory",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$orderFactory",70],";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_paypalInfo",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$paypalInfo",71],";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","orderSender",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$orderSender",72],";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","creditmemoSender",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$creditmemoSender",73],";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Get ipn data, send verification to PayPal, run corresponding handler\n     *\n     * @return void\n     * @throws Exception\n     *\/",76],["T_WHITESPACE","\n    ",81],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","processIpnRequest",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_addDebugData",84],"(",["T_CONSTANT_ENCAPSED_STRING","'ipn'",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getRequestData",84],"(",")",")",";",["T_WHITESPACE","\n\n        ",84],["T_TRY","try",86],["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_getConfig",87],"(",")",";",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_postBack",88],"(",")",";",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_processOrder",89],"(",")",";",["T_WHITESPACE","\n        ",89],"}",["T_WHITESPACE"," ",90],["T_CATCH","catch",90],["T_WHITESPACE"," ",90],"(",["T_STRING","Exception",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$e",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_addDebugData",91],"(",["T_CONSTANT_ENCAPSED_STRING","'exception'",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$e",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getMessage",91],"(",")",")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_debug",92],"(",")",";",["T_WHITESPACE","\n            ",92],["T_THROW","throw",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$e",93],";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_debug",95],"(",")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Get config with the method code and store id and validate\n     *\n     * @return \\Magento\\Paypal\\Model\\Config\n     * @throws Exception\n     *\/",98],["T_WHITESPACE","\n    ",103],["T_PROTECTED","protected",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","_getConfig",104],"(",")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$order",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_getOrder",106],"(",")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$methodCode",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$order",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getPayment",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","getMethod",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$parameters",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],"[",["T_VARIABLE","$methodCode",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$order",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getStoreId",108],"(",")","]","]",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_config",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_configFactory",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","create",109],"(",["T_VARIABLE","$parameters",109],")",";",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_config",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","isMethodActive",110],"(",["T_VARIABLE","$methodCode",110],")",["T_WHITESPACE"," ",110],["T_BOOLEAN_OR","||",110],["T_WHITESPACE"," ",110],"!",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_config",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","isMethodAvailable",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_THROW","throw",111],["T_WHITESPACE"," ",111],["T_NEW","new",111],["T_WHITESPACE"," ",111],["T_STRING","Exception",111],"(",["T_STRING","sprintf",111],"(",["T_CONSTANT_ENCAPSED_STRING","'Method \"%s\" is not available.'",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$methodCode",111],")",")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n        ",112],["T_DOC_COMMENT","\/** @link https:\/\/cms.paypal.com\/cgi-bin\/marketingweb?cmd=_render-content&content_ID=developer\/e_howto_admin_IPNIntro *\/",113],["T_WHITESPACE","\n        ",113],["T_COMMENT","\/\/ verify merchant email intended to receive notification\n",114],["T_WHITESPACE","        ",115],["T_VARIABLE","$merchantEmail",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_config",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getValue",115],"(",["T_CONSTANT_ENCAPSED_STRING","'businessAccount'",115],")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_VARIABLE","$merchantEmail",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_config",117],";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$receiver",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getRequestData",119],"(",["T_CONSTANT_ENCAPSED_STRING","'business'",119],")",["T_WHITESPACE"," ",119],"?",":",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getRequestData",119],"(",["T_CONSTANT_ENCAPSED_STRING","'receiver_email'",119],")",";",["T_WHITESPACE","\n        ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_STRING","strtolower",120],"(",["T_VARIABLE","$merchantEmail",120],")",["T_WHITESPACE"," ",120],["T_IS_NOT_EQUAL","!=",120],["T_WHITESPACE"," ",120],["T_STRING","strtolower",120],"(",["T_VARIABLE","$receiver",120],")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_THROW","throw",121],["T_WHITESPACE"," ",121],["T_NEW","new",121],["T_WHITESPACE"," ",121],["T_STRING","Exception",121],"(",["T_WHITESPACE","\n                ",121],["T_STRING","sprintf",122],"(",["T_CONSTANT_ENCAPSED_STRING","'The requested %s and configured %s merchant emails do not match.'",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$receiver",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$merchantEmail",122],")",["T_WHITESPACE","\n            ",122],")",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_config",126],";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Load order\n     *\n     * @return \\Magento\\Sales\\Model\\Order\n     * @throws Exception\n     *\/",129],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","_getOrder",135],"(",")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$incrementId",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getRequestData",137],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice'",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_order",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_orderFactory",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","create",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","loadByIncrementId",138],"(",["T_VARIABLE","$incrementId",138],")",";",["T_WHITESPACE","\n        ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(","!",["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_order",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getId",139],"(",")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_THROW","throw",140],["T_WHITESPACE"," ",140],["T_NEW","new",140],["T_WHITESPACE"," ",140],["T_STRING","Exception",140],"(",["T_STRING","sprintf",140],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong order ID: \"%s\".'",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$incrementId",140],")",")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_order",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * IPN workflow implementation\n     * Everything should be added to order comments. In positive processing cases customer will get email notifications.\n     * Admin will be notified on errors.\n     *\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",145],["T_WHITESPACE","\n    ",152],["T_PROTECTED","protected",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","_processOrder",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_getConfig",155],"(",")",";",["T_WHITESPACE","\n        ",155],["T_TRY","try",156],["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_COMMENT","\/\/ Handle payment_status\n",157],["T_WHITESPACE","            ",158],["T_VARIABLE","$transactionType",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getRequestData",158],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",158],")",";",["T_WHITESPACE","\n            ",158],["T_SWITCH","switch",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$transactionType",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                ",159],["T_COMMENT","\/\/ handle new case created\n",160],["T_WHITESPACE","                ",161],["T_CASE","case",161],["T_WHITESPACE"," ",161],["T_STRING","Info",161],["T_DOUBLE_COLON","::",161],["T_STRING","TXN_TYPE_NEW_CASE",161],":",["T_WHITESPACE","\n                    ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_registerDispute",162],"(",")",";",["T_WHITESPACE","\n                    ",162],["T_BREAK","break",163],";",["T_WHITESPACE","\n                    ",163],["T_COMMENT","\/\/ handle new adjustment is created\n",164],["T_WHITESPACE","                ",165],["T_CASE","case",165],["T_WHITESPACE"," ",165],["T_STRING","Info",165],["T_DOUBLE_COLON","::",165],["T_STRING","TXN_TYPE_ADJUSTMENT",165],":",["T_WHITESPACE","\n                    ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_registerAdjustment",166],"(",")",";",["T_WHITESPACE","\n                    ",166],["T_BREAK","break",167],";",["T_WHITESPACE","\n                    ",167],["T_COMMENT","\/\/handle new transaction created\n",168],["T_WHITESPACE","                ",169],["T_DEFAULT","default",169],":",["T_WHITESPACE","\n                    ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_registerTransaction",170],"(",")",";",["T_WHITESPACE","\n                    ",170],["T_BREAK","break",171],";",["T_WHITESPACE","\n            ",171],"}",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE"," ",173],["T_CATCH","catch",173],["T_WHITESPACE"," ",173],"(",["T_NS_SEPARATOR","\\",173],["T_STRING","Magento",173],["T_NS_SEPARATOR","\\",173],["T_STRING","Framework",173],["T_NS_SEPARATOR","\\",173],["T_STRING","Exception",173],["T_NS_SEPARATOR","\\",173],["T_STRING","LocalizedException",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$e",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$comment",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_createIpnComment",174],"(",["T_STRING","__",174],"(",["T_CONSTANT_ENCAPSED_STRING","'Note: %1'",174],",",["T_WHITESPACE"," ",174],["T_VARIABLE","$e",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getMessage",174],"(",")",")",",",["T_WHITESPACE"," ",174],["T_STRING","true",174],")",";",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$comment",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","save",175],"(",")",";",["T_WHITESPACE","\n            ",175],["T_THROW","throw",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$e",176],";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Process dispute notification\n     *\n     * @return void\n     *\/",180],["T_WHITESPACE","\n    ",184],["T_PROTECTED","protected",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","_registerDispute",185],"(",")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$reasonComment",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_paypalInfo",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","explainReasonCode",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getRequestData",187],"(",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",187],")",")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$caseType",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getRequestData",188],"(",["T_CONSTANT_ENCAPSED_STRING","'case_type'",188],")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$caseTypeLabel",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_paypalInfo",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getCaseTypeLabel",189],"(",["T_VARIABLE","$caseType",189],")",";",["T_WHITESPACE","\n        ",189],["T_VARIABLE","$caseId",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getRequestData",190],"(",["T_CONSTANT_ENCAPSED_STRING","'case_id'",190],")",";",["T_WHITESPACE","\n        ",190],["T_COMMENT","\/\/Add IPN comment about registered dispute\n",191],["T_WHITESPACE","        ",192],["T_VARIABLE","$message",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","__",192],"(",["T_WHITESPACE","\n            ",192],["T_CONSTANT_ENCAPSED_STRING","'IPN \"%1\". Case type \"%2\". Case ID \"%3\" %4'",193],",",["T_WHITESPACE","\n            ",193],["T_STRING","ucfirst",194],"(",["T_VARIABLE","$caseType",194],")",",",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$caseTypeLabel",195],",",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$caseId",196],",",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$reasonComment",197],["T_WHITESPACE","\n        ",197],")",";",["T_WHITESPACE","\n        ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_order",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","addStatusHistoryComment",199],"(",["T_VARIABLE","$message",199],")",["T_OBJECT_OPERATOR","->",199],["T_STRING","setIsCustomerNotified",199],"(",["T_STRING","false",199],")",["T_OBJECT_OPERATOR","->",199],["T_STRING","save",199],"(",")",";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_DOC_COMMENT","\/**\n     * Process adjustment notification\n     *\n     * @return void\n     *\/",202],["T_WHITESPACE","\n    ",206],["T_PROTECTED","protected",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","_registerAdjustment",207],"(",")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$reasonCode",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getRequestData",209],"(",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",209],")",";",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$reasonComment",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_paypalInfo",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","explainReasonCode",210],"(",["T_VARIABLE","$reasonCode",210],")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$notificationAmount",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_order",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getBaseCurrency",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","formatTxt",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getRequestData",211],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",211],")",")",";",["T_WHITESPACE","\n        ",211],["T_COMMENT","\/\/ Add IPN comment about registered dispute\n",212],["T_WHITESPACE","        ",213],["T_VARIABLE","$message",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_STRING","__",213],"(",["T_WHITESPACE","\n            ",213],["T_CONSTANT_ENCAPSED_STRING","'IPN \"%1\". A dispute has been resolved and closed. %2 Transaction amount %3.'",214],",",["T_WHITESPACE","\n            ",214],["T_STRING","ucfirst",215],"(",["T_VARIABLE","$reasonCode",215],")",",",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$notificationAmount",216],",",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$reasonComment",217],["T_WHITESPACE","\n        ",217],")",";",["T_WHITESPACE","\n        ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_order",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","addStatusHistoryComment",219],"(",["T_VARIABLE","$message",219],")",["T_OBJECT_OPERATOR","->",219],["T_STRING","setIsCustomerNotified",219],"(",["T_STRING","false",219],")",["T_OBJECT_OPERATOR","->",219],["T_STRING","save",219],"(",")",";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Process regular IPN notifications\n     *\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @throws Exception\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",222],["T_WHITESPACE","\n    ",229],["T_PROTECTED","protected",230],["T_WHITESPACE"," ",230],["T_FUNCTION","function",230],["T_WHITESPACE"," ",230],["T_STRING","_registerTransaction",230],"(",")",["T_WHITESPACE","\n    ",230],"{",["T_WHITESPACE","\n        ",231],["T_COMMENT","\/\/ Handle payment_status\n",232],["T_WHITESPACE","        ",233],["T_VARIABLE","$paymentStatus",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_filterPaymentStatus",233],"(",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getRequestData",233],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",233],")",")",";",["T_WHITESPACE","\n        ",233],["T_SWITCH","switch",234],["T_WHITESPACE"," ",234],"(",["T_VARIABLE","$paymentStatus",234],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_COMMENT","\/\/ paid\n",235],["T_WHITESPACE","            ",236],["T_CASE","case",236],["T_WHITESPACE"," ",236],["T_STRING","Info",236],["T_DOUBLE_COLON","::",236],["T_STRING","PAYMENTSTATUS_COMPLETED",236],":",["T_WHITESPACE","\n                ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_registerPaymentCapture",237],"(",["T_STRING","true",237],")",";",["T_WHITESPACE","\n                ",237],["T_BREAK","break",238],";",["T_WHITESPACE","\n                ",238],["T_COMMENT","\/\/ the holded payment was denied on paypal side\n",239],["T_WHITESPACE","            ",240],["T_CASE","case",240],["T_WHITESPACE"," ",240],["T_STRING","Info",240],["T_DOUBLE_COLON","::",240],["T_STRING","PAYMENTSTATUS_DENIED",240],":",["T_WHITESPACE","\n                ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_registerPaymentDenial",241],"(",")",";",["T_WHITESPACE","\n                ",241],["T_BREAK","break",242],";",["T_WHITESPACE","\n                ",242],["T_COMMENT","\/\/ customer attempted to pay via bank account, but failed\n",243],["T_WHITESPACE","            ",244],["T_CASE","case",244],["T_WHITESPACE"," ",244],["T_STRING","Info",244],["T_DOUBLE_COLON","::",244],["T_STRING","PAYMENTSTATUS_FAILED",244],":",["T_WHITESPACE","\n                ",244],["T_COMMENT","\/\/ cancel order\n",245],["T_WHITESPACE","                ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_registerPaymentFailure",246],"(",")",";",["T_WHITESPACE","\n                ",246],["T_BREAK","break",247],";",["T_WHITESPACE","\n                ",247],["T_COMMENT","\/\/ payment was obtained, but money were not captured yet\n",248],["T_WHITESPACE","            ",249],["T_CASE","case",249],["T_WHITESPACE"," ",249],["T_STRING","Info",249],["T_DOUBLE_COLON","::",249],["T_STRING","PAYMENTSTATUS_PENDING",249],":",["T_WHITESPACE","\n                ",249],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","_registerPaymentPending",250],"(",")",";",["T_WHITESPACE","\n                ",250],["T_BREAK","break",251],";",["T_WHITESPACE","\n            ",251],["T_CASE","case",252],["T_WHITESPACE"," ",252],["T_STRING","Info",252],["T_DOUBLE_COLON","::",252],["T_STRING","PAYMENTSTATUS_PROCESSED",252],":",["T_WHITESPACE","\n                ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_registerMasspaymentsSuccess",253],"(",")",";",["T_WHITESPACE","\n                ",253],["T_BREAK","break",254],";",["T_WHITESPACE","\n            ",254],["T_CASE","case",255],["T_WHITESPACE"," ",255],["T_STRING","Info",255],["T_DOUBLE_COLON","::",255],["T_STRING","PAYMENTSTATUS_REVERSED",255],":",["T_WHITESPACE","\n                ",255],["T_COMMENT","\/\/break is intentionally omitted\n",256],["T_WHITESPACE","            ",257],["T_CASE","case",257],["T_WHITESPACE"," ",257],["T_STRING","Info",257],["T_DOUBLE_COLON","::",257],["T_STRING","PAYMENTSTATUS_UNREVERSED",257],":",["T_WHITESPACE","\n                ",257],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","_registerPaymentReversal",258],"(",")",";",["T_WHITESPACE","\n                ",258],["T_BREAK","break",259],";",["T_WHITESPACE","\n            ",259],["T_CASE","case",260],["T_WHITESPACE"," ",260],["T_STRING","Info",260],["T_DOUBLE_COLON","::",260],["T_STRING","PAYMENTSTATUS_REFUNDED",260],":",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_registerPaymentRefund",261],"(",")",";",["T_WHITESPACE","\n                ",261],["T_BREAK","break",262],";",["T_WHITESPACE","\n                ",262],["T_COMMENT","\/\/ authorization expire\/void\n",263],["T_WHITESPACE","            ",264],["T_CASE","case",264],["T_WHITESPACE"," ",264],["T_STRING","Info",264],["T_DOUBLE_COLON","::",264],["T_STRING","PAYMENTSTATUS_EXPIRED",264],":",["T_WHITESPACE","\n                ",264],["T_COMMENT","\/\/ break is intentionally omitted\n",265],["T_WHITESPACE","            ",266],["T_CASE","case",266],["T_WHITESPACE"," ",266],["T_STRING","Info",266],["T_DOUBLE_COLON","::",266],["T_STRING","PAYMENTSTATUS_VOIDED",266],":",["T_WHITESPACE","\n                ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","_registerPaymentVoid",267],"(",")",";",["T_WHITESPACE","\n                ",267],["T_BREAK","break",268],";",["T_WHITESPACE","\n            ",268],["T_DEFAULT","default",269],":",["T_WHITESPACE","\n                ",269],["T_THROW","throw",270],["T_WHITESPACE"," ",270],["T_NEW","new",270],["T_WHITESPACE"," ",270],["T_STRING","Exception",270],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Cannot handle payment status '",270],["T_CURLY_OPEN","{",270],["T_VARIABLE","$paymentStatus",270],"}",["T_ENCAPSED_AND_WHITESPACE","'.",270],"\"",")",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n    ",271],"}",["T_WHITESPACE","\n\n    ",272],["T_DOC_COMMENT","\/**\n     * Process completed payment (either full or partial)\n     *\n     * @param bool $skipFraudDetection\n     * @return void\n     *\/",274],["T_WHITESPACE","\n    ",279],["T_PROTECTED","protected",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","_registerPaymentCapture",280],"(",["T_VARIABLE","$skipFraudDetection",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_STRING","false",280],")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getRequestData",282],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",282],")",["T_WHITESPACE"," ",282],["T_IS_EQUAL","==",282],["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'auth'",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_RETURN","return",283],";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$parentTransactionId",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getRequestData",285],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",285],")",";",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_importPaymentInformation",286],"(",")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$payment",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_order",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getPayment",287],"(",")",";",["T_WHITESPACE","\n        ",287],["T_VARIABLE","$payment",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","setTransactionId",288],"(",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getRequestData",289],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",289],")",["T_WHITESPACE","\n        ",289],")",";",["T_WHITESPACE","\n        ",290],["T_VARIABLE","$payment",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","setCurrencyCode",291],"(",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getRequestData",292],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_currency'",292],")",["T_WHITESPACE","\n        ",292],")",";",["T_WHITESPACE","\n        ",293],["T_VARIABLE","$payment",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","setPreparedMessage",294],"(",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_createIpnComment",295],"(",["T_CONSTANT_ENCAPSED_STRING","''",295],")",["T_WHITESPACE","\n        ",295],")",";",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$payment",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","setParentTransactionId",297],"(",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$parentTransactionId",298],["T_WHITESPACE","\n        ",298],")",";",["T_WHITESPACE","\n        ",299],["T_VARIABLE","$payment",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","setShouldCloseParentTransaction",300],"(",["T_WHITESPACE","\n            ",300],["T_CONSTANT_ENCAPSED_STRING","'Completed'",301],["T_WHITESPACE"," ",301],["T_IS_IDENTICAL","===",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getRequestData",301],"(",["T_CONSTANT_ENCAPSED_STRING","'auth_status'",301],")",["T_WHITESPACE","\n        ",301],")",";",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$payment",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","setIsTransactionClosed",303],"(",["T_WHITESPACE","\n            ",303],["T_LNUMBER","0",304],["T_WHITESPACE","\n        ",304],")",";",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$payment",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","registerCaptureNotification",306],"(",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getRequestData",307],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",307],")",",",["T_WHITESPACE","\n            ",307],["T_VARIABLE","$skipFraudDetection",308],["T_WHITESPACE"," ",308],["T_BOOLEAN_AND","&&",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$parentTransactionId",308],["T_WHITESPACE","\n        ",308],")",";",["T_WHITESPACE","\n        ",309],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_order",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","save",310],"(",")",";",["T_WHITESPACE","\n\n        ",310],["T_COMMENT","\/\/ notify customer\n",312],["T_WHITESPACE","        ",313],["T_VARIABLE","$invoice",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$payment",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getCreatedInvoice",313],"(",")",";",["T_WHITESPACE","\n        ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$invoice",314],["T_WHITESPACE"," ",314],["T_BOOLEAN_AND","&&",314],["T_WHITESPACE"," ",314],"!",["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_order",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getEmailSent",314],"(",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","orderSender",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","send",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_order",315],")",";",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","_order",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","addStatusHistoryComment",316],"(",["T_WHITESPACE","\n                ",316],["T_STRING","__",317],"(",["T_CONSTANT_ENCAPSED_STRING","'You notified customer about invoice #%1.'",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$invoice",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getIncrementId",317],"(",")",")",["T_WHITESPACE","\n            ",317],")",["T_OBJECT_OPERATOR","->",318],["T_STRING","setIsCustomerNotified",318],"(",["T_WHITESPACE","\n                ",318],["T_STRING","true",319],["T_WHITESPACE","\n            ",319],")",["T_OBJECT_OPERATOR","->",320],["T_STRING","save",320],"(",")",";",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Process denied payment notification\n     *\n     * @return void\n     * @throws Exception\n     *\/",324],["T_WHITESPACE","\n    ",329],["T_PROTECTED","protected",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","_registerPaymentDenial",330],"(",")",["T_WHITESPACE","\n    ",330],"{",["T_WHITESPACE","\n        ",331],["T_TRY","try",332],["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n            ",332],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_importPaymentInformation",333],"(",")",";",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_order",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getPayment",334],"(",")",["T_OBJECT_OPERATOR","->",334],["T_STRING","setTransactionId",334],"(",["T_WHITESPACE","\n                ",334],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getRequestData",335],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",335],")",["T_WHITESPACE","\n            ",335],")",["T_OBJECT_OPERATOR","->",336],["T_STRING","setNotificationResult",336],"(",["T_WHITESPACE","\n                ",336],["T_STRING","true",337],["T_WHITESPACE","\n            ",337],")",["T_OBJECT_OPERATOR","->",338],["T_STRING","setIsTransactionClosed",338],"(",["T_WHITESPACE","\n                ",338],["T_STRING","true",339],["T_WHITESPACE","\n            ",339],")",["T_OBJECT_OPERATOR","->",340],["T_STRING","deny",340],"(",["T_STRING","false",340],")",";",["T_WHITESPACE","\n            ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_order",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","save",341],"(",")",";",["T_WHITESPACE","\n        ",341],"}",["T_WHITESPACE"," ",342],["T_CATCH","catch",342],["T_WHITESPACE"," ",342],"(",["T_NS_SEPARATOR","\\",342],["T_STRING","Magento",342],["T_NS_SEPARATOR","\\",342],["T_STRING","Framework",342],["T_NS_SEPARATOR","\\",342],["T_STRING","Exception",342],["T_NS_SEPARATOR","\\",342],["T_STRING","LocalizedException",342],["T_WHITESPACE"," ",342],["T_VARIABLE","$e",342],")",["T_WHITESPACE"," ",342],"{",["T_WHITESPACE","\n            ",342],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$e",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getMessage",343],"(",")",["T_WHITESPACE"," ",343],["T_IS_NOT_EQUAL","!=",343],["T_WHITESPACE"," ",343],["T_STRING","__",343],"(",["T_CONSTANT_ENCAPSED_STRING","'We cannot cancel this order.'",343],")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n                ",343],["T_THROW","throw",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$e",344],";",["T_WHITESPACE","\n            ",344],"}",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n\n    ",347],["T_DOC_COMMENT","\/**\n     * Treat failed payment as order cancellation\n     *\n     * @return void\n     *\/",349],["T_WHITESPACE","\n    ",353],["T_PROTECTED","protected",354],["T_WHITESPACE"," ",354],["T_FUNCTION","function",354],["T_WHITESPACE"," ",354],["T_STRING","_registerPaymentFailure",354],"(",")",["T_WHITESPACE","\n    ",354],"{",["T_WHITESPACE","\n        ",355],["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_importPaymentInformation",356],"(",")",";",["T_WHITESPACE","\n        ",356],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_order",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","registerCancellation",357],"(",["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_createIpnComment",357],"(",["T_CONSTANT_ENCAPSED_STRING","''",357],")",")",["T_OBJECT_OPERATOR","->",357],["T_STRING","save",357],"(",")",";",["T_WHITESPACE","\n    ",357],"}",["T_WHITESPACE","\n\n    ",358],["T_DOC_COMMENT","\/**\n     * Process payment pending notification\n     *\n     * @return void\n     * @throws Exception\n     *\/",360],["T_WHITESPACE","\n    ",365],["T_PUBLIC","public",366],["T_WHITESPACE"," ",366],["T_FUNCTION","function",366],["T_WHITESPACE"," ",366],["T_STRING","_registerPaymentPending",366],"(",")",["T_WHITESPACE","\n    ",366],"{",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$reason",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getRequestData",368],"(",["T_CONSTANT_ENCAPSED_STRING","'pending_reason'",368],")",";",["T_WHITESPACE","\n        ",368],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization'",369],["T_WHITESPACE"," ",369],["T_IS_IDENTICAL","===",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$reason",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_registerPaymentAuthorization",370],"(",")",";",["T_WHITESPACE","\n            ",370],["T_RETURN","return",371],";",["T_WHITESPACE","\n        ",371],"}",["T_WHITESPACE","\n        ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",373],["T_WHITESPACE"," ",373],["T_IS_IDENTICAL","===",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$reason",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_THROW","throw",374],["T_WHITESPACE"," ",374],["T_NEW","new",374],["T_WHITESPACE"," ",374],["T_STRING","Exception",374],"(",["T_CONSTANT_ENCAPSED_STRING","'The \"order\" authorizations are not implemented.'",374],")",";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE","\n        ",375],["T_COMMENT","\/\/ case when was placed using PayPal standard\n",376],["T_WHITESPACE","        ",377],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_NS_SEPARATOR","\\",377],["T_STRING","Magento",377],["T_NS_SEPARATOR","\\",377],["T_STRING","Sales",377],["T_NS_SEPARATOR","\\",377],["T_STRING","Model",377],["T_NS_SEPARATOR","\\",377],["T_STRING","Order",377],["T_DOUBLE_COLON","::",377],["T_STRING","STATE_PENDING_PAYMENT",377],["T_WHITESPACE"," ",377],["T_IS_EQUAL","==",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_order",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getState",377],"(",")",["T_WHITESPACE","\n            ",377],["T_BOOLEAN_AND","&&",378],["T_WHITESPACE"," ",378],"!",["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getRequestData",378],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",378],")",["T_WHITESPACE","\n        ",378],")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_registerPaymentCapture",380],"(",")",";",["T_WHITESPACE","\n            ",380],["T_RETURN","return",381],";",["T_WHITESPACE","\n        ",381],"}",["T_WHITESPACE","\n\n        ",382],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_importPaymentInformation",384],"(",")",";",["T_WHITESPACE","\n\n        ",384],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_order",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getPayment",386],"(",")",["T_OBJECT_OPERATOR","->",386],["T_STRING","setPreparedMessage",386],"(",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_createIpnComment",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_paypalInfo",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","explainPendingReason",387],"(",["T_VARIABLE","$reason",387],")",")",["T_WHITESPACE","\n        ",387],")",["T_OBJECT_OPERATOR","->",388],["T_STRING","setTransactionId",388],"(",["T_WHITESPACE","\n            ",388],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getRequestData",389],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",389],")",["T_WHITESPACE","\n        ",389],")",["T_OBJECT_OPERATOR","->",390],["T_STRING","setIsTransactionClosed",390],"(",["T_WHITESPACE","\n            ",390],["T_LNUMBER","0",391],["T_WHITESPACE","\n        ",391],")",["T_OBJECT_OPERATOR","->",392],["T_STRING","update",392],"(",["T_STRING","false",392],")",";",["T_WHITESPACE","\n        ",392],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","_order",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","save",393],"(",")",";",["T_WHITESPACE","\n    ",393],"}",["T_WHITESPACE","\n\n    ",394],["T_DOC_COMMENT","\/**\n     * Register authorized payment\n     *\n     * @return void\n     *\/",396],["T_WHITESPACE","\n    ",400],["T_PROTECTED","protected",401],["T_WHITESPACE"," ",401],["T_FUNCTION","function",401],["T_WHITESPACE"," ",401],["T_STRING","_registerPaymentAuthorization",401],"(",")",["T_WHITESPACE","\n    ",401],"{",["T_WHITESPACE","\n        ",402],["T_DOC_COMMENT","\/** @var $payment \\Magento\\Sales\\Model\\Order\\Payment *\/",403],["T_WHITESPACE","\n        ",403],["T_VARIABLE","$payment",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","_order",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getPayment",404],"(",")",";",["T_WHITESPACE","\n        ",404],["T_IF","if",405],["T_WHITESPACE"," ",405],"(",["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","_order",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","canFetchPaymentReviewUpdate",405],"(",")",")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n            ",405],["T_VARIABLE","$payment",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","update",406],"(",["T_STRING","true",406],")",";",["T_WHITESPACE","\n        ",406],"}",["T_WHITESPACE"," ",407],["T_ELSE","else",407],["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_importPaymentInformation",408],"(",")",";",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$payment",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","setPreparedMessage",409],"(",["T_WHITESPACE","\n                ",409],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_createIpnComment",410],"(",["T_CONSTANT_ENCAPSED_STRING","''",410],")",["T_WHITESPACE","\n            ",410],")",["T_OBJECT_OPERATOR","->",411],["T_STRING","setTransactionId",411],"(",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getRequestData",412],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",412],")",["T_WHITESPACE","\n            ",412],")",["T_OBJECT_OPERATOR","->",413],["T_STRING","setParentTransactionId",413],"(",["T_WHITESPACE","\n                ",413],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getRequestData",414],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",414],")",["T_WHITESPACE","\n            ",414],")",["T_OBJECT_OPERATOR","->",415],["T_STRING","setCurrencyCode",415],"(",["T_WHITESPACE","\n                ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getRequestData",416],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_currency'",416],")",["T_WHITESPACE","\n            ",416],")",["T_OBJECT_OPERATOR","->",417],["T_STRING","setIsTransactionClosed",417],"(",["T_WHITESPACE","\n                ",417],["T_LNUMBER","0",418],["T_WHITESPACE","\n            ",418],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","registerAuthorizationNotification",419],"(",["T_WHITESPACE","\n                ",419],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getRequestData",420],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",420],")",["T_WHITESPACE","\n            ",420],")",";",["T_WHITESPACE","\n        ",421],"}",["T_WHITESPACE","\n        ",422],["T_IF","if",423],["T_WHITESPACE"," ",423],"(","!",["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","_order",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getEmailSent",423],"(",")",")",["T_WHITESPACE"," ",423],"{",["T_WHITESPACE","\n            ",423],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","orderSender",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","send",424],"(",["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","_order",424],")",";",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_order",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","save",426],"(",")",";",["T_WHITESPACE","\n    ",426],"}",["T_WHITESPACE","\n\n    ",427],["T_DOC_COMMENT","\/**\n     * The status \"Processed\" is used when all Masspayments are successful\n     *\n     * @return void\n     *\/",429],["T_WHITESPACE","\n    ",433],["T_PROTECTED","protected",434],["T_WHITESPACE"," ",434],["T_FUNCTION","function",434],["T_WHITESPACE"," ",434],["T_STRING","_registerMasspaymentsSuccess",434],"(",")",["T_WHITESPACE","\n    ",434],"{",["T_WHITESPACE","\n        ",435],["T_VARIABLE","$comment",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","_createIpnComment",436],"(",["T_CONSTANT_ENCAPSED_STRING","''",436],",",["T_WHITESPACE"," ",436],["T_STRING","true",436],")",";",["T_WHITESPACE","\n        ",436],["T_VARIABLE","$comment",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","save",437],"(",")",";",["T_WHITESPACE","\n    ",437],"}",["T_WHITESPACE","\n\n    ",438],["T_DOC_COMMENT","\/**\n     * Process payment reversal and cancelled reversal notification\n     *\n     * @return void\n     *\/",440],["T_WHITESPACE","\n    ",444],["T_PROTECTED","protected",445],["T_WHITESPACE"," ",445],["T_FUNCTION","function",445],["T_WHITESPACE"," ",445],["T_STRING","_registerPaymentReversal",445],"(",")",["T_WHITESPACE","\n    ",445],"{",["T_WHITESPACE","\n        ",446],["T_VARIABLE","$reasonCode",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getRequestData",447],"(",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",447],")",";",["T_WHITESPACE","\n        ",447],["T_VARIABLE","$reasonComment",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_paypalInfo",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","explainReasonCode",448],"(",["T_VARIABLE","$reasonCode",448],")",";",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$notificationAmount",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_order",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getBaseCurrency",449],"(",")",["T_OBJECT_OPERATOR","->",449],["T_STRING","formatTxt",449],"(",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getRequestData",450],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",450],")",["T_WHITESPACE"," ",450],"+",["T_WHITESPACE"," ",450],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getRequestData",450],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_fee'",450],")",["T_WHITESPACE","\n        ",450],")",";",["T_WHITESPACE","\n        ",451],["T_VARIABLE","$paymentStatus",452],["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","_filterPaymentStatus",452],"(",["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getRequestData",452],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",452],")",")",";",["T_WHITESPACE","\n        ",452],["T_VARIABLE","$orderStatus",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_VARIABLE","$paymentStatus",453],["T_WHITESPACE"," ",453],["T_IS_EQUAL","==",453],["T_WHITESPACE","\n            ",453],["T_STRING","Info",454],["T_DOUBLE_COLON","::",454],["T_STRING","PAYMENTSTATUS_REVERSED",454],["T_WHITESPACE"," ",454],"?",["T_WHITESPACE"," ",454],["T_STRING","Info",454],["T_DOUBLE_COLON","::",454],["T_STRING","ORDER_STATUS_REVERSED",454],["T_WHITESPACE"," ",454],":",["T_WHITESPACE"," ",454],["T_STRING","Info",454],["T_DOUBLE_COLON","::",454],["T_STRING","ORDER_STATUS_CANCELED_REVERSAL",454],";",["T_WHITESPACE","\n        ",454],["T_COMMENT","\/\/Change order status to PayPal Reversed\/PayPal Cancelled Reversal if it is possible.\n",455],["T_WHITESPACE","        ",456],["T_VARIABLE","$message",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_STRING","__",456],"(",["T_WHITESPACE","\n            ",456],["T_CONSTANT_ENCAPSED_STRING","'IPN \"%1\". %2 Transaction amount %3. Transaction ID: \"%4\"'",457],",",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getRequestData",458],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",458],")",",",["T_WHITESPACE","\n            ",458],["T_VARIABLE","$reasonComment",459],",",["T_WHITESPACE","\n            ",459],["T_VARIABLE","$notificationAmount",460],",",["T_WHITESPACE","\n            ",460],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getRequestData",461],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",461],")",["T_WHITESPACE","\n        ",461],")",";",["T_WHITESPACE","\n        ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","_order",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","setStatus",463],"(",["T_VARIABLE","$orderStatus",463],")",";",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_order",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","save",464],"(",")",";",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","_order",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","addStatusHistoryComment",465],"(",["T_VARIABLE","$message",465],",",["T_WHITESPACE"," ",465],["T_VARIABLE","$orderStatus",465],")",["T_OBJECT_OPERATOR","->",465],["T_STRING","setIsCustomerNotified",465],"(",["T_STRING","false",465],")",["T_OBJECT_OPERATOR","->",465],["T_STRING","save",465],"(",")",";",["T_WHITESPACE","\n    ",465],"}",["T_WHITESPACE","\n\n    ",466],["T_DOC_COMMENT","\/**\n     * Process a refund\n     *\n     * @return void\n     *\/",468],["T_WHITESPACE","\n    ",472],["T_PROTECTED","protected",473],["T_WHITESPACE"," ",473],["T_FUNCTION","function",473],["T_WHITESPACE"," ",473],["T_STRING","_registerPaymentRefund",473],"(",")",["T_WHITESPACE","\n    ",473],"{",["T_WHITESPACE","\n        ",474],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","_importPaymentInformation",475],"(",")",";",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$reason",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getRequestData",476],"(",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",476],")",";",["T_WHITESPACE","\n        ",476],["T_VARIABLE","$isRefundFinal",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],"!",["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","_paypalInfo",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","isReversalDisputable",477],"(",["T_VARIABLE","$reason",477],")",";",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$payment",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","_order",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getPayment",478],"(",")",["T_OBJECT_OPERATOR","->",478],["T_STRING","setPreparedMessage",478],"(",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_createIpnComment",479],"(",["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_paypalInfo",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","explainReasonCode",479],"(",["T_VARIABLE","$reason",479],")",")",["T_WHITESPACE","\n        ",479],")",["T_OBJECT_OPERATOR","->",480],["T_STRING","setTransactionId",480],"(",["T_WHITESPACE","\n            ",480],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getRequestData",481],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",481],")",["T_WHITESPACE","\n        ",481],")",["T_OBJECT_OPERATOR","->",482],["T_STRING","setParentTransactionId",482],"(",["T_WHITESPACE","\n            ",482],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getRequestData",483],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",483],")",["T_WHITESPACE","\n        ",483],")",["T_OBJECT_OPERATOR","->",484],["T_STRING","setIsTransactionClosed",484],"(",["T_WHITESPACE","\n            ",484],["T_VARIABLE","$isRefundFinal",485],["T_WHITESPACE","\n        ",485],")",["T_OBJECT_OPERATOR","->",486],["T_STRING","registerRefundNotification",486],"(",["T_WHITESPACE","\n            ",486],"-",["T_LNUMBER","1",487],["T_WHITESPACE"," ",487],"*",["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getRequestData",487],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",487],")",["T_WHITESPACE","\n        ",487],")",";",["T_WHITESPACE","\n        ",488],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","_order",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","save",489],"(",")",";",["T_WHITESPACE","\n\n        ",489],["T_COMMENT","\/\/ TODO: there is no way to close a capture right now\n",491],["T_WHITESPACE","\n        ",492],["T_VARIABLE","$creditMemo",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_VARIABLE","$payment",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getCreatedCreditmemo",493],"(",")",";",["T_WHITESPACE","\n        ",493],["T_IF","if",494],["T_WHITESPACE"," ",494],"(",["T_VARIABLE","$creditMemo",494],")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","creditmemoSender",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","send",495],"(",["T_VARIABLE","$creditMemo",495],")",";",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","_order",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","addStatusHistoryComment",496],"(",["T_WHITESPACE","\n                ",496],["T_STRING","__",497],"(",["T_CONSTANT_ENCAPSED_STRING","'You notified customer about creditmemo #%1.'",497],",",["T_WHITESPACE"," ",497],["T_VARIABLE","$creditMemo",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getIncrementId",497],"(",")",")",["T_WHITESPACE","\n            ",497],")",["T_OBJECT_OPERATOR","->",498],["T_STRING","setIsCustomerNotified",498],"(",["T_WHITESPACE","\n                ",498],["T_STRING","true",499],["T_WHITESPACE","\n            ",499],")",["T_OBJECT_OPERATOR","->",500],["T_STRING","save",500],"(",")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE","\n    ",501],"}",["T_WHITESPACE","\n\n    ",502],["T_DOC_COMMENT","\/**\n     * Process voided authorization\n     *\n     * @return void\n     *\/",504],["T_WHITESPACE","\n    ",508],["T_PROTECTED","protected",509],["T_WHITESPACE"," ",509],["T_FUNCTION","function",509],["T_WHITESPACE"," ",509],["T_STRING","_registerPaymentVoid",509],"(",")",["T_WHITESPACE","\n    ",509],"{",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","_importPaymentInformation",511],"(",")",";",["T_WHITESPACE","\n\n        ",511],["T_VARIABLE","$parentTxnId",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getRequestData",513],"(",["T_WHITESPACE","\n            ",513],["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",514],["T_WHITESPACE","\n        ",514],")",["T_WHITESPACE"," ",515],["T_IS_EQUAL","==",515],["T_WHITESPACE"," ",515],["T_CONSTANT_ENCAPSED_STRING","'auth'",515],["T_WHITESPACE"," ",515],"?",["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getRequestData",515],"(",["T_WHITESPACE","\n            ",515],["T_CONSTANT_ENCAPSED_STRING","'txn_id'",516],["T_WHITESPACE","\n        ",516],")",["T_WHITESPACE"," ",517],":",["T_WHITESPACE"," ",517],["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","getRequestData",517],"(",["T_WHITESPACE","\n            ",517],["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",518],["T_WHITESPACE","\n        ",518],")",";",["T_WHITESPACE","\n\n        ",519],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","_order",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getPayment",521],"(",")",["T_OBJECT_OPERATOR","->",521],["T_STRING","setPreparedMessage",521],"(",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_createIpnComment",522],"(",["T_CONSTANT_ENCAPSED_STRING","''",522],")",["T_WHITESPACE","\n        ",522],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","setParentTransactionId",523],"(",["T_WHITESPACE","\n            ",523],["T_VARIABLE","$parentTxnId",524],["T_WHITESPACE","\n        ",524],")",["T_OBJECT_OPERATOR","->",525],["T_STRING","registerVoidNotification",525],"(",")",";",["T_WHITESPACE","\n\n        ",525],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_order",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","save",527],"(",")",";",["T_WHITESPACE","\n    ",527],"}",["T_WHITESPACE","\n\n    ",528],["T_DOC_COMMENT","\/**\n     * Map payment information from IPN to payment object\n     * Returns true if there were changes in information\n     *\n     * @return bool\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",530],["T_WHITESPACE","\n    ",537],["T_PROTECTED","protected",538],["T_WHITESPACE"," ",538],["T_FUNCTION","function",538],["T_WHITESPACE"," ",538],["T_STRING","_importPaymentInformation",538],"(",")",["T_WHITESPACE","\n    ",538],"{",["T_WHITESPACE","\n        ",539],["T_VARIABLE","$payment",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","_order",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","getPayment",540],"(",")",";",["T_WHITESPACE","\n        ",540],["T_VARIABLE","$was",541],["T_WHITESPACE"," ",541],"=",["T_WHITESPACE"," ",541],["T_VARIABLE","$payment",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","getAdditionalInformation",541],"(",")",";",["T_WHITESPACE","\n\n        ",541],["T_COMMENT","\/\/ collect basic information\n",543],["T_WHITESPACE","        ",544],["T_VARIABLE","$from",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],"[","]",";",["T_WHITESPACE","\n        ",544],["T_FOREACH","foreach",545],["T_WHITESPACE"," ",545],"(","[",["T_WHITESPACE","\n            ",545],["T_STRING","Info",546],["T_DOUBLE_COLON","::",546],["T_STRING","PAYER_ID",546],",",["T_WHITESPACE","\n            ",546],["T_CONSTANT_ENCAPSED_STRING","'payer_email'",547],["T_WHITESPACE"," ",547],["T_DOUBLE_ARROW","=>",547],["T_WHITESPACE"," ",547],["T_STRING","Info",547],["T_DOUBLE_COLON","::",547],["T_STRING","PAYER_EMAIL",547],",",["T_WHITESPACE","\n            ",547],["T_STRING","Info",548],["T_DOUBLE_COLON","::",548],["T_STRING","PAYER_STATUS",548],",",["T_WHITESPACE","\n            ",548],["T_STRING","Info",549],["T_DOUBLE_COLON","::",549],["T_STRING","ADDRESS_STATUS",549],",",["T_WHITESPACE","\n            ",549],["T_STRING","Info",550],["T_DOUBLE_COLON","::",550],["T_STRING","PROTECTION_EL",550],",",["T_WHITESPACE","\n            ",550],["T_STRING","Info",551],["T_DOUBLE_COLON","::",551],["T_STRING","PAYMENT_STATUS",551],",",["T_WHITESPACE","\n            ",551],["T_STRING","Info",552],["T_DOUBLE_COLON","::",552],["T_STRING","PENDING_REASON",552],",",["T_WHITESPACE","\n        ",552],"]",["T_WHITESPACE"," ",553],["T_AS","as",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$privateKey",553],["T_WHITESPACE"," ",553],["T_DOUBLE_ARROW","=>",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$publicKey",553],")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n            ",553],["T_IF","if",554],["T_WHITESPACE"," ",554],"(",["T_STRING","is_int",554],"(",["T_VARIABLE","$privateKey",554],")",")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n                ",554],["T_VARIABLE","$privateKey",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_VARIABLE","$publicKey",555],";",["T_WHITESPACE","\n            ",555],"}",["T_WHITESPACE","\n            ",556],["T_VARIABLE","$value",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getRequestData",557],"(",["T_VARIABLE","$privateKey",557],")",";",["T_WHITESPACE","\n            ",557],["T_IF","if",558],["T_WHITESPACE"," ",558],"(",["T_VARIABLE","$value",558],")",["T_WHITESPACE"," ",558],"{",["T_WHITESPACE","\n                ",558],["T_VARIABLE","$from",559],"[",["T_VARIABLE","$publicKey",559],"]",["T_WHITESPACE"," ",559],"=",["T_WHITESPACE"," ",559],["T_VARIABLE","$value",559],";",["T_WHITESPACE","\n            ",559],"}",["T_WHITESPACE","\n        ",560],"}",["T_WHITESPACE","\n        ",561],["T_IF","if",562],["T_WHITESPACE"," ",562],"(",["T_ISSET","isset",562],"(",["T_VARIABLE","$from",562],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",562],"]",")",")",["T_WHITESPACE"," ",562],"{",["T_WHITESPACE","\n            ",562],["T_VARIABLE","$from",563],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",563],"]",["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","_filterPaymentStatus",563],"(",["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getRequestData",563],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",563],")",")",";",["T_WHITESPACE","\n        ",563],"}",["T_WHITESPACE","\n\n        ",564],["T_COMMENT","\/\/ collect fraud filters\n",566],["T_WHITESPACE","        ",567],["T_VARIABLE","$fraudFilters",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],"[","]",";",["T_WHITESPACE","\n        ",567],["T_FOR","for",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$i",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_LNUMBER","1",568],";",["T_WHITESPACE"," ",568],["T_VARIABLE","$value",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getRequestData",568],"(","\"",["T_ENCAPSED_AND_WHITESPACE","fraud_management_pending_filters_",568],["T_CURLY_OPEN","{",568],["T_VARIABLE","$i",568],"}","\"",")",";",["T_WHITESPACE"," ",568],["T_VARIABLE","$i",568],["T_INC","++",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n            ",568],["T_VARIABLE","$fraudFilters",569],"[","]",["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_VARIABLE","$value",569],";",["T_WHITESPACE","\n        ",569],"}",["T_WHITESPACE","\n        ",570],["T_IF","if",571],["T_WHITESPACE"," ",571],"(",["T_VARIABLE","$fraudFilters",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n            ",571],["T_VARIABLE","$from",572],"[",["T_STRING","Info",572],["T_DOUBLE_COLON","::",572],["T_STRING","FRAUD_FILTERS",572],"]",["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$fraudFilters",572],";",["T_WHITESPACE","\n        ",572],"}",["T_WHITESPACE","\n\n        ",573],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_paypalInfo",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","importToPayment",575],"(",["T_VARIABLE","$from",575],",",["T_WHITESPACE"," ",575],["T_VARIABLE","$payment",575],")",";",["T_WHITESPACE","\n\n        ",575],["T_DOC_COMMENT","\/**\n         * Detect pending payment, frauds\n         * TODO: implement logic in one place\n         * @see \\Magento\\Paypal\\Model\\Pro::importPaymentInfo()\n         *\/",577],["T_WHITESPACE","\n        ",581],["T_IF","if",582],["T_WHITESPACE"," ",582],"(",["T_STRING","Info",582],["T_DOUBLE_COLON","::",582],["T_STRING","isPaymentReviewRequired",582],"(",["T_VARIABLE","$payment",582],")",")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n            ",582],["T_VARIABLE","$payment",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","setIsTransactionPending",583],"(",["T_STRING","true",583],")",";",["T_WHITESPACE","\n            ",583],["T_IF","if",584],["T_WHITESPACE"," ",584],"(",["T_VARIABLE","$fraudFilters",584],")",["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n                ",584],["T_VARIABLE","$payment",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","setIsFraudDetected",585],"(",["T_STRING","true",585],")",";",["T_WHITESPACE","\n            ",585],"}",["T_WHITESPACE","\n        ",586],"}",["T_WHITESPACE","\n        ",587],["T_IF","if",588],["T_WHITESPACE"," ",588],"(",["T_STRING","Info",588],["T_DOUBLE_COLON","::",588],["T_STRING","isPaymentSuccessful",588],"(",["T_VARIABLE","$payment",588],")",")",["T_WHITESPACE"," ",588],"{",["T_WHITESPACE","\n            ",588],["T_VARIABLE","$payment",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","setIsTransactionApproved",589],"(",["T_STRING","true",589],")",";",["T_WHITESPACE","\n        ",589],"}",["T_WHITESPACE"," ",590],["T_ELSEIF","elseif",590],["T_WHITESPACE"," ",590],"(",["T_STRING","Info",590],["T_DOUBLE_COLON","::",590],["T_STRING","isPaymentFailed",590],"(",["T_VARIABLE","$payment",590],")",")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n            ",590],["T_VARIABLE","$payment",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","setIsTransactionDenied",591],"(",["T_STRING","true",591],")",";",["T_WHITESPACE","\n        ",591],"}",["T_WHITESPACE","\n\n        ",592],["T_RETURN","return",594],["T_WHITESPACE"," ",594],["T_VARIABLE","$was",594],["T_WHITESPACE"," ",594],["T_IS_NOT_EQUAL","!=",594],["T_WHITESPACE"," ",594],["T_VARIABLE","$payment",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getAdditionalInformation",594],"(",")",";",["T_WHITESPACE","\n    ",594],"}",["T_WHITESPACE","\n\n    ",595],["T_DOC_COMMENT","\/**\n     * Generate an \"IPN\" comment with additional explanation.\n     * Returns the generated comment or order status history object\n     *\n     * @param string $comment\n     * @param bool $addToHistory\n     * @return string|\\Magento\\Sales\\Model\\Order\\Status\\History\n     *\/",597],["T_WHITESPACE","\n    ",604],["T_PROTECTED","protected",605],["T_WHITESPACE"," ",605],["T_FUNCTION","function",605],["T_WHITESPACE"," ",605],["T_STRING","_createIpnComment",605],"(",["T_VARIABLE","$comment",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","''",605],",",["T_WHITESPACE"," ",605],["T_VARIABLE","$addToHistory",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_STRING","false",605],")",["T_WHITESPACE","\n    ",605],"{",["T_WHITESPACE","\n        ",606],["T_VARIABLE","$message",607],["T_WHITESPACE"," ",607],"=",["T_WHITESPACE"," ",607],["T_STRING","__",607],"(",["T_CONSTANT_ENCAPSED_STRING","'IPN \"%1\"'",607],",",["T_WHITESPACE"," ",607],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getRequestData",607],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",607],")",")",";",["T_WHITESPACE","\n        ",607],["T_IF","if",608],["T_WHITESPACE"," ",608],"(",["T_VARIABLE","$comment",608],")",["T_WHITESPACE"," ",608],"{",["T_WHITESPACE","\n            ",608],["T_VARIABLE","$message",609],["T_WHITESPACE"," ",609],["T_CONCAT_EQUAL",".=",609],["T_WHITESPACE"," ",609],["T_CONSTANT_ENCAPSED_STRING","' '",609],["T_WHITESPACE"," ",609],".",["T_WHITESPACE"," ",609],["T_VARIABLE","$comment",609],";",["T_WHITESPACE","\n        ",609],"}",["T_WHITESPACE","\n        ",610],["T_IF","if",611],["T_WHITESPACE"," ",611],"(",["T_VARIABLE","$addToHistory",611],")",["T_WHITESPACE"," ",611],"{",["T_WHITESPACE","\n            ",611],["T_VARIABLE","$message",612],["T_WHITESPACE"," ",612],"=",["T_WHITESPACE"," ",612],["T_VARIABLE","$this",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","_order",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","addStatusHistoryComment",612],"(",["T_VARIABLE","$message",612],")",";",["T_WHITESPACE","\n            ",612],["T_VARIABLE","$message",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","setIsCustomerNotified",613],"(",["T_STRING","null",613],")",";",["T_WHITESPACE","\n        ",613],"}",["T_WHITESPACE","\n        ",614],["T_RETURN","return",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$message",615],";",["T_WHITESPACE","\n    ",615],"}",["T_WHITESPACE","\n",616],"}",["T_WHITESPACE","\n",617]]