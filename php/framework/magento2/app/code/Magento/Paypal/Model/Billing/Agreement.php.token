[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Paypal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Billing",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Sales",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Order",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Payment",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Billing Agreement abstract model\n *\n * @method \\Magento\\Paypal\\Model\\ResourceModel\\Billing\\Agreement _getResource()\n * @method \\Magento\\Paypal\\Model\\ResourceModel\\Billing\\Agreement getResource()\n * @method int getCustomerId()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setCustomerId(int $value)\n * @method string getMethodCode()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setMethodCode(string $value)\n * @method string getReferenceId()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setReferenceId(string $value)\n * @method string getStatus()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setStatus(string $value)\n * @method string getCreatedAt()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setUpdatedAt(string $value)\n * @method int getStoreId()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setStoreId(int $value)\n * @method string getAgreementLabel()\n * @method \\Magento\\Paypal\\Model\\Billing\\Agreement setAgreementLabel(string $value)\n *\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",10],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Agreement",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Magento",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Paypal",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Model",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Billing",34],["T_NS_SEPARATOR","\\",34],["T_STRING","AbstractAgreement",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","STATUS_ACTIVE",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'active'",36],";",["T_WHITESPACE","\n\n    ",36],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","STATUS_CANCELED",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'canceled'",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Related agreement orders\n     *\n     * @var array\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_relatedOrders",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],"[","]",";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Paypal\\Model\\ResourceModel\\Billing\\Agreement\\CollectionFactory\n     *\/",47],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_billingAgreementFactory",50],";",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\DateTimeFactory\n     *\/",52],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_dateFactory",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\Context $context\n     * @param \\Magento\\Framework\\Registry $registry\n     * @param \\Magento\\Payment\\Helper\\Data $paymentData\n     * @param \\Magento\\Paypal\\Model\\ResourceModel\\Billing\\Agreement\\CollectionFactory $billingAgreementFactory\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTimeFactory $dateFactory\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\AbstractResource $resource\n     * @param \\Magento\\Framework\\Data\\Collection\\AbstractDb $resourceCollection\n     * @param array $data\n     *\/",57],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","__construct",67],"(",["T_WHITESPACE","\n        ",67],["T_NS_SEPARATOR","\\",68],["T_STRING","Magento",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Framework",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Model",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Context",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$context",68],",",["T_WHITESPACE","\n        ",68],["T_NS_SEPARATOR","\\",69],["T_STRING","Magento",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Framework",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Registry",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$registry",69],",",["T_WHITESPACE","\n        ",69],["T_NS_SEPARATOR","\\",70],["T_STRING","Magento",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Payment",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Helper",70],["T_NS_SEPARATOR","\\",70],["T_STRING","Data",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$paymentData",70],",",["T_WHITESPACE","\n        ",70],["T_NS_SEPARATOR","\\",71],["T_STRING","Magento",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Paypal",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Model",71],["T_NS_SEPARATOR","\\",71],["T_STRING","ResourceModel",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Billing",71],["T_NS_SEPARATOR","\\",71],["T_STRING","Agreement",71],["T_NS_SEPARATOR","\\",71],["T_STRING","CollectionFactory",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$billingAgreementFactory",71],",",["T_WHITESPACE","\n        ",71],["T_NS_SEPARATOR","\\",72],["T_STRING","Magento",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Framework",72],["T_NS_SEPARATOR","\\",72],["T_STRING","Stdlib",72],["T_NS_SEPARATOR","\\",72],["T_STRING","DateTime",72],["T_NS_SEPARATOR","\\",72],["T_STRING","DateTimeFactory",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$dateFactory",72],",",["T_WHITESPACE","\n        ",72],["T_NS_SEPARATOR","\\",73],["T_STRING","Magento",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Framework",73],["T_NS_SEPARATOR","\\",73],["T_STRING","Model",73],["T_NS_SEPARATOR","\\",73],["T_STRING","ResourceModel",73],["T_NS_SEPARATOR","\\",73],["T_STRING","AbstractResource",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$resource",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","null",73],",",["T_WHITESPACE","\n        ",73],["T_NS_SEPARATOR","\\",74],["T_STRING","Magento",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Framework",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Data",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Collection",74],["T_NS_SEPARATOR","\\",74],["T_STRING","AbstractDb",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$resourceCollection",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],",",["T_WHITESPACE","\n        ",74],["T_ARRAY","array",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$data",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],"[","]",["T_WHITESPACE","\n    ",75],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n        ",76],["T_STRING","parent",77],["T_DOUBLE_COLON","::",77],["T_STRING","__construct",77],"(",["T_VARIABLE","$context",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$registry",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$paymentData",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$resource",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$resourceCollection",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$data",77],")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_billingAgreementFactory",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$billingAgreementFactory",78],";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_dateFactory",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$dateFactory",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Init model\n     *\n     * @return void\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_construct",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_init",89],"(",["T_NS_SEPARATOR","\\",89],["T_STRING","Magento",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Paypal",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Model",89],["T_NS_SEPARATOR","\\",89],["T_STRING","ResourceModel",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Billing",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Agreement",89],["T_DOUBLE_COLON","::",89],["T_CLASS","class",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Set created_at parameter\n     *\n     * @return \\Magento\\Framework\\Model\\AbstractModel\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","beforeSave",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$date",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_dateFactory",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","create",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","gmtDate",99],"(",")",";",["T_WHITESPACE","\n        ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","isObjectNew",100],"(",")",["T_WHITESPACE"," ",100],["T_BOOLEAN_AND","&&",100],["T_WHITESPACE"," ",100],"!",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCreatedAt",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setCreatedAt",101],"(",["T_VARIABLE","$date",101],")",";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE"," ",102],["T_ELSE","else",102],["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","setUpdatedAt",103],"(",["T_VARIABLE","$date",103],")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","parent",105],["T_DOUBLE_COLON","::",105],["T_STRING","beforeSave",105],"(",")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Save agreement order relations\n     *\n     * @return \\Magento\\Framework\\Model\\AbstractModel\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","afterSave",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(","!",["T_EMPTY","empty",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_relatedOrders",115],")",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_saveOrderRelations",116],"(",")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_STRING","parent",118],["T_DOUBLE_COLON","::",118],["T_STRING","afterSave",118],"(",")",";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Retrieve billing agreement status label\n     *\n     * @return \\Magento\\Framework\\Phrase|string\n     *\/",121],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","getStatusLabel",126],"(",")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_SWITCH","switch",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getStatus",128],"(",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_CASE","case",129],["T_WHITESPACE"," ",129],["T_STRING","self",129],["T_DOUBLE_COLON","::",129],["T_STRING","STATUS_ACTIVE",129],":",["T_WHITESPACE","\n                ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING","__",130],"(",["T_CONSTANT_ENCAPSED_STRING","'Active'",130],")",";",["T_WHITESPACE","\n            ",130],["T_CASE","case",131],["T_WHITESPACE"," ",131],["T_STRING","self",131],["T_DOUBLE_COLON","::",131],["T_STRING","STATUS_CANCELED",131],":",["T_WHITESPACE","\n                ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_STRING","__",132],"(",["T_CONSTANT_ENCAPSED_STRING","'Canceled'",132],")",";",["T_WHITESPACE","\n            ",132],["T_DEFAULT","default",133],":",["T_WHITESPACE","\n                ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","''",134],";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Initialize token\n     *\n     * @return string\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","initToken",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getPaymentMethodInstance",145],"(",")",["T_WHITESPACE","\n             ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","initBillingAgreementToken",146],"(",["T_VARIABLE","$this",146],")",";",["T_WHITESPACE","\n\n        ",146],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getRedirectUrl",148],"(",")",";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Get billing agreement details\n     * Data from response is inside this object\n     *\n     * @return $this\n     *\/",151],["T_WHITESPACE","\n    ",156],["T_PUBLIC","public",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","verifyToken",157],"(",")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getPaymentMethodInstance",159],"(",")",["T_WHITESPACE","\n             ",159],["T_OBJECT_OPERATOR","->",160],["T_STRING","getBillingAgreementTokenInfo",160],"(",["T_VARIABLE","$this",160],")",";",["T_WHITESPACE","\n\n        ",160],["T_RETURN","return",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * Create billing agreement\n     *\n     * @return $this\n     *\/",165],["T_WHITESPACE","\n    ",169],["T_PUBLIC","public",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","place",170],"(",")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","verifyToken",172],"(",")",";",["T_WHITESPACE","\n\n        ",172],["T_VARIABLE","$paymentMethodInstance",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getPaymentMethodInstance",174],"(",")",";",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$paymentMethodInstance",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","placeBillingAgreement",175],"(",["T_VARIABLE","$this",175],")",";",["T_WHITESPACE","\n\n        ",175],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","setCustomerId",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCustomerId",177],"(",")",")",["T_WHITESPACE","\n            ",177],["T_OBJECT_OPERATOR","->",178],["T_STRING","setMethodCode",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getMethodCode",178],"(",")",")",["T_WHITESPACE","\n            ",178],["T_OBJECT_OPERATOR","->",179],["T_STRING","setReferenceId",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getBillingAgreementId",179],"(",")",")",["T_WHITESPACE","\n            ",179],["T_OBJECT_OPERATOR","->",180],["T_STRING","setStatus",180],"(",["T_STRING","self",180],["T_DOUBLE_COLON","::",180],["T_STRING","STATUS_ACTIVE",180],")",["T_WHITESPACE","\n            ",180],["T_OBJECT_OPERATOR","->",181],["T_STRING","setAgreementLabel",181],"(",["T_VARIABLE","$paymentMethodInstance",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getTitle",181],"(",")",")",["T_WHITESPACE","\n            ",181],["T_OBJECT_OPERATOR","->",182],["T_STRING","save",182],"(",")",";",["T_WHITESPACE","\n\n        ",182],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_DOC_COMMENT","\/**\n     * Cancel billing agreement\n     *\n     * @return $this\n     *\/",187],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","cancel",192],"(",")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","setStatus",194],"(",["T_STRING","self",194],["T_DOUBLE_COLON","::",194],["T_STRING","STATUS_CANCELED",194],")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getPaymentMethodInstance",195],"(",")",["T_OBJECT_OPERATOR","->",195],["T_STRING","updateBillingAgreementStatus",195],"(",["T_VARIABLE","$this",195],")",";",["T_WHITESPACE","\n        ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","save",196],"(",")",";",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n\n    ",197],["T_DOC_COMMENT","\/**\n     * Check whether can cancel billing agreement\n     *\n     * @return bool\n     *\/",199],["T_WHITESPACE","\n    ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","canCancel",204],"(",")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_RETURN","return",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getStatus",206],"(",")",["T_WHITESPACE"," ",206],["T_IS_NOT_EQUAL","!=",206],["T_WHITESPACE"," ",206],["T_STRING","self",206],["T_DOUBLE_COLON","::",206],["T_STRING","STATUS_CANCELED",206],";",["T_WHITESPACE","\n    ",206],"}",["T_WHITESPACE","\n\n    ",207],["T_DOC_COMMENT","\/**\n     * Retrieve billing agreement statuses array\n     *\n     * @return array\n     *\/",209],["T_WHITESPACE","\n    ",213],["T_PUBLIC","public",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","getStatusesArray",214],"(",")",["T_WHITESPACE","\n    ",214],"{",["T_WHITESPACE","\n        ",215],["T_RETURN","return",216],["T_WHITESPACE"," ",216],"[",["T_WHITESPACE","\n            ",216],["T_STRING","self",217],["T_DOUBLE_COLON","::",217],["T_STRING","STATUS_ACTIVE",217],["T_WHITESPACE","     ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_STRING","__",217],"(",["T_CONSTANT_ENCAPSED_STRING","'Active'",217],")",",",["T_WHITESPACE","\n            ",217],["T_STRING","self",218],["T_DOUBLE_COLON","::",218],["T_STRING","STATUS_CANCELED",218],["T_WHITESPACE","   ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_STRING","__",218],"(",["T_CONSTANT_ENCAPSED_STRING","'Canceled'",218],")",["T_WHITESPACE","\n        ",218],"]",";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Validate data\n     *\n     * @return bool\n     *\/",222],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","isValid",227],"(",")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$result",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","parent",229],["T_DOUBLE_COLON","::",229],["T_STRING","isValid",229],"(",")",";",["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(","!",["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getCustomerId",230],"(",")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_errors",231],"[","]",["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","__",231],"(",["T_CONSTANT_ENCAPSED_STRING","'The customer ID is not set.'",231],")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n        ",232],["T_IF","if",233],["T_WHITESPACE"," ",233],"(","!",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getStatus",233],"(",")",")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_errors",234],"[","]",["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","__",234],"(",["T_CONSTANT_ENCAPSED_STRING","'The Billing Agreement status is not set.'",234],")",";",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n        ",235],["T_RETURN","return",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$result",236],["T_WHITESPACE"," ",236],["T_BOOLEAN_AND","&&",236],["T_WHITESPACE"," ",236],["T_EMPTY","empty",236],"(",["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_errors",236],")",";",["T_WHITESPACE","\n    ",236],"}",["T_WHITESPACE","\n\n    ",237],["T_DOC_COMMENT","\/**\n     * Import payment data to billing agreement\n     *\n     * $payment->getBillingAgreementData() contains array with following structure :\n     *  [billing_agreement_id]  => string\n     *  [method_code]           => string\n     *\n     * @param Payment $payment\n     * @return $this\n     *\/",239],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","importOrderPayment",249],"(",["T_STRING","Payment",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$payment",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$baData",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$payment",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getBillingAgreementData",251],"(",")",";",["T_WHITESPACE","\n\n        ",251],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_paymentMethodInstance",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],"(",["T_ISSET","isset",253],"(",["T_VARIABLE","$baData",253],"[",["T_CONSTANT_ENCAPSED_STRING","'method_code'",253],"]",")",")",["T_WHITESPACE","\n            ",253],"?",["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_paymentData",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getMethodInstance",254],"(",["T_VARIABLE","$baData",254],"[",["T_CONSTANT_ENCAPSED_STRING","'method_code'",254],"]",")",["T_WHITESPACE","\n            ",254],":",["T_WHITESPACE"," ",255],["T_VARIABLE","$payment",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getMethodInstance",255],"(",")",";",["T_WHITESPACE","\n\n        ",255],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_paymentMethodInstance",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","setStore",257],"(",["T_VARIABLE","$payment",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getMethodInstance",257],"(",")",["T_OBJECT_OPERATOR","->",257],["T_STRING","getStore",257],"(",")",")",";",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","setCustomerId",258],"(",["T_VARIABLE","$payment",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getOrder",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","getCustomerId",258],"(",")",")",["T_WHITESPACE","\n            ",258],["T_OBJECT_OPERATOR","->",259],["T_STRING","setMethodCode",259],"(",["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_paymentMethodInstance",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getCode",259],"(",")",")",["T_WHITESPACE","\n            ",259],["T_OBJECT_OPERATOR","->",260],["T_STRING","setReferenceId",260],"(",["T_VARIABLE","$baData",260],"[",["T_CONSTANT_ENCAPSED_STRING","'billing_agreement_id'",260],"]",")",["T_WHITESPACE","\n            ",260],["T_OBJECT_OPERATOR","->",261],["T_STRING","setStatus",261],"(",["T_STRING","self",261],["T_DOUBLE_COLON","::",261],["T_STRING","STATUS_ACTIVE",261],")",["T_WHITESPACE","\n            ",261],["T_OBJECT_OPERATOR","->",262],["T_STRING","setAgreementLabel",262],"(",["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_paymentMethodInstance",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getTitle",262],"(",")",")",";",["T_WHITESPACE","\n\n        ",262],["T_RETURN","return",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n    ",265],["T_DOC_COMMENT","\/**\n     * Retrieve available customer Billing Agreements\n     *\n     * @param int $customerId\n     * @return \\Magento\\Paypal\\Model\\ResourceModel\\Billing\\Agreement\\Collection\n     *\/",267],["T_WHITESPACE","\n    ",272],["T_PUBLIC","public",273],["T_WHITESPACE"," ",273],["T_FUNCTION","function",273],["T_WHITESPACE"," ",273],["T_STRING","getAvailableCustomerBillingAgreements",273],"(",["T_VARIABLE","$customerId",273],")",["T_WHITESPACE","\n    ",273],"{",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$collection",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_billingAgreementFactory",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","create",275],"(",")",";",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$collection",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","addFieldToFilter",276],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$customerId",276],")",["T_WHITESPACE","\n            ",276],["T_OBJECT_OPERATOR","->",277],["T_STRING","addFieldToFilter",277],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",277],",",["T_WHITESPACE"," ",277],["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","STATUS_ACTIVE",277],")",["T_WHITESPACE","\n            ",277],["T_OBJECT_OPERATOR","->",278],["T_STRING","setOrder",278],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement_id'",278],")",";",["T_WHITESPACE","\n        ",278],["T_RETURN","return",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$collection",279],";",["T_WHITESPACE","\n    ",279],"}",["T_WHITESPACE","\n\n    ",280],["T_DOC_COMMENT","\/**\n     * Check whether need to create billing agreement for customer\n     *\n     * @param int $customerId\n     * @return bool\n     *\/",282],["T_WHITESPACE","\n    ",287],["T_PUBLIC","public",288],["T_WHITESPACE"," ",288],["T_FUNCTION","function",288],["T_WHITESPACE"," ",288],["T_STRING","needToCreateForCustomer",288],"(",["T_VARIABLE","$customerId",288],")",["T_WHITESPACE","\n    ",288],"{",["T_WHITESPACE","\n        ",289],["T_RETURN","return",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$customerId",290],["T_WHITESPACE"," ",290],"?",["T_WHITESPACE"," ",290],["T_STRING","count",290],"(",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getAvailableCustomerBillingAgreements",290],"(",["T_VARIABLE","$customerId",290],")",")",["T_WHITESPACE"," ",290],["T_IS_EQUAL","==",290],["T_WHITESPACE"," ",290],["T_LNUMBER","0",290],["T_WHITESPACE"," ",290],":",["T_WHITESPACE"," ",290],["T_STRING","false",290],";",["T_WHITESPACE","\n    ",290],"}",["T_WHITESPACE","\n\n    ",291],["T_DOC_COMMENT","\/**\n     * Add order relation to current billing agreement\n     *\n     * @param int|\\Magento\\Sales\\Model\\Order $orderId\n     * @return $this\n     *\/",293],["T_WHITESPACE","\n    ",298],["T_PUBLIC","public",299],["T_WHITESPACE"," ",299],["T_FUNCTION","function",299],["T_WHITESPACE"," ",299],["T_STRING","addOrderRelation",299],"(",["T_VARIABLE","$orderId",299],")",["T_WHITESPACE","\n    ",299],"{",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_relatedOrders",301],"[","]",["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$orderId",301],";",["T_WHITESPACE","\n        ",301],["T_RETURN","return",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],";",["T_WHITESPACE","\n    ",302],"}",["T_WHITESPACE","\n\n    ",303],["T_DOC_COMMENT","\/**\n     * Save related orders\n     *\n     * @return void\n     *\/",305],["T_WHITESPACE","\n    ",309],["T_PROTECTED","protected",310],["T_WHITESPACE"," ",310],["T_FUNCTION","function",310],["T_WHITESPACE"," ",310],["T_STRING","_saveOrderRelations",310],"(",")",["T_WHITESPACE","\n    ",310],"{",["T_WHITESPACE","\n        ",311],["T_FOREACH","foreach",312],["T_WHITESPACE"," ",312],"(",["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","_relatedOrders",312],["T_WHITESPACE"," ",312],["T_AS","as",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$order",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n            ",312],["T_VARIABLE","$orderId",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$order",313],["T_WHITESPACE"," ",313],["T_INSTANCEOF","instanceof",313],["T_WHITESPACE"," ",313],["T_NS_SEPARATOR","\\",313],["T_STRING","Magento",313],["T_NS_SEPARATOR","\\",313],["T_STRING","Sales",313],["T_NS_SEPARATOR","\\",313],["T_STRING","Model",313],["T_NS_SEPARATOR","\\",313],["T_STRING","Order",313],["T_WHITESPACE"," ",313],"?",["T_WHITESPACE"," ",313],["T_VARIABLE","$order",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getId",313],"(",")",["T_WHITESPACE"," ",313],":",["T_WHITESPACE"," ",313],["T_INT_CAST","(int)",313],["T_VARIABLE","$order",313],";",["T_WHITESPACE","\n            ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getResource",314],"(",")",["T_OBJECT_OPERATOR","->",314],["T_STRING","addOrderRelation",314],"(",["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getId",314],"(",")",",",["T_WHITESPACE"," ",314],["T_VARIABLE","$orderId",314],")",";",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE","\n    ",315],"}",["T_WHITESPACE","\n",316],"}",["T_WHITESPACE","\n",317]]