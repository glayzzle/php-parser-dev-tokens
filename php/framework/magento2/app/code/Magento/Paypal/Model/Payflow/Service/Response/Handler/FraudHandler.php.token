[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Paypal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Payflow",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Service",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Response",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Handler",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","DataObject",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Payment",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","InfoInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Paypal",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Info",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Paypal",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Payflowpro",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Exception",12],["T_NS_SEPARATOR","\\",12],["T_STRING","LocalizedException",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Xml",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Security",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * Class FraudHandler\n *\/",15],["T_WHITESPACE","\n",17],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","FraudHandler",18],["T_WHITESPACE"," ",18],["T_IMPLEMENTS","implements",18],["T_WHITESPACE"," ",18],["T_STRING","HandlerInterface",18],["T_WHITESPACE","\n",18],"{",["T_WHITESPACE","\n    ",19],["T_DOC_COMMENT","\/**\n     * Response message code\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_CONST","const",23],["T_WHITESPACE"," ",23],["T_STRING","RESPONSE_MESSAGE",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'respmsg'",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Fraud rules xml code\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_CONST","const",28],["T_WHITESPACE"," ",28],["T_STRING","FRAUD_RULES_XML",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'fps_prexmldata'",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * @var Info\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_PRIVATE","private",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$paypalInfoManager",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * The security scanner XML document\n     *\n     * @var Security\n     *\/",35],["T_WHITESPACE","\n    ",39],["T_PRIVATE","private",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$xmlSecurity",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param Info $paypalInfoManager\n     * @param Security $xmlSecurity\n     *\/",42],["T_WHITESPACE","\n    ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","__construct",48],"(",["T_STRING","Info",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$paypalInfoManager",48],",",["T_WHITESPACE"," ",48],["T_STRING","Security",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$xmlSecurity",48],")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","paypalInfoManager",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$paypalInfoManager",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","xmlSecurity",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$xmlSecurity",51],";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * {inheritdoc}\n     *\/",54],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","handle",57],"(",["T_STRING","InfoInterface",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$payment",57],",",["T_WHITESPACE"," ",57],["T_STRING","DataObject",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$response",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_WHITESPACE","\n        ",59],"!",["T_STRING","in_array",60],"(",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$response",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getData",61],"(",["T_CONSTANT_ENCAPSED_STRING","'result'",61],")",",",["T_WHITESPACE","\n            ",61],"[",["T_WHITESPACE","\n                ",62],["T_STRING","Payflowpro",63],["T_DOUBLE_COLON","::",63],["T_STRING","RESPONSE_CODE_DECLINED_BY_FILTER",63],",",["T_WHITESPACE","\n                ",63],["T_STRING","Payflowpro",64],["T_DOUBLE_COLON","::",64],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",64],["T_WHITESPACE","\n            ",64],"]",["T_WHITESPACE","\n        ",65],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_RETURN","return",67],";",["T_WHITESPACE","\n        ",67],"}",["T_WHITESPACE","\n\n        ",68],["T_VARIABLE","$fraudMessages",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],"[",["T_CONSTANT_ENCAPSED_STRING","'RESPMSG'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$response",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getData",70],"(",["T_STRING","self",70],["T_DOUBLE_COLON","::",70],["T_STRING","RESPONSE_MESSAGE",70],")","]",";",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$response",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getData",71],"(",["T_STRING","self",71],["T_DOUBLE_COLON","::",71],["T_STRING","FRAUD_RULES_XML",71],")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$fraudMessages",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","array_merge",72],"(",["T_WHITESPACE","\n                ",72],["T_VARIABLE","$fraudMessages",73],",",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getFraudRulesDictionary",74],"(",["T_VARIABLE","$response",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getData",74],"(",["T_STRING","self",74],["T_DOUBLE_COLON","::",74],["T_STRING","FRAUD_RULES_XML",74],")",")",["T_WHITESPACE","\n            ",74],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","paypalInfoManager",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","importToPayment",78],"(",["T_WHITESPACE","\n            ",78],"[",["T_WHITESPACE","\n                ",79],["T_STRING","Info",80],["T_DOUBLE_COLON","::",80],["T_STRING","FRAUD_FILTERS",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE","\n                ",80],["T_STRING","array_merge",81],"(",["T_WHITESPACE","\n                    ",81],["T_VARIABLE","$fraudMessages",82],",",["T_WHITESPACE","\n                    ",82],["T_ARRAY_CAST","(array)",83],["T_VARIABLE","$payment",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getAdditionalInformation",83],"(",["T_STRING","Info",83],["T_DOUBLE_COLON","::",83],["T_STRING","FRAUD_FILTERS",83],")",["T_WHITESPACE","\n                ",83],")",["T_WHITESPACE","\n            ",84],"]",",",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$payment",86],["T_WHITESPACE","\n        ",86],")",";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Converts rules xml document to description=>message dictionary\n     *\n     * @param string $rulesString\n     * @return array\n     * @throws LocalizedException\n     *\/",90],["T_WHITESPACE","\n    ",96],["T_PRIVATE","private",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","getFraudRulesDictionary",97],"(",["T_VARIABLE","$rulesString",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$rules",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],"[","]",";",["T_WHITESPACE","\n\n        ",99],["T_IF","if",101],["T_WHITESPACE"," ",101],"(","!",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","xmlSecurity",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","scan",101],"(",["T_VARIABLE","$rulesString",101],")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$rules",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n\n        ",103],["T_TRY","try",105],["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$rulesXml",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_NEW","new",106],["T_WHITESPACE"," ",106],["T_NS_SEPARATOR","\\",106],["T_STRING","SimpleXMLElement",106],"(",["T_VARIABLE","$rulesString",106],")",";",["T_WHITESPACE","\n            ",106],["T_FOREACH","foreach",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$rulesXml",107],["T_OBJECT_OPERATOR","->",107],"{",["T_CONSTANT_ENCAPSED_STRING","'rule'",107],"}",["T_WHITESPACE"," ",107],["T_AS","as",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$rule",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                ",107],["T_VARIABLE","$rules",108],"[",["T_STRING_CAST","(string)",108],["T_VARIABLE","$rule",108],["T_OBJECT_OPERATOR","->",108],"{",["T_CONSTANT_ENCAPSED_STRING","'ruleDescription'",108],"}","]",["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING_CAST","(string)",108],["T_VARIABLE","$rule",108],["T_OBJECT_OPERATOR","->",108],"{",["T_CONSTANT_ENCAPSED_STRING","'triggeredMessage'",108],"}",";",["T_WHITESPACE","\n            ",108],"}",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE"," ",110],["T_CATCH","catch",110],["T_WHITESPACE"," ",110],"(",["T_NS_SEPARATOR","\\",110],["T_STRING","Exception",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$e",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n\n        ",110],"}",["T_WHITESPACE"," ",112],["T_FINALLY","finally",112],["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_STRING","libxml_use_internal_errors",113],"(",["T_STRING","false",113],")",";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n\n        ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$rules",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n",117],"}",["T_WHITESPACE","\n",118]]