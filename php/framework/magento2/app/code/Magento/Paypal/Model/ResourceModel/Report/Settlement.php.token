[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Paypal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Report",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Report settlement resource model\n *\/",11],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Settlement",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Db",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractDb",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Table name\n     *\n     * @var string\n     *\/",16],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$_rowsTable",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Stdlib\\DateTime\\DateTime\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$_coreDate",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $coreDate\n     * @param string $connectionName\n     *\/",28],["T_WHITESPACE","\n    ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","__construct",33],"(",["T_WHITESPACE","\n        ",33],["T_NS_SEPARATOR","\\",34],["T_STRING","Magento",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Framework",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Model",34],["T_NS_SEPARATOR","\\",34],["T_STRING","ResourceModel",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Db",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Context",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$context",34],",",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Framework",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Stdlib",35],["T_NS_SEPARATOR","\\",35],["T_STRING","DateTime",35],["T_NS_SEPARATOR","\\",35],["T_STRING","DateTime",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$coreDate",35],",",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$connectionName",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_STRING","null",36],["T_WHITESPACE","\n    ",36],")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_coreDate",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$coreDate",38],";",["T_WHITESPACE","\n        ",38],["T_STRING","parent",39],["T_DOUBLE_COLON","::",39],["T_STRING","__construct",39],"(",["T_VARIABLE","$context",39],",",["T_WHITESPACE"," ",39],["T_VARIABLE","$connectionName",39],")",";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Init main table\n     *\n     * @return void\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","_construct",47],"(",")",["T_WHITESPACE","\n    ",47],"{",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_init",49],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_settlement_report'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'report_id'",49],")",";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_rowsTable",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getTable",50],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_settlement_report_row'",50],")",";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Save report rows collected in settlement model\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel|\\Magento\\Paypal\\Model\\Report\\Settlement $object\n     * @return $this\n     *\/",53],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","_afterSave",59],"(",["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Framework",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Model",59],["T_NS_SEPARATOR","\\",59],["T_STRING","AbstractModel",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$object",59],")",["T_WHITESPACE","\n    ",59],"{",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$rows",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$object",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getRows",61],"(",")",";",["T_WHITESPACE","\n        ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_STRING","is_array",62],"(",["T_VARIABLE","$rows",62],")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$connection",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getConnection",63],"(",")",";",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$reportId",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_INT_CAST","(int)",64],["T_VARIABLE","$object",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",";",["T_WHITESPACE","\n            ",64],["T_TRY","try",65],["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                ",65],["T_VARIABLE","$connection",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","beginTransaction",66],"(",")",";",["T_WHITESPACE","\n                ",66],["T_IF","if",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$reportId",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                    ",67],["T_VARIABLE","$connection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","delete",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_rowsTable",68],",",["T_WHITESPACE"," ",68],"[",["T_CONSTANT_ENCAPSED_STRING","'report_id = ?'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$reportId",68],"]",")",";",["T_WHITESPACE","\n                ",68],"}",["T_WHITESPACE","\n\n                ",69],["T_FOREACH","foreach",71],["T_WHITESPACE"," ",71],"(",["T_STRING","array_keys",71],"(",["T_VARIABLE","$rows",71],")",["T_WHITESPACE"," ",71],["T_AS","as",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$key",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                    ",71],["T_DOC_COMMENT","\/**\n                     * Converting dates\n                     *\/",72],["T_WHITESPACE","\n                    ",74],["T_VARIABLE","$completionDate",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_NEW","new",75],["T_WHITESPACE"," ",75],["T_NS_SEPARATOR","\\",75],["T_STRING","DateTime",75],"(",["T_VARIABLE","$rows",75],"[",["T_VARIABLE","$key",75],"]","[",["T_CONSTANT_ENCAPSED_STRING","'transaction_completion_date'",75],"]",")",";",["T_WHITESPACE","\n                    ",75],["T_VARIABLE","$rows",76],"[",["T_VARIABLE","$key",76],"]","[",["T_CONSTANT_ENCAPSED_STRING","'transaction_completion_date'",76],"]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$completionDate",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","format",76],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",76],")",";",["T_WHITESPACE","\n                    ",76],["T_VARIABLE","$initiationDate",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_NEW","new",77],["T_WHITESPACE"," ",77],["T_NS_SEPARATOR","\\",77],["T_STRING","DateTime",77],"(",["T_VARIABLE","$rows",77],"[",["T_VARIABLE","$key",77],"]","[",["T_CONSTANT_ENCAPSED_STRING","'transaction_initiation_date'",77],"]",")",";",["T_WHITESPACE","\n                    ",77],["T_VARIABLE","$rows",78],"[",["T_VARIABLE","$key",78],"]","[",["T_CONSTANT_ENCAPSED_STRING","'transaction_initiation_date'",78],"]",["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$initiationDate",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","format",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",78],")",";",["T_WHITESPACE","\n                    ",78],["T_COMMENT","\/*\n                     * Converting numeric\n                     *\/",79],["T_WHITESPACE","\n                    ",81],["T_VARIABLE","$rows",82],"[",["T_VARIABLE","$key",82],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fee_amount'",82],"]",["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_DOUBLE_CAST","(double)",82],["T_VARIABLE","$rows",82],"[",["T_VARIABLE","$key",82],"]","[",["T_CONSTANT_ENCAPSED_STRING","'fee_amount'",82],"]",";",["T_WHITESPACE","\n                    ",82],["T_COMMENT","\/*\n                     * Setting reportId\n                     *\/",83],["T_WHITESPACE","\n                    ",85],["T_VARIABLE","$rows",86],"[",["T_VARIABLE","$key",86],"]","[",["T_CONSTANT_ENCAPSED_STRING","'report_id'",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$reportId",86],";",["T_WHITESPACE","\n                ",86],"}",["T_WHITESPACE","\n                ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(","!",["T_EMPTY","empty",88],"(",["T_VARIABLE","$rows",88],")",")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                    ",88],["T_VARIABLE","$connection",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","insertMultiple",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_rowsTable",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$rows",89],")",";",["T_WHITESPACE","\n                ",89],"}",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$connection",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","commit",91],"(",")",";",["T_WHITESPACE","\n            ",91],"}",["T_WHITESPACE"," ",92],["T_CATCH","catch",92],["T_WHITESPACE"," ",92],"(",["T_NS_SEPARATOR","\\",92],["T_STRING","Exception",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$e",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$connection",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","rollback",93],"(",")",";",["T_WHITESPACE","\n            ",93],"}",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Check if report with same account and report date already fetched\n     *\n     * @param \\Magento\\Paypal\\Model\\Report\\Settlement $report\n     * @param string $accountId\n     * @param string $reportDate\n     * @return $this\n     *\/",100],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","loadByAccountAndDate",108],"(",["T_NS_SEPARATOR","\\",108],["T_STRING","Magento",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Paypal",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Model",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Report",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Settlement",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$report",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$accountId",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$reportDate",108],")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$connection",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getConnection",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$select",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$connection",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","select",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","from",111],"(",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getMainTable",112],"(",")",["T_WHITESPACE","\n        ",112],")",["T_OBJECT_OPERATOR","->",113],["T_STRING","where",113],"(",["T_WHITESPACE","\n            ",113],["T_CONSTANT_ENCAPSED_STRING","'account_id = :account_id'",114],["T_WHITESPACE","\n        ",114],")",["T_OBJECT_OPERATOR","->",115],["T_STRING","where",115],"(",["T_WHITESPACE","\n            ",115],["T_CONSTANT_ENCAPSED_STRING","'report_date = :report_date'",116],["T_WHITESPACE","\n        ",116],")",";",["T_WHITESPACE","\n\n        ",117],["T_VARIABLE","$data",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$connection",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","fetchRow",119],"(",["T_VARIABLE","$select",119],",",["T_WHITESPACE"," ",119],"[",["T_CONSTANT_ENCAPSED_STRING","':account_id'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$accountId",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","':report_date'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$reportDate",119],"]",")",";",["T_WHITESPACE","\n        ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$data",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$report",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","addData",121],"(",["T_VARIABLE","$data",121],")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n\n        ",122],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n",125],"}",["T_WHITESPACE","\n",126]]