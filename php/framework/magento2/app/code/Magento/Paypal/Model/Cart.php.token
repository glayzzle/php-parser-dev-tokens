[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Paypal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * PayPal-specific model for shopping cart items and totals\n * The main idea is to accommodate all possible totals into PayPal-compatible 4 totals and line items\n *\/",8],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","Cart",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Payment",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Cart",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_DOC_COMMENT","\/**\n     * @var bool\n     *\/",14],["T_WHITESPACE","\n    ",16],["T_PROTECTED","protected",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$_areAmountsValid",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_STRING","false",17],";",["T_WHITESPACE","\n\n    ",17],["T_DOC_COMMENT","\/**\n     * Get shipping, tax, subtotal and discount amounts all together\n     *\n     * @return array\n     *\/",19],["T_WHITESPACE","\n    ",23],["T_PUBLIC","public",24],["T_WHITESPACE"," ",24],["T_FUNCTION","function",24],["T_WHITESPACE"," ",24],["T_STRING","getAmounts",24],"(",")",["T_WHITESPACE","\n    ",24],"{",["T_WHITESPACE","\n        ",25],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","_collectItemsAndAmounts",26],"(",")",";",["T_WHITESPACE","\n\n        ",26],["T_IF","if",28],["T_WHITESPACE"," ",28],"(","!",["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","_areAmountsValid",28],")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n            ",28],["T_VARIABLE","$subtotal",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getSubtotal",29],"(",")",["T_WHITESPACE"," ",29],"+",["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getTax",29],"(",")",";",["T_WHITESPACE","\n\n            ",29],["T_IF","if",31],["T_WHITESPACE"," ",31],"(",["T_EMPTY","empty",31],"(",["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","_transferFlags",31],"[",["T_STRING","self",31],["T_DOUBLE_COLON","::",31],["T_STRING","AMOUNT_SHIPPING",31],"]",")",")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n                ",31],["T_VARIABLE","$subtotal",32],["T_WHITESPACE"," ",32],["T_PLUS_EQUAL","+=",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getShipping",32],"(",")",";",["T_WHITESPACE","\n            ",32],"}",["T_WHITESPACE","\n\n            ",33],["T_IF","if",35],["T_WHITESPACE"," ",35],"(",["T_EMPTY","empty",35],"(",["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","_transferFlags",35],"[",["T_STRING","self",35],["T_DOUBLE_COLON","::",35],["T_STRING","AMOUNT_DISCOUNT",35],"]",")",")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n                ",35],["T_VARIABLE","$subtotal",36],["T_WHITESPACE"," ",36],["T_MINUS_EQUAL","-=",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getDiscount",36],"(",")",";",["T_WHITESPACE","\n            ",36],"}",["T_WHITESPACE","\n\n            ",37],["T_RETURN","return",39],["T_WHITESPACE"," ",39],"[",["T_STRING","self",39],["T_DOUBLE_COLON","::",39],["T_STRING","AMOUNT_SUBTOTAL",39],["T_WHITESPACE"," ",39],["T_DOUBLE_ARROW","=>",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$subtotal",39],"]",";",["T_WHITESPACE","\n        ",39],"}",["T_WHITESPACE","\n\n        ",40],["T_RETURN","return",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_amounts",42],";",["T_WHITESPACE","\n    ",42],"}",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Calculate subtotal from custom items\n     *\n     * @return void\n     *\/",45],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","_calculateCustomItemsSubtotal",50],"(",")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_STRING","parent",52],["T_DOUBLE_COLON","::",52],["T_STRING","_calculateCustomItemsSubtotal",52],"(",")",";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_applyDiscountTaxCompensationWorkaround",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_salesModel",53],")",";",["T_WHITESPACE","\n\n        ",53],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_validate",55],"(",")",";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Check the line items and totals according to PayPal business logic limitations\n     *\n     * @return void\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","_validate",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$areItemsValid",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","false",65],";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_areAmountsValid",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","false",66],";",["T_WHITESPACE","\n\n        ",66],["T_VARIABLE","$referenceAmount",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_salesModel",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getDataUsingMethod",68],"(",["T_CONSTANT_ENCAPSED_STRING","'base_grand_total'",68],")",";",["T_WHITESPACE","\n\n        ",68],["T_VARIABLE","$itemsSubtotal",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_LNUMBER","0",70],";",["T_WHITESPACE","\n        ",70],["T_FOREACH","foreach",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getAllItems",71],"(",")",["T_WHITESPACE"," ",71],["T_AS","as",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$i",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$itemsSubtotal",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$itemsSubtotal",72],["T_WHITESPACE"," ",72],"+",["T_WHITESPACE"," ",72],["T_VARIABLE","$i",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getQty",72],"(",")",["T_WHITESPACE"," ",72],"*",["T_WHITESPACE"," ",72],["T_VARIABLE","$i",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getAmount",72],"(",")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n\n        ",73],["T_VARIABLE","$sum",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$itemsSubtotal",75],["T_WHITESPACE"," ",75],"+",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getTax",75],"(",")",";",["T_WHITESPACE","\n\n        ",75],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_EMPTY","empty",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_transferFlags",77],"[",["T_STRING","self",77],["T_DOUBLE_COLON","::",77],["T_STRING","AMOUNT_SHIPPING",77],"]",")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$sum",78],["T_WHITESPACE"," ",78],["T_PLUS_EQUAL","+=",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getShipping",78],"(",")",";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n\n        ",79],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_EMPTY","empty",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_transferFlags",81],"[",["T_STRING","self",81],["T_DOUBLE_COLON","::",81],["T_STRING","AMOUNT_DISCOUNT",81],"]",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$sum",82],["T_WHITESPACE"," ",82],["T_MINUS_EQUAL","-=",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getDiscount",82],"(",")",";",["T_WHITESPACE","\n            ",82],["T_COMMENT","\/\/ PayPal requires to have discount less than items subtotal\n",83],["T_WHITESPACE","            ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_areAmountsValid",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","round",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getDiscount",84],"(",")",",",["T_WHITESPACE"," ",84],["T_LNUMBER","4",84],")",["T_WHITESPACE"," ",84],"<",["T_WHITESPACE"," ",84],["T_STRING","round",84],"(",["T_VARIABLE","$itemsSubtotal",84],",",["T_WHITESPACE"," ",84],["T_LNUMBER","4",84],")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE"," ",85],["T_ELSE","else",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_areAmountsValid",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$itemsSubtotal",86],["T_WHITESPACE"," ",86],">",["T_WHITESPACE"," ",86],["T_DNUMBER","0.00001",86],";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_DOC_COMMENT","\/**\n         * numbers are intentionally converted to strings because of possible comparison error\n         * see http:\/\/php.net\/float\n         *\/",89],["T_WHITESPACE","\n        ",92],["T_COMMENT","\/\/ match sum of all the items and totals to the reference amount\n",93],["T_WHITESPACE","        ",94],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_STRING","sprintf",94],"(",["T_CONSTANT_ENCAPSED_STRING","'%.4F'",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$sum",94],")",["T_WHITESPACE"," ",94],["T_IS_EQUAL","==",94],["T_WHITESPACE"," ",94],["T_STRING","sprintf",94],"(",["T_CONSTANT_ENCAPSED_STRING","'%.4F'",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$referenceAmount",94],")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$areItemsValid",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","true",95],";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$areItemsValid",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$areItemsValid",98],["T_WHITESPACE"," ",98],["T_BOOLEAN_AND","&&",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_areAmountsValid",98],";",["T_WHITESPACE","\n\n        ",98],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_VARIABLE","$areItemsValid",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_salesModelItems",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],"[","]",";",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_customItems",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],"[","]",";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Import items from sales model with workarounds for PayPal\n     *\n     * @return void\n     *\/",106],["T_WHITESPACE","\n    ",110],["T_PROTECTED","protected",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","_importItemsFromSalesModel",111],"(",")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_salesModelItems",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],"[","]",";",["T_WHITESPACE","\n\n        ",113],["T_FOREACH","foreach",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_salesModel",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getAllItems",115],"(",")",["T_WHITESPACE"," ",115],["T_AS","as",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$item",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$item",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getParentItem",116],"(",")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                ",116],["T_CONTINUE","continue",117],";",["T_WHITESPACE","\n            ",117],"}",["T_WHITESPACE","\n\n            ",118],["T_VARIABLE","$amount",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$item",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getPrice",120],"(",")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$qty",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$item",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getQty",121],"(",")",";",["T_WHITESPACE","\n\n            ",121],["T_VARIABLE","$subAggregatedLabel",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","''",123],";",["T_WHITESPACE","\n\n            ",123],["T_COMMENT","\/\/ workaround in case if item subtotal precision is not compatible with PayPal (.2)\n",125],["T_WHITESPACE","            ",126],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$amount",126],["T_WHITESPACE"," ",126],"-",["T_WHITESPACE"," ",126],["T_STRING","round",126],"(",["T_VARIABLE","$amount",126],",",["T_WHITESPACE"," ",126],["T_LNUMBER","2",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                ",126],["T_VARIABLE","$amount",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$amount",127],["T_WHITESPACE"," ",127],"*",["T_WHITESPACE"," ",127],["T_VARIABLE","$qty",127],";",["T_WHITESPACE","\n                ",127],["T_VARIABLE","$subAggregatedLabel",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","' x'",128],["T_WHITESPACE"," ",128],".",["T_WHITESPACE"," ",128],["T_VARIABLE","$qty",128],";",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$qty",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_LNUMBER","1",129],";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE","\n\n            ",130],["T_COMMENT","\/\/ aggregate item price if item qty * price does not match row total\n",132],["T_WHITESPACE","            ",133],["T_VARIABLE","$itemBaseRowTotal",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$item",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getOriginalItem",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","getBaseRowTotal",133],"(",")",";",["T_WHITESPACE","\n            ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$amount",134],["T_WHITESPACE"," ",134],"*",["T_WHITESPACE"," ",134],["T_VARIABLE","$qty",134],["T_WHITESPACE"," ",134],["T_IS_NOT_EQUAL","!=",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$itemBaseRowTotal",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$amount",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_DOUBLE_CAST","(double)",135],["T_VARIABLE","$itemBaseRowTotal",135],";",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$subAggregatedLabel",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","' x'",136],["T_WHITESPACE"," ",136],".",["T_WHITESPACE"," ",136],["T_VARIABLE","$qty",136],";",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$qty",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_LNUMBER","1",137],";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n\n            ",138],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_salesModelItems",140],"[","]",["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_createItemFromData",140],"(",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$item",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getName",141],"(",")",["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_VARIABLE","$subAggregatedLabel",141],",",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$qty",142],",",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$amount",143],["T_WHITESPACE","\n            ",143],")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","addSubtotal",147],"(",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_salesModel",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getBaseSubtotal",147],"(",")",")",";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","addTax",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_salesModel",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getBaseTaxAmount",148],"(",")",")",";",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","addShipping",149],"(",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_salesModel",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getBaseShippingAmount",149],"(",")",")",";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","addDiscount",150],"(",["T_STRING","abs",150],"(",["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_salesModel",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getBaseDiscountAmount",150],"(",")",")",")",";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Add \"hidden\" discount and shipping tax\n     *\n     * Go ahead, try to understand ]:->\n     *\n     * Tax settings for getting \"discount tax\":\n     * - Catalog Prices = Including Tax\n     * - Apply Customer Tax = After Discount\n     * - Apply Discount on Prices = Including Tax\n     *\n     * Test case for getting \"hidden shipping tax\":\n     * - Make sure shipping is taxable (set shipping tax class)\n     * - Catalog Prices = Including Tax\n     * - Shipping Prices = Including Tax\n     * - Apply Customer Tax = After Discount\n     * - Create a cart price rule with % discount applied to the Shipping Amount\n     * - run shopping cart and estimate shipping\n     * - go to PayPal\n     *\n     * @param \\Magento\\Payment\\Model\\Cart\\SalesModel\\SalesModelInterface $salesEntity\n     * @return void\n     *\/",153],["T_WHITESPACE","\n    ",174],["T_PROTECTED","protected",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","_applyDiscountTaxCompensationWorkaround",175],"(",["T_WHITESPACE","\n        ",175],["T_NS_SEPARATOR","\\",176],["T_STRING","Magento",176],["T_NS_SEPARATOR","\\",176],["T_STRING","Payment",176],["T_NS_SEPARATOR","\\",176],["T_STRING","Model",176],["T_NS_SEPARATOR","\\",176],["T_STRING","Cart",176],["T_NS_SEPARATOR","\\",176],["T_STRING","SalesModel",176],["T_NS_SEPARATOR","\\",176],["T_STRING","SalesModelInterface",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$salesEntity",176],["T_WHITESPACE","\n    ",176],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$dataContainer",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$salesEntity",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getTaxContainer",178],"(",")",";",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","addTax",179],"(",["T_DOUBLE_CAST","(double)",179],["T_VARIABLE","$dataContainer",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getBaseDiscountTaxCompensationAmount",179],"(",")",")",";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","addTax",180],"(",["T_DOUBLE_CAST","(double)",180],["T_VARIABLE","$dataContainer",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getBaseShippingDiscountTaxCompensationAmnt",180],"(",")",")",";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Check whether any item has negative amount\n     *\n     * @return bool\n     *\/",183],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","hasNegativeItemAmount",188],"(",")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_FOREACH","foreach",190],["T_WHITESPACE"," ",190],"(",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_customItems",190],["T_WHITESPACE"," ",190],["T_AS","as",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$item",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$item",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getAmount",191],"(",")",["T_WHITESPACE"," ",191],"<",["T_WHITESPACE"," ",191],["T_LNUMBER","0",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                ",191],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_STRING","true",192],";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n        ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_STRING","false",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n",196],"}",["T_WHITESPACE","\n",197]]