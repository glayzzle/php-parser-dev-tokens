[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",6],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Paypal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Controller",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Express",7],["T_NS_SEPARATOR","\\",7],["T_STRING","AbstractExpress",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Paypal",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ProcessableException",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","ApiProcessableException",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Class PlaceOrder\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",11],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","PlaceOrder",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Paypal",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Controller",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Express",15],["T_NS_SEPARATOR","\\",15],["T_STRING","AbstractExpress",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Checkout\\Api\\AgreementsValidatorInterface\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$agreementsValidator",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\App\\Action\\Context $context\n     * @param \\Magento\\Customer\\Model\\Session $customerSession\n     * @param \\Magento\\Checkout\\Model\\Session $checkoutSession\n     * @param \\Magento\\Sales\\Model\\OrderFactory $orderFactory\n     * @param \\Magento\\Paypal\\Model\\Express\\Checkout\\Factory $checkoutFactory\n     * @param \\Magento\\Framework\\Session\\Generic $paypalSession\n     * @param \\Magento\\Framework\\Url\\Helper\\Data $urlHelper\n     * @param \\Magento\\Customer\\Model\\Url $customerUrl\n     * @param \\Magento\\Checkout\\Api\\AgreementsValidatorInterface $agreementValidator\n     *\/",22],["T_WHITESPACE","\n    ",32],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","__construct",33],"(",["T_WHITESPACE","\n        ",33],["T_NS_SEPARATOR","\\",34],["T_STRING","Magento",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Framework",34],["T_NS_SEPARATOR","\\",34],["T_STRING","App",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Action",34],["T_NS_SEPARATOR","\\",34],["T_STRING","Context",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$context",34],",",["T_WHITESPACE","\n        ",34],["T_NS_SEPARATOR","\\",35],["T_STRING","Magento",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Customer",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Model",35],["T_NS_SEPARATOR","\\",35],["T_STRING","Session",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$customerSession",35],",",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Checkout",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Session",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$checkoutSession",36],",",["T_WHITESPACE","\n        ",36],["T_NS_SEPARATOR","\\",37],["T_STRING","Magento",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Sales",37],["T_NS_SEPARATOR","\\",37],["T_STRING","Model",37],["T_NS_SEPARATOR","\\",37],["T_STRING","OrderFactory",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$orderFactory",37],",",["T_WHITESPACE","\n        ",37],["T_NS_SEPARATOR","\\",38],["T_STRING","Magento",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Paypal",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Model",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Express",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Checkout",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Factory",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$checkoutFactory",38],",",["T_WHITESPACE","\n        ",38],["T_NS_SEPARATOR","\\",39],["T_STRING","Magento",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Framework",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Session",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Generic",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$paypalSession",39],",",["T_WHITESPACE","\n        ",39],["T_NS_SEPARATOR","\\",40],["T_STRING","Magento",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Framework",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Url",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Helper",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Data",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$urlHelper",40],",",["T_WHITESPACE","\n        ",40],["T_NS_SEPARATOR","\\",41],["T_STRING","Magento",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Customer",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Model",41],["T_NS_SEPARATOR","\\",41],["T_STRING","Url",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$customerUrl",41],",",["T_WHITESPACE","\n        ",41],["T_NS_SEPARATOR","\\",42],["T_STRING","Magento",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Checkout",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Api",42],["T_NS_SEPARATOR","\\",42],["T_STRING","AgreementsValidatorInterface",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$agreementValidator",42],["T_WHITESPACE","\n    ",42],")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","agreementsValidator",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$agreementValidator",44],";",["T_WHITESPACE","\n        ",44],["T_STRING","parent",45],["T_DOUBLE_COLON","::",45],["T_STRING","__construct",45],"(",["T_WHITESPACE","\n            ",45],["T_VARIABLE","$context",46],",",["T_WHITESPACE","\n            ",46],["T_VARIABLE","$customerSession",47],",",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$checkoutSession",48],",",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$orderFactory",49],",",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$checkoutFactory",50],",",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$paypalSession",51],",",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$urlHelper",52],",",["T_WHITESPACE","\n            ",52],["T_VARIABLE","$customerUrl",53],["T_WHITESPACE","\n        ",53],")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Submit the order\n     *\n     * @return void\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",57],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","execute",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","isValidationRequired",65],"(",")",["T_WHITESPACE"," ",65],["T_BOOLEAN_AND","&&",65],["T_WHITESPACE","\n            ",65],"!",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","agreementsValidator",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","isValid",66],"(",["T_STRING","array_keys",66],"(",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getRequest",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","getPost",66],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",66],",",["T_WHITESPACE"," ",66],"[","]",")",")",")",["T_WHITESPACE","\n        ",66],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$e",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_NEW","new",68],["T_WHITESPACE"," ",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Magento",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Framework",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Exception",68],["T_NS_SEPARATOR","\\",68],["T_STRING","LocalizedException",68],"(",["T_WHITESPACE","\n                ",68],["T_STRING","__",69],"(",["T_CONSTANT_ENCAPSED_STRING","'Please agree to all the terms and conditions before placing the order.'",69],")",["T_WHITESPACE","\n            ",69],")",";",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","messageManager",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","addExceptionMessage",71],"(",["T_WHITESPACE","\n                ",71],["T_VARIABLE","$e",72],",",["T_WHITESPACE","\n                ",72],["T_VARIABLE","$e",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getMessage",73],"(",")",["T_WHITESPACE","\n            ",73],")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_redirect",75],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",75],")",";",["T_WHITESPACE","\n            ",75],["T_RETURN","return",76],";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE","\n\n        ",77],["T_TRY","try",79],["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_initCheckout",80],"(",")",";",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_checkout",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","place",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_initToken",81],"(",")",")",";",["T_WHITESPACE","\n\n            ",81],["T_COMMENT","\/\/ prepare session to success or cancellation page\n",83],["T_WHITESPACE","            ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_getCheckoutSession",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","clearHelperData",84],"(",")",";",["T_WHITESPACE","\n\n            ",84],["T_COMMENT","\/\/ \"last successful quote\"\n",86],["T_WHITESPACE","            ",87],["T_VARIABLE","$quoteId",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_getQuote",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")",";",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getCheckoutSession",88],"(",")",["T_OBJECT_OPERATOR","->",88],["T_STRING","setLastQuoteId",88],"(",["T_VARIABLE","$quoteId",88],")",["T_OBJECT_OPERATOR","->",88],["T_STRING","setLastSuccessQuoteId",88],"(",["T_VARIABLE","$quoteId",88],")",";",["T_WHITESPACE","\n\n            ",88],["T_COMMENT","\/\/ an order may be created\n",90],["T_WHITESPACE","            ",91],["T_VARIABLE","$order",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_checkout",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getOrder",91],"(",")",";",["T_WHITESPACE","\n            ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$order",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_getCheckoutSession",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","setLastOrderId",93],"(",["T_VARIABLE","$order",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getId",93],"(",")",")",["T_WHITESPACE","\n                    ",93],["T_OBJECT_OPERATOR","->",94],["T_STRING","setLastRealOrderId",94],"(",["T_VARIABLE","$order",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getIncrementId",94],"(",")",")",["T_WHITESPACE","\n                    ",94],["T_OBJECT_OPERATOR","->",95],["T_STRING","setLastOrderStatus",95],"(",["T_VARIABLE","$order",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getStatus",95],"(",")",")",";",["T_WHITESPACE","\n            ",95],"}",["T_WHITESPACE","\n\n            ",96],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_eventManager",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","dispatch",98],"(",["T_WHITESPACE","\n                ",98],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_place_order_success'",99],",",["T_WHITESPACE","\n                ",99],"[",["T_WHITESPACE","\n                    ",100],["T_CONSTANT_ENCAPSED_STRING","'order'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$order",101],",",["T_WHITESPACE","\n                    ",101],["T_CONSTANT_ENCAPSED_STRING","'quote'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_getQuote",102],"(",")",["T_WHITESPACE","\n                ",102],"]",["T_WHITESPACE","\n            ",103],")",";",["T_WHITESPACE","\n\n            ",104],["T_COMMENT","\/\/ redirect if PayPal specified some URL (for example, to Giropay bank)\n",106],["T_WHITESPACE","            ",107],["T_VARIABLE","$url",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_checkout",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getRedirectUrl",107],"(",")",";",["T_WHITESPACE","\n            ",107],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$url",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getResponse",109],"(",")",["T_OBJECT_OPERATOR","->",109],["T_STRING","setRedirect",109],"(",["T_VARIABLE","$url",109],")",";",["T_WHITESPACE","\n                ",109],["T_RETURN","return",110],";",["T_WHITESPACE","\n            ",110],"}",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_initToken",112],"(",["T_STRING","false",112],")",";",["T_WHITESPACE"," ",112],["T_COMMENT","\/\/ no need in token anymore\n",112],["T_WHITESPACE","            ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_redirect",113],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/onepage\/success'",113],")",";",["T_WHITESPACE","\n            ",113],["T_RETURN","return",114],";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE"," ",115],["T_CATCH","catch",115],["T_WHITESPACE"," ",115],"(",["T_STRING","ApiProcessableException",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$e",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_processPaypalApiError",116],"(",["T_VARIABLE","$e",116],")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE"," ",117],["T_CATCH","catch",117],["T_WHITESPACE"," ",117],"(",["T_NS_SEPARATOR","\\",117],["T_STRING","Exception",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$e",117],")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","messageManager",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","addExceptionMessage",118],"(",["T_WHITESPACE","\n                ",118],["T_VARIABLE","$e",119],",",["T_WHITESPACE","\n                ",119],["T_STRING","__",120],"(",["T_CONSTANT_ENCAPSED_STRING","'We can\\'t place the order.'",120],")",["T_WHITESPACE","\n            ",120],")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_redirect",122],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",122],")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Process PayPal API's processable errors\n     *\n     * @param \\Magento\\Paypal\\Model\\Api\\ProcessableException $exception\n     * @return void\n     *\/",126],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","_processPaypalApiError",132],"(",["T_VARIABLE","$exception",132],")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_SWITCH","switch",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$exception",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getCode",134],"(",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n            ",134],["T_CASE","case",135],["T_WHITESPACE"," ",135],["T_STRING","ApiProcessableException",135],["T_DOUBLE_COLON","::",135],["T_STRING","API_MAX_PAYMENT_ATTEMPTS_EXCEEDED",135],":",["T_WHITESPACE","\n            ",135],["T_CASE","case",136],["T_WHITESPACE"," ",136],["T_STRING","ApiProcessableException",136],["T_DOUBLE_COLON","::",136],["T_STRING","API_TRANSACTION_EXPIRED",136],":",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getResponse",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","setRedirect",137],"(",["T_WHITESPACE","\n                    ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getQuote",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","getPayment",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","getCheckoutRedirectUrl",138],"(",")",["T_WHITESPACE","\n                ",138],")",";",["T_WHITESPACE","\n                ",139],["T_BREAK","break",140],";",["T_WHITESPACE","\n            ",140],["T_CASE","case",141],["T_WHITESPACE"," ",141],["T_STRING","ApiProcessableException",141],["T_DOUBLE_COLON","::",141],["T_STRING","API_DO_EXPRESS_CHECKOUT_FAIL",141],":",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_redirectSameToken",142],"(",")",";",["T_WHITESPACE","\n                ",142],["T_BREAK","break",143],";",["T_WHITESPACE","\n            ",143],["T_CASE","case",144],["T_WHITESPACE"," ",144],["T_STRING","ApiProcessableException",144],["T_DOUBLE_COLON","::",144],["T_STRING","API_ADDRESS_MATCH_FAIL",144],":",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","redirectToOrderReviewPageAndShowError",145],"(",["T_VARIABLE","$exception",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getUserMessage",145],"(",")",")",";",["T_WHITESPACE","\n                ",145],["T_BREAK","break",146],";",["T_WHITESPACE","\n            ",146],["T_CASE","case",147],["T_WHITESPACE"," ",147],["T_STRING","ApiProcessableException",147],["T_DOUBLE_COLON","::",147],["T_STRING","API_UNABLE_TRANSACTION_COMPLETE",147],":",["T_WHITESPACE","\n                ",147],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_config",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getPaymentAction",148],"(",")",["T_WHITESPACE"," ",148],["T_IS_EQUAL","==",148],["T_WHITESPACE"," ",148],["T_NS_SEPARATOR","\\",148],["T_STRING","Magento",148],["T_NS_SEPARATOR","\\",148],["T_STRING","Payment",148],["T_NS_SEPARATOR","\\",148],["T_STRING","Model",148],["T_NS_SEPARATOR","\\",148],["T_STRING","Method",148],["T_NS_SEPARATOR","\\",148],["T_STRING","AbstractMethod",148],["T_DOUBLE_COLON","::",148],["T_STRING","ACTION_ORDER",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n                    ",148],["T_VARIABLE","$paypalTransactionData",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_getCheckoutSession",149],"(",")",["T_OBJECT_OPERATOR","->",149],["T_STRING","getPaypalTransactionData",149],"(",")",";",["T_WHITESPACE","\n                    ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getResponse",150],"(",")",["T_OBJECT_OPERATOR","->",150],["T_STRING","setRedirect",150],"(",["T_WHITESPACE","\n                        ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_config",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getExpressCheckoutOrderUrl",151],"(",["T_VARIABLE","$paypalTransactionData",151],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",151],"]",")",["T_WHITESPACE","\n                    ",151],")",";",["T_WHITESPACE","\n                ",152],"}",["T_WHITESPACE"," ",153],["T_ELSE","else",153],["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                    ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_redirectSameToken",154],"(",")",";",["T_WHITESPACE","\n                ",154],"}",["T_WHITESPACE","\n                ",155],["T_BREAK","break",156],";",["T_WHITESPACE","\n            ",156],["T_DEFAULT","default",157],":",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_redirectToCartAndShowError",158],"(",["T_VARIABLE","$exception",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getUserMessage",158],"(",")",")",";",["T_WHITESPACE","\n                ",158],["T_BREAK","break",159],";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Redirect customer back to PayPal with the same token\n     *\n     * @return void\n     *\/",163],["T_WHITESPACE","\n    ",167],["T_PROTECTED","protected",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","_redirectSameToken",168],"(",")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$token",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_initToken",170],"(",")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getResponse",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","setRedirect",171],"(",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_config",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getExpressCheckoutStartUrl",172],"(",["T_VARIABLE","$token",172],")",["T_WHITESPACE","\n        ",172],")",";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Redirect customer to shopping cart and show error message\n     *\n     * @param string $errorMessage\n     * @return void\n     *\/",176],["T_WHITESPACE","\n    ",181],["T_PROTECTED","protected",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","_redirectToCartAndShowError",182],"(",["T_VARIABLE","$errorMessage",182],")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","messageManager",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","addErrorMessage",184],"(",["T_VARIABLE","$errorMessage",184],")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_redirect",185],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",185],")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Redirect customer to the paypal order review page and show error message\n     *\n     * @param string $errorMessage\n     * @return void\n     *\/",188],["T_WHITESPACE","\n    ",193],["T_PRIVATE","private",194],["T_WHITESPACE"," ",194],["T_FUNCTION","function",194],["T_WHITESPACE"," ",194],["T_STRING","redirectToOrderReviewPageAndShowError",194],"(",["T_VARIABLE","$errorMessage",194],")",["T_WHITESPACE","\n    ",194],"{",["T_WHITESPACE","\n        ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","messageManager",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","addErrorMessage",196],"(",["T_VARIABLE","$errorMessage",196],")",";",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_redirect",197],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",197],")",";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * Return true if agreements validation required\n     *\n     * @return bool\n     *\/",200],["T_WHITESPACE","\n    ",204],["T_PROTECTED","protected",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","isValidationRequired",205],"(",")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_STRING","is_array",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getRequest",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getBeforeForwardInfo",207],"(",")",")",["T_WHITESPACE","\n        ",207],["T_BOOLEAN_AND","&&",208],["T_WHITESPACE"," ",208],["T_EMPTY","empty",208],"(",["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getRequest",208],"(",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","getBeforeForwardInfo",208],"(",")",")",";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n",209],"}",["T_WHITESPACE","\n",210]]