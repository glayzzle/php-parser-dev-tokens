[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Widget",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Layout",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Layout update resource model\n *\/",11],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Update",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Db",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractDb",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Cache\\FrontendInterface\n     *\/",16],["T_WHITESPACE","\n    ",18],["T_PRIVATE","private",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$_cache",19],";",["T_WHITESPACE","\n\n    ",19],["T_DOC_COMMENT","\/**\n     * @var array\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_PRIVATE","private",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$layoutUpdateCache",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Magento\\Framework\\Cache\\FrontendInterface $cache\n     * @param string $connectionName\n     *\/",26],["T_WHITESPACE","\n    ",30],["T_PUBLIC","public",31],["T_WHITESPACE"," ",31],["T_FUNCTION","function",31],["T_WHITESPACE"," ",31],["T_STRING","__construct",31],"(",["T_WHITESPACE","\n        ",31],["T_NS_SEPARATOR","\\",32],["T_STRING","Magento",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Framework",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Model",32],["T_NS_SEPARATOR","\\",32],["T_STRING","ResourceModel",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Db",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Context",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$context",32],",",["T_WHITESPACE","\n        ",32],["T_NS_SEPARATOR","\\",33],["T_STRING","Magento",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Framework",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Cache",33],["T_NS_SEPARATOR","\\",33],["T_STRING","FrontendInterface",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$cache",33],",",["T_WHITESPACE","\n        ",33],["T_VARIABLE","$connectionName",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","null",34],["T_WHITESPACE","\n    ",34],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n        ",35],["T_STRING","parent",36],["T_DOUBLE_COLON","::",36],["T_STRING","__construct",36],"(",["T_VARIABLE","$context",36],",",["T_WHITESPACE"," ",36],["T_VARIABLE","$connectionName",36],")",";",["T_WHITESPACE","\n        ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","_cache",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$cache",37],";",["T_WHITESPACE","\n    ",37],"}",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     * @return void\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","_construct",45],"(",")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_init",47],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update'",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Retrieve layout updates by handle\n     *\n     * @param string $handle\n     * @param \\Magento\\Framework\\View\\Design\\ThemeInterface $theme\n     * @param \\Magento\\Framework\\App\\ScopeInterface $store\n     * @return string\n     *\/",50],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","fetchUpdatesByHandle",58],"(",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$handle",59],",",["T_WHITESPACE","\n        ",59],["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Framework",60],["T_NS_SEPARATOR","\\",60],["T_STRING","View",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Design",60],["T_NS_SEPARATOR","\\",60],["T_STRING","ThemeInterface",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$theme",60],",",["T_WHITESPACE","\n        ",60],["T_NS_SEPARATOR","\\",61],["T_STRING","Magento",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Framework",61],["T_NS_SEPARATOR","\\",61],["T_STRING","App",61],["T_NS_SEPARATOR","\\",61],["T_STRING","ScopeInterface",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$store",61],["T_WHITESPACE","\n    ",61],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$bind",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],"[",["T_CONSTANT_ENCAPSED_STRING","'theme_id'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$theme",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getId",63],"(",")",",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'store_id'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$store",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getId",63],"(",")","]",";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$cacheKey",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","implode",64],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$bind",64],")",";",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_ISSET","isset",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","layoutUpdateCache",65],"[",["T_VARIABLE","$cacheKey",65],"]",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","layoutUpdateCache",66],"[",["T_VARIABLE","$cacheKey",66],"]",["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],"[","]",";",["T_WHITESPACE","\n            ",66],["T_FOREACH","foreach",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getConnection",67],"(",")",["T_OBJECT_OPERATOR","->",67],["T_STRING","fetchAll",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_getFetchUpdatesByHandleSelect",67],"(",")",",",["T_WHITESPACE"," ",67],["T_VARIABLE","$bind",67],")",["T_WHITESPACE"," ",67],["T_AS","as",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$layout",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(","!",["T_ISSET","isset",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","layoutUpdateCache",68],"[",["T_VARIABLE","$cacheKey",68],"]","[",["T_VARIABLE","$layout",68],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",68],"]","]",")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n                    ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","layoutUpdateCache",69],"[",["T_VARIABLE","$cacheKey",69],"]","[",["T_VARIABLE","$layout",69],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",69],"]","]",["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","''",69],";",["T_WHITESPACE","\n                ",69],"}",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","layoutUpdateCache",71],"[",["T_VARIABLE","$cacheKey",71],"]","[",["T_VARIABLE","$layout",71],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",71],"]","]",["T_WHITESPACE"," ",71],["T_CONCAT_EQUAL",".=",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$layout",71],"[",["T_CONSTANT_ENCAPSED_STRING","'xml'",71],"]",";",["T_WHITESPACE","\n            ",71],"}",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n        ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_ISSET","isset",74],"(",["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","layoutUpdateCache",74],"[",["T_VARIABLE","$cacheKey",74],"]","[",["T_VARIABLE","$handle",74],"]",")",["T_WHITESPACE"," ",74],"?",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","layoutUpdateCache",74],"[",["T_VARIABLE","$cacheKey",74],"]","[",["T_VARIABLE","$handle",74],"]",["T_WHITESPACE"," ",74],":",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","''",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Get select to fetch updates by handle\n     *\n     * @param bool $loadAllUpdates\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","_getFetchUpdatesByHandleSelect",83],"(",["T_VARIABLE","$loadAllUpdates",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","false",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_COMMENT","\/\/@todo Why it also loads layout updates for store_id=0, isn't it Admin Store View?\n",85],["T_WHITESPACE","        ",86],["T_COMMENT","\/\/If 0 means 'all stores' why it then refers by foreign key to Admin in `store` and not to something named\n",86],["T_WHITESPACE","        ",87],["T_COMMENT","\/\/ 'All Stores'?\n",87],["T_WHITESPACE","\n        ",88],["T_VARIABLE","$select",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getConnection",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","select",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","from",89],"(",["T_WHITESPACE","\n            ",89],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_update'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getMainTable",90],"(",")","]",",",["T_WHITESPACE","\n            ",90],"[",["T_CONSTANT_ENCAPSED_STRING","'xml'",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'handle'",91],"]",["T_WHITESPACE","\n        ",91],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","join",92],"(",["T_WHITESPACE","\n            ",92],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getTable",93],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_link'",93],")","]",",",["T_WHITESPACE","\n            ",93],["T_CONSTANT_ENCAPSED_STRING","'link.layout_update_id=layout_update.layout_update_id'",94],",",["T_WHITESPACE","\n            ",94],["T_CONSTANT_ENCAPSED_STRING","''",95],["T_WHITESPACE","\n        ",95],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","where",96],"(",["T_WHITESPACE","\n            ",96],["T_CONSTANT_ENCAPSED_STRING","'link.store_id IN (0, :store_id)'",97],["T_WHITESPACE","\n        ",97],")",["T_OBJECT_OPERATOR","->",98],["T_STRING","where",98],"(",["T_WHITESPACE","\n            ",98],["T_CONSTANT_ENCAPSED_STRING","'link.theme_id = :theme_id'",99],["T_WHITESPACE","\n        ",99],")",["T_OBJECT_OPERATOR","->",100],["T_STRING","order",100],"(",["T_WHITESPACE","\n            ",100],["T_CONSTANT_ENCAPSED_STRING","'layout_update.sort_order '",101],["T_WHITESPACE"," ",101],".",["T_WHITESPACE"," ",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Magento",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Framework",101],["T_NS_SEPARATOR","\\",101],["T_STRING","DB",101],["T_NS_SEPARATOR","\\",101],["T_STRING","Select",101],["T_DOUBLE_COLON","::",101],["T_STRING","SQL_ASC",101],["T_WHITESPACE","\n        ",101],")",";",["T_WHITESPACE","\n\n        ",102],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_VARIABLE","$loadAllUpdates",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$select",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","where",105],"(",["T_CONSTANT_ENCAPSED_STRING","'link.is_temporary = 0'",105],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$select",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Update a \"layout update link\" if relevant data is provided\n     *\n     * @param \\Magento\\Widget\\Model\\Layout\\Update|\\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",111],["T_WHITESPACE","\n    ",116],["T_PROTECTED","protected",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","_afterSave",117],"(",["T_NS_SEPARATOR","\\",117],["T_STRING","Magento",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Framework",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Model",117],["T_NS_SEPARATOR","\\",117],["T_STRING","AbstractModel",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$object",117],")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$data",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$object",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getData",119],"(",")",";",["T_WHITESPACE","\n        ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_ISSET","isset",120],"(",["T_VARIABLE","$data",120],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",120],"]",")",["T_WHITESPACE"," ",120],["T_BOOLEAN_AND","&&",120],["T_WHITESPACE"," ",120],["T_ISSET","isset",120],"(",["T_VARIABLE","$data",120],"[",["T_CONSTANT_ENCAPSED_STRING","'theme_id'",120],"]",")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getConnection",121],"(",")",["T_OBJECT_OPERATOR","->",121],["T_STRING","insertOnDuplicate",121],"(",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getTable",122],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_link'",122],")",",",["T_WHITESPACE","\n                ",122],"[",["T_WHITESPACE","\n                    ",123],["T_CONSTANT_ENCAPSED_STRING","'store_id'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$data",124],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",124],"]",",",["T_WHITESPACE","\n                    ",124],["T_CONSTANT_ENCAPSED_STRING","'theme_id'",125],["T_WHITESPACE"," ",125],["T_DOUBLE_ARROW","=>",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$data",125],"[",["T_CONSTANT_ENCAPSED_STRING","'theme_id'",125],"]",",",["T_WHITESPACE","\n                    ",125],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$object",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getId",126],"(",")",",",["T_WHITESPACE","\n                    ",126],["T_CONSTANT_ENCAPSED_STRING","'is_temporary'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_INT_CAST","(int)",127],["T_VARIABLE","$object",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getIsTemporary",127],"(",")",["T_WHITESPACE","\n                ",127],"]",["T_WHITESPACE","\n            ",128],")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_cache",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","clean",131],"(",")",";",["T_WHITESPACE","\n        ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_STRING","parent",132],["T_DOUBLE_COLON","::",132],["T_STRING","_afterSave",132],"(",["T_VARIABLE","$object",132],")",";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n",133],"}",["T_WHITESPACE","\n",134]]