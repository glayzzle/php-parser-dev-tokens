[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Widget Instance Resource Model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Widget",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Widget",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractModel",14],";",["T_WHITESPACE","\n\n",14],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","Instance",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Framework",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","ResourceModel",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Db",16],["T_NS_SEPARATOR","\\",16],["T_STRING","AbstractDb",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     * @return void\n     *\/",18],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_FUNCTION","function",23],["T_WHITESPACE"," ",23],["T_STRING","_construct",23],"(",")",["T_WHITESPACE","\n    ",23],"{",["T_WHITESPACE","\n        ",24],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","_init",25],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance'",25],",",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'instance_id'",25],")",";",["T_WHITESPACE","\n    ",25],"}",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Perform actions after object load\n     *\n     * @param \\Magento\\Widget\\Model\\Widget\\Instance $object\n     * @return $this\n     *\/",28],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","_afterLoad",34],"(",["T_STRING","AbstractModel",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$object",34],")",["T_WHITESPACE","\n    ",34],"{",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$connection",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getConnection",36],"(",")",";",["T_WHITESPACE","\n        ",36],["T_VARIABLE","$select",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$connection",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","select",37],"(",")",["T_OBJECT_OPERATOR","->",37],["T_STRING","from",37],"(",["T_WHITESPACE","\n            ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getTable",38],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page'",38],")",["T_WHITESPACE","\n        ",38],")",["T_OBJECT_OPERATOR","->",39],["T_STRING","where",39],"(",["T_WHITESPACE","\n            ",39],["T_CONSTANT_ENCAPSED_STRING","'instance_id = ?'",40],",",["T_WHITESPACE","\n            ",40],["T_INT_CAST","(int)",41],["T_VARIABLE","$object",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getId",41],"(",")",["T_WHITESPACE","\n        ",41],")",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$result",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$connection",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","fetchAll",43],"(",["T_VARIABLE","$select",43],")",";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$object",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","setData",44],"(",["T_CONSTANT_ENCAPSED_STRING","'page_groups'",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$result",44],")",";",["T_WHITESPACE","\n        ",44],["T_RETURN","return",45],["T_WHITESPACE"," ",45],["T_STRING","parent",45],["T_DOUBLE_COLON","::",45],["T_STRING","_afterLoad",45],"(",["T_VARIABLE","$object",45],")",";",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Perform actions after object save\n     *\n     * @param \\Magento\\Widget\\Model\\Widget\\Instance $object\n     * @return $this\n     *\/",48],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","_afterSave",54],"(",["T_STRING","AbstractModel",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$object",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$pageTable",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getTable",56],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page'",56],")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$pageLayoutTable",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getTable",57],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page_layout'",57],")",";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$connection",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getConnection",58],"(",")",";",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$select",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$connection",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","select",60],"(",")",["T_OBJECT_OPERATOR","->",60],["T_STRING","from",60],"(",["T_VARIABLE","$pageTable",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'page_id'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","where",60],"(",["T_CONSTANT_ENCAPSED_STRING","'instance_id = ?'",60],",",["T_WHITESPACE"," ",60],["T_INT_CAST","(int)",60],["T_VARIABLE","$object",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getId",60],"(",")",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$pageIds",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$connection",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","fetchCol",61],"(",["T_VARIABLE","$select",61],")",";",["T_WHITESPACE","\n\n        ",61],["T_VARIABLE","$removePageIds",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","array_diff",63],"(",["T_VARIABLE","$pageIds",63],",",["T_WHITESPACE"," ",63],["T_VARIABLE","$object",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getData",63],"(",["T_CONSTANT_ENCAPSED_STRING","'page_group_ids'",63],")",")",";",["T_WHITESPACE","\n\n        ",63],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_STRING","is_array",65],"(",["T_VARIABLE","$pageIds",65],")",["T_WHITESPACE"," ",65],["T_BOOLEAN_AND","&&",65],["T_WHITESPACE"," ",65],["T_STRING","count",65],"(",["T_VARIABLE","$pageIds",65],")",["T_WHITESPACE"," ",65],">",["T_WHITESPACE"," ",65],["T_LNUMBER","0",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$inCond",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$connection",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","prepareSqlCondition",66],"(",["T_CONSTANT_ENCAPSED_STRING","'page_id'",66],",",["T_WHITESPACE"," ",66],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$pageIds",66],"]",")",";",["T_WHITESPACE","\n\n            ",66],["T_VARIABLE","$select",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$connection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","select",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","from",68],"(",["T_VARIABLE","$pageLayoutTable",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",68],")",["T_OBJECT_OPERATOR","->",68],["T_STRING","where",68],"(",["T_VARIABLE","$inCond",68],")",";",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$removeLayoutUpdateIds",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$connection",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","fetchCol",69],"(",["T_VARIABLE","$select",69],")",";",["T_WHITESPACE","\n\n            ",69],["T_VARIABLE","$connection",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","delete",71],"(",["T_VARIABLE","$pageLayoutTable",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$inCond",71],")",";",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_deleteLayoutUpdates",72],"(",["T_VARIABLE","$removeLayoutUpdateIds",72],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n\n        ",73],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_deleteWidgetInstancePages",75],"(",["T_VARIABLE","$removePageIds",75],")",";",["T_WHITESPACE","\n\n        ",75],["T_FOREACH","foreach",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$object",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getData",77],"(",["T_CONSTANT_ENCAPSED_STRING","'page_groups'",77],")",["T_WHITESPACE"," ",77],["T_AS","as",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$pageGroup",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$pageLayoutUpdateIds",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_saveLayoutUpdates",78],"(",["T_VARIABLE","$object",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$pageGroup",78],")",";",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$data",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],"[",["T_WHITESPACE","\n                ",79],["T_CONSTANT_ENCAPSED_STRING","'page_group'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$pageGroup",80],"[",["T_CONSTANT_ENCAPSED_STRING","'group'",80],"]",",",["T_WHITESPACE","\n                ",80],["T_CONSTANT_ENCAPSED_STRING","'layout_handle'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$pageGroup",81],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_handle'",81],"]",",",["T_WHITESPACE","\n                ",81],["T_CONSTANT_ENCAPSED_STRING","'block_reference'",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$pageGroup",82],"[",["T_CONSTANT_ENCAPSED_STRING","'block_reference'",82],"]",",",["T_WHITESPACE","\n                ",82],["T_CONSTANT_ENCAPSED_STRING","'page_for'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$pageGroup",83],"[",["T_CONSTANT_ENCAPSED_STRING","'for'",83],"]",",",["T_WHITESPACE","\n                ",83],["T_CONSTANT_ENCAPSED_STRING","'entities'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$pageGroup",84],"[",["T_CONSTANT_ENCAPSED_STRING","'entities'",84],"]",",",["T_WHITESPACE","\n                ",84],["T_CONSTANT_ENCAPSED_STRING","'page_template'",85],["T_WHITESPACE"," ",85],["T_DOUBLE_ARROW","=>",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$pageGroup",85],"[",["T_CONSTANT_ENCAPSED_STRING","'template'",85],"]",",",["T_WHITESPACE","\n            ",85],"]",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$pageId",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$pageGroup",87],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id'",87],"]",";",["T_WHITESPACE","\n            ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_STRING","in_array",88],"(",["T_VARIABLE","$pageGroup",88],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id'",88],"]",",",["T_WHITESPACE"," ",88],["T_VARIABLE","$pageIds",88],")",")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$connection",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","update",89],"(",["T_VARIABLE","$pageTable",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$data",89],",",["T_WHITESPACE"," ",89],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id = ?'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_INT_CAST","(int)",89],["T_VARIABLE","$pageId",89],"]",")",";",["T_WHITESPACE","\n            ",89],"}",["T_WHITESPACE"," ",90],["T_ELSE","else",90],["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$connection",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","insert",91],"(",["T_VARIABLE","$pageTable",91],",",["T_WHITESPACE"," ",91],["T_STRING","array_merge",91],"(","[",["T_CONSTANT_ENCAPSED_STRING","'instance_id'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$object",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getId",91],"(",")","]",",",["T_WHITESPACE"," ",91],["T_VARIABLE","$data",91],")",")",";",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$pageId",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$connection",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","lastInsertId",92],"(",["T_VARIABLE","$pageTable",92],")",";",["T_WHITESPACE","\n            ",92],"}",["T_WHITESPACE","\n            ",93],["T_FOREACH","foreach",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$pageLayoutUpdateIds",94],["T_WHITESPACE"," ",94],["T_AS","as",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$layoutUpdateId",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                ",94],["T_VARIABLE","$connection",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","insert",95],"(",["T_WHITESPACE","\n                    ",95],["T_VARIABLE","$pageLayoutTable",96],",",["T_WHITESPACE","\n                    ",96],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$pageId",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$layoutUpdateId",97],"]",["T_WHITESPACE","\n                ",97],")",";",["T_WHITESPACE","\n            ",98],"}",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n\n        ",100],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_STRING","parent",102],["T_DOUBLE_COLON","::",102],["T_STRING","_afterSave",102],"(",["T_VARIABLE","$object",102],")",";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Prepare and save layout updates data\n     *\n     * @param \\Magento\\Widget\\Model\\Widget\\Instance $widgetInstance\n     * @param array $pageGroupData\n     * @return string[] of inserted layout updates ids\n     *\/",105],["T_WHITESPACE","\n    ",111],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","_saveLayoutUpdates",112],"(",["T_VARIABLE","$widgetInstance",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$pageGroupData",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$connection",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getConnection",114],"(",")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$pageLayoutUpdateIds",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],"[","]",";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$storeIds",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_prepareStoreIds",116],"(",["T_VARIABLE","$widgetInstance",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getStoreIds",116],"(",")",")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$layoutUpdateTable",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getTable",117],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update'",117],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$layoutUpdateLinkTable",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getTable",118],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_link'",118],")",";",["T_WHITESPACE","\n\n        ",118],["T_FOREACH","foreach",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$pageGroupData",120],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_handle_updates'",120],"]",["T_WHITESPACE"," ",120],["T_AS","as",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$handle",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$xml",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$widgetInstance",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","generateLayoutUpdateXml",121],"(",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$pageGroupData",122],"[",["T_CONSTANT_ENCAPSED_STRING","'block_reference'",122],"]",",",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$pageGroupData",123],"[",["T_CONSTANT_ENCAPSED_STRING","'template'",123],"]",["T_WHITESPACE","\n            ",123],")",";",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$insert",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",125],["T_WHITESPACE"," ",125],["T_DOUBLE_ARROW","=>",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$handle",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'xml'",125],["T_WHITESPACE"," ",125],["T_DOUBLE_ARROW","=>",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$xml",125],"]",";",["T_WHITESPACE","\n            ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_STRING","strlen",126],"(",["T_VARIABLE","$widgetInstance",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getSortOrder",126],"(",")",")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                ",126],["T_VARIABLE","$insert",127],"[",["T_CONSTANT_ENCAPSED_STRING","'sort_order'",127],"]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$widgetInstance",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getSortOrder",127],"(",")",";",["T_WHITESPACE","\n            ",127],"}",["T_WHITESPACE","\n\n            ",128],["T_VARIABLE","$connection",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","insert",130],"(",["T_VARIABLE","$layoutUpdateTable",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$insert",130],")",";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$layoutUpdateId",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$connection",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","lastInsertId",131],"(",["T_VARIABLE","$layoutUpdateTable",131],")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$pageLayoutUpdateIds",132],"[","]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$layoutUpdateId",132],";",["T_WHITESPACE","\n\n            ",132],["T_VARIABLE","$data",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],"[","]",";",["T_WHITESPACE","\n            ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$storeIds",135],["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$storeId",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$data",136],"[","]",["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],"[",["T_WHITESPACE","\n                    ",136],["T_CONSTANT_ENCAPSED_STRING","'store_id'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$storeId",137],",",["T_WHITESPACE","\n                    ",137],["T_CONSTANT_ENCAPSED_STRING","'theme_id'",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$widgetInstance",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getThemeId",138],"(",")",",",["T_WHITESPACE","\n                    ",138],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$layoutUpdateId",139],",",["T_WHITESPACE","\n                ",139],"]",";",["T_WHITESPACE","\n            ",140],"}",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$connection",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","insertMultiple",142],"(",["T_VARIABLE","$layoutUpdateLinkTable",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$data",142],")",";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$pageLayoutUpdateIds",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Prepare store ids.\n     * If one of store id is default (0) return all store ids\n     *\n     * @param array $storeIds\n     * @return array\n     *\/",147],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","_prepareStoreIds",154],"(",["T_VARIABLE","$storeIds",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_STRING","in_array",156],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$storeIds",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$storeIds",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],"[",["T_LNUMBER","0",157],"]",";",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE","\n        ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$storeIds",159],";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n\n    ",160],["T_DOC_COMMENT","\/**\n     * Perform actions before object delete.\n     * Collect page ids and layout update ids and set to object for further delete\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",162],["T_WHITESPACE","\n    ",168],["T_PROTECTED","protected",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","_beforeDelete",169],"(",["T_STRING","AbstractModel",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$object",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$connection",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getConnection",171],"(",")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$select",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$connection",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","select",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","from",172],"(",["T_WHITESPACE","\n            ",172],"[",["T_CONSTANT_ENCAPSED_STRING","'main_table'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getTable",173],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page'",173],")","]",",",["T_WHITESPACE","\n            ",173],"[","]",["T_WHITESPACE","\n        ",174],")",["T_OBJECT_OPERATOR","->",175],["T_STRING","joinInner",175],"(",["T_WHITESPACE","\n            ",175],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_page_table'",176],["T_WHITESPACE"," ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getTable",176],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page_layout'",176],")","]",",",["T_WHITESPACE","\n            ",176],["T_CONSTANT_ENCAPSED_STRING","'layout_page_table.page_id = main_table.page_id'",177],",",["T_WHITESPACE","\n            ",177],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",178],"]",["T_WHITESPACE","\n        ",178],")",["T_OBJECT_OPERATOR","->",179],["T_STRING","where",179],"(",["T_WHITESPACE","\n            ",179],["T_CONSTANT_ENCAPSED_STRING","'main_table.instance_id=?'",180],",",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$object",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getId",181],"(",")",["T_WHITESPACE","\n        ",181],")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$result",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$connection",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","fetchCol",183],"(",["T_VARIABLE","$select",183],")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","setLayoutUpdateIdsToDelete",184],"(",["T_VARIABLE","$result",184],")",";",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Perform actions after object delete.\n     * Delete layout updates by layout update ids collected in _beforeSave\n     *\n     * @param \\Magento\\Widget\\Model\\Widget\\Instance $object\n     * @return $this\n     *\/",188],["T_WHITESPACE","\n    ",194],["T_PROTECTED","protected",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","_afterDelete",195],"(",["T_STRING","AbstractModel",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$object",195],")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_deleteLayoutUpdates",197],"(",["T_VARIABLE","$object",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getLayoutUpdateIdsToDelete",197],"(",")",")",";",["T_WHITESPACE","\n        ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_STRING","parent",198],["T_DOUBLE_COLON","::",198],["T_STRING","_afterDelete",198],"(",["T_VARIABLE","$object",198],")",";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Delete widget instance pages by given ids\n     *\n     * @param array $pageIds\n     * @return $this\n     *\/",201],["T_WHITESPACE","\n    ",206],["T_PROTECTED","protected",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","_deleteWidgetInstancePages",207],"(",["T_VARIABLE","$pageIds",207],")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$connection",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getConnection",209],"(",")",";",["T_WHITESPACE","\n        ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$pageIds",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$inCond",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$connection",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","prepareSqlCondition",211],"(",["T_CONSTANT_ENCAPSED_STRING","'page_id'",211],",",["T_WHITESPACE"," ",211],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",211],["T_WHITESPACE"," ",211],["T_DOUBLE_ARROW","=>",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$pageIds",211],"]",")",";",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$connection",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","delete",212],"(",["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getTable",212],"(",["T_CONSTANT_ENCAPSED_STRING","'widget_instance_page'",212],")",",",["T_WHITESPACE"," ",212],["T_VARIABLE","$inCond",212],")",";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE","\n        ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * Delete layout updates by given ids\n     *\n     * @param array $layoutUpdateIds\n     * @return $this\n     *\/",217],["T_WHITESPACE","\n    ",222],["T_PROTECTED","protected",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","_deleteLayoutUpdates",223],"(",["T_VARIABLE","$layoutUpdateIds",223],")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$connection",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getConnection",225],"(",")",";",["T_WHITESPACE","\n        ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_VARIABLE","$layoutUpdateIds",226],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$inCond",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$connection",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","prepareSqlCondition",227],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",227],",",["T_WHITESPACE"," ",227],"[",["T_CONSTANT_ENCAPSED_STRING","'in'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$layoutUpdateIds",227],"]",")",";",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$connection",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","delete",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getTable",228],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update'",228],")",",",["T_WHITESPACE"," ",228],["T_VARIABLE","$inCond",228],")",";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],";",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_DOC_COMMENT","\/**\n     * Get store ids to which specified item is assigned\n     *\n     * @param int $id\n     * @return string[]\n     *\/",233],["T_WHITESPACE","\n    ",238],["T_PUBLIC","public",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","lookupStoreIds",239],"(",["T_VARIABLE","$id",239],")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$connection",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getConnection",241],"(",")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$select",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$connection",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","select",242],"(",")",["T_OBJECT_OPERATOR","->",242],["T_STRING","from",242],"(",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getMainTable",243],"(",")",",",["T_WHITESPACE","\n            ",243],["T_CONSTANT_ENCAPSED_STRING","'store_ids'",244],["T_WHITESPACE","\n        ",244],")",["T_OBJECT_OPERATOR","->",245],["T_STRING","where",245],"(",["T_WHITESPACE","\n            ",245],"\"",["T_CURLY_OPEN","{",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getIdFieldName",246],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," = ?",246],"\"",",",["T_WHITESPACE","\n            ",246],["T_INT_CAST","(int)",247],["T_VARIABLE","$id",247],["T_WHITESPACE","\n        ",247],")",";",["T_WHITESPACE","\n        ",248],["T_VARIABLE","$storeIds",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_VARIABLE","$connection",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","fetchOne",249],"(",["T_VARIABLE","$select",249],")",";",["T_WHITESPACE","\n        ",249],["T_RETURN","return",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$storeIds",250],["T_WHITESPACE"," ",250],"?",["T_WHITESPACE"," ",250],["T_STRING","explode",250],"(",["T_CONSTANT_ENCAPSED_STRING","','",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$storeIds",250],")",["T_WHITESPACE"," ",250],":",["T_WHITESPACE"," ",250],"[","]",";",["T_WHITESPACE","\n    ",250],"}",["T_WHITESPACE","\n",251],"}",["T_WHITESPACE","\n",252]]