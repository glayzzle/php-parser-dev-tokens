[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Analytics",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Config",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Backend",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Enabled",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Analytics",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","FlagManager",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Analytics",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","AnalyticsToken",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Analytics",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","NotificationTime",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","App",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Config",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Storage",11],["T_NS_SEPARATOR","\\",11],["T_STRING","WriterInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","App",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Config",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Value",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * Add additional handling on config value change.\n *\/",14],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","SubscriptionHandler",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_DOC_COMMENT","\/**\n     * Flag code for reserve counter of attempts to subscribe.\n     *\/",19],["T_WHITESPACE","\n    ",21],["T_CONST","const",22],["T_WHITESPACE"," ",22],["T_STRING","ATTEMPTS_REVERSE_COUNTER_FLAG_CODE",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'analytics_link_attempts_reverse_counter'",22],";",["T_WHITESPACE","\n\n    ",22],["T_DOC_COMMENT","\/**\n     * Config path for schedule setting of subscription handler.\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_CONST","const",27],["T_WHITESPACE"," ",27],["T_STRING","CRON_STRING_PATH",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'crontab\/default\/jobs\/analytics_subscribe\/schedule\/cron_expr'",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * Max value for reserve counter of attempts to subscribe.\n     *\n     * @var int\n     *\/",29],["T_WHITESPACE","\n    ",33],["T_PRIVATE","private",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$attemptsInitValue",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_LNUMBER","24",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Service which allows to write values into config.\n     *\n     * @var WriterInterface\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PRIVATE","private",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$configWriter",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Flag Manager.\n     *\n     * @var FlagManager\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PRIVATE","private",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$flagManager",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Model for handling Magento BI token value.\n     *\n     * @var AnalyticsToken\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PRIVATE","private",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$analyticsToken",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Resource for managing last notification time about subscription to Magento Analytics.\n     *\n     * @var NotificationTime\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PRIVATE","private",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$notificationTime",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * @param WriterInterface $configWriter\n     * @param FlagManager $flagManager\n     * @param AnalyticsToken $analyticsToken\n     * @param NotificationTime $notificationTime\n     *\/",64],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","__construct",70],"(",["T_WHITESPACE","\n        ",70],["T_STRING","WriterInterface",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$configWriter",71],",",["T_WHITESPACE","\n        ",71],["T_STRING","FlagManager",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$flagManager",72],",",["T_WHITESPACE","\n        ",72],["T_STRING","AnalyticsToken",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$analyticsToken",73],",",["T_WHITESPACE","\n        ",73],["T_STRING","NotificationTime",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$notificationTime",74],["T_WHITESPACE","\n    ",74],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","configWriter",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$configWriter",76],";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","flagManager",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$flagManager",77],";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","analyticsToken",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$analyticsToken",78],";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","notificationTime",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$notificationTime",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Performs change subscription environment on config value change.\n     *\n     * Activate process of subscription handling\n     * if subscription was activated and Analytics token has not been received\n     * or interrupt subscription handling.\n     *\n     * @param Value $configValue\n     *\n     * @return bool\n     *\/",82],["T_WHITESPACE","\n    ",92],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","process",93],"(",["T_STRING","Value",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$configValue",93],")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$configValue",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","isValueChanged",95],"(",")",["T_WHITESPACE"," ",95],["T_BOOLEAN_AND","&&",95],["T_WHITESPACE"," ",95],"!",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","analyticsToken",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","isTokenExist",95],"(",")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$enabled",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$configValue",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getData",96],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",96],")",";",["T_WHITESPACE","\n\n            ",96],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$enabled",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setCronSchedule",99],"(",")",";",["T_WHITESPACE","\n                ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setAttemptsFlag",100],"(",")",";",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","notificationTime",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","unsetLastTimeNotificationValue",101],"(",")",";",["T_WHITESPACE","\n            ",101],"}",["T_WHITESPACE"," ",102],["T_ELSE","else",102],["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n                ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","unsetAttemptsFlag",103],"(",")",";",["T_WHITESPACE","\n            ",103],"}",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_STRING","true",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Set cron schedule setting into config for activation of subscription process.\n     *\n     * @return bool\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PRIVATE","private",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","setCronSchedule",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$cronExprArray",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],"[",["T_WHITESPACE","\n            ",117],["T_CONSTANT_ENCAPSED_STRING","'0'",118],",",["T_WHITESPACE","                    ",118],["T_COMMENT","# Minute\n",118],["T_WHITESPACE","            ",119],["T_CONSTANT_ENCAPSED_STRING","'*'",119],",",["T_WHITESPACE","                    ",119],["T_COMMENT","# Hour\n",119],["T_WHITESPACE","            ",120],["T_CONSTANT_ENCAPSED_STRING","'*'",120],",",["T_WHITESPACE","                    ",120],["T_COMMENT","# Day of the Month\n",120],["T_WHITESPACE","            ",121],["T_CONSTANT_ENCAPSED_STRING","'*'",121],",",["T_WHITESPACE","                    ",121],["T_COMMENT","# Month of the Year\n",121],["T_WHITESPACE","            ",122],["T_CONSTANT_ENCAPSED_STRING","'*'",122],",",["T_WHITESPACE","                    ",122],["T_COMMENT","# Day of the Week\n",122],["T_WHITESPACE","        ",123],"]",";",["T_WHITESPACE","\n\n        ",123],["T_VARIABLE","$cronExprString",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","join",125],"(",["T_CONSTANT_ENCAPSED_STRING","' '",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$cronExprArray",125],")",";",["T_WHITESPACE","\n\n        ",125],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","configWriter",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","save",127],"(",["T_STRING","self",127],["T_DOUBLE_COLON","::",127],["T_STRING","CRON_STRING_PATH",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$cronExprString",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_STRING","true",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Set flag as reserve counter of attempts subscription operation.\n     *\n     * @return bool\n     *\/",132],["T_WHITESPACE","\n    ",136],["T_PRIVATE","private",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","setAttemptsFlag",137],"(",")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","flagManager",139],["T_WHITESPACE","\n            ",139],["T_OBJECT_OPERATOR","->",140],["T_STRING","saveFlag",140],"(",["T_STRING","self",140],["T_DOUBLE_COLON","::",140],["T_STRING","ATTEMPTS_REVERSE_COUNTER_FLAG_CODE",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","attemptsInitValue",140],")",";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Unset flag of attempts subscription operation.\n     *\n     * @return bool\n     *\/",143],["T_WHITESPACE","\n    ",147],["T_PRIVATE","private",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","unsetAttemptsFlag",148],"(",")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","flagManager",150],["T_WHITESPACE","\n            ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","deleteFlag",151],"(",["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_STRING","ATTEMPTS_REVERSE_COUNTER_FLAG_CODE",151],")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n",152],"}",["T_WHITESPACE","\n",153]]