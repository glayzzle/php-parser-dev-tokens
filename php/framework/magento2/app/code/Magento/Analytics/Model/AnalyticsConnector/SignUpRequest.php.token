[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Analytics",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","AnalyticsConnector",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Config",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Config",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","HTTP",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ZendClientFactory",10],["T_WHITESPACE"," ",10],["T_AS","as",10],["T_WHITESPACE"," ",10],["T_STRING","HttpClientFactory",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","HTTP",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ZendClient",11],["T_WHITESPACE"," ",11],["T_AS","as",11],["T_WHITESPACE"," ",11],["T_STRING","HttpClient",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Zend_Http_Response",12],["T_WHITESPACE"," ",12],["T_AS","as",12],["T_WHITESPACE"," ",12],["T_STRING","HttpResponse",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Store",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Store",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Psr",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Log",14],["T_NS_SEPARATOR","\\",14],["T_STRING","LoggerInterface",14],";",["T_WHITESPACE","\n\n",14],["T_DOC_COMMENT","\/**\n * Class SignUpRequest\n *\n * Perform direct call to MA services for subscription.\n * In case of success returns MA access token.\n *\/",16],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","SignUpRequest",22],["T_WHITESPACE","\n",22],"{",["T_WHITESPACE","\n    ",23],["T_DOC_COMMENT","\/**\n     * @var string\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PRIVATE","private",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$signUpUrlPath",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'analytics\/url\/signup'",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @var Config\n     *\/",29],["T_WHITESPACE","\n    ",31],["T_PRIVATE","private",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$config",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @var HttpClientFactory\n     *\/",34],["T_WHITESPACE","\n    ",36],["T_PRIVATE","private",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$httpClientFactory",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * @var LoggerInterface\n     *\/",39],["T_WHITESPACE","\n    ",41],["T_PRIVATE","private",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$logger",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * SignUpRequest constructor.\n     *\n     * @param Config $config\n     * @param HttpClientFactory $httpClientFactory\n     * @param LoggerInterface $logger\n     *\/",44],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","__construct",51],"(",["T_WHITESPACE","\n        ",51],["T_STRING","Config",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$config",52],",",["T_WHITESPACE","\n        ",52],["T_STRING","HttpClientFactory",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$httpClientFactory",53],",",["T_WHITESPACE","\n        ",53],["T_STRING","LoggerInterface",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$logger",54],["T_WHITESPACE","\n    ",54],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","config",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$config",56],";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","httpClientFactory",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$httpClientFactory",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","logger",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$logger",58],";",["T_WHITESPACE","\n    ",58],"}",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Prepares json string with request data\n     *\n     * @param string $integrationToken\n     * @return string\n     *\/",61],["T_WHITESPACE","\n    ",66],["T_PRIVATE","private",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","getRequestJson",67],"(",["T_VARIABLE","$integrationToken",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_STRING","json_encode",69],"(",["T_WHITESPACE","\n            ",69],"[",["T_WHITESPACE","\n                ",70],["T_CONSTANT_ENCAPSED_STRING","\"token\"",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$integrationToken",71],",",["T_WHITESPACE","\n                ",71],["T_CONSTANT_ENCAPSED_STRING","\"url\"",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","config",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getConfigDataValue",72],"(",["T_STRING","Store",72],["T_DOUBLE_COLON","::",72],["T_STRING","XML_PATH_UNSECURE_BASE_URL",72],")",["T_WHITESPACE","\n            ",72],"]",["T_WHITESPACE","\n        ",73],")",";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Extracts token from the response\n     *\n     * @param HttpResponse $response\n     * @return string|false\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PRIVATE","private",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","extractResponseToken",83],"(",["T_STRING","HttpResponse",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$response",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$token",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","false",85],";",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$response",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getStatus",86],"(",")",["T_WHITESPACE"," ",86],["T_IS_IDENTICAL","===",86],["T_WHITESPACE"," ",86],["T_LNUMBER","200",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$body",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","json_decode",87],"(",["T_VARIABLE","$response",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getBody",87],"(",")",",",["T_WHITESPACE"," ",87],["T_LNUMBER","1",87],")",";",["T_WHITESPACE","\n            ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_ISSET","isset",88],"(",["T_VARIABLE","$body",88],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",88],"]",")",["T_WHITESPACE"," ",88],["T_BOOLEAN_AND","&&",88],["T_WHITESPACE"," ",88],"!",["T_EMPTY","empty",88],"(",["T_VARIABLE","$body",88],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",88],"]",")",")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$token",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$body",89],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",89],"]",";",["T_WHITESPACE","\n            ",89],"}",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$token",92],";",["T_WHITESPACE","\n    ",92],"}",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Performs signUp call to MA\n     * Sends data about instance base url and integration user token\n     * Returns MA access token as a result\n     *\n     * @param string $integrationToken\n     * @return string|false\n     *\/",95],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","call",103],"(",["T_VARIABLE","$integrationToken",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$token",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","false",105],";",["T_WHITESPACE","\n        ",105],["T_DOC_COMMENT","\/** @var HttpClient $httpClient *\/",106],["T_WHITESPACE","\n        ",106],["T_VARIABLE","$httpClient",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","httpClientFactory",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","create",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$httpClient",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","setUri",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","config",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getConfigDataValue",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","signUpUrlPath",108],")",")",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$httpClient",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","setRawData",109],"(",["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getRequestJson",109],"(",["T_VARIABLE","$integrationToken",109],")",")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$httpClient",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","setMethod",110],"(",["T_STRING","HttpClient",110],["T_DOUBLE_COLON","::",110],["T_STRING","POST",110],")",";",["T_WHITESPACE","\n        ",110],["T_TRY","try",111],["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$token",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","extractResponseToken",112],"(",["T_VARIABLE","$httpClient",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","request",112],"(",")",")",";",["T_WHITESPACE","\n            ",112],["T_IF","if",113],["T_WHITESPACE"," ",113],"(","!",["T_VARIABLE","$token",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","logger",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","warning",114],"(",["T_CONSTANT_ENCAPSED_STRING","'The attempt of subscription was unsuccessful on step sign-up.'",114],")",";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE"," ",116],["T_CATCH","catch",116],["T_WHITESPACE"," ",116],"(",["T_NS_SEPARATOR","\\",116],["T_STRING","Exception",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$e",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","logger",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","critical",117],"(",["T_VARIABLE","$e",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$token",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n",120],"}",["T_WHITESPACE","\n",121]]