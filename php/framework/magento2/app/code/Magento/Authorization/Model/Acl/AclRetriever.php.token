[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Authorization",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Acl",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Authorization",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Role",9],["T_NS_SEPARATOR","\\",9],["T_STRING","CollectionFactory",9],["T_WHITESPACE"," ",9],["T_AS","as",9],["T_WHITESPACE"," ",9],["T_STRING","RoleCollectionFactory",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Authorization",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","ResourceModel",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Rules",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CollectionFactory",10],["T_WHITESPACE"," ",10],["T_AS","as",10],["T_WHITESPACE"," ",10],["T_STRING","RulesCollectionFactory",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Authorization",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Role",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Authorization",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","UserContextInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Acl",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Builder",13],["T_WHITESPACE"," ",13],["T_AS","as",13],["T_WHITESPACE"," ",13],["T_STRING","AclBuilder",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Exception",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AuthorizationException",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Exception",15],["T_NS_SEPARATOR","\\",15],["T_STRING","LocalizedException",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Psr",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Log",16],["T_NS_SEPARATOR","\\",16],["T_STRING","LoggerInterface",16],["T_WHITESPACE"," ",16],["T_AS","as",16],["T_WHITESPACE"," ",16],["T_STRING","Logger",16],";",["T_WHITESPACE","\n\n",16],["T_DOC_COMMENT","\/**\n * Permission tree retriever\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",18],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","AclRetriever",22],["T_WHITESPACE","\n",22],"{",["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","PERMISSION_ANONYMOUS",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'anonymous'",24],";",["T_WHITESPACE","\n    ",24],["T_CONST","const",25],["T_WHITESPACE"," ",25],["T_STRING","PERMISSION_SELF",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","'self'",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/** @var Logger *\/",27],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$logger",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/** @var RulesCollectionFactory *\/",30],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$rulesCollectionFactory",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/** @var AclBuilder *\/",33],["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$aclBuilder",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/** @var RoleCollectionFactory *\/",36],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$roleCollectionFactory",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Initialize dependencies.\n     *\n     * @param AclBuilder $aclBuilder\n     * @param RoleCollectionFactory $roleCollectionFactory\n     * @param RulesCollectionFactory $rulesCollectionFactory\n     * @param Logger $logger\n     *\/",39],["T_WHITESPACE","\n    ",46],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","__construct",47],"(",["T_WHITESPACE","\n        ",47],["T_STRING","AclBuilder",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$aclBuilder",48],",",["T_WHITESPACE","\n        ",48],["T_STRING","RoleCollectionFactory",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$roleCollectionFactory",49],",",["T_WHITESPACE","\n        ",49],["T_STRING","RulesCollectionFactory",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$rulesCollectionFactory",50],",",["T_WHITESPACE","\n        ",50],["T_STRING","Logger",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$logger",51],["T_WHITESPACE","\n    ",51],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","logger",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$logger",53],";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","rulesCollectionFactory",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$rulesCollectionFactory",54],";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","aclBuilder",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$aclBuilder",55],";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","roleCollectionFactory",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$roleCollectionFactory",56],";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Get a list of available resources using user details\n     *\n     * @param string $userType\n     * @param int $userId\n     * @return string[]\n     * @throws AuthorizationException\n     * @throws LocalizedException\n     *\/",59],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","getAllowedResourcesByUser",68],"(",["T_VARIABLE","$userType",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$userId",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$userType",70],["T_WHITESPACE"," ",70],["T_IS_EQUAL","==",70],["T_WHITESPACE"," ",70],["T_STRING","UserContextInterface",70],["T_DOUBLE_COLON","::",70],["T_STRING","USER_TYPE_GUEST",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],"[",["T_STRING","self",71],["T_DOUBLE_COLON","::",71],["T_STRING","PERMISSION_ANONYMOUS",71],"]",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE"," ",72],["T_ELSEIF","elseif",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$userType",72],["T_WHITESPACE"," ",72],["T_IS_EQUAL","==",72],["T_WHITESPACE"," ",72],["T_STRING","UserContextInterface",72],["T_DOUBLE_COLON","::",72],["T_STRING","USER_TYPE_CUSTOMER",72],")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_RETURN","return",73],["T_WHITESPACE"," ",73],"[",["T_STRING","self",73],["T_DOUBLE_COLON","::",73],["T_STRING","PERMISSION_SELF",73],"]",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n        ",74],["T_TRY","try",75],["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$role",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_getUserRole",76],"(",["T_VARIABLE","$userType",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$userId",76],")",";",["T_WHITESPACE","\n            ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(","!",["T_VARIABLE","$role",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n                ",77],["T_THROW","throw",78],["T_WHITESPACE"," ",78],["T_NEW","new",78],["T_WHITESPACE"," ",78],["T_STRING","AuthorizationException",78],"(",["T_WHITESPACE","\n                    ",78],["T_STRING","__",79],"(",["T_CONSTANT_ENCAPSED_STRING","'We can\\'t find the role for the user you wanted.'",79],")",["T_WHITESPACE","\n                ",79],")",";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$allowedResources",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getAllowedResourcesByRole",82],"(",["T_VARIABLE","$role",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getId",82],"(",")",")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE"," ",83],["T_CATCH","catch",83],["T_WHITESPACE"," ",83],"(",["T_STRING","AuthorizationException",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_THROW","throw",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$e",84],";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE"," ",85],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_NS_SEPARATOR","\\",85],["T_STRING","Exception",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","logger",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","critical",86],"(",["T_VARIABLE","$e",86],")",";",["T_WHITESPACE","\n            ",86],["T_THROW","throw",87],["T_WHITESPACE"," ",87],["T_NEW","new",87],["T_WHITESPACE"," ",87],["T_STRING","LocalizedException",87],"(",["T_WHITESPACE","\n                ",87],["T_STRING","__",88],"(",["T_WHITESPACE","\n                    ",88],["T_CONSTANT_ENCAPSED_STRING","'Something went wrong while compiling a list of allowed resources. '",89],["T_WHITESPACE","\n                    ",89],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'You can find out more in the exceptions log.'",90],["T_WHITESPACE","\n                ",90],")",["T_WHITESPACE","\n            ",91],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n        ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$allowedResources",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Get a list of available resource using user role id\n     *\n     * @param string $roleId\n     * @return string[]\n     *\/",97],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getAllowedResourcesByRole",103],"(",["T_VARIABLE","$roleId",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$allowedResources",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],"[","]",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$rulesCollection",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","rulesCollectionFactory",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","create",106],"(",")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$rulesCollection",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getByRoles",107],"(",["T_VARIABLE","$roleId",107],")",["T_OBJECT_OPERATOR","->",107],["T_STRING","load",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$acl",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","aclBuilder",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getAcl",108],"(",")",";",["T_WHITESPACE","\n        ",108],["T_DOC_COMMENT","\/** @var \\Magento\\Authorization\\Model\\Rules $ruleItem *\/",109],["T_WHITESPACE","\n        ",109],["T_FOREACH","foreach",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$rulesCollection",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getItems",110],"(",")",["T_WHITESPACE"," ",110],["T_AS","as",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$ruleItem",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$resourceId",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$ruleItem",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getResourceId",111],"(",")",";",["T_WHITESPACE","\n            ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$acl",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","has",112],"(",["T_VARIABLE","$resourceId",112],")",["T_WHITESPACE"," ",112],["T_BOOLEAN_AND","&&",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$acl",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","isAllowed",112],"(",["T_VARIABLE","$roleId",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$resourceId",112],")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$allowedResources",113],"[","]",["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$resourceId",113],";",["T_WHITESPACE","\n            ",113],"}",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n        ",115],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$allowedResources",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Identify user role from user identifier.\n     *\n     * @param string $userType\n     * @param int $userId\n     * @return \\Magento\\Authorization\\Model\\Role|bool False if no role associated with provided user was found.\n     * @throws \\LogicException\n     *\/",119],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_getUserRole",127],"(",["T_VARIABLE","$userType",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$userId",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","!",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_canRoleBeCreatedForUserType",129],"(",["T_VARIABLE","$userType",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_THROW","throw",130],["T_WHITESPACE"," ",130],["T_NEW","new",130],["T_WHITESPACE"," ",130],["T_NS_SEPARATOR","\\",130],["T_STRING","LogicException",130],"(",["T_WHITESPACE","\n                ",130],"\"",["T_ENCAPSED_AND_WHITESPACE","The role with user type '",131],["T_CURLY_OPEN","{",131],["T_VARIABLE","$userType",131],"}",["T_ENCAPSED_AND_WHITESPACE","' does not exist and cannot be created",131],"\"",["T_WHITESPACE","\n            ",131],")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$roleCollection",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","roleCollectionFactory",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","create",134],"(",")",";",["T_WHITESPACE","\n        ",134],["T_DOC_COMMENT","\/** @var Role $role *\/",135],["T_WHITESPACE","\n        ",135],["T_VARIABLE","$role",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$roleCollection",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","setUserFilter",136],"(",["T_VARIABLE","$userId",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$userType",136],")",["T_OBJECT_OPERATOR","->",136],["T_STRING","getFirstItem",136],"(",")",";",["T_WHITESPACE","\n        ",136],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$role",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",["T_WHITESPACE"," ",137],"?",["T_WHITESPACE"," ",137],["T_VARIABLE","$role",137],["T_WHITESPACE"," ",137],":",["T_WHITESPACE"," ",137],["T_STRING","false",137],";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Check if the role can be associated with user having provided user type.\n     *\n     * Roles can be created for integrations and admin users only.\n     *\n     * @param int $userType\n     * @return bool\n     *\/",140],["T_WHITESPACE","\n    ",147],["T_PROTECTED","protected",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","_canRoleBeCreatedForUserType",148],"(",["T_VARIABLE","$userType",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$userType",150],["T_WHITESPACE"," ",150],["T_IS_EQUAL","==",150],["T_WHITESPACE"," ",150],["T_STRING","UserContextInterface",150],["T_DOUBLE_COLON","::",150],["T_STRING","USER_TYPE_INTEGRATION",150],")",["T_WHITESPACE","\n            ",150],["T_BOOLEAN_OR","||",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$userType",151],["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_STRING","UserContextInterface",151],["T_DOUBLE_COLON","::",151],["T_STRING","USER_TYPE_ADMIN",151],")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n",152],"}",["T_WHITESPACE","\n",153]]