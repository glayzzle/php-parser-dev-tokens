[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","SalesInventory",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Order",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Sales",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","CreditmemoInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Sales",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","OrderInterface",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Class ReturnProcessor\n *\/",11],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","ReturnProcessor",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\CatalogInventory\\Api\\StockManagementInterface\n     *\/",16],["T_WHITESPACE","\n    ",18],["T_PRIVATE","private",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$stockManagement",19],";",["T_WHITESPACE","\n\n    ",19],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\CatalogInventory\\Model\\Indexer\\Stock\\Processor\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_PRIVATE","private",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$stockIndexerProcessor",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\Indexer\\Product\\Price\\Processor\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_PRIVATE","private",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$priceIndexer",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Store\\Model\\StoreManagerInterface\n     *\/",31],["T_WHITESPACE","\n    ",33],["T_PRIVATE","private",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$storeManager",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\OrderItemRepositoryInterface\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PRIVATE","private",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$orderItemRepository",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * ReturnProcessor constructor.\n     * @param \\Magento\\CatalogInventory\\Api\\StockManagementInterface $stockManagement\n     * @param \\Magento\\CatalogInventory\\Model\\Indexer\\Stock\\Processor $stockIndexer\n     * @param \\Magento\\Catalog\\Model\\Indexer\\Product\\Price\\Processor $priceIndexer\n     * @param \\Magento\\Store\\Model\\StoreManagerInterface $storeManager\n     * @param \\Magento\\Sales\\Api\\OrderItemRepositoryInterface $orderItemRepository\n     *\/",41],["T_WHITESPACE","\n    ",48],["T_PUBLIC","public",49],["T_WHITESPACE"," ",49],["T_FUNCTION","function",49],["T_WHITESPACE"," ",49],["T_STRING","__construct",49],"(",["T_WHITESPACE","\n        ",49],["T_NS_SEPARATOR","\\",50],["T_STRING","Magento",50],["T_NS_SEPARATOR","\\",50],["T_STRING","CatalogInventory",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Api",50],["T_NS_SEPARATOR","\\",50],["T_STRING","StockManagementInterface",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$stockManagement",50],",",["T_WHITESPACE","\n        ",50],["T_NS_SEPARATOR","\\",51],["T_STRING","Magento",51],["T_NS_SEPARATOR","\\",51],["T_STRING","CatalogInventory",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Model",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Indexer",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Stock",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Processor",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$stockIndexer",51],",",["T_WHITESPACE","\n        ",51],["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Catalog",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Model",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Indexer",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Product",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Price",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Processor",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$priceIndexer",52],",",["T_WHITESPACE","\n        ",52],["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Store",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Model",53],["T_NS_SEPARATOR","\\",53],["T_STRING","StoreManagerInterface",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$storeManager",53],",",["T_WHITESPACE","\n        ",53],["T_NS_SEPARATOR","\\",54],["T_STRING","Magento",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Sales",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Api",54],["T_NS_SEPARATOR","\\",54],["T_STRING","OrderItemRepositoryInterface",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$orderItemRepository",54],["T_WHITESPACE","\n    ",54],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","stockManagement",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$stockManagement",56],";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","stockIndexerProcessor",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$stockIndexer",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","priceIndexer",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$priceIndexer",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","storeManager",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$storeManager",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","orderItemRepository",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$orderItemRepository",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * @param CreditmemoInterface $creditmemo\n     * @param OrderInterface $order\n     * @param array $returnToStockItems\n     * @param bool $isAutoReturn\n     * @return void\n     *\/",63],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","execute",70],"(",["T_WHITESPACE","\n        ",70],["T_STRING","CreditmemoInterface",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$creditmemo",71],",",["T_WHITESPACE","\n        ",71],["T_STRING","OrderInterface",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$order",72],",",["T_WHITESPACE","\n        ",72],["T_ARRAY","array",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$returnToStockItems",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],"[","]",",",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$isAutoReturn",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","false",74],["T_WHITESPACE","\n    ",74],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$itemsToUpdate",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],"[","]",";",["T_WHITESPACE","\n        ",76],["T_FOREACH","foreach",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$creditmemo",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getItems",77],"(",")",["T_WHITESPACE"," ",77],["T_AS","as",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$item",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$productId",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$item",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getProductId",78],"(",")",";",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$orderItem",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","orderItemRepository",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","get",79],"(",["T_VARIABLE","$item",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getOrderItemId",79],"(",")",")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$parentItemId",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$orderItem",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getParentItemId",80],"(",")",";",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$qty",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$item",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getQty",81],"(",")",";",["T_WHITESPACE","\n            ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$isAutoReturn",82],["T_WHITESPACE"," ",82],["T_BOOLEAN_OR","||",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","canReturnItem",82],"(",["T_VARIABLE","$item",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$qty",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$parentItemId",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$returnToStockItems",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n                ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_ISSET","isset",83],"(",["T_VARIABLE","$itemsToUpdate",83],"[",["T_VARIABLE","$productId",83],"]",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                    ",83],["T_VARIABLE","$itemsToUpdate",84],"[",["T_VARIABLE","$productId",84],"]",["T_WHITESPACE"," ",84],["T_PLUS_EQUAL","+=",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$qty",84],";",["T_WHITESPACE","\n                ",84],"}",["T_WHITESPACE"," ",85],["T_ELSE","else",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                    ",85],["T_VARIABLE","$itemsToUpdate",86],"[",["T_VARIABLE","$productId",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$qty",86],";",["T_WHITESPACE","\n                ",86],"}",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_IF","if",91],["T_WHITESPACE"," ",91],"(","!",["T_EMPTY","empty",91],"(",["T_VARIABLE","$itemsToUpdate",91],")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$store",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","storeManager",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getStore",92],"(",["T_VARIABLE","$order",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getStoreId",92],"(",")",")",";",["T_WHITESPACE","\n            ",92],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$itemsToUpdate",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$productId",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$qty",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","stockManagement",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","backItemQty",94],"(",["T_WHITESPACE","\n                    ",94],["T_VARIABLE","$productId",95],",",["T_WHITESPACE","\n                    ",95],["T_VARIABLE","$qty",96],",",["T_WHITESPACE","\n                    ",96],["T_VARIABLE","$store",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getWebsiteId",97],"(",")",["T_WHITESPACE","\n                ",97],")",";",["T_WHITESPACE","\n            ",98],"}",["T_WHITESPACE","\n\n            ",99],["T_VARIABLE","$updatedItemIds",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","array_keys",101],"(",["T_VARIABLE","$itemsToUpdate",101],")",";",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","stockIndexerProcessor",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","reindexList",102],"(",["T_VARIABLE","$updatedItemIds",102],")",";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","priceIndexer",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","reindexList",103],"(",["T_VARIABLE","$updatedItemIds",103],")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Api\\Data\\CreditmemoItemInterface $item\n     * @param int $qty\n     * @param int[] $returnToStockItems\n     * @param int $parentItemId\n     * @return bool\n     *\/",107],["T_WHITESPACE","\n    ",113],["T_PRIVATE","private",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","canReturnItem",114],"(",["T_WHITESPACE","\n        ",114],["T_NS_SEPARATOR","\\",115],["T_STRING","Magento",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Sales",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Api",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Data",115],["T_NS_SEPARATOR","\\",115],["T_STRING","CreditmemoItemInterface",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$item",115],",",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$qty",116],",",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$parentItemId",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","null",117],",",["T_WHITESPACE","\n        ",117],["T_ARRAY","array",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$returnToStockItems",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],"[","]",["T_WHITESPACE","\n    ",118],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],"(",["T_STRING","in_array",120],"(",["T_VARIABLE","$item",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getOrderItemId",120],"(",")",",",["T_WHITESPACE"," ",120],["T_VARIABLE","$returnToStockItems",120],")",["T_WHITESPACE"," ",120],["T_BOOLEAN_OR","||",120],["T_WHITESPACE"," ",120],["T_STRING","in_array",120],"(",["T_VARIABLE","$parentItemId",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$returnToStockItems",120],")",")",["T_WHITESPACE","\n        ",120],["T_BOOLEAN_AND","&&",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$qty",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n",122],"}",["T_WHITESPACE","\n",123]]