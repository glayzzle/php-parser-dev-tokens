[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Downloadable",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Helper",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","App",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Filesystem",11],["T_NS_SEPARATOR","\\",11],["T_STRING","DirectoryList",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Filesystem",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Exception",13],["T_NS_SEPARATOR","\\",13],["T_STRING","LocalizedException",13],["T_WHITESPACE"," ",13],["T_AS","as",13],["T_WHITESPACE"," ",13],["T_STRING","CoreException",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * Downloadable Products Download Helper\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",15],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","Download",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Magento",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Framework",19],["T_NS_SEPARATOR","\\",19],["T_STRING","App",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Helper",19],["T_NS_SEPARATOR","\\",19],["T_STRING","AbstractHelper",19],["T_WHITESPACE","\n",19],"{",["T_WHITESPACE","\n    ",20],["T_DOC_COMMENT","\/**\n     * Link type url\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","LINK_TYPE_URL",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'url'",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * Link type file\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_CONST","const",29],["T_WHITESPACE"," ",29],["T_STRING","LINK_TYPE_FILE",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'file'",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Config path to content disposition\n     *\/",31],["T_WHITESPACE","\n    ",33],["T_CONST","const",34],["T_WHITESPACE"," ",34],["T_STRING","XML_PATH_CONTENT_DISPOSITION",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'catalog\/downloadable\/content_disposition'",34],";",["T_WHITESPACE","\n\n    ",34],["T_DOC_COMMENT","\/**\n     * Type of link\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_linkType",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","self",41],["T_DOUBLE_COLON","::",41],["T_STRING","LINK_TYPE_FILE",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Resource file\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_resourceFile",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","null",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Resource open handle\n     *\n     * @var \\Magento\\Framework\\Filesystem\\File\\ReadInterface\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_handle",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","null",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Remote server headers\n     *\n     * @var array\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_urlHeaders",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],"[","]",";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * MIME Content-type for a file\n     *\n     * @var string\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_contentType",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'application\/octet-stream'",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * File name\n     *\n     * @var string\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_fileName",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'download'",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Core file storage database\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database\n     *\/",78],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_coreFileStorageDb",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Downloadable file\n     *\n     * @var \\Magento\\Downloadable\\Helper\\File\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_downloadableFile",90],";",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Filesystem\n     *\/",92],["T_WHITESPACE","\n    ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$_filesystem",95],";",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/** @var Filesystem\\File\\ReadFactory *\/",97],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$fileReadFactory",98],";",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Working Directory (valid for LINK_TYPE_FILE only).\n     * @var \\Magento\\Framework\\Filesystem\\Directory\\Read\n     *\/",100],["T_WHITESPACE","\n    ",103],["T_PROTECTED","protected",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$_workingDirectory",104],";",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Session\\SessionManagerInterface\n     *\/",106],["T_WHITESPACE","\n    ",108],["T_PROTECTED","protected",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$_session",109],";",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\App\\Helper\\Context $context\n     * @param File $downloadableFile\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database $coreFileStorageDb\n     * @param Filesystem $filesystem\n     * @param \\Magento\\Framework\\Session\\SessionManagerInterface $session\n     * @param Filesystem\\File\\ReadFactory $fileReadFactory\n     *\/",111],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","__construct",119],"(",["T_WHITESPACE","\n        ",119],["T_NS_SEPARATOR","\\",120],["T_STRING","Magento",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Framework",120],["T_NS_SEPARATOR","\\",120],["T_STRING","App",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Helper",120],["T_NS_SEPARATOR","\\",120],["T_STRING","Context",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$context",120],",",["T_WHITESPACE","\n        ",120],["T_NS_SEPARATOR","\\",121],["T_STRING","Magento",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Downloadable",121],["T_NS_SEPARATOR","\\",121],["T_STRING","Helper",121],["T_NS_SEPARATOR","\\",121],["T_STRING","File",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$downloadableFile",121],",",["T_WHITESPACE","\n        ",121],["T_NS_SEPARATOR","\\",122],["T_STRING","Magento",122],["T_NS_SEPARATOR","\\",122],["T_STRING","MediaStorage",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Helper",122],["T_NS_SEPARATOR","\\",122],["T_STRING","File",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Storage",122],["T_NS_SEPARATOR","\\",122],["T_STRING","Database",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$coreFileStorageDb",122],",",["T_WHITESPACE","\n        ",122],["T_NS_SEPARATOR","\\",123],["T_STRING","Magento",123],["T_NS_SEPARATOR","\\",123],["T_STRING","Framework",123],["T_NS_SEPARATOR","\\",123],["T_STRING","Filesystem",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$filesystem",123],",",["T_WHITESPACE","\n        ",123],["T_NS_SEPARATOR","\\",124],["T_STRING","Magento",124],["T_NS_SEPARATOR","\\",124],["T_STRING","Framework",124],["T_NS_SEPARATOR","\\",124],["T_STRING","Session",124],["T_NS_SEPARATOR","\\",124],["T_STRING","SessionManagerInterface",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$session",124],",",["T_WHITESPACE","\n        ",124],["T_NS_SEPARATOR","\\",125],["T_STRING","Magento",125],["T_NS_SEPARATOR","\\",125],["T_STRING","Framework",125],["T_NS_SEPARATOR","\\",125],["T_STRING","Filesystem",125],["T_NS_SEPARATOR","\\",125],["T_STRING","File",125],["T_NS_SEPARATOR","\\",125],["T_STRING","ReadFactory",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$fileReadFactory",125],["T_WHITESPACE","\n    ",125],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n        ",126],["T_STRING","parent",127],["T_DOUBLE_COLON","::",127],["T_STRING","__construct",127],"(",["T_VARIABLE","$context",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_downloadableFile",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$downloadableFile",128],";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_coreFileStorageDb",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$coreFileStorageDb",129],";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_filesystem",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$filesystem",130],";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_session",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$session",131],";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","fileReadFactory",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$fileReadFactory",132],";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Retrieve Resource file handle (socket, file pointer etc)\n     *\n     * @return \\Magento\\Framework\\Filesystem\\File\\ReadInterface\n     * @throws CoreException|\\Exception\n     *\/",135],["T_WHITESPACE","\n    ",140],["T_PROTECTED","protected",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","_getHandle",141],"(",")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(","!",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_resourceFile",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_THROW","throw",144],["T_WHITESPACE"," ",144],["T_NEW","new",144],["T_WHITESPACE"," ",144],["T_STRING","CoreException",144],"(",["T_STRING","__",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Please set resource file and link type.'",144],")",")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_STRING","is_null",147],"(",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_handle",147],")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_linkType",148],["T_WHITESPACE"," ",148],["T_IS_EQUAL","==",148],["T_WHITESPACE"," ",148],["T_STRING","self",148],["T_DOUBLE_COLON","::",148],["T_STRING","LINK_TYPE_URL",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n                ",148],["T_VARIABLE","$path",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_resourceFile",149],";",["T_WHITESPACE","\n                ",149],["T_VARIABLE","$protocol",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","strtolower",150],"(",["T_STRING","parse_url",150],"(",["T_VARIABLE","$path",150],",",["T_WHITESPACE"," ",150],["T_STRING","PHP_URL_SCHEME",150],")",")",";",["T_WHITESPACE","\n                ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$protocol",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                    ",151],["T_COMMENT","\/\/ Strip down protocol from path\n",152],["T_WHITESPACE","                    ",153],["T_VARIABLE","$path",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_STRING","preg_replace",153],"(",["T_CONSTANT_ENCAPSED_STRING","'#.+:\/\/#'",153],",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","''",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$path",153],")",";",["T_WHITESPACE","\n                ",153],"}",["T_WHITESPACE","\n                ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_handle",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","fileReadFactory",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","create",155],"(",["T_VARIABLE","$path",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$protocol",155],")",";",["T_WHITESPACE","\n            ",155],"}",["T_WHITESPACE"," ",156],["T_ELSEIF","elseif",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_linkType",156],["T_WHITESPACE"," ",156],["T_IS_EQUAL","==",156],["T_WHITESPACE"," ",156],["T_STRING","self",156],["T_DOUBLE_COLON","::",156],["T_STRING","LINK_TYPE_FILE",156],")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_workingDirectory",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_filesystem",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getDirectoryRead",157],"(",["T_STRING","DirectoryList",157],["T_DOUBLE_COLON","::",157],["T_STRING","MEDIA",157],")",";",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$fileExists",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_downloadableFile",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","ensureFileInFilesystem",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_resourceFile",158],")",";",["T_WHITESPACE","\n                ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$fileExists",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                    ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_handle",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_workingDirectory",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","openFile",160],"(",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_resourceFile",160],")",";",["T_WHITESPACE","\n                ",160],"}",["T_WHITESPACE"," ",161],["T_ELSE","else",161],["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n                    ",161],["T_THROW","throw",162],["T_WHITESPACE"," ",162],["T_NEW","new",162],["T_WHITESPACE"," ",162],["T_STRING","CoreException",162],"(",["T_STRING","__",162],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid download link type.'",162],")",")",";",["T_WHITESPACE","\n                ",162],"}",["T_WHITESPACE","\n            ",163],"}",["T_WHITESPACE"," ",164],["T_ELSE","else",164],["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n                ",164],["T_THROW","throw",165],["T_WHITESPACE"," ",165],["T_NEW","new",165],["T_WHITESPACE"," ",165],["T_STRING","CoreException",165],"(",["T_STRING","__",165],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid download link type.'",165],")",")",";",["T_WHITESPACE","\n            ",165],"}",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_handle",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Retrieve file size in bytes\n     *\n     * @return int\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","getFileSize",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_getHandle",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","stat",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_resourceFile",178],")","[",["T_CONSTANT_ENCAPSED_STRING","'size'",178],"]",";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Return MIME type of a file.\n     *\n     * @return string\n     *\/",181],["T_WHITESPACE","\n    ",185],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","getContentType",186],"(",")",["T_WHITESPACE","\n    ",186],"{",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_getHandle",188],"(",")",";",["T_WHITESPACE","\n        ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_linkType",189],["T_WHITESPACE"," ",189],["T_IS_EQUAL","==",189],["T_WHITESPACE"," ",189],["T_STRING","self",189],["T_DOUBLE_COLON","::",189],["T_STRING","LINK_TYPE_FILE",189],")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_STRING","function_exists",190],"(",["T_WHITESPACE","\n                ",190],["T_CONSTANT_ENCAPSED_STRING","'mime_content_type'",191],["T_WHITESPACE","\n            ",191],")",["T_WHITESPACE"," ",192],["T_BOOLEAN_AND","&&",192],["T_WHITESPACE"," ",192],"(",["T_VARIABLE","$contentType",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","mime_content_type",192],"(",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_workingDirectory",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getAbsolutePath",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_resourceFile",193],")",["T_WHITESPACE","\n            ",193],")",")",["T_WHITESPACE","\n            ",194],")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n                ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$contentType",196],";",["T_WHITESPACE","\n            ",196],"}",["T_WHITESPACE"," ",197],["T_ELSE","else",197],["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n                ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_downloadableFile",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getFileType",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_resourceFile",198],")",";",["T_WHITESPACE","\n            ",198],"}",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE"," ",200],["T_ELSEIF","elseif",200],["T_WHITESPACE"," ",200],"(",["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_linkType",200],["T_WHITESPACE"," ",200],["T_IS_EQUAL","==",200],["T_WHITESPACE"," ",200],["T_STRING","self",200],["T_DOUBLE_COLON","::",200],["T_STRING","LINK_TYPE_URL",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_RETURN","return",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_handle",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","stat",201],"(",["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_resourceFile",201],")","[",["T_CONSTANT_ENCAPSED_STRING","'type'",201],"]",";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n        ",202],["T_RETURN","return",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_contentType",203],";",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Return name of the file\n     *\n     * @return string\n     *\/",206],["T_WHITESPACE","\n    ",210],["T_PUBLIC","public",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","getFilename",211],"(",")",["T_WHITESPACE","\n    ",211],"{",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_getHandle",213],"(",")",";",["T_WHITESPACE","\n        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_linkType",214],["T_WHITESPACE"," ",214],["T_IS_EQUAL","==",214],["T_WHITESPACE"," ",214],["T_STRING","self",214],["T_DOUBLE_COLON","::",214],["T_STRING","LINK_TYPE_FILE",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_STRING","pathinfo",215],"(",["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_resourceFile",215],",",["T_WHITESPACE"," ",215],["T_STRING","PATHINFO_BASENAME",215],")",";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE"," ",216],["T_ELSEIF","elseif",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_linkType",216],["T_WHITESPACE"," ",216],["T_IS_EQUAL","==",216],["T_WHITESPACE"," ",216],["T_STRING","self",216],["T_DOUBLE_COLON","::",216],["T_STRING","LINK_TYPE_URL",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$stat",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_handle",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","stat",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_resourceFile",217],")",";",["T_WHITESPACE","\n            ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_ISSET","isset",218],"(",["T_VARIABLE","$stat",218],"[",["T_CONSTANT_ENCAPSED_STRING","'disposition'",218],"]",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n                ",218],["T_VARIABLE","$contentDisposition",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_STRING","explode",219],"(",["T_CONSTANT_ENCAPSED_STRING","'; '",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$stat",219],"[",["T_CONSTANT_ENCAPSED_STRING","'disposition'",219],"]",")",";",["T_WHITESPACE","\n                ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_EMPTY","empty",220],"(",["T_VARIABLE","$contentDisposition",220],"[",["T_LNUMBER","1",220],"]",")",["T_WHITESPACE"," ",220],["T_BOOLEAN_AND","&&",220],["T_WHITESPACE"," ",220],["T_STRING","preg_match",220],"(",["T_WHITESPACE","\n                    ",220],["T_CONSTANT_ENCAPSED_STRING","'\/filename=([^ ]+)\/'",221],",",["T_WHITESPACE","\n                    ",221],["T_VARIABLE","$contentDisposition",222],"[",["T_LNUMBER","1",222],"]",",",["T_WHITESPACE","\n                    ",222],["T_VARIABLE","$matches",223],["T_WHITESPACE","\n                ",223],")",["T_WHITESPACE","\n                ",224],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                    ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$matches",226],"[",["T_LNUMBER","1",226],"]",";",["T_WHITESPACE","\n                ",226],"}",["T_WHITESPACE","\n            ",227],"}",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$fileName",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],"@",["T_STRING","pathinfo",229],"(",["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_resourceFile",229],",",["T_WHITESPACE"," ",229],["T_STRING","PATHINFO_BASENAME",229],")",";",["T_WHITESPACE","\n            ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$fileName",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n                ",230],["T_RETURN","return",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$fileName",231],";",["T_WHITESPACE","\n            ",231],"}",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n        ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_fileName",234],";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Set resource file for download\n     *\n     * @param string $resourceFile\n     * @param string $linkType\n     * @return $this\n     * @throws \\InvalidArgumentException\n     *\/",237],["T_WHITESPACE","\n    ",244],["T_PUBLIC","public",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","setResource",245],"(",["T_VARIABLE","$resourceFile",245],",",["T_WHITESPACE"," ",245],["T_VARIABLE","$linkType",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_STRING","self",245],["T_DOUBLE_COLON","::",245],["T_STRING","LINK_TYPE_FILE",245],")",["T_WHITESPACE","\n    ",245],"{",["T_WHITESPACE","\n        ",246],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_STRING","self",247],["T_DOUBLE_COLON","::",247],["T_STRING","LINK_TYPE_FILE",247],["T_WHITESPACE"," ",247],["T_IS_EQUAL","==",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$linkType",247],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n            ",247],["T_COMMENT","\/\/check LFI protection\n",248],["T_WHITESPACE","            ",249],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_STRING","preg_match",249],"(",["T_CONSTANT_ENCAPSED_STRING","'#\\.\\.[\\\\\\\/]#'",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$resourceFile",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                ",249],["T_THROW","throw",250],["T_WHITESPACE"," ",250],["T_NEW","new",250],["T_WHITESPACE"," ",250],["T_NS_SEPARATOR","\\",250],["T_STRING","InvalidArgumentException",250],"(",["T_WHITESPACE","\n                    ",250],["T_CONSTANT_ENCAPSED_STRING","'Requested file may not include parent directory traversal (\"..\/\", \"..\\\\\" notation)'",251],["T_WHITESPACE","\n                ",251],")",";",["T_WHITESPACE","\n            ",252],"}",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE","\n\n        ",254],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_resourceFile",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$resourceFile",256],";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_linkType",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$linkType",257],";",["T_WHITESPACE","\n\n        ",257],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],";",["T_WHITESPACE","\n    ",259],"}",["T_WHITESPACE","\n\n    ",260],["T_DOC_COMMENT","\/**\n     * Output file contents\n     *\n     * @return void\n     *\/",262],["T_WHITESPACE","\n    ",266],["T_PUBLIC","public",267],["T_WHITESPACE"," ",267],["T_FUNCTION","function",267],["T_WHITESPACE"," ",267],["T_STRING","output",267],"(",")",["T_WHITESPACE","\n    ",267],"{",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$handle",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_getHandle",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_session",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","writeClose",270],"(",")",";",["T_WHITESPACE","\n        ",270],["T_WHILE","while",271],["T_WHITESPACE"," ",271],"(",["T_STRING","true",271],["T_WHITESPACE"," ",271],["T_IS_EQUAL","==",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$buffer",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$handle",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","read",271],"(",["T_LNUMBER","1024",271],")",")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n            ",271],["T_ECHO","echo",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$buffer",272],";",["T_WHITESPACE","\n        ",272],"}",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Use Content-Disposition: attachment\n     *\n     * @param mixed $store\n     * @return bool\n     * @SuppressWarnings(PHPMD.BooleanGetMethodName)\n     *\/",276],["T_WHITESPACE","\n    ",282],["T_PUBLIC","public",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","getContentDisposition",283],"(",["T_VARIABLE","$store",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_STRING","null",283],")",["T_WHITESPACE","\n    ",283],"{",["T_WHITESPACE","\n        ",284],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","scopeConfig",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getValue",285],"(",["T_STRING","self",285],["T_DOUBLE_COLON","::",285],["T_STRING","XML_PATH_CONTENT_DISPOSITION",285],",",["T_WHITESPACE"," ",285],["T_NS_SEPARATOR","\\",285],["T_STRING","Magento",285],["T_NS_SEPARATOR","\\",285],["T_STRING","Store",285],["T_NS_SEPARATOR","\\",285],["T_STRING","Model",285],["T_NS_SEPARATOR","\\",285],["T_STRING","ScopeInterface",285],["T_DOUBLE_COLON","::",285],["T_STRING","SCOPE_STORE",285],",",["T_WHITESPACE"," ",285],["T_VARIABLE","$store",285],")",";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n",286],"}",["T_WHITESPACE","\n",287]]