[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Webapi",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Authorization",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Authorization",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","UserContextInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Integration",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Model",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Oauth",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Token",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Integration",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Oauth",11],["T_NS_SEPARATOR","\\",11],["T_STRING","TokenFactory",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Integration",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","IntegrationServiceInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Webapi",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Request",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * A user context determined by tokens in a HTTP request Authorization header.\n *\/",15],["T_WHITESPACE","\n",17],["T_CLASS","class",18],["T_WHITESPACE"," ",18],["T_STRING","TokenUserContext",18],["T_WHITESPACE"," ",18],["T_IMPLEMENTS","implements",18],["T_WHITESPACE"," ",18],["T_STRING","UserContextInterface",18],["T_WHITESPACE","\n",18],"{",["T_WHITESPACE","\n    ",19],["T_DOC_COMMENT","\/**\n     * @var Request\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$request",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * @var Token\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$tokenFactory",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * @var int\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$userId",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * @var string\n     *\/",35],["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$userType",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * @var bool\n     *\/",40],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$isRequestProcessed",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * @var IntegrationServiceInterface\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$integrationService",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Initialize dependencies.\n     *\n     * @param Request $request\n     * @param TokenFactory $tokenFactory\n     * @param IntegrationServiceInterface $integrationService\n     *\/",50],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","__construct",57],"(",["T_WHITESPACE","\n        ",57],["T_STRING","Request",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$request",58],",",["T_WHITESPACE","\n        ",58],["T_STRING","TokenFactory",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$tokenFactory",59],",",["T_WHITESPACE","\n        ",59],["T_STRING","IntegrationServiceInterface",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$integrationService",60],["T_WHITESPACE","\n    ",60],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","request",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$request",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","tokenFactory",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$tokenFactory",63],";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","integrationService",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$integrationService",64],";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",67],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","getUserId",70],"(",")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","processRequest",72],"(",")",";",["T_WHITESPACE","\n        ",72],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","userId",73],";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",76],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","getUserType",79],"(",")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","processRequest",81],"(",")",";",["T_WHITESPACE","\n        ",81],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","userType",82],";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Finds the bearer token and looks up the value.\n     *\n     * @return void\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_FUNCTION","function",90],["T_WHITESPACE"," ",90],["T_STRING","processRequest",90],"(",")",["T_WHITESPACE","\n    ",90],"{",["T_WHITESPACE","\n        ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","isRequestProcessed",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_RETURN","return",93],";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n\n        ",94],["T_VARIABLE","$authorizationHeaderValue",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","request",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getHeader",96],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorization'",96],")",";",["T_WHITESPACE","\n        ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(","!",["T_VARIABLE","$authorizationHeaderValue",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","isRequestProcessed",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","true",98],";",["T_WHITESPACE","\n            ",98],["T_RETURN","return",99],";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n\n        ",100],["T_VARIABLE","$headerPieces",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","explode",102],"(",["T_CONSTANT_ENCAPSED_STRING","\" \"",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$authorizationHeaderValue",102],")",";",["T_WHITESPACE","\n        ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_STRING","count",103],"(",["T_VARIABLE","$headerPieces",103],")",["T_WHITESPACE"," ",103],["T_IS_NOT_IDENTICAL","!==",103],["T_WHITESPACE"," ",103],["T_LNUMBER","2",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","isRequestProcessed",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","true",104],";",["T_WHITESPACE","\n            ",104],["T_RETURN","return",105],";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$tokenType",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","strtolower",108],"(",["T_VARIABLE","$headerPieces",108],"[",["T_LNUMBER","0",108],"]",")",";",["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$tokenType",109],["T_WHITESPACE"," ",109],["T_IS_NOT_IDENTICAL","!==",109],["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'bearer'",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","isRequestProcessed",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","true",110],";",["T_WHITESPACE","\n            ",110],["T_RETURN","return",111],";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_VARIABLE","$bearerToken",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$headerPieces",114],"[",["T_LNUMBER","1",114],"]",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$token",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","tokenFactory",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","create",115],"(",")",["T_OBJECT_OPERATOR","->",115],["T_STRING","loadByToken",115],"(",["T_VARIABLE","$bearerToken",115],")",";",["T_WHITESPACE","\n\n        ",115],["T_IF","if",117],["T_WHITESPACE"," ",117],"(","!",["T_VARIABLE","$token",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",["T_WHITESPACE"," ",117],["T_BOOLEAN_OR","||",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$token",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getRevoked",117],"(",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","isRequestProcessed",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_STRING","true",118],";",["T_WHITESPACE","\n            ",118],["T_RETURN","return",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","setUserDataViaToken",122],"(",["T_VARIABLE","$token",122],")",";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","isRequestProcessed",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","true",123],";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * @param Token $token\n     * @return void\n     *\/",126],["T_WHITESPACE","\n    ",129],["T_PROTECTED","protected",130],["T_WHITESPACE"," ",130],["T_FUNCTION","function",130],["T_WHITESPACE"," ",130],["T_STRING","setUserDataViaToken",130],"(",["T_STRING","Token",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$token",130],")",["T_WHITESPACE","\n    ",130],"{",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","userType",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$token",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getUserType",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_SWITCH","switch",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","userType",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_CASE","case",134],["T_WHITESPACE"," ",134],["T_STRING","UserContextInterface",134],["T_DOUBLE_COLON","::",134],["T_STRING","USER_TYPE_INTEGRATION",134],":",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","userId",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","integrationService",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","findByConsumerId",135],"(",["T_VARIABLE","$token",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getConsumerId",135],"(",")",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getId",135],"(",")",";",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","userType",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","UserContextInterface",136],["T_DOUBLE_COLON","::",136],["T_STRING","USER_TYPE_INTEGRATION",136],";",["T_WHITESPACE","\n                ",136],["T_BREAK","break",137],";",["T_WHITESPACE","\n            ",137],["T_CASE","case",138],["T_WHITESPACE"," ",138],["T_STRING","UserContextInterface",138],["T_DOUBLE_COLON","::",138],["T_STRING","USER_TYPE_ADMIN",138],":",["T_WHITESPACE","\n                ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","userId",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$token",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getAdminId",139],"(",")",";",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","userType",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","UserContextInterface",140],["T_DOUBLE_COLON","::",140],["T_STRING","USER_TYPE_ADMIN",140],";",["T_WHITESPACE","\n                ",140],["T_BREAK","break",141],";",["T_WHITESPACE","\n            ",141],["T_CASE","case",142],["T_WHITESPACE"," ",142],["T_STRING","UserContextInterface",142],["T_DOUBLE_COLON","::",142],["T_STRING","USER_TYPE_CUSTOMER",142],":",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","userId",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$token",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getCustomerId",143],"(",")",";",["T_WHITESPACE","\n                ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","userType",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","UserContextInterface",144],["T_DOUBLE_COLON","::",144],["T_STRING","USER_TYPE_CUSTOMER",144],";",["T_WHITESPACE","\n                ",144],["T_BREAK","break",145],";",["T_WHITESPACE","\n            ",145],["T_DEFAULT","default",146],":",["T_WHITESPACE","\n                ",146],["T_COMMENT","\/* this is an unknown user type so reset the cached user type *\/",147],["T_WHITESPACE","\n                ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","userType",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","null",148],";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n",150],"}",["T_WHITESPACE","\n",151]]