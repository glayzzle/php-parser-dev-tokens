[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Abstract Rule entity resource model\n *\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Rule",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceModel",12],";",["T_WHITESPACE","\n\n",12],["T_ABSTRACT","abstract",14],["T_WHITESPACE"," ",14],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","AbstractResource",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ResourceModel",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Db",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AbstractDb",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Store associated with rule entities information map\n     *\n     * Example:\n     * array(\n     *    'entity_type1' => array(\n     *        'associations_table' => 'table_name',\n     *        'rule_id_field'      => 'rule_id',\n     *        'entity_id_field'    => 'entity_id'\n     *    ),\n     *    'entity_type2' => array(\n     *        'associations_table' => 'table_name',\n     *        'rule_id_field'      => 'rule_id',\n     *        'entity_id_field'    => 'entity_id'\n     *    )\n     *    ....\n     * )\n     *\n     * @var array\n     *\/",16],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_associatedEntitiesMap",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],"[","]",";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Prepare rule's active \"from\" and \"to\" dates\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @return $this\n     *\/",38],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","_beforeSave",44],"(",["T_NS_SEPARATOR","\\",44],["T_STRING","Magento",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Framework",44],["T_NS_SEPARATOR","\\",44],["T_STRING","Model",44],["T_NS_SEPARATOR","\\",44],["T_STRING","AbstractModel",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$object",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","resolveDate",46],"(",["T_VARIABLE","$object",46],",",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'from_date'",46],")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","resolveDate",47],"(",["T_VARIABLE","$object",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'to_date'",47],")",";",["T_WHITESPACE","\n        ",47],["T_STRING","parent",48],["T_DOUBLE_COLON","::",48],["T_STRING","_beforeSave",48],"(",["T_VARIABLE","$object",48],")",";",["T_WHITESPACE","\n        ",48],["T_RETURN","return",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],";",["T_WHITESPACE","\n    ",49],"}",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @param string $dateIdentifier\n     * @return void\n     *\/",52],["T_WHITESPACE","\n    ",56],["T_PRIVATE","private",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","resolveDate",57],"(",["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Framework",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Model",57],["T_NS_SEPARATOR","\\",57],["T_STRING","AbstractModel",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$object",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$dateIdentifier",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$date",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$object",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getData",59],"(",["T_VARIABLE","$dateIdentifier",59],")",";",["T_WHITESPACE","\n        ",59],["T_IF","if",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$date",60],["T_WHITESPACE"," ",60],["T_INSTANCEOF","instanceof",60],["T_WHITESPACE"," ",60],["T_NS_SEPARATOR","\\",60],["T_STRING","DateTime",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$object",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","setData",61],"(",["T_VARIABLE","$dateIdentifier",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$date",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","format",61],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",61],")",")",";",["T_WHITESPACE","\n        ",61],"}",["T_WHITESPACE"," ",62],["T_ELSEIF","elseif",62],["T_WHITESPACE"," ",62],"(","!",["T_STRING","is_string",62],"(",["T_VARIABLE","$date",62],")",["T_WHITESPACE"," ",62],["T_BOOLEAN_OR","||",62],["T_WHITESPACE"," ",62],["T_EMPTY","empty",62],"(",["T_VARIABLE","$date",62],")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$object",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","setData",63],"(",["T_VARIABLE","$dateIdentifier",63],",",["T_WHITESPACE"," ",63],["T_STRING","null",63],")",";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Bind specified rules to entities\n     *\n     * @param int[]|int|string $ruleIds\n     * @param int[]|int|string $entityIds\n     * @param string $entityType\n     * @return $this\n     * @throws \\Exception\n     *\/",67],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","bindRuleToEntity",76],"(",["T_VARIABLE","$ruleIds",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$entityIds",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$entityType",76],")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getConnection",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","beginTransaction",78],"(",")",";",["T_WHITESPACE","\n\n        ",78],["T_TRY","try",80],["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_multiplyBunchInsert",81],"(",["T_VARIABLE","$ruleIds",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$entityIds",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$entityType",81],")",";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE"," ",82],["T_CATCH","catch",82],["T_WHITESPACE"," ",82],"(",["T_NS_SEPARATOR","\\",82],["T_STRING","Exception",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$e",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getConnection",83],"(",")",["T_OBJECT_OPERATOR","->",83],["T_STRING","rollback",83],"(",")",";",["T_WHITESPACE","\n            ",83],["T_THROW","throw",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$e",84],";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n\n        ",85],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getConnection",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","commit",87],"(",")",";",["T_WHITESPACE","\n\n        ",87],["T_RETURN","return",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Multiply rule ids by entity ids and insert\n     *\n     * @param int|[] $ruleIds\n     * @param int|[] $entityIds\n     * @param string $entityType\n     * @return $this\n     *\/",92],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","_multiplyBunchInsert",100],"(",["T_VARIABLE","$ruleIds",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$entityIds",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$entityType",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_EMPTY","empty",102],"(",["T_VARIABLE","$ruleIds",102],")",["T_WHITESPACE"," ",102],["T_BOOLEAN_OR","||",102],["T_WHITESPACE"," ",102],["T_EMPTY","empty",102],"(",["T_VARIABLE","$entityIds",102],")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(","!",["T_STRING","is_array",105],"(",["T_VARIABLE","$ruleIds",105],")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$ruleIds",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],"[",["T_INT_CAST","(int)",106],["T_VARIABLE","$ruleIds",106],"]",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_IF","if",108],["T_WHITESPACE"," ",108],"(","!",["T_STRING","is_array",108],"(",["T_VARIABLE","$entityIds",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$entityIds",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],"[",["T_INT_CAST","(int)",109],["T_VARIABLE","$entityIds",109],"]",";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$data",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],"[","]",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$count",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_LNUMBER","0",112],";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$entityInfo",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_getAssociatedEntityInfo",113],"(",["T_VARIABLE","$entityType",113],")",";",["T_WHITESPACE","\n        ",113],["T_FOREACH","foreach",114],["T_WHITESPACE"," ",114],"(",["T_VARIABLE","$ruleIds",114],["T_WHITESPACE"," ",114],["T_AS","as",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$ruleId",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_FOREACH","foreach",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$entityIds",115],["T_WHITESPACE"," ",115],["T_AS","as",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$entityId",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$data",116],"[","]",["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],"[",["T_WHITESPACE","\n                    ",116],["T_VARIABLE","$entityInfo",117],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",117],"]",["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$entityId",117],",",["T_WHITESPACE","\n                    ",117],["T_VARIABLE","$entityInfo",118],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",118],"]",["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$ruleId",118],",",["T_WHITESPACE","\n                ",118],"]",";",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$count",120],["T_INC","++",120],";",["T_WHITESPACE","\n                ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$count",121],["T_WHITESPACE"," ",121],"%",["T_WHITESPACE"," ",121],["T_LNUMBER","1000",121],["T_WHITESPACE"," ",121],["T_IS_EQUAL","==",121],["T_WHITESPACE"," ",121],["T_LNUMBER","0",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                    ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getConnection",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","insertOnDuplicate",122],"(",["T_WHITESPACE","\n                        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getTable",123],"(",["T_VARIABLE","$entityInfo",123],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",123],"]",")",",",["T_WHITESPACE","\n                        ",123],["T_VARIABLE","$data",124],",",["T_WHITESPACE","\n                        ",124],"[",["T_VARIABLE","$entityInfo",125],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",125],"]","]",["T_WHITESPACE","\n                    ",125],")",";",["T_WHITESPACE","\n                    ",126],["T_VARIABLE","$data",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],"[","]",";",["T_WHITESPACE","\n                ",127],"}",["T_WHITESPACE","\n            ",128],"}",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n        ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(","!",["T_EMPTY","empty",131],"(",["T_VARIABLE","$data",131],")",")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getConnection",132],"(",")",["T_OBJECT_OPERATOR","->",132],["T_STRING","insertOnDuplicate",132],"(",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getTable",133],"(",["T_VARIABLE","$entityInfo",133],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",133],"]",")",",",["T_WHITESPACE","\n                ",133],["T_VARIABLE","$data",134],",",["T_WHITESPACE","\n                ",134],"[",["T_VARIABLE","$entityInfo",135],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",135],"]","]",["T_WHITESPACE","\n            ",135],")",";",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getConnection",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","delete",139],"(",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getTable",140],"(",["T_VARIABLE","$entityInfo",140],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",140],"]",")",",",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getConnection",141],"(",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","quoteInto",141],"(",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$entityInfo",142],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",142],"]",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","' IN (?) AND '",142],",",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$ruleIds",143],["T_WHITESPACE","\n            ",143],")",["T_WHITESPACE"," ",144],".",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getConnection",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","quoteInto",144],"(",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$entityInfo",145],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",145],"]",["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","' NOT IN (?)'",145],",",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$entityIds",146],["T_WHITESPACE","\n            ",146],")",["T_WHITESPACE","\n        ",147],")",";",["T_WHITESPACE","\n        ",148],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * Unbind specified rules from entities\n     *\n     * @param int[]|int|string $ruleIds\n     * @param int[]|int|string $entityIds\n     * @param string $entityType\n     * @return $this\n     *\/",152],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","unbindRuleFromEntity",160],"(",["T_VARIABLE","$ruleIds",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$entityIds",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$entityType",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$connection",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getConnection",162],"(",")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$entityInfo",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_getAssociatedEntityInfo",163],"(",["T_VARIABLE","$entityType",163],")",";",["T_WHITESPACE","\n\n        ",163],["T_IF","if",165],["T_WHITESPACE"," ",165],"(","!",["T_STRING","is_array",165],"(",["T_VARIABLE","$entityIds",165],")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$entityIds",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],"[",["T_INT_CAST","(int)",166],["T_VARIABLE","$entityIds",166],"]",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(","!",["T_STRING","is_array",168],"(",["T_VARIABLE","$ruleIds",168],")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$ruleIds",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],"[",["T_INT_CAST","(int)",169],["T_VARIABLE","$ruleIds",169],"]",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_VARIABLE","$where",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],"[","]",";",["T_WHITESPACE","\n        ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(","!",["T_EMPTY","empty",173],"(",["T_VARIABLE","$ruleIds",173],")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$where",174],"[","]",["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$connection",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","quoteInto",174],"(",["T_VARIABLE","$entityInfo",174],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",174],"]",["T_WHITESPACE"," ",174],".",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",174],",",["T_WHITESPACE"," ",174],["T_VARIABLE","$ruleIds",174],")",";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n        ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(","!",["T_EMPTY","empty",176],"(",["T_VARIABLE","$entityIds",176],")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$where",177],"[","]",["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$connection",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","quoteInto",177],"(",["T_VARIABLE","$entityInfo",177],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",177],"]",["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$entityIds",177],")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n\n        ",178],["T_VARIABLE","$connection",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","delete",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getTable",180],"(",["T_VARIABLE","$entityInfo",180],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",180],"]",")",",",["T_WHITESPACE"," ",180],["T_STRING","implode",180],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$where",180],")",")",";",["T_WHITESPACE","\n\n        ",180],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Retrieve rule's associated entity Ids by entity type\n     *\n     * @param int $ruleId\n     * @param string $entityType\n     * @return array\n     *\/",185],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","getAssociatedEntityIds",192],"(",["T_VARIABLE","$ruleId",192],",",["T_WHITESPACE"," ",192],["T_VARIABLE","$entityType",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$entityInfo",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getAssociatedEntityInfo",194],"(",["T_VARIABLE","$entityType",194],")",";",["T_WHITESPACE","\n\n        ",194],["T_VARIABLE","$select",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getConnection",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","select",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","from",196],"(",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getTable",197],"(",["T_VARIABLE","$entityInfo",197],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",197],"]",")",",",["T_WHITESPACE","\n            ",197],"[",["T_VARIABLE","$entityInfo",198],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",198],"]","]",["T_WHITESPACE","\n        ",198],")",["T_OBJECT_OPERATOR","->",199],["T_STRING","where",199],"(",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$entityInfo",200],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",200],"]",["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","' = ?'",200],",",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$ruleId",201],["T_WHITESPACE","\n        ",201],")",";",["T_WHITESPACE","\n\n        ",202],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getConnection",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","fetchCol",204],"(",["T_VARIABLE","$select",204],")",";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Retrieve website ids of specified rule\n     *\n     * @param int $ruleId\n     * @return array\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PUBLIC","public",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","getWebsiteIds",213],"(",["T_VARIABLE","$ruleId",213],")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getAssociatedEntityIds",215],"(",["T_VARIABLE","$ruleId",215],",",["T_WHITESPACE"," ",215],["T_CONSTANT_ENCAPSED_STRING","'website'",215],")",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Retrieve customer group ids of specified rule\n     *\n     * @param int $ruleId\n     * @return array\n     *\/",218],["T_WHITESPACE","\n    ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","getCustomerGroupIds",224],"(",["T_VARIABLE","$ruleId",224],")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getAssociatedEntityIds",226],"(",["T_VARIABLE","$ruleId",226],",",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'customer_group'",226],")",";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Retrieve correspondent entity information (associations table name, columns names)\n     * of rule's associated entity by specified entity type\n     *\n     * @param string $entityType\n     * @return array\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",229],["T_WHITESPACE","\n    ",236],["T_PROTECTED","protected",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","_getAssociatedEntityInfo",237],"(",["T_VARIABLE","$entityType",237],")",["T_WHITESPACE","\n    ",237],"{",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_ISSET","isset",239],"(",["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_associatedEntitiesMap",239],"[",["T_VARIABLE","$entityType",239],"]",")",")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_associatedEntitiesMap",240],"[",["T_VARIABLE","$entityType",240],"]",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_THROW","throw",243],["T_WHITESPACE"," ",243],["T_NEW","new",243],["T_WHITESPACE"," ",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Magento",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Framework",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Exception",243],["T_NS_SEPARATOR","\\",243],["T_STRING","LocalizedException",243],"(",["T_WHITESPACE","\n            ",243],["T_STRING","__",244],"(",["T_CONSTANT_ENCAPSED_STRING","'There is no information about associated entity type \"%1\".'",244],",",["T_WHITESPACE"," ",244],["T_VARIABLE","$entityType",244],")",["T_WHITESPACE","\n        ",244],")",";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n",246],"}",["T_WHITESPACE","\n",247]]