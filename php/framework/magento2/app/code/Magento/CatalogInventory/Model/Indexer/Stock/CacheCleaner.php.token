[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * @category    Magento\n * @package     Magento_CatalogInventory\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",7],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","CatalogInventory",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Indexer",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Stock",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CatalogInventory",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","StockConfigurationInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","App",12],["T_NS_SEPARATOR","\\",12],["T_STRING","ResourceConnection",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","DB",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Adapter",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AdapterInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Event",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ManagerInterface",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Indexer",15],["T_NS_SEPARATOR","\\",15],["T_STRING","CacheContext",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","CatalogInventory",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Stock",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Magento",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Catalog",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Model",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Product",17],";",["T_WHITESPACE","\n\n",17],["T_DOC_COMMENT","\/**\n * Clean product cache only when stock status was updated\n *\/",19],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","CacheCleaner",22],["T_WHITESPACE","\n",22],"{",["T_WHITESPACE","\n    ",23],["T_DOC_COMMENT","\/**\n     * @var ResourceConnection\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PRIVATE","private",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$resource",27],";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @var StockConfigurationInterface\n     *\/",29],["T_WHITESPACE","\n    ",31],["T_PRIVATE","private",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$stockConfiguration",32],";",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * @var CacheContext\n     *\/",34],["T_WHITESPACE","\n    ",36],["T_PRIVATE","private",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$cacheContext",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * @var ManagerInterface\n     *\/",39],["T_WHITESPACE","\n    ",41],["T_PRIVATE","private",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$eventManager",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * @var AdapterInterface\n     *\/",44],["T_WHITESPACE","\n    ",46],["T_PRIVATE","private",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$connection",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * @param ResourceConnection $resource\n     * @param StockConfigurationInterface $stockConfiguration\n     * @param CacheContext $cacheContext\n     * @param ManagerInterface $eventManager\n     *\/",49],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","__construct",55],"(",["T_WHITESPACE","\n        ",55],["T_STRING","ResourceConnection",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$resource",56],",",["T_WHITESPACE","\n        ",56],["T_STRING","StockConfigurationInterface",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$stockConfiguration",57],",",["T_WHITESPACE","\n        ",57],["T_STRING","CacheContext",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$cacheContext",58],",",["T_WHITESPACE","\n        ",58],["T_STRING","ManagerInterface",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$eventManager",59],["T_WHITESPACE","\n    ",59],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","resource",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$resource",61],";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","stockConfiguration",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$stockConfiguration",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","cacheContext",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$cacheContext",63],";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","eventManager",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$eventManager",64],";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * @param array $productIds\n     * @param callable $reindex\n     * @return void\n     *\/",67],["T_WHITESPACE","\n    ",71],["T_PUBLIC","public",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","clean",72],"(",["T_ARRAY","array",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$productIds",72],",",["T_WHITESPACE"," ",72],["T_CALLABLE","callable",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$reindex",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$productStatusesBefore",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getProductStockStatuses",74],"(",["T_VARIABLE","$productIds",74],")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$reindex",75],"(",")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$productStatusesAfter",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getProductStockStatuses",76],"(",["T_VARIABLE","$productIds",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$productIds",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getProductIds",77],"(",["T_VARIABLE","$productStatusesBefore",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$productStatusesAfter",77],")",";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$productIds",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","cacheContext",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","registerEntities",79],"(",["T_STRING","Product",79],["T_DOUBLE_COLON","::",79],["T_STRING","CACHE_TAG",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$productIds",79],")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","eventManager",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","dispatch",80],"(",["T_CONSTANT_ENCAPSED_STRING","'clean_cache_by_tags'",80],",",["T_WHITESPACE"," ",80],"[",["T_CONSTANT_ENCAPSED_STRING","'object'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","cacheContext",80],"]",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n    ",81],"}",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * @param array $productIds\n     * @return array\n     *\/",84],["T_WHITESPACE","\n    ",87],["T_PRIVATE","private",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","getProductStockStatuses",88],"(",["T_ARRAY","array",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$productIds",88],")",["T_WHITESPACE","\n    ",88],"{",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$select",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getConnection",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","select",90],"(",")",["T_WHITESPACE","\n            ",90],["T_OBJECT_OPERATOR","->",91],["T_STRING","from",91],"(",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","resource",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTableName",92],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory_stock_status'",92],")",",",["T_WHITESPACE","\n                ",92],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'stock_status'",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'qty'",93],"]",["T_WHITESPACE","\n            ",93],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","where",94],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$productIds",94],")",["T_WHITESPACE","\n            ",94],["T_OBJECT_OPERATOR","->",95],["T_STRING","where",95],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_id = ?'",95],",",["T_WHITESPACE"," ",95],["T_STRING","Stock",95],["T_DOUBLE_COLON","::",95],["T_STRING","DEFAULT_STOCK_ID",95],")",["T_WHITESPACE","\n            ",95],["T_OBJECT_OPERATOR","->",96],["T_STRING","where",96],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id = ?'",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","stockConfiguration",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getDefaultScopeId",96],"(",")",")",";",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$statuses",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],"[","]",";",["T_WHITESPACE","\n        ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getConnection",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","fetchAll",99],"(",["T_VARIABLE","$select",99],")",["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$item",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$statuses",100],"[",["T_VARIABLE","$item",100],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",100],"]","]",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$item",100],";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$statuses",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * @param array $productStatusesBefore\n     * @param array $productStatusesAfter\n     * @return array\n     *\/",105],["T_WHITESPACE","\n    ",109],["T_PRIVATE","private",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","getProductIds",110],"(",["T_ARRAY","array",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$productStatusesBefore",110],",",["T_WHITESPACE"," ",110],["T_ARRAY","array",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$productStatusesAfter",110],")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$productIds",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],"[","]",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$stockThresholdQty",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","stockConfiguration",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getStockThresholdQty",113],"(",")",";",["T_WHITESPACE","\n        ",113],["T_FOREACH","foreach",114],["T_WHITESPACE"," ",114],"(",["T_VARIABLE","$productStatusesBefore",114],["T_WHITESPACE"," ",114],["T_AS","as",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$productId",114],["T_WHITESPACE"," ",114],["T_DOUBLE_ARROW","=>",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$statusBefore",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$statusAfter",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$productStatusesAfter",115],"[",["T_VARIABLE","$productId",115],"]",";",["T_WHITESPACE","\n            ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$statusBefore",116],"[",["T_CONSTANT_ENCAPSED_STRING","'stock_status'",116],"]",["T_WHITESPACE"," ",116],["T_IS_NOT_IDENTICAL","!==",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$statusAfter",116],"[",["T_CONSTANT_ENCAPSED_STRING","'stock_status'",116],"]",["T_WHITESPACE","\n                ",116],["T_BOOLEAN_OR","||",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$stockThresholdQty",117],["T_WHITESPACE"," ",117],["T_BOOLEAN_AND","&&",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$statusAfter",117],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",117],"]",["T_WHITESPACE"," ",117],["T_IS_SMALLER_OR_EQUAL","<=",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$stockThresholdQty",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n                ",117],["T_VARIABLE","$productIds",118],"[","]",["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$productId",118],";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$productIds",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * @return AdapterInterface\n     *\/",125],["T_WHITESPACE","\n    ",127],["T_PRIVATE","private",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","getConnection",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_STRING","null",130],["T_WHITESPACE"," ",130],["T_IS_IDENTICAL","===",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","connection",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","connection",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","resource",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getConnection",131],"(",")",";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","connection",134],";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n",135],"}",["T_WHITESPACE","\n",136]]