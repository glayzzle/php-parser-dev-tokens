[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Media application\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",7],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","MediaStorage",8],["T_NS_SEPARATOR","\\",8],["T_STRING","App",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Framework",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Filesystem",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","MediaStorage",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","File",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Storage",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ConfigFactory",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","MediaStorage",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","File",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Storage",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Response",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","App",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","App",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Filesystem",14],["T_NS_SEPARATOR","\\",14],["T_STRING","DirectoryList",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","AppInterface",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","MediaStorage",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","File",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Storage",16],["T_NS_SEPARATOR","\\",16],["T_STRING","SynchronizationFactory",16],";",["T_WHITESPACE","\n\n",16],["T_DOC_COMMENT","\/**\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",18],["T_WHITESPACE","\n",20],["T_CLASS","class",21],["T_WHITESPACE"," ",21],["T_STRING","Media",21],["T_WHITESPACE"," ",21],["T_IMPLEMENTS","implements",21],["T_WHITESPACE"," ",21],["T_STRING","AppInterface",21],["T_WHITESPACE","\n",21],"{",["T_WHITESPACE","\n    ",22],["T_DOC_COMMENT","\/**\n     * Authorization function\n     *\n     * @var \\Closure\n     *\/",23],["T_WHITESPACE","\n    ",27],["T_PRIVATE","private",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$isAllowed",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Media directory path\n     *\n     * @var string\n     *\/",30],["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$mediaDirectoryPath",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Configuration cache file path\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PRIVATE","private",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$configCacheFile",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Requested file name relative to working directory\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PRIVATE","private",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$relativeFileName",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * @var Response\n     *\/",51],["T_WHITESPACE","\n    ",53],["T_PRIVATE","private",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$response",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Filesystem\\Directory\\WriteInterface\n     *\/",56],["T_WHITESPACE","\n    ",58],["T_PRIVATE","private",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$directory",59],";",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * @var ConfigFactory\n     *\/",61],["T_WHITESPACE","\n    ",63],["T_PRIVATE","private",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$configFactory",64],";",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * @var SynchronizationFactory\n     *\/",66],["T_WHITESPACE","\n    ",68],["T_PRIVATE","private",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$syncFactory",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * @param ConfigFactory $configFactory\n     * @param SynchronizationFactory $syncFactory\n     * @param Response $response\n     * @param \\Closure $isAllowed\n     * @param string $mediaDirectory\n     * @param string $configCacheFile\n     * @param string $relativeFileName\n     * @param Filesystem $filesystem\n     *\/",71],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","__construct",81],"(",["T_WHITESPACE","\n        ",81],["T_STRING","ConfigFactory",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$configFactory",82],",",["T_WHITESPACE","\n        ",82],["T_STRING","SynchronizationFactory",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$syncFactory",83],",",["T_WHITESPACE","\n        ",83],["T_STRING","Response",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$response",84],",",["T_WHITESPACE","\n        ",84],["T_NS_SEPARATOR","\\",85],["T_STRING","Closure",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$isAllowed",85],",",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$mediaDirectory",86],",",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$configCacheFile",87],",",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$relativeFileName",88],",",["T_WHITESPACE","\n        ",88],["T_STRING","Filesystem",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$filesystem",89],["T_WHITESPACE","\n    ",89],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","response",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$response",91],";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","isAllowed",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$isAllowed",92],";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","directory",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$filesystem",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getDirectoryWrite",93],"(",["T_STRING","DirectoryList",93],["T_DOUBLE_COLON","::",93],["T_STRING","MEDIA",93],")",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$mediaDirectory",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","trim",94],"(",["T_VARIABLE","$mediaDirectory",94],")",";",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_EMPTY","empty",95],"(",["T_VARIABLE","$mediaDirectory",95],")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","mediaDirectoryPath",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","str_replace",96],"(",["T_CONSTANT_ENCAPSED_STRING","'\\\\'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'\/'",96],",",["T_WHITESPACE"," ",96],["T_STRING","realpath",96],"(",["T_VARIABLE","$mediaDirectory",96],")",")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","configCacheFile",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$configCacheFile",98],";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","relativeFileName",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$relativeFileName",99],";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","configFactory",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$configFactory",100],";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","syncFactory",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$syncFactory",101],";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Run application\n     *\n     * @return Response\n     * @throws \\LogicException\n     *\/",104],["T_WHITESPACE","\n    ",109],["T_PUBLIC","public",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","launch",110],"(",")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","mediaDirectoryPath",112],["T_WHITESPACE"," ",112],["T_IS_NOT_IDENTICAL","!==",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","directory",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getAbsolutePath",112],"(",")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_COMMENT","\/\/ Path to media directory changed or absent - update the config\n",113],["T_WHITESPACE","            ",114],["T_DOC_COMMENT","\/** @var \\Magento\\MediaStorage\\Model\\File\\Storage\\Config $config *\/",114],["T_WHITESPACE","\n            ",114],["T_VARIABLE","$config",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","configFactory",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","create",115],"(","[",["T_CONSTANT_ENCAPSED_STRING","'cacheFile'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","configCacheFile",115],"]",")",";",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$config",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","save",116],"(",")",";",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","mediaDirectoryPath",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$config",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getMediaDirectory",117],"(",")",";",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$allowedResources",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getAllowedResources",118],"(",")",";",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$isAllowed",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","isAllowed",119],";",["T_WHITESPACE","\n            ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(","!",["T_VARIABLE","$isAllowed",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","relativeFileName",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$allowedResources",120],")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n                ",120],["T_THROW","throw",121],["T_WHITESPACE"," ",121],["T_NEW","new",121],["T_WHITESPACE"," ",121],["T_NS_SEPARATOR","\\",121],["T_STRING","LogicException",121],"(",["T_CONSTANT_ENCAPSED_STRING","'The specified path is not allowed.'",121],")",";",["T_WHITESPACE","\n            ",121],"}",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n\n        ",123],["T_DOC_COMMENT","\/** @var \\Magento\\MediaStorage\\Model\\File\\Storage\\Synchronization $sync *\/",125],["T_WHITESPACE","\n        ",125],["T_VARIABLE","$sync",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","syncFactory",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","create",126],"(","[",["T_CONSTANT_ENCAPSED_STRING","'directory'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","directory",126],"]",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$sync",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","synchronize",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","relativeFileName",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","directory",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","isReadable",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","relativeFileName",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","response",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setFilePath",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","directory",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getAbsolutePath",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","relativeFileName",130],")",")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE"," ",131],["T_ELSE","else",131],["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","response",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","setHttpResponseCode",132],"(",["T_LNUMBER","404",132],")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n        ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","response",134],";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",137],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","catchException",140],"(",["T_STRING","App",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Bootstrap",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$bootstrap",140],",",["T_WHITESPACE"," ",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Exception",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$exception",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","response",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","setHttpResponseCode",142],"(",["T_LNUMBER","404",142],")",";",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$bootstrap",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","isDeveloperMode",143],"(",")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","response",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setHeader",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type'",144],",",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'text\/plain'",144],")",";",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","response",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","setBody",145],"(",["T_VARIABLE","$exception",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getMessage",145],"(",")",["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",145],["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],["T_VARIABLE","$exception",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getTraceAsString",145],"(",")",")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","response",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","sendResponse",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_STRING","true",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n",149],"}",["T_WHITESPACE","\n",150]]