[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Core file uploader model\n *\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","MediaStorage",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","File",12],";",["T_WHITESPACE","\n\n",12],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","Uploader",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","File",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Uploader",14],["T_WHITESPACE","\n",14],"{",["T_WHITESPACE","\n    ",15],["T_DOC_COMMENT","\/**\n     * Flag, that defines should DB processing be skipped\n     *\n     * @var bool\n     *\/",16],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$_skipDbProcessing",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_STRING","false",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * Core file storage\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\n     *\/",23],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$_coreFileStorage",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_STRING","null",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Core file storage database\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database\n     *\/",30],["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$_coreFileStorageDb",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_STRING","null",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\MediaStorage\\Model\\File\\Validator\\NotProtectedExtension\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_validator",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @param string $fileId\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage\\Database $coreFileStorageDb\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage $coreFileStorage\n     * @param \\Magento\\MediaStorage\\Model\\File\\Validator\\NotProtectedExtension $validator\n     *\/",42],["T_WHITESPACE","\n    ",47],["T_PUBLIC","public",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","__construct",48],"(",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$fileId",49],",",["T_WHITESPACE","\n        ",49],["T_NS_SEPARATOR","\\",50],["T_STRING","Magento",50],["T_NS_SEPARATOR","\\",50],["T_STRING","MediaStorage",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Helper",50],["T_NS_SEPARATOR","\\",50],["T_STRING","File",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Storage",50],["T_NS_SEPARATOR","\\",50],["T_STRING","Database",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$coreFileStorageDb",50],",",["T_WHITESPACE","\n        ",50],["T_NS_SEPARATOR","\\",51],["T_STRING","Magento",51],["T_NS_SEPARATOR","\\",51],["T_STRING","MediaStorage",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Helper",51],["T_NS_SEPARATOR","\\",51],["T_STRING","File",51],["T_NS_SEPARATOR","\\",51],["T_STRING","Storage",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$coreFileStorage",51],",",["T_WHITESPACE","\n        ",51],["T_NS_SEPARATOR","\\",52],["T_STRING","Magento",52],["T_NS_SEPARATOR","\\",52],["T_STRING","MediaStorage",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Model",52],["T_NS_SEPARATOR","\\",52],["T_STRING","File",52],["T_NS_SEPARATOR","\\",52],["T_STRING","Validator",52],["T_NS_SEPARATOR","\\",52],["T_STRING","NotProtectedExtension",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$validator",52],["T_WHITESPACE","\n    ",52],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_coreFileStorageDb",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$coreFileStorageDb",54],";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_coreFileStorage",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$coreFileStorage",55],";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_validator",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$validator",56],";",["T_WHITESPACE","\n        ",56],["T_STRING","parent",57],["T_DOUBLE_COLON","::",57],["T_STRING","__construct",57],"(",["T_VARIABLE","$fileId",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Save file to storage\n     *\n     * @param  array $result\n     * @return $this\n     *\/",60],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","_afterSave",66],"(",["T_VARIABLE","$result",66],")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_EMPTY","empty",68],"(",["T_VARIABLE","$result",68],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",68],"]",")",["T_WHITESPACE"," ",68],["T_BOOLEAN_OR","||",68],["T_WHITESPACE"," ",68],["T_EMPTY","empty",68],"(",["T_VARIABLE","$result",68],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",68],"]",")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_IF","if",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_coreFileStorage",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","isInternalStorage",72],"(",")",["T_WHITESPACE"," ",72],["T_BOOLEAN_OR","||",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","skipDbProcessing",72],"(",")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n\n        ",74],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_result",76],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",76],"]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_coreFileStorageDb",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","saveUploadedFile",76],"(",["T_VARIABLE","$result",76],")",";",["T_WHITESPACE","\n\n        ",76],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Getter\/Setter for _skipDbProcessing flag\n     *\n     * @param null|bool $flag\n     * @return bool|\\Magento\\MediaStorage\\Model\\File\\Uploader\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","skipDbProcessing",87],"(",["T_VARIABLE","$flag",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","null",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$flag",89],["T_WHITESPACE"," ",89],["T_IS_IDENTICAL","===",89],["T_WHITESPACE"," ",89],["T_STRING","null",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_skipDbProcessing",90],";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_skipDbProcessing",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_BOOL_CAST","(bool)",92],["T_VARIABLE","$flag",92],";",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Check protected\/allowed extension\n     *\n     * @param string $extension\n     * @return boolean\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","checkAllowedExtension",102],"(",["T_VARIABLE","$extension",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_COMMENT","\/\/validate with protected file types\n",104],["T_WHITESPACE","        ",105],["T_IF","if",105],["T_WHITESPACE"," ",105],"(","!",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_validator",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","isValid",105],"(",["T_VARIABLE","$extension",105],")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_STRING","false",106],";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n\n        ",107],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_STRING","parent",109],["T_DOUBLE_COLON","::",109],["T_STRING","checkAllowedExtension",109],"(",["T_VARIABLE","$extension",109],")",";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Get file size\n     *\n     * @return int\n     *\/",112],["T_WHITESPACE","\n    ",116],["T_PUBLIC","public",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","getFileSize",117],"(",")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_file",119],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",119],"]",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Validate file\n     *\n     * @return array\n     *\/",122],["T_WHITESPACE","\n    ",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","validateFile",127],"(",")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_validateFile",129],"(",")",";",["T_WHITESPACE","\n        ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_file",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n",131],"}",["T_WHITESPACE","\n",132]]