[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",7],["T_WHITESPACE","\n",8],["T_NAMESPACE","namespace",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","MediaStorage",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","File",9],";",["T_WHITESPACE","\n\n",9],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Framework",11],["T_NS_SEPARATOR","\\",11],["T_STRING","App",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Filesystem",11],["T_NS_SEPARATOR","\\",11],["T_STRING","DirectoryList",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Framework",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Filesystem",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Framework",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","AbstractModel",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * Class Storage\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",15],["T_WHITESPACE","\n",18],["T_CLASS","class",19],["T_WHITESPACE"," ",19],["T_STRING","Storage",19],["T_WHITESPACE"," ",19],["T_EXTENDS","extends",19],["T_WHITESPACE"," ",19],["T_STRING","AbstractModel",19],["T_WHITESPACE","\n",19],"{",["T_WHITESPACE","\n    ",20],["T_DOC_COMMENT","\/**\n     * Storage systems ids\n     *\/",21],["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","STORAGE_MEDIA_FILE_SYSTEM",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_LNUMBER","0",24],";",["T_WHITESPACE","\n\n    ",24],["T_CONST","const",26],["T_WHITESPACE"," ",26],["T_STRING","STORAGE_MEDIA_DATABASE",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_LNUMBER","1",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * Config paths for storing storage configuration\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_CONST","const",31],["T_WHITESPACE"," ",31],["T_STRING","XML_PATH_STORAGE_MEDIA",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'system\/media_storage_configuration\/media_storage'",31],";",["T_WHITESPACE","\n\n    ",31],["T_CONST","const",33],["T_WHITESPACE"," ",33],["T_STRING","XML_PATH_STORAGE_MEDIA_DATABASE",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'system\/media_storage_configuration\/media_database'",33],";",["T_WHITESPACE","\n\n    ",33],["T_CONST","const",35],["T_WHITESPACE"," ",35],["T_STRING","XML_PATH_MEDIA_RESOURCE_WHITELIST",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'system\/media_storage_configuration\/allowed_resources'",35],";",["T_WHITESPACE","\n\n    ",35],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","XML_PATH_MEDIA_UPDATE_TIME",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'system\/media_storage_configuration\/configuration_update_time'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Prefix of model events names\n     *\n     * @var string\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_eventPrefix",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'media_storage_file_storage'",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Core file storage\n     *\n     * @var \\Magento\\MediaStorage\\Helper\\File\\Storage\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_coreFileStorage",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","null",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Core store config\n     *\n     * @var \\Magento\\Framework\\App\\Config\\ScopeConfigInterface\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_scopeConfig",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\Config\\ScopeConfigInterface\n     *\/",60],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_coreConfig",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Core file storage flag\n     *\n     * @var \\Magento\\MediaStorage\\Model\\File\\Storage\\Flag\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_fileFlag",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * File factory\n     *\n     * @var \\Magento\\MediaStorage\\Model\\File\\Storage\\FileFactory\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_fileFactory",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\MediaStorage\\Model\\File\\Storage\\DatabaseFactory\n     *\/",79],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$_databaseFactory",82],";",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * Filesystem instance\n     *\n     * @var Filesystem\n     *\/",84],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$filesystem",89],";",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\Context $context\n     * @param \\Magento\\Framework\\Registry $registry\n     * @param \\Magento\\MediaStorage\\Helper\\File\\Storage $coreFileStorage\n     * @param \\Magento\\Framework\\App\\Config\\ScopeConfigInterface $scopeConfig\n     * @param \\Magento\\Framework\\App\\Config\\ScopeConfigInterface $coreConfig\n     * @param \\Magento\\MediaStorage\\Model\\File\\Storage\\Flag $fileFlag\n     * @param \\Magento\\MediaStorage\\Model\\File\\Storage\\FileFactory $fileFactory\n     * @param \\Magento\\MediaStorage\\Model\\File\\Storage\\DatabaseFactory $databaseFactory\n     * @param Filesystem $filesystem\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\AbstractResource $resource\n     * @param \\Magento\\Framework\\Data\\Collection\\AbstractDb $resourceCollection\n     * @param array $data\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",91],["T_WHITESPACE","\n    ",105],["T_PUBLIC","public",106],["T_WHITESPACE"," ",106],["T_FUNCTION","function",106],["T_WHITESPACE"," ",106],["T_STRING","__construct",106],"(",["T_WHITESPACE","\n        ",106],["T_NS_SEPARATOR","\\",107],["T_STRING","Magento",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Framework",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Model",107],["T_NS_SEPARATOR","\\",107],["T_STRING","Context",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$context",107],",",["T_WHITESPACE","\n        ",107],["T_NS_SEPARATOR","\\",108],["T_STRING","Magento",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Framework",108],["T_NS_SEPARATOR","\\",108],["T_STRING","Registry",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$registry",108],",",["T_WHITESPACE","\n        ",108],["T_NS_SEPARATOR","\\",109],["T_STRING","Magento",109],["T_NS_SEPARATOR","\\",109],["T_STRING","MediaStorage",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Helper",109],["T_NS_SEPARATOR","\\",109],["T_STRING","File",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Storage",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$coreFileStorage",109],",",["T_WHITESPACE","\n        ",109],["T_NS_SEPARATOR","\\",110],["T_STRING","Magento",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Framework",110],["T_NS_SEPARATOR","\\",110],["T_STRING","App",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Config",110],["T_NS_SEPARATOR","\\",110],["T_STRING","ScopeConfigInterface",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$scopeConfig",110],",",["T_WHITESPACE","\n        ",110],["T_NS_SEPARATOR","\\",111],["T_STRING","Magento",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Framework",111],["T_NS_SEPARATOR","\\",111],["T_STRING","App",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Config",111],["T_NS_SEPARATOR","\\",111],["T_STRING","ScopeConfigInterface",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$coreConfig",111],",",["T_WHITESPACE","\n        ",111],["T_NS_SEPARATOR","\\",112],["T_STRING","Magento",112],["T_NS_SEPARATOR","\\",112],["T_STRING","MediaStorage",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Model",112],["T_NS_SEPARATOR","\\",112],["T_STRING","File",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Storage",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Flag",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$fileFlag",112],",",["T_WHITESPACE","\n        ",112],["T_NS_SEPARATOR","\\",113],["T_STRING","Magento",113],["T_NS_SEPARATOR","\\",113],["T_STRING","MediaStorage",113],["T_NS_SEPARATOR","\\",113],["T_STRING","Model",113],["T_NS_SEPARATOR","\\",113],["T_STRING","File",113],["T_NS_SEPARATOR","\\",113],["T_STRING","Storage",113],["T_NS_SEPARATOR","\\",113],["T_STRING","FileFactory",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$fileFactory",113],",",["T_WHITESPACE","\n        ",113],["T_NS_SEPARATOR","\\",114],["T_STRING","Magento",114],["T_NS_SEPARATOR","\\",114],["T_STRING","MediaStorage",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Model",114],["T_NS_SEPARATOR","\\",114],["T_STRING","File",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Storage",114],["T_NS_SEPARATOR","\\",114],["T_STRING","DatabaseFactory",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$databaseFactory",114],",",["T_WHITESPACE","\n        ",114],["T_STRING","Filesystem",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$filesystem",115],",",["T_WHITESPACE","\n        ",115],["T_NS_SEPARATOR","\\",116],["T_STRING","Magento",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Framework",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Model",116],["T_NS_SEPARATOR","\\",116],["T_STRING","ResourceModel",116],["T_NS_SEPARATOR","\\",116],["T_STRING","AbstractResource",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$resource",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","null",116],",",["T_WHITESPACE","\n        ",116],["T_NS_SEPARATOR","\\",117],["T_STRING","Magento",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Framework",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Data",117],["T_NS_SEPARATOR","\\",117],["T_STRING","Collection",117],["T_NS_SEPARATOR","\\",117],["T_STRING","AbstractDb",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$resourceCollection",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","null",117],",",["T_WHITESPACE","\n        ",117],["T_ARRAY","array",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$data",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],"[","]",["T_WHITESPACE","\n    ",118],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_coreFileStorage",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$coreFileStorage",120],";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_scopeConfig",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$scopeConfig",121],";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_coreConfig",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$coreConfig",122],";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_fileFlag",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$fileFlag",123],";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_fileFactory",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$fileFactory",124],";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_databaseFactory",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$databaseFactory",125],";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","filesystem",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$filesystem",126],";",["T_WHITESPACE","\n        ",126],["T_STRING","parent",127],["T_DOUBLE_COLON","::",127],["T_STRING","__construct",127],"(",["T_VARIABLE","$context",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$registry",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$resource",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$resourceCollection",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$data",127],")",";",["T_WHITESPACE","\n    ",127],"}",["T_WHITESPACE","\n\n    ",128],["T_DOC_COMMENT","\/**\n     * Show if there were errors while synchronize process\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $sourceModel\n     * @param \\Magento\\Framework\\Model\\AbstractModel $destinationModel\n     * @return bool\n     *\/",130],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","_synchronizeHasErrors",137],"(",["T_VARIABLE","$sourceModel",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$destinationModel",137],")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(","!",["T_VARIABLE","$sourceModel",139],["T_WHITESPACE"," ",139],["T_BOOLEAN_OR","||",139],["T_WHITESPACE"," ",139],"!",["T_VARIABLE","$destinationModel",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_STRING","true",140],";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$sourceModel",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","hasErrors",143],"(",")",["T_WHITESPACE"," ",143],["T_BOOLEAN_OR","||",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$destinationModel",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","hasErrors",143],"(",")",";",["T_WHITESPACE","\n    ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Return synchronize process status flag\n     *\n     * @return \\Magento\\MediaStorage\\Model\\File\\Storage\\Flag\n     *\/",146],["T_WHITESPACE","\n    ",150],["T_PUBLIC","public",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","getSyncFlag",151],"(",")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_fileFlag",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","loadSelf",153],"(",")",";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Retrieve storage model\n     * If storage not defined - retrieve current storage\n     *\n     * params = array(\n     *  connection  => string,  - define connection for model if needed\n     *  init        => bool     - force initialization process for storage model\n     * )\n     *\n     * @param  int|null $storage\n     * @param  array $params\n     * @return AbstractModel|bool\n     *\/",156],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","getStorageModel",169],"(",["T_VARIABLE","$storage",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_STRING","null",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$params",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],"[","]",")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_STRING","is_null",171],"(",["T_VARIABLE","$storage",171],")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$storage",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_coreFileStorage",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getCurrentStorageCode",172],"(",")",";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n\n        ",173],["T_SWITCH","switch",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$storage",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_CASE","case",176],["T_WHITESPACE"," ",176],["T_STRING","self",176],["T_DOUBLE_COLON","::",176],["T_STRING","STORAGE_MEDIA_FILE_SYSTEM",176],":",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$model",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_fileFactory",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","create",177],"(",")",";",["T_WHITESPACE","\n                ",177],["T_BREAK","break",178],";",["T_WHITESPACE","\n            ",178],["T_CASE","case",179],["T_WHITESPACE"," ",179],["T_STRING","self",179],["T_DOUBLE_COLON","::",179],["T_STRING","STORAGE_MEDIA_DATABASE",179],":",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$connection",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_ISSET","isset",180],"(",["T_VARIABLE","$params",180],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",180],"]",")",["T_WHITESPACE"," ",180],"?",["T_WHITESPACE"," ",180],["T_VARIABLE","$params",180],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",180],"]",["T_WHITESPACE"," ",180],":",["T_WHITESPACE"," ",180],["T_STRING","null",180],";",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$model",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_databaseFactory",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","create",181],"(","[",["T_CONSTANT_ENCAPSED_STRING","'connectionName'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$connection",181],"]",")",";",["T_WHITESPACE","\n                ",181],["T_BREAK","break",182],";",["T_WHITESPACE","\n            ",182],["T_DEFAULT","default",183],":",["T_WHITESPACE","\n                ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_STRING","false",184],";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n\n        ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_ISSET","isset",187],"(",["T_VARIABLE","$params",187],"[",["T_CONSTANT_ENCAPSED_STRING","'init'",187],"]",")",["T_WHITESPACE"," ",187],["T_BOOLEAN_AND","&&",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$params",187],"[",["T_CONSTANT_ENCAPSED_STRING","'init'",187],"]",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$model",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","init",188],"(",")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n\n        ",189],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$model",191],";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n\n    ",192],["T_DOC_COMMENT","\/**\n     * Synchronize current media storage with defined\n     * $storage = array(\n     *  type        => int\n     *  connection  => string\n     * )\n     *\n     * @param  array $storage\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.NPathComplexity)\n     *\/",194],["T_WHITESPACE","\n    ",205],["T_PUBLIC","public",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","synchronize",206],"(",["T_VARIABLE","$storage",206],")",["T_WHITESPACE","\n    ",206],"{",["T_WHITESPACE","\n        ",207],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_STRING","is_array",208],"(",["T_VARIABLE","$storage",208],")",["T_WHITESPACE"," ",208],["T_BOOLEAN_AND","&&",208],["T_WHITESPACE"," ",208],["T_ISSET","isset",208],"(",["T_VARIABLE","$storage",208],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",208],"]",")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$storageDest",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_INT_CAST","(int)",209],["T_VARIABLE","$storage",209],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",209],"]",";",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$connection",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ISSET","isset",210],"(",["T_VARIABLE","$storage",210],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",210],"]",")",["T_WHITESPACE"," ",210],"?",["T_WHITESPACE"," ",210],["T_VARIABLE","$storage",210],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",210],"]",["T_WHITESPACE"," ",210],":",["T_WHITESPACE"," ",210],["T_STRING","null",210],";",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$helper",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_coreFileStorage",211],";",["T_WHITESPACE","\n\n            ",211],["T_COMMENT","\/\/ if unable to sync to internal storage from itself\n",213],["T_WHITESPACE","            ",214],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$storageDest",214],["T_WHITESPACE"," ",214],["T_IS_EQUAL","==",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$helper",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getCurrentStorageCode",214],"(",")",["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$helper",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","isInternalStorage",214],"(",")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],";",["T_WHITESPACE","\n            ",215],"}",["T_WHITESPACE","\n\n            ",216],["T_VARIABLE","$sourceModel",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getStorageModel",218],"(",")",";",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$destinationModel",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getStorageModel",219],"(",["T_WHITESPACE","\n                ",219],["T_VARIABLE","$storageDest",220],",",["T_WHITESPACE","\n                ",220],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",221],["T_WHITESPACE"," ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$connection",221],",",["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","'init'",221],["T_WHITESPACE"," ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_STRING","true",221],"]",["T_WHITESPACE","\n            ",221],")",";",["T_WHITESPACE","\n\n            ",222],["T_IF","if",224],["T_WHITESPACE"," ",224],"(","!",["T_VARIABLE","$sourceModel",224],["T_WHITESPACE"," ",224],["T_BOOLEAN_OR","||",224],["T_WHITESPACE"," ",224],"!",["T_VARIABLE","$destinationModel",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n\n            ",226],["T_VARIABLE","$hasErrors",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","false",228],";",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$flag",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getSyncFlag",229],"(",")",";",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$flagData",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],"[",["T_WHITESPACE","\n                ",230],["T_CONSTANT_ENCAPSED_STRING","'source'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$sourceModel",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getStorageName",231],"(",")",",",["T_WHITESPACE","\n                ",231],["T_CONSTANT_ENCAPSED_STRING","'destination'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$destinationModel",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getStorageName",232],"(",")",",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'destination_storage_type'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$storageDest",233],",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'destination_connection_name'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_STRING_CAST","(string)",234],["T_VARIABLE","$destinationModel",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getConnectionName",234],"(",")",",",["T_WHITESPACE","\n                ",234],["T_CONSTANT_ENCAPSED_STRING","'has_errors'",235],["T_WHITESPACE"," ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],["T_STRING","false",235],",",["T_WHITESPACE","\n                ",235],["T_CONSTANT_ENCAPSED_STRING","'timeout_reached'",236],["T_WHITESPACE"," ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_STRING","false",236],",",["T_WHITESPACE","\n            ",236],"]",";",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$flag",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setFlagData",238],"(",["T_VARIABLE","$flagData",238],")",";",["T_WHITESPACE","\n\n            ",238],["T_VARIABLE","$destinationModel",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","clear",240],"(",")",";",["T_WHITESPACE","\n\n            ",240],["T_VARIABLE","$offset",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_LNUMBER","0",242],";",["T_WHITESPACE","\n            ",242],["T_WHILE","while",243],["T_WHITESPACE"," ",243],"(","(",["T_VARIABLE","$dirs",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$sourceModel",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","exportDirectories",243],"(",["T_VARIABLE","$offset",243],")",")",["T_WHITESPACE"," ",243],["T_IS_NOT_IDENTICAL","!==",243],["T_WHITESPACE"," ",243],["T_STRING","false",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_VARIABLE","$flagData",244],"[",["T_CONSTANT_ENCAPSED_STRING","'timeout_reached'",244],"]",["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_STRING","false",244],";",["T_WHITESPACE","\n                ",244],["T_IF","if",245],["T_WHITESPACE"," ",245],"(","!",["T_VARIABLE","$hasErrors",245],")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n                    ",245],["T_VARIABLE","$hasErrors",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_synchronizeHasErrors",246],"(",["T_VARIABLE","$sourceModel",246],",",["T_WHITESPACE"," ",246],["T_VARIABLE","$destinationModel",246],")",";",["T_WHITESPACE","\n                    ",246],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_VARIABLE","$hasErrors",247],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n                        ",247],["T_VARIABLE","$flagData",248],"[",["T_CONSTANT_ENCAPSED_STRING","'has_errors'",248],"]",["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","true",248],";",["T_WHITESPACE","\n                    ",248],"}",["T_WHITESPACE","\n                ",249],"}",["T_WHITESPACE","\n\n                ",250],["T_VARIABLE","$flag",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","setFlagData",252],"(",["T_VARIABLE","$flagData",252],")",["T_OBJECT_OPERATOR","->",252],["T_STRING","save",252],"(",")",";",["T_WHITESPACE","\n\n                ",252],["T_VARIABLE","$destinationModel",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","importDirectories",254],"(",["T_VARIABLE","$dirs",254],")",";",["T_WHITESPACE","\n                ",254],["T_VARIABLE","$offset",255],["T_WHITESPACE"," ",255],["T_PLUS_EQUAL","+=",255],["T_WHITESPACE"," ",255],["T_STRING","count",255],"(",["T_VARIABLE","$dirs",255],")",";",["T_WHITESPACE","\n            ",255],"}",["T_WHITESPACE","\n            ",256],["T_UNSET","unset",257],"(",["T_VARIABLE","$dirs",257],")",";",["T_WHITESPACE","\n\n            ",257],["T_VARIABLE","$offset",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_LNUMBER","0",259],";",["T_WHITESPACE","\n            ",259],["T_WHILE","while",260],["T_WHITESPACE"," ",260],"(","(",["T_VARIABLE","$files",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$sourceModel",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","exportFiles",260],"(",["T_VARIABLE","$offset",260],",",["T_WHITESPACE"," ",260],["T_LNUMBER","1",260],")",")",["T_WHITESPACE"," ",260],["T_IS_NOT_IDENTICAL","!==",260],["T_WHITESPACE"," ",260],["T_STRING","false",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$flagData",261],"[",["T_CONSTANT_ENCAPSED_STRING","'timeout_reached'",261],"]",["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","false",261],";",["T_WHITESPACE","\n                ",261],["T_IF","if",262],["T_WHITESPACE"," ",262],"(","!",["T_VARIABLE","$hasErrors",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n                    ",262],["T_VARIABLE","$hasErrors",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_synchronizeHasErrors",263],"(",["T_VARIABLE","$sourceModel",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$destinationModel",263],")",";",["T_WHITESPACE","\n                    ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$hasErrors",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                        ",264],["T_VARIABLE","$flagData",265],"[",["T_CONSTANT_ENCAPSED_STRING","'has_errors'",265],"]",["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","true",265],";",["T_WHITESPACE","\n                    ",265],"}",["T_WHITESPACE","\n                ",266],"}",["T_WHITESPACE","\n\n                ",267],["T_VARIABLE","$flag",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","setFlagData",269],"(",["T_VARIABLE","$flagData",269],")",["T_OBJECT_OPERATOR","->",269],["T_STRING","save",269],"(",")",";",["T_WHITESPACE","\n\n                ",269],["T_VARIABLE","$destinationModel",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","importFiles",271],"(",["T_VARIABLE","$files",271],")",";",["T_WHITESPACE","\n                ",271],["T_VARIABLE","$offset",272],["T_WHITESPACE"," ",272],["T_PLUS_EQUAL","+=",272],["T_WHITESPACE"," ",272],["T_STRING","count",272],"(",["T_VARIABLE","$files",272],")",";",["T_WHITESPACE","\n            ",272],"}",["T_WHITESPACE","\n            ",273],["T_UNSET","unset",274],"(",["T_VARIABLE","$files",274],")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],";",["T_WHITESPACE","\n    ",277],"}",["T_WHITESPACE","\n\n    ",278],["T_DOC_COMMENT","\/**\n     * Return current media directory, allowed resources for get.php script, etc.\n     *\n     * @return array\n     *\/",280],["T_WHITESPACE","\n    ",284],["T_PUBLIC","public",285],["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],["T_STRING","getScriptConfig",285],"(",")",["T_WHITESPACE","\n    ",285],"{",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$config",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],"[","]",";",["T_WHITESPACE","\n        ",287],["T_VARIABLE","$config",288],"[",["T_CONSTANT_ENCAPSED_STRING","'media_directory'",288],"]",["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","filesystem",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getDirectoryRead",288],"(",["T_STRING","DirectoryList",288],["T_DOUBLE_COLON","::",288],["T_STRING","MEDIA",288],")",["T_OBJECT_OPERATOR","->",288],["T_STRING","getAbsolutePath",288],"(",")",";",["T_WHITESPACE","\n\n        ",288],["T_VARIABLE","$allowedResources",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_coreConfig",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getValue",290],"(",["T_STRING","self",290],["T_DOUBLE_COLON","::",290],["T_STRING","XML_PATH_MEDIA_RESOURCE_WHITELIST",290],",",["T_WHITESPACE"," ",290],["T_CONSTANT_ENCAPSED_STRING","'default'",290],")",";",["T_WHITESPACE","\n        ",290],["T_FOREACH","foreach",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$allowedResources",291],["T_WHITESPACE"," ",291],["T_AS","as",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$allowedResource",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$config",292],"[",["T_CONSTANT_ENCAPSED_STRING","'allowed_resources'",292],"]","[","]",["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$allowedResource",292],";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n\n        ",293],["T_VARIABLE","$config",295],"[",["T_CONSTANT_ENCAPSED_STRING","'update_time'",295],"]",["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_scopeConfig",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getValue",295],"(",["T_STRING","self",295],["T_DOUBLE_COLON","::",295],["T_STRING","XML_PATH_MEDIA_UPDATE_TIME",295],",",["T_WHITESPACE"," ",295],["T_NS_SEPARATOR","\\",295],["T_STRING","Magento",295],["T_NS_SEPARATOR","\\",295],["T_STRING","Store",295],["T_NS_SEPARATOR","\\",295],["T_STRING","Model",295],["T_NS_SEPARATOR","\\",295],["T_STRING","ScopeInterface",295],["T_DOUBLE_COLON","::",295],["T_STRING","SCOPE_STORE",295],")",";",["T_WHITESPACE","\n\n        ",295],["T_RETURN","return",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$config",297],";",["T_WHITESPACE","\n    ",297],"}",["T_WHITESPACE","\n",298],"}",["T_WHITESPACE","\n",299]]