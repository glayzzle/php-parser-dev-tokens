[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_DOC_COMMENT","\/**\n * Database saving file helper\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",7],["T_WHITESPACE","\n",11],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","MediaStorage",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Helper",12],["T_NS_SEPARATOR","\\",12],["T_STRING","File",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Storage",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Framework",14],["T_NS_SEPARATOR","\\",14],["T_STRING","App",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Filesystem",14],["T_NS_SEPARATOR","\\",14],["T_STRING","DirectoryList",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Framework",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Filesystem",15],";",["T_WHITESPACE","\n\n",15],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","Database",17],["T_WHITESPACE"," ",17],["T_EXTENDS","extends",17],["T_WHITESPACE"," ",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Magento",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Framework",17],["T_NS_SEPARATOR","\\",17],["T_STRING","App",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Helper",17],["T_NS_SEPARATOR","\\",17],["T_STRING","AbstractHelper",17],["T_WHITESPACE","\n",17],"{",["T_WHITESPACE","\n    ",18],["T_DOC_COMMENT","\/**\n     * Database storage model\n     * @var null|\\Magento\\MediaStorage\\Model\\File\\Storage\\Database\n     *\/",19],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_databaseModel",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_STRING","null",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Storage resource model\n     * @var null|\\Magento\\MediaStorage\\Model\\ResourceModel\\File\\Storage\\Database\n     *\/",25],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$_resourceModel",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_STRING","null",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Db usage flag\n     *\n     * @var bool\n     *\/",31],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_useDb",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_STRING","null",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Media dir\n     *\n     * @var string\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_mediaBaseDirectory",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * @var Filesystem\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_filesystem",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\MediaStorage\\Model\\File\\Storage\\DatabaseFactory\n     *\/",50],["T_WHITESPACE","\n    ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_dbStorageFactory",53],";",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\MediaStorage\\Model\\File\\Storage\\File\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_fileStorage",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\App\\Helper\\Context $context\n     * @param \\Magento\\MediaStorage\\Model\\File\\Storage\\DatabaseFactory $dbStorageFactory\n     * @param \\Magento\\MediaStorage\\Model\\File\\Storage\\File $fileStorage\n     * @param Filesystem $filesystem\n     *\/",60],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","__construct",66],"(",["T_WHITESPACE","\n        ",66],["T_NS_SEPARATOR","\\",67],["T_STRING","Magento",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Framework",67],["T_NS_SEPARATOR","\\",67],["T_STRING","App",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Helper",67],["T_NS_SEPARATOR","\\",67],["T_STRING","Context",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$context",67],",",["T_WHITESPACE","\n        ",67],["T_NS_SEPARATOR","\\",68],["T_STRING","Magento",68],["T_NS_SEPARATOR","\\",68],["T_STRING","MediaStorage",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Model",68],["T_NS_SEPARATOR","\\",68],["T_STRING","File",68],["T_NS_SEPARATOR","\\",68],["T_STRING","Storage",68],["T_NS_SEPARATOR","\\",68],["T_STRING","DatabaseFactory",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$dbStorageFactory",68],",",["T_WHITESPACE","\n        ",68],["T_NS_SEPARATOR","\\",69],["T_STRING","Magento",69],["T_NS_SEPARATOR","\\",69],["T_STRING","MediaStorage",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Model",69],["T_NS_SEPARATOR","\\",69],["T_STRING","File",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Storage",69],["T_NS_SEPARATOR","\\",69],["T_STRING","File",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$fileStorage",69],",",["T_WHITESPACE","\n        ",69],["T_STRING","Filesystem",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$filesystem",70],["T_WHITESPACE","\n    ",70],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_filesystem",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$filesystem",72],";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_dbStorageFactory",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$dbStorageFactory",73],";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_fileStorage",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$fileStorage",74],";",["T_WHITESPACE","\n        ",74],["T_STRING","parent",75],["T_DOUBLE_COLON","::",75],["T_STRING","__construct",75],"(",["T_VARIABLE","$context",75],")",";",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Check if we use DB storage\n     * Note: Disabled as not completed feature\n     *\n     * @return bool\n     *\/",78],["T_WHITESPACE","\n    ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","checkDbUsage",84],"(",")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_STRING","null",86],["T_WHITESPACE"," ",86],["T_IS_IDENTICAL","===",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_useDb",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$currentStorage",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_INT_CAST","(int)",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","scopeConfig",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getValue",87],"(",["T_WHITESPACE","\n                ",87],["T_NS_SEPARATOR","\\",88],["T_STRING","Magento",88],["T_NS_SEPARATOR","\\",88],["T_STRING","MediaStorage",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Model",88],["T_NS_SEPARATOR","\\",88],["T_STRING","File",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Storage",88],["T_DOUBLE_COLON","::",88],["T_STRING","XML_PATH_STORAGE_MEDIA",88],",",["T_WHITESPACE","\n                ",88],["T_CONSTANT_ENCAPSED_STRING","'default'",89],["T_WHITESPACE","\n            ",89],")",";",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_useDb",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$currentStorage",91],["T_WHITESPACE"," ",91],["T_IS_EQUAL","==",91],["T_WHITESPACE"," ",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Magento",91],["T_NS_SEPARATOR","\\",91],["T_STRING","MediaStorage",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Model",91],["T_NS_SEPARATOR","\\",91],["T_STRING","File",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Storage",91],["T_DOUBLE_COLON","::",91],["T_STRING","STORAGE_MEDIA_DATABASE",91],";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_useDb",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Get database storage model\n     *\n     * @return \\Magento\\MediaStorage\\Model\\File\\Storage\\Database\n     *\/",97],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","getStorageDatabaseModel",102],"(",")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_databaseModel",104],["T_WHITESPACE"," ",104],["T_IS_IDENTICAL","===",104],["T_WHITESPACE"," ",104],["T_STRING","null",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_databaseModel",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_dbStorageFactory",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","create",105],"(",")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_databaseModel",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Get file storage model\n     *\n     * @return \\Magento\\MediaStorage\\Model\\File\\Storage\\File\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","getStorageFileModel",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_fileStorage",118],";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Get storage model\n     *\n     * @return \\Magento\\MediaStorage\\Model\\ResourceModel\\File\\Storage\\Database\n     *\/",121],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","getResourceStorageModel",126],"(",")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_resourceModel",128],["T_WHITESPACE"," ",128],["T_IS_IDENTICAL","===",128],["T_WHITESPACE"," ",128],["T_STRING","null",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_resourceModel",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getStorageDatabaseModel",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getResource",129],"(",")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n        ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_resourceModel",131],";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Save file in DB storage\n     *\n     * @param string $filename\n     * @return void\n     *\/",134],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","saveFile",140],"(",["T_VARIABLE","$filename",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","checkDbUsage",142],"(",")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getStorageDatabaseModel",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","saveFile",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_removeAbsPathFromFileName",143],"(",["T_VARIABLE","$filename",143],")",")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Rename file in DB storage\n     *\n     * @param string $oldName\n     * @param string $newName\n     * @return void\n     *\/",147],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","renameFile",154],"(",["T_VARIABLE","$oldName",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$newName",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","checkDbUsage",156],"(",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getStorageDatabaseModel",157],"(",")",["T_OBJECT_OPERATOR","->",157],["T_STRING","renameFile",157],"(",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_removeAbsPathFromFileName",158],"(",["T_VARIABLE","$oldName",158],")",",",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_removeAbsPathFromFileName",159],"(",["T_VARIABLE","$newName",159],")",["T_WHITESPACE","\n            ",159],")",";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Copy file in DB storage\n     *\n     * @param string $oldName\n     * @param string $newName\n     * @return void\n     *\/",164],["T_WHITESPACE","\n    ",170],["T_PUBLIC","public",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","copyFile",171],"(",["T_VARIABLE","$oldName",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$newName",171],")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","checkDbUsage",173],"(",")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getStorageDatabaseModel",174],"(",")",["T_OBJECT_OPERATOR","->",174],["T_STRING","copyFile",174],"(",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_removeAbsPathFromFileName",175],"(",["T_VARIABLE","$oldName",175],")",",",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_removeAbsPathFromFileName",176],"(",["T_VARIABLE","$newName",176],")",["T_WHITESPACE","\n            ",176],")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Check whether file exists in DB\n     *\n     * @param string $filename can be both full path or partial (like in DB)\n     * @return bool|null\n     *\/",181],["T_WHITESPACE","\n    ",186],["T_PUBLIC","public",187],["T_WHITESPACE"," ",187],["T_FUNCTION","function",187],["T_WHITESPACE"," ",187],["T_STRING","fileExists",187],"(",["T_VARIABLE","$filename",187],")",["T_WHITESPACE","\n    ",187],"{",["T_WHITESPACE","\n        ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","checkDbUsage",189],"(",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_RETURN","return",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getStorageDatabaseModel",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_STRING","fileExists",190],"(",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_removeAbsPathFromFileName",190],"(",["T_VARIABLE","$filename",190],")",")",";",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE"," ",191],["T_ELSE","else",191],["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_STRING","null",192],";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Get unique name for passed file in case this file already exists\n     *\n     * @param string $directory - can be both full path or partial (like in DB)\n     * @param string $filename - not just a filename. Can have directory chunks. return will have this form\n     * @return string\n     *\/",196],["T_WHITESPACE","\n    ",202],["T_PUBLIC","public",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","getUniqueFilename",203],"(",["T_VARIABLE","$directory",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$filename",203],")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","checkDbUsage",205],"(",")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$directory",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_removeAbsPathFromFileName",206],"(",["T_VARIABLE","$directory",206],")",";",["T_WHITESPACE","\n            ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","fileExists",207],"(",["T_VARIABLE","$directory",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_VARIABLE","$filename",207],")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$index",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_LNUMBER","1",208],";",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$extension",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_STRING","strrchr",209],"(",["T_VARIABLE","$filename",209],",",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'.'",209],")",";",["T_WHITESPACE","\n                ",209],["T_VARIABLE","$filenameWoExtension",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_STRING","substr",210],"(",["T_VARIABLE","$filename",210],",",["T_WHITESPACE"," ",210],["T_LNUMBER","0",210],",",["T_WHITESPACE"," ",210],"-",["T_LNUMBER","1",210],["T_WHITESPACE"," ",210],"*",["T_WHITESPACE"," ",210],["T_STRING","strlen",210],"(",["T_VARIABLE","$extension",210],")",")",";",["T_WHITESPACE","\n                ",210],["T_WHILE","while",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","fileExists",211],"(",["T_VARIABLE","$directory",211],["T_WHITESPACE"," ",211],".",["T_WHITESPACE"," ",211],["T_VARIABLE","$filenameWoExtension",211],["T_WHITESPACE"," ",211],".",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'_'",211],["T_WHITESPACE"," ",211],".",["T_WHITESPACE"," ",211],["T_VARIABLE","$index",211],["T_WHITESPACE"," ",211],".",["T_WHITESPACE"," ",211],["T_VARIABLE","$extension",211],")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                    ",211],["T_VARIABLE","$index",212],["T_INC","++",212],";",["T_WHITESPACE","\n                ",212],"}",["T_WHITESPACE","\n                ",213],["T_VARIABLE","$filename",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$filenameWoExtension",214],["T_WHITESPACE"," ",214],".",["T_WHITESPACE"," ",214],["T_CONSTANT_ENCAPSED_STRING","'_'",214],["T_WHITESPACE"," ",214],".",["T_WHITESPACE"," ",214],["T_VARIABLE","$index",214],["T_WHITESPACE"," ",214],".",["T_WHITESPACE"," ",214],["T_VARIABLE","$extension",214],";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n        ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$filename",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Save database file to file system\n     *\n     * @param string $filename\n     * @return bool|int\n     *\/",220],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","saveFileToFilesystem",226],"(",["T_VARIABLE","$filename",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_IF","if",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","checkDbUsage",228],"(",")",")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_DOC_COMMENT","\/** @var $file \\Magento\\MediaStorage\\Model\\File\\Storage\\Database *\/",229],["T_WHITESPACE","\n            ",229],["T_VARIABLE","$file",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_dbStorageFactory",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","create",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","loadByFilename",230],"(",["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_removeAbsPathFromFileName",230],"(",["T_VARIABLE","$filename",230],")",")",";",["T_WHITESPACE","\n            ",230],["T_IF","if",231],["T_WHITESPACE"," ",231],"(","!",["T_VARIABLE","$file",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getId",231],"(",")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_RETURN","return",232],["T_WHITESPACE"," ",232],["T_STRING","false",232],";",["T_WHITESPACE","\n            ",232],"}",["T_WHITESPACE","\n\n            ",233],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getStorageFileModel",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","saveFile",235],"(",["T_VARIABLE","$file",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getData",235],"(",")",",",["T_WHITESPACE"," ",235],["T_STRING","true",235],")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n        ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_STRING","false",237],";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Return relative uri for media content by full path\n     *\n     * @param string $fullPath\n     * @return string\n     *\/",240],["T_WHITESPACE","\n    ",245],["T_PUBLIC","public",246],["T_WHITESPACE"," ",246],["T_FUNCTION","function",246],["T_WHITESPACE"," ",246],["T_STRING","getMediaRelativePath",246],"(",["T_VARIABLE","$fullPath",246],")",["T_WHITESPACE","\n    ",246],"{",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$relativePath",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","ltrim",248],"(",["T_STRING","str_replace",248],"(",["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getMediaBaseDir",248],"(",")",",",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","''",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$fullPath",248],")",",",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",248],")",";",["T_WHITESPACE","\n        ",248],["T_RETURN","return",249],["T_WHITESPACE"," ",249],["T_STRING","str_replace",249],"(",["T_CONSTANT_ENCAPSED_STRING","'\\\\'",249],",",["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","'\/'",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$relativePath",249],")",";",["T_WHITESPACE","\n    ",249],"}",["T_WHITESPACE","\n\n    ",250],["T_DOC_COMMENT","\/**\n     * Deletes from DB files, which belong to one folder\n     *\n     * @param string $folderName\n     * @return void\n     *\/",252],["T_WHITESPACE","\n    ",257],["T_PUBLIC","public",258],["T_WHITESPACE"," ",258],["T_FUNCTION","function",258],["T_WHITESPACE"," ",258],["T_STRING","deleteFolder",258],"(",["T_VARIABLE","$folderName",258],")",["T_WHITESPACE","\n    ",258],"{",["T_WHITESPACE","\n        ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","checkDbUsage",260],"(",")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getResourceStorageModel",261],"(",")",["T_OBJECT_OPERATOR","->",261],["T_STRING","deleteFolder",261],"(",["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_removeAbsPathFromFileName",261],"(",["T_VARIABLE","$folderName",261],")",")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n    ",262],"}",["T_WHITESPACE","\n\n    ",263],["T_DOC_COMMENT","\/**\n     * Deletes from DB files, which belong to one folder\n     *\n     * @param string $filename\n     * @return void\n     *\/",265],["T_WHITESPACE","\n    ",270],["T_PUBLIC","public",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","deleteFile",271],"(",["T_VARIABLE","$filename",271],")",["T_WHITESPACE","\n    ",271],"{",["T_WHITESPACE","\n        ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","checkDbUsage",273],"(",")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getStorageDatabaseModel",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","deleteFile",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_removeAbsPathFromFileName",274],"(",["T_VARIABLE","$filename",274],")",")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n    ",275],"}",["T_WHITESPACE","\n\n    ",276],["T_DOC_COMMENT","\/**\n     * Saves uploaded by \\Magento\\MediaStorage\\Model\\File\\Uploader file to DB with existence tests\n     *\n     * param $result should be result from \\Magento\\MediaStorage\\Model\\File\\Uploader::save() method\n     * Checks in DB, whether uploaded file exists ($result['file'])\n     * If yes, renames file on FS (!!!!!)\n     * Saves file with unique name into DB\n     * If passed file exists returns new name, file was renamed to (in the same context)\n     * Otherwise returns $result['file']\n     *\n     * @param array $result\n     * @return string\n     *\/",278],["T_WHITESPACE","\n    ",290],["T_PUBLIC","public",291],["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],["T_STRING","saveUploadedFile",291],"(",["T_VARIABLE","$result",291],")",["T_WHITESPACE","\n    ",291],"{",["T_WHITESPACE","\n        ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","checkDbUsage",293],"(",")",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n            ",293],["T_VARIABLE","$path",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_STRING","rtrim",294],"(",["T_STRING","str_replace",294],"(","[",["T_CONSTANT_ENCAPSED_STRING","'\\\\'",294],",",["T_WHITESPACE"," ",294],["T_CONSTANT_ENCAPSED_STRING","'\/'",294],"]",",",["T_WHITESPACE"," ",294],["T_CONSTANT_ENCAPSED_STRING","'\/'",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$result",294],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",294],"]",")",",",["T_WHITESPACE"," ",294],["T_CONSTANT_ENCAPSED_STRING","'\/'",294],")",";",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$file",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","'\/'",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_STRING","ltrim",295],"(",["T_VARIABLE","$result",295],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",295],"]",",",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",295],")",";",["T_WHITESPACE","\n\n            ",295],["T_VARIABLE","$uniqueResultFile",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getUniqueFilename",297],"(",["T_VARIABLE","$path",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$file",297],")",";",["T_WHITESPACE","\n\n            ",297],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$uniqueResultFile",299],["T_WHITESPACE"," ",299],["T_IS_NOT_IDENTICAL","!==",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$file",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$dirWrite",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_filesystem",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getDirectoryWrite",300],"(",["T_STRING","DirectoryList",300],["T_DOUBLE_COLON","::",300],["T_STRING","ROOT",300],")",";",["T_WHITESPACE","\n                ",300],["T_VARIABLE","$dirWrite",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","renameFile",301],"(",["T_VARIABLE","$path",301],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_VARIABLE","$file",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$path",301],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_VARIABLE","$uniqueResultFile",301],")",";",["T_WHITESPACE","\n            ",301],"}",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","saveFile",303],"(",["T_VARIABLE","$path",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$uniqueResultFile",303],")",";",["T_WHITESPACE","\n\n            ",303],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$uniqueResultFile",305],";",["T_WHITESPACE","\n        ",305],"}",["T_WHITESPACE"," ",306],["T_ELSE","else",306],["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_RETURN","return",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$result",307],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",307],"]",";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n\n    ",309],["T_DOC_COMMENT","\/**\n     * Convert full file path to local (as used by model)\n     * If not - returns just a filename\n     *\n     * @param string $filename\n     * @return string\n     *\/",311],["T_WHITESPACE","\n    ",317],["T_PROTECTED","protected",318],["T_WHITESPACE"," ",318],["T_FUNCTION","function",318],["T_WHITESPACE"," ",318],["T_STRING","_removeAbsPathFromFileName",318],"(",["T_VARIABLE","$filename",318],")",["T_WHITESPACE","\n    ",318],"{",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getMediaRelativePath",320],"(",["T_VARIABLE","$filename",320],")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Return Media base dir\n     *\n     * @return string\n     *\/",323],["T_WHITESPACE","\n    ",327],["T_PUBLIC","public",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","getMediaBaseDir",328],"(",")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_IF","if",330],["T_WHITESPACE"," ",330],"(",["T_STRING","null",330],["T_WHITESPACE"," ",330],["T_IS_IDENTICAL","===",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_mediaBaseDirectory",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$mediaDir",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_filesystem",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getDirectoryRead",331],"(",["T_STRING","DirectoryList",331],["T_DOUBLE_COLON","::",331],["T_STRING","MEDIA",331],")",["T_OBJECT_OPERATOR","->",331],["T_STRING","getAbsolutePath",331],"(",")",";",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_mediaBaseDirectory",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_STRING","rtrim",332],"(",["T_VARIABLE","$mediaDir",332],",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'\/'",332],")",";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n        ",333],["T_RETURN","return",334],["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_mediaBaseDirectory",334],";",["T_WHITESPACE","\n    ",334],"}",["T_WHITESPACE","\n",335],"}",["T_WHITESPACE","\n",336]]