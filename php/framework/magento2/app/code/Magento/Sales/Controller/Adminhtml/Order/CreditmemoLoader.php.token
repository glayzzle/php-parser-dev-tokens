[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n *\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",6],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Sales",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Controller",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Adminhtml",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Order",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","DataObject",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Sales",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CreditmemoRepositoryInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Sales",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Order",11],["T_NS_SEPARATOR","\\",11],["T_STRING","CreditmemoFactory",11],";",["T_WHITESPACE","\n\n",11],["T_DOC_COMMENT","\/**\n * Class CreditmemoLoader\n *\n * @package Magento\\Sales\\Controller\\Adminhtml\\Order\n * @method CreditmemoLoader setCreditmemoId($id)\n * @method CreditmemoLoader setCreditmemo($creditMemo)\n * @method CreditmemoLoader setInvoiceId($id)\n * @method CreditmemoLoader setOrderId($id)\n * @method int getCreditmemoId()\n * @method string getCreditmemo()\n * @method int getInvoiceId()\n * @method int getOrderId()\n *\/",13],["T_WHITESPACE","\n",25],["T_CLASS","class",26],["T_WHITESPACE"," ",26],["T_STRING","CreditmemoLoader",26],["T_WHITESPACE"," ",26],["T_EXTENDS","extends",26],["T_WHITESPACE"," ",26],["T_STRING","DataObject",26],["T_WHITESPACE","\n",26],"{",["T_WHITESPACE","\n    ",27],["T_DOC_COMMENT","\/**\n     * @var CreditmemoRepositoryInterface;\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$creditmemoRepository",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var CreditmemoFactory;\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$creditmemoFactory",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\OrderFactory\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$orderFactory",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\InvoiceRepositoryInterface\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$invoiceRepository",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$eventManager",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Backend\\Model\\Session\n     *\/",53],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$backendSession",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Message\\ManagerInterface\n     *\/",58],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$messageManager",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Registry\n     *\/",63],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$registry",66],";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\CatalogInventory\\Api\\StockConfigurationInterface\n     *\/",68],["T_WHITESPACE","\n    ",70],["T_PROTECTED","protected",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$stockConfiguration",71],";",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * @param CreditmemoRepositoryInterface $creditmemoRepository\n     * @param CreditmemoFactory $creditmemoFactory\n     * @param \\Magento\\Sales\\Model\\OrderFactory $orderFactory\n     * @param \\Magento\\Sales\\Api\\InvoiceRepositoryInterface $invoiceRepository\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     * @param \\Magento\\Backend\\Model\\Session $backendSession\n     * @param \\Magento\\Framework\\Message\\ManagerInterface $messageManager\n     * @param \\Magento\\Framework\\Registry $registry\n     * @param \\Magento\\CatalogInventory\\Api\\StockConfigurationInterface $stockConfiguration\n     * @param array $data\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",73],["T_WHITESPACE","\n    ",85],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","__construct",86],"(",["T_WHITESPACE","\n        ",86],["T_STRING","CreditmemoRepositoryInterface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$creditmemoRepository",87],",",["T_WHITESPACE","\n        ",87],["T_STRING","CreditmemoFactory",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$creditmemoFactory",88],",",["T_WHITESPACE","\n        ",88],["T_NS_SEPARATOR","\\",89],["T_STRING","Magento",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Sales",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Model",89],["T_NS_SEPARATOR","\\",89],["T_STRING","OrderFactory",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$orderFactory",89],",",["T_WHITESPACE","\n        ",89],["T_NS_SEPARATOR","\\",90],["T_STRING","Magento",90],["T_NS_SEPARATOR","\\",90],["T_STRING","Sales",90],["T_NS_SEPARATOR","\\",90],["T_STRING","Api",90],["T_NS_SEPARATOR","\\",90],["T_STRING","InvoiceRepositoryInterface",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$invoiceRepository",90],",",["T_WHITESPACE","\n        ",90],["T_NS_SEPARATOR","\\",91],["T_STRING","Magento",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Framework",91],["T_NS_SEPARATOR","\\",91],["T_STRING","Event",91],["T_NS_SEPARATOR","\\",91],["T_STRING","ManagerInterface",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$eventManager",91],",",["T_WHITESPACE","\n        ",91],["T_NS_SEPARATOR","\\",92],["T_STRING","Magento",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Backend",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Model",92],["T_NS_SEPARATOR","\\",92],["T_STRING","Session",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$backendSession",92],",",["T_WHITESPACE","\n        ",92],["T_NS_SEPARATOR","\\",93],["T_STRING","Magento",93],["T_NS_SEPARATOR","\\",93],["T_STRING","Framework",93],["T_NS_SEPARATOR","\\",93],["T_STRING","Message",93],["T_NS_SEPARATOR","\\",93],["T_STRING","ManagerInterface",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$messageManager",93],",",["T_WHITESPACE","\n        ",93],["T_NS_SEPARATOR","\\",94],["T_STRING","Magento",94],["T_NS_SEPARATOR","\\",94],["T_STRING","Framework",94],["T_NS_SEPARATOR","\\",94],["T_STRING","Registry",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$registry",94],",",["T_WHITESPACE","\n        ",94],["T_NS_SEPARATOR","\\",95],["T_STRING","Magento",95],["T_NS_SEPARATOR","\\",95],["T_STRING","CatalogInventory",95],["T_NS_SEPARATOR","\\",95],["T_STRING","Api",95],["T_NS_SEPARATOR","\\",95],["T_STRING","StockConfigurationInterface",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$stockConfiguration",95],",",["T_WHITESPACE","\n        ",95],["T_ARRAY","array",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$data",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],"[","]",["T_WHITESPACE","\n    ",96],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","creditmemoRepository",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$creditmemoRepository",98],";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","creditmemoFactory",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$creditmemoFactory",99],";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","orderFactory",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$orderFactory",100],";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","invoiceRepository",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$invoiceRepository",101],";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","eventManager",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$eventManager",102],";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","backendSession",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$backendSession",103],";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","messageManager",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$messageManager",104],";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","registry",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$registry",105],";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","stockConfiguration",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$stockConfiguration",106],";",["T_WHITESPACE","\n        ",106],["T_STRING","parent",107],["T_DOUBLE_COLON","::",107],["T_STRING","__construct",107],"(",["T_VARIABLE","$data",107],")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Get requested items qtys and return to stock flags\n     *\n     * @return array\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PROTECTED","protected",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","_getItemData",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$data",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getCreditmemo",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(","!",["T_VARIABLE","$data",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$data",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","backendSession",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getFormData",119],"(",["T_STRING","true",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_ISSET","isset",122],"(",["T_VARIABLE","$data",122],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",122],"]",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$qtys",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$data",123],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",123],"]",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE"," ",124],["T_ELSE","else",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$qtys",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],"[","]",";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n        ",126],["T_RETURN","return",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$qtys",127],";",["T_WHITESPACE","\n    ",127],"}",["T_WHITESPACE","\n\n    ",128],["T_DOC_COMMENT","\/**\n     * Check if creditmeno can be created for order\n     * @param \\Magento\\Sales\\Model\\Order $order\n     * @return bool\n     *\/",130],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","_canCreditmemo",135],"(",["T_VARIABLE","$order",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_DOC_COMMENT","\/**\n         * Check order existing\n         *\/",137],["T_WHITESPACE","\n        ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(","!",["T_VARIABLE","$order",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getId",140],"(",")",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","messageManager",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","addError",141],"(",["T_STRING","__",141],"(",["T_CONSTANT_ENCAPSED_STRING","'The order no longer exists.'",141],")",")",";",["T_WHITESPACE","\n            ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_STRING","false",142],";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n\n        ",143],["T_DOC_COMMENT","\/**\n         * Check creditmemo create availability\n         *\/",145],["T_WHITESPACE","\n        ",147],["T_IF","if",148],["T_WHITESPACE"," ",148],"(","!",["T_VARIABLE","$order",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","canCreditmemo",148],"(",")",")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","messageManager",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","addError",149],"(",["T_STRING","__",149],"(",["T_CONSTANT_ENCAPSED_STRING","'We can\\'t create credit memo for the order.'",149],")",")",";",["T_WHITESPACE","\n            ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_STRING","false",150],";",["T_WHITESPACE","\n        ",150],"}",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_STRING","true",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Model\\Order $order\n     * @return $this|bool\n     *\/",155],["T_WHITESPACE","\n    ",158],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","_initInvoice",159],"(",["T_VARIABLE","$order",159],")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$invoiceId",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getInvoiceId",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$invoiceId",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$invoice",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","invoiceRepository",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","get",163],"(",["T_VARIABLE","$invoiceId",163],")",";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$invoice",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setOrder",164],"(",["T_VARIABLE","$order",164],")",";",["T_WHITESPACE","\n            ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$invoice",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getId",165],"(",")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$invoice",166],";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n        ",168],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_STRING","false",169],";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * Initialize creditmemo model instance\n     *\n     * @return \\Magento\\Sales\\Model\\Order\\Creditmemo|false\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     *\/",172],["T_WHITESPACE","\n    ",177],["T_PUBLIC","public",178],["T_WHITESPACE"," ",178],["T_FUNCTION","function",178],["T_WHITESPACE"," ",178],["T_STRING","load",178],"(",")",["T_WHITESPACE","\n    ",178],"{",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$creditmemo",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","false",180],";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$creditmemoId",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getCreditmemoId",181],"(",")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$orderId",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getOrderId",182],"(",")",";",["T_WHITESPACE","\n        ",182],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_VARIABLE","$creditmemoId",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$creditmemo",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","creditmemoRepository",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","get",184],"(",["T_VARIABLE","$creditmemoId",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE"," ",185],["T_ELSEIF","elseif",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$orderId",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$data",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getCreditmemo",186],"(",")",";",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$order",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","orderFactory",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","create",187],"(",")",["T_OBJECT_OPERATOR","->",187],["T_STRING","load",187],"(",["T_VARIABLE","$orderId",187],")",";",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$invoice",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_initInvoice",188],"(",["T_VARIABLE","$order",188],")",";",["T_WHITESPACE","\n\n            ",188],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_canCreditmemo",190],"(",["T_VARIABLE","$order",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_STRING","false",191],";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n\n            ",192],["T_VARIABLE","$savedData",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getItemData",194],"(",")",";",["T_WHITESPACE","\n\n            ",194],["T_VARIABLE","$qtys",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],"[","]",";",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$backToStock",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],"[","]",";",["T_WHITESPACE","\n            ",197],["T_FOREACH","foreach",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$savedData",198],["T_WHITESPACE"," ",198],["T_AS","as",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$orderItemId",198],["T_WHITESPACE"," ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$itemData",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(",["T_ISSET","isset",199],"(",["T_VARIABLE","$itemData",199],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",199],"]",")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n                    ",199],["T_VARIABLE","$qtys",200],"[",["T_VARIABLE","$orderItemId",200],"]",["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$itemData",200],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",200],"]",";",["T_WHITESPACE","\n                ",200],"}",["T_WHITESPACE","\n                ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(",["T_ISSET","isset",202],"(",["T_VARIABLE","$itemData",202],"[",["T_CONSTANT_ENCAPSED_STRING","'back_to_stock'",202],"]",")",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n                    ",202],["T_VARIABLE","$backToStock",203],"[",["T_VARIABLE","$orderItemId",203],"]",["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","true",203],";",["T_WHITESPACE","\n                ",203],"}",["T_WHITESPACE","\n            ",204],"}",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$data",206],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",206],"]",["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$qtys",206],";",["T_WHITESPACE","\n\n            ",206],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$invoice",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$creditmemo",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","creditmemoFactory",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","createByInvoice",209],"(",["T_VARIABLE","$invoice",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$data",209],")",";",["T_WHITESPACE","\n            ",209],"}",["T_WHITESPACE"," ",210],["T_ELSE","else",210],["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                ",210],["T_VARIABLE","$creditmemo",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","creditmemoFactory",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","createByOrder",211],"(",["T_VARIABLE","$order",211],",",["T_WHITESPACE"," ",211],["T_VARIABLE","$data",211],")",";",["T_WHITESPACE","\n            ",211],"}",["T_WHITESPACE","\n\n            ",212],["T_DOC_COMMENT","\/**\n             * Process back to stock flags\n             *\/",214],["T_WHITESPACE","\n            ",216],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$creditmemo",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getAllItems",217],"(",")",["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$creditmemoItem",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                ",217],["T_VARIABLE","$orderItem",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$creditmemoItem",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getOrderItem",218],"(",")",";",["T_WHITESPACE","\n                ",218],["T_VARIABLE","$parentId",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$orderItem",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getParentItemId",219],"(",")",";",["T_WHITESPACE","\n                ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$parentId",220],["T_WHITESPACE"," ",220],["T_BOOLEAN_AND","&&",220],["T_WHITESPACE"," ",220],["T_ISSET","isset",220],"(",["T_VARIABLE","$backToStock",220],"[",["T_VARIABLE","$parentId",220],"]",")",["T_WHITESPACE"," ",220],["T_BOOLEAN_AND","&&",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$backToStock",220],"[",["T_VARIABLE","$parentId",220],"]",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                    ",220],["T_VARIABLE","$creditmemoItem",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setBackToStock",221],"(",["T_STRING","true",221],")",";",["T_WHITESPACE","\n                ",221],"}",["T_WHITESPACE"," ",222],["T_ELSEIF","elseif",222],["T_WHITESPACE"," ",222],"(",["T_ISSET","isset",222],"(",["T_VARIABLE","$backToStock",222],"[",["T_VARIABLE","$orderItem",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getId",222],"(",")","]",")",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n                    ",222],["T_VARIABLE","$creditmemoItem",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","setBackToStock",223],"(",["T_STRING","true",223],")",";",["T_WHITESPACE","\n                ",223],"}",["T_WHITESPACE"," ",224],["T_ELSEIF","elseif",224],["T_WHITESPACE"," ",224],"(",["T_EMPTY","empty",224],"(",["T_VARIABLE","$savedData",224],")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                    ",224],["T_VARIABLE","$creditmemoItem",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setBackToStock",225],"(",["T_WHITESPACE","\n                        ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","stockConfiguration",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","isAutoReturnEnabled",226],"(",")",["T_WHITESPACE","\n                    ",226],")",";",["T_WHITESPACE","\n                ",227],"}",["T_WHITESPACE"," ",228],["T_ELSE","else",228],["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n                    ",228],["T_VARIABLE","$creditmemoItem",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","setBackToStock",229],"(",["T_STRING","false",229],")",";",["T_WHITESPACE","\n                ",229],"}",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","eventManager",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","dispatch",234],"(",["T_WHITESPACE","\n            ",234],["T_CONSTANT_ENCAPSED_STRING","'adminhtml_sales_order_creditmemo_register_before'",235],",",["T_WHITESPACE","\n            ",235],"[",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",236],["T_WHITESPACE"," ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$creditmemo",236],",",["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'input'",236],["T_WHITESPACE"," ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getCreditmemo",236],"(",")","]",["T_WHITESPACE","\n        ",236],")",";",["T_WHITESPACE","\n\n        ",237],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","registry",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","register",239],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$creditmemo",239],")",";",["T_WHITESPACE","\n        ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$creditmemo",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n",241],"}",["T_WHITESPACE","\n",242]]