[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Order",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Invoice",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Total",6],";",["T_WHITESPACE","\n\n",6],["T_CLASS","class",8],["T_WHITESPACE"," ",8],["T_STRING","Tax",8],["T_WHITESPACE"," ",8],["T_EXTENDS","extends",8],["T_WHITESPACE"," ",8],["T_STRING","AbstractTotal",8],["T_WHITESPACE","\n",8],"{",["T_WHITESPACE","\n    ",9],["T_DOC_COMMENT","\/**\n     * Collect invoice tax amount\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Invoice $invoice\n     * @return $this\n     * @SuppressWarnings(PHPMD.CyclomaticComplexity)\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",10],["T_WHITESPACE","\n    ",17],["T_PUBLIC","public",18],["T_WHITESPACE"," ",18],["T_FUNCTION","function",18],["T_WHITESPACE"," ",18],["T_STRING","collect",18],"(",["T_NS_SEPARATOR","\\",18],["T_STRING","Magento",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Sales",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Model",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Order",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Invoice",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$invoice",18],")",["T_WHITESPACE","\n    ",18],"{",["T_WHITESPACE","\n        ",19],["T_VARIABLE","$totalTax",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_LNUMBER","0",20],";",["T_WHITESPACE","\n        ",20],["T_VARIABLE","$baseTotalTax",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_LNUMBER","0",21],";",["T_WHITESPACE","\n        ",21],["T_VARIABLE","$totalDiscountTaxCompensation",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_LNUMBER","0",22],";",["T_WHITESPACE","\n        ",22],["T_VARIABLE","$baseTotalDiscountTaxCompensation",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_LNUMBER","0",23],";",["T_WHITESPACE","\n\n        ",23],["T_VARIABLE","$order",25],["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_VARIABLE","$invoice",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","getOrder",25],"(",")",";",["T_WHITESPACE","\n\n        ",25],["T_DOC_COMMENT","\/** @var $item \\Magento\\Sales\\Model\\Order\\Invoice\\Item *\/",27],["T_WHITESPACE","\n        ",27],["T_FOREACH","foreach",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$invoice",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","getAllItems",28],"(",")",["T_WHITESPACE"," ",28],["T_AS","as",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$item",28],")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n            ",28],["T_VARIABLE","$orderItem",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$item",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getOrderItem",29],"(",")",";",["T_WHITESPACE","\n            ",29],["T_VARIABLE","$orderItemQty",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$orderItem",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","getQtyOrdered",30],"(",")",";",["T_WHITESPACE","\n\n            ",30],["T_IF","if",32],["T_WHITESPACE"," ",32],"(","(",["T_VARIABLE","$orderItem",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getTaxAmount",32],"(",")",["T_WHITESPACE"," ",32],["T_BOOLEAN_OR","||",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$orderItem",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getDiscountTaxCompensationAmount",32],"(",")",")",["T_WHITESPACE"," ",32],["T_BOOLEAN_AND","&&",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$orderItemQty",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n                ",32],["T_IF","if",33],["T_WHITESPACE"," ",33],"(",["T_VARIABLE","$item",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getOrderItem",33],"(",")",["T_OBJECT_OPERATOR","->",33],["T_STRING","isDummy",33],"(",")",["T_WHITESPACE"," ",33],["T_BOOLEAN_OR","||",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$item",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getQty",33],"(",")",["T_WHITESPACE"," ",33],["T_IS_SMALLER_OR_EQUAL","<=",33],["T_WHITESPACE"," ",33],["T_LNUMBER","0",33],")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n                    ",33],["T_CONTINUE","continue",34],";",["T_WHITESPACE","\n                ",34],"}",["T_WHITESPACE","\n\n                ",35],["T_DOC_COMMENT","\/**\n                 * Resolve rounding problems\n                 *\/",37],["T_WHITESPACE","\n                ",39],["T_VARIABLE","$tax",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$orderItem",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getTaxAmount",40],"(",")",["T_WHITESPACE"," ",40],"-",["T_WHITESPACE"," ",40],["T_VARIABLE","$orderItem",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getTaxInvoiced",40],"(",")",";",["T_WHITESPACE","\n                ",40],["T_VARIABLE","$baseTax",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$orderItem",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getBaseTaxAmount",41],"(",")",["T_WHITESPACE"," ",41],"-",["T_WHITESPACE"," ",41],["T_VARIABLE","$orderItem",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getBaseTaxInvoiced",41],"(",")",";",["T_WHITESPACE","\n                ",41],["T_VARIABLE","$discountTaxCompensation",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$orderItem",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","getDiscountTaxCompensationAmount",42],"(",")",["T_WHITESPACE"," ",42],"-",["T_WHITESPACE","\n                    ",42],["T_VARIABLE","$orderItem",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getDiscountTaxCompensationInvoiced",43],"(",")",";",["T_WHITESPACE","\n                ",43],["T_VARIABLE","$baseDiscountTaxCompensation",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$orderItem",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getBaseDiscountTaxCompensationAmount",44],"(",")",["T_WHITESPACE"," ",44],"-",["T_WHITESPACE","\n                    ",44],["T_VARIABLE","$orderItem",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getBaseDiscountTaxCompensationInvoiced",45],"(",")",";",["T_WHITESPACE","\n                ",45],["T_IF","if",46],["T_WHITESPACE"," ",46],"(","!",["T_VARIABLE","$item",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","isLast",46],"(",")",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n                    ",46],["T_VARIABLE","$availableQty",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$orderItemQty",47],["T_WHITESPACE"," ",47],"-",["T_WHITESPACE"," ",47],["T_VARIABLE","$orderItem",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getQtyInvoiced",47],"(",")",";",["T_WHITESPACE","\n                    ",47],["T_VARIABLE","$tax",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$invoice",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","roundPrice",48],"(",["T_VARIABLE","$tax",48],["T_WHITESPACE"," ",48],"\/",["T_WHITESPACE"," ",48],["T_VARIABLE","$availableQty",48],["T_WHITESPACE"," ",48],"*",["T_WHITESPACE"," ",48],["T_VARIABLE","$item",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getQty",48],"(",")",")",";",["T_WHITESPACE","\n                    ",48],["T_VARIABLE","$baseTax",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$invoice",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","roundPrice",49],"(",["T_VARIABLE","$baseTax",49],["T_WHITESPACE"," ",49],"\/",["T_WHITESPACE"," ",49],["T_VARIABLE","$availableQty",49],["T_WHITESPACE"," ",49],"*",["T_WHITESPACE"," ",49],["T_VARIABLE","$item",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getQty",49],"(",")",",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'base'",49],")",";",["T_WHITESPACE","\n                    ",49],["T_VARIABLE","$discountTaxCompensation",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$invoice",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","roundPrice",50],"(",["T_WHITESPACE","\n                        ",50],["T_VARIABLE","$discountTaxCompensation",51],["T_WHITESPACE"," ",51],"\/",["T_WHITESPACE"," ",51],["T_VARIABLE","$availableQty",51],["T_WHITESPACE"," ",51],"*",["T_WHITESPACE"," ",51],["T_VARIABLE","$item",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getQty",51],"(",")",["T_WHITESPACE","\n                    ",51],")",";",["T_WHITESPACE","\n                    ",52],["T_VARIABLE","$baseDiscountTaxCompensation",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$invoice",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","roundPrice",53],"(",["T_WHITESPACE","\n                        ",53],["T_VARIABLE","$baseDiscountTaxCompensation",54],["T_WHITESPACE"," ",54],"\/",["T_WHITESPACE","\n                        ",54],["T_VARIABLE","$availableQty",55],["T_WHITESPACE"," ",55],"*",["T_WHITESPACE"," ",55],["T_VARIABLE","$item",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getQty",55],"(",")",",",["T_WHITESPACE","\n                        ",55],["T_CONSTANT_ENCAPSED_STRING","'base'",56],["T_WHITESPACE","\n                    ",56],")",";",["T_WHITESPACE","\n                ",57],"}",["T_WHITESPACE","\n\n                ",58],["T_VARIABLE","$item",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setTaxAmount",60],"(",["T_VARIABLE","$tax",60],")",";",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$item",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","setBaseTaxAmount",61],"(",["T_VARIABLE","$baseTax",61],")",";",["T_WHITESPACE","\n                ",61],["T_VARIABLE","$item",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","setDiscountTaxCompensationAmount",62],"(",["T_VARIABLE","$discountTaxCompensation",62],")",";",["T_WHITESPACE","\n                ",62],["T_VARIABLE","$item",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","setBaseDiscountTaxCompensationAmount",63],"(",["T_VARIABLE","$baseDiscountTaxCompensation",63],")",";",["T_WHITESPACE","\n\n                ",63],["T_VARIABLE","$totalTax",65],["T_WHITESPACE"," ",65],["T_PLUS_EQUAL","+=",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$tax",65],";",["T_WHITESPACE","\n                ",65],["T_VARIABLE","$baseTotalTax",66],["T_WHITESPACE"," ",66],["T_PLUS_EQUAL","+=",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$baseTax",66],";",["T_WHITESPACE","\n                ",66],["T_VARIABLE","$totalDiscountTaxCompensation",67],["T_WHITESPACE"," ",67],["T_PLUS_EQUAL","+=",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$discountTaxCompensation",67],";",["T_WHITESPACE","\n                ",67],["T_VARIABLE","$baseTotalDiscountTaxCompensation",68],["T_WHITESPACE"," ",68],["T_PLUS_EQUAL","+=",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$baseDiscountTaxCompensation",68],";",["T_WHITESPACE","\n            ",68],"}",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_IF","if",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_canIncludeShipping",72],"(",["T_VARIABLE","$invoice",72],")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$totalTax",73],["T_WHITESPACE"," ",73],["T_PLUS_EQUAL","+=",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$order",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getShippingTaxAmount",73],"(",")",";",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$baseTotalTax",74],["T_WHITESPACE"," ",74],["T_PLUS_EQUAL","+=",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$order",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getBaseShippingTaxAmount",74],"(",")",";",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$totalDiscountTaxCompensation",75],["T_WHITESPACE"," ",75],["T_PLUS_EQUAL","+=",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$order",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getShippingDiscountTaxCompensationAmount",75],"(",")",";",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$baseTotalDiscountTaxCompensation",76],["T_WHITESPACE"," ",76],["T_PLUS_EQUAL","+=",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$order",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getBaseShippingDiscountTaxCompensationAmnt",76],"(",")",";",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$invoice",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","setShippingTaxAmount",77],"(",["T_VARIABLE","$order",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getShippingTaxAmount",77],"(",")",")",";",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$invoice",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","setBaseShippingTaxAmount",78],"(",["T_VARIABLE","$order",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getBaseShippingTaxAmount",78],"(",")",")",";",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$invoice",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","setShippingDiscountTaxCompensationAmount",79],"(",["T_VARIABLE","$order",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getShippingDiscountTaxCompensationAmount",79],"(",")",")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$invoice",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","setBaseShippingDiscountTaxCompensationAmnt",80],"(",["T_VARIABLE","$order",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getBaseShippingDiscountTaxCompensationAmnt",80],"(",")",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$allowedTax",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$order",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getTaxAmount",82],"(",")",["T_WHITESPACE"," ",82],"-",["T_WHITESPACE"," ",82],["T_VARIABLE","$order",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getTaxInvoiced",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$allowedBaseTax",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$order",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getBaseTaxAmount",83],"(",")",["T_WHITESPACE"," ",83],"-",["T_WHITESPACE"," ",83],["T_VARIABLE","$order",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getBaseTaxInvoiced",83],"(",")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$allowedDiscountTaxCompensation",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$order",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getDiscountTaxCompensationAmount",84],"(",")",["T_WHITESPACE"," ",84],"+",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$order",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getShippingDiscountTaxCompensationAmount",85],"(",")",["T_WHITESPACE"," ",85],"-",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$order",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getDiscountTaxCompensationInvoiced",86],"(",")",["T_WHITESPACE"," ",86],"-",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$order",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getShippingDiscountTaxCompensationInvoiced",87],"(",")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$allowedBaseDiscountTaxCompensation",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$order",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getBaseDiscountTaxCompensationAmount",88],"(",")",["T_WHITESPACE"," ",88],"+",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$order",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getBaseShippingDiscountTaxCompensationAmnt",89],"(",")",["T_WHITESPACE"," ",89],"-",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$order",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getBaseDiscountTaxCompensationInvoiced",90],"(",")",["T_WHITESPACE"," ",90],"-",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$order",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getBaseShippingDiscountTaxCompensationInvoiced",91],"(",")",";",["T_WHITESPACE","\n\n        ",91],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$invoice",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","isLast",93],"(",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$totalTax",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$allowedTax",94],";",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$baseTotalTax",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$allowedBaseTax",95],";",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$totalDiscountTaxCompensation",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$allowedDiscountTaxCompensation",96],";",["T_WHITESPACE","\n            ",96],["T_VARIABLE","$baseTotalDiscountTaxCompensation",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$allowedBaseDiscountTaxCompensation",97],";",["T_WHITESPACE","\n        ",97],"}",["T_WHITESPACE"," ",98],["T_ELSE","else",98],["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$totalTax",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","min",99],"(",["T_VARIABLE","$allowedTax",99],",",["T_WHITESPACE"," ",99],["T_VARIABLE","$totalTax",99],")",";",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$baseTotalTax",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","min",100],"(",["T_VARIABLE","$allowedBaseTax",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$baseTotalTax",100],")",";",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$totalDiscountTaxCompensation",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","min",101],"(",["T_VARIABLE","$allowedDiscountTaxCompensation",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$totalDiscountTaxCompensation",101],")",";",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$baseTotalDiscountTaxCompensation",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","min",102],"(",["T_WHITESPACE","\n                ",102],["T_VARIABLE","$allowedBaseDiscountTaxCompensation",103],",",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$baseTotalDiscountTaxCompensation",104],["T_WHITESPACE","\n            ",104],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$invoice",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","setTaxAmount",108],"(",["T_VARIABLE","$totalTax",108],")",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$invoice",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","setBaseTaxAmount",109],"(",["T_VARIABLE","$baseTotalTax",109],")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$invoice",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","setDiscountTaxCompensationAmount",110],"(",["T_VARIABLE","$totalDiscountTaxCompensation",110],")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$invoice",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setBaseDiscountTaxCompensationAmount",111],"(",["T_VARIABLE","$baseTotalDiscountTaxCompensation",111],")",";",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$invoice",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","setGrandTotal",113],"(",["T_VARIABLE","$invoice",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getGrandTotal",113],"(",")",["T_WHITESPACE"," ",113],"+",["T_WHITESPACE"," ",113],["T_VARIABLE","$totalTax",113],["T_WHITESPACE"," ",113],"+",["T_WHITESPACE"," ",113],["T_VARIABLE","$totalDiscountTaxCompensation",113],")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$invoice",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","setBaseGrandTotal",114],"(",["T_VARIABLE","$invoice",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getBaseGrandTotal",114],"(",")",["T_WHITESPACE"," ",114],"+",["T_WHITESPACE"," ",114],["T_VARIABLE","$baseTotalTax",114],["T_WHITESPACE"," ",114],"+",["T_WHITESPACE"," ",114],["T_VARIABLE","$baseTotalDiscountTaxCompensation",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Check if shipping tax calculation can be included to current invoice\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Invoice $invoice\n     * @return bool\n     *\/",119],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","_canIncludeShipping",125],"(",["T_VARIABLE","$invoice",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$includeShippingTax",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","true",127],";",["T_WHITESPACE","\n        ",127],["T_DOC_COMMENT","\/**\n         * Check shipping amount in previous invoices\n         *\/",128],["T_WHITESPACE","\n        ",130],["T_FOREACH","foreach",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$invoice",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getOrder",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getInvoiceCollection",131],"(",")",["T_WHITESPACE"," ",131],["T_AS","as",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$previousInvoice",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_VARIABLE","$previousInvoice",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getShippingAmount",132],"(",")",["T_WHITESPACE"," ",132],["T_BOOLEAN_AND","&&",132],["T_WHITESPACE"," ",132],"!",["T_VARIABLE","$previousInvoice",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","isCanceled",132],"(",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$includeShippingTax",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","false",133],";",["T_WHITESPACE","\n            ",133],"}",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n        ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$includeShippingTax",136],";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n",137],"}",["T_WHITESPACE","\n",138]]