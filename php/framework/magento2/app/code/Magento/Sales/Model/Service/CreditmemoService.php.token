[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Sales",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Service",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Class CreditmemoService\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",9],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","CreditmemoService",13],["T_WHITESPACE"," ",13],["T_IMPLEMENTS","implements",13],["T_WHITESPACE"," ",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sales",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Api",13],["T_NS_SEPARATOR","\\",13],["T_STRING","CreditmemoManagementInterface",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\CreditmemoRepositoryInterface\n     *\/",15],["T_WHITESPACE","\n    ",17],["T_PROTECTED","protected",18],["T_WHITESPACE"," ",18],["T_VARIABLE","$creditmemoRepository",18],";",["T_WHITESPACE","\n\n    ",18],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\CreditmemoCommentRepositoryInterface\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$commentRepository",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Api\\SearchCriteriaBuilder\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$searchCriteriaBuilder",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Api\\FilterBuilder\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$filterBuilder",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\Order\\CreditmemoNotifier\n     *\/",35],["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$creditmemoNotifier",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Pricing\\PriceCurrencyInterface\n     *\/",40],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$priceCurrency",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Event\\ManagerInterface\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$eventManager",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\App\\ResourceConnection\n     *\/",50],["T_WHITESPACE","\n    ",52],["T_PRIVATE","private",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$resource",53],";",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\Order\\PaymentAdapterInterface\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_PRIVATE","private",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$paymentAdapter",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\OrderRepositoryInterface\n     *\/",60],["T_WHITESPACE","\n    ",62],["T_PRIVATE","private",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$orderRepository",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\InvoiceRepositoryInterface\n     *\/",65],["T_WHITESPACE","\n    ",67],["T_PRIVATE","private",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$invoiceRepository",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Api\\CreditmemoRepositoryInterface $creditmemoRepository\n     * @param \\Magento\\Sales\\Api\\CreditmemoCommentRepositoryInterface $creditmemoCommentRepository\n     * @param \\Magento\\Framework\\Api\\SearchCriteriaBuilder $searchCriteriaBuilder\n     * @param \\Magento\\Framework\\Api\\FilterBuilder $filterBuilder\n     * @param \\Magento\\Sales\\Model\\Order\\CreditmemoNotifier $creditmemoNotifier\n     * @param \\Magento\\Framework\\Pricing\\PriceCurrencyInterface $priceCurrency\n     * @param \\Magento\\Framework\\Event\\ManagerInterface $eventManager\n     *\/",70],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","__construct",79],"(",["T_WHITESPACE","\n        ",79],["T_NS_SEPARATOR","\\",80],["T_STRING","Magento",80],["T_NS_SEPARATOR","\\",80],["T_STRING","Sales",80],["T_NS_SEPARATOR","\\",80],["T_STRING","Api",80],["T_NS_SEPARATOR","\\",80],["T_STRING","CreditmemoRepositoryInterface",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$creditmemoRepository",80],",",["T_WHITESPACE","\n        ",80],["T_NS_SEPARATOR","\\",81],["T_STRING","Magento",81],["T_NS_SEPARATOR","\\",81],["T_STRING","Sales",81],["T_NS_SEPARATOR","\\",81],["T_STRING","Api",81],["T_NS_SEPARATOR","\\",81],["T_STRING","CreditmemoCommentRepositoryInterface",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$creditmemoCommentRepository",81],",",["T_WHITESPACE","\n        ",81],["T_NS_SEPARATOR","\\",82],["T_STRING","Magento",82],["T_NS_SEPARATOR","\\",82],["T_STRING","Framework",82],["T_NS_SEPARATOR","\\",82],["T_STRING","Api",82],["T_NS_SEPARATOR","\\",82],["T_STRING","SearchCriteriaBuilder",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$searchCriteriaBuilder",82],",",["T_WHITESPACE","\n        ",82],["T_NS_SEPARATOR","\\",83],["T_STRING","Magento",83],["T_NS_SEPARATOR","\\",83],["T_STRING","Framework",83],["T_NS_SEPARATOR","\\",83],["T_STRING","Api",83],["T_NS_SEPARATOR","\\",83],["T_STRING","FilterBuilder",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$filterBuilder",83],",",["T_WHITESPACE","\n        ",83],["T_NS_SEPARATOR","\\",84],["T_STRING","Magento",84],["T_NS_SEPARATOR","\\",84],["T_STRING","Sales",84],["T_NS_SEPARATOR","\\",84],["T_STRING","Model",84],["T_NS_SEPARATOR","\\",84],["T_STRING","Order",84],["T_NS_SEPARATOR","\\",84],["T_STRING","CreditmemoNotifier",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$creditmemoNotifier",84],",",["T_WHITESPACE","\n        ",84],["T_NS_SEPARATOR","\\",85],["T_STRING","Magento",85],["T_NS_SEPARATOR","\\",85],["T_STRING","Framework",85],["T_NS_SEPARATOR","\\",85],["T_STRING","Pricing",85],["T_NS_SEPARATOR","\\",85],["T_STRING","PriceCurrencyInterface",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$priceCurrency",85],",",["T_WHITESPACE","\n        ",85],["T_NS_SEPARATOR","\\",86],["T_STRING","Magento",86],["T_NS_SEPARATOR","\\",86],["T_STRING","Framework",86],["T_NS_SEPARATOR","\\",86],["T_STRING","Event",86],["T_NS_SEPARATOR","\\",86],["T_STRING","ManagerInterface",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$eventManager",86],["T_WHITESPACE","\n    ",86],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","creditmemoRepository",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$creditmemoRepository",88],";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","commentRepository",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$creditmemoCommentRepository",89],";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","searchCriteriaBuilder",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$searchCriteriaBuilder",90],";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","filterBuilder",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$filterBuilder",91],";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","creditmemoNotifier",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$creditmemoNotifier",92],";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","priceCurrency",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$priceCurrency",93],";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","eventManager",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$eventManager",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Cancel an existing creditmemo\n     *\n     * @param int $id Credit Memo Id\n     * @return bool\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",97],["T_WHITESPACE","\n    ",103],["T_PUBLIC","public",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","cancel",104],"(",["T_VARIABLE","$id",104],")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_THROW","throw",106],["T_WHITESPACE"," ",106],["T_NEW","new",106],["T_WHITESPACE"," ",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Magento",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Framework",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Exception",106],["T_NS_SEPARATOR","\\",106],["T_STRING","LocalizedException",106],"(",["T_STRING","__",106],"(",["T_CONSTANT_ENCAPSED_STRING","'You can not cancel Credit Memo'",106],")",")",";",["T_WHITESPACE","\n        ",106],["T_TRY","try",107],["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$creditmemo",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","creditmemoRepository",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","get",108],"(",["T_VARIABLE","$id",108],")",";",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$creditmemo",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","setState",109],"(",["T_NS_SEPARATOR","\\",109],["T_STRING","Magento",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Sales",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Model",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Order",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Creditmemo",109],["T_DOUBLE_COLON","::",109],["T_STRING","STATE_CANCELED",109],")",";",["T_WHITESPACE","\n            ",109],["T_FOREACH","foreach",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$creditmemo",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getAllItems",110],"(",")",["T_WHITESPACE"," ",110],["T_AS","as",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$item",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$item",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","cancel",111],"(",")",";",["T_WHITESPACE","\n            ",111],"}",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","eventManager",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","dispatch",113],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_creditmemo_cancel'",113],",",["T_WHITESPACE"," ",113],"[",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$creditmemo",113],"]",")",";",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","creditmemoRepository",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","save",114],"(",["T_VARIABLE","$creditmemo",114],")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE"," ",115],["T_CATCH","catch",115],["T_WHITESPACE"," ",115],"(",["T_NS_SEPARATOR","\\",115],["T_STRING","Exception",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$e",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_THROW","throw",116],["T_WHITESPACE"," ",116],["T_NEW","new",116],["T_WHITESPACE"," ",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Magento",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Framework",116],["T_NS_SEPARATOR","\\",116],["T_STRING","Exception",116],["T_NS_SEPARATOR","\\",116],["T_STRING","LocalizedException",116],"(",["T_STRING","__",116],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not cancel creditmemo'",116],")",",",["T_WHITESPACE"," ",116],["T_VARIABLE","$e",116],")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_STRING","true",118],";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Returns list of comments attached to creditmemo\n     *\n     * @param int $id\n     * @return \\Magento\\Sales\\Api\\Data\\CreditmemoCommentSearchResultInterface\n     *\/",121],["T_WHITESPACE","\n    ",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","getCommentsList",127],"(",["T_VARIABLE","$id",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","searchCriteriaBuilder",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","addFilters",129],"(",["T_WHITESPACE","\n            ",129],"[",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","filterBuilder",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setField",130],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",130],")",["T_OBJECT_OPERATOR","->",130],["T_STRING","setValue",130],"(",["T_VARIABLE","$id",130],")",["T_OBJECT_OPERATOR","->",130],["T_STRING","setConditionType",130],"(",["T_CONSTANT_ENCAPSED_STRING","'eq'",130],")",["T_OBJECT_OPERATOR","->",130],["T_STRING","create",130],"(",")","]",["T_WHITESPACE","\n        ",130],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$searchCriteria",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","searchCriteriaBuilder",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","create",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","commentRepository",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getList",133],"(",["T_VARIABLE","$searchCriteria",133],")",";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Notify user\n     *\n     * @param int $id\n     * @return bool\n     *\/",136],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","notify",142],"(",["T_VARIABLE","$id",142],")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$creditmemo",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","creditmemoRepository",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","get",144],"(",["T_VARIABLE","$id",144],")",";",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","creditmemoNotifier",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","notify",145],"(",["T_VARIABLE","$creditmemo",145],")",";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Prepare creditmemo to refund and save it.\n     *\n     * @param \\Magento\\Sales\\Api\\Data\\CreditmemoInterface $creditmemo\n     * @param bool $offlineRequested\n     * @return \\Magento\\Sales\\Api\\Data\\CreditmemoInterface\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",148],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","refund",156],"(",["T_WHITESPACE","\n        ",156],["T_NS_SEPARATOR","\\",157],["T_STRING","Magento",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Sales",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Api",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Data",157],["T_NS_SEPARATOR","\\",157],["T_STRING","CreditmemoInterface",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$creditmemo",157],",",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$offlineRequested",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","false",158],["T_WHITESPACE","\n    ",158],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","validateForRefund",160],"(",["T_VARIABLE","$creditmemo",160],")",";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$creditmemo",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","setState",161],"(",["T_NS_SEPARATOR","\\",161],["T_STRING","Magento",161],["T_NS_SEPARATOR","\\",161],["T_STRING","Sales",161],["T_NS_SEPARATOR","\\",161],["T_STRING","Model",161],["T_NS_SEPARATOR","\\",161],["T_STRING","Order",161],["T_NS_SEPARATOR","\\",161],["T_STRING","Creditmemo",161],["T_DOUBLE_COLON","::",161],["T_STRING","STATE_REFUNDED",161],")",";",["T_WHITESPACE","\n\n        ",161],["T_VARIABLE","$connection",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getResource",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","getConnection",163],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",163],")",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$connection",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","beginTransaction",164],"(",")",";",["T_WHITESPACE","\n        ",164],["T_TRY","try",165],["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$order",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getPaymentAdapter",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","refund",166],"(",["T_WHITESPACE","\n                ",166],["T_VARIABLE","$creditmemo",167],",",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$creditmemo",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getOrder",168],"(",")",",",["T_WHITESPACE","\n                ",168],"!",["T_VARIABLE","$offlineRequested",169],["T_WHITESPACE","\n            ",169],")",";",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getOrderRepository",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","save",171],"(",["T_VARIABLE","$order",171],")",";",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$invoice",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$creditmemo",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getInvoice",172],"(",")",";",["T_WHITESPACE","\n            ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$invoice",173],["T_WHITESPACE"," ",173],["T_BOOLEAN_AND","&&",173],["T_WHITESPACE"," ",173],"!",["T_VARIABLE","$offlineRequested",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n                ",173],["T_VARIABLE","$invoice",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","setIsUsedForRefund",174],"(",["T_STRING","true",174],")",";",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$invoice",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setBaseTotalRefunded",175],"(",["T_WHITESPACE","\n                    ",175],["T_VARIABLE","$invoice",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getBaseTotalRefunded",176],"(",")",["T_WHITESPACE"," ",176],"+",["T_WHITESPACE"," ",176],["T_VARIABLE","$creditmemo",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getBaseGrandTotal",176],"(",")",["T_WHITESPACE","\n                ",176],")",";",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$creditmemo",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","setInvoiceId",178],"(",["T_VARIABLE","$invoice",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getId",178],"(",")",")",";",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getInvoiceRepository",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","save",179],"(",["T_VARIABLE","$creditmemo",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getInvoice",179],"(",")",")",";",["T_WHITESPACE","\n            ",179],"}",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","creditmemoRepository",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","save",181],"(",["T_VARIABLE","$creditmemo",181],")",";",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$connection",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","commit",182],"(",")",";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE"," ",183],["T_CATCH","catch",183],["T_WHITESPACE"," ",183],"(",["T_NS_SEPARATOR","\\",183],["T_STRING","Exception",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$e",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$connection",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","rollBack",184],"(",")",";",["T_WHITESPACE","\n            ",184],["T_THROW","throw",185],["T_WHITESPACE"," ",185],["T_NEW","new",185],["T_WHITESPACE"," ",185],["T_NS_SEPARATOR","\\",185],["T_STRING","Magento",185],["T_NS_SEPARATOR","\\",185],["T_STRING","Framework",185],["T_NS_SEPARATOR","\\",185],["T_STRING","Exception",185],["T_NS_SEPARATOR","\\",185],["T_STRING","LocalizedException",185],"(",["T_STRING","__",185],"(",["T_VARIABLE","$e",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getMessage",185],"(",")",")",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$creditmemo",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Api\\Data\\CreditmemoInterface $creditmemo\n     * @return bool\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     *\/",191],["T_WHITESPACE","\n    ",195],["T_PROTECTED","protected",196],["T_WHITESPACE"," ",196],["T_FUNCTION","function",196],["T_WHITESPACE"," ",196],["T_STRING","validateForRefund",196],"(",["T_NS_SEPARATOR","\\",196],["T_STRING","Magento",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Sales",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Api",196],["T_NS_SEPARATOR","\\",196],["T_STRING","Data",196],["T_NS_SEPARATOR","\\",196],["T_STRING","CreditmemoInterface",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$creditmemo",196],")",["T_WHITESPACE","\n    ",196],"{",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$creditmemo",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getId",198],"(",")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_THROW","throw",199],["T_WHITESPACE"," ",199],["T_NEW","new",199],["T_WHITESPACE"," ",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Magento",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Framework",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Exception",199],["T_NS_SEPARATOR","\\",199],["T_STRING","LocalizedException",199],"(",["T_WHITESPACE","\n                ",199],["T_STRING","__",200],"(",["T_CONSTANT_ENCAPSED_STRING","'We cannot register an existing credit memo.'",200],")",["T_WHITESPACE","\n            ",200],")",";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n\n        ",202],["T_VARIABLE","$baseOrderRefund",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","priceCurrency",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","round",204],"(",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$creditmemo",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getOrder",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getBaseTotalRefunded",205],"(",")",["T_WHITESPACE"," ",205],"+",["T_WHITESPACE"," ",205],["T_VARIABLE","$creditmemo",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getBaseGrandTotal",205],"(",")",["T_WHITESPACE","\n        ",205],")",";",["T_WHITESPACE","\n        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$baseOrderRefund",207],["T_WHITESPACE"," ",207],">",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","priceCurrency",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","round",207],"(",["T_VARIABLE","$creditmemo",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getOrder",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getBaseTotalPaid",207],"(",")",")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$baseAvailableRefund",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$creditmemo",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getOrder",208],"(",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","getBaseTotalPaid",208],"(",")",["T_WHITESPACE","\n                ",208],"-",["T_WHITESPACE"," ",209],["T_VARIABLE","$creditmemo",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getOrder",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getBaseTotalRefunded",209],"(",")",";",["T_WHITESPACE","\n\n            ",209],["T_THROW","throw",211],["T_WHITESPACE"," ",211],["T_NEW","new",211],["T_WHITESPACE"," ",211],["T_NS_SEPARATOR","\\",211],["T_STRING","Magento",211],["T_NS_SEPARATOR","\\",211],["T_STRING","Framework",211],["T_NS_SEPARATOR","\\",211],["T_STRING","Exception",211],["T_NS_SEPARATOR","\\",211],["T_STRING","LocalizedException",211],"(",["T_WHITESPACE","\n                ",211],["T_STRING","__",212],"(",["T_WHITESPACE","\n                    ",212],["T_CONSTANT_ENCAPSED_STRING","'The most money available to refund is %1.'",213],",",["T_WHITESPACE","\n                    ",213],["T_VARIABLE","$creditmemo",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getOrder",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","formatBasePrice",214],"(",["T_VARIABLE","$baseAvailableRefund",214],")",["T_WHITESPACE","\n                ",214],")",["T_WHITESPACE","\n            ",215],")",";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n        ",217],["T_RETURN","return",218],["T_WHITESPACE"," ",218],["T_STRING","true",218],";",["T_WHITESPACE","\n    ",218],"}",["T_WHITESPACE","\n\n    ",219],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Sales\\Model\\Order\\PaymentAdapterInterface\n     *\n     * @deprecated\n     *\/",221],["T_WHITESPACE","\n    ",225],["T_PRIVATE","private",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","getPaymentAdapter",226],"(",")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_IF","if",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","paymentAdapter",228],["T_WHITESPACE"," ",228],["T_IS_IDENTICAL","===",228],["T_WHITESPACE"," ",228],["T_STRING","null",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","paymentAdapter",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Magento",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Framework",229],["T_NS_SEPARATOR","\\",229],["T_STRING","App",229],["T_NS_SEPARATOR","\\",229],["T_STRING","ObjectManager",229],["T_DOUBLE_COLON","::",229],["T_STRING","getInstance",229],"(",")",["T_WHITESPACE","\n                ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","get",230],"(",["T_NS_SEPARATOR","\\",230],["T_STRING","Magento",230],["T_NS_SEPARATOR","\\",230],["T_STRING","Sales",230],["T_NS_SEPARATOR","\\",230],["T_STRING","Model",230],["T_NS_SEPARATOR","\\",230],["T_STRING","Order",230],["T_NS_SEPARATOR","\\",230],["T_STRING","PaymentAdapterInterface",230],["T_DOUBLE_COLON","::",230],["T_CLASS","class",230],")",";",["T_WHITESPACE","\n        ",230],"}",["T_WHITESPACE","\n        ",231],["T_RETURN","return",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","paymentAdapter",232],";",["T_WHITESPACE","\n    ",232],"}",["T_WHITESPACE","\n\n    ",233],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Framework\\App\\ResourceConnection|mixed\n     *\n     * @deprecated\n     *\/",235],["T_WHITESPACE","\n    ",239],["T_PRIVATE","private",240],["T_WHITESPACE"," ",240],["T_FUNCTION","function",240],["T_WHITESPACE"," ",240],["T_STRING","getResource",240],"(",")",["T_WHITESPACE","\n    ",240],"{",["T_WHITESPACE","\n        ",241],["T_IF","if",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","resource",242],["T_WHITESPACE"," ",242],["T_IS_IDENTICAL","===",242],["T_WHITESPACE"," ",242],["T_STRING","null",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","resource",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Magento",243],["T_NS_SEPARATOR","\\",243],["T_STRING","Framework",243],["T_NS_SEPARATOR","\\",243],["T_STRING","App",243],["T_NS_SEPARATOR","\\",243],["T_STRING","ObjectManager",243],["T_DOUBLE_COLON","::",243],["T_STRING","getInstance",243],"(",")",["T_WHITESPACE","\n                ",243],["T_OBJECT_OPERATOR","->",244],["T_STRING","get",244],"(",["T_NS_SEPARATOR","\\",244],["T_STRING","Magento",244],["T_NS_SEPARATOR","\\",244],["T_STRING","Framework",244],["T_NS_SEPARATOR","\\",244],["T_STRING","App",244],["T_NS_SEPARATOR","\\",244],["T_STRING","ResourceConnection",244],["T_DOUBLE_COLON","::",244],["T_CLASS","class",244],")",";",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE","\n        ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","resource",246],";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Sales\\Api\\OrderRepositoryInterface\n     *\n     * @deprecated\n     *\/",249],["T_WHITESPACE","\n    ",253],["T_PRIVATE","private",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","getOrderRepository",254],"(",")",["T_WHITESPACE","\n    ",254],"{",["T_WHITESPACE","\n        ",255],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","orderRepository",256],["T_WHITESPACE"," ",256],["T_IS_IDENTICAL","===",256],["T_WHITESPACE"," ",256],["T_STRING","null",256],")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","orderRepository",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_NS_SEPARATOR","\\",257],["T_STRING","Magento",257],["T_NS_SEPARATOR","\\",257],["T_STRING","Framework",257],["T_NS_SEPARATOR","\\",257],["T_STRING","App",257],["T_NS_SEPARATOR","\\",257],["T_STRING","ObjectManager",257],["T_DOUBLE_COLON","::",257],["T_STRING","getInstance",257],"(",")",["T_WHITESPACE","\n                ",257],["T_OBJECT_OPERATOR","->",258],["T_STRING","get",258],"(",["T_NS_SEPARATOR","\\",258],["T_STRING","Magento",258],["T_NS_SEPARATOR","\\",258],["T_STRING","Sales",258],["T_NS_SEPARATOR","\\",258],["T_STRING","Api",258],["T_NS_SEPARATOR","\\",258],["T_STRING","OrderRepositoryInterface",258],["T_DOUBLE_COLON","::",258],["T_CLASS","class",258],")",";",["T_WHITESPACE","\n        ",258],"}",["T_WHITESPACE","\n        ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","orderRepository",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * @return \\Magento\\Sales\\Api\\InvoiceRepositoryInterface\n     *\n     * @deprecated\n     *\/",263],["T_WHITESPACE","\n    ",267],["T_PRIVATE","private",268],["T_WHITESPACE"," ",268],["T_FUNCTION","function",268],["T_WHITESPACE"," ",268],["T_STRING","getInvoiceRepository",268],"(",")",["T_WHITESPACE","\n    ",268],"{",["T_WHITESPACE","\n        ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","invoiceRepository",270],["T_WHITESPACE"," ",270],["T_IS_IDENTICAL","===",270],["T_WHITESPACE"," ",270],["T_STRING","null",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","invoiceRepository",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Magento",271],["T_NS_SEPARATOR","\\",271],["T_STRING","Framework",271],["T_NS_SEPARATOR","\\",271],["T_STRING","App",271],["T_NS_SEPARATOR","\\",271],["T_STRING","ObjectManager",271],["T_DOUBLE_COLON","::",271],["T_STRING","getInstance",271],"(",")",["T_WHITESPACE","\n                ",271],["T_OBJECT_OPERATOR","->",272],["T_STRING","get",272],"(",["T_NS_SEPARATOR","\\",272],["T_STRING","Magento",272],["T_NS_SEPARATOR","\\",272],["T_STRING","Sales",272],["T_NS_SEPARATOR","\\",272],["T_STRING","Api",272],["T_NS_SEPARATOR","\\",272],["T_STRING","InvoiceRepositoryInterface",272],["T_DOUBLE_COLON","::",272],["T_CLASS","class",272],")",";",["T_WHITESPACE","\n        ",272],"}",["T_WHITESPACE","\n        ",273],["T_RETURN","return",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","invoiceRepository",274],";",["T_WHITESPACE","\n    ",274],"}",["T_WHITESPACE","\n",275],"}",["T_WHITESPACE","\n",276]]