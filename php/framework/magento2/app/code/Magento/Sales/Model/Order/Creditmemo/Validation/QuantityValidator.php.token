[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Order",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Creditmemo",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Validation",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Sales",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Api",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Data",8],["T_NS_SEPARATOR","\\",8],["T_STRING","OrderInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Sales",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","OrderItemInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Sales",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Data",10],["T_NS_SEPARATOR","\\",10],["T_STRING","CreditmemoInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Sales",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Api",11],["T_NS_SEPARATOR","\\",11],["T_STRING","InvoiceRepositoryInterface",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Sales",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Api",12],["T_NS_SEPARATOR","\\",12],["T_STRING","OrderRepositoryInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sales",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Order",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Sales",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Order",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Creditmemo",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Magento",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Sales",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Model",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Order",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Item",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Magento",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Sales",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Model",16],["T_NS_SEPARATOR","\\",16],["T_STRING","ValidatorInterface",16],";",["T_WHITESPACE","\n\n",16],["T_DOC_COMMENT","\/**\n * Class QuantityValidator\n *\/",18],["T_WHITESPACE","\n",20],["T_CLASS","class",21],["T_WHITESPACE"," ",21],["T_STRING","QuantityValidator",21],["T_WHITESPACE"," ",21],["T_IMPLEMENTS","implements",21],["T_WHITESPACE"," ",21],["T_STRING","ValidatorInterface",21],["T_WHITESPACE","\n",21],"{",["T_WHITESPACE","\n    ",22],["T_DOC_COMMENT","\/**\n     * @var OrderRepositoryInterface\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$orderRepository",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @var InvoiceRepositoryInterface\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PRIVATE","private",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$invoiceRepository",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Pricing\\PriceCurrencyInterface\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PRIVATE","private",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$priceCurrency",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * InvoiceValidator constructor.\n     *\n     * @param OrderRepositoryInterface $orderRepository\n     * @param InvoiceRepositoryInterface $invoiceRepository\n     * @param \\Magento\\Framework\\Pricing\\PriceCurrencyInterface $priceCurrency\n     *\/",38],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","__construct",45],"(",["T_WHITESPACE","\n        ",45],["T_STRING","OrderRepositoryInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$orderRepository",46],",",["T_WHITESPACE","\n        ",46],["T_STRING","InvoiceRepositoryInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$invoiceRepository",47],",",["T_WHITESPACE","\n        ",47],["T_NS_SEPARATOR","\\",48],["T_STRING","Magento",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Framework",48],["T_NS_SEPARATOR","\\",48],["T_STRING","Pricing",48],["T_NS_SEPARATOR","\\",48],["T_STRING","PriceCurrencyInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$priceCurrency",48],["T_WHITESPACE","\n    ",48],")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","orderRepository",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$orderRepository",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","invoiceRepository",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$invoiceRepository",51],";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","priceCurrency",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$priceCurrency",52],";",["T_WHITESPACE","\n    ",52],"}",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * @inheritdoc\n     *\/",55],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","validate",58],"(",["T_VARIABLE","$entity",58],")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_DOC_COMMENT","\/**\n         * @var $entity CreditmemoInterface\n         *\/",60],["T_WHITESPACE","\n        ",62],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$entity",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getOrderId",63],"(",")",["T_WHITESPACE"," ",63],["T_IS_IDENTICAL","===",63],["T_WHITESPACE"," ",63],["T_STRING","null",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],"[",["T_STRING","__",64],"(",["T_CONSTANT_ENCAPSED_STRING","'Order Id is required for creditmemo document'",64],")","]",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n\n        ",65],["T_VARIABLE","$messages",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],"[","]",";",["T_WHITESPACE","\n\n        ",67],["T_VARIABLE","$order",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","orderRepository",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_VARIABLE","$entity",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getOrderId",69],"(",")",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$orderItemsById",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getOrderItems",70],"(",["T_VARIABLE","$order",70],")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$invoiceQtysRefundLimits",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getInvoiceQtysRefundLimits",71],"(",["T_VARIABLE","$entity",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$order",71],")",";",["T_WHITESPACE","\n\n        ",71],["T_VARIABLE","$totalQuantity",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_LNUMBER","0",73],";",["T_WHITESPACE","\n        ",73],["T_FOREACH","foreach",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$entity",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getItems",74],"(",")",["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$item",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_ISSET","isset",75],"(",["T_VARIABLE","$orderItemsById",75],"[",["T_VARIABLE","$item",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getOrderItemId",75],"(",")","]",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$messages",76],"[","]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","__",76],"(",["T_WHITESPACE","\n                    ",76],["T_CONSTANT_ENCAPSED_STRING","'The creditmemo contains product SKU \"%1\" that is not part of the original order.'",77],",",["T_WHITESPACE","\n                    ",77],["T_VARIABLE","$item",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getSku",78],"(",")",["T_WHITESPACE","\n                ",78],")",";",["T_WHITESPACE","\n                ",79],["T_CONTINUE","continue",80],";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$orderItem",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$orderItemsById",82],"[",["T_VARIABLE","$item",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getOrderItemId",82],"(",")","]",";",["T_WHITESPACE","\n\n            ",82],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_WHITESPACE","\n                ",84],"!",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","canRefundItem",85],"(",["T_VARIABLE","$orderItem",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$item",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getQty",85],"(",")",",",["T_WHITESPACE"," ",85],["T_VARIABLE","$invoiceQtysRefundLimits",85],")",["T_WHITESPACE"," ",85],["T_BOOLEAN_OR","||",85],["T_WHITESPACE","\n                ",85],"!",["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","isQtyAvailable",86],"(",["T_VARIABLE","$orderItem",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$item",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getQty",86],"(",")",")",["T_WHITESPACE","\n            ",86],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n                ",87],["T_VARIABLE","$messages",88],"[","]",["T_WHITESPACE"," ",88],"=",["T_STRING","__",88],"(",["T_WHITESPACE","\n                    ",88],["T_CONSTANT_ENCAPSED_STRING","'The quantity to creditmemo must not be greater than the unrefunded quantity'",89],["T_WHITESPACE","\n                    ",89],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","' for product SKU \"%1\".'",90],",",["T_WHITESPACE","\n                    ",90],["T_VARIABLE","$orderItem",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getSku",91],"(",")",["T_WHITESPACE","\n                ",91],")",";",["T_WHITESPACE","\n            ",92],"}",["T_WHITESPACE"," ",93],["T_ELSE","else",93],["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$totalQuantity",94],["T_WHITESPACE"," ",94],["T_PLUS_EQUAL","+=",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$item",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getQty",94],"(",")",";",["T_WHITESPACE","\n            ",94],"}",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n\n        ",96],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$entity",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getGrandTotal",98],"(",")",["T_WHITESPACE"," ",98],["T_IS_SMALLER_OR_EQUAL","<=",98],["T_WHITESPACE"," ",98],["T_LNUMBER","0",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$messages",99],"[","]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","__",99],"(",["T_CONSTANT_ENCAPSED_STRING","'The credit memo\\'s total must be positive.'",99],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE"," ",100],["T_ELSEIF","elseif",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$totalQuantity",100],["T_WHITESPACE"," ",100],["T_IS_SMALLER_OR_EQUAL","<=",100],["T_WHITESPACE"," ",100],["T_LNUMBER","0",100],["T_WHITESPACE"," ",100],["T_BOOLEAN_AND","&&",100],["T_WHITESPACE"," ",100],"!",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","canRefundShipping",100],"(",["T_VARIABLE","$order",100],")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$messages",101],"[","]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","__",101],"(",["T_CONSTANT_ENCAPSED_STRING","'You can\\'t create a creditmemo without products.'",101],")",";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n\n        ",102],["T_RETURN","return",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$messages",104],";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * We can have problem with float in php (on some server $a=762.73;$b=762.73; $a-$b!=0)\n     * for this we have additional diapason for 0\n     * TotalPaid - contains amount, that were not rounded.\n     *\n     * @param OrderInterface $order\n     * @return bool\n     *\/",107],["T_WHITESPACE","\n    ",114],["T_PRIVATE","private",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","canRefundShipping",115],"(",["T_STRING","OrderInterface",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$order",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_RETURN","return",117],["T_WHITESPACE"," ",117],"!",["T_STRING","abs",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","priceCurrency",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","round",117],"(",["T_VARIABLE","$order",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getShippingAmount",117],"(",")",")",["T_WHITESPACE"," ",117],"-",["T_WHITESPACE"," ",117],["T_VARIABLE","$order",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getShippingRefunded",117],"(",")",")",["T_WHITESPACE"," ",117],"<",["T_WHITESPACE"," ",117],["T_DNUMBER",".0001",117],";",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * @param CreditmemoInterface $creditmemo\n     * @param OrderInterface $order\n     * @return array\n     *\/",120],["T_WHITESPACE","\n    ",124],["T_PRIVATE","private",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","getInvoiceQtysRefundLimits",125],"(",["T_STRING","CreditmemoInterface",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$creditmemo",125],",",["T_WHITESPACE"," ",125],["T_STRING","OrderInterface",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$order",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$invoiceQtysRefundLimits",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],"[","]",";",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$creditmemo",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getInvoiceId",128],"(",")",["T_WHITESPACE"," ",128],["T_IS_NOT_IDENTICAL","!==",128],["T_WHITESPACE"," ",128],["T_STRING","null",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$invoiceQtysRefunded",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],"[","]",";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$invoice",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","invoiceRepository",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","get",130],"(",["T_VARIABLE","$creditmemo",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getInvoiceId",130],"(",")",")",";",["T_WHITESPACE","\n            ",130],["T_FOREACH","foreach",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$order",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getCreditmemosCollection",131],"(",")",["T_WHITESPACE"," ",131],["T_AS","as",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$createdCreditmemo",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_WHITESPACE","\n                    ",132],["T_VARIABLE","$createdCreditmemo",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getState",133],"(",")",["T_WHITESPACE"," ",133],["T_IS_NOT_EQUAL","!=",133],["T_WHITESPACE"," ",133],["T_STRING","Creditmemo",133],["T_DOUBLE_COLON","::",133],["T_STRING","STATE_CANCELED",133],["T_WHITESPACE"," ",133],["T_BOOLEAN_AND","&&",133],["T_WHITESPACE","\n                    ",133],["T_VARIABLE","$createdCreditmemo",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getInvoiceId",134],"(",")",["T_WHITESPACE"," ",134],["T_IS_EQUAL","==",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$invoice",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getId",134],"(",")",["T_WHITESPACE","\n                ",134],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                    ",135],["T_FOREACH","foreach",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$createdCreditmemo",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getAllItems",136],"(",")",["T_WHITESPACE"," ",136],["T_AS","as",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$createdCreditmemoItem",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                        ",136],["T_VARIABLE","$orderItemId",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$createdCreditmemoItem",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getOrderItem",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",";",["T_WHITESPACE","\n                        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_ISSET","isset",138],"(",["T_VARIABLE","$invoiceQtysRefunded",138],"[",["T_VARIABLE","$orderItemId",138],"]",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n                            ",138],["T_VARIABLE","$invoiceQtysRefunded",139],"[",["T_VARIABLE","$orderItemId",139],"]",["T_WHITESPACE"," ",139],["T_PLUS_EQUAL","+=",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$createdCreditmemoItem",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getQty",139],"(",")",";",["T_WHITESPACE","\n                        ",139],"}",["T_WHITESPACE"," ",140],["T_ELSE","else",140],["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                            ",140],["T_VARIABLE","$invoiceQtysRefunded",141],"[",["T_VARIABLE","$orderItemId",141],"]",["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$createdCreditmemoItem",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getQty",141],"(",")",";",["T_WHITESPACE","\n                        ",141],"}",["T_WHITESPACE","\n                    ",142],"}",["T_WHITESPACE","\n                ",143],"}",["T_WHITESPACE","\n            ",144],"}",["T_WHITESPACE","\n\n            ",145],["T_FOREACH","foreach",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$invoice",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getItems",147],"(",")",["T_WHITESPACE"," ",147],["T_AS","as",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$invoiceItem",147],")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$invoiceQtyCanBeRefunded",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_VARIABLE","$invoiceItem",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getQty",148],"(",")",";",["T_WHITESPACE","\n                ",148],["T_VARIABLE","$orderItemId",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$invoiceItem",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getOrderItem",149],"(",")",["T_OBJECT_OPERATOR","->",149],["T_STRING","getId",149],"(",")",";",["T_WHITESPACE","\n                ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_ISSET","isset",150],"(",["T_VARIABLE","$invoiceQtysRefunded",150],"[",["T_VARIABLE","$orderItemId",150],"]",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                    ",150],["T_VARIABLE","$invoiceQtyCanBeRefunded",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$invoiceQtyCanBeRefunded",151],["T_WHITESPACE"," ",151],"-",["T_WHITESPACE"," ",151],["T_VARIABLE","$invoiceQtysRefunded",151],"[",["T_VARIABLE","$orderItemId",151],"]",";",["T_WHITESPACE","\n                ",151],"}",["T_WHITESPACE","\n                ",152],["T_VARIABLE","$invoiceQtysRefundLimits",153],"[",["T_VARIABLE","$orderItemId",153],"]",["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$invoiceQtyCanBeRefunded",153],";",["T_WHITESPACE","\n            ",153],"}",["T_WHITESPACE","\n        ",154],"}",["T_WHITESPACE","\n\n        ",155],["T_RETURN","return",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$invoiceQtysRefundLimits",157],";",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * @param OrderInterface $order\n     * @return OrderItemInterface[]\n     *\/",160],["T_WHITESPACE","\n    ",163],["T_PRIVATE","private",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","getOrderItems",164],"(",["T_STRING","OrderInterface",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$order",164],")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$orderItemsById",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],"[","]",";",["T_WHITESPACE","\n        ",166],["T_FOREACH","foreach",167],["T_WHITESPACE"," ",167],"(",["T_VARIABLE","$order",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getItems",167],"(",")",["T_WHITESPACE"," ",167],["T_AS","as",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$item",167],")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$orderItemsById",168],"[",["T_VARIABLE","$item",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getItemId",168],"(",")","]",["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$item",168],";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$orderItemsById",171],";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * @param Item $orderItem\n     * @param int $qty\n     * @return bool\n     *\/",174],["T_WHITESPACE","\n    ",178],["T_PRIVATE","private",179],["T_WHITESPACE"," ",179],["T_FUNCTION","function",179],["T_WHITESPACE"," ",179],["T_STRING","isQtyAvailable",179],"(",["T_STRING","Item",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$orderItem",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$qty",179],")",["T_WHITESPACE","\n    ",179],"{",["T_WHITESPACE","\n        ",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$qty",181],["T_WHITESPACE"," ",181],["T_IS_SMALLER_OR_EQUAL","<=",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$orderItem",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getQtyToRefund",181],"(",")",["T_WHITESPACE"," ",181],["T_BOOLEAN_OR","||",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$orderItem",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","isDummy",181],"(",")",";",["T_WHITESPACE","\n    ",181],"}",["T_WHITESPACE","\n\n    ",182],["T_DOC_COMMENT","\/**\n     * Check if order item can be refunded\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Item $item\n     * @param double $qty\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",184],["T_WHITESPACE","\n    ",191],["T_PRIVATE","private",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","canRefundItem",192],"(",["T_NS_SEPARATOR","\\",192],["T_STRING","Magento",192],["T_NS_SEPARATOR","\\",192],["T_STRING","Sales",192],["T_NS_SEPARATOR","\\",192],["T_STRING","Model",192],["T_NS_SEPARATOR","\\",192],["T_STRING","Order",192],["T_NS_SEPARATOR","\\",192],["T_STRING","Item",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$item",192],",",["T_WHITESPACE"," ",192],["T_VARIABLE","$qty",192],",",["T_WHITESPACE"," ",192],["T_ARRAY","array",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$invoiceQtysRefundLimits",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_VARIABLE","$item",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","isDummy",194],"(",")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","canRefundDummyItem",195],"(",["T_VARIABLE","$item",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$qty",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$invoiceQtysRefundLimits",195],")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n\n        ",196],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","canRefundNoDummyItem",198],"(",["T_VARIABLE","$item",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$invoiceQtysRefundLimits",198],")",";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Check if no dummy order item can be refunded\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Item $item\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",201],["T_WHITESPACE","\n    ",207],["T_PRIVATE","private",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","canRefundNoDummyItem",208],"(",["T_NS_SEPARATOR","\\",208],["T_STRING","Magento",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Sales",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Model",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Order",208],["T_NS_SEPARATOR","\\",208],["T_STRING","Item",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$item",208],",",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$invoiceQtysRefundLimits",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],"[","]",")",["T_WHITESPACE","\n    ",208],"{",["T_WHITESPACE","\n        ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$item",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getQtyToRefund",210],"(",")",["T_WHITESPACE"," ",210],"<",["T_WHITESPACE"," ",210],["T_LNUMBER","0",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_STRING","false",211],";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n        ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_ISSET","isset",213],"(",["T_VARIABLE","$invoiceQtysRefundLimits",213],"[",["T_VARIABLE","$item",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getId",213],"(",")","]",")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$invoiceQtysRefundLimits",214],"[",["T_VARIABLE","$item",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getId",214],"(",")","]",["T_WHITESPACE"," ",214],">",["T_WHITESPACE"," ",214],["T_LNUMBER","0",214],";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n        ",215],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_STRING","true",216],";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * @param Item $item\n     * @param int $qty\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",219],["T_WHITESPACE","\n    ",224],["T_PRIVATE","private",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","canRefundDummyItem",225],"(",["T_NS_SEPARATOR","\\",225],["T_STRING","Magento",225],["T_NS_SEPARATOR","\\",225],["T_STRING","Sales",225],["T_NS_SEPARATOR","\\",225],["T_STRING","Model",225],["T_NS_SEPARATOR","\\",225],["T_STRING","Order",225],["T_NS_SEPARATOR","\\",225],["T_STRING","Item",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$item",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$qty",225],",",["T_WHITESPACE"," ",225],["T_ARRAY","array",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$invoiceQtysRefundLimits",225],")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(",["T_VARIABLE","$item",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getHasChildren",227],"(",")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_FOREACH","foreach",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$item",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getChildrenItems",228],"(",")",["T_WHITESPACE"," ",228],["T_AS","as",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$child",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n                ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","canRefundRequestedQty",229],"(",["T_VARIABLE","$child",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$qty",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$invoiceQtysRefundLimits",229],")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                    ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_STRING","true",230],";",["T_WHITESPACE","\n                ",230],"}",["T_WHITESPACE","\n            ",231],"}",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE"," ",233],["T_ELSEIF","elseif",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$item",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getParentItem",233],"(",")",")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","canRefundRequestedQty",234],"(",["T_VARIABLE","$item",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getParentItem",234],"(",")",",",["T_WHITESPACE"," ",234],["T_VARIABLE","$qty",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$invoiceQtysRefundLimits",234],")",";",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n\n        ",235],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_STRING","false",237],";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * @param Item $item\n     * @param int $qty\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",240],["T_WHITESPACE","\n    ",245],["T_PRIVATE","private",246],["T_WHITESPACE"," ",246],["T_FUNCTION","function",246],["T_WHITESPACE"," ",246],["T_STRING","canRefundRequestedQty",246],"(",["T_WHITESPACE","\n        ",246],["T_NS_SEPARATOR","\\",247],["T_STRING","Magento",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Sales",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Model",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Order",247],["T_NS_SEPARATOR","\\",247],["T_STRING","Item",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$item",247],",",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$qty",248],",",["T_WHITESPACE","\n        ",248],["T_ARRAY","array",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$invoiceQtysRefundLimits",249],["T_WHITESPACE","\n    ",249],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n        ",250],["T_RETURN","return",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$qty",251],["T_WHITESPACE"," ",251],["T_IS_IDENTICAL","===",251],["T_WHITESPACE"," ",251],["T_STRING","null",251],["T_WHITESPACE"," ",251],"?",["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","canRefundNoDummyItem",251],"(",["T_VARIABLE","$item",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$invoiceQtysRefundLimits",251],")",["T_WHITESPACE"," ",251],":",["T_WHITESPACE"," ",251],["T_VARIABLE","$qty",251],["T_WHITESPACE"," ",251],">",["T_WHITESPACE"," ",251],["T_LNUMBER","0",251],";",["T_WHITESPACE","\n    ",251],"}",["T_WHITESPACE","\n",252],"}",["T_WHITESPACE","\n",253]]