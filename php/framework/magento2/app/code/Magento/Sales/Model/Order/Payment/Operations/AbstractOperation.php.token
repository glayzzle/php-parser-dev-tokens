[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Order",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Payment",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Operations",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Framework",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Event",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ManagerInterface",8],["T_WHITESPACE"," ",8],["T_AS","as",8],["T_WHITESPACE"," ",8],["T_STRING","EventManagerInterface",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Sales",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Api",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Data",9],["T_NS_SEPARATOR","\\",9],["T_STRING","OrderInterface",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Magento",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Sales",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Api",10],["T_NS_SEPARATOR","\\",10],["T_STRING","Data",10],["T_NS_SEPARATOR","\\",10],["T_STRING","OrderPaymentInterface",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Magento",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Sales",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Model",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Order",11],["T_NS_SEPARATOR","\\",11],["T_STRING","Invoice",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","Magento",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Sales",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Model",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Order",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Payment",12],["T_NS_SEPARATOR","\\",12],["T_STRING","State",12],["T_NS_SEPARATOR","\\",12],["T_STRING","CommandInterface",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","Magento",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Sales",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Model",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Order",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Payment",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Transaction",13],["T_NS_SEPARATOR","\\",13],["T_STRING","BuilderInterface",13],";",["T_WHITESPACE","\n",13],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Magento",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Sales",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Model",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Order",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Payment",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Transaction",14],["T_NS_SEPARATOR","\\",14],["T_STRING","ManagerInterface",14],";",["T_WHITESPACE","\n\n",14],["T_ABSTRACT","abstract",16],["T_WHITESPACE"," ",16],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","AbstractOperation",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * @var CommandInterface\n     *\/",18],["T_WHITESPACE","\n    ",20],["T_PROTECTED","protected",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$stateCommand",21],";",["T_WHITESPACE","\n\n    ",21],["T_DOC_COMMENT","\/**\n     * @var BuilderInterface\n     *\/",23],["T_WHITESPACE","\n    ",25],["T_PROTECTED","protected",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$transactionBuilder",26],";",["T_WHITESPACE","\n\n    ",26],["T_DOC_COMMENT","\/**\n     * @var ManagerInterface\n     *\/",28],["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$transactionManager",31],";",["T_WHITESPACE","\n\n    ",31],["T_DOC_COMMENT","\/**\n     * @var EventManagerInterface\n     *\/",33],["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$eventManager",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * @param CommandInterface $stateCommand\n     * @param BuilderInterface $transactionBuilder\n     * @param ManagerInterface $transactionManager\n     * @param EventManagerInterface $eventManager\n     *\/",38],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","__construct",44],"(",["T_WHITESPACE","\n        ",44],["T_STRING","CommandInterface",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$stateCommand",45],",",["T_WHITESPACE","\n        ",45],["T_STRING","BuilderInterface",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$transactionBuilder",46],",",["T_WHITESPACE","\n        ",46],["T_STRING","ManagerInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$transactionManager",47],",",["T_WHITESPACE","\n        ",47],["T_STRING","EventManagerInterface",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$eventManager",48],["T_WHITESPACE","\n    ",48],")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","stateCommand",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$stateCommand",50],";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","transactionBuilder",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$transactionBuilder",51],";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","transactionManager",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$transactionManager",52],";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","eventManager",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$eventManager",53],";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Create new invoice with maximum qty for invoice for each item\n     * register this invoice and capture\n     *\n     * @param OrderPaymentInterface $payment\n     * @return Invoice\n     *\/",56],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","invoice",63],"(",["T_STRING","OrderPaymentInterface",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$payment",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_DOC_COMMENT","\/** @var Invoice $invoice *\/",65],["T_WHITESPACE","\n        ",65],["T_VARIABLE","$invoice",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$payment",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getOrder",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","prepareInvoice",66],"(",")",";",["T_WHITESPACE","\n\n        ",66],["T_VARIABLE","$invoice",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","register",68],"(",")",";",["T_WHITESPACE","\n        ",68],["T_IF","if",69],["T_WHITESPACE"," ",69],"(",["T_VARIABLE","$payment",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getMethodInstance",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","canCapture",69],"(",")",")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$invoice",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","capture",70],"(",")",";",["T_WHITESPACE","\n        ",70],"}",["T_WHITESPACE","\n\n        ",71],["T_VARIABLE","$payment",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getOrder",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","addRelatedObject",73],"(",["T_VARIABLE","$invoice",73],")",";",["T_WHITESPACE","\n        ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$invoice",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Totals updater utility method\n     * Updates self totals by keys in data array('key' => $delta)\n     *\n     * @param OrderPaymentInterface $payment\n     * @param array $data\n     * @return void\n     *\/",77],["T_WHITESPACE","\n    ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","updateTotals",85],"(",["T_STRING","OrderPaymentInterface",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$payment",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$data",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_FOREACH","foreach",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$data",87],["T_WHITESPACE"," ",87],["T_AS","as",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$key",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$amount",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_STRING","null",88],["T_WHITESPACE"," ",88],["T_IS_NOT_IDENTICAL","!==",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$amount",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$was",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$payment",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getDataUsingMethod",89],"(",["T_VARIABLE","$key",89],")",";",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$payment",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setDataUsingMethod",90],"(",["T_VARIABLE","$key",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$was",90],["T_WHITESPACE"," ",90],"+",["T_WHITESPACE"," ",90],["T_VARIABLE","$amount",90],")",";",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n    ",92],"}",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Return invoice model for transaction\n     *\n     * @param OrderInterface $order\n     * @param string $transactionId\n     * @return false|Invoice\n     *\/",95],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","getInvoiceForTransactionId",102],"(",["T_STRING","OrderInterface",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$order",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$transactionId",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_FOREACH","foreach",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$order",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getInvoiceCollection",104],"(",")",["T_WHITESPACE"," ",104],["T_AS","as",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$invoice",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_VARIABLE","$invoice",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getTransactionId",105],"(",")",["T_WHITESPACE"," ",105],["T_IS_EQUAL","==",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$transactionId",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n                ",105],["T_VARIABLE","$invoice",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","load",106],"(",["T_VARIABLE","$invoice",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getId",106],"(",")",")",";",["T_WHITESPACE","\n                ",106],["T_COMMENT","\/\/ to make sure all data will properly load (maybe not required)\n",107],["T_WHITESPACE","                ",108],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$invoice",108],";",["T_WHITESPACE","\n            ",108],"}",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n        ",110],["T_FOREACH","foreach",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$order",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getInvoiceCollection",111],"(",")",["T_WHITESPACE"," ",111],["T_AS","as",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$invoice",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$invoice",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getState",112],"(",")",["T_WHITESPACE"," ",112],["T_IS_EQUAL","==",112],["T_WHITESPACE"," ",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Magento",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Sales",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Model",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Order",112],["T_NS_SEPARATOR","\\",112],["T_STRING","Invoice",112],["T_DOUBLE_COLON","::",112],["T_STRING","STATE_OPEN",112],["T_WHITESPACE","\n                ",112],["T_BOOLEAN_AND","&&",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$invoice",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","load",113],"(",["T_VARIABLE","$invoice",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getId",113],"(",")",")",["T_WHITESPACE","\n            ",113],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n                ",114],["T_VARIABLE","$invoice",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","setTransactionId",115],"(",["T_VARIABLE","$transactionId",115],")",";",["T_WHITESPACE","\n                ",115],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$invoice",116],";",["T_WHITESPACE","\n            ",116],"}",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_STRING","false",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n",120],"}",["T_WHITESPACE","\n",121]]