[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Report",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Shipping report resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","Shipping",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","AbstractReport",13],["T_WHITESPACE","\n",13],"{",["T_WHITESPACE","\n    ",14],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     * @return void\n     *\/",15],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_FUNCTION","function",20],["T_WHITESPACE"," ",20],["T_STRING","_construct",20],"(",")",["T_WHITESPACE","\n    ",20],"{",["T_WHITESPACE","\n        ",21],["T_VARIABLE","$this",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","_setResource",22],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",22],")",";",["T_WHITESPACE","\n    ",22],"}",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Aggregate Shipping data\n     *\n     * @param string|int|\\DateTime|array|null $from\n     * @param string|int|\\DateTime|array|null $to\n     * @return $this\n     *\/",25],["T_WHITESPACE","\n    ",31],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","aggregate",32],"(",["T_VARIABLE","$from",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_STRING","null",32],",",["T_WHITESPACE"," ",32],["T_VARIABLE","$to",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_STRING","null",32],")",["T_WHITESPACE","\n    ",32],"{",["T_WHITESPACE","\n        ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","_aggregateByOrderCreatedAt",34],"(",["T_VARIABLE","$from",34],",",["T_WHITESPACE"," ",34],["T_VARIABLE","$to",34],")",";",["T_WHITESPACE","\n        ",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","_aggregateByShippingCreatedAt",35],"(",["T_VARIABLE","$from",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$to",35],")",";",["T_WHITESPACE","\n        ",35],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","_setFlagData",36],"(",["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Reports",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Flag",36],["T_DOUBLE_COLON","::",36],["T_STRING","REPORT_SHIPPING_FLAG_CODE",36],")",";",["T_WHITESPACE","\n        ",36],["T_RETURN","return",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$this",37],";",["T_WHITESPACE","\n    ",37],"}",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Aggregate shipping report by order create_at as period\n     *\n     * @param string|null $from\n     * @param string|null $to\n     * @return $this\n     * @throws \\Exception\n     *\/",40],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","_aggregateByOrderCreatedAt",48],"(",["T_VARIABLE","$from",48],",",["T_WHITESPACE"," ",48],["T_VARIABLE","$to",48],")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$table",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getTable",50],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_shipping_aggregated_order'",50],")",";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$sourceTable",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getTable",51],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",51],")",";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$connection",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getConnection",52],"(",")",";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$connection",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","beginTransaction",53],"(",")",";",["T_WHITESPACE","\n\n        ",53],["T_TRY","try",55],["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n            ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$from",56],["T_WHITESPACE"," ",56],["T_IS_NOT_IDENTICAL","!==",56],["T_WHITESPACE"," ",56],["T_STRING","null",56],["T_WHITESPACE"," ",56],["T_BOOLEAN_OR","||",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$to",56],["T_WHITESPACE"," ",56],["T_IS_NOT_IDENTICAL","!==",56],["T_WHITESPACE"," ",56],["T_STRING","null",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n                ",56],["T_VARIABLE","$subSelect",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_getTableDateRangeSelect",57],"(",["T_VARIABLE","$sourceTable",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'created_at'",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$from",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$to",57],")",";",["T_WHITESPACE","\n            ",57],"}",["T_WHITESPACE"," ",58],["T_ELSE","else",58],["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n                ",58],["T_VARIABLE","$subSelect",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","null",59],";",["T_WHITESPACE","\n            ",59],"}",["T_WHITESPACE","\n\n            ",60],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_clearTableByDateRange",62],"(",["T_VARIABLE","$table",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$from",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$to",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$subSelect",62],")",";",["T_WHITESPACE","\n            ",62],["T_COMMENT","\/\/ convert dates to current admin timezone\n",63],["T_WHITESPACE","            ",64],["T_VARIABLE","$periodExpr",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$connection",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getDatePartSql",64],"(",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getStoreTZOffsetQuery",65],"(",["T_VARIABLE","$sourceTable",65],",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'created_at'",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$from",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$to",65],")",["T_WHITESPACE","\n            ",65],")",";",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$shippingCanceled",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$connection",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getIfNullSql",67],"(",["T_CONSTANT_ENCAPSED_STRING","'base_shipping_canceled'",67],",",["T_WHITESPACE"," ",67],["T_LNUMBER","0",67],")",";",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$shippingRefunded",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$connection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getIfNullSql",68],"(",["T_CONSTANT_ENCAPSED_STRING","'base_shipping_refunded'",68],",",["T_WHITESPACE"," ",68],["T_LNUMBER","0",68],")",";",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$columns",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],"[",["T_WHITESPACE","\n                ",69],["T_CONSTANT_ENCAPSED_STRING","'period'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$periodExpr",70],",",["T_WHITESPACE","\n                ",70],["T_CONSTANT_ENCAPSED_STRING","'store_id'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'store_id'",71],",",["T_WHITESPACE","\n                ",71],["T_CONSTANT_ENCAPSED_STRING","'order_status'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'status'",72],",",["T_WHITESPACE","\n                ",72],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",73],",",["T_WHITESPACE","\n                ",73],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_NEW","new",74],["T_WHITESPACE"," ",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Zend_Db_Expr",74],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(entity_id)'",74],")",",",["T_WHITESPACE","\n                ",74],["T_CONSTANT_ENCAPSED_STRING","'total_shipping'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_NEW","new",75],["T_WHITESPACE"," ",75],["T_NS_SEPARATOR","\\",75],["T_STRING","Zend_Db_Expr",75],"(",["T_WHITESPACE","\n                    ",75],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM((base_shipping_amount - ",76],["T_CURLY_OPEN","{",76],["T_VARIABLE","$shippingCanceled",76],"}",["T_ENCAPSED_AND_WHITESPACE",") * base_to_global_rate)",76],"\"",["T_WHITESPACE","\n                ",76],")",",",["T_WHITESPACE","\n                ",77],["T_CONSTANT_ENCAPSED_STRING","'total_shipping_actual'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_NEW","new",78],["T_WHITESPACE"," ",78],["T_NS_SEPARATOR","\\",78],["T_STRING","Zend_Db_Expr",78],"(",["T_WHITESPACE","\n                    ",78],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM((base_shipping_invoiced - ",79],["T_CURLY_OPEN","{",79],["T_VARIABLE","$shippingRefunded",79],"}",["T_ENCAPSED_AND_WHITESPACE",") * base_to_global_rate)",79],"\"",["T_WHITESPACE","\n                ",79],")",",",["T_WHITESPACE","\n            ",80],"]",";",["T_WHITESPACE","\n\n            ",81],["T_VARIABLE","$select",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$connection",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","select",83],"(",")",";",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$select",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","from",84],"(",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$sourceTable",85],",",["T_WHITESPACE","\n                ",85],["T_VARIABLE","$columns",86],["T_WHITESPACE","\n            ",86],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","where",87],"(",["T_WHITESPACE","\n                ",87],["T_CONSTANT_ENCAPSED_STRING","'state NOT IN (?)'",88],",",["T_WHITESPACE","\n                ",88],"[",["T_NS_SEPARATOR","\\",89],["T_STRING","Magento",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Sales",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Model",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Order",89],["T_DOUBLE_COLON","::",89],["T_STRING","STATE_PENDING_PAYMENT",89],",",["T_WHITESPACE"," ",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Magento",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Sales",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Model",89],["T_NS_SEPARATOR","\\",89],["T_STRING","Order",89],["T_DOUBLE_COLON","::",89],["T_STRING","STATE_NEW",89],"]",["T_WHITESPACE","\n            ",89],")",["T_OBJECT_OPERATOR","->",90],["T_STRING","where",90],"(",["T_WHITESPACE","\n                ",90],["T_CONSTANT_ENCAPSED_STRING","'is_virtual = 0'",91],["T_WHITESPACE","\n            ",91],")",";",["T_WHITESPACE","\n\n            ",92],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$subSelect",94],["T_WHITESPACE"," ",94],["T_IS_NOT_IDENTICAL","!==",94],["T_WHITESPACE"," ",94],["T_STRING","null",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                ",94],["T_VARIABLE","$select",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","having",95],"(",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_makeConditionFromDateRangeSelect",95],"(",["T_VARIABLE","$subSelect",95],",",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'period'",95],")",")",";",["T_WHITESPACE","\n            ",95],"}",["T_WHITESPACE","\n\n            ",96],["T_VARIABLE","$select",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","group",98],"(","[",["T_VARIABLE","$periodExpr",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'store_id'",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'status'",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",98],"]",")",";",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$select",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","having",99],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_count > 0'",99],")",";",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$insertQuery",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$select",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","insertFromSelect",100],"(",["T_VARIABLE","$table",100],",",["T_WHITESPACE"," ",100],["T_STRING","array_keys",100],"(",["T_VARIABLE","$columns",100],")",")",";",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$connection",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","query",101],"(",["T_VARIABLE","$insertQuery",101],")",";",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$select",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","reset",102],"(",")",";",["T_WHITESPACE","\n\n            ",102],["T_VARIABLE","$columns",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],"[",["T_WHITESPACE","\n                ",104],["T_CONSTANT_ENCAPSED_STRING","'period'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'period'",105],",",["T_WHITESPACE","\n                ",105],["T_CONSTANT_ENCAPSED_STRING","'store_id'",106],["T_WHITESPACE"," ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_NEW","new",106],["T_WHITESPACE"," ",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Zend_Db_Expr",106],"(",["T_NS_SEPARATOR","\\",106],["T_STRING","Magento",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Store",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Model",106],["T_NS_SEPARATOR","\\",106],["T_STRING","Store",106],["T_DOUBLE_COLON","::",106],["T_STRING","DEFAULT_STORE_ID",106],")",",",["T_WHITESPACE","\n                ",106],["T_CONSTANT_ENCAPSED_STRING","'order_status'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'order_status'",107],",",["T_WHITESPACE","\n                ",107],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",108],",",["T_WHITESPACE","\n                ",108],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_NEW","new",109],["T_WHITESPACE"," ",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Zend_Db_Expr",109],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(orders_count)'",109],")",",",["T_WHITESPACE","\n                ",109],["T_CONSTANT_ENCAPSED_STRING","'total_shipping'",110],["T_WHITESPACE"," ",110],["T_DOUBLE_ARROW","=>",110],["T_WHITESPACE"," ",110],["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_NS_SEPARATOR","\\",110],["T_STRING","Zend_Db_Expr",110],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(total_shipping)'",110],")",",",["T_WHITESPACE","\n                ",110],["T_CONSTANT_ENCAPSED_STRING","'total_shipping_actual'",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_NEW","new",111],["T_WHITESPACE"," ",111],["T_NS_SEPARATOR","\\",111],["T_STRING","Zend_Db_Expr",111],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(total_shipping_actual)'",111],")",",",["T_WHITESPACE","\n            ",111],"]",";",["T_WHITESPACE","\n\n            ",112],["T_VARIABLE","$select",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","from",114],"(",["T_VARIABLE","$table",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$columns",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","where",114],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id != ?'",114],",",["T_WHITESPACE"," ",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Magento",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Store",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Model",114],["T_NS_SEPARATOR","\\",114],["T_STRING","Store",114],["T_DOUBLE_COLON","::",114],["T_STRING","DEFAULT_STORE_ID",114],")",";",["T_WHITESPACE","\n\n            ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$subSelect",116],["T_WHITESPACE"," ",116],["T_IS_NOT_IDENTICAL","!==",116],["T_WHITESPACE"," ",116],["T_STRING","null",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                ",116],["T_VARIABLE","$select",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","where",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_makeConditionFromDateRangeSelect",117],"(",["T_VARIABLE","$subSelect",117],",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'period'",117],")",")",";",["T_WHITESPACE","\n            ",117],"}",["T_WHITESPACE","\n\n            ",118],["T_VARIABLE","$select",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","group",120],"(","[",["T_CONSTANT_ENCAPSED_STRING","'period'",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'order_status'",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",120],"]",")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$insertQuery",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$select",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","insertFromSelect",121],"(",["T_VARIABLE","$table",121],",",["T_WHITESPACE"," ",121],["T_STRING","array_keys",121],"(",["T_VARIABLE","$columns",121],")",")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$connection",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","query",122],"(",["T_VARIABLE","$insertQuery",122],")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE"," ",123],["T_CATCH","catch",123],["T_WHITESPACE"," ",123],"(",["T_NS_SEPARATOR","\\",123],["T_STRING","Exception",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$e",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$connection",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","rollBack",124],"(",")",";",["T_WHITESPACE","\n            ",124],["T_THROW","throw",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$e",125],";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$connection",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","commit",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Aggregate shipping report by shipment create_at as period\n     *\n     * @param string|null $from\n     * @param string|null $to\n     * @return $this\n     * @throws \\Exception\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",132],["T_WHITESPACE","\n    ",140],["T_PROTECTED","protected",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","_aggregateByShippingCreatedAt",141],"(",["T_VARIABLE","$from",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$to",141],")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$table",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getTable",143],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_shipping_aggregated'",143],")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$sourceTable",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getTable",144],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_invoice'",144],")",";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$orderTable",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getTable",145],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",145],")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$connection",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getConnection",146],"(",")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$connection",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","beginTransaction",147],"(",")",";",["T_WHITESPACE","\n\n        ",147],["T_TRY","try",149],["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$from",150],["T_WHITESPACE"," ",150],["T_IS_NOT_IDENTICAL","!==",150],["T_WHITESPACE"," ",150],["T_STRING","null",150],["T_WHITESPACE"," ",150],["T_BOOLEAN_OR","||",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$to",150],["T_WHITESPACE"," ",150],["T_IS_NOT_IDENTICAL","!==",150],["T_WHITESPACE"," ",150],["T_STRING","null",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$subSelect",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_getTableDateRangeRelatedSelect",151],"(",["T_WHITESPACE","\n                    ",151],["T_VARIABLE","$sourceTable",152],",",["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$orderTable",153],",",["T_WHITESPACE","\n                    ",153],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",154],"]",",",["T_WHITESPACE","\n                    ",154],["T_CONSTANT_ENCAPSED_STRING","'created_at'",155],",",["T_WHITESPACE","\n                    ",155],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",156],",",["T_WHITESPACE","\n                    ",156],["T_VARIABLE","$from",157],",",["T_WHITESPACE","\n                    ",157],["T_VARIABLE","$to",158],["T_WHITESPACE","\n                ",158],")",";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE"," ",160],["T_ELSE","else",160],["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$subSelect",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","null",161],";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n\n            ",162],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_clearTableByDateRange",164],"(",["T_VARIABLE","$table",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$from",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$to",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$subSelect",164],")",";",["T_WHITESPACE","\n            ",164],["T_COMMENT","\/\/ convert dates to current admin timezone\n",165],["T_WHITESPACE","            ",166],["T_VARIABLE","$periodExpr",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$connection",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getDatePartSql",166],"(",["T_WHITESPACE","\n                ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getStoreTZOffsetQuery",167],"(",["T_WHITESPACE","\n                    ",167],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",168],["T_WHITESPACE"," ",168],["T_DOUBLE_ARROW","=>",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$sourceTable",168],"]",",",["T_WHITESPACE","\n                    ",168],["T_CONSTANT_ENCAPSED_STRING","'source_table.created_at'",169],",",["T_WHITESPACE","\n                    ",169],["T_VARIABLE","$from",170],",",["T_WHITESPACE","\n                    ",170],["T_VARIABLE","$to",171],["T_WHITESPACE","\n                ",171],")",["T_WHITESPACE","\n            ",172],")",";",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$shippingCanceled",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$connection",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getIfNullSql",174],"(",["T_CONSTANT_ENCAPSED_STRING","'order_table.base_shipping_canceled'",174],",",["T_WHITESPACE"," ",174],["T_LNUMBER","0",174],")",";",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$shippingRefunded",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$connection",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getIfNullSql",175],"(",["T_CONSTANT_ENCAPSED_STRING","'order_table.base_shipping_refunded'",175],",",["T_WHITESPACE"," ",175],["T_LNUMBER","0",175],")",";",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$columns",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],"[",["T_WHITESPACE","\n                ",176],["T_CONSTANT_ENCAPSED_STRING","'period'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$periodExpr",177],",",["T_WHITESPACE","\n                ",177],["T_CONSTANT_ENCAPSED_STRING","'store_id'",178],["T_WHITESPACE"," ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'order_table.store_id'",178],",",["T_WHITESPACE","\n                ",178],["T_CONSTANT_ENCAPSED_STRING","'order_status'",179],["T_WHITESPACE"," ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'order_table.status'",179],",",["T_WHITESPACE","\n                ",179],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'order_table.shipping_description'",180],",",["T_WHITESPACE","\n                ",180],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_NEW","new",181],["T_WHITESPACE"," ",181],["T_NS_SEPARATOR","\\",181],["T_STRING","Zend_Db_Expr",181],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(order_table.entity_id)'",181],")",",",["T_WHITESPACE","\n                ",181],["T_CONSTANT_ENCAPSED_STRING","'total_shipping'",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_NEW","new",182],["T_WHITESPACE"," ",182],["T_NS_SEPARATOR","\\",182],["T_STRING","Zend_Db_Expr",182],"(",["T_WHITESPACE","\n                    ",182],["T_CONSTANT_ENCAPSED_STRING","'SUM((order_table.base_shipping_amount - '",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE","\n                    ",183],"\"",["T_CURLY_OPEN","{",184],["T_VARIABLE","$shippingCanceled",184],"}",["T_ENCAPSED_AND_WHITESPACE",") * order_table.base_to_global_rate)",184],"\"",["T_WHITESPACE","\n                ",184],")",",",["T_WHITESPACE","\n                ",185],["T_CONSTANT_ENCAPSED_STRING","'total_shipping_actual'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_NEW","new",186],["T_WHITESPACE"," ",186],["T_NS_SEPARATOR","\\",186],["T_STRING","Zend_Db_Expr",186],"(",["T_WHITESPACE","\n                    ",186],["T_CONSTANT_ENCAPSED_STRING","'SUM((order_table.base_shipping_invoiced - '",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE","\n                    ",187],"\"",["T_CURLY_OPEN","{",188],["T_VARIABLE","$shippingRefunded",188],"}",["T_ENCAPSED_AND_WHITESPACE",") * order_table.base_to_global_rate)",188],"\"",["T_WHITESPACE","\n                ",188],")",",",["T_WHITESPACE","\n            ",189],"]",";",["T_WHITESPACE","\n\n            ",190],["T_VARIABLE","$select",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$connection",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","select",192],"(",")",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$select",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","from",193],"(",["T_WHITESPACE","\n                ",193],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$sourceTable",194],"]",",",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$columns",195],["T_WHITESPACE","\n            ",195],")",["T_OBJECT_OPERATOR","->",196],["T_STRING","joinInner",196],"(",["T_WHITESPACE","\n                ",196],"[",["T_CONSTANT_ENCAPSED_STRING","'order_table'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$orderTable",197],"]",",",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$connection",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","quoteInto",198],"(",["T_WHITESPACE","\n                    ",198],["T_CONSTANT_ENCAPSED_STRING","'source_table.order_id = order_table.entity_id AND order_table.state != ?'",199],",",["T_WHITESPACE","\n                    ",199],["T_NS_SEPARATOR","\\",200],["T_STRING","Magento",200],["T_NS_SEPARATOR","\\",200],["T_STRING","Sales",200],["T_NS_SEPARATOR","\\",200],["T_STRING","Model",200],["T_NS_SEPARATOR","\\",200],["T_STRING","Order",200],["T_DOUBLE_COLON","::",200],["T_STRING","STATE_CANCELED",200],["T_WHITESPACE","\n                ",200],")",",",["T_WHITESPACE","\n                ",201],"[","]",["T_WHITESPACE","\n            ",202],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","useStraightJoin",203],"(",")",";",["T_WHITESPACE","\n\n            ",203],["T_VARIABLE","$filterSubSelect",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$connection",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","select",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","from",205],"(",["T_WHITESPACE","\n                ",205],"[",["T_CONSTANT_ENCAPSED_STRING","'filter_source_table'",206],["T_WHITESPACE"," ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$sourceTable",206],"]",",",["T_WHITESPACE","\n                ",206],["T_CONSTANT_ENCAPSED_STRING","'MIN(filter_source_table.entity_id)'",207],["T_WHITESPACE","\n            ",207],")",["T_OBJECT_OPERATOR","->",208],["T_STRING","where",208],"(",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'filter_source_table.order_id = source_table.order_id'",209],["T_WHITESPACE","\n            ",209],")",";",["T_WHITESPACE","\n\n            ",210],["T_IF","if",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$subSelect",212],["T_WHITESPACE"," ",212],["T_IS_NOT_IDENTICAL","!==",212],["T_WHITESPACE"," ",212],["T_STRING","null",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n                ",212],["T_VARIABLE","$select",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","having",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_makeConditionFromDateRangeSelect",213],"(",["T_VARIABLE","$subSelect",213],",",["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","'period'",213],")",")",";",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE","\n\n            ",214],["T_VARIABLE","$select",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","where",216],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table.entity_id = (?)'",216],",",["T_WHITESPACE"," ",216],["T_NEW","new",216],["T_WHITESPACE"," ",216],["T_NS_SEPARATOR","\\",216],["T_STRING","Zend_Db_Expr",216],"(",["T_VARIABLE","$filterSubSelect",216],")",")",";",["T_WHITESPACE","\n            ",216],["T_UNSET","unset",217],"(",["T_VARIABLE","$filterSubSelect",217],")",";",["T_WHITESPACE","\n\n            ",217],["T_VARIABLE","$select",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","group",219],"(",["T_WHITESPACE","\n                ",219],"[",["T_VARIABLE","$periodExpr",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'order_table.store_id'",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'order_table.status'",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'order_table.shipping_description'",220],"]",["T_WHITESPACE","\n            ",220],")",";",["T_WHITESPACE","\n\n            ",221],["T_VARIABLE","$insertQuery",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$select",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","insertFromSelect",223],"(",["T_VARIABLE","$table",223],",",["T_WHITESPACE"," ",223],["T_STRING","array_keys",223],"(",["T_VARIABLE","$columns",223],")",")",";",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$connection",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","query",224],"(",["T_VARIABLE","$insertQuery",224],")",";",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$select",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","reset",225],"(",")",";",["T_WHITESPACE","\n\n            ",225],["T_VARIABLE","$columns",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],"[",["T_WHITESPACE","\n                ",227],["T_CONSTANT_ENCAPSED_STRING","'period'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'period'",228],",",["T_WHITESPACE","\n                ",228],["T_CONSTANT_ENCAPSED_STRING","'store_id'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_NEW","new",229],["T_WHITESPACE"," ",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Zend_Db_Expr",229],"(",["T_NS_SEPARATOR","\\",229],["T_STRING","Magento",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Store",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Model",229],["T_NS_SEPARATOR","\\",229],["T_STRING","Store",229],["T_DOUBLE_COLON","::",229],["T_STRING","DEFAULT_STORE_ID",229],")",",",["T_WHITESPACE","\n                ",229],["T_CONSTANT_ENCAPSED_STRING","'order_status'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'order_status'",230],",",["T_WHITESPACE","\n                ",230],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",231],",",["T_WHITESPACE","\n                ",231],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_NEW","new",232],["T_WHITESPACE"," ",232],["T_NS_SEPARATOR","\\",232],["T_STRING","Zend_Db_Expr",232],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(orders_count)'",232],")",",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'total_shipping'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_NEW","new",233],["T_WHITESPACE"," ",233],["T_NS_SEPARATOR","\\",233],["T_STRING","Zend_Db_Expr",233],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(total_shipping)'",233],")",",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'total_shipping_actual'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_NEW","new",234],["T_WHITESPACE"," ",234],["T_NS_SEPARATOR","\\",234],["T_STRING","Zend_Db_Expr",234],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(total_shipping_actual)'",234],")",",",["T_WHITESPACE","\n            ",234],"]",";",["T_WHITESPACE","\n\n            ",235],["T_VARIABLE","$select",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","from",237],"(",["T_VARIABLE","$table",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$columns",237],")",["T_OBJECT_OPERATOR","->",237],["T_STRING","where",237],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id != ?'",237],",",["T_WHITESPACE"," ",237],["T_NS_SEPARATOR","\\",237],["T_STRING","Magento",237],["T_NS_SEPARATOR","\\",237],["T_STRING","Store",237],["T_NS_SEPARATOR","\\",237],["T_STRING","Model",237],["T_NS_SEPARATOR","\\",237],["T_STRING","Store",237],["T_DOUBLE_COLON","::",237],["T_STRING","DEFAULT_STORE_ID",237],")",";",["T_WHITESPACE","\n\n            ",237],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_VARIABLE","$subSelect",239],["T_WHITESPACE"," ",239],["T_IS_NOT_IDENTICAL","!==",239],["T_WHITESPACE"," ",239],["T_STRING","null",239],")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n                ",239],["T_VARIABLE","$select",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","where",240],"(",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_makeConditionFromDateRangeSelect",240],"(",["T_VARIABLE","$subSelect",240],",",["T_WHITESPACE"," ",240],["T_CONSTANT_ENCAPSED_STRING","'period'",240],")",")",";",["T_WHITESPACE","\n            ",240],"}",["T_WHITESPACE","\n\n            ",241],["T_VARIABLE","$select",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","group",243],"(","[",["T_CONSTANT_ENCAPSED_STRING","'period'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'order_status'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",243],"]",")",";",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$insertQuery",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$select",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","insertFromSelect",244],"(",["T_VARIABLE","$table",244],",",["T_WHITESPACE"," ",244],["T_STRING","array_keys",244],"(",["T_VARIABLE","$columns",244],")",")",";",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$connection",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","query",245],"(",["T_VARIABLE","$insertQuery",245],")",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE"," ",246],["T_CATCH","catch",246],["T_WHITESPACE"," ",246],"(",["T_NS_SEPARATOR","\\",246],["T_STRING","Exception",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$e",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$connection",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","rollBack",247],"(",")",";",["T_WHITESPACE","\n            ",247],["T_THROW","throw",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$e",248],";",["T_WHITESPACE","\n        ",248],"}",["T_WHITESPACE","\n\n        ",249],["T_VARIABLE","$connection",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","commit",251],"(",")",";",["T_WHITESPACE","\n        ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n",253],"}",["T_WHITESPACE","\n",254]]