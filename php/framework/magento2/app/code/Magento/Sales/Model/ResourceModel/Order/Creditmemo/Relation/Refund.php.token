[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_NAMESPACE","namespace",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Sales",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Model",7],["T_NS_SEPARATOR","\\",7],["T_STRING","ResourceModel",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Order",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Creditmemo",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Relation",7],";",["T_WHITESPACE","\n\n",7],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Framework",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","ResourceModel",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Db",9],["T_NS_SEPARATOR","\\",9],["T_STRING","VersionControl",9],["T_NS_SEPARATOR","\\",9],["T_STRING","RelationInterface",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Class Relation\n * @deprecated\n *\/",11],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","Refund",15],["T_WHITESPACE"," ",15],["T_IMPLEMENTS","implements",15],["T_WHITESPACE"," ",15],["T_STRING","RelationInterface",15],["T_WHITESPACE","\n",15],"{",["T_WHITESPACE","\n    ",16],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\OrderRepositoryInterface\n     *\/",17],["T_WHITESPACE","\n    ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$orderRepository",20],";",["T_WHITESPACE","\n\n    ",20],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Api\\InvoiceRepositoryInterface\n     *\/",22],["T_WHITESPACE","\n    ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$invoiceRepository",25],";",["T_WHITESPACE","\n\n    ",25],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Framework\\Pricing\\PriceCurrencyInterface\n     *\/",27],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$priceCurrency",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Sales\\Api\\OrderRepositoryInterface $orderRepository\n     * @param \\Magento\\Sales\\Api\\InvoiceRepositoryInterface $invoiceRepository\n     * @param \\Magento\\Framework\\Pricing\\PriceCurrencyInterface $priceCurrency\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","__construct",37],"(",["T_WHITESPACE","\n        ",37],["T_NS_SEPARATOR","\\",38],["T_STRING","Magento",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Sales",38],["T_NS_SEPARATOR","\\",38],["T_STRING","Api",38],["T_NS_SEPARATOR","\\",38],["T_STRING","OrderRepositoryInterface",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$orderRepository",38],",",["T_WHITESPACE","\n        ",38],["T_NS_SEPARATOR","\\",39],["T_STRING","Magento",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Sales",39],["T_NS_SEPARATOR","\\",39],["T_STRING","Api",39],["T_NS_SEPARATOR","\\",39],["T_STRING","InvoiceRepositoryInterface",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$invoiceRepository",39],",",["T_WHITESPACE","\n        ",39],["T_NS_SEPARATOR","\\",40],["T_STRING","Magento",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Framework",40],["T_NS_SEPARATOR","\\",40],["T_STRING","Pricing",40],["T_NS_SEPARATOR","\\",40],["T_STRING","PriceCurrencyInterface",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$priceCurrency",40],["T_WHITESPACE","\n    ",40],")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","orderRepository",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$orderRepository",42],";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","invoiceRepository",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$invoiceRepository",43],";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","priceCurrency",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$priceCurrency",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Process relations for CreditMemo\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel $object\n     * @throws \\Exception\n     * @return void\n     *\/",47],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","processRelation",54],"(",["T_NS_SEPARATOR","\\",54],["T_STRING","Magento",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Framework",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Model",54],["T_NS_SEPARATOR","\\",54],["T_STRING","AbstractModel",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$object",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_DOC_COMMENT","\/** @var \\Magento\\Sales\\Model\\Order\\Creditmemo $object *\/",56],["T_WHITESPACE","\n        ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(",["T_VARIABLE","$object",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getState",57],"(",")",["T_WHITESPACE"," ",57],["T_IS_EQUAL","==",57],["T_WHITESPACE"," ",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Sales",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Model",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Order",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Creditmemo",57],["T_DOUBLE_COLON","::",57],["T_STRING","STATE_REFUNDED",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n            ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","prepareOrder",58],"(",["T_VARIABLE","$object",58],")",";",["T_WHITESPACE","\n            ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$object",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getInvoice",59],"(",")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n                ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","prepareInvoice",60],"(",["T_VARIABLE","$object",60],")",";",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","invoiceRepository",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","save",61],"(",["T_VARIABLE","$object",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getInvoice",61],"(",")",")",";",["T_WHITESPACE","\n            ",61],"}",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","preparePayment",63],"(",["T_VARIABLE","$object",63],")",";",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","orderRepository",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","save",64],"(",["T_VARIABLE","$object",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getOrder",64],"(",")",")",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Prepare order data for refund\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Creditmemo $creditmemo\n     * @return void\n     *\/",68],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","prepareOrder",74],"(",["T_NS_SEPARATOR","\\",74],["T_STRING","Magento",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Sales",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Model",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Order",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Creditmemo",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$creditmemo",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$order",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$creditmemo",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getOrder",76],"(",")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$baseOrderRefund",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","priceCurrency",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","round",77],"(",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$order",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getBaseTotalRefunded",78],"(",")",["T_WHITESPACE"," ",78],"+",["T_WHITESPACE"," ",78],["T_VARIABLE","$creditmemo",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getBaseGrandTotal",78],"(",")",["T_WHITESPACE","\n        ",78],")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$orderRefund",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","priceCurrency",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","round",80],"(",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$order",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getTotalRefunded",81],"(",")",["T_WHITESPACE"," ",81],"+",["T_WHITESPACE"," ",81],["T_VARIABLE","$creditmemo",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getGrandTotal",81],"(",")",["T_WHITESPACE","\n        ",81],")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$order",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","setBaseTotalRefunded",83],"(",["T_VARIABLE","$baseOrderRefund",83],")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$order",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","setTotalRefunded",84],"(",["T_VARIABLE","$orderRefund",84],")",";",["T_WHITESPACE","\n\n        ",84],["T_VARIABLE","$order",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","setBaseSubtotalRefunded",86],"(",["T_VARIABLE","$order",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getBaseSubtotalRefunded",86],"(",")",["T_WHITESPACE"," ",86],"+",["T_WHITESPACE"," ",86],["T_VARIABLE","$creditmemo",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getBaseSubtotal",86],"(",")",")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$order",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setSubtotalRefunded",87],"(",["T_VARIABLE","$order",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getSubtotalRefunded",87],"(",")",["T_WHITESPACE"," ",87],"+",["T_WHITESPACE"," ",87],["T_VARIABLE","$creditmemo",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getSubtotal",87],"(",")",")",";",["T_WHITESPACE","\n\n        ",87],["T_VARIABLE","$order",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","setBaseTaxRefunded",89],"(",["T_VARIABLE","$order",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getBaseTaxRefunded",89],"(",")",["T_WHITESPACE"," ",89],"+",["T_WHITESPACE"," ",89],["T_VARIABLE","$creditmemo",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getBaseTaxAmount",89],"(",")",")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$order",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setTaxRefunded",90],"(",["T_VARIABLE","$order",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTaxRefunded",90],"(",")",["T_WHITESPACE"," ",90],"+",["T_WHITESPACE"," ",90],["T_VARIABLE","$creditmemo",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTaxAmount",90],"(",")",")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$order",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","setBaseDiscountTaxCompensationRefunded",91],"(",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$order",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getBaseDiscountTaxCompensationRefunded",92],"(",")",["T_WHITESPACE"," ",92],"+",["T_WHITESPACE"," ",92],["T_VARIABLE","$creditmemo",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getBaseDiscountTaxCompensationAmount",92],"(",")",["T_WHITESPACE","\n        ",92],")",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$order",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setDiscountTaxCompensationRefunded",94],"(",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$order",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getDiscountTaxCompensationRefunded",95],"(",")",["T_WHITESPACE"," ",95],"+",["T_WHITESPACE"," ",95],["T_VARIABLE","$creditmemo",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getDiscountTaxCompensationAmount",95],"(",")",["T_WHITESPACE","\n        ",95],")",";",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$order",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","setBaseShippingRefunded",98],"(",["T_VARIABLE","$order",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getBaseShippingRefunded",98],"(",")",["T_WHITESPACE"," ",98],"+",["T_WHITESPACE"," ",98],["T_VARIABLE","$creditmemo",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getBaseShippingAmount",98],"(",")",")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$order",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setShippingRefunded",99],"(",["T_VARIABLE","$order",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getShippingRefunded",99],"(",")",["T_WHITESPACE"," ",99],"+",["T_WHITESPACE"," ",99],["T_VARIABLE","$creditmemo",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getShippingAmount",99],"(",")",")",";",["T_WHITESPACE","\n\n        ",99],["T_VARIABLE","$order",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setBaseShippingTaxRefunded",101],"(",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$order",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getBaseShippingTaxRefunded",102],"(",")",["T_WHITESPACE"," ",102],"+",["T_WHITESPACE"," ",102],["T_VARIABLE","$creditmemo",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getBaseShippingTaxAmount",102],"(",")",["T_WHITESPACE","\n        ",102],")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$order",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","setShippingTaxRefunded",104],"(",["T_VARIABLE","$order",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getShippingTaxRefunded",104],"(",")",["T_WHITESPACE"," ",104],"+",["T_WHITESPACE"," ",104],["T_VARIABLE","$creditmemo",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getShippingTaxAmount",104],"(",")",")",";",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$order",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","setAdjustmentPositive",106],"(",["T_VARIABLE","$order",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getAdjustmentPositive",106],"(",")",["T_WHITESPACE"," ",106],"+",["T_WHITESPACE"," ",106],["T_VARIABLE","$creditmemo",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getAdjustmentPositive",106],"(",")",")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$order",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","setBaseAdjustmentPositive",107],"(",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$order",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getBaseAdjustmentPositive",108],"(",")",["T_WHITESPACE"," ",108],"+",["T_WHITESPACE"," ",108],["T_VARIABLE","$creditmemo",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getBaseAdjustmentPositive",108],"(",")",["T_WHITESPACE","\n        ",108],")",";",["T_WHITESPACE","\n\n        ",109],["T_VARIABLE","$order",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setAdjustmentNegative",111],"(",["T_VARIABLE","$order",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getAdjustmentNegative",111],"(",")",["T_WHITESPACE"," ",111],"+",["T_WHITESPACE"," ",111],["T_VARIABLE","$creditmemo",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getAdjustmentNegative",111],"(",")",")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$order",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","setBaseAdjustmentNegative",112],"(",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$order",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getBaseAdjustmentNegative",113],"(",")",["T_WHITESPACE"," ",113],"+",["T_WHITESPACE"," ",113],["T_VARIABLE","$creditmemo",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getBaseAdjustmentNegative",113],"(",")",["T_WHITESPACE","\n        ",113],")",";",["T_WHITESPACE","\n\n        ",114],["T_VARIABLE","$order",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setDiscountRefunded",116],"(",["T_VARIABLE","$order",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getDiscountRefunded",116],"(",")",["T_WHITESPACE"," ",116],"+",["T_WHITESPACE"," ",116],["T_VARIABLE","$creditmemo",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getDiscountAmount",116],"(",")",")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$order",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setBaseDiscountRefunded",117],"(",["T_VARIABLE","$order",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getBaseDiscountRefunded",117],"(",")",["T_WHITESPACE"," ",117],"+",["T_WHITESPACE"," ",117],["T_VARIABLE","$creditmemo",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getBaseDiscountAmount",117],"(",")",")",";",["T_WHITESPACE","\n\n        ",117],["T_IF","if",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$creditmemo",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getDoTransaction",119],"(",")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$order",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","setTotalOnlineRefunded",120],"(",["T_VARIABLE","$order",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getTotalOnlineRefunded",120],"(",")",["T_WHITESPACE"," ",120],"+",["T_WHITESPACE"," ",120],["T_VARIABLE","$creditmemo",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getGrandTotal",120],"(",")",")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$order",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","setBaseTotalOnlineRefunded",121],"(",["T_VARIABLE","$order",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getBaseTotalOnlineRefunded",121],"(",")",["T_WHITESPACE"," ",121],"+",["T_WHITESPACE"," ",121],["T_VARIABLE","$creditmemo",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getBaseGrandTotal",121],"(",")",")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE"," ",122],["T_ELSE","else",122],["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$order",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","setTotalOfflineRefunded",123],"(",["T_VARIABLE","$order",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getTotalOfflineRefunded",123],"(",")",["T_WHITESPACE"," ",123],"+",["T_WHITESPACE"," ",123],["T_VARIABLE","$creditmemo",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getGrandTotal",123],"(",")",")",";",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$order",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","setBaseTotalOfflineRefunded",124],"(",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$order",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getBaseTotalOfflineRefunded",125],"(",")",["T_WHITESPACE"," ",125],"+",["T_WHITESPACE"," ",125],["T_VARIABLE","$creditmemo",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getBaseGrandTotal",125],"(",")",["T_WHITESPACE","\n            ",125],")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_VARIABLE","$order",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","setBaseTotalInvoicedCost",129],"(",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$order",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getBaseTotalInvoicedCost",130],"(",")",["T_WHITESPACE"," ",130],"-",["T_WHITESPACE"," ",130],["T_VARIABLE","$creditmemo",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getBaseCost",130],"(",")",["T_WHITESPACE","\n        ",130],")",";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Prepare invoice data for refund\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Creditmemo $creditmemo\n     * @return void\n     *\/",134],["T_WHITESPACE","\n    ",139],["T_PROTECTED","protected",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","prepareInvoice",140],"(",["T_NS_SEPARATOR","\\",140],["T_STRING","Magento",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Sales",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Model",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Order",140],["T_NS_SEPARATOR","\\",140],["T_STRING","Creditmemo",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$creditmemo",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$creditmemo",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getInvoice",142],"(",")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$creditmemo",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getInvoice",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","setIsUsedForRefund",143],"(",["T_STRING","true",143],")",";",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$creditmemo",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getInvoice",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","setBaseTotalRefunded",144],"(",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$creditmemo",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getInvoice",145],"(",")",["T_OBJECT_OPERATOR","->",145],["T_STRING","getBaseTotalRefunded",145],"(",")",["T_WHITESPACE"," ",145],"+",["T_WHITESPACE"," ",145],["T_VARIABLE","$creditmemo",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getBaseGrandTotal",145],"(",")",["T_WHITESPACE","\n            ",145],")",";",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$creditmemo",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","setInvoiceId",147],"(",["T_VARIABLE","$creditmemo",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getInvoice",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","getId",147],"(",")",")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Prepare payment data for refund\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Creditmemo $creditmemo\n     * @return void\n     *\/",151],["T_WHITESPACE","\n    ",156],["T_PROTECTED","protected",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","preparePayment",157],"(",["T_NS_SEPARATOR","\\",157],["T_STRING","Magento",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Sales",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Model",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Order",157],["T_NS_SEPARATOR","\\",157],["T_STRING","Creditmemo",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$creditmemo",157],")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(","!",["T_VARIABLE","$creditmemo",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getPaymentRefundDisallowed",159],"(",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$creditmemo",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getOrder",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getPayment",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","refund",160],"(",["T_VARIABLE","$creditmemo",160],")",";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n",162],"}",["T_WHITESPACE","\n",163]]