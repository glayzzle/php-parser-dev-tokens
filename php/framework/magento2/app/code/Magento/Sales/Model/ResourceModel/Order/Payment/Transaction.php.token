[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Order",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Payment",6],";",["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Magento",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Sales",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Model",8],["T_NS_SEPARATOR","\\",8],["T_STRING","ResourceModel",8],["T_NS_SEPARATOR","\\",8],["T_STRING","EntityAbstract",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","Magento",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Sales",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Model",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Spi",9],["T_NS_SEPARATOR","\\",9],["T_STRING","TransactionResourceInterface",9],";",["T_WHITESPACE","\n\n",9],["T_DOC_COMMENT","\/**\n * Sales transaction resource model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",11],["T_WHITESPACE","\n",15],["T_CLASS","class",16],["T_WHITESPACE"," ",16],["T_STRING","Transaction",16],["T_WHITESPACE"," ",16],["T_EXTENDS","extends",16],["T_WHITESPACE"," ",16],["T_STRING","EntityAbstract",16],["T_WHITESPACE"," ",16],["T_IMPLEMENTS","implements",16],["T_WHITESPACE"," ",16],["T_STRING","TransactionResourceInterface",16],["T_WHITESPACE","\n",16],"{",["T_WHITESPACE","\n    ",17],["T_DOC_COMMENT","\/**\n     * Serializeable field: additional_information\n     *\n     * @var array\n     *\/",18],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_serializableFields",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],"[",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",23],["T_WHITESPACE"," ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],"[",["T_STRING","null",23],",",["T_WHITESPACE"," ",23],"[","]","]","]",";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * Initialize main table and the primary key field name\n     *\n     * @return void\n     *\/",25],["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_FUNCTION","function",30],["T_WHITESPACE"," ",30],["T_STRING","_construct",30],"(",")",["T_WHITESPACE","\n    ",30],"{",["T_WHITESPACE","\n        ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","_init",32],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_payment_transaction'",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",32],")",";",["T_WHITESPACE","\n    ",32],"}",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * Update transactions in database using provided transaction as parent for them\n     * have to repeat the business logic to avoid accidental injection of wrong transactions\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Payment\\Transaction $transaction\n     * @return void\n     *\/",35],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","injectAsParent",42],"(",["T_NS_SEPARATOR","\\",42],["T_STRING","Magento",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Sales",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Model",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Order",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Payment",42],["T_NS_SEPARATOR","\\",42],["T_STRING","Transaction",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$transaction",42],")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$txnId",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$transaction",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getTxnId",44],"(",")",";",["T_WHITESPACE","\n        ",44],["T_IF","if",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$txnId",45],["T_WHITESPACE"," ",45],["T_BOOLEAN_AND","&&",45],["T_WHITESPACE","\n            ",45],["T_NS_SEPARATOR","\\",46],["T_STRING","Magento",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Sales",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Model",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Order",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Payment",46],["T_NS_SEPARATOR","\\",46],["T_STRING","Transaction",46],["T_DOUBLE_COLON","::",46],["T_STRING","TYPE_PAYMENT",46],["T_WHITESPACE"," ",46],["T_IS_IDENTICAL","===",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$transaction",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getTxnType",46],"(",")",["T_WHITESPACE"," ",46],["T_BOOLEAN_AND","&&",46],["T_WHITESPACE","\n            ",46],"(",["T_VARIABLE","$id",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$transaction",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getId",47],"(",")",")",["T_WHITESPACE","\n        ",47],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$connection",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getConnection",49],"(",")",";",["T_WHITESPACE","\n\n            ",49],["T_COMMENT","\/\/ verify such transaction exists, determine payment and order id\n",51],["T_WHITESPACE","            ",52],["T_VARIABLE","$verificationRow",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$connection",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","fetchRow",52],"(",["T_WHITESPACE","\n                ",52],["T_VARIABLE","$connection",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","select",53],"(",")",["T_OBJECT_OPERATOR","->",53],["T_STRING","from",53],"(",["T_WHITESPACE","\n                    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getMainTable",54],"(",")",",",["T_WHITESPACE","\n                    ",54],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_id'",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'order_id'",55],"]",["T_WHITESPACE","\n                ",55],")",["T_OBJECT_OPERATOR","->",56],["T_STRING","where",56],"(",["T_WHITESPACE","\n                    ",56],"\"",["T_CURLY_OPEN","{",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getIdFieldName",57],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," = ?",57],"\"",",",["T_WHITESPACE","\n                    ",57],["T_INT_CAST","(int)",58],["T_VARIABLE","$id",58],["T_WHITESPACE","\n                ",58],")",["T_WHITESPACE","\n            ",59],")",";",["T_WHITESPACE","\n            ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(","!",["T_VARIABLE","$verificationRow",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n                ",61],["T_RETURN","return",62],";",["T_WHITESPACE","\n            ",62],"}",["T_WHITESPACE","\n            ",63],["T_LIST","list",64],"(",["T_VARIABLE","$paymentId",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$orderId",64],")",["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","array_values",64],"(",["T_VARIABLE","$verificationRow",64],")",";",["T_WHITESPACE","\n\n            ",64],["T_COMMENT","\/\/ inject\n",66],["T_WHITESPACE","            ",67],["T_VARIABLE","$where",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],"[",["T_WHITESPACE","\n                ",67],["T_VARIABLE","$connection",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","quoteIdentifier",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getIdFieldName",68],"(",")",")",["T_WHITESPACE"," ",68],".",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'!=?'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$id",68],",",["T_WHITESPACE","\n                ",68],["T_NEW","new",69],["T_WHITESPACE"," ",69],["T_NS_SEPARATOR","\\",69],["T_STRING","Zend_Db_Expr",69],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id IS NULL'",69],")",",",["T_WHITESPACE","\n                ",69],["T_CONSTANT_ENCAPSED_STRING","'payment_id = ?'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_INT_CAST","(int)",70],["T_VARIABLE","$paymentId",70],",",["T_WHITESPACE","\n                ",70],["T_CONSTANT_ENCAPSED_STRING","'order_id = ?'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_INT_CAST","(int)",71],["T_VARIABLE","$orderId",71],",",["T_WHITESPACE","\n                ",71],["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id = ?'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$txnId",72],",",["T_WHITESPACE","\n            ",72],"]",";",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$connection",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","update",74],"(",["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getMainTable",74],"(",")",",",["T_WHITESPACE"," ",74],"[",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$id",74],"]",",",["T_WHITESPACE"," ",74],["T_VARIABLE","$where",74],")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Load the transaction object by specified txn_id\n     *\n     * @param \\Magento\\Sales\\Model\\Order\\Payment\\Transaction $transaction\n     * @param int $orderId\n     * @param int $paymentId\n     * @param string $txnId\n     * @return \\Magento\\Sales\\Model\\Order\\Payment\\Transaction\n     *\/",78],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","loadObjectByTxnId",87],"(",["T_WHITESPACE","\n        ",87],["T_NS_SEPARATOR","\\",88],["T_STRING","Magento",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Sales",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Model",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Order",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Payment",88],["T_NS_SEPARATOR","\\",88],["T_STRING","Transaction",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$transaction",88],",",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$orderId",89],",",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$paymentId",90],",",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$txnId",91],["T_WHITESPACE","\n    ",91],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$select",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_getLoadByUniqueKeySelect",93],"(",["T_VARIABLE","$orderId",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$paymentId",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$txnId",93],")",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$data",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getConnection",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","fetchRow",94],"(",["T_VARIABLE","$select",94],")",";",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_VARIABLE","$data",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$transaction",96],";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$transaction",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","setData",98],"(",["T_VARIABLE","$data",98],")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","unserializeFields",99],"(",["T_VARIABLE","$transaction",99],")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","_afterLoad",100],"(",["T_VARIABLE","$transaction",100],")",";",["T_WHITESPACE","\n\n        ",100],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$transaction",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Retrieve order website id\n     *\n     * @param int $orderId\n     * @return string\n     *\/",105],["T_WHITESPACE","\n    ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","getOrderWebsiteId",111],"(",["T_VARIABLE","$orderId",111],")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$connection",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getConnection",113],"(",")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$bind",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],"[",["T_CONSTANT_ENCAPSED_STRING","':entity_id'",114],["T_WHITESPACE"," ",114],["T_DOUBLE_ARROW","=>",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$orderId",114],"]",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$select",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$connection",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","select",115],"(",")",["T_OBJECT_OPERATOR","->",115],["T_STRING","from",115],"(",["T_WHITESPACE","\n            ",115],"[",["T_CONSTANT_ENCAPSED_STRING","'so'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getTable",116],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",116],")","]",",",["T_WHITESPACE","\n            ",116],["T_CONSTANT_ENCAPSED_STRING","'cs.website_id'",117],["T_WHITESPACE","\n        ",117],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","joinInner",118],"(",["T_WHITESPACE","\n            ",118],"[",["T_CONSTANT_ENCAPSED_STRING","'cs'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getTable",119],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",119],")","]",",",["T_WHITESPACE","\n            ",119],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id = so.store_id'",120],["T_WHITESPACE","\n        ",120],")",["T_OBJECT_OPERATOR","->",121],["T_STRING","where",121],"(",["T_WHITESPACE","\n            ",121],["T_CONSTANT_ENCAPSED_STRING","'so.entity_id = :entity_id'",122],["T_WHITESPACE","\n        ",122],")",";",["T_WHITESPACE","\n        ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$connection",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","fetchOne",124],"(",["T_VARIABLE","$select",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$bind",124],")",";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Lookup for parent_id in already saved transactions of this payment by the order_id\n     * Also serialize additional information, if any\n     *\n     * @param \\Magento\\Framework\\Model\\AbstractModel|\\Magento\\Sales\\Model\\Order\\Payment\\Transaction $transaction\n     * @throws \\Magento\\Framework\\Exception\\LocalizedException\n     * @return $this\n     *\/",127],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","_beforeSave",135],"(",["T_NS_SEPARATOR","\\",135],["T_STRING","Magento",135],["T_NS_SEPARATOR","\\",135],["T_STRING","Framework",135],["T_NS_SEPARATOR","\\",135],["T_STRING","Model",135],["T_NS_SEPARATOR","\\",135],["T_STRING","AbstractModel",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$transaction",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$parentTxnId",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$transaction",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getData",137],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$txnId",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$transaction",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getData",138],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",138],")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$orderId",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$transaction",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getData",139],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$paymentId",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$transaction",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getData",140],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_id'",140],")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$idFieldName",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getIdFieldName",141],"(",")",";",["T_WHITESPACE","\n\n        ",141],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$parentTxnId",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_VARIABLE","$txnId",144],["T_WHITESPACE"," ",144],["T_BOOLEAN_OR","||",144],["T_WHITESPACE"," ",144],"!",["T_VARIABLE","$orderId",144],["T_WHITESPACE"," ",144],["T_BOOLEAN_OR","||",144],["T_WHITESPACE"," ",144],"!",["T_VARIABLE","$paymentId",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                ",144],["T_THROW","throw",145],["T_WHITESPACE"," ",145],["T_NEW","new",145],["T_WHITESPACE"," ",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Magento",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Framework",145],["T_NS_SEPARATOR","\\",145],["T_STRING","Exception",145],["T_NS_SEPARATOR","\\",145],["T_STRING","LocalizedException",145],"(",["T_WHITESPACE","\n                    ",145],["T_STRING","__",146],"(",["T_CONSTANT_ENCAPSED_STRING","'We don\\'t have enough information to save the parent transaction ID.'",146],")",["T_WHITESPACE","\n                ",146],")",";",["T_WHITESPACE","\n            ",147],"}",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$parentId",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_INT_CAST","(int)",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_lookupByTxnId",149],"(",["T_VARIABLE","$orderId",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$paymentId",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$parentTxnId",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$idFieldName",149],")",";",["T_WHITESPACE","\n            ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$parentId",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$transaction",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","setData",151],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$parentId",151],")",";",["T_WHITESPACE","\n            ",151],"}",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n\n        ",153],["T_COMMENT","\/\/ make sure unique key won't cause trouble\n",155],["T_WHITESPACE","        ",156],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$transaction",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","isFailsafe",156],"(",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$autoincrementId",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_INT_CAST","(int)",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_lookupByTxnId",157],"(",["T_VARIABLE","$orderId",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$paymentId",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$txnId",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$idFieldName",157],")",";",["T_WHITESPACE","\n            ",157],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$autoincrementId",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$transaction",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","setData",159],"(",["T_VARIABLE","$idFieldName",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$autoincrementId",159],")",["T_OBJECT_OPERATOR","->",159],["T_STRING","isObjectNew",159],"(",["T_STRING","false",159],")",";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n\n        ",161],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_STRING","parent",163],["T_DOUBLE_COLON","::",163],["T_STRING","_beforeSave",163],"(",["T_VARIABLE","$transaction",163],")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Load cell\/row by specified unique key parts\n     *\n     * @param int $orderId\n     * @param int $paymentId\n     * @param string $txnId\n     * @param mixed (array|string|object) $columns\n     * @param bool $isRow\n     * @param string $txnType\n     * @return array|string\n     *\/",166],["T_WHITESPACE","\n    ",176],["T_PRIVATE","private",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","_lookupByTxnId",177],"(",["T_VARIABLE","$orderId",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$paymentId",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$txnId",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$columns",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$isRow",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","false",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$txnType",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","null",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$select",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getLoadByUniqueKeySelect",179],"(",["T_VARIABLE","$orderId",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$paymentId",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$txnId",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$columns",179],")",";",["T_WHITESPACE","\n        ",179],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$txnType",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$select",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","where",181],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_type = ?'",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$txnType",181],")",";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n        ",182],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_VARIABLE","$isRow",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getConnection",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","fetchRow",184],"(",["T_VARIABLE","$select",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getConnection",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","fetchOne",186],"(",["T_VARIABLE","$select",186],")",";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Get select object for loading transaction by the unique key of order_id, payment_id, txn_id\n     *\n     * @param int $orderId\n     * @param int $paymentId\n     * @param string $txnId\n     * @param string|array|\\Zend_Db_Expr $columns\n     * @return \\Magento\\Framework\\DB\\Select\n     *\/",189],["T_WHITESPACE","\n    ",197],["T_PRIVATE","private",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","_getLoadByUniqueKeySelect",198],"(",["T_VARIABLE","$orderId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$paymentId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$txnId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$columns",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_CONSTANT_ENCAPSED_STRING","'*'",198],")",["T_WHITESPACE","\n    ",198],"{",["T_WHITESPACE","\n        ",199],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getConnection",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","select",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","from",200],"(",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getMainTable",201],"(",")",",",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$columns",202],["T_WHITESPACE","\n        ",202],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","where",203],"(",["T_WHITESPACE","\n            ",203],["T_CONSTANT_ENCAPSED_STRING","'order_id = ?'",204],",",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$orderId",205],["T_WHITESPACE","\n        ",205],")",["T_OBJECT_OPERATOR","->",206],["T_STRING","where",206],"(",["T_WHITESPACE","\n            ",206],["T_CONSTANT_ENCAPSED_STRING","'payment_id = ?'",207],",",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$paymentId",208],["T_WHITESPACE","\n        ",208],")",["T_OBJECT_OPERATOR","->",209],["T_STRING","where",209],"(",["T_WHITESPACE","\n            ",209],["T_CONSTANT_ENCAPSED_STRING","'txn_id = ?'",210],",",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$txnId",211],["T_WHITESPACE","\n        ",211],")",";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n",213],"}",["T_WHITESPACE","\n",214]]