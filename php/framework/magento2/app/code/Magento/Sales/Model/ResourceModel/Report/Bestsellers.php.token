[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n",5],["T_NAMESPACE","namespace",6],["T_WHITESPACE"," ",6],["T_STRING","Magento",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Sales",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Model",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ResourceModel",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Report",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Bestsellers report resource model\n * @SuppressWarnings(PHPMD.CouplingBetweenObjects)\n *\/",8],["T_WHITESPACE","\n",11],["T_CLASS","class",12],["T_WHITESPACE"," ",12],["T_STRING","Bestsellers",12],["T_WHITESPACE"," ",12],["T_EXTENDS","extends",12],["T_WHITESPACE"," ",12],["T_STRING","AbstractReport",12],["T_WHITESPACE","\n",12],"{",["T_WHITESPACE","\n    ",13],["T_CONST","const",14],["T_WHITESPACE"," ",14],["T_STRING","AGGREGATION_DAILY",14],["T_WHITESPACE"," ",14],"=",["T_WHITESPACE"," ",14],["T_CONSTANT_ENCAPSED_STRING","'daily'",14],";",["T_WHITESPACE","\n\n    ",14],["T_CONST","const",16],["T_WHITESPACE"," ",16],["T_STRING","AGGREGATION_MONTHLY",16],["T_WHITESPACE"," ",16],"=",["T_WHITESPACE"," ",16],["T_CONSTANT_ENCAPSED_STRING","'monthly'",16],";",["T_WHITESPACE","\n\n    ",16],["T_CONST","const",18],["T_WHITESPACE"," ",18],["T_STRING","AGGREGATION_YEARLY",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_CONSTANT_ENCAPSED_STRING","'yearly'",18],";",["T_WHITESPACE","\n\n    ",18],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Catalog\\Model\\ResourceModel\\Product\n     *\/",20],["T_WHITESPACE","\n    ",22],["T_PROTECTED","protected",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$_productResource",23],";",["T_WHITESPACE","\n\n    ",23],["T_DOC_COMMENT","\/**\n     * @var \\Magento\\Sales\\Model\\ResourceModel\\Helper\n     *\/",25],["T_WHITESPACE","\n    ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$_salesResourceHelper",28],";",["T_WHITESPACE","\n\n    ",28],["T_DOC_COMMENT","\/**\n     * Ignored product types list\n     *\n     * @var array\n     *\/",30],["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$ignoredProductTypes",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],"[",["T_WHITESPACE","\n        ",35],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Catalog",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Product",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Type",36],["T_DOUBLE_COLON","::",36],["T_STRING","TYPE_BUNDLE",36],["T_WHITESPACE"," ",36],["T_DOUBLE_ARROW","=>",36],["T_WHITESPACE"," ",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Magento",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Catalog",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Model",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Product",36],["T_NS_SEPARATOR","\\",36],["T_STRING","Type",36],["T_DOUBLE_COLON","::",36],["T_STRING","TYPE_BUNDLE",36],",",["T_WHITESPACE","\n    ",36],"]",";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * @param \\Magento\\Framework\\Model\\ResourceModel\\Db\\Context $context\n     * @param \\Psr\\Log\\LoggerInterface $logger\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\TimezoneInterface $localeDate\n     * @param \\Magento\\Reports\\Model\\FlagFactory $reportsFlagFactory\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\Timezone\\Validator $timezoneValidator\n     * @param \\Magento\\Framework\\Stdlib\\DateTime\\DateTime $dateTime\n     * @param \\Magento\\Catalog\\Model\\ResourceModel\\Product $productResource\n     * @param \\Magento\\Sales\\Model\\ResourceModel\\Helper $salesResourceHelper\n     * @param array $ignoredProductTypes\n     * @param string $connectionName\n     * @SuppressWarnings(PHPMD.ExcessiveParameterList)\n     *\/",39],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","__construct",52],"(",["T_WHITESPACE","\n        ",52],["T_NS_SEPARATOR","\\",53],["T_STRING","Magento",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Framework",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Model",53],["T_NS_SEPARATOR","\\",53],["T_STRING","ResourceModel",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Db",53],["T_NS_SEPARATOR","\\",53],["T_STRING","Context",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$context",53],",",["T_WHITESPACE","\n        ",53],["T_NS_SEPARATOR","\\",54],["T_STRING","Psr",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Log",54],["T_NS_SEPARATOR","\\",54],["T_STRING","LoggerInterface",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$logger",54],",",["T_WHITESPACE","\n        ",54],["T_NS_SEPARATOR","\\",55],["T_STRING","Magento",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Framework",55],["T_NS_SEPARATOR","\\",55],["T_STRING","Stdlib",55],["T_NS_SEPARATOR","\\",55],["T_STRING","DateTime",55],["T_NS_SEPARATOR","\\",55],["T_STRING","TimezoneInterface",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$localeDate",55],",",["T_WHITESPACE","\n        ",55],["T_NS_SEPARATOR","\\",56],["T_STRING","Magento",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Reports",56],["T_NS_SEPARATOR","\\",56],["T_STRING","Model",56],["T_NS_SEPARATOR","\\",56],["T_STRING","FlagFactory",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$reportsFlagFactory",56],",",["T_WHITESPACE","\n        ",56],["T_NS_SEPARATOR","\\",57],["T_STRING","Magento",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Framework",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Stdlib",57],["T_NS_SEPARATOR","\\",57],["T_STRING","DateTime",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Timezone",57],["T_NS_SEPARATOR","\\",57],["T_STRING","Validator",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$timezoneValidator",57],",",["T_WHITESPACE","\n        ",57],["T_NS_SEPARATOR","\\",58],["T_STRING","Magento",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Framework",58],["T_NS_SEPARATOR","\\",58],["T_STRING","Stdlib",58],["T_NS_SEPARATOR","\\",58],["T_STRING","DateTime",58],["T_NS_SEPARATOR","\\",58],["T_STRING","DateTime",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$dateTime",58],",",["T_WHITESPACE","\n        ",58],["T_NS_SEPARATOR","\\",59],["T_STRING","Magento",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Catalog",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Model",59],["T_NS_SEPARATOR","\\",59],["T_STRING","ResourceModel",59],["T_NS_SEPARATOR","\\",59],["T_STRING","Product",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$productResource",59],",",["T_WHITESPACE","\n        ",59],["T_NS_SEPARATOR","\\",60],["T_STRING","Magento",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Sales",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Model",60],["T_NS_SEPARATOR","\\",60],["T_STRING","ResourceModel",60],["T_NS_SEPARATOR","\\",60],["T_STRING","Helper",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$salesResourceHelper",60],",",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$connectionName",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","null",61],",",["T_WHITESPACE","\n        ",61],["T_ARRAY","array",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$ignoredProductTypes",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],"[","]",["T_WHITESPACE","\n    ",62],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n        ",63],["T_STRING","parent",64],["T_DOUBLE_COLON","::",64],["T_STRING","__construct",64],"(",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$context",65],",",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$logger",66],",",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$localeDate",67],",",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$reportsFlagFactory",68],",",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$timezoneValidator",69],",",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$dateTime",70],",",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$connectionName",71],["T_WHITESPACE","\n        ",71],")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_productResource",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$productResource",73],";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_salesResourceHelper",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$salesResourceHelper",74],";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","ignoredProductTypes",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","array_merge",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","ignoredProductTypes",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$ignoredProductTypes",75],")",";",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     * @return void\n     *\/",78],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","_construct",83],"(",")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_init",85],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_bestsellers_aggregated_'",85],["T_WHITESPACE"," ",85],".",["T_WHITESPACE"," ",85],["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_STRING","AGGREGATION_DAILY",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'id'",85],")",";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Aggregate Orders data by order created at\n     *\n     * @param string|int|\\DateTime|array|null $from\n     * @param string|int|\\DateTime|array|null $to\n     * @return $this\n     * @throws \\Exception\n     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)\n     *\/",88],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","aggregate",97],"(",["T_VARIABLE","$from",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","null",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$to",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","null",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$connection",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getConnection",99],"(",")",";",["T_WHITESPACE","\n        ",99],["T_COMMENT","\/\/$this->getConnection()->beginTransaction();\n",100],["T_WHITESPACE","\n        ",101],["T_TRY","try",102],["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$from",103],["T_WHITESPACE"," ",103],["T_IS_NOT_IDENTICAL","!==",103],["T_WHITESPACE"," ",103],["T_STRING","null",103],["T_WHITESPACE"," ",103],["T_BOOLEAN_OR","||",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$to",103],["T_WHITESPACE"," ",103],["T_IS_NOT_IDENTICAL","!==",103],["T_WHITESPACE"," ",103],["T_STRING","null",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$subSelect",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_getTableDateRangeSelect",104],"(",["T_WHITESPACE","\n                    ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getTable",105],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",105],")",",",["T_WHITESPACE","\n                    ",105],["T_CONSTANT_ENCAPSED_STRING","'created_at'",106],",",["T_WHITESPACE","\n                    ",106],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",107],",",["T_WHITESPACE","\n                    ",107],["T_VARIABLE","$from",108],",",["T_WHITESPACE","\n                    ",108],["T_VARIABLE","$to",109],["T_WHITESPACE","\n                ",109],")",";",["T_WHITESPACE","\n            ",110],"}",["T_WHITESPACE"," ",111],["T_ELSE","else",111],["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n                ",111],["T_VARIABLE","$subSelect",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","null",112],";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE","\n\n            ",113],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_clearTableByDateRange",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getMainTable",115],"(",")",",",["T_WHITESPACE"," ",115],["T_VARIABLE","$from",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$to",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$subSelect",115],")",";",["T_WHITESPACE","\n            ",115],["T_COMMENT","\/\/ convert dates to current admin timezone\n",116],["T_WHITESPACE","            ",117],["T_VARIABLE","$periodExpr",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$connection",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getDatePartSql",117],"(",["T_WHITESPACE","\n                ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getStoreTZOffsetQuery",118],"(",["T_WHITESPACE","\n                    ",118],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getTable",119],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",119],")","]",",",["T_WHITESPACE","\n                    ",119],["T_CONSTANT_ENCAPSED_STRING","'source_table.created_at'",120],",",["T_WHITESPACE","\n                    ",120],["T_VARIABLE","$from",121],",",["T_WHITESPACE","\n                    ",121],["T_VARIABLE","$to",122],["T_WHITESPACE","\n                ",122],")",["T_WHITESPACE","\n            ",123],")",";",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$select",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$connection",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","select",125],"(",")",";",["T_WHITESPACE","\n\n            ",125],["T_VARIABLE","$select",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","group",127],"(","[",["T_VARIABLE","$periodExpr",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'order_item.product_id'",127],"]",")",";",["T_WHITESPACE","\n\n            ",127],["T_VARIABLE","$columns",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],"[",["T_WHITESPACE","\n                ",129],["T_CONSTANT_ENCAPSED_STRING","'period'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$periodExpr",130],",",["T_WHITESPACE","\n                ",130],["T_CONSTANT_ENCAPSED_STRING","'store_id'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",131],",",["T_WHITESPACE","\n                ",131],["T_CONSTANT_ENCAPSED_STRING","'product_id'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'order_item.product_id'",132],",",["T_WHITESPACE","\n                ",132],["T_CONSTANT_ENCAPSED_STRING","'product_name'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_NEW","new",133],["T_WHITESPACE"," ",133],["T_NS_SEPARATOR","\\",133],["T_STRING","Zend_Db_Expr",133],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(order_item.name)'",133],")",",",["T_WHITESPACE","\n                ",133],["T_CONSTANT_ENCAPSED_STRING","'product_price'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_NEW","new",134],["T_WHITESPACE"," ",134],["T_NS_SEPARATOR","\\",134],["T_STRING","Zend_Db_Expr",134],"(",["T_WHITESPACE","\n                    ",134],["T_CONSTANT_ENCAPSED_STRING","'MIN(IF(order_item_parent.base_price, order_item_parent.base_price, order_item.base_price))'",135],["T_WHITESPACE"," ",135],".",["T_WHITESPACE","\n                    ",135],["T_CONSTANT_ENCAPSED_STRING","'* MIN(source_table.base_to_global_rate)'",136],["T_WHITESPACE","\n                ",136],")",",",["T_WHITESPACE","\n                ",137],["T_CONSTANT_ENCAPSED_STRING","'qty_ordered'",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_NEW","new",138],["T_WHITESPACE"," ",138],["T_NS_SEPARATOR","\\",138],["T_STRING","Zend_Db_Expr",138],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(order_item.qty_ordered)'",138],")",",",["T_WHITESPACE","\n            ",138],"]",";",["T_WHITESPACE","\n\n            ",139],["T_VARIABLE","$select",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","from",141],"(",["T_WHITESPACE","\n                ",141],"[",["T_CONSTANT_ENCAPSED_STRING","'source_table'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getTable",142],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order'",142],")","]",",",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$columns",143],["T_WHITESPACE","\n            ",143],")",["T_OBJECT_OPERATOR","->",144],["T_STRING","joinInner",144],"(",["T_WHITESPACE","\n                ",144],"[",["T_CONSTANT_ENCAPSED_STRING","'order_item'",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getTable",145],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_item'",145],")","]",",",["T_WHITESPACE","\n                ",145],["T_CONSTANT_ENCAPSED_STRING","'order_item.order_id = source_table.entity_id'",146],",",["T_WHITESPACE","\n                ",146],"[","]",["T_WHITESPACE","\n            ",147],")",["T_OBJECT_OPERATOR","->",148],["T_STRING","joinLeft",148],"(",["T_WHITESPACE","\n                ",148],"[",["T_CONSTANT_ENCAPSED_STRING","'order_item_parent'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getTable",149],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_item'",149],")","]",",",["T_WHITESPACE","\n                ",149],["T_CONSTANT_ENCAPSED_STRING","'order_item.parent_item_id = order_item_parent.item_id'",150],",",["T_WHITESPACE","\n                ",150],"[","]",["T_WHITESPACE","\n            ",151],")",["T_OBJECT_OPERATOR","->",152],["T_STRING","where",152],"(",["T_WHITESPACE","\n                ",152],["T_CONSTANT_ENCAPSED_STRING","'source_table.state != ?'",153],",",["T_WHITESPACE","\n                ",153],["T_NS_SEPARATOR","\\",154],["T_STRING","Magento",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Sales",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Model",154],["T_NS_SEPARATOR","\\",154],["T_STRING","Order",154],["T_DOUBLE_COLON","::",154],["T_STRING","STATE_CANCELED",154],["T_WHITESPACE","\n            ",154],")",["T_OBJECT_OPERATOR","->",155],["T_STRING","where",155],"(",["T_WHITESPACE","\n                ",155],["T_CONSTANT_ENCAPSED_STRING","'order_item.product_type NOT IN(?)'",156],",",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","ignoredProductTypes",157],["T_WHITESPACE","\n            ",157],")",";",["T_WHITESPACE","\n\n            ",158],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$subSelect",160],["T_WHITESPACE"," ",160],["T_IS_NOT_IDENTICAL","!==",160],["T_WHITESPACE"," ",160],["T_STRING","null",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$select",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","having",161],"(",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_makeConditionFromDateRangeSelect",161],"(",["T_VARIABLE","$subSelect",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'period'",161],")",")",";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n\n            ",162],["T_VARIABLE","$select",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","useStraightJoin",164],"(",")",";",["T_WHITESPACE","\n            ",164],["T_COMMENT","\/\/ important!\n",165],["T_WHITESPACE","            ",166],["T_VARIABLE","$insertQuery",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$select",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","insertFromSelect",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getMainTable",166],"(",")",",",["T_WHITESPACE"," ",166],["T_STRING","array_keys",166],"(",["T_VARIABLE","$columns",166],")",")",";",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$connection",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","query",167],"(",["T_VARIABLE","$insertQuery",167],")",";",["T_WHITESPACE","\n\n            ",167],["T_VARIABLE","$columns",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],"[",["T_WHITESPACE","\n                ",169],["T_CONSTANT_ENCAPSED_STRING","'period'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'period'",170],",",["T_WHITESPACE","\n                ",170],["T_CONSTANT_ENCAPSED_STRING","'store_id'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_NEW","new",171],["T_WHITESPACE"," ",171],["T_NS_SEPARATOR","\\",171],["T_STRING","Zend_Db_Expr",171],"(",["T_NS_SEPARATOR","\\",171],["T_STRING","Magento",171],["T_NS_SEPARATOR","\\",171],["T_STRING","Store",171],["T_NS_SEPARATOR","\\",171],["T_STRING","Model",171],["T_NS_SEPARATOR","\\",171],["T_STRING","Store",171],["T_DOUBLE_COLON","::",171],["T_STRING","DEFAULT_STORE_ID",171],")",",",["T_WHITESPACE","\n                ",171],["T_CONSTANT_ENCAPSED_STRING","'product_id'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'product_id'",172],",",["T_WHITESPACE","\n                ",172],["T_CONSTANT_ENCAPSED_STRING","'product_name'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_NEW","new",173],["T_WHITESPACE"," ",173],["T_NS_SEPARATOR","\\",173],["T_STRING","Zend_Db_Expr",173],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(product_name)'",173],")",",",["T_WHITESPACE","\n                ",173],["T_CONSTANT_ENCAPSED_STRING","'product_price'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_NEW","new",174],["T_WHITESPACE"," ",174],["T_NS_SEPARATOR","\\",174],["T_STRING","Zend_Db_Expr",174],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(product_price)'",174],")",",",["T_WHITESPACE","\n                ",174],["T_CONSTANT_ENCAPSED_STRING","'qty_ordered'",175],["T_WHITESPACE"," ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_NEW","new",175],["T_WHITESPACE"," ",175],["T_NS_SEPARATOR","\\",175],["T_STRING","Zend_Db_Expr",175],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(qty_ordered)'",175],")",",",["T_WHITESPACE","\n            ",175],"]",";",["T_WHITESPACE","\n\n            ",176],["T_VARIABLE","$select",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","reset",178],"(",")",";",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$select",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","from",179],"(",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getMainTable",180],"(",")",",",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$columns",181],["T_WHITESPACE","\n            ",181],")",["T_OBJECT_OPERATOR","->",182],["T_STRING","where",182],"(",["T_WHITESPACE","\n                ",182],["T_CONSTANT_ENCAPSED_STRING","'store_id <> ?'",183],",",["T_WHITESPACE","\n                ",183],["T_NS_SEPARATOR","\\",184],["T_STRING","Magento",184],["T_NS_SEPARATOR","\\",184],["T_STRING","Store",184],["T_NS_SEPARATOR","\\",184],["T_STRING","Model",184],["T_NS_SEPARATOR","\\",184],["T_STRING","Store",184],["T_DOUBLE_COLON","::",184],["T_STRING","DEFAULT_STORE_ID",184],["T_WHITESPACE","\n            ",184],")",";",["T_WHITESPACE","\n\n            ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$subSelect",187],["T_WHITESPACE"," ",187],["T_IS_NOT_IDENTICAL","!==",187],["T_WHITESPACE"," ",187],["T_STRING","null",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$select",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","where",188],"(",["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_makeConditionFromDateRangeSelect",188],"(",["T_VARIABLE","$subSelect",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'period'",188],")",")",";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n\n            ",189],["T_VARIABLE","$select",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","group",191],"(","[",["T_CONSTANT_ENCAPSED_STRING","'period'",191],",",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","'product_id'",191],"]",")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$insertQuery",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$select",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","insertFromSelect",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getMainTable",192],"(",")",",",["T_WHITESPACE"," ",192],["T_STRING","array_keys",192],"(",["T_VARIABLE","$columns",192],")",")",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$connection",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","query",193],"(",["T_VARIABLE","$insertQuery",193],")",";",["T_WHITESPACE","\n\n            ",193],["T_COMMENT","\/\/ update rating\n",195],["T_WHITESPACE","            ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_updateRatingPos",196],"(",["T_STRING","self",196],["T_DOUBLE_COLON","::",196],["T_STRING","AGGREGATION_DAILY",196],")",";",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_updateRatingPos",197],"(",["T_STRING","self",197],["T_DOUBLE_COLON","::",197],["T_STRING","AGGREGATION_MONTHLY",197],")",";",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_updateRatingPos",198],"(",["T_STRING","self",198],["T_DOUBLE_COLON","::",198],["T_STRING","AGGREGATION_YEARLY",198],")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_setFlagData",199],"(",["T_NS_SEPARATOR","\\",199],["T_STRING","Magento",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Reports",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Model",199],["T_NS_SEPARATOR","\\",199],["T_STRING","Flag",199],["T_DOUBLE_COLON","::",199],["T_STRING","REPORT_BESTSELLERS_FLAG_CODE",199],")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE"," ",200],["T_CATCH","catch",200],["T_WHITESPACE"," ",200],"(",["T_NS_SEPARATOR","\\",200],["T_STRING","Exception",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$e",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_THROW","throw",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$e",201],";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n\n        ",202],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Update rating position\n     *\n     * @param string $aggregation\n     * @return $this\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PROTECTED","protected",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","_updateRatingPos",213],"(",["T_VARIABLE","$aggregation",213],")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$aggregationTable",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getTable",215],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_bestsellers_aggregated_'",215],["T_WHITESPACE"," ",215],".",["T_WHITESPACE"," ",215],["T_VARIABLE","$aggregation",215],")",";",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$aggregationAliases",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],"[",["T_WHITESPACE","\n            ",217],["T_CONSTANT_ENCAPSED_STRING","'daily'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_STRING","self",218],["T_DOUBLE_COLON","::",218],["T_STRING","AGGREGATION_DAILY",218],",",["T_WHITESPACE","\n            ",218],["T_CONSTANT_ENCAPSED_STRING","'monthly'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_STRING","self",219],["T_DOUBLE_COLON","::",219],["T_STRING","AGGREGATION_MONTHLY",219],",",["T_WHITESPACE","\n            ",219],["T_CONSTANT_ENCAPSED_STRING","'yearly'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_STRING","self",220],["T_DOUBLE_COLON","::",220],["T_STRING","AGGREGATION_YEARLY",220],",",["T_WHITESPACE","\n        ",220],"]",";",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_salesResourceHelper",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getBestsellersReportUpdateRatingPos",222],"(",["T_WHITESPACE","\n            ",222],["T_VARIABLE","$aggregation",223],",",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$aggregationAliases",224],",",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getMainTable",225],"(",")",",",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$aggregationTable",226],["T_WHITESPACE","\n        ",226],")",";",["T_WHITESPACE","\n        ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n",229],"}",["T_WHITESPACE","\n",230]]