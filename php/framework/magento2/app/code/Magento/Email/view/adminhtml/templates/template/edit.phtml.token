[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Copyright \u00c2\u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n *\/",2],["T_WHITESPACE","\n\n",5],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Magento",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Framework",7],["T_NS_SEPARATOR","\\",7],["T_STRING","App",7],["T_NS_SEPARATOR","\\",7],["T_STRING","TemplateTypesInterface",7],";",["T_WHITESPACE","\n\n",7],["T_COMMENT","\/\/ @codingStandardsIgnoreFile\n",9],["T_WHITESPACE","\n",10],["T_DOC_COMMENT","\/** @var $block \\Magento\\Email\\Block\\Adminhtml\\Template\\Edit *\/",11],["T_WHITESPACE","\n",11],["T_CLOSE_TAG","?>\n",12],["T_OPEN_TAG","<?php ",13],["T_IF","if",13],["T_WHITESPACE"," ",13],"(","!",["T_VARIABLE","$block",13],["T_OBJECT_OPERATOR","->",13],["T_STRING","getEditMode",13],"(",")",")",":",["T_WHITESPACE"," ",13],["T_CLOSE_TAG","?>\n",13],["T_INLINE_HTML","<form action=\"",14],["T_OPEN_TAG","<?php ",14],["T_ECHO","echo",14],["T_WHITESPACE"," ",14],["T_VARIABLE","$block",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","escapeUrl",14],"(",["T_VARIABLE","$block",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","getLoadUrl",14],"(",")",")",["T_WHITESPACE"," ",14],["T_CLOSE_TAG","?>",14],["T_INLINE_HTML","\" method=\"post\" id=\"email_template_load_form\">\n    ",14],["T_OPEN_TAG","<?php ",15],["T_ECHO","echo",15],["T_WHITESPACE"," ",15],["T_VARIABLE","$block",15],["T_OBJECT_OPERATOR","->",15],["T_STRING","getBlockHtml",15],"(",["T_CONSTANT_ENCAPSED_STRING","'formkey'",15],")",["T_CLOSE_TAG","?>\n",15],["T_INLINE_HTML","    <fieldset class=\"admin__fieldset form-inline\">\n        <legend class=\"admin__legend\"><span>",16],["T_OPEN_TAG","<?php ",17],["T_ECHO","echo",17],["T_WHITESPACE"," ",17],["T_VARIABLE","$block",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","escapeHtml",17],"(",["T_STRING","__",17],"(",["T_CONSTANT_ENCAPSED_STRING","'Load default template'",17],")",")",["T_WHITESPACE"," ",17],["T_CLOSE_TAG","?>",17],["T_INLINE_HTML","<\/span><\/legend><br>\n        <div class=\"admin__field\">\n            <label class=\"admin__field-label\" for=\"template_select\">",17],["T_OPEN_TAG","<?php ",19],["T_ECHO","echo",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$block",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","escapeHtml",19],"(",["T_STRING","__",19],"(",["T_CONSTANT_ENCAPSED_STRING","'Template'",19],")",")",["T_WHITESPACE"," ",19],["T_CLOSE_TAG","?>",19],["T_INLINE_HTML","<\/label>\n            <div class=\"admin__field-control\">\n                <select id=\"template_select\" name=\"code\" class=\"admin__control-select required-entry\">\n                    ",19],["T_OPEN_TAG","<?php ",22],["T_FOREACH","foreach",22],["T_WHITESPACE"," ",22],"(",["T_VARIABLE","$block",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","getTemplateOptions",22],"(",")",["T_WHITESPACE"," ",22],["T_AS","as",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$group",22],["T_WHITESPACE"," ",22],["T_DOUBLE_ARROW","=>",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$options",22],")",":",["T_WHITESPACE"," ",22],["T_CLOSE_TAG","?>\n",22],["T_INLINE_HTML","                        ",23],["T_OPEN_TAG","<?php ",23],["T_IF","if",23],["T_WHITESPACE"," ",23],"(",["T_VARIABLE","$group",23],")",":",["T_WHITESPACE"," ",23],["T_CLOSE_TAG","?>\n",23],["T_INLINE_HTML","                            <optgroup label=\"",24],["T_OPEN_TAG","<?php ",24],["T_ECHO","echo",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$block",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","escapeHtmlAttr",24],"(",["T_VARIABLE","$group",24],")",["T_WHITESPACE"," ",24],["T_CLOSE_TAG","?>",24],["T_INLINE_HTML","\">\n                        ",24],["T_OPEN_TAG","<?php ",25],["T_ENDIF","endif",25],";",["T_WHITESPACE"," ",25],["T_CLOSE_TAG","?>\n",25],["T_INLINE_HTML","                        ",26],["T_OPEN_TAG","<?php ",26],["T_FOREACH","foreach",26],["T_WHITESPACE"," ",26],"(",["T_VARIABLE","$options",26],["T_WHITESPACE"," ",26],["T_AS","as",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$option",26],")",":",["T_WHITESPACE"," ",26],["T_CLOSE_TAG","?>\n",26],["T_INLINE_HTML","                            <option value=\"",27],["T_OPEN_TAG","<?php ",27],["T_ECHO","echo",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$block",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","escapeHtmlAttr",27],"(",["T_VARIABLE","$option",27],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",27],"]",")",["T_WHITESPACE"," ",27],["T_CLOSE_TAG","?>",27],["T_INLINE_HTML","\"",27],["T_OPEN_TAG","<?php ",27],["T_COMMENT","\/* @noEscape *\/",27],["T_WHITESPACE"," ",27],["T_ECHO","echo",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$block",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","getOrigTemplateCode",27],"(",")",["T_WHITESPACE"," ",27],["T_IS_EQUAL","==",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$option",27],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",27],"]",["T_WHITESPACE"," ",27],"?",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","' selected=\"selected\"'",27],["T_WHITESPACE"," ",27],":",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","''",27],["T_WHITESPACE"," ",27],["T_CLOSE_TAG","?>",27],["T_INLINE_HTML",">",27],["T_OPEN_TAG","<?php ",27],["T_ECHO","echo",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$block",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","escapeHtml",27],"(",["T_VARIABLE","$option",27],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",27],"]",")",["T_WHITESPACE"," ",27],["T_CLOSE_TAG","?>",27],["T_INLINE_HTML","<\/option>\n                        ",27],["T_OPEN_TAG","<?php ",28],["T_ENDFOREACH","endforeach",28],";",["T_WHITESPACE"," ",28],["T_CLOSE_TAG","?>\n",28],["T_INLINE_HTML","                        ",29],["T_OPEN_TAG","<?php ",29],["T_IF","if",29],["T_WHITESPACE"," ",29],"(",["T_VARIABLE","$group",29],")",":",["T_WHITESPACE"," ",29],["T_CLOSE_TAG","?>\n",29],["T_INLINE_HTML","                            <\/optgroup>\n                        ",30],["T_OPEN_TAG","<?php ",31],["T_ENDIF","endif",31],";",["T_WHITESPACE"," ",31],["T_CLOSE_TAG","?>\n",31],["T_INLINE_HTML","                    ",32],["T_OPEN_TAG","<?php ",32],["T_ENDFOREACH","endforeach",32],";",["T_WHITESPACE"," ",32],["T_CLOSE_TAG","?>\n",32],["T_INLINE_HTML","                <\/select>\n            <\/div>\n        <\/div>\n        <div class=\"admin__field required\">\n            <span class=\"admin__field-label\"><\/span>\n            <div class=\"admin__field-control\">\n                ",33],["T_OPEN_TAG","<?php ",39],["T_COMMENT","\/* @noEscape *\/",39],["T_WHITESPACE"," ",39],["T_ECHO","echo",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$block",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","getLoadButtonHtml",39],"(",")",["T_WHITESPACE"," ",39],["T_CLOSE_TAG","?>\n",39],["T_INLINE_HTML","            <\/div>\n        <\/div>\n    <\/fieldset>\n<\/form>\n",40],["T_OPEN_TAG","<?php ",44],["T_ENDIF","endif",44],["T_WHITESPACE"," ",44],["T_CLOSE_TAG","?>\n",44],["T_INLINE_HTML","\n<form action=\"",45],["T_OPEN_TAG","<?php ",46],["T_ECHO","echo",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$block",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","escapeUrl",46],"(",["T_VARIABLE","$block",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getSaveUrl",46],"(",")",")",["T_WHITESPACE"," ",46],["T_CLOSE_TAG","?>",46],["T_INLINE_HTML","\" method=\"post\" id=\"email_template_edit_form\">\n    ",46],["T_OPEN_TAG","<?php ",47],["T_COMMENT","\/* @noEscape *\/",47],["T_WHITESPACE"," ",47],["T_ECHO","echo",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$block",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getBlockHtml",47],"(",["T_CONSTANT_ENCAPSED_STRING","'formkey'",47],")",["T_CLOSE_TAG","?>\n",47],["T_INLINE_HTML","    <input type=\"hidden\" id=\"change_flag_element\" name=\"_change_type_flag\" value=\"\" \/>\n    <input type=\"hidden\" id=\"orig_template_code\" name=\"orig_template_code\" value=\"",48],["T_OPEN_TAG","<?php ",49],["T_ECHO","echo",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$block",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","escapeHtmlAttr",49],"(",["T_VARIABLE","$block",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getOrigTemplateCode",49],"(",")",")",["T_WHITESPACE"," ",49],["T_CLOSE_TAG","?>",49],["T_INLINE_HTML","\" \/>\n    ",49],["T_OPEN_TAG","<?php ",50],["T_COMMENT","\/* @noEscape *\/",50],["T_WHITESPACE"," ",50],["T_ECHO","echo",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$block",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getFormHtml",50],"(",")",["T_WHITESPACE"," ",50],["T_CLOSE_TAG","?>\n",50],["T_INLINE_HTML","<\/form>\n\n<form action=\"",51],["T_OPEN_TAG","<?php ",53],["T_ECHO","echo",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$block",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","escapeUrl",53],"(",["T_VARIABLE","$block",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getPreviewUrl",53],"(",")",")",["T_WHITESPACE"," ",53],["T_CLOSE_TAG","?>",53],["T_INLINE_HTML","\" method=\"post\" id=\"email_template_preview_form\" target=\"_blank\">\n    ",53],["T_OPEN_TAG","<?php ",54],["T_COMMENT","\/* @noEscape *\/",54],["T_WHITESPACE"," ",54],["T_ECHO","echo",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$block",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getBlockHtml",54],"(",["T_CONSTANT_ENCAPSED_STRING","'formkey'",54],")",["T_CLOSE_TAG","?>\n",54],["T_INLINE_HTML","    <div class=\"no-display\">\n        <input type=\"hidden\" id=\"preview_type\" name=\"type\" value=\"",55],["T_OPEN_TAG","<?php ",56],["T_COMMENT","\/* @noEscape *\/",56],["T_WHITESPACE"," ",56],["T_ECHO","echo",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$block",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","isTextType",56],"(",")",["T_WHITESPACE"," ",56],"?",["T_WHITESPACE"," ",56],["T_LNUMBER","1",56],["T_WHITESPACE"," ",56],":",["T_WHITESPACE"," ",56],["T_LNUMBER","2",56],["T_WHITESPACE"," ",56],["T_CLOSE_TAG","?>",56],["T_INLINE_HTML","\" \/>\n        <input type=\"hidden\" id=\"preview_text\" name=\"text\" value=\"\" \/>\n        <input type=\"hidden\" id=\"preview_styles\" name=\"styles\" value=\"\" \/>\n    <\/div>\n<\/form>\n<script>\nrequire([\n    \"jquery\",\n    \"tinymce\",\n    \"Magento_Ui\/js\/modal\/alert\",\n    \"mage\/mage\",\n    \"Magento_Variable\/variables\",\n    \"prototype\"\n], function(jQuery, tinyMCE, alert){\n\n\/\/<![CDATA[\n    jQuery('#email_template_edit_form').mage('form').mage('validation');\n    jQuery('#email_template_preview_form').mage('form').mage('validation');\n    jQuery('#email_template_load_form').mage('validation');\n    templateControl = {\n        unconvertedText: '',\n        typeChange: false,\n        variables: null,\n\n        events: {\n            'click [data-role=template-save]' : 'save',\n            'click [data-role=template-preview]' : 'preview',\n            'click [data-role=template-unstrip]' : 'unStripTags',\n            'click [data-role=template-strip]' : 'stripTags',\n            'click [data-role=template-delete]': 'deleteTemplate',\n            'click [data-role=template-load]': 'load'\n        },\n\n        init: function () {\n            if ($('convert_button_back')) {\n                $('convert_button_back').hide();\n            }\n\n            this.bindEvents();\n\n            this.renderPaths(",56],["T_OPEN_TAG","<?php ",96],["T_COMMENT","\/* @noEscape *\/",96],["T_WHITESPACE"," ",96],["T_ECHO","echo",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$block",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getCurrentlyUsedForPaths",96],"(",")",";",["T_WHITESPACE"," ",96],["T_CLOSE_TAG","?>",96],["T_INLINE_HTML",", 'currently_used_for');\n        },\n\n        bindEvents: function(){\n            var events = this.events,\n                eventName,\n                selector,\n                callback,\n                key;\n\n            for( key in events ){\n                callback    = this[events[key]];\n                key         = key.split(' ');\n\n                eventName   = key[0];\n                selector    = key.slice(1).join(' ');\n\n                jQuery(selector).on(eventName, jQuery.proxy(callback, this) );\n            }\n        },\n\n        stripTags: function () {\n            if(!window.confirm(\"",96],["T_OPEN_TAG","<?php ",118],["T_ECHO","echo",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$block",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","escapeJs",118],"(",["T_VARIABLE","$block",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","escapeHtml",118],"(",["T_STRING","__",118],"(",["T_CONSTANT_ENCAPSED_STRING","'Are you sure you want to strip tags?'",118],")",")",")",["T_WHITESPACE"," ",118],["T_CLOSE_TAG","?>",118],["T_INLINE_HTML","\")) {\n                return false;\n            }\n            this.unconvertedText = $('template_text').value;\n            $('convert_button').hide();\n            $('template_text').value =  $('template_text').value.stripScripts().replace(\n                new RegExp('<style[^>]*>[\\\\S\\\\s]*?<\/style>', 'img'), ''\n            ).stripTags().strip();\n            $('convert_button_back').show();\n            $('field_template_styles').hide();\n            this.typeChange = true;\n            return false;\n        },\n        unStripTags: function () {\n            $('convert_button').show();\n            $('convert_button_back').hide();\n            $('template_text').value =  this.unconvertedText;\n            $('field_template_styles').show();\n            this.typeChange = false;\n            return false;\n        },\n        save: function() {\n            if (this.typeChange) {\n                $('change_flag_element').value = '1';\n            }\n            \/\/ Temporary solution will be replaced after refactoring of email templates functionality\n            jQuery('#email_template_edit_form').triggerHandler('save');\n            return false;\n        },\n        preview: function() {\n            if (this.typeChange) {\n                $('preview_type').value = ",118],["T_OPEN_TAG","<?php ",149],["T_COMMENT","\/* @noEscape *\/",149],["T_WHITESPACE"," ",149],["T_ECHO","echo",149],["T_WHITESPACE"," ",149],["T_STRING","TemplateTypesInterface",149],["T_DOUBLE_COLON","::",149],["T_STRING","TYPE_TEXT",149],["T_WHITESPACE"," ",149],["T_CLOSE_TAG","?>",149],["T_INLINE_HTML",";\n            } else {\n                $('preview_type').value = ",149],["T_OPEN_TAG","<?php ",151],["T_ECHO","echo",151],["T_WHITESPACE"," ",151],["T_INT_CAST","(int)",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$block",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getTemplateType",151],"(",")",["T_WHITESPACE"," ",151],["T_CLOSE_TAG","?>",151],["T_INLINE_HTML",";\n            }\n            if (typeof tinyMCE == 'undefined' || !tinyMCE.getInstanceById('template_text')) {\n                $('preview_text').value = $('template_text').value;\n            } else {\n                $('preview_text').value = tinyMCE.getInstanceById('template_text').getHTML();\n            }\n\n            if ($('template_styles') != undefined) {\n                $('preview_styles').value = $('template_styles').value;\n            }\n\n            \/\/ Temporary solution will be replaced after refactoring of email templates functionality\n            jQuery('#email_template_preview_form').triggerHandler('save');\n            return false;\n        },\n\n        deleteTemplate: function() {\n            if(window.confirm(\"",151],["T_OPEN_TAG","<?php ",169],["T_ECHO","echo",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$block",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","escapeJs",169],"(",["T_VARIABLE","$block",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","escapeHtml",169],"(",["T_STRING","__",169],"(",["T_CONSTANT_ENCAPSED_STRING","'Are you sure you want to delete this template?'",169],")",")",")",["T_WHITESPACE"," ",169],["T_CLOSE_TAG","?>",169],["T_INLINE_HTML","\")) {\n                   window.location.href = '",169],["T_OPEN_TAG","<?php ",170],["T_ECHO","echo",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$block",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","escapeJs",170],"(",["T_VARIABLE","$block",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","escapeUrl",170],"(",["T_VARIABLE","$block",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getDeleteUrl",170],"(",")",")",")",["T_WHITESPACE"," ",170],["T_CLOSE_TAG","?>",170],["T_INLINE_HTML","';\n            }\n        },\n\n        load: function() {\n            \/\/ Temporary solution will be replaced after refactoring of email templates functionality\n            if (!jQuery('#email_template_load_form').valid()) {\n                return;\n            }\n\n            this.variables = null;\n\n            new Ajax.Request($('email_template_load_form').action, {\n               parameters: Form.serialize($('email_template_load_form'), true),\n               area: $('email_template_load_form'),\n               onComplete: function (transport) {\n                   if (transport.responseText.isJSON()) {\n                       var fields = $H(transport.responseText.evalJSON());\n                       fields.each(function(pair) {\n                          if ($(pair.key)) {\n                              $(pair.key).value = pair.value.strip();\n                          }\n                          if (pair.key == 'template_type') {\n                              if (pair.value == 1) {\n                                  this.typeChange = true;\n                                  $('convert_button').hide();\n                                  $('convert_button_back').hide();\n                              } else {\n                                  this.typeChange = false;\n                                  $('convert_button_back').hide();\n                                  $('convert_button').show();\n                              }\n                          }\n                          if (pair.key == 'orig_template_currently_used_for') {\n                               if(pair.value.length){\n                                   $('currently_used_for').show();\n                                   this.renderPaths(pair.value, 'currently_used_for');\n                               }\n                               else{\n                                   $('currently_used_for').hide();\n                               }\n                          }\n                       }.bind(this));\n                   } else {\n                       alert({\n                           content: '",170],["T_OPEN_TAG","<?php ",215],["T_ECHO","echo",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$block",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","escapeJs",215],"(",["T_VARIABLE","$block",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","escapeHtml",215],"(",["T_STRING","__",215],"(",["T_CONSTANT_ENCAPSED_STRING","'The template did not load. Please review the log for details.'",215],")",")",")",["T_WHITESPACE"," ",215],["T_CLOSE_TAG","?>",215],["T_INLINE_HTML","'\n                       });\n                   }\n               }.bind(this)\n            });\n\n        },\n\n        renderPaths: function(paths, fieldId) {\n            var field = $(fieldId);\n            if (field) {\n                field.down('div').down('div').update(this.parsePath(paths, '<span class=\"path-delimiter\">&nbsp;-&gt;&nbsp;<\/span>', '<br \/>'));\n            }\n        },\n\n        parsePath: function (value, pathDelimiter, lineDelimiter) {\n            if (Object.isArray(value)) {\n                var result = [];\n                for (var i = 0, len = value.length; i < len; i++) {\n                    result.push(this.parsePath(value[i], pathDelimiter, pathDelimiter));\n                }\n                return result.join(lineDelimiter);\n            }\n\n            if(!Object.isString(value) && value.title) {\n                value = (value.url ? '<a href=\"' + value.url + '\">' + value.title + '<\/a>' : value.title) + (value.scope ? '&nbsp;&nbsp;<span class=\"path-scope-label\">(' + value.scope + ')<\/span>' : '');\n            }\n\n            return value;\n        },\n\n        openVariableChooser: function() {\n            Variables.init('template_text');\n            if (this.variables == null) {\n                Variables.resetData();\n                this.variables = $('variables').value.evalJSON();\n                var templateVariablesValue = $('template_variables').value;\n                if (this.variables && templateVariablesValue) {\n                    if (templateVariables = templateVariablesValue.evalJSON()) {\n                        this.variables.push(templateVariables);\n                    }\n                }\n            }\n            if (this.variables) {\n                Variables.openVariableChooser(this.variables);\n            }\n        }\n    };\n\n    templateControl.init();\n\/\/]]>\n\n});\n<\/script>\n",215]]